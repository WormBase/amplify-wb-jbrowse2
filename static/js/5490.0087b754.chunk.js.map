{"version":3,"file":"static/js/5490.0087b754.chunk.js","mappings":"qMAeA,sBAA6BA,EAAAA,uBAC3B,eAAaC,GAAa,IAADC,EACvB,MAAMC,QAAkC,QAAxBD,EAAME,KAAKC,qBAAa,IAAAH,OAAA,EAAlBA,EAAAI,KAAAF,KAAqBA,KAAKG,QAAQ,qBACxD,IAAKJ,EACH,MAAM,IAAIK,MAAM,4BAElB,OAAOL,EAAQM,WACjB,CAEA,iBAAaC,GAEX,aADsBN,KAAKH,aACZS,aACjB,CAEOC,WAAAA,CAAYC,EAAeC,GAChC,OAAOC,EAAAA,EAAAA,mBAA0BC,UAAmB,IAADC,EACjD,MAAMC,QAAwBb,KAAKH,YAEnC,IAAMiB,MAAOC,EAAYC,IAAKC,GAAaT,EAI3C,GAHAO,EAAaG,KAAKC,IAAI,EAAGJ,EAFd,KAGXE,GAHW,IAKPA,EAAW,GAAKF,EAAaE,EAE/B,YADAG,EAASC,WAIX,MAAMC,EAAMT,EAAgBN,YAC1B,IACKC,EACHM,MAAOC,EACPC,IAAKC,GAEPR,GAGIc,GAA2B,QAARX,SADLY,EAAAA,EAAAA,GAAeF,EAAIG,MAAKC,EAAAA,EAAAA,QACb,UAAE,IAAAd,OAAA,EAARA,EAAUe,IAAI,SAAU,GAC3CC,EAAS5B,KAAKG,QAAQ,UACtB0B,EAAgB7B,KAAKG,QAAQ,iBAC7B2B,EAAgB9B,KAAKG,QAAQ,iBAC7B4B,EAAkB/B,KAAKG,QAAQ,mBAC/B6B,EAAK,IAAIC,OAAOL,EAAQ,KAAOG,EAAkB,IAAM,KAE7D,GAAIH,EAAQ,CACV,GAAIC,EAAe,CACjB,MAAMK,EAAUX,EAASY,SAASH,GAClC,IAAK,MAAMI,KAASF,EAAS,CAC3B,MAAMG,EAAItB,GAAcqB,EAAME,OAAS,IAEnCC,EAAAA,EAAAA,gBAAeF,EAAGA,EAAIT,EAAOY,OAAQhC,EAAMM,MAAON,EAAMQ,MAC1DI,EAASqB,KACP,IAAIC,EAAAA,cAAc,CAChBC,SAAS,GAADC,OAAK5C,KAAK6C,GAAE,WAAAD,OAAUP,EAAC,MAC/BS,QAAStC,EAAMsC,QACfhC,MAAOuB,EACPrB,IAAKqB,EAAID,EAAM,GAAGI,OAClBO,KAAMX,EAAM,GACZY,OAAQ,IAIhB,CACF,CACA,GAAIlB,EAAe,CACjB,MAAMI,GAAUe,EAAAA,EAAAA,QAAO1B,GAAUY,SAASH,GAC1C,IAAK,MAAMI,KAASF,EAAS,CAC3B,MAAMG,EAAIpB,GAAYmB,EAAME,OAAS,IACjCC,EAAAA,EAAAA,gBAAeF,EAAGA,EAAIT,EAAOY,OAAQhC,EAAMM,MAAON,EAAMQ,MAC1DI,EAASqB,KACP,IAAIC,EAAAA,cAAc,CAChBC,SAAS,GAADC,OAAK5C,KAAK6C,GAAE,WAAAD,OAAUP,EAAC,MAC/BS,QAAStC,EAAMsC,QACfhC,MAAOuB,EAAID,EAAM,GAAGI,OACpBO,KAAMX,EAAM,GACZpB,IAAKqB,EACLW,QAAS,IAIjB,CACF,CACF,CAEA5B,EAASC,UAAU,GAEvB,CAEO6B,aAAAA,GAAiB,E","sources":["../../../plugins/sequence/src/SequenceSearchAdapter/SequenceSearchAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport {\n  SimpleFeature,\n  Feature,\n  Region,\n  revcom,\n  doesIntersect2,\n} from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\nimport { firstValueFrom } from 'rxjs'\n\nexport default class extends BaseFeatureDataAdapter {\n  public async configure() {\n    const adapter = await this.getSubAdapter?.(this.getConf('sequenceAdapter'))\n    if (!adapter) {\n      throw new Error('Error getting subadapter')\n    }\n    return adapter.dataAdapter as BaseFeatureDataAdapter\n  }\n\n  public async getRefNames() {\n    const adapter = await this.configure()\n    return adapter.getRefNames()\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions) {\n    return ObservableCreate<Feature>(async observer => {\n      const sequenceAdapter = await this.configure()\n      const hw = 1000\n      let { start: queryStart, end: queryEnd } = query\n      queryStart = Math.max(0, queryStart - hw)\n      queryEnd += hw\n\n      if (queryEnd < 0 || queryStart > queryEnd) {\n        observer.complete()\n        return\n      }\n\n      const ret = sequenceAdapter.getFeatures(\n        {\n          ...query,\n          start: queryStart,\n          end: queryEnd,\n        },\n        opts,\n      )\n      const feats = await firstValueFrom(ret.pipe(toArray()))\n      const residues: string = feats[0]?.get('seq') || ''\n      const search = this.getConf('search') as string\n      const searchForward = this.getConf('searchForward')\n      const searchReverse = this.getConf('searchReverse')\n      const caseInsensitive = this.getConf('caseInsensitive')\n      const re = new RegExp(search, 'g' + (caseInsensitive ? 'i' : ''))\n\n      if (search) {\n        if (searchForward) {\n          const matches = residues.matchAll(re)\n          for (const match of matches) {\n            const s = queryStart + (match.index || 0)\n\n            if (doesIntersect2(s, s + search.length, query.start, query.end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `${this.id}-match-${s}-p`,\n                  refName: query.refName,\n                  start: s,\n                  end: s + match[0].length,\n                  name: match[0],\n                  strand: 1,\n                }),\n              )\n            }\n          }\n        }\n        if (searchReverse) {\n          const matches = revcom(residues).matchAll(re)\n          for (const match of matches) {\n            const s = queryEnd - (match.index || 0)\n            if (doesIntersect2(s, s + search.length, query.start, query.end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `${this.id}-match-${s}-n`,\n                  refName: query.refName,\n                  start: s - match[0].length,\n                  name: match[0],\n                  end: s,\n                  strand: -1,\n                }),\n              )\n            }\n          }\n        }\n      }\n\n      observer.complete()\n    })\n  }\n\n  public freeResources() {}\n}\n"],"names":["BaseFeatureDataAdapter","configure","_this$getSubAdapter","adapter","this","getSubAdapter","call","getConf","Error","dataAdapter","getRefNames","getFeatures","query","opts","ObservableCreate","async","_feats$","sequenceAdapter","start","queryStart","end","queryEnd","Math","max","observer","complete","ret","residues","firstValueFrom","pipe","toArray","get","search","searchForward","searchReverse","caseInsensitive","re","RegExp","matches","matchAll","match","s","index","doesIntersect2","length","next","SimpleFeature","uniqueId","concat","id","refName","name","strand","revcom","freeResources"],"sourceRoot":""}