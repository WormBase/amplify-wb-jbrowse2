"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[5968],{95968:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var o=n(41867),r=n(3762),a=n(31625),s=n(47192),i=n(25866),l=n(80838);const c=(0,s.ZL)()({overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}}}),d=(0,r.observer)((function(e){let{model:t}=e;const{classes:n}=c(),{matchedTracks:r,interactToggled:a}=t,s=(0,o.useRef)(null);return(0,l.jsx)("div",{className:n.overlay,children:(0,l.jsx)("svg",{ref:s,style:{width:"100%",zIndex:10,pointerEvents:a?void 0:"none"},children:r.map((e=>(0,l.jsx)(i.Z,{parentRef:s,model:t,trackId:e.configuration.trackId},e.configuration.trackId)))})})})),u=(0,s.ZL)()((e=>({viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},content:{gridArea:"1/1"}}))),g=(0,r.observer)((function(e){let{model:t}=e;const{classes:n}=u(),{views:o}=t,{pluginManager:r}=(0,a.getEnv)(t);return(0,l.jsx)("div",{className:n.content,children:(0,l.jsx)("div",{style:{position:"relative"},children:o.map(((e,t)=>{const{ReactComponent:a}=r.getViewType(e.type),s=(0,l.jsx)(a,{model:e},e.id);return t===o.length-1?s:[s,(0,l.jsx)("div",{className:n.viewDivider},"".concat(e.id,"-divider"))]}))})})})),f=(0,r.observer)((function(e){let{model:t}=e;const{classes:n}=u();return(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:n.container,children:[(0,l.jsx)(g,{model:t}),(0,l.jsx)(d,{model:t})]})})}))},25866:(e,t,n)=>{n.d(t,{Z:()=>y});var o=n(41867),r=n(3762),a=n(31625),s=n(17280),i=n(90872),l=n(98303);function c(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function d(e,t){const n=e.get("ALT");if(n)return new Map(null===n||void 0===n?void 0:n.map((e=>(0,l.I)(e))).filter(i.notEmpty).map((e=>[e.MatePosition,e]))).get("".concat(t.get("refName"),":").concat(t.get("start")+1))}var u=n(71416),g=n(80838);const[f,,v]=[0,1,2,3],p=(0,r.observer)((function(e){let{model:t,trackId:n,parentRef:r,getTrackYPosOverride:l}=e;const{views:d,showIntraviewLinks:p}=t,h=(0,s.Z)(),m=(0,i.getSession)(t),k=(0,a.getSnapshot)(t),{assemblyManager:w}=m,y=w.get(d[0].assemblyNames[0]);(0,u.Go)(k);const N=t.getTrackFeatures(n),x=(0,o.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(N)),[N]),M=(0,o.useMemo)((()=>{const e=t.getMatchedFeaturesInLayout(n,x?function(e){const t=new Map,n=new Set;for(const o of e.values()){const e=o.get("flags"),r=o.id(),a=4&e,s=2&e;if(!n.has(r)&&!s&&!a){const e=o.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(o)}n.add(o.id())}return[...t.values()].filter((e=>e.length>1))}(N):function(e){const t=new Map,n=new Set;for(const o of e.values()){const e=o.id(),r=4&o.get("flags"),a=!!c(o,"SA");if(!n.has(e)&&!r&&a){const e=o.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(o)}n.add(o.id())}return[...t.values()].filter((e=>e.length>1))}(N));return x||e.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),e}),[N,n,x,t]),[T,b]=(0,o.useState)();let j=0;if(r.current){const e=r.current.getBoundingClientRect();j=e.top}return y?(0,g.jsx)("g",{stroke:h.palette.text.disabled,fill:"none","data-testid":M.length?"".concat(n,"-loaded"):n,children:M.map((e=>{const t=[];for(let o=0;o<e.length-1;o++){const{layout:r,feature:a,level:s}=e[o],{layout:i,feature:c,level:h}=e[o+1];if(!r||!i)return console.warn("received null layout for a overlay feature"),null;if(!p&&s===h)return null;const k=y.getCanonicalRefName(a.get("refName")),w=y.getCanonicalRefName(c.get("refName"));if(!k||!w)throw new Error("unable to find ref for ".concat(k||w));const M=a.get("strand"),O=c.get("strand"),S=r[-1===M?f:v],L=-1===O,R=x?i[L?f:v]:i[L?v:f],C=(0,u.mu)(d[s],k,S),I=(0,u.mu)(d[h],w,R),W=d[s].pxToBp(C).reversed,A=d[h].pxToBp(I).reversed,F=d.map((e=>e.getTrack(n))),B=(0,u.cO)(n,s,d,F,r,l)-j,J=(0,u.cO)(n,h,d,F,i,l)-j,D=["M",C,B,"C",C+200*a.get("strand")*(W?-1:1),B,I-200*c.get("strand")*(A?-1:1)*(x?-1:1),J,I,J].join(" "),E="".concat(a.id(),"-").concat(c.id());t.push((0,g.jsx)("path",{d:D,"data-testid":"r1",strokeWidth:T===E?5:1,onClick:()=>{var e,t;const n=null===(e=m.addWidget)||void 0===e?void 0:e.call(m,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(N.get(a.id())||{toJSON:()=>{}}).toJSON(),feature2:(N.get(c.id())||{toJSON:()=>{}}).toJSON()}});null===(t=m.showWidget)||void 0===t||t.call(m,n)},onMouseOver:()=>b(E),onMouseOut:()=>b(void 0)},E))}return t}))}):null})),[h]=[0,1,2,3],m=(0,r.observer)((function(e){let{model:t,trackId:n,parentRef:r,getTrackYPosOverride:s}=e;const{views:c}=t,f=(0,i.getSession)(t),{assemblyManager:v}=f,p=t.getTrackFeatures(n),m=(0,o.useMemo)((()=>t.getMatchedFeaturesInLayout(n,function(e){const t=new Map,n=new Set;for(const o of e.values()){if(!n.has(o.id())&&"breakend"===o.get("type")){const e=o.get("ALT");null===e||void 0===e||e.forEach((e=>{const n="".concat(o.get("refName"),":").concat(o.get("start")+1),r=(0,l.I)(e);if(r){const e=t.get(n);e?e.push(o):t.set(r.MatePosition||"none",[o])}}))}n.add(o.id())}return[...t.values()].filter((e=>e.length>1))}(p))),[p,n,t]),[k,w]=(0,o.useState)(),y=(0,a.getSnapshot)(t);(0,u.Go)(y);const N=v.get(c[0].assemblyNames[0]);if(!N)return null;let x=0;if(r.current){const e=r.current.getBoundingClientRect();x=e.top}return(0,g.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":m.length?"".concat(n,"-loaded"):n,children:m.map((e=>{const t=[];for(let o=0;o<e.length-1;o+=1){const{layout:r,feature:a,level:i}=e[o],{layout:l,feature:v,level:m}=e[o+1],y=a.id(),M=d(a,v);if(!r||!l)return null;const T=a.get("refName"),b=v.get("refName"),j=N.getCanonicalRefName(T),O=N.getCanonicalRefName(b);if(!j||!O)throw new Error("unable to find ref for ".concat(j||O));const S=(0,u.mu)(c[i],j,r[h]),L=(0,u.mu)(c[m],O,l[h]),R=c[i].pxToBp(S).reversed,C=c[m].pxToBp(L).reversed,I=c.map((e=>e.getTrack(n))),W=(0,u.cO)(n,i,c,I,r,s)-x,A=(0,u.cO)(n,m,c,I,l,s)-x;if(M){const e=["M",S-20*("left"===M.Join?-1:1)*(R?-1:1),W,"L",S,W,"L",L,A,"L",L-20*("left"===M.MateDirection?1:-1)*(C?-1:1),A].join(" ");t.push((0,g.jsx)("path",{d:e,strokeWidth:y===k?10:5,onClick:()=>{var e,t,n;const o=null===(e=f.addWidget)||void 0===e?void 0:e.call(f,"VariantFeatureWidget","variantFeature",{featureData:null===(t=p.get(y))||void 0===t?void 0:t.toJSON()});null===(n=f.showWidget)||void 0===n||n.call(f,o)},onMouseOver:()=>w(y),onMouseOut:()=>w(void 0)},JSON.stringify(e)))}else console.warn("the relevant ALT allele was not found, cannot render")}return t}))})})),[k]=[0,1,2,3],w=(0,r.observer)((function(e){let{model:t,trackId:n,parentRef:r,getTrackYPosOverride:s}=e;const{views:l}=t,c=(0,i.getSession)(t),{assemblyManager:d}=c,f=t.getTrackFeatures(n),v=(0,o.useMemo)((()=>t.getMatchedFeaturesInLayout(n,function(e){const t=[],n=new Set;for(const o of e.values())n.has(o.id())||"<TRA>"!==o.get("ALT")[0]||t.push([o]),n.add(o.id());return t}(f))),[f,n,t]),[p,h]=(0,o.useState)(),m=(0,a.getSnapshot)(t);(0,u.Go)(m);if(!d.get(l[0].assemblyNames[0]))return null;let w=0;if(r.current){const e=r.current.getBoundingClientRect();w=e.top}return l.length<2?null:(0,g.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":v.length?"".concat(n,"-loaded"):n,children:v.map((e=>{const t=[];for(const{layout:o,feature:r,level:a}of e){const e=0===a?1:0,i=r.id();if(!o)return null;const d=r.get("INFO"),v=d.CHR2[0],m=d.END[0],[y,N]=d.STRANDS[0].split(""),x=(0,u.mu)(l[e],v,m);if(x){const d=[x,0,x+1,0],v=(0,u.mu)(l[a],r.get("refName"),o[k]),m=x,M=l[a].pxToBp(v).reversed,T=l[e].pxToBp(m).reversed,b=l.map((e=>e.getTrack(n))),j=(0,u.cO)(n,a,l,b,o,s)-w,O=(0,u.cO)(n,e,l,b,d,s)-w,S=["M",v-20*("+"===y?1:-1)*(M?-1:1),j,"L",v,j,"L",m,O,"L",m-20*("+"===N?1:-1)*(T?-1:1),O].join(" ");t.push((0,g.jsx)("path",{d:S,strokeWidth:i===p?10:5,onClick:()=>{var e,t;const n=null===(e=c.addWidget)||void 0===e?void 0:e.call(c,"VariantFeatureWidget","variantFeature",{featureData:(f.get(i)||{toJSON:()=>{}}).toJSON()});null===(t=c.showWidget)||void 0===t||t.call(c,n)},onMouseOver:()=>h(i),onMouseOut:()=>h(void 0)},JSON.stringify(S)))}}return t}))})})),y=(0,r.observer)((function(e){var t,n;const{model:o,trackId:r}=e,a=o.getMatchedTracks(r);return"AlignmentsTrack"===(null===(t=a[0])||void 0===t?void 0:t.type)?(0,g.jsx)(p,{...e}):"VariantTrack"===(null===(n=a[0])||void 0===n?void 0:n.type)?o.hasTranslocations(r)?(0,g.jsx)(w,{...e}):(0,g.jsx)(m,{...e}):null}))}}]);
//# sourceMappingURL=5968.d768d0c3.chunk.js.map