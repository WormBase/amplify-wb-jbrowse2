"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9658],{79610:(e,t,a)=>{a.d(t,{$2:()=>o,Eg:()=>c,WT:()=>s,f0:()=>l,mr:()=>r});var n=a(99546),i=a(30385);function r({feature:e,ctx:t,offsets:a,cb:i,height:r,drawCurves:s,oobLimit:l,viewWidth:c,hideTiny:f}){const{p11:h,p12:m,p21:g,p22:d}=e,u=h.offsetPx-a[0],w=m.offsetPx-a[0],p=g.offsetPx-a[1],b=d.offsetPx-a[1],v=Math.abs(w-u),x=Math.abs(b-p),y=r,M=(y-0)/2,S=Math.min(p,b),C=Math.max(p,b);(0,n.doesIntersect2)(S,C,-l,c+l)&&(v<=1&&x<=1?f||(t.beginPath(),t.moveTo(u,0),s?t.bezierCurveTo(u,M,p,M,p,y):t.lineTo(p,y),t.stroke()):(o(t,u,w,0,b,p,y,M,s),i(t)))}function o(e,t,a,n,i,r,o,s,l){l?function(e,t,a,n,i,r,o,s){const l=Math.abs(t-a),c=Math.abs(t-a);if(l<5&&c<5&&a<t&&Math.abs(t-i)>100){const e=t;t=a,a=e}e.beginPath(),e.moveTo(t,n),e.lineTo(a,n),e.bezierCurveTo(a,s,i,s,i,o),e.lineTo(r,o),e.bezierCurveTo(r,s,t,s,t,n),e.closePath(),e.fill()}(e,t,a,n,i,r,o,s):function(e,t,a,n,i,r,o){e.beginPath(),e.moveTo(t,n),e.lineTo(a,n),e.lineTo(i,o),e.lineTo(r,o),e.closePath(),e.fill()}(e,t,a,n,i,r,o)}function s(e,t){const a=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(!a||!r)return;const o=a.getBoundingClientRect(),s=a.getContext("2d"),l=r.getContext("2d");if(!s||!l)return;const c=e.clientX-o.left,f=e.clientY-o.top,[h,m,g]=s.getImageData(c,f,1,1).data,d=Math.floor(i.xx/t.numFeats),u=(0,i.OX)(h,m,g,d),w=t.featPositions[u];if(w){const{f:e}=w;t.setClickId(e.id());const a=(0,n.getSession)(t);(0,n.isSessionModelWithWidgets)(a)&&a.showWidget(a.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:{feature1:e.toJSON(),feature2:e.get("mate")}}))}return w}function l(e,t,a){e.preventDefault();const n=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(!n||!r)return;const o=n.getBoundingClientRect(),s=n.getContext("2d"),l=r.getContext("2d");if(!s||!l)return;const{clientX:c,clientY:f}=e,h=c-o.left,m=f-o.top,[g,d,u]=s.getImageData(h,m,1,1).data,w=Math.floor(i.xx/t.numFeats),p=(0,i.OX)(g,d,u,w),b=t.featPositions[p];b&&(t.setClickId(b.f.id()),a({clientX:c,clientY:f,feature:b}))}function c(e,t,a){const i=e.toJSON(),r=i.mate,o=i.end-i.start,s=r.end-r.start,l=i.identity,c=i.name,f=r.name;return[`Loc1: ${(0,n.assembleLocString)(i)}`,`Loc2: ${(0,n.assembleLocString)(r)}`,`Inverted: ${-1===i.strand}`,`Query len: ${o.toLocaleString("en-US")}`,`Target len: ${s.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${a}`:"",c?`Name 1: ${c}`:"",f?`Name 1: ${f}`:""].filter((e=>!!e)).join("<br/>")}},30385:(e,t,a)=>{a.d(t,{C4:()=>g,OX:()=>h,Ww:()=>m,xx:()=>o});var n=a(99546),i=a(79610),r=a(36422);const o=16581375;function s(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const l={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,f=1600;function h(e,t,a,n){return Math.floor((255*e*255+255*t+a-1)/n)}function m(e,t,a){const h=(0,n.getContainingView)(e),m=(0,r.getParent)(e,4).level,g=h.drawCurves,d=h.drawCIGAR,{height:u,featPositions:w}=e,p=h.width,b=h.views.map((e=>e.bpPerPx));a&&(a.imageSmoothingEnabled=!1),t.beginPath();const v=h.views.map((e=>e.offsetPx)),x=Math.floor(o/w.length);t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:a,p21:n,p22:i}of w){const r=e.offsetPx-v[m],o=a.offsetPx-v[m],s=n.offsetPx-v[m+1],l=i.offsetPx-v[m+1],h=Math.abs(o-r),d=Math.abs(l-s),w=0,b=u,x=(b-w)/2;h<=c&&d<=c&&s<p+f&&s>-f&&(t.moveTo(r,w),g?t.bezierCurveTo(r,x,s,x,s,b):t.lineTo(s,b))}t.stroke(),t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:r,p21:x,p22:y,f:M,cigar:S}of w){const w=e.offsetPx-v[m],C=r.offsetPx-v[m],P=x.offsetPx-v[m+1],k=y.offsetPx-v[m+1],T=Math.abs(C-w),$=Math.abs(k-P),E=Math.min(P,k),z=Math.max(P,k),L=0,I=u,R=(I-L)/2;if(!(T<=c&&$<=c)&&(0,n.doesIntersect2)(E,z,-f,h.width+f)){const e=M.get("strand"),n=-1===e?C:w,r=n<(-1===e?w:C)?1:-1,c=(P<k?1:-1)*e;let f=n,h=-1===e?k:P;if(S?.length&&d){let e=!1,n=0,d=0;const u=Math.floor(o/S.length);for(let o=0;o<S.length;o+=2){const w=o*u+1,v=+S[o],x=S[o+1];e||(n=f,d=h);const y=v/b[m],M=v/b[m+1];if("M"===x||"="===x||"X"===x?(f+=y*r,h+=M*c):"D"===x||"N"===x?f+=y*r:"I"===x&&(h+=M*c),!(Math.max(n,d,f,h)<0||Math.min(n,d,f,h)>p)){const r=o<S.length-2;Math.abs(f-n)<=1&&Math.abs(h-d)<=1&&r?e=!0:(e=!1,t.fillStyle=l[e&&y>1||M>1?x:"M"],(0,i.$2)(t,n,f,L,h,d,I,R,g),a&&(a.fillStyle=s(w),(0,i.$2)(a,n,f,L,h,d,I,R,g)))}}}else(0,i.$2)(t,w,C,L,k,P,I,R,g)}}const y=e.clickMapCanvas?.getContext("2d");if(y){y.imageSmoothingEnabled=!1,y.clearRect(0,0,p,u);for(let e=0;e<w.length;e++){const t=w[e],a=e*x+1;y.fillStyle=s(a),(0,i.mr)({cb:e=>e.fill(),feature:t,ctx:y,drawCurves:g,offsets:v,oobLimit:f,viewWidth:h.width,hideTiny:!0,height:u})}}}function g(e){const{clickId:t,mouseoverId:a}=e,r=(0,n.getContainingView)(e),o=r.drawCurves,s=e.height,l=r.width,c=e.mouseoverCanvas?.getContext("2d"),h=r.views.map((e=>e.offsetPx));if(!c)return;c.resetTransform(),c.scale(1,1),c.clearRect(0,0,l,s);const m=e.featMap[a||""];m&&(c.fillStyle="rgb(0,0,0,0.1)",(0,i.mr)({cb:e=>e.fill(),feature:m,ctx:c,oobLimit:f,viewWidth:r.width,drawCurves:o,offsets:h,height:s}));const g=e.featMap[t||""];g&&(c.strokeStyle="rgb(0, 0, 0, 0.9)",(0,i.mr)({cb:e=>e.stroke(),feature:g,ctx:c,oobLimit:f,viewWidth:r.width,drawCurves:o,offsets:h,height:s}))}},69658:(e,t,a)=>{a.d(t,{renderToSvg:()=>u});var n=a(7552),i=a(48407),r=a(36422),o=a(42489),s=a(99546),l=a(91468),c=a(49823),f=a(68666),h=a(48231);function m({width:e,height:t,shift:a}){const i=(0,h.A)();return n.createElement("rect",{width:e+2*a,height:t,fill:(0,s.stripAlpha)(i.palette.background.default)})}var g=a(30385);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d.apply(null,arguments)}async function u(e,t){await(0,o.when)((()=>e.initialized));const{textHeight:a=18,headerHeight:h=30,rulerHeight:u=30,fontSize:w=13,trackLabels:p="offset",Wrapper:b=(({children:e})=>e),themeName:v="default"}=t,x=(0,s.getSession)(e),y=x.allThemes?.()[v],{width:M,views:S,levels:C}=e,P=h+u,{createRootFn:k}=(0,r.getRoot)(e),T=S.map((e=>(0,f.mJ)(e.tracks,a,p)+P)),$=(0,s.sum)(T)+100,E=await Promise.all(S.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const a=e.displays[0];return await(0,o.when)((()=>void 0===a.ready||a.ready)),{track:e,result:await a.renderSvg({...t,theme:y})}})))})))),z=await Promise.all(C.map((async e=>{await Promise.all(e.tracks.map((async a=>{const n=a.displays[0];await(0,o.when)((()=>void 0===n.ready||n.ready));const i=await(0,s.renderToAbstractCanvas)(M,e.height,{exportSVG:t},(e=>(0,g.Ww)(n,e)));if("imageData"in i)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in i?{html:await(0,s.getSerializedSvg)({...i,width:M,height:e.height})}:i})))}))),L=(0,s.max)(S.flatMap((e=>e.tracks.map((e=>(0,s.measureText)((0,l.getTrackName)(e.configuration,x),w))))),0)+40,I="left"===p?L:0,R=M+I,W=(0,c.createJBrowseTheme)(y);return(0,s.renderToStaticMarkup)(n.createElement(i.A,{theme:W},n.createElement(b,null,n.createElement("svg",{width:M,height:$,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,R+100,$].toString()},n.createElement(m,{width:R,height:$,shift:50}),n.createElement("g",{transform:`translate(50 ${w})`},n.createElement("g",{transform:`translate(${I})`},n.createElement("text",d({x:0,fontSize:w},(0,s.getFillProps)(W.palette.text.primary)),S[0].assemblyNames.join(", ")),n.createElement(f.$m,{model:E[0].view,fontSize:w})),n.createElement(f.zh,{textHeight:a,trackLabels:p,fontSize:w,model:E[0].view,displayResults:E[0].data,offset:P,trackLabelOffset:I})),n.createElement("defs",null,n.createElement("clipPath",{id:"synclip"},n.createElement("rect",{x:0,y:0,width:M,height:synH}))),n.createElement("g",{transform:`translate(${50+I} ${w+T[0]})`,clipPath:"url(#synclip)"},z.map(((e,t)=>n.createElement(s.ReactRendering,{key:t,rendering:e})))),n.createElement("g",{transform:`translate(50 ${w+T[0]+synH})`},n.createElement("g",{transform:`translate(${I})`},n.createElement("text",d({x:0,fontSize:w},(0,s.getFillProps)(W.palette.text.primary)),S[1].assemblyNames.join(", ")),n.createElement(f.$m,{model:E[1].view,fontSize:w})),n.createElement(f.zh,{textHeight:a,trackLabels:p,fontSize:w,model:E[1].view,displayResults:E[1].data,offset:P,trackLabelOffset:I}))))),k)}}}]);
//# sourceMappingURL=9658.96d54d14.chunk.js.map