"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8856],{28856:(t,e,i)=>{i.d(e,{doAfterAttach:()=>c});var n=i(36422),o=i(99546),a=i(95095),s=i(63352),r=i(42489),f=i(30385);function c(t){(0,n.addDisposer)(t,(0,r.autorun)((()=>{const e=(0,o.getContainingView)(t);if(!e.initialized)return;const i=t.mainCanvas?.getContext("2d"),n=t.cigarClickMapCanvas?.getContext("2d");if(!i||!n)return;const a=t.height,s=e.width;i.clearRect(0,0,s,a),n.clearRect(0,0,s,a),(0,f.Ww)(t,i,n)}))),(0,n.addDisposer)(t,(0,r.autorun)((()=>{(0,o.getContainingView)(t).initialized&&(0,f.C4)(t)}))),(0,n.addDisposer)(t,(0,r.reaction)((()=>{const e=(0,o.getContainingView)(t);return{bpPerPx:e.views.map((t=>t.bpPerPx)),displayedRegions:JSON.stringify(e.views.map((t=>t.displayedRegions))),features:t.features,initialized:e.initialized}}),(({initialized:e})=>{if(!e)return;const{assemblyManager:i}=(0,o.getSession)(t),r=(0,o.getContainingView)(t),f=(0,n.getParent)(t,4).level,c=r.views.map((t=>({...(0,n.getSnapshot)(t),width:t.width,staticBlocks:t.staticBlocks,interRegionPaddingWidth:t.interRegionPaddingWidth,minimumBlockWidth:t.minimumBlockWidth}))),l=[],d=t.features||[];for(const t of d){const e=t.get("mate");let n=t.get("start"),o=t.get("end");const r=e.start,d=e.end;-1===t.get("strand")&&([o,n]=[n,o]);const g=i?.get(t.get("assemblyName")),h=i?.get(e.assemblyName),u=t.get("refName"),m=e.refName,b=g?.getCanonicalRefName(u)||u,C=h?.getCanonicalRefName(m)||m,p=c[f],v=c[f+1],w=(0,a.eB)({self:p,refName:b,coord:n}),M=(0,a.eB)({self:p,refName:b,coord:o}),x=(0,a.eB)({self:v,refName:C,coord:r}),P=(0,a.eB)({self:v,refName:C,coord:d});if(void 0===w||void 0===M||void 0===x||void 0===P)continue;const y=t.get("CIGAR");l.push({p11:w,p12:M,p21:x,p22:P,f:t,cigar:s.MismatchParser.parseCigar(y)})}t.setFeatPositions(l)}),{fireImmediately:!0}))}},79610:(t,e,i)=>{i.d(e,{$2:()=>s,Eg:()=>c,WT:()=>r,f0:()=>f,mr:()=>a});var n=i(99546),o=i(30385);function a({feature:t,ctx:e,offsets:i,cb:o,height:a,drawCurves:r,oobLimit:f,viewWidth:c,hideTiny:l}){const{p11:d,p12:g,p21:h,p22:u}=t,m=d.offsetPx-i[0],b=g.offsetPx-i[0],C=h.offsetPx-i[1],p=u.offsetPx-i[1],v=Math.abs(b-m),w=Math.abs(p-C),M=a,x=(M-0)/2,P=Math.min(C,p),y=Math.max(C,p);(0,n.doesIntersect2)(P,y,-f,c+f)&&(v<=1&&w<=1?l||(e.beginPath(),e.moveTo(m,0),r?e.bezierCurveTo(m,x,C,x,C,M):e.lineTo(C,M),e.stroke()):(s(e,m,b,0,p,C,M,x,r),o(e)))}function s(t,e,i,n,o,a,s,r,f){f?function(t,e,i,n,o,a,s,r){const f=Math.abs(e-i),c=Math.abs(e-i);if(f<5&&c<5&&i<e&&Math.abs(e-o)>100){const t=e;e=i,i=t}t.beginPath(),t.moveTo(e,n),t.lineTo(i,n),t.bezierCurveTo(i,r,o,r,o,s),t.lineTo(a,s),t.bezierCurveTo(a,r,e,r,e,n),t.closePath(),t.fill()}(t,e,i,n,o,a,s,r):function(t,e,i,n,o,a,s){t.beginPath(),t.moveTo(e,n),t.lineTo(i,n),t.lineTo(o,s),t.lineTo(a,s),t.closePath(),t.fill()}(t,e,i,n,o,a,s)}function r(t,e){const i=e.clickMapCanvas,a=e.cigarClickMapCanvas;if(!i||!a)return;const s=i.getBoundingClientRect(),r=i.getContext("2d"),f=a.getContext("2d");if(!r||!f)return;const c=t.clientX-s.left,l=t.clientY-s.top,[d,g,h]=r.getImageData(c,l,1,1).data,u=Math.floor(o.xx/e.numFeats),m=(0,o.OX)(d,g,h,u),b=e.featPositions[m];if(b){const{f:t}=b;e.setClickId(t.id());const i=(0,n.getSession)(e);(0,n.isSessionModelWithWidgets)(i)&&i.showWidget(i.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:{feature1:t.toJSON(),feature2:t.get("mate")}}))}return b}function f(t,e,i){t.preventDefault();const n=e.clickMapCanvas,a=e.cigarClickMapCanvas;if(!n||!a)return;const s=n.getBoundingClientRect(),r=n.getContext("2d"),f=a.getContext("2d");if(!r||!f)return;const{clientX:c,clientY:l}=t,d=c-s.left,g=l-s.top,[h,u,m]=r.getImageData(d,g,1,1).data,b=Math.floor(o.xx/e.numFeats),C=(0,o.OX)(h,u,m,b),p=e.featPositions[C];p&&(e.setClickId(p.f.id()),i({clientX:c,clientY:l,feature:p}))}function c(t,e,i){const o=t.toJSON(),a=o.mate,s=o.end-o.start,r=a.end-a.start,f=o.identity,c=o.name,l=a.name;return[`Loc1: ${(0,n.assembleLocString)(o)}`,`Loc2: ${(0,n.assembleLocString)(a)}`,`Inverted: ${-1===o.strand}`,`Query len: ${s.toLocaleString("en-US")}`,`Target len: ${r.toLocaleString("en-US")}`,f?`Identity: ${f.toPrecision(2)}`:"",e?`CIGAR operator: ${e}${i}`:"",c?`Name 1: ${c}`:"",l?`Name 1: ${l}`:""].filter((t=>!!t)).join("<br/>")}},30385:(t,e,i)=>{i.d(e,{C4:()=>h,OX:()=>d,Ww:()=>g,xx:()=>s});var n=i(99546),o=i(79610),a=i(36422);const s=16581375;function r(t){return`rgb(${Math.floor(t/65025)%255},${Math.floor(t/255)%255},${t%255})`}const f={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,l=1600;function d(t,e,i,n){return Math.floor((255*t*255+255*e+i-1)/n)}function g(t,e,i){const d=(0,n.getContainingView)(t),g=(0,a.getParent)(t,4).level,h=d.drawCurves,u=d.drawCIGAR,{height:m,featPositions:b}=t,C=d.width,p=d.views.map((t=>t.bpPerPx));i&&(i.imageSmoothingEnabled=!1),e.beginPath();const v=d.views.map((t=>t.offsetPx)),w=Math.floor(s/b.length);e.fillStyle=f.M,e.strokeStyle=f.M;for(const{p11:t,p12:i,p21:n,p22:o}of b){const a=t.offsetPx-v[g],s=i.offsetPx-v[g],r=n.offsetPx-v[g+1],f=o.offsetPx-v[g+1],d=Math.abs(s-a),u=Math.abs(f-r),b=0,p=m,w=(p-b)/2;d<=c&&u<=c&&r<C+l&&r>-l&&(e.moveTo(a,b),h?e.bezierCurveTo(a,w,r,w,r,p):e.lineTo(r,p))}e.stroke(),e.fillStyle=f.M,e.strokeStyle=f.M;for(const{p11:t,p12:a,p21:w,p22:M,f:x,cigar:P}of b){const b=t.offsetPx-v[g],y=a.offsetPx-v[g],S=w.offsetPx-v[g+1],k=M.offsetPx-v[g+1],T=Math.abs(y-b),N=Math.abs(k-S),$=Math.min(S,k),I=Math.max(S,k),W=0,R=m,B=(R-W)/2;if(!(T<=c&&N<=c)&&(0,n.doesIntersect2)($,I,-l,d.width+l)){const t=x.get("strand"),n=-1===t?y:b,a=n<(-1===t?b:y)?1:-1,c=(S<k?1:-1)*t;let l=n,d=-1===t?k:S;if(P?.length&&u){let t=!1,n=0,u=0;const m=Math.floor(s/P.length);for(let s=0;s<P.length;s+=2){const b=s*m+1,v=+P[s],w=P[s+1];t||(n=l,u=d);const M=v/p[g],x=v/p[g+1];if("M"===w||"="===w||"X"===w?(l+=M*a,d+=x*c):"D"===w||"N"===w?l+=M*a:"I"===w&&(d+=x*c),!(Math.max(n,u,l,d)<0||Math.min(n,u,l,d)>C)){const a=s<P.length-2;Math.abs(l-n)<=1&&Math.abs(d-u)<=1&&a?t=!0:(t=!1,e.fillStyle=f[t&&M>1||x>1?w:"M"],(0,o.$2)(e,n,l,W,d,u,R,B,h),i&&(i.fillStyle=r(b),(0,o.$2)(i,n,l,W,d,u,R,B,h)))}}}else(0,o.$2)(e,b,y,W,k,S,R,B,h)}}const M=t.clickMapCanvas?.getContext("2d");if(M){M.imageSmoothingEnabled=!1,M.clearRect(0,0,C,m);for(let t=0;t<b.length;t++){const e=b[t],i=t*w+1;M.fillStyle=r(i),(0,o.mr)({cb:t=>t.fill(),feature:e,ctx:M,drawCurves:h,offsets:v,oobLimit:l,viewWidth:d.width,hideTiny:!0,height:m})}}}function h(t){const{clickId:e,mouseoverId:i}=t,a=(0,n.getContainingView)(t),s=a.drawCurves,r=t.height,f=a.width,c=t.mouseoverCanvas?.getContext("2d"),d=a.views.map((t=>t.offsetPx));if(!c)return;c.resetTransform(),c.scale(1,1),c.clearRect(0,0,f,r);const g=t.featMap[i||""];g&&(c.fillStyle="rgb(0,0,0,0.1)",(0,o.mr)({cb:t=>t.fill(),feature:g,ctx:c,oobLimit:l,viewWidth:a.width,drawCurves:s,offsets:d,height:r}));const h=t.featMap[e||""];h&&(c.strokeStyle="rgb(0, 0, 0, 0.9)",(0,o.mr)({cb:t=>t.stroke(),feature:h,ctx:c,oobLimit:l,viewWidth:a.width,drawCurves:s,offsets:d,height:r}))}}}]);
//# sourceMappingURL=8856.3ad94b1c.chunk.js.map