(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[2968],{8181:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var n=r(96234),a=r(33028),s=r(32723),i=r(34795),u=r(9249),c=r(87371),o=r(45754),f=r(13820),d=r(2646),l=r(23995),h=r(32145),p=r(93824),v=r(95802),g=r(7704),b=r(62598),m=r(99836),k=function(e){(0,o.Z)(r,e);var t=(0,f.Z)(r);function r(e,n,a){var s;(0,u.Z)(this,r),(s=t.call(this,e,n,a)).gff=void 0,s.dontRedispatch=void 0;var i=s.pluginManager,c=(0,m.readConfObject)(e,"gffGzLocation"),o=(0,m.readConfObject)(e,["index","indexType"]),f=(0,m.readConfObject)(e,["index","location"]),d=(0,m.readConfObject)(e,"dontRedispatch");s.dontRedispatch=d||["chromosome","contig","region"];var l=(0,h.openLocation)(f,i);return s.gff=new g.pC({filehandle:(0,h.openLocation)(c,i),csiFilehandle:"CSI"===o?l:void 0,tbiFilehandle:"CSI"!==o?l:void 0,chunkCacheSize:50*Math.pow(2,20),renameRefSeqs:function(e){return e}}),s}return(0,c.Z)(r,[{key:"getRefNames",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(){var t,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.abrupt("return",this.gff.getReferenceSequenceNames(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.gff.getHeader());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,p.ObservableCreate)(function(){var n=(0,i.Z)((0,s.Z)().mark((function n(a){var i;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.gff.getMetadata();case 2:return i=n.sent,n.next=5,t.getFeaturesHelper(e,r,i,a,!0);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),r.signal)}},{key:"getFeaturesHelper",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t){var r,n,i,u,c,o,f,d,h,p=this,v=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=v.length>1&&void 0!==v[1]?v[1]:{},n=v.length>2?v[2]:void 0,i=v.length>3?v[3]:void 0,u=v.length>4?v[4]:void 0,c=v.length>5&&void 0!==v[5]?v[5]:t,e.prev=5,o=[],e.next=9,this.gff.getLines(t.refName,t.start,t.end,(function(e,t){o.push(p.parseLine(n.columnNumbers,e,t))}));case 9:if(!u||!o.length){e.next=17;break}if(f=1/0,d=-1/0,o.forEach((function(e){var t=e.fields[2];if(!p.dontRedispatch.includes(t)){var r=e.start-1;r<f&&(f=r),e.end>d&&(d=e.end)}})),!(d>t.end||f<t.start)){e.next=17;break}return e.next=16,this.getFeaturesHelper((0,a.Z)((0,a.Z)({},t),{},{start:f,end:d}),r,n,i,!1,t);case 16:return e.abrupt("return");case 17:h=o.map((function(e){return e.fields[8]&&"."!==e.fields[8]?e.fields[8].includes("_lineHash")||(e.fields[8]+=";_lineHash=".concat(e.lineHash)):e.fields[8]="_lineHash=".concat(e.lineHash),e.fields.join("\t")})).join("\n"),b.Z.parseStringSync(h,{parseFeatures:!0,parseComments:!1,parseDirectives:!1,parseSequences:!1,disableDerivesFromReferences:!0}).forEach((function(e){return p.formatFeatures(e).forEach((function(e){(0,l.qY)(e.get("start"),e.get("end"),c.start,c.end)&&"region"!==e.get("type")&&i.next(e)}))})),i.complete(),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(5),i.error(e.t0);case 26:case"end":return e.stop()}}),e,this,[[5,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseLine",value:function(e,t,r){var n=t.split("\t");return{start:+n[e.start-1],end:+n[e.end-1],lineHash:r,fields:n}}},{key:"formatFeatures",value:function(e){var t=this;return e.map((function(e){return new v.SimpleFeature({data:t.featureData(e),id:"".concat(t.id,"-offset-").concat(e.attributes._lineHash[0])})}))}},{key:"featureData",value:function(e){var t=this,r=(0,a.Z)({},e);r.start-=1,"+"===e.strand?r.strand=1:"-"===e.strand?r.strand=-1:"."===e.strand?r.strand=0:r.strand=void 0,r.phase=Number(e.phase),r.refName=e.seq_id,null===e.score&&delete r.score,null===e.phase&&delete r.score;for(var s=new Set(["start","end","seq_id","score","type","source","phase","strand"]),i=e.attributes||{},u=0,c=Object.keys(i);u<c.length;u++){var o=c[u],f=o.toLowerCase();if(s.has(f)&&(f+="2"),null!==i[o]){var d=i[o];if(Array.isArray(d)&&1===d.length){var l=d;d=(0,n.Z)(l,1)[0]}r[f]=d}}return r.refName=r.seq_id,e.child_features&&e.child_features.length>0&&(r.subfeatures=e.child_features.flatMap((function(e){return e.map((function(e){return t.featureData(e)}))}))),delete r.child_features,delete r.data,delete r._linehash,delete r.attributes,delete r.seq_id,r}},{key:"freeResources",value:function(){}}]),r}(d.BaseFeatureDataAdapter)},74854:function(){},66602:function(){}}]);
//# sourceMappingURL=2968.7a5c0ead.chunk.js.map