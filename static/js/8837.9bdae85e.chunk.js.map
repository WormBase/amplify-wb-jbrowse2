{"version":3,"file":"static/js/8837.9bdae85e.chunk.js","mappings":"sMAcA,SAASA,EAAYC,GACnB,MAAMC,EAAWD,EAAIE,MAAMF,EAAIG,YAAY,KAAO,GAClD,OAAOF,EAASC,MAAM,EAAGD,EAASE,YAAY,KAChD,CAQe,MAAMC,UAA2BC,EAAAA,uBAO9C,iBAAaC,GAAwC,IAADC,EAClD,MAAMC,EAAgBC,KAAKD,cAC3B,IAAKA,EACH,MAAM,IAAIE,MAAM,8BAElB,IAAIC,EAAWF,KAAKG,QAAQ,eAC5B,GAAa,QAATL,EAACI,SAAQ,IAAAJ,IAARA,EAAUM,OAAQ,CAErBF,EADgBF,KAAKG,QAAQ,WACVE,KAAIC,IAAK,CAC1BC,KAAM,gBACNC,OAAQlB,EAAYgB,GACpBG,eAAgB,CACdlB,IAAKe,MAGX,CAEA,OAAOI,QAAQC,IAEbT,EAASG,KAAIO,UACX,MAAMC,SAAqBd,EAAce,IACtCD,YACH,MAAO,CACLL,OAAQM,EAAKC,MAAQF,EAAYG,MAC9BF,EACHD,cACD,IAGP,CAGA,iBAAaI,CAAYC,GACvB,MAAMC,QAAiBnB,KAAKH,cACtBuB,QAAiBV,QAAQC,IAC7BQ,EAASd,KAAIgB,GAAKA,EAAER,YAAYI,YAAYC,MAE9C,MAAO,IAAI,IAAII,IAAIF,EAASG,QAC9B,CAEA,oBAAaC,CAAeN,GAC1B,MAAMC,QAAiBnB,KAAKH,cACtB4B,SACEf,QAAQC,IAEZQ,EAASd,KAAIqB,IAAG,IAAAC,EAAAC,EAAA,OAAkC,QAAlCD,GAAIC,EAAAF,EAAIb,aAAYW,sBAAc,IAAAG,OAAA,EAA9BA,EAAAE,KAAAD,EAAiCV,EAAK,MAE5DY,QAAOC,KAAOA,IAGhB,MAAO,CAAEC,UAFQC,EAAAA,EAAAA,KAAIR,EAAMpB,KAAI6B,GAAKA,EAAEF,YAEnBG,UADFC,EAAAA,EAAAA,KAAIX,EAAMpB,KAAI6B,GAAKA,EAAEC,YAExC,CAEOE,WAAAA,CAAYC,GAA2C,IAA3BpB,EAAmBqB,UAAAnC,OAAA,QAAAoC,IAAAD,UAAA,GAAAA,UAAA,GAAG,CAAC,EACxD,OAAOE,EAAAA,EAAAA,mBAA0B7B,UAC/B,MAAMO,QAAiBnB,KAAKH,eAC5B6C,EAAAA,EAAAA,MACKvB,EAASd,KAAIqB,GACdA,EAAIb,YAAYwB,YAAYC,EAAQpB,GAAMyB,MACxCtC,EAAAA,EAAAA,IAAIuC,GAEFA,EAAEC,IAAI,UACFD,EACA,IAAIE,EAAAA,cAAc,IACbF,EAAEG,SACLC,SAAS,GAADC,OAAKvB,EAAIlB,OAAM,KAAAyC,OAAIL,EAAE5B,MAC7BR,OAAQkB,EAAIlB,eAKxB0C,UAAUC,EAAS,GACpBjC,EAAKkC,OACV,CAGA,uCAAMC,CAAkCC,GACtC,MAAO,CAAEC,eAAgB,EAC3B,CAIA,gBAAMC,GAEJ,aADuBxD,KAAKH,eACZQ,KAAIoD,IAAA,IAAC,YAAE5C,EAAW,OAAEL,EAAM,KAAEO,KAAS2C,GAAMD,EAAA,MAAM,CAC/D1C,KAAMP,EACNmD,OAAQ5C,KACL2C,EACJ,GACH,CAEOE,aAAAA,GAAuB,EAlGXjE,EACLkE,aAAe,CAC3B,gBACA,gBACA,iB","sources":["../../../plugins/wiggle/src/MultiWiggleAdapter/MultiWiggleAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature, min, max } from '@jbrowse/core/util'\nimport { merge } from 'rxjs'\nimport { map } from 'rxjs/operators'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nfunction getFilename(uri: string) {\n  const filename = uri.slice(uri.lastIndexOf('/') + 1)\n  return filename.slice(0, filename.lastIndexOf('.'))\n}\n\ninterface AdapterEntry {\n  dataAdapter: BaseFeatureDataAdapter\n  source: string\n  [key: string]: unknown\n}\n\nexport default class MultiWiggleAdapter extends BaseFeatureDataAdapter {\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  public async getAdapters(): Promise<AdapterEntry[]> {\n    const getSubAdapter = this.getSubAdapter\n    if (!getSubAdapter) {\n      throw new Error('no getSubAdapter available')\n    }\n    let subConfs = this.getConf('subadapters')\n    if (!subConfs?.length) {\n      const entries = this.getConf('bigWigs') as string[]\n      subConfs = entries.map(entry => ({\n        type: 'BigWigAdapter',\n        source: getFilename(entry),\n        bigWigLocation: {\n          uri: entry,\n        },\n      }))\n    }\n\n    return Promise.all(\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      subConfs.map(async (conf: any) => {\n        const dataAdapter = (await getSubAdapter(conf))\n          .dataAdapter as BaseFeatureDataAdapter\n        return {\n          source: conf.name || dataAdapter.id,\n          ...conf,\n          dataAdapter,\n        }\n      }),\n    )\n  }\n\n  // note: can't really have dis-agreeing refNames\n  public async getRefNames(opts?: BaseOptions) {\n    const adapters = await this.getAdapters()\n    const allNames = await Promise.all(\n      adapters.map(a => a.dataAdapter.getRefNames(opts)),\n    )\n    return [...new Set(allNames.flat())]\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const adapters = await this.getAdapters()\n    const stats = (\n      await Promise.all(\n        // @ts-expect-error\n        adapters.map(adp => adp.dataAdapter.getGlobalStats?.(opts)),\n      )\n    ).filter(f => !!f)\n    const scoreMin = min(stats.map(s => s.scoreMin))\n    const scoreMax = max(stats.map(s => s.scoreMax))\n    return { scoreMin, scoreMax }\n  }\n\n  public getFeatures(region: Region, opts: WiggleOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const adapters = await this.getAdapters()\n      merge(\n        ...adapters.map(adp =>\n          adp.dataAdapter.getFeatures(region, opts).pipe(\n            map(p =>\n              // add source field if it does not exist\n              p.get('source')\n                ? p\n                : new SimpleFeature({\n                    ...p.toJSON(),\n                    uniqueId: `${adp.source}-${p.id()}`,\n                    source: adp.source,\n                  }),\n            ),\n          ),\n        ),\n      ).subscribe(observer)\n    }, opts.signal)\n  }\n\n  // always render bigwig instead of calculating a feature density for it\n  async getMultiRegionFeatureDensityStats(_regions: Region[]) {\n    return { featureDensity: 0 }\n  }\n\n  // in another adapter type, this could be dynamic depending on region or\n  // something, but it is static for this particular multi-wiggle adapter type\n  async getSources() {\n    const adapters = await this.getAdapters()\n    return adapters.map(({ dataAdapter, source, name, ...rest }) => ({\n      name: source,\n      __name: name,\n      ...rest,\n    }))\n  }\n\n  public freeResources(): void {}\n}\n"],"names":["getFilename","uri","filename","slice","lastIndexOf","MultiWiggleAdapter","BaseFeatureDataAdapter","getAdapters","_subConfs","getSubAdapter","this","Error","subConfs","getConf","length","map","entry","type","source","bigWigLocation","Promise","all","async","dataAdapter","conf","name","id","getRefNames","opts","adapters","allNames","a","Set","flat","getGlobalStats","stats","adp","_adp$dataAdapter$getG","_adp$dataAdapter","call","filter","f","scoreMin","min","s","scoreMax","max","getFeatures","region","arguments","undefined","ObservableCreate","merge","pipe","p","get","SimpleFeature","toJSON","uniqueId","concat","subscribe","observer","signal","getMultiRegionFeatureDensityStats","_regions","featureDensity","getSources","_ref","rest","__name","freeResources","capabilities"],"sourceRoot":""}