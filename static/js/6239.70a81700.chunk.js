"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6239],{70833:function(t,e,r){r.d(e,{EU:function(){return o},z8:function(){return d},Bf:function(){return h},zv:function(){return u}});var n=r(27664);function a(t){var e=t.feature,r=t.ctx,a=t.offsets,o=t.cb,s=t.height,f=t.drawCurves,c=t.oobLimit,l=t.viewWidth,u=t.hideTiny,h=e.p11,d=e.p12,v=e.p21,p=e.p22,x=h.offsetPx-a[0],m=d.offsetPx-a[0],g=v.offsetPx-a[1],w=p.offsetPx-a[1],b=Math.abs(m-x),M=Math.abs(w-g),k=s,y=(k-0)/2,P=Math.min(g,w),S=Math.max(g,w);(0,n.doesIntersect2)(P,S,-c,l+c)&&(b<=1&&M<=1?u||(r.beginPath(),r.moveTo(x,0),f?r.bezierCurveTo(x,y,g,y,g,k):r.lineTo(g,k),r.stroke()):(i(r,x,m,0,w,g,k,y,f),o(r)))}function i(t,e,r,n,a,i,o,s,f){f?function(t,e,r,n,a,i,o,s){var f=Math.abs(e-r),c=Math.abs(e-r);if(f<5&&c<5&&r<e&&Math.abs(e-a)>100){var l=e;e=r,r=l}t.beginPath(),t.moveTo(e,n),t.lineTo(r,n),t.bezierCurveTo(r,s,a,s,a,o),t.lineTo(i,o),t.bezierCurveTo(i,s,e,s,e,n),t.closePath(),t.fill()}(t,e,r,n,a,i,o,s):function(t,e,r,n,a,i,o){t.beginPath(),t.moveTo(e,n),t.lineTo(r,n),t.lineTo(a,o),t.lineTo(i,o),t.closePath(),t.fill()}(t,e,r,n,a,i,o)}var o=16581375;function s(t){var e=Math.floor(t/65025)%255,r=Math.floor(t/255)%255,n=t%255;return"rgb(".concat(e,",").concat(r,",").concat(n,")")}var f={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,l=1600;function u(t,e,r,n){return Math.floor((255*t*255+255*e+r-1)/n)}function h(t,e,r){var u,h=(0,n.getContainingView)(t),d=h.drawCurves,v=h.drawCIGAR,p=h.middleComparativeHeight,x=h.width,m=h.views.map((function(t){return t.bpPerPx}));r&&(r.imageSmoothingEnabled=!1),e.beginPath();var g=t.featPositions,w=h.views.map((function(t){return t.offsetPx})),b=Math.floor(o/g.length);e.fillStyle=f.M,e.strokeStyle=f.M;for(var M=0;M<g.length;M++){var k=g[M],y=k.p11,P=k.p12,S=k.p21,T=k.p22,j=y.offsetPx-w[0],C=P.offsetPx-w[0],Z=S.offsetPx-w[1],z=T.offsetPx-w[1],L=Math.abs(C-j),H=Math.abs(z-Z),R=p,I=(R-0)/2;L<=c&&H<=c&&Z<x+l&&Z>-l&&(e.moveTo(j,0),d?e.bezierCurveTo(j,I,Z,I,Z,R):e.lineTo(Z,R))}e.stroke(),e.fillStyle=f.M,e.strokeStyle=f.M;for(var N=0;N<g.length;N++){var B=g[N],W=B.p11,D=B.p12,E=B.p21,G=B.p22,_=B.f,A=B.cigar,U=W.offsetPx-w[0],V=D.offsetPx-w[0],X=E.offsetPx-w[1],J=G.offsetPx-w[1],O=Math.abs(V-U),F=Math.abs(J-X),Y=Math.min(X,J),q=Math.max(X,J),K=p,Q=(K-0)/2;if(!(O<=c&&F<=c)&&(0,n.doesIntersect2)(Y,q,-l,h.width+l)){var $=_.get("strand"),tt=-1===$?V:U,et=tt<(-1===$?U:V)?1:-1,rt=(X<J?1:-1)*$,nt=tt,at=-1===$?J:X;if(null!==A&&void 0!==A&&A.length&&v)for(var it=!1,ot=0,st=0,ft=Math.floor(o/A.length),ct=0;ct<A.length;ct+=2){var lt=ct*ft+1,ut=+A[ct],ht=A[ct+1];it||(ot=nt,st=at);var dt=ut/m[0],vt=ut/m[1];if("M"===ht||"="===ht||"X"===ht?(nt+=dt*et,at+=vt*rt):"D"===ht||"N"===ht?nt+=dt*et:"I"===ht&&(at+=vt*rt),!(Math.max(ot,st,nt,at)<0||Math.min(ot,st,nt,at)>x)){var pt=ct<A.length-2;Math.abs(nt-ot)<=1&&Math.abs(at-st)<=1&&pt?it=!0:(it=!1,e.fillStyle=f[it&&dt>1||vt>1?ht:"M"],i(e,ot,nt,0,at,st,K,Q,d),r&&(r.fillStyle=s(lt),i(r,ot,nt,0,at,st,K,Q,d)))}}else i(e,U,V,0,J,X,K,Q,d)}}var xt=null===(u=t.clickMapCanvas)||void 0===u?void 0:u.getContext("2d");if(xt){xt.imageSmoothingEnabled=!1,xt.clearRect(0,0,x,p);for(var mt=0;mt<g.length;mt++){var gt=g[mt],wt=mt*b+1;xt.fillStyle=s(wt),a({cb:function(t){return t.fill()},feature:gt,ctx:xt,drawCurves:d,offsets:w,oobLimit:l,viewWidth:h.width,hideTiny:!0,height:p})}}}function d(t){var e,r=t.clickId,i=t.mouseoverId,o=(0,n.getContainingView)(t),s=o.drawCurves,f=o.middleComparativeHeight,c=o.width,u=null===(e=t.mouseoverCanvas)||void 0===e?void 0:e.getContext("2d"),h=o.views.map((function(t){return t.offsetPx}));if(u){u.resetTransform(),u.scale(1,1),u.clearRect(0,0,c,f);var d=t.featMap[i||""];d&&(u.fillStyle="rgb(0,0,0,0.1)",a({cb:function(t){return t.fill()},feature:d,ctx:u,oobLimit:l,viewWidth:o.width,drawCurves:s,offsets:h,height:f}));var v=t.featMap[r||""];v&&(u.strokeStyle="rgb(0, 0, 0, 0.9)",a({cb:function(t){return t.stroke()},feature:v,ctx:u,oobLimit:l,viewWidth:o.width,drawCurves:s,offsets:h,height:f}))}}},6239:function(t,e,r){r.r(e),r.d(e,{renderToSvg:function(){return m}});var n=r(32723),a=r(33028),i=r(34795),o=(r(96902),r(93751)),s=r(30908),f=r(75717),c=r(27664),l=r(16151),u=r(17867),h=r(50209),d=r(88636),v=r(29938);function p(t){var e=t.width,r=t.height,n=t.shift,a=(0,d.Z)();return(0,v.jsx)("rect",{width:e+2*n,height:r,fill:(0,c.stripAlpha)(a.palette.background.default)})}var x=r(70833);function m(t,e){return g.apply(this,arguments)}function g(){return g=(0,i.Z)((0,n.Z)().mark((function t(e,r){var d,m,g,w,b,M,k,y,P,S,T,j,C,Z,z,L,H,R,I,N,B,W,D,E,G,_,A,U,V,X,J;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,f.when)((function(){return e.initialized}));case 2:return m=r.textHeight,g=void 0===m?18:m,w=r.headerHeight,b=void 0===w?30:w,M=r.rulerHeight,k=void 0===M?30:M,y=r.fontSize,P=void 0===y?13:y,S=r.trackLabels,T=void 0===S?"offset":S,j=r.Wrapper,C=void 0===j?function(t){var e=t.children;return(0,v.jsx)(v.Fragment,{children:e})}:j,Z=r.themeName,z=void 0===Z?"default":Z,L=(0,c.getSession)(e),H=null===(d=L.allThemes)||void 0===d?void 0:d.call(L)[z],R=e.width,I=e.views,N=e.middleComparativeHeight,B=e.tracks,W=50,D=b+k,E=I.map((function(t){return(0,h.hY)(t.tracks,g,T)+D})),G=(0,c.sum)(E)+N+100,t.next=12,Promise.all(I.map(function(){var t=(0,i.Z)((0,n.Z)().mark((function t(e){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,Promise.all(e.tracks.map(function(){var t=(0,i.Z)((0,n.Z)().mark((function t(e){var i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.displays[0],t.next=3,(0,f.when)((function(){return void 0===i.ready||i.ready}));case 3:return t.t0=e,t.next=6,i.renderSvg((0,a.Z)((0,a.Z)({},r),{},{theme:H}));case 6:return t.t1=t.sent,t.abrupt("return",{track:t.t0,result:t.t1});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:return t.t1=t.sent,t.abrupt("return",{view:t.t0,data:t.t1});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 12:return _=t.sent,t.next=15,Promise.all(B.map(function(){var t=(0,i.Z)((0,n.Z)().mark((function t(e){var i,o;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.displays[0],t.next=3,(0,f.when)((function(){return void 0===i.ready||i.ready}));case 3:return t.next=5,(0,c.renderToAbstractCanvas)(R,N,{exportSVG:r},(function(t){return(0,x.Bf)(i,t)}));case 5:if(!("imageData"in(o=t.sent))){t.next=10;break}throw new Error("found a canvas in svg export, probably a bug");case 10:if(!("canvasRecordedData"in o)){t.next=17;break}return t.next=13,(0,c.getSerializedSvg)((0,a.Z)((0,a.Z)({},o),{},{width:R,height:N}));case 13:return t.t0=t.sent,t.abrupt("return",{html:t.t0});case 17:return t.abrupt("return",o);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 15:return A=t.sent,U=(0,c.max)(I.flatMap((function(t){return t.tracks.map((function(t){return(0,c.measureText)((0,l.getTrackName)(t.configuration,L),P)}))})),0)+40,X=R+(V="left"===T?U:0),J=(0,u.createJBrowseTheme)(H),t.abrupt("return",(0,s.renderToStaticMarkup)((0,v.jsx)(o.Z,{theme:(0,u.createJBrowseTheme)(H),children:(0,v.jsx)(C,{children:(0,v.jsxs)("svg",{width:R,height:G,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,X+2*W,G].toString(),children:[(0,v.jsx)(p,{width:X,height:G,shift:W}),(0,v.jsxs)("g",{transform:"translate(".concat(W," ").concat(P,")"),children:[(0,v.jsxs)("g",{transform:"translate(".concat(V,")"),children:[(0,v.jsx)("text",{x:0,fontSize:P,fill:J.palette.text.primary,children:I[0].assemblyNames.join(", ")}),(0,v.jsx)(h.Uc,{model:_[0].view,fontSize:P})]}),(0,v.jsx)(h.Ge,{textHeight:g,trackLabels:T,fontSize:P,model:_[0].view,displayResults:_[0].data,offset:D,trackLabelOffset:V})]}),(0,v.jsx)("defs",{children:(0,v.jsx)("clipPath",{id:"synclip",children:(0,v.jsx)("rect",{x:0,y:0,width:R,height:N})})}),(0,v.jsx)("g",{transform:"translate(".concat(W+V," ").concat(P+E[0],")"),clipPath:"url(#synclip)",children:A.map((function(t,e){return(0,v.jsx)(c.ReactRendering,{rendering:t},e)}))}),(0,v.jsxs)("g",{transform:"translate(".concat(W," ").concat(P+E[0]+N,")"),children:[(0,v.jsxs)("g",{transform:"translate(".concat(V,")"),children:[(0,v.jsx)("text",{x:0,fontSize:P,fill:J.palette.text.primary,children:I[1].assemblyNames.join(", ")}),(0,v.jsx)(h.Uc,{model:_[1].view,fontSize:P})]}),(0,v.jsx)(h.Ge,{textHeight:g,trackLabels:T,fontSize:P,model:_[1].view,displayResults:_[1].data,offset:D,trackLabelOffset:V})]})]})})})));case 21:case"end":return t.stop()}}),t)}))),g.apply(this,arguments)}}}]);
//# sourceMappingURL=6239.70a81700.chunk.js.map