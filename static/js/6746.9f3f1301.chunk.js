"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6746,6999],{66999:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n(7552),o=n(99546),s=n(373),l=n(68446);const a="rgb(220,220,180)",c="rgba(250,200,200)";function d({str:e,width:t,showCoordinates:n,currRemainder:r=0,splitSize:o=10}){const s=Math.ceil(e.length/t),l=new Array(s);let a=r%10,c=0,d=0;for(;c<s+1;++c){const s=0===c?t-r:t,m=e.slice(d,d+s);if(!m)break;if(n){let e="";for(let t=0,n=a;t<m.length;t++,n++)n%o==0&&(e+=" ",n=0),e+=m[t];e&&(l[c]=e)}else l[c]=m;a=0,d+=s}return{segments:l,remainder:((l.at(-1)?.replaceAll(" ","").length||0)+(c<2?r:0))%t}}const m=(0,l.observer)((function({chunks:e,start:t,color:n,coordStart:o=t,coordMultiplier:s=1,model:l}){const{width:a,showCoordinates:c}=l;return e.map(((l,d)=>{const m=0==d&&t%a==0||d>0?(""+(o-t%100+d*a*s)).padStart(4)+"   ":"",i=d===e.length-1&&(e.at(-1)?.replaceAll(" ","").length||0)+(0===d?t%100:0)!==a?null:c?" \n":"";return r.createElement(r.Fragment,{key:`${l}-${d}`},c?m:null,r.createElement("span",{style:{background:n}},l),i)}))})),i=(0,l.observer)((function({utr:e,cds:t,exons:n,sequence:o,upstream:s,downstream:l,includeIntrons:i,collapseIntron:u,model:h}){const{upperCaseCDS:g,intronBp:p,width:w,showCoordinates:f}=h,E=t.length>0,C=(t.length?[...t,...e].sort(((e,t)=>e.start-t.start)):n).filter((e=>e.start!==e.end)),b=e=>g?e.toLowerCase():e,k=e=>g?e.toUpperCase():e;let q=0,v=0,y=0,S=null;if(s){const{segments:e,remainder:t}=d({str:b(s),width:w,showCoordinates:f});y=t,S=r.createElement(m,{model:h,color:c,start:v,coordStart:q,chunks:e}),v+=s.length,q+=s.length}const _=[];for(let e=0;e<C.length;e++){const t=C[e],n=o.slice(t.end,C[e+1]?.start),s=o.slice(t.start,t.end),{segments:l,remainder:c}=d({str:E?"CDS"===t.type?k(s):b(s):k(s),width:w,currRemainder:y,showCoordinates:f});if(y=c,_.push(r.createElement(m,{key:JSON.stringify(t)+"-mid",model:h,color:"CDS"===t.type?a:"rgb(200,240,240)",start:v,coordStart:q,chunks:l})),v+=s.length,q+=s.length,n&&i&&e<C.length-1){const e=b(u&&n.length>2*p?`${n.slice(0,p)}...${n.slice(-p)}`:n),{segments:o,remainder:s}=d({str:e,width:w,currRemainder:y,showCoordinates:f});o.length&&(y=s,_.push(r.createElement(m,{key:JSON.stringify(t)+"-intron",model:h,coordStart:q,start:v,chunks:o})),v+=e.length,q+=e.length)}}let A=null;if(l){const{segments:e,remainder:t}=d({str:b(l),width:w,currRemainder:y,showCoordinates:f});A=r.createElement(m,{start:v,model:h,chunks:e,coordStart:q,color:c}),y=t,v+=l.length,q+=l.length}return r.createElement(r.Fragment,null,S,_,A)})),u=(0,l.observer)((function({cds:e,sequence:t,codonTable:n,model:o}){const{width:l,showCoordinates:a}=o,c=(0,s.o9)(e,t);let i="";for(let e=0;e<c.length;e+=3)i+=n[c.slice(e,e+3)]||"&";const{segments:u}=d({str:i,width:l,showCoordinates:a});return r.createElement(m,{model:o,color:"rgb(220,160,220)",chunks:u,start:0})})),h=(0,l.observer)((function({sequence:e,upstream:t,downstream:n,model:o}){const{width:s,showCoordinates:l}=o;let a=0,i=null,u=0;if(t){const{segments:e,remainder:n}=d({str:t,width:s,showCoordinates:l});u=n,i=r.createElement(m,{model:o,color:c,start:a,chunks:e}),a+=t.length}const{segments:h,remainder:g}=d({str:e,width:s,showCoordinates:l,currRemainder:u});u=g;const p=r.createElement(m,{model:o,color:"rgb(200,280,200)",start:a,chunks:h});a+=e.length;let w=null;if(n){const{segments:e,remainder:t}=d({str:n,width:s,currRemainder:u,showCoordinates:l});w=r.createElement(m,{start:a,model:o,chunks:e,color:c}),u=t,a+=n.length}return r.createElement(r.Fragment,null,i,p,w)})),g=(0,l.observer)((function({cds:e,sequence:t,model:n}){const{width:o,showCoordinates:l}=n,{segments:c}=d({str:(0,s.o9)(e,t),width:o,showCoordinates:l});return r.createElement(m,{model:n,color:a,chunks:c,start:0})}));function p({children:e}){return r.createElement("pre",{style:{fontFamily:"monospace",color:"black",fontSize:11}},e)}function w({children:e}){return r.createElement("div",{style:{fontFamily:"monospace",color:"black",fontSize:11,maxWidth:600,whiteSpace:"wrap",wordBreak:"break-all"}},e)}const f=(0,l.observer)(r.forwardRef((function(e,t){const{model:n,feature:l,mode:a}=e,{showCoordinates:c}=n;let{sequence:{seq:d,upstream:m="",downstream:f=""}}=e;const{subfeatures:E=[]}=l,C=E.sort(((e,t)=>e.start-t.start)).map((e=>({...e,start:e.start-l.start,end:e.end-l.start})));let b=(0,s.Qq)(C.filter((e=>"CDS"===e.type))),k=(0,s.Qq)(C.filter((e=>e.type?.match(/utr/i)))),q=(0,s.Qq)(C.filter((e=>"exon"===e.type)));!k.length&&b.length&&q.length&&(k=(0,s.h8)(b,q)),k.length||!b.length||q.length||(k=(0,s.V4)(b,{start:0,end:l.end-l.start,type:"gene"})),-1===l.strand&&([d,m,f]=[(0,o.revcom)(d),(0,o.revcom)(f),(0,o.revcom)(m)],b=(0,s.YC)(b,d.length),q=(0,s.YC)(q,d.length),k=(0,s.YC)(k,d.length));const v=(0,o.generateCodonTable)(o.defaultCodonTable),y=c?p:w;return r.createElement("div",{"data-testid":"sequence_panel",ref:t,style:{maxHeight:300,overflow:"auto"}},r.createElement(y,null,r.createElement("div",{style:{background:"white"}},`>${[(l.name||l.id)+"-"+a,`${l.refName}:${l.start+1}-${l.end}(${S=l.strand,-1===S?"-":1===S?"+":"."})`,a.endsWith("updownstream")?`+/- ${n.upDownBp} up/downstream bp`:""].filter((e=>!!e)).join(" ")}\n`),"genomic"===a?r.createElement(h,{model:n,sequence:d}):"genomic_sequence_updownstream"===a?r.createElement(h,{model:n,sequence:d,upstream:m,downstream:f}):"cds"===a?r.createElement(g,{model:n,cds:b,sequence:d}):"cdna"===a?r.createElement(i,{model:n,exons:q,cds:b,utr:k,sequence:d}):"protein"===a?r.createElement(u,{model:n,cds:b,codonTable:v,sequence:d}):"gene"===a?r.createElement(i,{model:n,exons:q,cds:b,utr:k,sequence:d,includeIntrons:!0}):"gene_collapsed_intron"===a?r.createElement(i,{model:n,exons:q,cds:b,sequence:d,utr:k,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===a?r.createElement(i,{model:n,exons:q,cds:b,sequence:d,utr:k,upstream:m,downstream:f,includeIntrons:!0}):"gene_updownstream_collapsed_intron"===a?r.createElement(i,{model:n,exons:q,cds:b,sequence:d,utr:k,upstream:m,downstream:f,includeIntrons:!0,collapseIntron:!0}):r.createElement("div",null,"Unknown type")));var S})))},76746:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var r=n(7552),o=n(29499),s=n(36715),l=n(5401),a=n(58507),c=n(49823),d=n(75785),m=n(68446),i=n(78781),u=n(66999),h=n(54579),g=n(14465);const p=(0,d.n9)()({dialogContent:{width:"80em"},formControl:{margin:0,marginLeft:4}}),w=(0,m.observer)((function({handleClose:e,model:t,feature:n}){const{sequenceFeatureDetails:d}=t,{upDownBp:m}=d,{classes:w}=p(),f=(0,r.useRef)(null),[E,C]=(0,r.useState)(!1),{sequence:b,error:k}=(0,i.p)(t,n,m,E),[q,v]=(0,r.useState)("cds");return r.createElement(c.Dialog,{maxWidth:"xl",open:!0,onClose:()=>e(),title:"Sequence view"},r.createElement(o.A,{className:w.dialogContent},r.createElement("div",null,r.createElement(g.A,{mode:q,setMode:v,feature:n,model:d}),r.createElement(h.A,{ref:f,model:d})),r.createElement("div",null,"gene"===n.type?r.createElement(s.A,null,"Note: inspect subfeature sequences for protein/CDS computations"):null,k?r.createElement(c.ErrorMessage,{error:k}):b?b?"error"in b?r.createElement(r.Fragment,null,r.createElement(s.A,{color:"error"},b.error),r.createElement(l.A,{variant:"contained",color:"inherit",onClick:()=>C(!0)},"Force load")):r.createElement(r.Suspense,{fallback:r.createElement(c.LoadingEllipses,null)},r.createElement(u.default,{ref:f,feature:n,mode:q,sequence:b,model:d})):r.createElement(s.A,null,"No sequence found"):r.createElement(c.LoadingEllipses,null))),r.createElement(a.A,null,r.createElement(l.A,{onClick:()=>e(),variant:"contained"},"Close")))}))}}]);
//# sourceMappingURL=6746.9f3f1301.chunk.js.map