{"version":3,"file":"static/js/6556.2c96d666.chunk.js","mappings":"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","sources":["../../../plugins/gccontent/src/GCContentAdapter/GCContentAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { firstValueFrom } from 'rxjs'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature, Region } from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\n\nexport default class extends BaseFeatureDataAdapter {\n  private windowSize = 1000\n\n  private windowDelta = 1000\n\n  private gcMode = 'content'\n\n  public static capabilities = ['hasLocalStats']\n\n  public async configure() {\n    const adapter = await this.getSubAdapter?.(this.getConf('sequenceAdapter'))\n    if (!adapter) {\n      throw new Error('Error getting subadapter')\n    }\n    return adapter.dataAdapter as BaseFeatureDataAdapter\n  }\n\n  public async getRefNames() {\n    const adapter = await this.configure()\n    return adapter.getRefNames()\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions) {\n    return ObservableCreate<Feature>(async observer => {\n      const sequenceAdapter = await this.configure()\n      const hw = this.windowSize === 1 ? 1 : this.windowSize / 2 // Half the window size\n      const f = this.windowSize === 1\n\n      let { start: queryStart, end: queryEnd } = query\n      queryStart = Math.max(0, queryStart - hw)\n      queryEnd += hw\n\n      if (queryEnd < 0 || queryStart > queryEnd) {\n        observer.complete()\n        return\n      }\n\n      const ret = sequenceAdapter.getFeatures(\n        {\n          ...query,\n          start: queryStart,\n          end: queryEnd,\n        },\n        opts,\n      )\n      const feats = await firstValueFrom(ret.pipe(toArray()))\n      const residues = feats[0]?.get('seq') || ''\n\n      for (let i = hw; i < residues.length - hw; i += this.windowDelta) {\n        const r = f ? residues[i] : residues.slice(i - hw, i + hw)\n        let nc = 0\n        let ng = 0\n        let len = 0\n        for (const letter of r) {\n          if (letter === 'c' || letter === 'C') {\n            nc++\n          } else if (letter === 'g' || letter === 'G') {\n            ng++\n          }\n          if (letter !== 'N') {\n            len++\n          }\n        }\n        const pos = queryStart\n        let score\n        if (this.gcMode === 'content') {\n          score = (ng + nc) / (len || 1)\n        } else if (this.gcMode === 'skew') {\n          score = (ng - nc) / (ng + nc || 1)\n        }\n\n        observer.next(\n          new SimpleFeature({\n            uniqueId: `${this.id}_${pos + i}`,\n            start: pos + i,\n            end: pos + i + this.windowDelta,\n            score,\n          }),\n        )\n      }\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the foreseeable future and can be purged\n   * from caches, etc\n   */\n  public freeResources(/* { region } */) {}\n}\n"],"names":["_default","_BaseFeatureDataAdapt","_configure","_getRefNames","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","windowSize","windowDelta","gcMode","_createClass","key","value","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this$getSubAdapter","adapter","wrap","_context","prev","next","this","getSubAdapter","getConf","sent","Error","abrupt","dataAdapter","stop","_callee2","_context2","configure","getRefNames","query","opts","_ref","_this2","ObservableCreate","_x","_callee3","observer","_feats$","sequenceAdapter","hw","f","queryStart","queryEnd","ret","feats","residues","i","r","nc","ng","len","_iterator","_step","letter","pos","score","_context3","start","end","Math","max","complete","getFeatures","_objectSpread","firstValueFrom","pipe","toArray","get","slice","_createForOfIteratorHelper","s","n","done","err","e","SimpleFeature","uniqueId","id","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}