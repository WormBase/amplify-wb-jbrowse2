"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6922],{46922:(e,t,r)=>{r.d(t,{Z:()=>w});var n={};r.r(n),r.d(n,{escape:()=>c,escapeColumn:()=>u,formatAttributes:()=>d,formatComment:()=>b,formatDirective:()=>_,formatFeature:()=>v,formatItem:()=>S,formatSequence:()=>C,parseAttributes:()=>l,parseDirective:()=>f,parseFeature:()=>h,unescape:()=>a});var s=r(15174),i=r(6495);function a(e){return e.replace(/%([0-9A-Fa-f]{2})/g,((e,t)=>String.fromCharCode(parseInt(t,16))))}function o(e,t){return String(t).replace(e,(e=>{const t=e.charCodeAt(0).toString(16).toUpperCase().padStart(2,"0");return"%".concat(t)}))}function c(e){return o(/[\n;\r\t=%&,\x00-\x1f\x7f-\xff]/g,e)}function u(e){return o(/[\n\r\t%\x00-\x1f\x7f-\xff]/g,e)}function l(e){if(!e||!e.length||"."===e)return{};const t={};return e.replace(/\r?\n$/,"").split(";").forEach((e=>{const r=e.split("=",2);if(!r[1]||!r[1].length)return;r[0]=r[0].trim();let n=t[r[0].trim()];n||(n=[],t[r[0]]=n),n.push(...r[1].split(",").map((e=>e.trim())).map(a))})),t}function h(e){const t=e.split("\t").map((e=>"."===e||""===e?null:e));return{seq_id:t[0]&&a(t[0]),source:t[1]&&a(t[1]),type:t[2]&&a(t[2]),start:null===t[3]?null:parseInt(t[3],10),end:null===t[4]?null:parseInt(t[4],10),score:null===t[5]?null:parseFloat(t[5]),strand:t[6],phase:t[7],attributes:null===t[8]?null:l(t[8])}}function f(e){const t=/^\s*##\s*(\S+)\s*(.*)/.exec(e);if(!t)return null;const[,r]=t;let[,,n]=t;const s={directive:r};if(n.length&&(n=n.replace(/\r?\n$/,""),s.value=n),"sequence-region"===r){const e=n.split(/\s+/,3);return{...s,seq_id:e[0],start:e[1]&&e[1].replace(/\D/g,""),end:e[2]&&e[2].replace(/\D/g,"")}}if("genome-build"===r){const[e,t]=n.split(/\s+/,2);return{...s,source:e,buildName:t}}return s}function d(e){const t=[];return Object.entries(e).forEach((e=>{let r,[n,s]=e;s&&(r=s.hasOwnProperty("toString")?c(s.toString()):Array.isArray(s)?s.map(c).join(","):c(s),t.push("".concat(c(n),"=").concat(r)))})),t.length?t.join(";"):"."}function p(e,t){const r=null===e.attributes||void 0===e.attributes?".":d(e.attributes),n=[null===e.seq_id?".":u(e.seq_id),null===e.source?".":u(e.source),null===e.type?".":u(e.type),null===e.start?".":u(e.start),null===e.end?".":u(e.end),null===e.score?".":u(e.score),null===e.strand?".":u(e.strand),null===e.phase?".":u(e.phase),r],s="".concat(n.join("\t"),"\n");return t[s]?"":(t[s]=!0,s)}function m(e,t){if(Array.isArray(e))return e.map((e=>m(e,t))).join("");const r=[p(e,t)];var n;return void 0!==(n=e).child_features&&void 0!==n.derived_features&&r.push(...e.child_features.map((e=>m(e,t))),...e.derived_features.map((e=>m(e,t)))),r.join("")}function v(e){return m(e,{})}function _(e){let t="##".concat(e.directive);return e.value&&(t+=" ".concat(e.value)),t+="\n",t}function b(e){return"# ".concat(e.comment,"\n")}function C(e){return">".concat(e.id).concat(e.description?" ".concat(e.description):"","\n").concat(e.sequence,"\n")}function S(e){function t(e){return"attributes"in e?v(e):"directive"in e?_(e):"sequence"in e?C(e):"comment"in e?b(e):"# (invalid item found during format)\n"}return Array.isArray(e)?e.map(t):t(e)}const g="child_features",k="derived_features";class y{constructor(e){this.seqCallback=e,this.currentSequence=void 0}addLine(e){const t=/^>\s*(\S+)\s*(.*)/.exec(e);t?(this._flush(),this.currentSequence={id:t[1],sequence:""},t[2]&&(this.currentSequence.description=t[2].trim())):this.currentSequence&&/\S/.test(e)&&(this.currentSequence.sequence+=e.replace(/\s/g,""))}_flush(){this.currentSequence&&this.seqCallback(this.currentSequence)}finish(){this._flush()}}class D{constructor(e){this.fastaParser=void 0,this.eof=!1,this.lineNumber=0,this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},this._underConstructionOrphans={};const t=()=>{};this.featureCallback=e.featureCallback||t,this.endCallback=e.endCallback||t,this.commentCallback=e.commentCallback||t,this.errorCallback=e.errorCallback||t,this.directiveCallback=e.directiveCallback||t,this.sequenceCallback=e.sequenceCallback||t,this.disableDerivesFromReferences=e.disableDerivesFromReferences||!1,this.bufferSize=void 0===e.bufferSize?1e3:e.bufferSize}addLine(e){if(this.fastaParser)return void this.fastaParser.addLine(e);if(this.eof)return;if(this.lineNumber+=1,/^\s*[^#\s>]/.test(e))return void this._bufferLine(e);const t=/^\s*(#+)(.*)/.exec(e);if(t){const[,r]=t;let[,,n]=t;if(3===r.length)this._emitAllUnderConstructionFeatures();else if(2===r.length){const t=f(e);t&&("FASTA"===t.directive?(this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new y(this.sequenceCallback)):this._emitItem(t))}else n=n.replace(/\s*/,""),this._emitItem({comment:n})}else if(/^\s*$/.test(e));else{if(!/^\s*>/.test(e)){const t=e.replace(/\r?\n?$/g,"");throw new Error("GFF3 parse error.  Cannot parse '".concat(t,"'."))}this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new y(this.sequenceCallback),this.fastaParser.addLine(e)}}finish(){this._emitAllUnderConstructionFeatures(),this.fastaParser&&this.fastaParser.finish(),this.endCallback()}_emitItem(e){Array.isArray(e)?this.featureCallback(e):"directive"in e?this.directiveCallback(e):"comment"in e&&this.commentCallback(e)}_enforceBufferSizeLimit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=e=>{if(e&&Array.isArray(e)&&e[0].attributes&&e[0].attributes.ID&&e[0].attributes.ID[0]){e[0].attributes.ID.forEach((e=>{delete this._underConstructionById[e],delete this._completedReferences[e]})),e.forEach((e=>{e.child_features&&e.child_features.forEach((e=>t(e))),e.derived_features&&e.derived_features.forEach((e=>t(e)))}))}};for(;this._underConstructionTopLevel.length+e>this.bufferSize;){const e=this._underConstructionTopLevel.shift();e&&(this._emitItem(e),t(e))}}_emitAllUnderConstructionFeatures(){if(this._underConstructionTopLevel.forEach(this._emitItem.bind(this)),this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},Array.from(Object.values(this._underConstructionOrphans)).length)throw new Error("some features reference other features that do not exist in the file (or in the same '###' scope). ".concat(Object.keys(this._underConstructionOrphans)))}_bufferLine(e){var t,r,n;const s={...h(e),child_features:[],derived_features:[]},i=(null===(t=s.attributes)||void 0===t?void 0:t.ID)||[],a=(null===(r=s.attributes)||void 0===r?void 0:r.Parent)||[],o=this.disableDerivesFromReferences?[]:(null===(n=s.attributes)||void 0===n?void 0:n.Derives_from)||[];if(!i.length&&!a.length&&!o.length)return void this._emitItem([s]);let c;i.forEach((e=>{const t=this._underConstructionById[e];t?(t[t.length-1].type!==s.type&&this._parseError('multi-line feature "'.concat(e,'" has inconsistent types: "').concat(s.type,'", "').concat(t[t.length-1].type,'"')),t.push(s),c=t):(c=[s],this._enforceBufferSizeLimit(1),a.length||o.length||this._underConstructionTopLevel.push(c),this._underConstructionById[e]=c,this._resolveReferencesTo(c,e))})),this._resolveReferencesFrom(c||[s],{Parent:a,Derives_from:o},i)}_resolveReferencesTo(e,t){const r=this._underConstructionOrphans[t];r&&(e.forEach((e=>{e.child_features.push(...r.Parent)})),e.forEach((e=>{e.derived_features.push(...r.Derives_from)})),delete this._underConstructionOrphans[t])}_parseError(e){this.eof=!0,this.errorCallback("".concat(this.lineNumber,": ").concat(e))}_resolveReferencesFrom(e,t,r){function n(e,t,r){let n=e[t];n||(n={},e[t]=n);const s=n[r]||!1;return n[r]=!0,s}t.Parent.forEach((t=>{const s=this._underConstructionById[t];if(s){const i=g;r.filter((e=>n(this._completedReferences,e,"Parent,".concat(t)))).length||s.forEach((t=>{t[i].push(e)}))}else{let r=this._underConstructionOrphans[t];r||(r={Parent:[],Derives_from:[]},this._underConstructionOrphans[t]=r),r.Parent.push(e)}})),t.Derives_from.forEach((t=>{const s=this._underConstructionById[t];if(s){const i=k;r.filter((e=>n(this._completedReferences,e,"Derives_from,".concat(t)))).length||s.forEach((t=>{t[i].push(e)}))}else{let r=this._underConstructionOrphans[t];r||(r={Parent:[],Derives_from:[]},this._underConstructionOrphans[t]=r),r.Derives_from.push(e)}}))}}var q=r(3995);function A(e){q&&q.nextTick?q.nextTick(e):e()}function F(e){const t={encoding:"utf8",parseFeatures:!0,parseDirectives:!1,parseSequences:!0,parseComments:!1,bufferSize:1e3,disableDerivesFromReferences:!1,...e};return e.parseAll&&(t.parseFeatures=!0,t.parseDirectives=!0,t.parseComments=!0,t.parseSequences=!0),t}class x extends s.Transform{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super({objectMode:!0}),this.textBuffer="";const t=F(e);this.encoding=e.encoding||"utf8",this.decoder=new i.s;const r=this.push.bind(this);this.parser=new D({featureCallback:t.parseFeatures?r:void 0,directiveCallback:t.parseDirectives?r:void 0,commentCallback:t.parseComments?r:void 0,sequenceCallback:t.parseSequences?r:void 0,errorCallback:e=>this.emit("error",e),bufferSize:t.bufferSize,disableDerivesFromReferences:t.disableDerivesFromReferences})}_addLine(e){e&&this.parser.addLine(e)}_nextText(e){const t=(this.textBuffer+e).split(/\r?\n/);this.textBuffer=t.pop()||"",t.forEach((e=>this._addLine(e)))}_transform(e,t,r){this._nextText(this.decoder.write(e)),A(r)}_flush(e){this.decoder.end&&this._nextText(this.decoder.end()),null!=this.textBuffer&&this._addLine(this.textBuffer),this.parser.finish(),A(e)}}class L extends s.Transform{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(Object.assign(e,{objectMode:!0})),this.linesSinceLastSyncMark=0,this.haveWeEmittedData=!1,this.fastaMode=!1,this.minLinesBetweenSyncMarks=e.minSyncLines||100,this.insertVersionDirective=e.insertVersionDirective||!1}_transform(e,t,r){let n;if(!this.haveWeEmittedData&&this.insertVersionDirective){const t=Array.isArray(e)?e[0]:e;"directive"in t&&"gff-version"!==t.directive&&this.push("##gff-version 3\n")}if("sequence"in e&&!this.fastaMode&&(this.push("##FASTA\n"),this.fastaMode=!0),n=Array.isArray(e)?e.map(S).join(""):S(e),this.push(n),this.linesSinceLastSyncMark>=this.minLinesBetweenSyncMarks)this.push("###\n"),this.linesSinceLastSyncMark=0;else{let e=0;for(let t=0;t<n.length;t+=1)"\n"===n[t]&&(e+=1);this.linesSinceLastSyncMark+=e}this.haveWeEmittedData=!0,A(r)}}const w={parseStream:function(){return new x(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},parseStringSync:function(e){if(!e)return[];const t=F(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),r=[],n=r.push.bind(r),s=new D({featureCallback:t.parseFeatures?n:void 0,directiveCallback:t.parseDirectives?n:void 0,commentCallback:t.parseComments?n:void 0,sequenceCallback:t.parseSequences?n:void 0,disableDerivesFromReferences:t.disableDerivesFromReferences||!1,bufferSize:1/0,errorCallback:e=>{throw e}});return e.split(/\r?\n/).forEach(s.addLine.bind(s)),s.finish(),r},formatSync:function(e){const t=[],r=[];e.forEach((e=>{"sequence"in e?r.push(e):t.push(e)}));let n=t.map(S).join("");return r.length&&(n+="##FASTA\n",n+=r.map(C).join("")),n},formatStream:function(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})},formatFile:function(e,t){const r={insertVersionDirective:!0,...arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}};return new Promise(((n,s)=>{e.pipe(new L(r)).on("end",(()=>n(null))).on("error",s).pipe(t)}))},util:n}}}]);
//# sourceMappingURL=6922.e50247e5.chunk.js.map