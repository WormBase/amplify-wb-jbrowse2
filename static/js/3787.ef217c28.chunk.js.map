{"version":3,"file":"static/js/3787.ef217c28.chunk.js","mappings":"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","sources":["../../../plugins/bed/src/BigBedAdapter/BigBedAdapter.ts","../../../plugins/bed/src/util.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BigBed } from '@gmod/bbi'\nimport BED from '@gmod/bed'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { map, mergeAll } from 'rxjs/operators'\nimport { ucscProcessedTranscript } from '../util'\n\nfunction isUCSC(f: Feature) {\n  return f.get('thickStart') && f.get('blockCount') && f.get('strand') !== 0\n}\n\nexport default class BigBedAdapter extends BaseFeatureDataAdapter {\n  private cached?: Promise<{ bigbed: BigBed; header: any; parser: BED }>\n\n  public async configurePre(opts?: BaseOptions) {\n    const pm = this.pluginManager\n    const bigbed = new BigBed({\n      filehandle: openLocation(this.getConf('bigBedLocation'), pm),\n    })\n    const header = await bigbed.getHeader(opts)\n    const parser = new BED({ autoSql: header.autoSql })\n    return { bigbed, header, parser }\n  }\n\n  public async configure(opts?: BaseOptions) {\n    if (!this.cached) {\n      this.cached = this.configurePre(opts).catch(e => {\n        this.cached = undefined\n        throw e\n      })\n    }\n    return this.cached\n  }\n\n  public async getRefNames(opts?: BaseOptions) {\n    const { header } = await this.configure(opts)\n    return Object.keys(header.refsByName)\n  }\n\n  async getHeader(opts?: BaseOptions) {\n    const { parser, header } = await this.configure(opts)\n    const { version, fileType } = header\n    const { fields, ...rest } = parser.autoSql\n    return {\n      version,\n      fileType,\n      autoSql: { ...rest },\n      fields: Object.fromEntries(\n        fields.map(({ name, comment }) => [name, comment]),\n      ),\n    }\n  }\n\n  public getFeatures(region: Region, opts: BaseOptions = {}) {\n    const { refName, start, end } = region\n    const { signal } = opts\n    return ObservableCreate<Feature>(async observer => {\n      try {\n        const { parser, bigbed } = await this.configure(opts)\n        const ob = await bigbed.getFeatureStream(refName, start, end, {\n          signal,\n          basesPerSpan: end - start,\n        })\n        ob.pipe(\n          mergeAll(),\n          map(r => {\n            const data = parser.parseLine(\n              `${refName}\\t${r.start}\\t${r.end}\\t${r.rest}`,\n              {\n                uniqueId: r.uniqueId!,\n              },\n            )\n\n            const { blockCount, blockSizes, blockStarts, chromStarts } = data\n            if (blockCount) {\n              const starts = chromStarts || blockStarts || []\n              const sizes = blockSizes\n              const blocksOffset = r.start\n              data.subfeatures = []\n\n              for (let b = 0; b < blockCount; b += 1) {\n                const bmin = (starts[b] || 0) + blocksOffset\n                const bmax = bmin + (sizes[b] || 0)\n                data.subfeatures.push({\n                  uniqueId: `${r.uniqueId}-${b}`,\n                  start: bmin,\n                  end: bmax,\n                  type: 'block',\n                })\n              }\n            }\n            if (r.uniqueId === undefined) {\n              throw new Error('invalid bbi feature')\n            }\n            const { chromStart, chromEnd, chrom, ...rest } = data\n\n            const f = new SimpleFeature({\n              id: `${this.id}-${r.uniqueId}`,\n              data: {\n                ...rest,\n                start: r.start,\n                end: r.end,\n                refName,\n              },\n            })\n\n            // collection of heuristics for suggesting that this feature\n            // should be converted to a gene, CNV bigbed has many gene like\n            // features including thickStart and blockCount but no strand\n            return isUCSC(f) ? ucscProcessedTranscript(f) : f\n          }),\n        ).subscribe(observer)\n      } catch (e) {\n        observer.error(e)\n      }\n    }, opts.signal)\n  }\n\n  public freeResources(): void {}\n}\n","import { SimpleFeature, Feature } from '@jbrowse/core/util'\nimport BED from '@gmod/bed'\n\nexport function ucscProcessedTranscript(feature: Feature) {\n  const children = feature.children()\n  // split the blocks into UTR, CDS, and exons\n  const thickStart = feature.get('thickStart')\n  const thickEnd = feature.get('thickEnd')\n\n  if (!thickStart && !thickEnd) {\n    return feature\n  }\n\n  const blocks: Feature[] = children\n    ? children\n        .filter(child => child.get('type') === 'block')\n        .sort((a, b) => a.get('start') - b.get('start'))\n    : []\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const newChildren: Record<string, any> = []\n  blocks.forEach(block => {\n    const start = block.get('start')\n    const end = block.get('end')\n    if (thickStart >= end) {\n      // left-side UTR\n      const prime = feature.get('strand') > 0 ? 'five' : 'three'\n      newChildren.push({\n        type: `${prime}_prime_UTR`,\n        start,\n        end,\n      })\n    } else if (thickStart > start && thickStart < end && thickEnd >= end) {\n      // UTR | CDS\n      const prime = feature.get('strand') > 0 ? 'five' : 'three'\n      newChildren.push(\n        {\n          type: `${prime}_prime_UTR`,\n          start,\n          end: thickStart,\n        },\n        {\n          type: 'CDS',\n          start: thickStart,\n          end,\n        },\n      )\n    } else if (thickStart <= start && thickEnd >= end) {\n      // CDS\n      newChildren.push({\n        type: 'CDS',\n        start,\n        end,\n      })\n    } else if (thickStart > start && thickStart < end && thickEnd < end) {\n      // UTR | CDS | UTR\n      const leftPrime = feature.get('strand') > 0 ? 'five' : 'three'\n      const rightPrime = feature.get('strand') > 0 ? 'three' : 'five'\n      newChildren.push(\n        {\n          type: `${leftPrime}_prime_UTR`,\n          start,\n          end: thickStart,\n        },\n        {\n          type: `CDS`,\n          start: thickStart,\n          end: thickEnd,\n        },\n        {\n          type: `${rightPrime}_prime_UTR`,\n          start: thickEnd,\n          end,\n        },\n      )\n    } else if (thickStart <= start && thickEnd > start && thickEnd < end) {\n      // CDS | UTR\n      const prime = feature.get('strand') > 0 ? 'three' : 'five'\n      newChildren.push(\n        {\n          type: `CDS`,\n          start,\n          end: thickEnd,\n        },\n        {\n          type: `${prime}_prime_UTR`,\n          start: thickEnd,\n          end,\n        },\n      )\n    } else if (thickEnd <= start) {\n      // right-side UTR\n      const prime = feature.get('strand') > 0 ? 'three' : 'five'\n      newChildren.push({\n        type: `${prime}_prime_UTR`,\n        start,\n        end,\n      })\n    }\n  })\n  const newData = Object.fromEntries(\n    feature.tags().map(tag => [tag, feature.get(tag)]),\n  )\n  newData.subfeatures = newChildren\n  newData.type = 'mRNA'\n  newData.uniqueId = feature.id()\n  delete newData.chromStarts\n  delete newData.chromStart\n  delete newData.chromEnd\n  delete newData.chrom\n  delete newData.blockStarts\n  delete newData.blockSizes\n  delete newData.blockCount\n  delete newData.thickStart\n  delete newData.thickEnd\n  return new SimpleFeature({\n    data: newData,\n    id: feature.id(),\n  })\n}\n\nfunction defaultParser(fields: string[], line: string) {\n  return Object.fromEntries(line.split('\\t').map((f, i) => [fields[i], f]))\n}\n\nexport function featureData(\n  line: string,\n  colRef: number,\n  colStart: number,\n  colEnd: number,\n  scoreColumn: string,\n  parser: BED,\n  uniqueId: string,\n  names?: string[],\n) {\n  const l = line.split('\\t')\n  const refName = l[colRef]\n  const start = +l[colStart]\n  const colSame = colStart === colEnd ? 1 : 0\n\n  const end = +l[colEnd] + colSame\n  const data = names\n    ? defaultParser(names, line)\n    : parser.parseLine(line, { uniqueId })\n\n  const { blockCount, blockSizes, blockStarts, chromStarts } = data\n\n  if (blockCount) {\n    const starts = chromStarts || blockStarts || []\n    const sizes = blockSizes\n    const blocksOffset = start\n    data.subfeatures = []\n\n    for (let b = 0; b < blockCount; b += 1) {\n      const bmin = (starts[b] || 0) + blocksOffset\n      const bmax = bmin + (sizes[b] || 0)\n      data.subfeatures.push({\n        uniqueId: `${uniqueId}-${b}`,\n        start: bmin,\n        end: bmax,\n        type: 'block',\n      })\n    }\n  }\n\n  if (scoreColumn) {\n    data.score = +data[scoreColumn]\n  }\n  delete data.chrom\n  delete data.chromStart\n  delete data.chromEnd\n  const f = new SimpleFeature({\n    ...data,\n    start,\n    end,\n    refName,\n    uniqueId,\n  })\n  return f.get('thickStart') ? ucscProcessedTranscript(f) : f\n}\n"],"names":["isUCSC","f","get","BigBedAdapter","_BaseFeatureDataAdapt","_configurePre","_configure","_getRefNames","_getHeader","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","cached","_createClass","key","value","_x","_asyncToGenerator","_regeneratorRuntime","mark","_callee","opts","pm","bigbed","header","parser","wrap","_context","prev","next","this","pluginManager","BigBed","filehandle","openLocation","getConf","getHeader","sent","BED","autoSql","abrupt","stop","_x2","_callee2","_this2","_context2","configurePre","catch","e","undefined","_x3","_callee3","_yield$this$configure","_context3","configure","Object","keys","refsByName","_x4","_callee4","_yield$this$configure2","version","fileType","_parser$autoSql","fields","rest","_context4","_objectWithoutProperties","_excluded","_objectSpread","fromEntries","map","_ref","name","comment","region","_ref2","_this3","refName","start","end","signal","ObservableCreate","_x5","_callee5","observer","_yield$_this3$configu","_context5","getFeatureStream","basesPerSpan","pipe","mergeAll","r","data","parseLine","uniqueId","blockCount","blockSizes","blockStarts","chromStarts","starts","sizes","blocksOffset","subfeatures","b","bmin","bmax","push","type","Error","chromStart","chromEnd","chrom","_excluded2","SimpleFeature","id","ucscProcessedTranscript","subscribe","t0","error","BaseFeatureDataAdapter","feature","children","thickStart","thickEnd","blocks","filter","child","sort","a","newChildren","forEach","block","prime","leftPrime","rightPrime","newData","tags","tag","featureData","line","colRef","colStart","colEnd","scoreColumn","names","l","split","colSame","i","defaultParser","score"],"sourceRoot":""}