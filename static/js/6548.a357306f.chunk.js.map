{"version":3,"file":"static/js/6548.a357306f.chunk.js","mappings":"sMASe,MAAAA,UAAcC,EAAAA,uBAAuBC,WAAAA,GAAA,SAAAC,WAAA,KAC1CC,OAAS,SAAS,CAI1B,eAAaC,GAAa,IAADC,EACvB,MAAMC,QAAkC,QAAxBD,EAAME,KAAKC,qBAAa,IAAAH,OAAA,EAAlBA,EAAAI,KAAAF,KAAqBA,KAAKG,QAAQ,qBACxD,IAAKJ,EACH,MAAM,IAAIK,MAAM,4BAElB,OAAOL,EAAQM,WACjB,CAEA,iBAAaC,GAEX,aADsBN,KAAKH,aACZS,aACjB,CAEOC,WAAAA,CAAYC,EAAeC,GAChC,OAAOC,EAAAA,EAAAA,mBAA0BC,UAAmB,IAADC,EACjD,MAAMC,QAAwBb,KAAKH,YAC7BiB,EAAad,KAAKG,QAAQ,cAC1BY,EAAcf,KAAKG,QAAQ,eAC3Ba,EAAoB,IAAfF,EAAmB,EAAIA,EAAa,EACzCG,EAAmB,IAAfH,EAEV,IAAMI,MAAOC,EAAYC,IAAKC,GAAab,EAI3C,GAHAW,EAAaG,KAAKC,IAAI,EAAGJ,EAAaH,GACtCK,GAAYL,EAERK,EAAW,GAAKF,EAAaE,EAE/B,YADAG,EAASC,WAIX,MAAMC,EAAMb,EAAgBN,YAC1B,IACKC,EACHU,MAAOC,EACPC,IAAKC,GAEPZ,GAGIkB,GAAmB,QAARf,SADGgB,EAAAA,EAAAA,GAAeF,EAAIG,MAAKC,EAAAA,EAAAA,QACrB,UAAE,IAAAlB,OAAA,EAARA,EAAUmB,IAAI,SAAU,GAEzC,IAAK,IAAIC,EAAIhB,EAAIgB,EAAIL,EAASM,OAASjB,EAAIgB,GAAKjB,EAAa,CAC3D,MAAMmB,EAAIjB,EAAIU,EAASK,GAAKL,EAASQ,MAAMH,EAAIhB,EAAIgB,EAAIhB,GACvD,IAAIoB,EAAK,EACLC,EAAK,EACLC,EAAM,EACV,IAAK,MAAMC,KAAUL,EACJ,MAAXK,GAA6B,MAAXA,EACpBH,IACoB,MAAXG,GAA6B,MAAXA,GAC3BF,IAEa,MAAXE,GACFD,IAGJ,MAAME,EAAMrB,EACZ,IAAIsB,EACgB,YAAhBzC,KAAKJ,OACP6C,GAASJ,EAAKD,IAAOE,GAAO,GACH,SAAhBtC,KAAKJ,SACd6C,GAASJ,EAAKD,IAAOC,EAAKD,GAAM,IAGlCZ,EAASkB,KACP,IAAIC,EAAAA,cAAc,CAChBC,SAAS,GAADC,OAAK7C,KAAK8C,GAAE,KAAAD,OAAIL,EAAMR,GAC9Bd,MAAOsB,EAAMR,EACbZ,IAAKoB,EAAMR,EAAIjB,EACf0B,UAGN,CACAjB,EAASC,UAAU,GAEvB,CAOOsB,aAAAA,GAAiC,EACzCvD,EArFewD,aAAe,CAAC,gB","sources":["../../../plugins/gccontent/src/GCContentAdapter/GCContentAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { firstValueFrom } from 'rxjs'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature, Region } from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\n\nexport default class extends BaseFeatureDataAdapter {\n  private gcMode = 'content'\n\n  public static capabilities = ['hasLocalStats']\n\n  public async configure() {\n    const adapter = await this.getSubAdapter?.(this.getConf('sequenceAdapter'))\n    if (!adapter) {\n      throw new Error('Error getting subadapter')\n    }\n    return adapter.dataAdapter as BaseFeatureDataAdapter\n  }\n\n  public async getRefNames() {\n    const adapter = await this.configure()\n    return adapter.getRefNames()\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions) {\n    return ObservableCreate<Feature>(async observer => {\n      const sequenceAdapter = await this.configure()\n      const windowSize = this.getConf('windowSize')\n      const windowDelta = this.getConf('windowDelta')\n      const hw = windowSize === 1 ? 1 : windowSize / 2 // Half the window size\n      const f = windowSize === 1\n\n      let { start: queryStart, end: queryEnd } = query\n      queryStart = Math.max(0, queryStart - hw)\n      queryEnd += hw\n\n      if (queryEnd < 0 || queryStart > queryEnd) {\n        observer.complete()\n        return\n      }\n\n      const ret = sequenceAdapter.getFeatures(\n        {\n          ...query,\n          start: queryStart,\n          end: queryEnd,\n        },\n        opts,\n      )\n      const feats = await firstValueFrom(ret.pipe(toArray()))\n      const residues = feats[0]?.get('seq') || ''\n\n      for (let i = hw; i < residues.length - hw; i += windowDelta) {\n        const r = f ? residues[i] : residues.slice(i - hw, i + hw)\n        let nc = 0\n        let ng = 0\n        let len = 0\n        for (const letter of r) {\n          if (letter === 'c' || letter === 'C') {\n            nc++\n          } else if (letter === 'g' || letter === 'G') {\n            ng++\n          }\n          if (letter !== 'N') {\n            len++\n          }\n        }\n        const pos = queryStart\n        let score\n        if (this.gcMode === 'content') {\n          score = (ng + nc) / (len || 1)\n        } else if (this.gcMode === 'skew') {\n          score = (ng - nc) / (ng + nc || 1)\n        }\n\n        observer.next(\n          new SimpleFeature({\n            uniqueId: `${this.id}_${pos + i}`,\n            start: pos + i,\n            end: pos + i + windowDelta,\n            score,\n          }),\n        )\n      }\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the foreseeable future and can be purged\n   * from caches, etc\n   */\n  public freeResources(/* { region } */) {}\n}\n"],"names":["_class","BaseFeatureDataAdapter","constructor","arguments","gcMode","configure","_this$getSubAdapter","adapter","this","getSubAdapter","call","getConf","Error","dataAdapter","getRefNames","getFeatures","query","opts","ObservableCreate","async","_feats$","sequenceAdapter","windowSize","windowDelta","hw","f","start","queryStart","end","queryEnd","Math","max","observer","complete","ret","residues","firstValueFrom","pipe","toArray","get","i","length","r","slice","nc","ng","len","letter","pos","score","next","SimpleFeature","uniqueId","concat","id","freeResources","capabilities"],"sourceRoot":""}