"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[4381],{74945:function(e,t,r){r.d(t,{Z:function(){return j}});var n=r(33028),a=r(30969),i=r(90550),o=r(96234),u=r(40909),s=r(94702),l=r(81073),c=r(68079),f=r(41361),d=r(6556);function v(e,t){var r=e.get("tags");return r?r[t]:e.get(t)}var g=r(44750),h=r(37574),p=[0,1,2,3],m=p[0],x=p[2],k=(0,i.observer)((function(e){var t=e.model,r=e.trackId,n=e.parentRef,i=e.getTrackYPosOverride,d=t.views,p=t.showIntraviewLinks,k=(0,s.Z)(),w=(0,l.getSession)(t),y=(0,u.getSnapshot)(t),j=w.assemblyManager.get(d[0].assemblyNames[0]);(0,g.Go)(y);var S=t.getTrackFeatures(r),b=(0,a.useMemo)((function(){return function(e){var t,r=(0,f.Z)(e.values());try{for(r.s();!(t=r.n()).done;)if(1&t.value.get("flags"))return!0}catch(n){r.e(n)}finally{r.f()}return!1}(S)}),[S]),Z=(0,a.useMemo)((function(){var e=t.getMatchedFeaturesInLayout(r,b?function(e){var t,r=new Map,n=new Set,a=(0,f.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.get("flags"),u=i.id(),s=4&o,l=2&o;if(!n.has(u)&&!l&&!s){var d=i.get("name"),v=r.get(d);v||(v=[],r.set(d,v)),v.push(i)}n.add(i.id())}}catch(g){a.e(g)}finally{a.f()}return(0,c.Z)(r.values()).filter((function(e){return e.length>1}))}(S):function(e){var t,r=new Map,n=new Set,a=(0,f.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.id(),u=4&i.get("flags"),s=!!v(i,"SA");if(!n.has(o)&&!u&&s){var l=i.get("name"),d=r.get(l);d||(d=[],r.set(l,d)),d.push(i)}n.add(i.id())}}catch(g){a.e(g)}finally{a.f()}return(0,c.Z)(r.values()).filter((function(e){return e.length>1}))}(S));return b||e.forEach((function(e){e.sort((function(e,t){return e.feature.get("clipPos")-t.feature.get("clipPos")}))})),e}),[S,r,b,t]),T=(0,a.useState)(),N=(0,o.Z)(T,2),M=N[0],O=N[1],L=0;if(n.current){var R=n.current.getBoundingClientRect();L=R.top}return j?(0,h.jsx)("g",{stroke:k.palette.text.disabled,fill:"none","data-testid":Z.length?"".concat(r,"-loaded"):r,children:Z.map((function(e){for(var t,n=[],a=function(){var t=e[o],a=t.layout,u=t.feature,s=t.level,l=e[o+1],c=l.layout,f=l.feature,v=l.level;if(!a||!c)return console.warn("received null layout for a overlay feature"),{v:null};if(!p&&s===v)return{v:null};var k=j.getCanonicalRefName(u.get("refName")),y=j.getCanonicalRefName(f.get("refName"));if(!k||!y)throw new Error("unable to find ref for ".concat(k||y));var Z=u.get("strand"),T=f.get("strand"),N=a[-1===Z?m:x],R=-1===T,I=b?c[R?m:x]:c[R?x:m],W=(0,g.mu)(d[s],k,N),C=(0,g.mu)(d[v],y,I),B=d[s].pxToBp(W).reversed,F=d[v].pxToBp(C).reversed,P=d.map((function(e){return e.getTrack(r)})),A=(0,g.cO)(r,s,d,P,a,i)-L,J=(0,g.cO)(r,v,d,P,c,i)-L,z=["M",W,A,"C",W+200*u.get("strand")*(B?-1:1),A,C-200*f.get("strand")*(F?-1:1)*(b?-1:1),J,C,J].join(" "),D="".concat(u.id(),"-").concat(f.id());n.push((0,h.jsx)("path",{d:z,"data-testid":"r1",strokeWidth:M===D?5:1,onClick:function(){var e,t,r=null===(e=w.addWidget)||void 0===e?void 0:e.call(w,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(S.get(u.id())||{toJSON:function(){}}).toJSON(),feature2:(S.get(f.id())||{toJSON:function(){}}).toJSON()}});null===(t=w.showWidget)||void 0===t||t.call(w,r)},onMouseOver:function(){return O(D)},onMouseOut:function(){return O(void 0)}},D))},o=0;o<e.length-1;o++)if(t=a())return t.v;return n}))}):null})),w=(0,i.observer)((function(e){var t=e.model,r=e.trackId,n=e.parentRef,i=e.getTrackYPosOverride,s=t.views,v=(0,l.getSession)(t),p=v.assemblyManager,m=t.getTrackFeatures(r),x=(0,a.useMemo)((function(){return t.getMatchedFeaturesInLayout(r,function(e){var t,r=new Map,n=new Set,a=(0,f.Z)(e.values());try{var i=function(){var e=t.value;if(!n.has(e.id())&&"breakend"===e.get("type")){var a=e.get("ALT");null===a||void 0===a||a.forEach((function(t){var n="".concat(e.get("refName"),":").concat(e.get("start")+1),a=(0,d.I)(t);if(a){var i=r.get(n);i?i.push(e):r.set(a.MatePosition||"none",[e])}}))}n.add(e.id())};for(a.s();!(t=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return(0,c.Z)(r.values()).filter((function(e){return e.length>1}))}(m))}),[m,r,t]),k=(0,a.useState)(),w=(0,o.Z)(k,2),y=w[0],j=w[1],S=(0,u.getSnapshot)(t);(0,g.Go)(S);var b=p.get(s[0].assemblyNames[0]);if(!b)return null;var Z=0;if(n.current){var T=n.current.getBoundingClientRect();Z=T.top}return(0,h.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":x.length?"".concat(r,"-loaded"):r,children:x.map((function(e){for(var t,n=[],a=function(){var t=e[o],a=t.layout,u=t.feature,c=t.level,f=e[o+1],p=f.layout,x=f.feature,k=f.level,w=u.id(),S=function(e,t){var r=e.get("ALT");if(r)return new Map(null===r||void 0===r?void 0:r.map((function(e){return(0,d.I)(e)})).filter(l.notEmpty).map((function(e){return[e.MatePosition,e]}))).get("".concat(t.get("refName"),":").concat(t.get("start")+1))}(u,x);if(!a||!p)return{v:null};var T=u.get("refName"),N=x.get("refName"),M=b.getCanonicalRefName(T),O=b.getCanonicalRefName(N);if(!M||!O)throw new Error("unable to find ref for ".concat(M||O));var L=(0,g.mu)(s[c],M,a[0]),R=(0,g.mu)(s[k],O,p[0]),I=s[c].pxToBp(L).reversed,W=s[k].pxToBp(R).reversed,C=s.map((function(e){return e.getTrack(r)})),B=(0,g.cO)(r,c,s,C,a,i)-Z,F=(0,g.cO)(r,k,s,C,p,i)-Z;if(S){var P=["M",L-20*("left"===S.Join?-1:1)*(I?-1:1),B,"L",L,B,"L",R,F,"L",R-20*("left"===S.MateDirection?1:-1)*(W?-1:1),F].join(" ");n.push((0,h.jsx)("path",{d:P,strokeWidth:w===y?10:5,onClick:function(){var e,t,r,n=null===(e=v.addWidget)||void 0===e?void 0:e.call(v,"VariantFeatureWidget","variantFeature",{featureData:null===(t=m.get(w))||void 0===t?void 0:t.toJSON()});null===(r=v.showWidget)||void 0===r||r.call(v,n)},onMouseOver:function(){return j(w)},onMouseOut:function(){return j(void 0)}},JSON.stringify(P)))}else console.warn("the relevant ALT allele was not found, cannot render")},o=0;o<e.length-1;o+=1)if(t=a())return t.v;return n}))})})),y=(0,i.observer)((function(e){var t=e.model,r=e.trackId,n=e.parentRef,i=e.getTrackYPosOverride,s=t.views,c=(0,l.getSession)(t),d=c.assemblyManager,v=t.getTrackFeatures(r),p=(0,a.useMemo)((function(){return t.getMatchedFeaturesInLayout(r,function(e){var t,r=[],n=new Set,a=(0,f.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value;n.has(i.id())||"<TRA>"!==i.get("ALT")[0]||r.push([i]),n.add(i.id())}}catch(o){a.e(o)}finally{a.f()}return r}(v))}),[v,r,t]),m=(0,a.useState)(),x=(0,o.Z)(m,2),k=x[0],w=x[1],y=(0,u.getSnapshot)(t);if((0,g.Go)(y),!d.get(s[0].assemblyNames[0]))return null;var j=0;if(n.current){var S=n.current.getBoundingClientRect();j=S.top}return s.length<2?null:(0,h.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":p.length?"".concat(r,"-loaded"):r,children:p.map((function(e){var t,n=[],a=(0,f.Z)(e);try{var u,l=function(){var e=t.value,a=e.layout,u=e.feature,l=e.level,f=0===l?1:0,d=u.id();if(!a)return{v:null};var p=u.get("INFO"),m=p.CHR2[0],x=p.END[0],y=p.STRANDS[0].split(""),S=(0,o.Z)(y,2),b=S[0],Z=S[1],T=(0,g.mu)(s[f],m,x);if(T){var N=[T,0,T+1,0],M=(0,g.mu)(s[l],u.get("refName"),a[0]),O=T,L=s[l].pxToBp(M).reversed,R=s[f].pxToBp(O).reversed,I=s.map((function(e){return e.getTrack(r)})),W=(0,g.cO)(r,l,s,I,a,i)-j,C=(0,g.cO)(r,f,s,I,N,i)-j,B=["M",M-20*("+"===b?1:-1)*(L?-1:1),W,"L",M,W,"L",O,C,"L",O-20*("+"===Z?1:-1)*(R?-1:1),C].join(" ");n.push((0,h.jsx)("path",{d:B,strokeWidth:d===k?10:5,onClick:function(){var e,t,r=null===(e=c.addWidget)||void 0===e?void 0:e.call(c,"VariantFeatureWidget","variantFeature",{featureData:(v.get(d)||{toJSON:function(){}}).toJSON()});null===(t=c.showWidget)||void 0===t||t.call(c,r)},onMouseOver:function(){return w(d)},onMouseOut:function(){return w(void 0)}},JSON.stringify(B)))}};for(a.s();!(t=a.n()).done;)if(u=l())return u.v}catch(d){a.e(d)}finally{a.f()}return n}))})})),j=(0,i.observer)((function(e){var t,r,a=e.model,i=e.trackId,o=a.getMatchedTracks(i);return"AlignmentsTrack"===(null===(t=o[0])||void 0===t?void 0:t.type)?(0,h.jsx)(k,(0,n.Z)({},e)):"VariantTrack"===(null===(r=o[0])||void 0===r?void 0:r.type)?a.hasTranslocations(i)?(0,h.jsx)(y,(0,n.Z)({},e)):(0,h.jsx)(w,(0,n.Z)({},e)):null}))},44381:function(e,t,r){r.r(t),r.d(t,{renderToSvg:function(){return y}});var n=r(32723),a=r(33028),i=r(34795),o=r(41361),u=(r(30969),r(2082)),s=r(90689),l=r(81073),c=r(75844),f=r(59767),d=r(57211),v=r(94702),g=r(37574);function h(e){var t=e.width,r=e.height,n=e.shift,a=(0,v.Z)();return(0,g.jsx)("rect",{width:t+2*n,height:r,fill:(0,l.stripAlpha)(a.palette.background.default)})}var p,m=r(97891),x=r(74945);function k(e,t,r){return(0,l.max)(e.flatMap((function(e){return e.tracks.map((function(e){return(0,l.measureText)((0,m.getTrackName)(e.configuration,r),t)}))})),0)}function w(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a={},i=t,u=(0,o.Z)(e.tracks);try{for(u.s();!(r=u.n()).done;){var s=r.value;a[s.configuration.trackId]=i+n,i+=s.displays[0].height+t}}catch(l){u.e(l)}finally{u.f()}return a}function y(e,t){return(p=p||(0,i.Z)((0,n.Z)().mark((function e(t,r){var o,v,p,m,y,j,S,b,Z,T,N,M,O,L,R,I,W,C,B,F,P,A,J,z,D,E,H,G,Y,_,V;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=r.textHeight,m=void 0===p?18:p,y=r.headerHeight,j=void 0===y?30:y,S=r.rulerHeight,b=void 0===S?30:S,Z=r.fontSize,T=void 0===Z?13:Z,N=r.trackLabels,M=void 0===N?"offset":N,O=r.Wrapper,L=void 0===O?function(e){var t=e.children;return(0,g.jsx)(g.Fragment,{children:t})}:O,R=r.themeName,I=void 0===R?"default":R,W=(0,l.getSession)(t),C=null===(o=W.allThemes)||void 0===o?void 0:o.call(W)[I],B=t.width,F=t.views,P=50,A=j+b,J=F.map((function(e){return(0,d.hY)(e.tracks,m,M)+A})),z=(0,l.sum)(J)+100,e.next=10,Promise.all(F.map((function(e){return(v=v||(0,i.Z)((0,n.Z)().mark((function e(t){var o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,Promise.all(t.tracks.map((function(e){return(o=o||(0,i.Z)((0,n.Z)().mark((function e(t){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.displays[0],e.next=3,(0,s.when)((function(){return void 0===i.ready||i.ready}));case 3:return e.t0=t,e.next=6,i.renderSvg((0,a.Z)((0,a.Z)({},r),{},{theme:C}));case 6:return e.t1=e.sent,e.abrupt("return",{track:e.t0,result:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)})));case 3:return e.t1=e.sent,e.abrupt("return",{view:e.t0,data:e.t1});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)})));case 10:return D=e.sent,E=k(F,T,W)+40,H="left"===M?E:0,G="offset"===M?m:0,Y=[w(F[0],G,T+A),w(F[1],G,T+J[0]+A)],_=B+H,V=(0,f.createJBrowseTheme)(C),e.abrupt("return",(0,u.uS)((0,g.jsx)(c.Z,{theme:V,children:(0,g.jsx)(L,{children:(0,g.jsxs)("svg",{width:B,height:z,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,_+2*P,z].toString(),children:[(0,g.jsx)(h,{width:_,height:z,shift:P}),(0,g.jsxs)("g",{transform:"translate(".concat(P," ").concat(T,")"),children:[(0,g.jsxs)("g",{transform:"translate(".concat(H,")"),children:[(0,g.jsx)("text",{x:0,fontSize:T,fill:V.palette.text.primary,children:F[0].assemblyNames.join(", ")}),(0,g.jsx)(d.Uc,{model:D[0].view,fontSize:T})]}),(0,g.jsx)(d.Ge,{textHeight:m,trackLabels:M,fontSize:T,model:D[0].view,displayResults:D[0].data,offset:A,trackLabelOffset:H})]}),(0,g.jsxs)("g",{transform:"translate(".concat(P," ").concat(T+J[0],")"),children:[(0,g.jsxs)("g",{transform:"translate(".concat(H,")"),children:[(0,g.jsx)("text",{x:0,fontSize:T,fill:V.palette.text.primary,children:F[1].assemblyNames.join(", ")}),(0,g.jsx)(d.Uc,{model:D[1].view,fontSize:T})]}),(0,g.jsx)(d.Ge,{textHeight:m,trackLabels:M,fontSize:T,model:D[1].view,displayResults:D[1].data,offset:A,trackLabelOffset:H})]}),(0,g.jsx)("defs",{children:(0,g.jsx)("clipPath",{id:"clip-bsv",children:(0,g.jsx)("rect",{x:0,y:0,width:B,height:z})})}),(0,g.jsx)("g",{transform:"translate(".concat(H+P,")"),clipPath:"url(#clip-bsv)",children:t.matchedTracks.map((function(e){return(0,g.jsx)(x.Z,{parentRef:{current:null},model:t,trackId:e.configuration.trackId,getTrackYPosOverride:function(e,t){return Y[t][e]}},e.configuration.trackId)}))})]})})})));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=4381.f092d991.chunk.js.map