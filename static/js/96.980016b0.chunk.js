"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[96],{58108:function(e,t,r){r.r(t),r.d(t,{default:function(){return b}});var n=r(41361),a=r(32723),s=r(34795),u=r(9249),i=r(87371),c=r(45754),o=r(13820),l=r(61462),f=r(20783),h=r(33528),d=r(26131),p=r(59917),v=r(16362),m=r(42098);function g(e){return 31===e[0]&&139===e[1]&&8===e[2]}var b=function(e,t,r,f,b,k,y,Z){(0,c.Z)(x,e);var w=(0,o.Z)(x);function x(){var e;(0,u.Z)(this,x);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=w.call.apply(w,[this].concat(r))).bedFeatures=void 0,e.intervalTrees={},e}return(0,i.Z)(x,[{key:"loadDataP",value:function(){return(t=t||(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n,s,u,i,c,o,f,d,p,v,b,k,y,Z,w,x,S,C,T,_=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_.length>0&&void 0!==_[0]?_[0]:{},r=this.pluginManager,n=this.getConf("bedLocation"),e.next=5,(0,h.openLocation)(n,r).readFile(t);case 5:if(!g(s=e.sent)){e.next=12;break}return e.next=9,(0,m.unzip)(s);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=s;case 13:if(!((u=e.t0).length>536870888)){e.next=16;break}throw new Error("Data exceeds maximum string length (512MB)");case 16:for(i=new TextDecoder("utf8",{fatal:!0}).decode(u),c=i.split(/\n|\r\n|\r/).filter((function(e){return!!e})),o=[],f=0;f<c.length&&c[f].startsWith("#");f++)o.push(c[f]);for(d=o.join("\n"),p={};f<c.length;f++)v=c[f],b=v.indexOf("\t"),k=v.slice(0,b),p[k]||(p[k]=[]),p[k].push(v);return y=this.getConf("autoSql"),Z=new l.Z({autoSql:y}),w=this.getConf("columnNames"),x=this.getConf("scoreColumn"),S=this.getConf("colRef"),C=this.getConf("colStart"),T=this.getConf("colEnd"),e.abrupt("return",{header:d,features:p,parser:Z,columnNames:w,scoreColumn:x,colRef:S,colStart:C,colEnd:T});case 32:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"loadData",value:function(){return(r=r||(0,s.Z)((0,a.Z)().mark((function e(){var t,r=this,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},this.bedFeatures||(this.bedFeatures=this.loadDataP(t).catch((function(e){throw r.bedFeatures=void 0,e}))),e.abrupt("return",this.bedFeatures);case 3:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getRefNames",value:function(){return(f=f||(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},e.next=3,this.loadData(t);case 3:return r=e.sent,n=r.features,e.abrupt("return",Object.keys(n));case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getHeader",value:function(){return(b=b||(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},e.next=3,this.loadData(t);case 3:return r=e.sent,n=r.header,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getNames",value:function(){return(k=k||(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadData();case 2:if(t=e.sent,r=t.header,!(n=t.columnNames).length){e.next=7;break}return e.abrupt("return",n);case 7:return s=r.split(/\n|\r\n|\r/).filter((function(e){return!!e})),u=s.at(-1),e.abrupt("return",null!==u&&void 0!==u&&u.includes("\t")?u.slice(1).split("\t").map((function(e){return e.trim()})):void 0);case 10:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"loadFeatureIntervalTreeHelper",value:function(e){return(y=y||(0,s.Z)((0,a.Z)().mark((function e(t){var r,s,u,i,c,o,l,f,h,d,m,g,b,k,y=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadData();case 2:if(r=e.sent,s=r.colRef,u=r.colStart,i=r.colEnd,c=r.features,o=r.parser,l=r.scoreColumn,f=c[t]){e.next=12;break}return e.abrupt("return",void 0);case 12:return e.next=14,this.getNames();case 14:h=e.sent,d=new v.ZP,m=f.map((function(e,r){var n="".concat(y.id,"-").concat(t,"-").concat(r);return(0,p.P)(e,s,u,i,l,o,n,h)})),g=(0,n.Z)(m);try{for(g.s();!(b=g.n()).done;)k=b.value,d.insert([k.get("start"),k.get("end")],k)}catch(a){g.e(a)}finally{g.f()}return e.abrupt("return",d);case 20:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"loadFeatureIntervalTree",value:function(e){return(Z=Z||(0,s.Z)((0,a.Z)().mark((function e(t){var r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.intervalTrees[t]||(this.intervalTrees[t]=this.loadFeatureIntervalTreeHelper(t).catch((function(e){throw r.intervalTrees[t]=void 0,e}))),e.abrupt("return",this.intervalTrees[t]);case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getFeatures",value:function(e){var t,r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,d.ObservableCreate)((function(n){return(t=t||(0,s.Z)((0,a.Z)().mark((function t(n){var s,u,i,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.start,u=e.end,i=e.refName,t.next=3,r.loadFeatureIntervalTree(i);case 3:null===(c=t.sent)||void 0===c||c.search([s,u]).forEach((function(e){return n.next(e)})),n.complete();case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}),n.signal)}},{key:"freeResources",value:function(){}}]),x}(f.BaseFeatureDataAdapter);b.capabilities=["getFeatures","getRefNames"]},59917:function(e,t,r){r.d(t,{P:function(){return u},d:function(){return s}});var n=r(33028),a=r(81073);function s(e){var t=e.children(),r=e.get("thickStart"),n=e.get("thickEnd");if(!r&&!n)return e;var s=t?t.filter((function(e){return"block"===e.get("type")})).sort((function(e,t){return e.get("start")-t.get("start")})):[],u=[];s.forEach((function(t){var a=t.get("start"),s=t.get("end");if(r>=s){var i=e.get("strand")>0?"five":"three";u.push({type:"".concat(i,"_prime_UTR"),start:a,end:s})}else if(r>a&&r<s&&n>=s){var c=e.get("strand")>0?"five":"three";u.push({type:"".concat(c,"_prime_UTR"),start:a,end:r},{type:"CDS",start:r,end:s})}else if(r<=a&&n>=s)u.push({type:"CDS",start:a,end:s});else if(r>a&&r<s&&n<s){var o=e.get("strand")>0?"five":"three",l=e.get("strand")>0?"three":"five";u.push({type:"".concat(o,"_prime_UTR"),start:a,end:r},{type:"CDS",start:r,end:n},{type:"".concat(l,"_prime_UTR"),start:n,end:s})}else if(r<=a&&n>a&&n<s){var f=e.get("strand")>0?"three":"five";u.push({type:"CDS",start:a,end:n},{type:"".concat(f,"_prime_UTR"),start:n,end:s})}else if(n<=a){var h=e.get("strand")>0?"three":"five";u.push({type:"".concat(h,"_prime_UTR"),start:a,end:s})}}));var i=Object.fromEntries(e.tags().map((function(t){return[t,e.get(t)]})));return i.subfeatures=u,i.type="mRNA",i.uniqueId=e.id(),delete i.chromStarts,delete i.chromStart,delete i.chromEnd,delete i.chrom,delete i.blockStarts,delete i.blockSizes,delete i.blockCount,delete i.thickStart,delete i.thickEnd,new a.SimpleFeature({data:i,id:e.id()})}function u(e,t,r,u,i,c,o,l){var f=e.split("\t"),h=f[t],d=+f[r],p=r===u?1:0,v=+f[u]+p,m=l?function(e,t){return Object.fromEntries(t.split("\t").map((function(t,r){return[e[r],t]})))}(l,e):c.parseLine(e,{uniqueId:o}),g=m.blockCount,b=m.blockSizes,k=m.blockStarts,y=m.chromStarts;if(g){var Z=y||k||[],w=b,x=d;m.subfeatures=[];for(var S=0;S<g;S+=1){var C=(Z[S]||0)+x,T=C+(w[S]||0);m.subfeatures.push({uniqueId:"".concat(o,"-").concat(S),start:C,end:T,type:"block"})}}i&&(m.score=+m[i]),delete m.chrom,delete m.chromStart,delete m.chromEnd;var _=new a.SimpleFeature((0,n.Z)((0,n.Z)({},m),{},{start:d,end:v,refName:h,uniqueId:o}));return _.get("thickStart")?s(_):_}}}]);
//# sourceMappingURL=96.980016b0.chunk.js.map