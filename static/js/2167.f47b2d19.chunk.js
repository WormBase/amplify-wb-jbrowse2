"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[2167],{32167:(e,o,n)=>{n.r(o),n.d(o,{default:()=>me});var t=n(41867),l=n(45294),r=n(47192),s=n(3762),a=n(35421),i=n(90552),c=n(98484),d=n(45489),u=n(21126),m=n(96614),p=n(23738),h=n(83171),g=n(23801),b=n(31625),x=n(90872),v=n(49133),f=n(80838);const j=(0,r.ZL)()({textField:{width:"2rem",verticalAlign:"baseline"}}),w=(0,s.observer)((function(e){let{model:o,disabled:n,modelPropName:l,modelSetterName:r}=e;const[s,a]=(0,t.useState)(o[l]),{classes:i}=j();return(0,t.useEffect)((()=>{const e=Number.parseInt(s,10);Number.isNaN(e)||(e>0?o[r](e):a(1))}),[o,r,s]),(0,f.jsx)(v.Z,{value:s,disabled:n,type:"number",onChange:e=>a(e.target.value),className:i.textField})})),N=(0,r.ZL)()({container:{margin:"0 auto",maxWidth:"25em",padding:20}}),C=(0,s.observer)((e=>{var o;let{model:n}=e;const l=(0,x.getSession)(n),{classes:r}=N(),{assemblyNames:s,assemblyManager:v}=l,{fileType:j,canCancel:C,fileSource:y,isReadyToOpen:Z,fileTypes:M,hasColumnNameLine:S,error:k}=n,[P,F]=(0,t.useState)(s[0]),T=(null===(o=v.get(P))||void 0===o?void 0:o.error)||k,I="CSV"===j||"TSV"===j,L=(0,b.getRoot)(n);return(0,f.jsxs)("div",{className:r.container,children:[T?(0,f.jsx)(a.ErrorMessage,{error:T}):null,(0,f.jsx)("div",{children:(0,f.jsxs)(i.Z,{component:"fieldset",children:[(0,f.jsx)(c.Z,{component:"legend",children:"Tabular file"}),(0,f.jsx)(d.Z,{children:(0,f.jsx)(a.FileSelector,{location:y,setLocation:e=>n.setFileSource(e),rootModel:L})})]})}),(0,f.jsx)("div",{children:(0,f.jsxs)(i.Z,{component:"fieldset",children:[(0,f.jsx)(c.Z,{component:"legend",children:"File Type"}),(0,f.jsx)(u.Z,{row:!0,"aria-label":"file type",name:"type",value:j,children:M.map((e=>(0,f.jsx)(m.Z,{checked:j===e,value:e,onClick:()=>n.setFileType(e),control:(0,f.jsx)(p.Z,{}),label:e},e)))})]})}),I?(0,f.jsx)("div",{children:(0,f.jsxs)(i.Z,{component:"fieldset",children:[(0,f.jsx)(c.Z,{component:"legend",children:"Column Names"}),(0,f.jsx)(m.Z,{disabled:!I,label:"has column names on line",labelPlacement:"end",control:(0,f.jsx)(h.Z,{checked:S,onClick:()=>n.toggleHasColumnNameLine()})}),(0,f.jsx)(w,{model:n,disabled:!I||!S,modelPropName:"columnNameLineNumber",modelSetterName:"setColumnNameLineNumber"})]})}):null,(0,f.jsx)("div",{children:(0,f.jsx)(a.AssemblySelector,{session:l,selected:P,onChange:e=>F(e)})}),(0,f.jsxs)("div",{children:[C?(0,f.jsx)(g.Z,{variant:"contained",color:"secondary",onClick:()=>n.cancelButton(),disabled:!C,children:"Cancel"}):null," ",(0,f.jsx)(g.Z,{disabled:!Z||!!T,variant:"contained","data-testid":"open_spreadsheet",color:"primary",onClick:()=>{n.import(P)},children:"Open"})]})]})})),y=(0,s.observer)((function(e){var o;let{viewModel:n,spreadsheetModel:t}=e;const l=t.rowMenuPosition,{setRowMenuPosition:r}=t,s=()=>{r(null)},i=null===(o=t.rowMenuPosition)||void 0===o?void 0:o.rowNumber;if(void 0===i)return null;const c=t.rowSet.rows[+i-1];const d=n.rowMenuItems.map((e=>{if("function"===typeof e.disabled){const o=e.disabled(n,t,+i,c);return{...e,disabled:o}}return e}));return(0,f.jsx)(a.Menu,{anchorEl:null===l||void 0===l?void 0:l.anchorEl,open:Boolean(l),onMenuItemClick:function(e,o){o(n,t,i,c),s()},onClose:s,menuItems:d,anchorOrigin:{vertical:"bottom",horizontal:"right"}})}));var Z=n(68367),M=n(85762),S=n(41064);const k=(0,s.observer)((function(e){let{cell:o,spreadsheetModel:n,columnNumber:t}=e;const l=n.columns[t];return l&&"dataType"in l&&l.dataType.DataCellReactComponent?(0,f.jsx)(l.dataType.DataCellReactComponent,{cell:o,dataType:l.dataType,columnNumber:t,spreadsheet:n}):o.text})),P=(0,r.ZL)()((e=>({rowNumCell:{textAlign:"left",border:"1px solid ".concat(e.palette.action.disabledBackground),position:"relative",padding:"0 2px 0 0",whiteSpace:"nowrap",userSelect:"none"},rowNumber:{fontWeight:"normal",display:"inline-block",flex:"none",paddingRight:"20px",margin:0,whiteSpace:"nowrap"},rowMenuButton:{padding:0,margin:0,position:"absolute",right:0,display:"inline-block",whiteSpace:"nowrap",flex:"none"},rowMenuButtonIcon:{},rowSelector:{position:"relative",top:"-2px",margin:0,padding:"0 0.2rem"},dataRowSelected:{background:M.Z[100],"& th":{background:M.Z[100]}}}))),F=(0,s.observer)((function(e){let{rowModel:o,rowNumber:n,spreadsheetModel:t}=e;const{classes:l}=P(),{hideRowSelection:r,columnDisplayOrder:s}=t;let a="";function i(e){o.toggleSelect(),e.stopPropagation(),e.preventDefault()}return o.isSelected&&(a+="".concat(l.dataRowSelected)),(0,f.jsxs)("tr",{className:a,children:[(0,f.jsxs)("td",{className:l.rowNumCell,onClick:i,children:[r?(0,f.jsx)(m.Z,{className:l.rowNumber,control:(0,f.jsx)(h.Z,{className:l.rowSelector,checked:o.isSelected,onClick:i}),label:o.id}):null,(0,f.jsx)(Z.Z,{className:l.rowMenuButton,onClick:e=>{t.setRowMenuPosition({anchorEl:e.currentTarget,rowNumber:n}),e.preventDefault(),e.stopPropagation()},children:(0,f.jsx)(S.Z,{className:l.rowMenuButtonIcon})})]}),s.map((e=>(0,f.jsx)("td",{children:(0,f.jsx)(k,{cell:o.cellsWithDerived[e],spreadsheetModel:t,columnNumber:e})},e)))]})}));var T=n(77573),I=n(61583),L=n(49553),R=n(8151),B=n(65188),z=n(8533);const E=(0,s.observer)((function(e){let{viewModel:o,spreadsheetModel:n,currentColumnMenu:t,setColumnMenu:l}=e;const r=()=>l(void 0),s=(null===t||void 0===t?void 0:t.colNumber)||0,i=e=>{n.setSortColumns([{columnNumber:s,descending:e}])},{dataTypeChoices:c}=n,d=new Map;c.forEach((e=>{const{displayName:o,categoryName:n}=e;if(n){let o=d.get(n);o||(o={isCategory:!0,subMenuItems:[]},d.set(n,o)),o.subMenuItems.push(e)}else d.set(o,e)}));const{columns:u,sortColumns:m}=n,p=t&&u[s].dataType,h=(null===p||void 0===p?void 0:p.type)||"",g=t&&u[s].dataType.displayName||"",b=!!t&&m.some((e=>e.columnNumber===t.colNumber&&!e.descending)),v=!!t&&m.some((e=>e.columnNumber===t.colNumber&&e.descending)),j=[{label:"Sort ascending",icon:z.Z,type:"radio",checked:b,onClick:()=>i(!1)},{label:"Sort descending",icon:z.Z,type:"radio",checked:v,onClick:()=>i(!0)},{label:"No sort",icon:z.Z,type:"radio",checked:!v&&!b,onClick:()=>n.setSortColumns([])},{label:"Type: ".concat(g),icon:B.Z,subMenu:(0,x.iterMap)(d.entries(),(e=>{let[o,t]=e;if("typeName"in t&&t.typeName){const{typeName:e}=t;return{label:o||e,icon:h===e?L.Z:void 0,onClick:()=>n.setColumnType(s,e)}}if("subMenuItems"in t&&t.subMenuItems){const{subMenuItems:e}=t;return{label:o,icon:e.some((e=>e.typeName===h))?L.Z:void 0,subMenu:e.map((e=>{let{typeName:o,displayName:t}=e;return{label:t,icon:o===h?L.Z:void 0,onClick:()=>n.setColumnType(s,o)}}))}}return null})).filter(Boolean)}];return null!==p&&void 0!==p&&p.hasFilter&&j.push({label:"Create filter",icon:R.Z,onClick:()=>o.filterControls.addBlankColumnFilter(s)}),(0,f.jsx)(a.Menu,{anchorEl:null===t||void 0===t?void 0:t.anchorEl,open:Boolean(t),onMenuItemClick:(e,o)=>{o(),r()},onClose:r,menuItems:j,anchorOrigin:{vertical:"bottom",horizontal:"right"}})}));var A=n(81184),D=n(2829);const O=(0,r.ZL)()({sortIndicator:{position:"relative",top:"0.2rem",fontSize:"1rem"}});function H(e){let{model:o,columnNumber:n}=e;const{classes:t}=O(),l=o.sortColumns.find((e=>e.columnNumber===n));if(l){const{descending:e}=l;return e?(0,f.jsx)(A.Z,{className:t.sortIndicator}):(0,f.jsx)(D.Z,{className:t.sortIndicator})}return null}function W(e){return String.fromCharCode(e+65)}function _(e){if(e>=0){if(e<26)return W(e);if(e<702)return W(Math.floor(e/26-1))+W(e%26)}throw new RangeError("column number out of range")}const V=(0,r.ZL)()((e=>({columnHead:{fontWeight:"normal",background:"dark"===e.palette.mode?"#333":"#eee",position:"sticky",top:0,zIndex:2,whiteSpace:"nowrap"},columnButtonContainer:{display:"none",position:"absolute",right:0,top:0,background:e.palette.background.paper,height:"100%"},topLeftCorner:{background:"dark"===e.palette.mode?"#333":"#eee",zIndex:2,position:"sticky",top:0,minWidth:e.spacing(2),textAlign:"left"}}))),G=(0,s.observer)((function(e){let{model:o}=e;const{classes:n}=V(),{columnDisplayOrder:l,columns:r,hasColumnNames:s,rowSet:a}=o,[i,c]=(0,t.useState)(),[d,u]=(0,t.useState)();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("thead",{children:(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{className:n.topLeftCorner,children:(0,f.jsx)(T.Z,{title:"Unselect all",placement:"right",children:(0,f.jsx)("span",{children:(0,f.jsx)(Z.Z,{onClick:()=>o.unselectAll(),disabled:!a.selectedCount,children:(0,f.jsx)(I.Z,{})})})})}),l.map((e=>{var t;return(0,f.jsxs)("th",{className:n.columnHead,onMouseOver:()=>u(e),onMouseOut:()=>u(void 0),children:[(0,f.jsx)(H,{model:o,columnNumber:e}),s&&(null===(t=r[e])||void 0===t?void 0:t.name)||_(e),(0,f.jsx)("div",{className:n.columnButtonContainer,style:{display:d===e||(null===i||void 0===i?void 0:i.colNumber)===e?"block":"none"},children:(0,f.jsx)(Z.Z,{onClick:o=>{c({colNumber:e,anchorEl:o.currentTarget})},children:(0,f.jsx)(S.Z,{})})})]},e)}))]})}),(0,f.jsx)(E,{viewModel:(0,b.getParent)(o),spreadsheetModel:o,currentColumnMenu:i,setColumnMenu:c})]})})),U=(0,r.ZL)()((e=>({dataTable:{borderCollapse:"collapse","& td":{border:"1px solid ".concat(e.palette.action.disabledBackground),padding:"0.2rem",maxWidth:"50em",overflow:"hidden",textOverflow:"ellipsis"}},emptyMessage:{captionSide:"bottom"}}))),q=(0,s.observer)((function(e){let{rows:o,spreadsheetModel:n,page:t,rowsPerPage:l}=e;return(0,f.jsx)("tbody",{children:o.slice(l*t,l*(t+1)).map((e=>(0,f.jsx)(F,{rowNumber:e.id,spreadsheetModel:n,rowModel:e},e.id)))})})),J=(0,s.observer)((function(e){let{model:o,page:n,rowsPerPage:t}=e;const{rowSet:l}=o,{classes:r}=U(),s=l.sortedFilteredRows;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(y,{viewModel:(0,b.getParent)(o),spreadsheetModel:o}),(0,f.jsxs)("table",{className:r.dataTable,children:[(0,f.jsx)(G,{model:o}),(0,f.jsx)(q,{rows:s,spreadsheetModel:o,page:n,rowsPerPage:t}),s.length?null:(0,f.jsx)("caption",{className:r.emptyMessage,children:l.count?"no rows match criteria":"no rows present"})]})]})})),K=(0,r.ZL)()((e=>({root:{position:"relative",marginBottom:e.spacing(1),background:e.palette.background.paper,overflow:"auto"}}))),Q=(0,s.observer)((function(e){var o;let{model:n,height:t,page:l,rowsPerPage:r}=e;const{classes:s}=K();return(0,f.jsx)("div",{className:s.root,style:{height:t},children:null!==n&&void 0!==n&&null!==(o=n.rowSet)&&void 0!==o&&o.isLoaded&&n.initialized?(0,f.jsx)(J,{model:n,page:l,rowsPerPage:r}):(0,f.jsx)(a.LoadingEllipses,{variant:"h6"})})}));var X=n(78693),Y=n(64688);const $=(0,r.ZL)()({textFilterControlEndAdornment:{marginRight:"-18px"}}),ee=(0,s.observer)((function(e){let{textFilter:o}=e;const{classes:n}=$(),[l,r]=(0,t.useState)(o.stringToFind),s=(0,x.useDebounce)(l,500);return(0,t.useEffect)((()=>{o.setString(s)}),[s,o]),(0,f.jsx)("div",{children:(0,f.jsx)(v.Z,{label:"text filter",value:l,onChange:e=>r(e.target.value),variant:"outlined",InputProps:{startAdornment:(0,f.jsx)(X.Z,{position:"start",children:(0,f.jsx)(R.Z,{})}),endAdornment:(0,f.jsx)(X.Z,{className:n.textFilterControlEndAdornment,position:"end",children:(0,f.jsx)(Z.Z,{"aria-label":"clear filter",onClick:()=>r(""),children:(0,f.jsx)(Y.Z,{})})})}})})})),oe=(0,s.observer)((e=>{let{model:o}=e;const n=o.filterControls.rowFullText;return(0,f.jsx)(ee,{textFilter:n})}));var ne=n(51590),te=n(22177);const le=(0,r.ZL)()((e=>({columnName:{verticalAlign:"middle",paddingRight:"0.3em"},columnFilter:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",width:"100%",position:"relative"},filterIcon:{position:"relative",top:"12px"},filterIconBg:{background:e.palette.tertiary.main,color:"white",padding:e.spacing(1.5)}})));function re(e){let{filterModel:o}=e;return o?(0,f.jsx)(o.ReactComponent,{filterModel:o}):null}const se=(0,s.observer)((function(e){let{viewModel:o,filterModel:n,columnNumber:t,height:r}=e;const{classes:s}=le(),a=o.spreadsheet.columns[t];if(!a)throw new Error("no column definition! filters are probably out of date");return(0,f.jsxs)(l.ZP,{container:!0,direction:"row",className:s.columnFilter,style:{height:r},children:[(0,f.jsx)(l.ZP,{item:!0,className:s.filterIconBg,children:(0,f.jsx)(R.Z,{className:s.filterIcon})}),(0,f.jsxs)(l.ZP,{item:!0,children:[(0,f.jsx)(Z.Z,{onClick:()=>(0,b.getParent)(n,2).removeColumnFilter(n),title:"remove filter",children:(0,f.jsx)(te.Z,{})}),(0,f.jsx)(ne.Z,{className:s.columnName,component:"span",children:a.name})," ",(0,f.jsx)(re,{filterModel:n})]})]})}));var ae=n(93650);const ie=(0,s.observer)((function(e){let{spreadsheet:o}=e;if(o.rowSet.isLoaded){const{passingFiltersCount:e,count:n,selectedCount:t,selectedAndPassingFiltersCount:l}=o.rowSet;let r;if(e!==n){if(r="".concat(o.rowSet.passingFiltersCount," rows of ").concat(o.rowSet.count," total"),t){r+=", ".concat(l," selected");const e=t-l;e&&(r+=" (".concat(e," selected rows do not pass filters)"))}}else r="".concat(o.rowSet.count," rows"),t&&(r+=", ".concat(t," selected"));return(0,f.jsx)(f.Fragment,{children:r})}return null})),ce=(0,r.ZL)()((e=>({statusBar:{height:40,boxSizing:"border-box",borderTop:"1px outset #b1b1b1",paddingLeft:e.spacing(1)},verticallyCenter:{display:"flex",justifyContent:"center",flexDirection:"column"},spacer:{flexGrow:1}}))),de=(0,s.observer)((function(e){let{page:o,rowsPerPage:n,setPage:t,setRowsPerPage:l,spreadsheet:r,mode:s}=e;const{classes:a}=ce();return(0,f.jsx)("div",{className:a.statusBar,style:{display:"display"===s?void 0:"none"},children:r?(0,f.jsxs)(d.Z,{row:!0,children:[(0,f.jsx)("div",{className:a.verticallyCenter,children:(0,f.jsx)(ie,{spreadsheet:r})}),(0,f.jsx)("div",{className:a.spacer}),(0,f.jsx)(ae.Z,{rowsPerPageOptions:[10,25,100,1e3],count:r.rowSet.count,component:"div",rowsPerPage:n,page:o,onPageChange:(e,o)=>t(o),onRowsPerPageChange:e=>{l(+e.target.value),t(0)}}),(0,f.jsx)("div",{className:a.spacer})]}):null})})),ue=(0,r.ZL)()((e=>({header:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52,paddingLeft:e.spacing(1)},contentArea:{overflow:"auto"},resizeHandle:{height:3,position:"absolute",bottom:0,left:0,background:e.palette.action.disabled,boxSizing:"border-box",borderTop:"1px solid #fafafa"}}))),me=(0,s.observer)((function(e){let{model:o}=e;const{classes:n}=ue(),{spreadsheet:r,filterControls:s,hideFilterControls:i,hideVerticalResizeHandle:c,mode:d,height:u}=o,[m,p]=(0,t.useState)(0),[h,g]=(0,t.useState)(100);return(0,f.jsxs)("div",{children:["display"!==d||i?null:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(l.ZP,{container:!0,direction:"row",className:n.header,children:(0,f.jsx)(l.ZP,{item:!0,children:(0,f.jsx)(oe,{model:o})})}),s.columnFilters.map(((e,n)=>(0,f.jsx)(se,{viewModel:o,filterModel:e,columnNumber:e.columnNumber,height:46},"".concat(e.columnNumber,"-").concat(n))))]}),"import"===d?(0,f.jsx)(C,{model:o.importWizard}):(0,f.jsx)("div",{className:n.contentArea,children:(0,f.jsx)("div",{style:{position:"relative",display:"display"===d?void 0:"none"},children:r?(0,f.jsx)(Q,{page:m,rowsPerPage:h,model:r,height:u-52-46*s.columnFilters.length-40}):null})}),r?(0,f.jsx)(de,{page:m,setPage:p,rowsPerPage:h,setRowsPerPage:g,mode:d,spreadsheet:r}):null,c?null:(0,f.jsx)(a.ResizeHandle,{onDrag:o.resizeHeight,className:n.resizeHandle})]})}))}}]);
//# sourceMappingURL=2167.f47b2d19.chunk.js.map