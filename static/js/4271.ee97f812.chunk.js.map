{"version":3,"file":"static/js/4271.ee97f812.chunk.js","mappings":"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","sources":["../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/ShareBookmarksDialog.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/sessionSharing.ts"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\n\nimport {\n  Alert,\n  Button,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport copy from 'copy-to-clipboard'\n\nimport { getSession } from '@jbrowse/core/util'\nimport { Dialog, ErrorMessage } from '@jbrowse/core/ui'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\n\n// locals\nimport { shareSessionToDynamo } from '../sessionSharing'\nimport { GridBookmarkModel } from '../model'\n\nconst useStyles = makeStyles()(() => ({\n  flexItem: {\n    margin: 5,\n  },\n}))\n\nconst ShareBookmarksDialog = observer(function ({\n  onClose,\n  model,\n}: {\n  onClose: () => void\n  model: GridBookmarkModel\n}) {\n  const { classes } = useStyles()\n  const [url, setUrl] = useState('')\n  const [error, setError] = useState<unknown>()\n  const [loading, setLoading] = useState(true)\n  const session = getSession(model)\n  const { selectedBookmarks } = model\n  const shareAll = selectedBookmarks.length === 0\n  const bookmarksToShare =\n    selectedBookmarks.length === 0\n      ? model.allBookmarksModel\n      : model.sharedBookmarksModel\n\n  useEffect(() => {\n    let cancelled = false\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        setLoading(true)\n        const snap = getSnapshot(bookmarksToShare)\n\n        const locationUrl = new URL(window.location.href)\n        const result = await shareSessionToDynamo(\n          snap,\n          session.shareURL,\n          locationUrl.href,\n        )\n        if (!cancelled) {\n          const params = new URLSearchParams(locationUrl.search)\n          params.set('bookmarks', `share-${result.json.sessionId}`)\n          params.set('password', result.password)\n          locationUrl.search = params.toString()\n          setUrl(locationUrl.href)\n          setLoading(false)\n        }\n      } catch (e) {\n        setError(e)\n        session.notify(`${e}`, 'error')\n      } finally {\n        setLoading(false)\n      }\n    })()\n\n    return () => {\n      cancelled = true\n    }\n  }, [bookmarksToShare, session])\n  return (\n    <Dialog open onClose={onClose} title=\"Share bookmarks\">\n      <DialogContent\n        style={{ display: 'flex', flexFlow: 'column', gap: '5px' }}\n      >\n        <Alert severity=\"info\">\n          {shareAll ? (\n            <>\n              <span>All bookmarks will be shared.</span>\n              <br />\n              <span>\n                Use the checkboxes to select individual bookmarks to share.\n              </span>\n            </>\n          ) : (\n            'Only selected bookmarks will be shared.'\n          )}\n        </Alert>\n        <DialogContentText>\n          Copy the URL below to share your bookmarks.\n        </DialogContentText>\n        {error ? (\n          <ErrorMessage error={error} />\n        ) : loading ? (\n          <Typography>Generating short URL...</Typography>\n        ) : (\n          <TextField\n            label=\"URL\"\n            value={url}\n            InputProps={{ readOnly: true }}\n            variant=\"filled\"\n            fullWidth\n            onClick={event => {\n              const target = event.target as HTMLTextAreaElement\n              target.select()\n            }}\n          />\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          className={classes.flexItem}\n          data-testid=\"dialogShare\"\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<ContentCopyIcon />}\n          onClick={async () => {\n            copy(url)\n            session.notify('Copied to clipboard', 'success')\n            onClose()\n          }}\n        >\n          Copy share link\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default ShareBookmarksDialog\n","// duplicated from products/jbrowse-web/src/sessionSharing.ts ; could possibly be moved into a higher directory and shared between the two\nimport { toUrlSafeB64 } from './utils'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      [...window.crypto.getRandomValues(new Uint8Array(length * 2))]\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replaceAll(/[+/]/g, '')\n    .slice(0, length)\n}\n\nconst encrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  return AES.encrypt(text, password).toString()\n}\n\nconst decrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  const Utf8 = await import('crypto-js/enc-utf8')\n  const bytes = AES.decrypt(text, password)\n  return bytes.toString(Utf8)\n}\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: unknown,\n  url: string,\n  referer: string,\n) {\n  const sess = await toUrlSafeB64(JSON.stringify(session))\n  const password = generateUID(5)\n  const encryptedSession = await encrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n  signal?: AbortSignal,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]\n  const url = `${baseUrl}?sessionId=${encodeURIComponent(sessionId)}`\n  const response = await fetch(url, {\n    signal,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n\n  const json = await response.json()\n  return decrypt(json.session, password)\n}\n"],"names":["useStyles","makeStyles","flexItem","margin","ShareBookmarksDialog","observer","_ref","onClose","model","classes","_useState","useState","_useState2","_slicedToArray","url","setUrl","_useState3","_useState4","error","setError","_useState5","_useState6","loading","setLoading","session","getSession","selectedBookmarks","shareAll","length","bookmarksToShare","allBookmarksModel","sharedBookmarksModel","useEffect","cancelled","_asyncToGenerator","_regeneratorRuntime","mark","_callee","snap","locationUrl","result","params","wrap","_context","prev","next","getSnapshot","URL","window","location","href","shareSessionToDynamo","shareURL","sent","URLSearchParams","search","set","concat","json","sessionId","password","toString","t0","notify","finish","stop","_jsxs","Dialog","open","title","children","DialogContent","style","display","flexFlow","gap","_jsx","Alert","severity","_Fragment","DialogContentText","ErrorMessage","Typography","TextField","label","value","InputProps","readOnly","variant","fullWidth","onClick","event","target","select","DialogActions","Button","className","color","startIcon","ContentCopyIcon","_callee2","_context2","copy","encrypt","_x","_x2","text","AES","abrupt","apply","arguments","decrypt","_x3","_x4","_ref2","Utf8","bytes","getErrorMsg","err","JSON","parse","message","e","_x5","_x6","_x7","_shareSessionToDynamo","_callee3","referer","sess","encryptedSession","data","response","_context3","toUrlSafeB64","stringify","btoa","_toConsumableArray","crypto","getRandomValues","Uint8Array","map","b","String","fromCharCode","join","replaceAll","slice","FormData","append","Date","now","fetch","method","mode","body","ok","Error","readSessionFromDynamo","_x8","_x9","_x10","_x11","_readSessionFromDynamo","_callee4","baseUrl","sessionQueryParam","signal","_context4","split","encodeURIComponent"],"sourceRoot":""}