"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[5910],{5910:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var o=n(66204),a=n(38684),i=n(80846),s=n(43902),r=n(31211),l=n(73330),c=n(92368),f=n(70421),d=n(98074);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u.apply(this,arguments)}const g=(0,a.ZL)()((e=>({tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,l.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:(1.4,Math.round(14e4)/1e5+"em"),maxWidth:300,wordWrap:"break-word"}}))),h=(0,i.observer)((function({title:e}){const t=(0,c.Z)(),{classes:n}=g(),{refs:a,floatingStyles:i,context:r}=(0,d.YF)({placement:"right"}),l=(0,d.gR)(r),{getFloatingProps:h}=(0,d.NI)([l]),m=t?.components?.MuiPopper;return e?o.createElement(f.h,{container:m?.defaultProps?.container},o.createElement("div",u({className:n.tooltip,ref:a.setFloating,style:{...i,zIndex:1e5,pointerEvents:"none"}},h()),o.createElement(s.SanitizedHTML,{html:e}))):null}));var m=n(35950),p=n(99247);const b=(0,i.observer)((function({model:e}){const t=(0,o.useRef)(0),n=(0,o.useRef)(),a=(0,r.getContainingView)(e),i=a.middleComparativeHeight,s=a.width,[l,c]=(0,o.useState)(""),[f,d]=(0,o.useState)(),[u,g]=(0,o.useState)(),b=(0,o.useCallback)((t=>e.setMouseoverCanvasRef(t)),[e,i,s]),v=(0,o.useCallback)((t=>e.setMainCanvasRef(t)),[e,i,s]),M=(0,o.useCallback)((t=>e.setClickMapCanvasRef(t)),[e,i,s]),C=(0,o.useCallback)((t=>e.setCigarClickMapCanvasRef(t)),[e,i,s]);return o.createElement("div",{style:{position:"relative"}},o.createElement("canvas",{ref:b,width:s,height:i,style:{width:s,height:i,position:"absolute",pointerEvents:"none"}}),o.createElement("canvas",{ref:v,onWheel:e=>{Math.abs(e.deltaY)<Math.abs(e.deltaX)&&(t.current+=e.deltaX),void 0===n.current&&(n.current=requestAnimationFrame((()=>{(0,p.transaction)((()=>{for(const e of a.views)e.horizontalScroll(t.current);t.current=0,n.current=void 0}))})))},onMouseMove:t=>{const n=e.clickMapCanvas,o=e.cigarClickMapCanvas;if(!n||!o)return;const a=n.getBoundingClientRect(),i=n.getContext("2d"),s=o.getContext("2d");if(!i||!s)return;const{clientX:l,clientY:f}=t,u=l-a.left,h=f-a.top;d(l),g(f);const[p,b,v]=i.getImageData(u,h,1,1).data,[M,C,w]=s.getImageData(u,h,1,1).data,x=Math.floor(m.EU/e.numFeats),y=(0,m.zv)(p,b,v,x);if(e.setMouseoverId(e.featPositions[y]?.f.id()),-1===y)c("");else if(e.featPositions[y]){const{f:t,cigar:n}=e.featPositions[y],o=t.toJSON(),a=o.mate,i=Math.floor(m.EU/n.length),s=(0,m.zv)(M,C,w,i),l=n[s],f=o.end-o.start,d=a.end-a.start,u=o.identity,g=o.name,h=a.name,p=[`Loc1: ${(0,r.assembleLocString)(o)}`,`Loc2: ${(0,r.assembleLocString)(a)}`,`Inverted: ${-1===o.strand}`,`Query len: ${f.toLocaleString("en-US")}`,`Target len: ${d.toLocaleString("en-US")}`,u?`Identity: ${u.toPrecision(2)}`:"",l?`CIGAR operator: ${l}${n[s+1]}`:"",g?`Name 1: ${g}`:"",h?`Name 1: ${h}`:""].filter((e=>!!e)).join("<br/>");c(p)}},onMouseLeave:()=>e.setMouseoverId(void 0),onClick:t=>{const n=e.clickMapCanvas,o=e.cigarClickMapCanvas;if(!n||!o)return;const a=n.getBoundingClientRect(),i=n.getContext("2d"),s=o.getContext("2d");if(!i||!s)return;const l=t.clientX-a.left,c=t.clientY-a.top,[f,d,u]=i.getImageData(l,c,1,1).data,g=Math.floor(m.EU/e.numFeats),h=(0,m.zv)(f,d,u,g),p=e.featPositions[h];if(!p)return;e.setClickId(p.f.id());const b=(0,r.getSession)(e);(0,r.isSessionModelWithWidgets)(b)&&b.showWidget(b.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:{feature1:p.f.toJSON(),feature2:p.f.get("mate")}}))},"data-testid":"synteny_canvas",style:{width:s,height:i,position:"absolute"},width:1*s,height:1*i}),o.createElement("canvas",{ref:M,style:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},width:s,height:i}),o.createElement("canvas",{ref:C,style:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},width:s,height:i}),e.mouseoverId&&l&&f&&u?o.createElement(h,{title:l}):null)})),v=(0,a.ZL)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10},blockError:{background:"#f1f1f1",padding:10,color:"red"}}}));function M(){const[e,t]=(0,o.useState)(!1),{classes:n}=v();return(0,o.useEffect)((()=>{const e=setTimeout((()=>t(!0)),300);return()=>clearTimeout(e)})),e?o.createElement("div",{className:n.loading},o.createElement(s.LoadingEllipses,null)):null}function C({messageText:e}){const{classes:t}=v();return o.createElement("div",{className:t.blockMessage},e)}function w({error:e}){const{classes:t}=v();return o.createElement("div",{className:t.blockError},`${e}`)}const x=(0,i.observer)((function({model:e}){return e.error?o.createElement(w,{error:e.error}):e.message?o.createElement(C,{messageText:e.message}):e.features?o.createElement(b,{model:e}):o.createElement(M,null)}))},35950:(e,t,n)=>{n.d(t,{EU:()=>s,z8:()=>g,Bf:()=>u,zv:()=>d});var o=n(31211);function a({feature:e,ctx:t,offsets:n,cb:a,height:s,drawCurves:r,oobLimit:l,viewWidth:c,hideTiny:f}){const{p11:d,p12:u,p21:g,p22:h}=e,m=d.offsetPx-n[0],p=u.offsetPx-n[0],b=g.offsetPx-n[1],v=h.offsetPx-n[1],M=Math.abs(p-m),C=Math.abs(v-b),w=s,x=(w-0)/2,y=Math.min(b,v),k=Math.max(b,v);(0,o.doesIntersect2)(y,k,-l,c+l)&&(M<=1&&C<=1?f||(t.beginPath(),t.moveTo(m,0),r?t.bezierCurveTo(m,x,b,x,b,w):t.lineTo(b,w),t.stroke()):(i(t,m,p,0,v,b,w,x,r),a(t)))}function i(e,t,n,o,a,i,s,r,l){l?function(e,t,n,o,a,i,s,r){const l=Math.abs(t-n),c=Math.abs(t-n);if(l<5&&c<5&&n<t&&Math.abs(t-a)>100){const e=t;t=n,n=e}e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.bezierCurveTo(n,r,a,r,a,s),e.lineTo(i,s),e.bezierCurveTo(i,r,t,r,t,o),e.closePath(),e.fill()}(e,t,n,o,a,i,s,r):function(e,t,n,o,a,i,s){e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.lineTo(a,s),e.lineTo(i,s),e.closePath(),e.fill()}(e,t,n,o,a,i,s)}const s=16581375;function r(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const l={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,f=1600;function d(e,t,n,o){return Math.floor((255*e*255+255*t+n-1)/o)}function u(e,t,n){const d=(0,o.getContainingView)(e),u=d.drawCurves,g=d.drawCIGAR,h=d.middleComparativeHeight,m=d.width,p=d.views.map((e=>e.bpPerPx));n&&(n.imageSmoothingEnabled=!1),t.beginPath();const b=e.featPositions,v=d.views.map((e=>e.offsetPx)),M=Math.floor(s/b.length);t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:n,p21:o,p22:a}of b){const i=e.offsetPx-v[0],s=n.offsetPx-v[0],r=o.offsetPx-v[1],l=a.offsetPx-v[1],d=Math.abs(s-i),g=Math.abs(l-r),p=0,b=h,M=(b-p)/2;d<=c&&g<=c&&r<m+f&&r>-f&&(t.moveTo(i,p),u?t.bezierCurveTo(i,M,r,M,r,b):t.lineTo(r,b))}t.stroke(),t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:a,p21:M,p22:C,f:w,cigar:x}of b){const b=e.offsetPx-v[0],y=a.offsetPx-v[0],k=M.offsetPx-v[1],E=C.offsetPx-v[1],P=Math.abs(y-b),S=Math.abs(E-k),T=Math.min(k,E),I=Math.max(k,E),R=0,L=h,$=(L-R)/2;if(!(P<=c&&S<=c)&&(0,o.doesIntersect2)(T,I,-f,d.width+f)){const e=w.get("strand"),o=-1===e?y:b,a=o<(-1===e?b:y)?1:-1,c=(k<E?1:-1)*e;let f=o,d=-1===e?E:k;if(x?.length&&g){let e=!1,o=0,g=0;const h=Math.floor(s/x.length);for(let s=0;s<x.length;s+=2){const b=s*h+1,v=+x[s],M=x[s+1];e||(o=f,g=d);const C=v/p[0],w=v/p[1];if("M"===M||"="===M||"X"===M?(f+=C*a,d+=w*c):"D"===M||"N"===M?f+=C*a:"I"===M&&(d+=w*c),!(Math.max(o,g,f,d)<0||Math.min(o,g,f,d)>m)){const a=s<x.length-2;Math.abs(f-o)<=1&&Math.abs(d-g)<=1&&a?e=!0:(e=!1,t.fillStyle=l[e&&C>1||w>1?M:"M"],i(t,o,f,R,d,g,L,$,u),n&&(n.fillStyle=r(b),i(n,o,f,R,d,g,L,$,u)))}}}else i(t,b,y,R,E,k,L,$,u)}}const C=e.clickMapCanvas?.getContext("2d");if(C){C.imageSmoothingEnabled=!1,C.clearRect(0,0,m,h);for(let e=0;e<b.length;e++){const t=b[e],n=e*M+1;C.fillStyle=r(n),a({cb:e=>e.fill(),feature:t,ctx:C,drawCurves:u,offsets:v,oobLimit:f,viewWidth:d.width,hideTiny:!0,height:h})}}}function g(e){const{clickId:t,mouseoverId:n}=e,i=(0,o.getContainingView)(e),s=i.drawCurves,r=i.middleComparativeHeight,l=i.width,c=e.mouseoverCanvas?.getContext("2d"),d=i.views.map((e=>e.offsetPx));if(!c)return;c.resetTransform(),c.scale(1,1),c.clearRect(0,0,l,r);const u=e.featMap[n||""];u&&(c.fillStyle="rgb(0,0,0,0.1)",a({cb:e=>e.fill(),feature:u,ctx:c,oobLimit:f,viewWidth:i.width,drawCurves:s,offsets:d,height:r}));const g=e.featMap[t||""];g&&(c.strokeStyle="rgb(0, 0, 0, 0.9)",a({cb:e=>e.stroke(),feature:g,ctx:c,oobLimit:f,viewWidth:i.width,drawCurves:s,offsets:d,height:r}))}}}]);
//# sourceMappingURL=5910.2dbe697a.chunk.js.map