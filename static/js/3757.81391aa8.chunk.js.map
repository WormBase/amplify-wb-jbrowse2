{"version":3,"file":"static/js/3757.81391aa8.chunk.js","mappings":"iNAkBe,MAAMA,UAAsBC,EAAAA,uBAAuBC,WAAAA,GAAA,SAAAC,WAChE,KACQC,YAAM,EAQd,cAAcC,CAASC,GACrB,MAAM,eAAEC,EAAiBA,UAAaD,GAAQ,CAAC,EACzCE,EAAKC,KAAKC,cACVC,EAAS,IAAIC,EAAAA,EAAO,CACxBC,YAAYC,EAAAA,EAAAA,cAAaL,KAAKM,QAAQ,kBAAmBP,KAErDQ,QAAeC,EAAAA,EAAAA,cACnB,4BACAV,GACA,IAAMI,EAAOO,UAAUZ,KAEzB,MAAO,CAAEK,SAAQK,SACnB,CAEA,WAAMG,CAAMb,GAOV,OANKG,KAAKL,SACRK,KAAKL,OAASK,KAAKJ,SAASC,GAAMc,OAAMC,IAEtC,MADAZ,KAAKL,YAASkB,EACRD,CAAC,KAGJZ,KAAKL,MACd,CAEA,iBAAamB,CAAYjB,GACvB,MAAM,OAAEU,SAAiBP,KAAKU,MAAMb,GACpC,OAAOkB,OAAOC,KAAKT,EAAOU,WAC5B,CAEA,iBAAaC,CAAYC,GAAgB,IAADC,EACtC,MAAM,OAAEb,SAAiBP,KAAKU,QAC9B,OAAiC,QAAjCU,EAAOb,EAAOc,aAAaF,UAAM,IAAAC,OAAA,EAA1BA,EAA4BE,IACrC,CAEA,oBAAaC,CAAe1B,GAC1B,MAAM,OAAEU,SAAiBP,KAAKU,MAAMb,GACpC,OAAO2B,EAAAA,EAAAA,IAAajB,EAAOkB,aAC7B,CAEOC,WAAAA,CAAYC,GAA2C,IAA3B9B,EAAmBH,UAAAkC,OAAA,QAAAf,IAAAnB,UAAA,GAAAA,UAAA,GAAG,CAAC,EACxD,MAAM,QAAEmC,EAAO,MAAEC,EAAK,IAAEC,GAAQJ,GAC1B,QACJK,EAAU,EAAC,OACXC,EAAM,WACNC,EAAa,EAAC,eACdpC,EAAiBA,UACfD,EACJ,OAAOsC,EAAAA,EAAAA,mBAA0BC,UAC/BtC,EAAe,2BACf,MAAMuC,EAASrC,KAAKM,QAAQ,WACtB,OAAEJ,SAAiBF,KAAKU,MAAMb,GAC9ByC,QAAcpC,EAAOwB,YAAYG,EAASC,EAAOC,EAAK,IACvDlC,EACH0C,aAAcP,EAAUE,IAG1B,IAAK,MAAMM,KAAQF,EAAO,CACpBD,IAEFG,EAAKH,OAASA,GAEhB,MAAMI,EAAQ,GAAAC,OAAML,EAAM,KAAAK,OAAIf,EAAOE,QAAO,KAAAa,OAAIF,EAAKV,MAAK,KAAAY,OAAIF,EAAKT,KAEnES,EAAKX,QAAUA,EACfW,EAAKC,SAAWA,EAChBE,EAASC,KAAK,CAEZC,IAAMC,GAAiBN,EAAiCM,GACxDC,GAAIA,IAAMN,EAEVO,OAAQA,IAAMR,GAElB,CACAG,EAASM,UAAU,GAClBhB,EACL,CAGA,uCAAMiB,CAAkCC,GACtC,MAAO,CAAEC,eAAgB,EAC3B,CAEOC,aAAAA,GAAuB,EA5FX9D,EAIL+D,aAAe,CAC3B,gBACA,gBACA,iB","sources":["../../../plugins/wiggle/src/BigWigAdapter/BigWigAdapter.ts"],"sourcesContent":["import { BigWig } from '@gmod/bbi'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { updateStatus, Feature } from '@jbrowse/core/util'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport {\n  rectifyStats,\n  UnrectifiedQuantitativeStats,\n} from '@jbrowse/core/util/stats'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nexport default class BigWigAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private setupP?: Promise<{ bigwig: BigWig; header: any }>\n\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  private async setupPre(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    const pm = this.pluginManager\n    const bigwig = new BigWig({\n      filehandle: openLocation(this.getConf('bigWigLocation'), pm),\n    })\n    const header = await updateStatus(\n      'Downloading bigwig header',\n      statusCallback,\n      () => bigwig.getHeader(opts),\n    )\n    return { bigwig, header }\n  }\n\n  async setup(opts?: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n\n  public async getRefNames(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return Object.keys(header.refsByName)\n  }\n\n  public async refIdToName(refId: number) {\n    const { header } = await this.setup()\n    return header.refsByNumber[refId]?.name\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return rectifyStats(header.totalSummary as UnrectifiedQuantitativeStats)\n  }\n\n  public getFeatures(region: Region, opts: WiggleOptions = {}) {\n    const { refName, start, end } = region\n    const {\n      bpPerPx = 0,\n      signal,\n      resolution = 1,\n      statusCallback = () => {},\n    } = opts\n    return ObservableCreate<Feature>(async observer => {\n      statusCallback('Downloading bigwig data')\n      const source = this.getConf('source')\n      const { bigwig } = await this.setup(opts)\n      const feats = await bigwig.getFeatures(refName, start, end, {\n        ...opts,\n        basesPerSpan: bpPerPx / resolution,\n      })\n\n      for (const data of feats) {\n        if (source) {\n          // @ts-expect-error\n          data.source = source\n        }\n        const uniqueId = `${source}:${region.refName}:${data.start}-${data.end}`\n        // @ts-expect-error\n        data.refName = refName\n        data.uniqueId = uniqueId\n        observer.next({\n          // @ts-expect-error\n          get: (str: string) => (data as Record<string, unknown>)[str],\n          id: () => uniqueId,\n          // @ts-expect-error\n          toJSON: () => data,\n        })\n      }\n      observer.complete()\n    }, signal)\n  }\n\n  // always render bigwig instead of calculating a feature density for it\n  async getMultiRegionFeatureDensityStats(_regions: Region[]) {\n    return { featureDensity: 0 }\n  }\n\n  public freeResources(): void {}\n}\n"],"names":["BigWigAdapter","BaseFeatureDataAdapter","constructor","arguments","setupP","setupPre","opts","statusCallback","pm","this","pluginManager","bigwig","BigWig","filehandle","openLocation","getConf","header","updateStatus","getHeader","setup","catch","e","undefined","getRefNames","Object","keys","refsByName","refIdToName","refId","_header$refsByNumber$","refsByNumber","name","getGlobalStats","rectifyStats","totalSummary","getFeatures","region","length","refName","start","end","bpPerPx","signal","resolution","ObservableCreate","async","source","feats","basesPerSpan","data","uniqueId","concat","observer","next","get","str","id","toJSON","complete","getMultiRegionFeatureDensityStats","_regions","featureDensity","freeResources","capabilities"],"sourceRoot":""}