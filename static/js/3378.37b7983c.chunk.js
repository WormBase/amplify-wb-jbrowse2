"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[3378],{46997:(t,e,a)=>{a.d(e,{EU:()=>n,z8:()=>m,Bf:()=>d,zv:()=>h});var i=a(90872);function s(t){let{feature:e,ctx:a,offsets:s,cb:n,height:r,drawCurves:l,oobLimit:c,viewWidth:f,hideTiny:h}=t;const{p11:d,p12:m,p21:g,p22:w}=e,x=d.offsetPx-s[0],v=m.offsetPx-s[0],u=g.offsetPx-s[1],p=w.offsetPx-s[1],b=Math.abs(v-x),M=Math.abs(p-u),y=r,P=(y-0)/2,k=Math.min(u,p),S=Math.max(u,p);(0,i.doesIntersect2)(k,S,-c,f+c)&&(b<=1&&M<=1?h||(a.beginPath(),a.moveTo(x,0),l?a.bezierCurveTo(x,P,u,P,u,y):a.lineTo(u,y),a.stroke()):(o(a,x,v,0,p,u,y,P,l),n(a)))}function o(t,e,a,i,s,o,n,r,l){l?function(t,e,a,i,s,o,n,r){const l=Math.abs(e-a),c=Math.abs(e-a);if(l<5&&c<5&&a<e&&Math.abs(e-s)>100){const t=e;e=a,a=t}t.beginPath(),t.moveTo(e,i),t.lineTo(a,i),t.bezierCurveTo(a,r,s,r,s,n),t.lineTo(o,n),t.bezierCurveTo(o,r,e,r,e,i),t.closePath(),t.fill()}(t,e,a,i,s,o,n,r):function(t,e,a,i,s,o,n){t.beginPath(),t.moveTo(e,i),t.lineTo(a,i),t.lineTo(s,n),t.lineTo(o,n),t.closePath(),t.fill()}(t,e,a,i,s,o,n)}const n=16581375;function r(t){const e=Math.floor(t/65025)%255,a=Math.floor(t/255)%255,i=t%255;return"rgb(".concat(e,",").concat(a,",").concat(i,")")}const l={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,f=1600;function h(t,e,a,i){return Math.floor((255*t*255+255*e+a-1)/i)}function d(t,e,a){var h;const d=(0,i.getContainingView)(t),m=d.drawCurves,g=d.drawCIGAR,w=d.middleComparativeHeight,x=d.width,v=d.views.map((t=>t.bpPerPx));a&&(a.imageSmoothingEnabled=!1),e.beginPath();const u=t.featPositions,p=d.views.map((t=>t.offsetPx)),b=Math.floor(n/u.length);e.fillStyle=l.M,e.strokeStyle=l.M;for(const{p11:i,p12:s,p21:o,p22:n}of u){const t=i.offsetPx-p[0],a=s.offsetPx-p[0],r=o.offsetPx-p[1],l=n.offsetPx-p[1],h=Math.abs(a-t),d=Math.abs(l-r),g=0,v=w,u=(v-g)/2;h<=c&&d<=c&&r<x+f&&r>-f&&(e.moveTo(t,g),m?e.bezierCurveTo(t,u,r,u,r,v):e.lineTo(r,v))}e.stroke(),e.fillStyle=l.M,e.strokeStyle=l.M;for(const{p11:s,p12:y,p21:P,p22:k,f:S,cigar:j}of u){const t=s.offsetPx-p[0],h=y.offsetPx-p[0],u=P.offsetPx-p[1],b=k.offsetPx-p[1],M=Math.abs(h-t),T=Math.abs(b-u),C=Math.min(u,b),z=Math.max(u,b),L=0,H=w,R=(H-L)/2;if(!(M<=c&&T<=c)&&(0,i.doesIntersect2)(C,z,-f,d.width+f)){const i=S.get("strand"),s=-1===i?h:t,c=s<(-1===i?t:h)?1:-1,f=(u<b?1:-1)*i;let d=s,w=-1===i?b:u;if(null!==j&&void 0!==j&&j.length&&g){let t=!1,i=0,s=0;const h=Math.floor(n/j.length);for(let n=0;n<j.length;n+=2){const g=n*h+1,u=+j[n],p=j[n+1];t||(i=d,s=w);const b=u/v[0],M=u/v[1];if("M"===p||"="===p||"X"===p?(d+=b*c,w+=M*f):"D"===p||"N"===p?d+=b*c:"I"===p&&(w+=M*f),!(Math.max(i,s,d,w)<0||Math.min(i,s,d,w)>x)){const c=n<j.length-2;Math.abs(d-i)<=1&&Math.abs(w-s)<=1&&c?t=!0:(t=!1,e.fillStyle=l[t&&b>1||M>1?p:"M"],o(e,i,d,L,w,s,H,R,m),a&&(a.fillStyle=r(g),o(a,i,d,L,w,s,H,R,m)))}}}else o(e,t,h,L,b,u,H,R,m)}}const M=null===(h=t.clickMapCanvas)||void 0===h?void 0:h.getContext("2d");if(M){M.imageSmoothingEnabled=!1,M.clearRect(0,0,x,w);for(let t=0;t<u.length;t++){const e=u[t],a=t*b+1;M.fillStyle=r(a),s({cb:t=>t.fill(),feature:e,ctx:M,drawCurves:m,offsets:p,oobLimit:f,viewWidth:d.width,hideTiny:!0,height:w})}}}function m(t){var e;const{clickId:a,mouseoverId:o}=t,n=(0,i.getContainingView)(t),r=n.drawCurves,l=n.middleComparativeHeight,c=n.width,h=null===(e=t.mouseoverCanvas)||void 0===e?void 0:e.getContext("2d"),d=n.views.map((t=>t.offsetPx));if(!h)return;h.resetTransform(),h.scale(1,1),h.clearRect(0,0,c,l);const m=t.featMap[o||""];m&&(h.fillStyle="rgb(0,0,0,0.1)",s({cb:t=>t.fill(),feature:m,ctx:h,oobLimit:f,viewWidth:n.width,drawCurves:r,offsets:d,height:l}));const g=t.featMap[a||""];g&&(h.strokeStyle="rgb(0, 0, 0, 0.9)",s({cb:t=>t.stroke(),feature:g,ctx:h,oobLimit:f,viewWidth:n.width,drawCurves:r,offsets:d,height:l}))}},73378:(t,e,a)=>{a.d(e,{renderToSvg:()=>g});a(41867);var i=a(81096),s=a(49665),o=a(85815),n=a(90872),r=a(99512),l=a(35421),c=a(4592),f=a(17280),h=a(80838);function d(t){let{width:e,height:a,shift:i}=t;const s=(0,f.Z)();return(0,h.jsx)("rect",{width:e+2*i,height:a,fill:(0,n.stripAlpha)(s.palette.background.default)})}var m=a(46997);async function g(t,e){var a;await(0,o.when)((()=>t.initialized));const{textHeight:f=18,headerHeight:g=30,rulerHeight:w=30,fontSize:x=13,trackLabels:v="offset",Wrapper:u=(t=>{let{children:e}=t;return(0,h.jsx)(h.Fragment,{children:e})}),themeName:p="default"}=e,b=(0,n.getSession)(t),M=null===(a=b.allThemes)||void 0===a?void 0:a.call(b)[p],{width:y,views:P,middleComparativeHeight:k,tracks:S}=t,j=g+w,T=P.map((t=>(0,c.hY)(t.tracks,f,v)+j)),C=(0,n.sum)(T)+k+100,z=await Promise.all(P.map((async t=>({view:t,data:await Promise.all(t.tracks.map((async t=>{const a=t.displays[0];return await(0,o.when)((()=>void 0===a.ready||a.ready)),{track:t,result:await a.renderSvg({...e,theme:M})}})))})))),L=await Promise.all(S.map((async t=>{const a=t.displays[0];await(0,o.when)((()=>void 0===a.ready||a.ready));const i=await(0,n.renderToAbstractCanvas)(y,k,{exportSVG:e},(t=>(0,m.Bf)(a,t)));if("imageData"in i)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in i?{html:await(0,n.getSerializedSvg)({...i,width:y,height:k})}:i}))),H=(0,n.max)(P.flatMap((t=>t.tracks.map((t=>(0,n.measureText)((0,r.getTrackName)(t.configuration,b),x))))),0)+40,R="left"===v?H:0,I=y+R,N=(0,l.createJBrowseTheme)(M);return(0,s.uS)((0,h.jsx)(i.Z,{theme:(0,l.createJBrowseTheme)(M),children:(0,h.jsx)(u,{children:(0,h.jsxs)("svg",{width:y,height:C,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,I+100,C].toString(),children:[(0,h.jsx)(d,{width:I,height:C,shift:50}),(0,h.jsxs)("g",{transform:"translate(".concat(50," ").concat(x,")"),children:[(0,h.jsxs)("g",{transform:"translate(".concat(R,")"),children:[(0,h.jsx)("text",{x:0,fontSize:x,fill:N.palette.text.primary,children:P[0].assemblyNames.join(", ")}),(0,h.jsx)(c.Uc,{model:z[0].view,fontSize:x})]}),(0,h.jsx)(c.Ge,{textHeight:f,trackLabels:v,fontSize:x,model:z[0].view,displayResults:z[0].data,offset:j,trackLabelOffset:R})]}),(0,h.jsx)("defs",{children:(0,h.jsx)("clipPath",{id:"synclip",children:(0,h.jsx)("rect",{x:0,y:0,width:y,height:k})})}),(0,h.jsx)("g",{transform:"translate(".concat(50+R," ").concat(x+T[0],")"),clipPath:"url(#synclip)",children:L.map(((t,e)=>(0,h.jsx)(n.ReactRendering,{rendering:t},e)))}),(0,h.jsxs)("g",{transform:"translate(".concat(50," ").concat(x+T[0]+k,")"),children:[(0,h.jsxs)("g",{transform:"translate(".concat(R,")"),children:[(0,h.jsx)("text",{x:0,fontSize:x,fill:N.palette.text.primary,children:P[1].assemblyNames.join(", ")}),(0,h.jsx)(c.Uc,{model:z[1].view,fontSize:x})]}),(0,h.jsx)(c.Ge,{textHeight:f,trackLabels:v,fontSize:x,model:z[1].view,displayResults:z[1].data,offset:j,trackLabelOffset:R})]})]})})}))}}}]);
//# sourceMappingURL=3378.37b7983c.chunk.js.map