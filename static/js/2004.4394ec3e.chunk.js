"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[2004,8177],{90375:(e,t,n)=>{n.d(t,{Z:()=>c});var r=n(41867),s=n(47192),i=n(54560),o=n(80838);const l=(0,s.ZL)()((e=>({resizeBar:{background:e.palette.action.disabledBackground,height:12,position:"relative",overflow:"hidden"},tick:{position:"absolute",height:"100%",pointerEvents:"none",background:e.palette.action.disabled,width:1},hiddenTick:{position:"absolute",height:"100%",width:5}})));function a(e){let{left:t,scrollLeft:n,idx:s,onDrag:a,onMouseDown:c}=e;const{classes:d}=l(),u=(0,r.useCallback)(((e,t)=>a(e,t,s)),[s,a]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.Z,{onDrag:u,onMouseDown:c,vertical:!0,className:d.hiddenTick,style:{left:t-n-2.5}}),(0,o.jsx)("div",{style:{left:t-n},className:d.tick})]})}function c(e){let{widths:t,setWidths:n,checkbox:s,scrollLeft:i=0}=e;const{classes:c}=l(),d=[],[u,h]=(0,r.useState)();let m=s?52:0;for(let r=0;r<t.length;r++){const e=t[r];d[r]=e+m,m+=e}return(0,o.jsx)("div",{className:c.resizeBar,children:d.map(((e,r)=>(0,o.jsx)(a,{onMouseDown:()=>{h([...t])},left:r===d.length-1?e-3:e,onDrag:(e,r,s)=>{const i=[...t];i[s]=Math.max(u[s]-r,50),n(i)},idx:r,scrollLeft:i},r)))})}},13577:(e,t,n)=>{n.d(t,{x:()=>s});var r=n(41867);function s(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(0);return(0,r.useEffect)((()=>{const t=setInterval((()=>{var t;const r=null===(t=e.current)||void 0===t?void 0:t.querySelector(".MuiDataGrid-virtualScroller");r&&n(r.scrollLeft)}),100);return()=>{clearInterval(t)}}),[]),{ref:e,scrollLeft:t}}},65509:(e,t,n)=>{n.r(t),n.d(t,{default:()=>X});var r=n(41867),s=n(47409),i=n(35421),o=n(3762),l=n(68367),a=n(85815),c=n(31625),d=n(97102),u=n(71512),h=n(99512),m=n(83734),f=n(56762),p=n(90375),v=n(90872),g=n(43800),x=n(13577),w=n(47192),j=n(42980),b=n(31061),k=n(45294),S=n(49133),Z=n(78693),C=n(64688),M=n(30340),y=n(74912),E=n(80838);function L(e){let{setFilterText:t,setUseShoppingCart:n,setShowSparse:s,setShowFilters:o,setShowOptions:a,showOptions:c,showSparse:d,showFilters:u,useShoppingCart:h,filterText:m,model:f}=e;const[p,v]=(0,r.useState)(null);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(k.ZP,{container:!0,spacing:4,alignItems:"center",children:[(0,E.jsx)(k.ZP,{item:!0,children:(0,E.jsx)(S.Z,{label:"Search...",value:m,onChange:e=>t(e.target.value),InputProps:{endAdornment:(0,E.jsx)(Z.Z,{position:"end",children:(0,E.jsx)(l.Z,{onClick:()=>t(""),children:(0,E.jsx)(C.Z,{})})})}})}),(0,E.jsx)(k.ZP,{item:!0,children:(0,E.jsx)(l.Z,{onClick:e=>v(e.currentTarget),children:(0,E.jsx)(M.Z,{})})}),(0,E.jsx)(k.ZP,{item:!0,children:(0,E.jsx)(y.Z,{model:f})})]}),(0,E.jsx)(i.Menu,{anchorEl:p,open:!!p,onClose:()=>v(null),onMenuItemClick:(e,t)=>{t(),v(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>n(!h),type:"checkbox",checked:h},{label:"Show sparse metadata columns",onClick:()=>s(!d),checked:d,type:"checkbox"},{label:"Show facet filters",onClick:()=>o(!u),checked:u,type:"checkbox"},{label:"Show extra table options",onClick:()=>a(!c),checked:c,type:"checkbox"}]})]})}var T=n(77573),O=n(90552),R=n(51590),W=n(36669),N=n(18087),H=n(36686);const I=(0,w.ZL)()((e=>({facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}})));function F(e){let{onClick:t}=e;return(0,E.jsx)(T.Z,{title:"Clear selection on this facet filter",children:(0,E.jsx)(l.Z,{onClick:()=>t(),size:"small",children:(0,E.jsx)(C.Z,{})})})}function G(e){let{visible:t,onClick:n}=e;return(0,E.jsx)(T.Z,{title:"Minimize/expand this facet filter",children:(0,E.jsx)(l.Z,{onClick:()=>n(),size:"small",children:t?(0,E.jsx)(N.Z,{}):(0,E.jsx)(H.Z,{})})})}function D(e){let{column:t,vals:n,width:s,dispatch:i,filters:o}=e;const{classes:l}=I(),[a,c]=(0,r.useState)(!0);return(0,E.jsxs)(O.Z,{className:l.facet,style:{width:s},children:[(0,E.jsxs)("div",{style:{display:"flex"},children:[(0,E.jsx)(R.Z,{children:t.field}),(0,E.jsx)(F,{onClick:()=>i({key:t.field,val:[]})}),(0,E.jsx)(G,{visible:a,onClick:()=>c(!a)})]}),a?(0,E.jsx)(W.Z,{multiple:!0,native:!0,className:l.select,value:o[t.field],onChange:e=>{i({key:t.field,val:[...e.target.options].filter((e=>e.selected)).map((e=>e.value))})},children:n.sort(((e,t)=>e[0].localeCompare(t[0]))).map((e=>{let[t,n]=e;return(0,E.jsxs)("option",{value:t,children:[(0,v.coarseStripHTML)(t)," (",n,")"]},t)}))}):null]},t.field)}function P(e){let{rows:t,columns:n,dispatch:r,filters:s,width:i}=e;const o=n.slice(1),l=new Map(o.map((e=>[e.field,new Map]))),a=Object.keys(s),c=o.map((e=>e.field)),d=new Set;for(const f of a){var u;null!==(u=s[f])&&void 0!==u&&u.length&&d.add(f)}for(const f of c)d.add(f);let h=t;for(const f of d){var m;const e=l.get(f);for(const n of h){const t="".concat(n[f]||""),r=e.get(t);t&&(void 0===r?e.set(t,1):e.set(t,r+1))}const t=null!==(m=s[f])&&void 0!==m&&m.length?new Set(s[f]):void 0;h=h.filter((e=>void 0===t||t.has(e[f])))}return(0,E.jsx)("div",{children:o.map((e=>(0,E.jsx)(D,{vals:[...l.get(e.field)],column:e,width:i,dispatch:r,filters:s},e.field)))})}const z=["category","adapter","description"],B=(0,w.ZL)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}),_=.75,A=(0,o.observer)((function(e){var t,n;let{model:s}=e;const{classes:o}=B(),{view:w,selection:k}=s,{pluginManager:S}=(0,v.getEnv)(s),{ref:Z,scrollLeft:C}=(0,x.x)(),[M,y]=(0,r.useState)(""),[T,O]=(0,v.useLocalStorage)("facet-showTableOptions",!1),[R,W]=(0,r.useState)(),[N,H]=(0,r.useState)(!1),[I,F]=(0,v.useLocalStorage)("facet-showSparse",!1),[G,D]=(0,v.useLocalStorage)("facet-showFilters",!0),[A,X]=(0,v.useLocalStorage)("facet-panelWidth",400),U=(0,v.getSession)(s),V=(0,v.useDebounce)(M,400),Y=w.tracks,[q,$]=(0,r.useReducer)(((e,t)=>({...e,[t.key]:t.val})),{}),J=(0,r.useMemo)((()=>s.trackConfigurations.filter((e=>(0,b.wB)(V,e,U))).map((e=>{var t,n;const r=(0,g.readConfObject)(e,"metadata");return{id:e.trackId,conf:e,name:(0,h.getTrackName)(e,U),category:null===(t=(0,g.readConfObject)(e,"category"))||void 0===t?void 0:t.join(", "),adapter:null===(n=(0,g.readConfObject)(e,"adapter"))||void 0===n?void 0:n.type,description:(0,g.readConfObject)(e,"description"),metadata:r,...r}}))),[s,V,U]),K=(0,r.useMemo)((()=>z.filter((e=>!!I||J.map((t=>t[e])).filter((e=>!!e)).length>5))),[I,J]),Q=(0,r.useMemo)((()=>[...new Set(J.flatMap((e=>{return t=e.metadata,Object.entries(t).map((e=>{let[t,n]=e;return"string"===typeof n?t:""})).filter((e=>!!e));var t})))].filter((e=>!!I||J.map((t=>t.metadata[e])).filter((e=>!!e)).length>5))),[I,J]),ee=(0,r.useMemo)((()=>["name",...K,...Q]),[K,Q]),[te,ne]=(0,r.useState)({name:(0,v.measureGridWidth)(J.map((e=>e.name)),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(K.map((e=>[e,(0,v.measureGridWidth)(J.map((t=>t[e])),{maxWidth:400,stripHTML:!0})]))),...Object.fromEntries(Q.map((e=>[e,(0,v.measureGridWidth)(J.map((t=>t.metadata[e])),{maxWidth:400,stripHTML:!0})])))}),[re,se]=(0,r.useState)(Object.fromEntries(ee.map((e=>[e,!0]))));(0,r.useEffect)((()=>{se((e=>({...Object.fromEntries(ee.map((e=>[e,!0]))),...e})))}),[ee]),(0,r.useEffect)((()=>{ne((e=>({name:e.name,...Object.fromEntries(K.filter((e=>re[e])).map((e=>[e,(0,v.measureGridWidth)(J.map((t=>t[e])),{stripHTML:!0,maxWidth:400})]))),...Object.fromEntries(Q.filter((e=>re[e])).map((e=>[e,(0,v.measureGridWidth)(J.map((t=>t.metadata[e])),{stripHTML:!0,maxWidth:400})])))})))}),[Q,re,K,I,J]);const ie=(0,v.useDebounce)(te,200),oe=[{field:"name",hideable:!1,renderCell:e=>{const{value:t,id:n,row:r}=e;return(0,E.jsxs)("div",{className:o.cell,children:[(0,E.jsx)(m.Z,{html:t}),(0,E.jsx)(l.Z,{onClick:e=>W({target:e.currentTarget,id:n,conf:r.conf}),children:(0,E.jsx)(j.Z,{})})]})},width:null!==(t=ie.name)&&void 0!==t?t:100},...K.map((e=>{var t;return{field:e,width:null!==(t=ie[e])&&void 0!==t?t:100,renderCell:e=>{const{value:t}=e;return(0,E.jsx)("div",{className:o.cell,children:t?(0,E.jsx)(m.Z,{html:t}):""})}}})),...Q.map((e=>{var t;return{field:e,width:null!==(t=ie[e])&&void 0!==t?t:100,renderCell:e=>{const{value:t}=e;return(0,E.jsx)("div",{className:o.cell,children:t?(0,E.jsx)(m.Z,{html:t}):""})}}}))],le=new Set(Y.map((e=>e.configuration.trackId))),ae=Object.entries(q).filter((e=>e[1].length>0)).map((e=>{let[t,n]=e;return[t,new Set(n)]})),ce=J.filter((e=>ae.every((t=>{let[n,r]=t;return r.has(e[n])}))));return(0,E.jsxs)(E.Fragment,{children:[R?(0,E.jsx)(f.Z,{anchorEl:null===R||void 0===R?void 0:R.target,menuItems:(null===(n=U.getTrackActionMenuItems)||void 0===n?void 0:n.call(U,R.conf))||[],onMenuItemClick:(e,t)=>{t(),W(void 0)},open:!!R,onClose:()=>W(void 0)}):null,(0,E.jsx)(L,{setShowSparse:F,setShowFilters:D,setShowOptions:O,setFilterText:y,setUseShoppingCart:H,showFilters:G,showSparse:I,showOptions:T,filterText:M,useShoppingCart:N,model:s}),(0,E.jsxs)("div",{ref:Z,style:{display:"flex",overflow:"hidden",height:window.innerHeight*_,width:window.innerWidth*_},children:[(0,E.jsxs)("div",{style:{height:window.innerHeight*_,width:window.innerWidth*_-(G?A:0)},children:[(0,E.jsx)(p.Z,{checkbox:!0,widths:Object.values(te).map((e=>null!==e&&void 0!==e?e:100)),setWidths:e=>ne(Object.fromEntries(Object.entries(te).map(((t,n)=>[t[0],e[n]])))),scrollLeft:C}),(0,E.jsx)(d._$,{rows:ce,columnVisibilityModel:re,onColumnVisibilityModelChange:e=>se(e),columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:e=>{if(N){const t=(0,c.getRoot)(s),n=S.pluggableConfigSchemaType("track"),r=e.map((e=>(0,c.resolveIdentifier)(n,t,e)));s.setSelection(r)}else{const t=le,n=new Set(e);(0,a.transaction)((()=>{[...t].filter((e=>!n.has(e))).map((e=>w.hideTrack(e))),[...n].filter((e=>!t.has(e))).map((e=>w.showTrack(e)))}))}},rowSelectionModel:N?k.map((e=>e.trackId)):[...le],slots:{toolbar:T?u.n:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:oe,rowHeight:25})]}),G?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(i.ResizeHandle,{vertical:!0,onDrag:e=>X(A-e),style:{marginLeft:5,background:"grey",width:5}}),(0,E.jsx)("div",{style:{width:A,overflowY:"auto",overflowX:"hidden"},children:(0,E.jsx)(P,{width:A-10,rows:J,columns:oe,dispatch:$,filters:q})})]}):null]})]})})),X=(0,o.observer)((function(e){const{handleClose:t}=e;return(0,E.jsx)(i.Dialog,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector",children:(0,E.jsx)(s.Z,{children:(0,E.jsx)(A,{...e})})})}))},20875:(e,t,n)=>{n.d(t,{d:()=>c});var r=n(41867),s=n(32407),i=n(95809),o=n(89293),l=n(80838);function a(e){return e.substring(2).toLowerCase()}function c(e){const{children:t,disableReactTree:n=!1,mouseEvent:c="onClick",onClickAway:d,touchEvent:u="onTouchEnd"}=e,h=r.useRef(!1),m=r.useRef(null),f=r.useRef(!1),p=r.useRef(!1);r.useEffect((()=>(setTimeout((()=>{f.current=!0}),0),()=>{f.current=!1})),[]);const v=(0,s.Z)(t.ref,m),g=(0,i.Z)((e=>{const t=p.current;p.current=!1;const r=(0,o.Z)(m.current);if(!f.current||!m.current||"clientX"in e&&function(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}(e,r))return;if(h.current)return void(h.current=!1);let s;s=e.composedPath?e.composedPath().indexOf(m.current)>-1:!r.documentElement.contains(e.target)||m.current.contains(e.target),s||!n&&t||d(e)})),x=e=>n=>{p.current=!0;const r=t.props[e];r&&r(n)},w={ref:v};return!1!==u&&(w[u]=x(u)),r.useEffect((()=>{if(!1!==u){const e=a(u),t=(0,o.Z)(m.current),n=()=>{h.current=!0};return t.addEventListener(e,g),t.addEventListener("touchmove",n),()=>{t.removeEventListener(e,g),t.removeEventListener("touchmove",n)}}}),[g,u]),!1!==c&&(w[c]=x(c)),r.useEffect((()=>{if(!1!==c){const e=a(c),t=(0,o.Z)(m.current);return t.addEventListener(e,g),()=>{t.removeEventListener(e,g)}}}),[g,c]),(0,l.jsx)(r.Fragment,{children:r.cloneElement(t,w)})}},69625:(e,t,n)=>{n.d(t,{Z:()=>f});var r=n(31461),s=n(7896),i=n(41867),o=n(66184),l=n(92705),a=n(90293),c=n(75693),d=n(59968),u=n(80838);const h=["className","component","disableGutters","variant"],m=(0,c.ZP)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableGutters&&t.gutters,t[n.variant]]}})((e=>{let{theme:t,ownerState:n}=e;return(0,s.Z)({position:"relative",display:"flex",alignItems:"center"},!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}},"dense"===n.variant&&{minHeight:48})}),(e=>{let{theme:t,ownerState:n}=e;return"regular"===n.variant&&t.mixins.toolbar})),f=i.forwardRef((function(e,t){const n=(0,a.Z)({props:e,name:"MuiToolbar"}),{className:i,component:c="div",disableGutters:f=!1,variant:p="regular"}=n,v=(0,r.Z)(n,h),g=(0,s.Z)({},n,{component:c,disableGutters:f,variant:p}),x=(e=>{const{classes:t,disableGutters:n,variant:r}=e,s={root:["root",!n&&"gutters",r]};return(0,l.Z)(s,d.N,t)})(g);return(0,u.jsx)(m,(0,s.Z)({as:c,className:(0,o.Z)(x.root,i),ref:t,ownerState:g},v))}))},59968:(e,t,n)=>{n.d(t,{N:()=>i,Z:()=>o});var r=n(70101),s=n(88498);function i(e){return(0,s.Z)("MuiToolbar",e)}const o=(0,r.Z)("MuiToolbar",["root","gutters","regular","dense"])}}]);
//# sourceMappingURL=2004.4394ec3e.chunk.js.map