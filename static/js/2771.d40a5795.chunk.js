(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[2771],{63211:(e,t,n)=>{"use strict";n.d(t,{e$:()=>p,jS:()=>d});var r=n(31625),a=n(85815),o=n(25217),i=n.n(o),s=n(43800),l=n(90872),c=n(1502);const d=(0,s.ConfigurationSchema)("BaseFeatureWidget",{});function u(e,t,n){var r;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t<=a||(o.subfeatures=null===(r=e.subfeatures)||void 0===r?void 0:r.map((e=>(u(e,t,n,a+1,o),n(e))))),o}function p(e){return r.types.model("BaseFeatureWidget",{id:c.ElementId,type:r.types.literal("BaseFeatureWidget"),featureData:r.types.frozen(),formattedFields:r.types.frozen(),unformattedFeatureData:r.types.frozen(),view:r.types.safeReference(e.pluggableMstType("view","stateModel")),track:r.types.safeReference(e.pluggableMstType("track","stateModel")),trackId:r.types.maybe(r.types.string),trackType:r.types.maybe(r.types.string)}).volatile((()=>({error:void 0}))).actions((e=>({setFeatureData(t){e.unformattedFeatureData=t},clearFeatureData(){e.featureData=void 0},setFormattedData(t){e.featureData=t},setExtra(t,n){e.trackId=n,e.trackType=t},setError(t){e.error=t}}))).actions((e=>({afterCreate(){(0,r.addDisposer)(e,(0,a.autorun)((()=>{try{var t,n;e.setExtra(null===(t=e.track)||void 0===t?void 0:t.type,null===(n=e.track)||void 0===n?void 0:n.configuration.trackId);const{unformattedFeatureData:r,track:a}=e,o=(0,l.getSession)(e);if(r){const t=i()(r),n=(e,t)=>({...(0,s.getConf)(o,["formatDetails",e],{feature:t}),...(0,s.getConf)(a,["formatDetails",e],{feature:t})});if(a){t.__jbrowsefmt=n("feature",t);u(t,(0,s.getConf)(a,["formatDetails","depth"]),(e=>{e.__jbrowsefmt=n("subfeatures",e)}))}e.setFormattedData(t)}}catch(r){console.error(r),e.setError(r)}})))}}))).preProcessSnapshot((e=>{const{featureData:t,finalizedFeatureData:n,...r}=e;return{unformattedFeatureData:t,featureData:n,...r}})).postProcessSnapshot((e=>{const{unformattedFeatureData:t,featureData:n,...r}=e;return{finalizedFeatureData:JSON.parse(JSON.stringify(n,((e,t)=>void 0===t?null:t))),...r}}))}},27032:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class r{constructor(){this.name=void 0,this.url=void 0,this.version=void 0,this.configurationSchema=void 0}install(e){}configure(e){}}},59608:(e,t,n)=>{"use strict";n.d(t,{Z:()=>G});var r={};n.r(r),n.d(r,{CoreFreeResources:()=>D,CoreGetFeatureDensityStats:()=>B,CoreGetFeatureDetails:()=>M,CoreGetFeatures:()=>F,CoreGetFileInfo:()=>A,CoreGetMetadata:()=>R,CoreGetRefNames:()=>S,CoreGetRegions:()=>E,CoreRender:()=>j});var a=n(31625),o=n(14331),i=n(31640),s=n(5889),l=n(63048),c=n(59366),d=n(25077),u=n(66511),p=n(83015),h=n(99831),g=n(49368),f=n(75444),m=n(43800),y=n(90173),b=n(41867),v=n(63211),w=n(27032),x=n(93912),C=n(56798);class S extends p.Z{constructor(){super(...arguments),this.name="CoreGetRefNames"}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,x.uP)(n,a,o);return(0,C.isFeatureAdapter)(i)?i.getRefNames(r):[]}}var k=n(90872),T=n(96595);function P(e,t){if(!t)throw new Error('renderer "'.concat(e,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e," has no ReactComponent, it may not be completely implemented yet"));if(!(t instanceof T.default))throw new TypeError("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}class M extends p.Z{constructor(){super(...arguments),this.name="CoreGetFeatureDetails"}async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,k.renameRegionsIfNeeded)(r,e),o=await super.serializeArguments(a,t);if("MainThreadRpcDriver"===t)return o;const{rendererType:i}=e;return P(i,this.pluginManager.getRendererType(i)).serializeArgsInClient(o)}async execute(e,t){var n,r;let a=e;"MainThreadRpcDriver"!==t&&(a=await this.deserializeArguments(e,t));const{rendererType:o,featureId:i}=a;return{feature:null===(n=P(o,this.pluginManager.getRendererType(o)).sessions[(0,k.getLayoutId)(e)])||void 0===n||null===(r=n.cachedLayout.layout.getDataByID(i))||void 0===r?void 0:r.toJSON()}}}class R extends p.Z{constructor(){super(...arguments),this.name="CoreGetMetadata"}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,x.uP)(n,a,o);return(0,C.isFeatureAdapter)(i)?i.getMetadata(r):null}}class A extends p.Z{constructor(){super(...arguments),this.name="CoreGetInfo"}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,x.uP)(n,a,o);return(0,C.isFeatureAdapter)(i)?i.getHeader(r):null}}var I=n(26138),N=n(24201),L=n(85291);class F extends p.Z{constructor(){super(...arguments),this.name="CoreGetFeatures"}async deserializeReturn(e,t,n){return(await super.deserializeReturn(e,t,n)).map((e=>new L.Z(e)))}async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,k.renameRegionsIfNeeded)(r,e);return super.serializeArguments(a,t)}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{signal:a,sessionId:o,adapterConfig:i,regions:s,opts:l}=r,{dataAdapter:c}=await(0,x.uP)(n,o,i);if(!(0,C.isFeatureAdapter)(c))throw new Error("Adapter does not support retrieving features");const d=c.getFeaturesInMultipleRegions(s,{...l,signal:a});return(await(0,N.z)(d.pipe((0,I.q)()))).map((e=>e.toJSON()))}}class j extends p.Z{constructor(){super(...arguments),this.name="CoreRender"}async serializeArguments(e,t){const{rootModel:n}=this.pluginManager,r=n.session.assemblyManager,a=await(0,k.renameRegionsIfNeeded)(r,e),o=await super.serializeArguments(a,t);if("MainThreadRpcDriver"===t)return o;const{rendererType:i}=e;return P(i,this.pluginManager.getRendererType(i)).serializeArgsInClient(o)}async execute(e,t){let n=e;"MainThreadRpcDriver"!==t&&(n=await this.deserializeArguments(e,t));const{sessionId:r,rendererType:a,signal:o}=n;if(!r)throw new Error("must pass a unique session id");(0,k.checkAbortSignal)(o);const i=P(a,this.pluginManager.getRendererType(a)),s="MainThreadRpcDriver"===t?await i.render(n):await i.renderInWorker(n);return(0,k.checkAbortSignal)(o),s}async deserializeReturn(e,t,n){const r=await super.deserializeReturn(e,t,n);if("MainThreadRpcDriver"===n)return r;const{rendererType:a}=t;return P(a,this.pluginManager.getRendererType(a)).deserializeResultsInClient(r,t)}}class D extends p.Z{constructor(){super(...arguments),this.name="CoreFreeResources"}async execute(e){let t=0;return t+=(0,x.Yr)(e),this.pluginManager.getRendererTypes().forEach((e=>{const n=e.freeResources();n&&(t+=n)})),t}async serializeArguments(e,t){return e}}class B extends p.Z{constructor(){super(...arguments),this.name="CoreGetFeatureDensityStats"}async serializeArguments(e,t){var n;const{rootModel:r}=this.pluginManager,a=r.session.assemblyManager,o=await(0,k.renameRegionsIfNeeded)(a,{...e,filters:null===(n=e.filters)||void 0===n?void 0:n.toJSON().filters});return super.serializeArguments(o,t)}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:o,regions:i}=r,{dataAdapter:s}=await(0,x.uP)(n,o,a);if(!(0,C.isFeatureAdapter)(s))throw new Error("Adapter does not support retrieving features");return s.getMultiRegionFeatureDensityStats(i,r)}}class E extends p.Z{constructor(){super(...arguments),this.name="CoreGetRegions"}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=r,{dataAdapter:i}=await(0,x.uP)(n,a,o);return(0,C.isRegionsAdapter)(i)?i.getRegions(r):[]}}var V=n(20592);const z=(0,m.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0});class O extends w.Z{constructor(){super(...arguments),this.name="CorePlugin"}install(e){Object.values(r).forEach((t=>{e.addRpcMethod((()=>new t(e)))})),(e=>{e.addAdapterType((()=>new V.AdapterType({name:"CytobandAdapter",configSchema:z,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(2393)]).then(n.bind(n,82393)).then((e=>e.default))})))})(e),e.addWidgetType((()=>new d.Z({name:"BaseFeatureWidget",heading:"Feature details",configSchema:v.jS,stateModel:(0,v.e$)(e),ReactComponent:(0,b.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(8177)]).then(n.bind(n,44047))))})))}}var Z=n(15485);class W{constructor(){this.phaseCallbacks=new Map,this.phaseOrder=[];for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.phaseOrder=t}add(e,t){if(!this.phaseOrder.includes(e))throw new Error("unknown phase ".concat(e));let n=this.phaseCallbacks.get(e);n||(n=[],this.phaseCallbacks.set(e,n)),n.push(t)}run(){this.phaseOrder.forEach((e=>{var t;null===(t=this.phaseCallbacks.get(e))||void 0===t||t.forEach((e=>e()))}))}}class H{constructor(e,t){this.typeName=e,this.baseClass=t,this.registeredTypes={}}add(e,t){this.registeredTypes[e]=t}has(e){return e in this.registeredTypes}get(e){if(!this.has(e))throw new Error("".concat(this.typeName," '").concat(e,"' not found, perhaps its plugin is not loaded or its plugin has not added it."));return this.registeredTypes[e]}all(){return Object.values(this.registeredTypes)}}class G{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.plugins=[],this.jexl=(0,Z.Z)(),this.pluginMetadata={},this.runtimePluginDefinitions=[],this.elementCreationSchedule=new W("renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account","add track workflow"),this.rendererTypes=new H("RendererType",o.default),this.adapterTypes=new H("AdapterType",i.Z),this.textSearchAdapterTypes=new H("TextSearchAdapterType",g.Z),this.trackTypes=new H("TrackType",s.Z),this.displayTypes=new H("DisplayType",l.Z),this.connectionTypes=new H("ConnectionType",u.Z),this.viewTypes=new H("ViewType",c.Z),this.widgetTypes=new H("WidgetType",d.Z),this.rpcMethods=new H("RpcMethodType",p.Z),this.addTrackWidgets=new H("AddTrackWorkflow",f.Z),this.internetAccountTypes=new H("InternetAccountType",h.Z),this.configured=!1,this.rootModel=void 0,this.extensionPoints=new Map,this.jbrequireCache=new Map,this.lib=y.Z,this.load=e=>(this.jbrequireCache.has(e)||this.jbrequireCache.set(e,e(this)),this.jbrequireCache.get(e)),this.jbrequire=e=>{if("string"===typeof e){const t=this.lib[e];if(!t)throw new TypeError("No jbrequire re-export defined for package '".concat(e,"'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally."));return t}if("function"===typeof e)return this.load(e);if(e.default)return this.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")},this.addPlugin({plugin:new O,metadata:{isCore:!0}}),e.forEach((e=>{this.addPlugin(e)}))}pluginConfigurationSchemas(){const e={};return this.plugins.forEach((t=>{t.configurationSchema&&(e[t.name]=t.configurationSchema)})),e}addPlugin(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");const[t,n={}]="install"in e&&"configure"in e?[e,{}]:[e.plugin,e.metadata];if(this.plugins.includes(t))throw new Error("plugin already installed");return this.pluginMetadata[t.name]=n,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),t.install(this),this.plugins.push(t),this}getPlugin(e){return this.plugins.find((t=>t.name===e))}hasPlugin(e){return void 0!==this.getPlugin(e)}createPluggableElements(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),delete this.elementCreationSchedule),this}setRootModel(e){this.rootModel=e}configure(){if(this.configured)throw new Error("already configured");return this.plugins.forEach((e=>e.configure(this))),this.configured=!0,this}getElementTypeRecord(e){switch(e){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;case"add track workflow":return this.addTrackWidgets;default:throw new Error("invalid element type '".concat(e,"'"))}}addElementType(e,t){var n;if("function"!==typeof t)throw new Error("must provide a callback function that returns the new type object");const r=this.getElementTypeRecord(e);return null===(n=this.elementCreationSchedule)||void 0===n||n.add(e,(()=>{const n=t(this);if(!n.name)throw new Error("cannot add a ".concat(e," with no name"));if(r.has(n.name))throw new Error("".concat(e," ").concat(n.name," already registered, cannot register it again"));r.add(n.name,this.evaluateExtensionPoint("Core-extendPluggableElement",n))})),this}getElementType(e,t){return this.getElementTypeRecord(e).get(t)}getElementTypesInGroup(e){return this.getElementTypeRecord(e).all()}getTrackElements(){return this.getElementTypesInGroup("track")}getConnectionElements(){return this.getElementTypesInGroup("connection")}getAddTrackWorkflowElements(){return this.getElementTypesInGroup("add track workflow")}getRpcElements(){return this.getElementTypesInGroup("rpc method")}getDisplayElements(){return this.getElementTypesInGroup("display")}getAdapterElements(){return this.getElementTypesInGroup("adapter")}pluggableMstType(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.types.maybe(a.types.null);const r=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,a.isType)(e)&&(0,a.isModelType)(e)));return 0===r.length&&"undefined"===typeof jest?(console.warn("No pluggable types found matching ('".concat(e,"','").concat(t,"')")),n):a.types.union(...r)}pluggableConfigSchemaType(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"configSchema";const n=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,m.isBareConfigurationSchemaType)(e)));return 0===n.length&&n.push((0,m.ConfigurationSchema)("Null",{})),a.types.union(...n)}getRendererType(e){return this.rendererTypes.get(e)}getRendererTypes(){return this.rendererTypes.all()}getAdapterType(e){return this.adapterTypes.get(e)}getTextSearchAdapterType(e){return this.textSearchAdapterTypes.get(e)}getTrackType(e){return this.trackTypes.get(e)}getDisplayType(e){return this.displayTypes.get(e)}getViewType(e){return this.viewTypes.get(e)}getAddTrackWorkflow(e){return this.addTrackWidgets.get(e)}getWidgetType(e){return this.widgetTypes.get(e)}getConnectionType(e){return this.connectionTypes.get(e)}getRpcMethodType(e){return this.rpcMethods.get(e)}getInternetAccountType(e){return this.internetAccountTypes.get(e)}addRendererType(e){return this.addElementType("renderer",e)}addAdapterType(e){return this.addElementType("adapter",e)}addTextSearchAdapterType(e){return this.addElementType("text search adapter",e)}addTrackType(e){return this.addElementType("track",(()=>{const t=e(this);return this.getElementTypesInGroup("display").forEach((e=>{e.trackType!==t.name||t.displayTypes.includes(e)||t.addDisplayType(e)})),t}))}addDisplayType(e){return this.addElementType("display",e)}addViewType(e){return this.addElementType("view",(()=>{const t=e(this);return this.getElementTypesInGroup("display").forEach((e=>{e.viewType!==t.name&&e.viewType!==t.extendedName||t.displayTypes.includes(e)||t.addDisplayType(e)})),t}))}addWidgetType(e){return this.addElementType("widget",e)}addConnectionType(e){return this.addElementType("connection",e)}addRpcMethod(e){return this.addElementType("rpc method",e)}addInternetAccountType(e){return this.addElementType("internet account",e)}addAddTrackWorkflowType(e){return this.addElementType("add track workflow",e)}addToExtensionPoint(e,t){let n=this.extensionPoints.get(e);n||(n=[],this.extensionPoints.set(e,n)),n.push(t)}evaluateExtensionPoint(e,t,n){const r=this.extensionPoints.get(e);let a=t;if(r)for(const i of r)try{a=i(a,n)}catch(o){console.error(o)}return a}async evaluateAsyncExtensionPoint(e,t,n){const r=this.extensionPoints.get(e);let a=t;if(r)for(const i of r)try{a=await i(a,n)}catch(o){console.error(o)}return a}}},90173:(e,t,n)=>{"use strict";n.d(t,{Z:()=>ce});var r=n(41867),a=n(80838),o=n.t(a,2),i=n(47155),s=n.t(i,2),l=n(85815),c=n(31625),d=n(3762),u=n(47192),p=n(93250),h=n.n(p),g=n(71939),f=n(17280),m=n(52825),y=n(76693),b=n(10214),v=n(48385),w=n(31459),x=n(56798),C=n(31996),S=n(20592),k=n(59366),T=n(31640),P=n(63048),M=n(5889),R=n(25077),A=n(88057),I=n(96595),N=n(25216),L=n(88016),F=n(90176),j=n(14331),D=n(43800),B=n(27032),E=n(35421),V=n(90872),z=n(71472),O=n(19618),Z=n(99512),W=n(59062),H=n(84535),G=n(16979),q=n(1502);const _=["mobx","mobx-state-tree","react","react/jsx-runtime","react-dom","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react/mui","@material-ui/core","@mui/material","prop-types","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"],U={Accordion:(0,r.lazy)((()=>n.e(6688).then(n.bind(n,56688)))),AccordionActions:(0,r.lazy)((()=>n.e(9604).then(n.bind(n,19604)))),AccordionDetails:(0,r.lazy)((()=>n.e(8886).then(n.bind(n,48886)))),Alert:(0,r.lazy)((()=>n.e(7165).then(n.bind(n,77165)))),AlertTitle:(0,r.lazy)((()=>n.e(5909).then(n.bind(n,95909)))),Autocomplete:(0,r.lazy)((()=>n.e(9979).then(n.bind(n,39979)))),Avatar:(0,r.lazy)((()=>n.e(8639).then(n.bind(n,58639)))),AvatarGroup:(0,r.lazy)((()=>n.e(9247).then(n.bind(n,19247)))),Backdrop:(0,r.lazy)((()=>n.e(7346).then(n.bind(n,17346)))),Badge:(0,r.lazy)((()=>n.e(8046).then(n.bind(n,38046)))),Box:(0,r.lazy)((()=>n.e(3591).then(n.bind(n,43591)))),Breadcrumbs:(0,r.lazy)((()=>n.e(8539).then(n.bind(n,78539)))),Button:(0,r.lazy)((()=>n.e(593).then(n.bind(n,60593)))),ButtonGroup:(0,r.lazy)((()=>n.e(8922).then(n.bind(n,58922)))),Card:(0,r.lazy)((()=>n.e(7107).then(n.bind(n,57107)))),CardActions:(0,r.lazy)((()=>n.e(3011).then(n.bind(n,93011)))),CardActionArea:(0,r.lazy)((()=>n.e(1442).then(n.bind(n,21442)))),CardContent:(0,r.lazy)((()=>n.e(3932).then(n.bind(n,33932)))),CardHeader:(0,r.lazy)((()=>n.e(5071).then(n.bind(n,45071)))),CardMedia:(0,r.lazy)((()=>n.e(7524).then(n.bind(n,7524)))),CircularProgress:(0,r.lazy)((()=>n.e(6887).then(n.bind(n,66887)))),Collapse:(0,r.lazy)((()=>n.e(609).then(n.bind(n,60609)))),ClickAwayListener:(0,r.lazy)((()=>n.e(6753).then(n.bind(n,56753)))),Chip:(0,r.lazy)((()=>n.e(7831).then(n.bind(n,87831)))),Checkbox:(0,r.lazy)((()=>n.e(6961).then(n.bind(n,16961)))),Container:(0,r.lazy)((()=>n.e(5067).then(n.bind(n,45067)))),Dialog:(0,r.lazy)((()=>n.e(3444).then(n.bind(n,93444)))),DialogActions:(0,r.lazy)((()=>n.e(122).then(n.bind(n,122)))),DialogTitle:(0,r.lazy)((()=>n.e(4399).then(n.bind(n,54399)))),DialogContent:(0,r.lazy)((()=>n.e(1177).then(n.bind(n,41177)))),DialogContentText:(0,r.lazy)((()=>n.e(1734).then(n.bind(n,61734)))),Divider:(0,r.lazy)((()=>n.e(3602).then(n.bind(n,63602)))),Drawer:(0,r.lazy)((()=>n.e(6575).then(n.bind(n,96575)))),Fab:(0,r.lazy)((()=>n.e(4468).then(n.bind(n,34468)))),Fade:(0,r.lazy)((()=>n.e(5267).then(n.bind(n,45267)))),FilledInput:(0,r.lazy)((()=>n.e(7460).then(n.bind(n,97460)))),FormLabel:(0,r.lazy)((()=>n.e(5299).then(n.bind(n,35299)))),FormControl:(0,r.lazy)((()=>n.e(850).then(n.bind(n,70850)))),FormControlLabel:(0,r.lazy)((()=>n.e(5628).then(n.bind(n,35628)))),FormHelperText:(0,r.lazy)((()=>n.e(2067).then(n.bind(n,12067)))),FormGroup:(0,r.lazy)((()=>n.e(1359).then(n.bind(n,21359)))),Grid:(0,r.lazy)((()=>n.e(7327).then(n.bind(n,67327)))),Grow:(0,r.lazy)((()=>n.e(1770).then(n.bind(n,91770)))),Icon:(0,r.lazy)((()=>n.e(6989).then(n.bind(n,46989)))),IconButton:(0,r.lazy)((()=>n.e(5730).then(n.bind(n,35730)))),Input:(0,r.lazy)((()=>n.e(9497).then(n.bind(n,9497)))),InputBase:(0,r.lazy)((()=>n.e(1429).then(n.bind(n,81429)))),InputLabel:(0,r.lazy)((()=>n.e(5989).then(n.bind(n,5989)))),InputAdornment:(0,r.lazy)((()=>n.e(3919).then(n.bind(n,73919)))),Link:(0,r.lazy)((()=>n.e(5638).then(n.bind(n,45638)))),LinearProgress:(0,r.lazy)((()=>n.e(6594).then(n.bind(n,6594)))),List:(0,r.lazy)((()=>n.e(8210).then(n.bind(n,78210)))),ListItem:(0,r.lazy)((()=>Promise.all([n.e(2280),n.e(3302)]).then(n.bind(n,83302)))),ListItemAvatar:(0,r.lazy)((()=>n.e(9162).then(n.bind(n,39162)))),ListItemSecondaryAction:(0,r.lazy)((()=>n.e(2397).then(n.bind(n,22397)))),ListItemIcon:(0,r.lazy)((()=>n.e(3120).then(n.bind(n,23120)))),ListSubheader:(0,r.lazy)((()=>n.e(8469).then(n.bind(n,8469)))),ListItemText:(0,r.lazy)((()=>n.e(8108).then(n.bind(n,68108)))),Menu:(0,r.lazy)((()=>n.e(4308).then(n.bind(n,54308)))),MenuItem:(0,r.lazy)((()=>n.e(299).then(n.bind(n,80299)))),MenuList:(0,r.lazy)((()=>n.e(1082).then(n.bind(n,71082)))),Modal:(0,r.lazy)((()=>n.e(262).then(n.bind(n,90262)))),NativeSelect:(0,r.lazy)((()=>n.e(74).then(n.bind(n,74)))),OutlinedInput:(0,r.lazy)((()=>n.e(8135).then(n.bind(n,38135)))),Pagination:(0,r.lazy)((()=>n.e(916).then(n.bind(n,70916)))),PaginationItem:(0,r.lazy)((()=>n.e(7581).then(n.bind(n,97581)))),Paper:(0,r.lazy)((()=>n.e(2968).then(n.bind(n,42968)))),Popover:(0,r.lazy)((()=>n.e(1230).then(n.bind(n,51230)))),Popper:(0,r.lazy)((()=>n.e(3763).then(n.bind(n,43763)))),Portal:(0,r.lazy)((()=>n.e(6894).then(n.bind(n,6894)))),Radio:(0,r.lazy)((()=>n.e(4673).then(n.bind(n,94673)))),RadioGroup:(0,r.lazy)((()=>n.e(2693).then(n.bind(n,12693)))),Rating:(0,r.lazy)((()=>n.e(5253).then(n.bind(n,15253)))),ScopedCssBaseline:(0,r.lazy)((()=>n.e(2635).then(n.bind(n,82635)))),Select:(0,r.lazy)((()=>n.e(6642).then(n.bind(n,6642)))),Skeleton:(0,r.lazy)((()=>n.e(6069).then(n.bind(n,76069)))),Slider:(0,r.lazy)((()=>n.e(9858).then(n.bind(n,29858)))),Snackbar:(0,r.lazy)((()=>Promise.all([n.e(3067),n.e(5270)]).then(n.bind(n,15270)))),SnackbarContent:(0,r.lazy)((()=>n.e(7352).then(n.bind(n,47352)))),SpeedDial:(0,r.lazy)((()=>n.e(6039).then(n.bind(n,56039)))),SpeedDialAction:(0,r.lazy)((()=>n.e(2030).then(n.bind(n,72030)))),SpeedDialIcon:(0,r.lazy)((()=>n.e(7091).then(n.bind(n,7091)))),Stack:(0,r.lazy)((()=>n.e(2087).then(n.bind(n,52087)))),Step:(0,r.lazy)((()=>n.e(6164).then(n.bind(n,6164)))),StepButton:(0,r.lazy)((()=>n.e(305).then(n.bind(n,80305)))),StepConnector:(0,r.lazy)((()=>n.e(9024).then(n.bind(n,69024)))),StepLabel:(0,r.lazy)((()=>n.e(8285).then(n.bind(n,68285)))),StepIcon:(0,r.lazy)((()=>n.e(5521).then(n.bind(n,65521)))),Stepper:(0,r.lazy)((()=>n.e(1030).then(n.bind(n,31030)))),SvgIcon:(0,r.lazy)((()=>n.e(8381).then(n.bind(n,36961)))),Switch:(0,r.lazy)((()=>n.e(7926).then(n.bind(n,17926)))),Tab:(0,r.lazy)((()=>n.e(3624).then(n.bind(n,23624)))),Table:(0,r.lazy)((()=>n.e(2680).then(n.bind(n,2680)))),TableBody:(0,r.lazy)((()=>n.e(5893).then(n.bind(n,55893)))),TableCell:(0,r.lazy)((()=>n.e(4533).then(n.bind(n,64533)))),TableContainer:(0,r.lazy)((()=>n.e(9843).then(n.bind(n,89843)))),TableFooter:(0,r.lazy)((()=>n.e(2381).then(n.bind(n,82381)))),TableHead:(0,r.lazy)((()=>n.e(1102).then(n.bind(n,11102)))),TablePagination:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(5621)]).then(n.bind(n,54076)))),TableRow:(0,r.lazy)((()=>n.e(5798).then(n.bind(n,15798)))),TableSortLabel:(0,r.lazy)((()=>n.e(589).then(n.bind(n,60589)))),Tabs:(0,r.lazy)((()=>n.e(6779).then(n.bind(n,26779)))),TextField:(0,r.lazy)((()=>n.e(2100).then(n.bind(n,22100)))),TextareaAutosize:(0,r.lazy)((()=>n.e(1435).then(n.bind(n,31435)))),ToggleButton:(0,r.lazy)((()=>n.e(5602).then(n.bind(n,65602)))),ToggleButtonGroup:(0,r.lazy)((()=>n.e(8028).then(n.bind(n,18028)))),Toolbar:(0,r.lazy)((()=>n.e(4120).then(n.bind(n,54120)))),Tooltip:(0,r.lazy)((()=>n.e(7721).then(n.bind(n,67721)))),Typography:(0,r.lazy)((()=>n.e(9616).then(n.bind(n,19616))))},J=Object.fromEntries(Object.entries(U).map((e=>{let[t,n]=e;const o=r.forwardRef(((e,t)=>(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{}),children:(0,a.jsx)(n,{...e,ref:t})})));return o.displayName=t,[t,o]}))),X=Object.fromEntries(Object.entries(J).map((e=>{let[t,n]=e;return["@material-ui/core/"+t,n]}))),Y=Object.fromEntries(Object.entries(J).map((e=>{let[t,n]=e;return["@mui/material/"+t,n]}))),Q=(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(2528)]).then(n.bind(n,14128)))),K=(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(6596)]).then(n.bind(n,80853)))),$=(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(2088)]).then(n.bind(n,58542)))),ee={DataGrid:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.DataGrid}))))),GridActionsCellItem:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridActionsCellItem}))))),GridAddIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridAddIcon}))))),GridArrowDownwardIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridArrowDownwardIcon}))))),GridArrowUpwardIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridArrowUpwardIcon}))))),GridCellCheckboxForwardRef:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridCellCheckboxForwardRef}))))),GridCellCheckboxRenderer:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridCellCheckboxRenderer}))))),GridCheckCircleIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridCheckCircleIcon}))))),GridCheckIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridCheckIcon}))))),GridCloseIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridCloseIcon}))))),GridColumnHeaderSeparator:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridColumnHeaderSeparator}))))),GridColumnHeaderSortIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridColumnHeaderSortIcon}))))),GridColumnIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridColumnIcon}))))),GridColumnMenu:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridColumnMenu}))))),GridColumnMenuContainer:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridColumnMenuContainer}))))),GridDragIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridDragIcon}))))),GridExpandMoreIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridExpandMoreIcon}))))),GridFilterAltIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridFilterAltIcon}))))),GridFilterForm:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridFilterForm}))))),GridFilterListIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridFilterListIcon}))))),GridFilterPanel:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridFilterPanel}))))),GridFooter:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridFooter}))))),GridFooterContainer:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridFooterContainer}))))),GridHeader:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridHeader}))))),GridHeaderCheckbox:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridHeaderCheckbox}))))),GridKeyboardArrowRight:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridKeyboardArrowRight}))))),GridLoadIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridLoadIcon}))))),GridLoadingOverlay:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridLoadingOverlay}))))),GridMenuIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridMenuIcon}))))),GridMoreVertIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridMoreVertIcon}))))),GridNoRowsOverlay:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridNoRowsOverlay}))))),GridOverlay:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridOverlay}))))),GridPagination:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridPagination}))))),GridPanel:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridPanel}))))),GridPanelWrapper:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridPanelWrapper}))))),GridPreferencesPanel:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridPreferencesPanel}))))),GridRemoveIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridRemoveIcon}))))),GridRoot:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridRoot}))))),GridRowCount:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridRowCount}))))),GridSaveAltIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridSaveAltIcon}))))),GridSearchIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridSearchIcon}))))),GridSelectedRowCount:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridSelectedRowCount}))))),GridSeparatorIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridSeparatorIcon}))))),GridTableRowsIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridTableRowsIcon}))))),GridToolbar:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridToolbar}))))),GridToolbarColumnsButton:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridToolbarColumnsButton}))))),GridToolbarContainer:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridToolbarContainer}))))),GridToolbarDensitySelector:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridToolbarDensitySelector}))))),GridToolbarExport:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridToolbarExport}))))),GridToolbarExportContainer:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridToolbarExportContainer}))))),GridToolbarFilterButton:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridToolbarFilterButton}))))),GridTripleDotsVerticalIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridTripleDotsVerticalIcon}))))),GridViewHeadlineIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridViewHeadlineIcon}))))),GridViewStreamIcon:(0,r.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(4827)]).then(n.bind(n,12455)).then((e=>({default:e.GridViewStreamIcon})))))},te=Object.fromEntries(Object.entries(ee).map((e=>{let[t,n]=e;const o=r.forwardRef(((e,t)=>(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{}),children:(0,a.jsx)(n,{...e,ref:t})})));return o.displayName=t,[t,o]}))),ne=r.forwardRef(((e,t)=>(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{}),children:(0,a.jsx)(Q,{...e,ref:t})})));ne.displayName="Attributes";const re=r.forwardRef(((e,t)=>(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{}),children:(0,a.jsx)(K,{...e,ref:t})})));re.displayName="FeatureDetails";const ae=r.forwardRef(((e,t)=>(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{}),children:(0,a.jsx)($,{...e,ref:t})})));ae.displayName="BaseCard";const oe={mobx:l,"mobx-state-tree":c,react:r,"react/jsx-runtime":o,"react-dom":s,"mobx-react":d,"@mui/x-data-grid":{useGridApiContext:b.l,useGridApiRef:v.A,useGridRootProps:w.B,...te},"@mui/material/utils":y,"@material-ui/core/utils":y,"tss-react/mui":{makeStyles:u.ZL},"@material-ui/core":{...J,useTheme:f.Z,alpha:g.Fq,makeStyles:e=>{const t=(0,u.ZL)()(e);return()=>t().classes}},"@mui/material":{...J,alpha:g.Fq,useTheme:f.Z},"prop-types":h(),"@mui/material/styles":m,"@material-ui/core/styles":m,...X,...Y,"@material-ui/lab/ToggleButton":U.ToggleButton,"@material-ui/lab/ToggleButtonGroup":U.ToggleButtonGroup,"@material-ui/lab/Autocomplete":U.Autocomplete,"@material-ui/lab/Alert":U.Alert,"@material-ui/lab":{Alert:U.Alert,Autocomplete:U.Autocomplete,ToggleButton:U.ToggleButton,ToggleButtonGroup:U.ToggleButtonGroup},"@jbrowse/core/Plugin":B.Z,"@jbrowse/core/pluggableElementTypes":S,"@jbrowse/core/pluggableElementTypes/ViewType":k.Z,"@jbrowse/core/pluggableElementTypes/AdapterType":T.Z,"@jbrowse/core/pluggableElementTypes/DisplayType":P.Z,"@jbrowse/core/pluggableElementTypes/TrackType":M.Z,"@jbrowse/core/pluggableElementTypes/WidgetType":R.Z,"@jbrowse/core/pluggableElementTypes/models":A,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":I,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":N.Z,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":L,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":F,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":j,"@jbrowse/core/configuration":D,"@jbrowse/core/util/types/mst":q,"@jbrowse/core/ui":E,"@jbrowse/core/util":V,"@jbrowse/core/util/color":z,"@jbrowse/core/util/layouts":O,"@jbrowse/core/util/tracks":Z,"@jbrowse/core/util/Base1DViewModel":C.Z,"@jbrowse/core/util/io":W,"@jbrowse/core/util/mst-reflection":H,"@jbrowse/core/util/rxjs":G,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":{Attributes:ne,FeatureDetails:re,BaseCard:ae},"@jbrowse/core/data_adapters/BaseAdapter":x},ie=Object.keys(oe),se=ie.filter((e=>!_.includes(e)));if(se.length>0)throw new Error("The following modules are in the modules libs, but not the re-exports list: ".concat(se.join(", ")));const le=_.filter((e=>!ie.includes(e)));if(le.length)throw new Error("The following modules are in the re-exports list, but not the modules libs: ".concat(le.join(", ")));const ce=oe},45728:(e,t,n)=>{"use strict";n.d(t,{R:()=>a,Z:()=>r});class r{constructor(e){this.label=void 0,this.renderingComponent=void 0,this.displayString=void 0,this.matchedAttribute=void 0,this.matchedObject=void 0,this.textSearchAdapter=void 0,this.relevance=void 0,this.trackId=void 0,this.score=void 0,this.locString=void 0,this.results=void 0,this.label=e.label,this.locString=e.locString,this.renderingComponent=e.renderingComponent,this.displayString=e.displayString,this.matchedAttribute=e.matchedAttribute,this.matchedObject=e.matchedObject,this.textSearchAdapter=e.textSearchAdapter,this.relevance=e.relevance,this.trackId=e.trackId,this.score=e.score||1,this.results=e.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(e){return this.score=e,this.score}getId(){return"".concat(this.getLabel(),"-").concat(this.getLocation(),"-").concat(this.getTrackId())}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}class a extends r{constructor(e){var t;super(e),this.refName=void 0,this.refName=null!==(t=e.refName)&&void 0!==t?t:""}getLocation(){return this.refName}}},98796:(e,t,n)=>{"use strict";n.d(t,{B:()=>y,c:()=>m});var r=n(31625),a=n(1502),o=n(88826),i=n(90872);const s={stringArray:r.types.array(r.types.string),stringArrayMap:r.types.map(r.types.array(r.types.string)),numberMap:r.types.map(r.types.number),boolean:r.types.boolean,color:r.types.refinement("Color",r.types.string,(function(){return!0})),integer:r.types.integer,number:r.types.number,string:r.types.string,text:r.types.string,fileLocation:a.FileLocation,frozen:r.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},c=e=>({views:{get valueJSON(){return e.value}}}),d=e=>({views:{get valueJSON(){return JSON.stringify(e.value)}}}),u={fileLocation:d,number:c,integer:c,boolean:c,frozen:d,stringArray:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t){e.value.push(t)},removeAtIndex(t){e.value.splice(t,1)},setAtIndex(t,n){e.value[t]=n}}}),stringArrayMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)},addToKey(t,n){const r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.push(n)},removeAtKeyIndex(t,n){const r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.splice(n,1)},setAtKeyIndex(t,n,r){const a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a[n]=r}}}),numberMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,n){e.value.set(t,n)},remove(t){e.value.delete(t)}}})},p=r.types.refinement("JexlString",r.types.string,(e=>e.startsWith("jexl:")));var h=n(5074);function g(e){return Array.isArray(e)&&0===e.length}function f(e,t,n){const c={};let d;if(n.explicitlyTyped&&(c.type=r.types.optional(r.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error("Cannot have both explicit and implicit identifiers in ".concat(e));n.explicitIdentifier?"string"===typeof n.explicitIdentifier?(c[n.explicitIdentifier]=r.types.identifier,d=n.explicitIdentifier):(c.id=r.types.identifier,d="id"):n.implicitIdentifier&&("string"===typeof n.implicitIdentifier?(c[n.implicitIdentifier]=a.ElementId,d=n.implicitIdentifier):(c.id=a.ElementId,d="id"));const f={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};Object.entries(t).forEach((t=>{let[n,a]=t;if((0,r.isType)(a)&&(0,r.isLateType)(a)||(0,h.qN)(a))c[n]=a;else if("string"===typeof a||"number"===typeof a)f[n]=a;else{if("object"!==typeof a)throw new Error('invalid configuration schema definition, "'.concat(n,'" must be either a valid configuration slot definition, a constant, or a nested configuration schema'));if(!a.type)throw new Error("no type set for config slot ".concat(e,".").concat(n));try{c[n]=function(e,t){let{description:n="",model:a,type:c,defaultValue:d,contextVariable:h=[]}=t;if(!c)throw new Error("type name required");if(a||(a=s[c]),!a)throw new Error('no builtin config slot type "'.concat(c,"\", and no 'model' param provided"));if(void 0===d)throw new Error("no 'defaultValue' provided");const g="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1),"ConfigSlot");let f=r.types.model(g,{name:r.types.literal(e),description:r.types.literal(n),type:r.types.literal(c),value:r.types.optional(r.types.union(p,a),d)}).volatile((()=>({contextVariable:h}))).views((e=>({get isCallback(){return String(e.value).startsWith("jexl:")}}))).views((e=>({get expr(){if(e.isCallback){const{pluginManager:t}=(0,i.getEnv)(e);return t||"undefined"!==typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,o.P)(String(e.value),null===t||void 0===t?void 0:t.jexl)}return{evalSync:()=>e.value}},get valueJSON(){var t;if(!e.isCallback)return null!==(t=e.value)&&void 0!==t&&t.toJSON?t.toJSON():'"'.concat(t,'"')}}))).preProcessSnapshot((t=>"object"===typeof t&&t.name===e?t:{name:e,description:n,type:c,value:t})).postProcessSnapshot((e=>"object"===typeof e.value?JSON.stringify(e.value)!==JSON.stringify(d)?e.value:void 0:e.value!==d?e.value:void 0)).actions((e=>({set(t){e.value=t},reset(){e.value=d},convertToCallback(){e.isCallback||(e.value="jexl:".concat(e.valueJSON||"''"))},convertToValue(){if(e.isCallback){try{const t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(t){}if(e.value=d,e.isCallback){if(!(c in l))throw new Error("no fallbackDefault defined for type ".concat(c));e.value=l[c]}}}})));u[c]&&(f=f.extend(u[c]));const m=r.types.optional(f,{name:e,type:c,description:n,value:d});return Object.defineProperty(m,"isJBrowseConfigurationSlot",{value:!0}),m}(n,a)}catch(d){throw new Error("invalid config slot definition for ".concat(e,".").concat(n,": ").concat(d))}}}));let m=r.types.model("".concat(e,"ConfigurationSchema"),c).actions((e=>({setSubschema(t,n){if(!(0,h.qN)(c[t]))throw new Error("".concat(t," is not a subschema, cannot replace"));const a=(0,r.isStateTreeNode)(n)?n:c[t].create(n);return e[t]=a,a}})));Object.keys(f).length&&(m=m.volatile((()=>f))),n.actions&&(m=m.actions(n.actions)),n.views&&(m=m.views(n.views)),n.extend&&(m=m.extend(n.extend));const y=d?{[d]:"placeholderId"}:{},b=n.explicitlyTyped?{type:e,...y}:y,v=(0,r.getSnapshot)(m.create(b));return m=m.postProcessSnapshot((e=>{const t={};let n=!0;for(const[a,o]of Object.entries(e))n&&("object"===typeof v[a]&&"object"===typeof o?JSON.stringify(v[a])!==JSON.stringify(o)&&(n=!1):v[a]!==o&&(n=!1)),void 0!==o&&void 0===f[a]&&("object"!==typeof(r=o)||Array.isArray(r)||null===r||0!==Object.keys(r).length)&&!g(o)&&(t[a]=o);var r;return n?{}:t})),n.preProcessSnapshot&&(m=m.preProcessSnapshot(n.preProcessSnapshot)),r.types.optional(m,b)}function m(e,t,n){const{schemaDefinition:r,options:a}=function(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!==typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");let a=t,o=r;return null!==(n=r.baseConfiguration)&&void 0!==n&&n.jbrowseSchemaDefinition&&(a={...r.baseConfiguration.jbrowseSchemaDefinition,...a},o={...r.baseConfiguration.jbrowseSchemaOptions,...r},delete o.baseConfiguration),{schemaDefinition:a,options:o}}(e,t,n),o=f(e,r,a);return o.isJBrowseConfigurationSchema=!0,o.jbrowseSchemaDefinition=r,o.jbrowseSchemaOptions=a,o}function y(e){return r.types.union(r.types.reference(e),e)}},5074:(e,t,n)=>{"use strict";n.d(t,{G:()=>s,Pb:()=>l,bc:()=>i,mu:()=>u,pS:()=>o,qN:()=>c,yt:()=>d});var r=n(31625),a=n(84535);function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide conf object to read");if(!t)return JSON.parse(JSON.stringify((0,r.getSnapshot)(e)));if("string"===typeof t){let a=e[t];if(!a&&(0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(a=e.get(t)),!a)return;if(a.expr){const e=a.expr.evalSync(n);return(0,r.isStateTreeNode)(e)?JSON.parse(JSON.stringify((0,r.getSnapshot)(e))):e}return(0,r.isStateTreeNode)(a)?JSON.parse(JSON.stringify((0,r.getSnapshot)(a))):a}if(Array.isArray(t)){const a=t[0];if(t.length>1){const i=t.slice(1);let s=e[a];return!s&&(0,r.isStateTreeNode)(e)&&(0,r.isMapType)((0,r.getType)(e))&&(s=e.get(a)),s?o(s,i,n):void 0}return o(e,a,n)}throw new TypeError("slotPath must be a string or array")}function i(e,t,n){if(!e)throw new TypeError("must provide a model object");const{configuration:r}=e;if(d(r))return o(r,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if((0,r.isType)(e)&&(e=(0,a.resolveLateType)(e),(0,r.isUnionType)(e))){const t=[];return(0,a.getUnionSubTypes)(e).forEach((e=>{let n=s(e=(0,a.resolveLateType)(e));if(!n.length){n=[(0,a.getDefaultValue)(e).type]}if(!n[0])throw new Error("invalid config schema type ".concat(e));t.push(...n)})),t}return[]}function l(e){if((0,r.isType)(e)){if((0,r.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,r.isLateType)(e))return!0}return!1}function c(e){return!!(0,r.isType)(e)&&(!!l(e)||((0,r.isUnionType)(e)?(0,a.getUnionSubTypes)(e).every((e=>c(e)||"undefined"===e.name)):!(!(0,r.isOptionalType)(e)||!c((0,a.getSubType)(e)))||(!(!(0,r.isArrayType)(e)||!c((0,a.getSubType)(e)))||!(!(0,r.isMapType)(e)||!c((0,a.getSubType)(e))))))}function d(e){return(0,r.isStateTreeNode)(e)&&c((0,r.getType)(e))}function u(e){return"object"===typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},56798:(e,t,n)=>{"use strict";function r(e){return"getRegions"in e&&"getFeatures"in e}function a(e){return"getRegions"in e}function o(e){return"getFeatures"in e}function i(e){return"getRefNameAliases"in e}function s(e){return"searchIndex"in e}n.r(t),n.d(t,{BaseAdapter:()=>p,BaseFeatureDataAdapter:()=>v,BaseSequenceAdapter:()=>w,isFeatureAdapter:()=>o,isRefNameAliasAdapter:()=>i,isRegionsAdapter:()=>a,isSequenceAdapter:()=>r,isTextSearchAdapter:()=>s});var l=n(31625),c=n(43800),d=n(6416);const u=(0,c.ConfigurationSchema)("empty",{});class p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.create(),t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;if(this.config=e,this.getSubAdapter=t,this.pluginManager=n,this.id=void 0,"undefined"===typeof jest){const t=(0,l.isStateTreeNode)(e)?(0,l.getSnapshot)(e):e;this.id="".concat((0,d.Z)(t))}else this.id="test"}getConf(e){return(0,c.readConfObject)(this.config,e)}}p.capabilities=[];var h=n(54909),g=n(24201),f=n(26138),m=n(16979),y=n(90872),b=n(81025);class v extends p{async getHeader(e){return null}async getMetadata(e){return null}getFeaturesInRegion(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.ObservableCreate)((async n=>{const r=await this.hasDataForRefName(e.refName,t);(0,y.checkAbortSignal)(t.signal),r?this.getFeatures(e,t).subscribe(n):n.complete()}))}getFeaturesInMultipleRegions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,h.T)(...e.map((e=>this.getFeaturesInRegion(e,t))))}async hasDataForRefName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(await this.getRefNames(t)).includes(e)}async getRegionQuantitativeStats(e,t){const n=this.getFeatures(e,t);return(0,b.fK)(e,n)}async getMultiRegionQuantitativeStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!e.length)return(0,b.fY)();const n=await Promise.all(e.map((e=>this.getRegionQuantitativeStats(e,t)))),r=(0,y.max)(n.map((e=>e.scoreMax))),a=(0,y.min)(n.map((e=>e.scoreMin))),o=(0,y.sum)(n.map((e=>e.scoreSum))),i=(0,y.sum)(n.map((e=>e.scoreSumSquares))),s=(0,y.sum)(n.map((e=>e.featureCount))),l=(0,y.sum)(n.map((e=>e.basesCovered)));return(0,b.I9)({scoreMin:a,scoreMax:r,featureCount:s,basesCovered:l,scoreSumSquares:i,scoreSum:o})}getRegionFeatureDensityStats(e,t){let n=+Date.now();const r=async(n,r)=>{const{start:o,end:i}=e,s=.75*o+.25*i,l=await(0,g.z)(this.getFeatures({...e,start:Math.max(0,Math.round(s-n/2)),end:Math.min(Math.round(s+n/2),i)},t).pipe((0,f.q)()));return a(n,{featureDensity:l.length/n},l.length,r)},a=async(t,a,o,i)=>{const s=e.end-e.start;if(o>=70||2*t>s)return a;if(i<=5e3){const e=+Date.now();return i+=e-n,n=e,r(2*t,i)}return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:Number.POSITIVE_INFINITY}};return r(1e3,0)}async getMultiRegionFeatureDensityStats(e,t){if(!e.length)throw new Error("No regions supplied");return this.getRegionFeatureDensityStats(e[0],t)}}class w extends v{async getMultiRegionFeatureDensityStats(){return{featureDensity:0}}}},93912:(e,t,n)=>{"use strict";n.d(t,{Yr:()=>i,uP:()=>o});var r=n(6416);let a={};async function o(e,t,n){const i=(s=n,"".concat((0,r.Z)(s)));var s;if(!a[i]){const r=null===n||void 0===n?void 0:n.type;if(!r)throw new Error("could not determine adapter type from adapter config snapshot ".concat(JSON.stringify(n)));const s=e.getAdapterType(r);if(!s)throw new Error("unknown data adapter type ".concat(r));const l=s.configSchema.create(n,{pluginManager:e}),c=o.bind(null,e,t),{AdapterClass:d,getAdapterClass:u}=s,p=d||await u();if(!p)throw new Error("Failed to get adapter");const h=new p(l,c,e);a[i]={dataAdapter:h,sessionIds:new Set([t])}}const l=a[i];return l.sessionIds.add(t),l}function i(e){let t=0;const n=Object.keys(e);if(1===n.length&&"sessionId"===n[0]){const{sessionId:n}=e;Object.entries(a).forEach((e=>{let[r,o]=e;o.sessionIds.delete(n),0===o.sessionIds.size&&(t+=1,delete a[r])}))}else Object.values(a).forEach((t=>{if(t.dataAdapter.freeResources){const n=e.regions||(e.region?[e.region]:[]);for(const e of n)void 0!==e.refName&&t.dataAdapter.freeResources(e)}else console.warn(t.dataAdapter,"does not implement freeResources")}));return t}},31640:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(28542);class a extends r.Z{constructor(e){if(super(e),this.AdapterClass=void 0,this.getAdapterClass=void 0,this.configSchema=void 0,this.adapterCapabilities=void 0,this.adapterMetadata=void 0,"AdapterClass"in e)this.AdapterClass=e.AdapterClass,this.getAdapterClass=async()=>e.AdapterClass;else{if(!("getAdapterClass"in e))throw new Error("no AdapterClass or getAdapterClass is defined for adapter type ".concat(this.name));this.getAdapterClass=e.getAdapterClass}this.configSchema=e.configSchema,this.adapterCapabilities=e.adapterCapabilities||[],this.adapterMetadata=e.adapterMetadata}}},75444:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(28542);class a extends r.Z{constructor(e){if(super(e),this.ReactComponent=void 0,this.stateModel=void 0,this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel,!this.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(this.name));if(!this.stateModel)throw new Error("no stateModel defined for view ".concat(this.name))}}},66511:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(28542);class a extends r.Z{constructor(e){if(super(e),this.stateModel=void 0,this.configSchema=void 0,this.description=void 0,this.url=void 0,this.configEditorComponent=void 0,this.stateModel=e.stateModel,this.configSchema=e.configSchema,this.description=e.description,this.url=e.url,this.configEditorComponent=e.configEditorComponent,!this.stateModel)throw new Error("no stateModel defined for connection ".concat(this.name));if(!this.configSchema)throw new Error("no configSchema defined for connection ".concat(this.name))}}},63048:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(28542),a=n(84535);class o extends r.Z{constructor(e){if(super(e),this.stateModel=void 0,this.configSchema=void 0,this.ReactComponent=void 0,this.trackType=void 0,this.subDisplay=void 0,this.viewType=void 0,this.stateModel=e.stateModel,this.subDisplay=e.subDisplay,this.configSchema=e.configSchema,this.ReactComponent=e.ReactComponent,this.trackType=e.trackType,this.viewType=e.viewType,!this.stateModel)throw new Error("no stateModel defined for display ".concat(this.name));if(!this.configSchema)throw new Error("no configSchema provided for display ".concat(this.name));if(!this.ReactComponent)throw new Error("no ReactComponent provided for display ".concat(this.name));if(!this.trackType)throw new Error("no trackType provided for display ".concat(this.name));if(!this.viewType)throw new Error("no viewType provided for display ".concat(this.name));if(!(0,a.getDefaultValue)(this.configSchema).type){const e=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error("".concat(e," is not explicitlyTyped"))}}}},99831:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(28542),a=n(84535);class o extends r.Z{constructor(e){if(super(e),this.stateModel=void 0,this.configSchema=void 0,this.stateModel=e.stateModel,this.configSchema=e.configSchema,!this.stateModel)throw new Error("no stateModel defined for internet account type ".concat(this.name));if(!this.configSchema)throw new Error("no configSchema provided for internet account type ".concat(this.name));if(!(0,a.getDefaultValue)(this.configSchema).type){const e=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error("".concat(e," is not explicitlyTyped"))}}}},28542:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class r{constructor(e){this.name=void 0,this.maybeDisplayName=void 0,this.name=e.name||"UNKNOWN",this.maybeDisplayName=e.displayName}get displayName(){return this.maybeDisplayName||this.name}}},83015:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});const r=e=>"object"===typeof e&&null!==e,a=e=>r(e)&&!(e instanceof RegExp)&&!(e instanceof Error)&&!(e instanceof Date)&&!(globalThis.Blob&&e instanceof globalThis.Blob);function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new WeakSet;if(n.has(e))return;n.add(e);const i=e=>e.forEach((e=>{t(e),r(e)&&o(e,t,n)}));Array.isArray(e)&&i(e);for(const r of Object.values(e))t(r),a(r)&&(Array.isArray(r)?i(r):o(r,t,n))}var i=n(28542),s=n(99512),l=n(55022),c=n(58062);class d extends i.Z{constructor(e){super({}),this.pluginManager=e}async serializeArguments(e,t){const n=(0,s.getBlobMap)();return await this.augmentLocationObjects(e,t),{...e,blobMap:n}}async serializeNewAuthArguments(e,t){const n=this.pluginManager.rootModel;if(!(0,l.dc)(n)||e.internetAccountPreAuthorization)return e;const r=n.findAppropriateInternetAccount(e);return r&&"MainThreadRpcDriver"!==t&&(e.internetAccountPreAuthorization=await r.getPreAuthorizationInformation(e)),e}async deserializeArguments(e,t){e.blobMap&&(0,s.setBlobMap)(e.blobMap);const{signal:n}=e;return{...e,signal:(0,c.k$)(n)?(0,c.ie)(n):void 0}}async serializeReturn(e,t,n){return e}async deserializeReturn(e,t,n){let r;try{r=await e}catch(o){if((0,l.PK)(o)){var a;const e=null===(a=this.pluginManager.rootModel)||void 0===a?void 0:a.createEphemeralInternetAccount("HTTPBasicInternetAccount-".concat(new URL(o.url).origin),{},o.url);throw new l.Ms("Retrying with created internet account",e.internetAccountId)}throw o}return r}async augmentLocationObjects(e,t){const n=[];o(e,(e=>{(0,l.hb)(e)&&n.push(e)}));for(const r of n)await this.serializeNewAuthArguments(r,t);return e}}},49368:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(28542);class a extends r.Z{constructor(e){if(super(e),this.AdapterClass=void 0,this.configSchema=void 0,this.description=void 0,this.description=e.description,this.configSchema=e.configSchema,this.AdapterClass=e.AdapterClass,!this.AdapterClass)throw new Error("no AdapterClass defined for adapter type ".concat(this.name))}}},5889:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(28542),a=n(84535);class o extends r.Z{constructor(e){if(super(e),this.stateModel=void 0,this.configSchema=void 0,this.displayTypes=[],this.stateModel=e.stateModel,this.configSchema=e.configSchema,!this.stateModel)throw new Error("no stateModel defined for track ".concat(this.name));if(!this.configSchema)throw new Error("no configSchema provided for track ".concat(this.name));if(!(0,a.getDefaultValue)(this.configSchema).type){const e=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error("".concat(e," is not explicitlyTyped"))}}addDisplayType(e){this.displayTypes.push(e)}}},59366:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(28542);class a extends r.Z{constructor(e){if(super(e),this.ReactComponent=void 0,this.stateModel=void 0,this.displayTypes=[],this.extendedName=void 0,this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel,this.extendedName=e.extendedName,!this.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(this.name));if(!this.stateModel)throw new Error("no stateModel defined for view ".concat(this.name))}addDisplayType(e){this.displayTypes.push(e)}}},25077:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(28542);class a extends r.Z{constructor(e){if(super(e),this.heading=void 0,this.configSchema=void 0,this.HeadingComponent=void 0,this.ReactComponent=void 0,this.stateModel=void 0,this.heading=e.heading,this.HeadingComponent=e.HeadingComponent,this.configSchema=e.configSchema,this.stateModel=e.stateModel,this.ReactComponent=e.ReactComponent,!this.ReactComponent)throw new Error("no ReactComponent defined for widget ".concat(this.name));if(!this.stateModel)throw new Error("no stateModel defined for widget ".concat(this.name))}}},20592:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AdapterType:()=>u.Z,AddTrackWorkflowType:()=>v.Z,BaseConnectionModelFactory:()=>d.BaseConnectionModelFactory,BaseDisplay:()=>d.BaseDisplay,BaseInternetAccountConfig:()=>d.BaseInternetAccountConfig,BaseViewModel:()=>d.BaseViewModel,BoxRendererType:()=>r.default,CircularChordRendererType:()=>o.Z,ComparativeServerSideRendererType:()=>a.Z,ConnectionType:()=>p.Z,DisplayType:()=>m.Z,FeatureRendererType:()=>s.default,InternetAccount:()=>d.InternetAccount,InternetAccountType:()=>y.Z,RendererType:()=>i.default,RpcMethodType:()=>b.Z,ServerSideRenderedContent:()=>l.Z,ServerSideRendererType:()=>c.default,TextSearchAdapterType:()=>w.Z,TrackType:()=>h.Z,ViewType:()=>f.Z,WidgetType:()=>g.Z,baseConnectionConfig:()=>d.baseConnectionConfig,createBaseTrackConfig:()=>d.createBaseTrackConfig,createBaseTrackModel:()=>d.createBaseTrackModel});var r=n(88016),a=n(52398),o=n(25216),i=n(14331),s=n(90176),l=n(97198),c=n(96595),d=n(88057),u=n(31640),p=n(66511),h=n(5889),g=n(25077),f=n(59366),m=n(63048),y=n(99831),b=n(83015),v=n(75444),w=n(49368)},77911:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(31625),a=n(1502);const o=r.types.model("BaseView",{id:a.ElementId,displayName:r.types.maybe(r.types.string),minimized:!1}).volatile((()=>({width:800}))).views((()=>({menuItems:()=>[]}))).actions((e=>({setDisplayName(t){e.displayName=t},setWidth(t){e.width=t},setMinimized(t){e.minimized=t}}))),i=o;o.props({displayedRegions:r.types.array(a.Region)})},88057:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BaseConnectionModelFactory:()=>i,BaseDisplay:()=>u,BaseInternetAccountConfig:()=>h,BaseViewModel:()=>s.Z,InternetAccount:()=>f,baseConnectionConfig:()=>a,createBaseTrackConfig:()=>E,createBaseTrackModel:()=>B});var r=n(43800);const a=(0,r.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"});var o=n(31625);const i=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track")),configuration:(0,r.ConfigurationReference)(a)}).actions((()=>({connect(e){}}))).actions((e=>({afterAttach(){0===e.tracks.length&&e.connect(e.configuration)},addTrackConf(t){const n=e.tracks.push(t);return e.tracks[n-1]},addTrackConfs(t){const n=e.tracks.push(...t);return e.tracks.slice(n-1-t.length,n-1)},setTrackConfs:t=>(e.tracks=(0,o.cast)(t),e.tracks),clear(){}})))};var s=n(77911),l=n(99512),c=n(90872),d=n(1502);const u=o.types.model("BaseDisplay",{id:d.ElementId,type:o.types.string,rpcDriverName:o.types.maybe(o.types.string)}).volatile((()=>({rendererTypeName:"",error:void 0,message:void 0}))).views((e=>({get RenderingComponent(){const{pluginManager:t}=(0,c.getEnv)(e);return t.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,r.getConf)(this.parentTrack,"adapter")},get parentTrack(){let t=(0,o.getParent)(e);for(;!t.configuration||!(0,r.getConf)(t,"trackId");){if((0,o.isRoot)(t))throw new Error("No parent track found for ".concat(e.type," ").concat(e.id));t=(0,o.getParent)(t)}return t},renderProps:()=>({...(0,l.getParentRenderProps)(e),notReady:(0,c.getContainingView)(e).minimized,rpcDriverName:e.rpcDriverName,displayModel:e}),get rendererType(){const{pluginManager:t}=(0,c.getEnv)(e),n=t.getRendererType(e.rendererTypeName);if(!n)throw new Error('renderer "'.concat(e.rendererTypeName,'" not found'));if(!n.ReactComponent)throw new Error("renderer ".concat(e.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return n},get DisplayMessageComponent(){},trackMenuItems:()=>[],get viewMenuActions(){return[]},regionCannotBeRendered:()=>null}))).actions((e=>({setMessage(t){e.message=t},setError(t){e.error=t},setRpcDriverName(t){e.rpcDriverName=t},reload(){}})));var p=n(59062);const h=(0,r.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0}),g="undefined"===typeof sessionStorage;const f=o.types.model("InternetAccount",{id:d.ElementId,type:o.types.string,configuration:(0,r.ConfigurationReference)(h)}).views((e=>({get name(){return(0,r.getConf)(e,"name")},get description(){return(0,r.getConf)(e,"description")},get internetAccountId(){return(0,r.getConf)(e,"internetAccountId")},get authHeader(){return(0,r.getConf)(e,"authHeader")},get tokenType(){return(0,r.getConf)(e,"tokenType")},get domains(){return(0,r.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}}))).views((e=>({handlesLocation:t=>e.domains.some((e=>null===t||void 0===t?void 0:t.uri.includes(e))),get tokenKey(){return"".concat(e.internetAccountId,"-token")}}))).actions((e=>({getTokenFromUser(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken(t){sessionStorage.setItem(e.tokenKey,t)},removeToken(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:()=>sessionStorage.getItem(e.tokenKey),validateToken:async(e,t)=>e}))).actions((e=>{let t;return{async getToken(n){var r,a;if(t)return t;let o=null===n||void 0===n||null===(r=n.internetAccountPreAuthorization)||void 0===r||null===(a=r.authInfo)||void 0===a?void 0:a.token;if(o)return t=Promise.resolve(o),t;if(g)throw new Error("Did not get internet account pre-authorization info in worker");return o=e.retrieveToken(),o?(t=Promise.resolve(o),t):(t=new Promise(((t,n)=>e.getTokenFromUser((n=>{e.storeToken(n),t(n)}),(t=>{e.removeToken(),n(t)})))),t)}}})).actions((e=>({addAuthHeaderToInit(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return{...t,headers:new Headers({...t.headers,[e.authHeader]:e.tokenType?"".concat(e.tokenType," ").concat(n):n})}},async getPreAuthorizationInformation(t){const n=await e.getToken(t);let a;try{a=await e.validateToken(n,t)}catch(o){throw e.removeToken(),o}return{internetAccountType:e.type,authInfo:{token:a,configuration:(0,r.getConf)(e)}}}}))).actions((e=>({getFetcher:t=>async(n,r)=>{const a=await e.getToken(t),o=e.addAuthHeaderToInit(r,a);return fetch(n,o)}}))).actions((e=>({openLocation:t=>new p.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})})));var m=n(41867),y=n(85815),b=n(24728),v=n(55022);const w=new Set(["uniqueId","refName","source","type","start","end","strand","parent","parentId","score","subfeatures","phase"]),x={id:"ID",name:"Name",alias:"Alias",parent:"Parent",target:"Target",gap:"Gap",derives_from:"Derives_from",note:"Note",description:"Note",dbxref:"Dbxref",ontology_term:"Ontology_term",is_circular:"Is_circular"};function C(e){return Array.isArray(e)?e.map((e=>C(e))).join(","):"object"===typeof e?JSON.stringify(e):"".concat(e)}function S(e,t,n){var r;const a=n||e.get("refName"),o=e.get("id"),i=function(e,t,n){return[e.get("refName")||n,e.get("source")||".",e.get("type")||".",e.get("start")+1,e.get("end"),e.get("score")||".",1===e.get("strand")?"+":-1===e.get("strand")?"-":".",e.get("phase")||".",(t?"Parent=".concat(t,";"):"")+e.tags().filter((e=>!w.has(e))).map((t=>[t,C(e.get(t))])).filter((e=>!!e[1])).map((e=>"".concat(x[e[0]]||e[0],"=").concat(e[1]))).join(";")].join("\t")}(e,t,a);return[i,...(null===(r=e.get("subfeatures"))||void 0===r?void 0:r.map((e=>S(e,o,a))))||[]].join("\n")}function k(e){let{features:t}=e;return["##gff-version 3",...t.map((e=>S(e)))].join("\n")}const T=new Set(["uniqueId","refName","source","type","start","end","strand","parent","parentId","score","subfeatures","phase"]),P="                     ",M={name:"Name"};function R(e){return Array.isArray(e)?e.map((e=>R(e))).join(","):"object"===typeof e?JSON.stringify(e):"".concat(e)}function A(e,t,n){return[t&&n?"".concat(P,"/").concat(n,'="').concat(t,'"'):"",e.get("id")?"".concat(P,"/name=").concat(e.get("id")):"",...e.tags().filter((e=>!T.has(e))).map((t=>[t,R(e.get(t))])).filter((e=>!!e[1]&&e[0]!==n)).map((e=>"".concat(P,"/").concat(M[e[0]]||e[0],'="').concat(e[1],'"')))].filter((e=>!!e))}function I(e,t){return"".concat(function(e,t){return e.get("start")-t+1}(e,t),"..").concat(function(e,t){return e.get("end")-t}(e,t))}function N(e,t,n,r,a){const o=e.map((e=>I(e,a))),i="join(".concat(o,")"),s=-1===r?"complement(".concat(i,")"):i;return e.length?["     ".concat("CDS".padEnd(16)).concat(s),"".concat(P,"/").concat(n,'="').concat(t,'"')]:[]}function L(e,t,n,r){const a=function(e,t,n,r){const a="".concat(e.get("type")).slice(0,16),o=I(e,t),i=-1===e.get("strand")?"complement(".concat(o,")"):o;return["     ".concat(a.padEnd(16)).concat(i),...A(e,n,r)]}(e,t,n,r),o=e.get("subfeatures")||[],i=o.filter((e=>"CDS"===e.get("type"))),s=o.filter((e=>"CDS"!==e.get("type")&&"exon"!==e.get("type"))),l=e.get("id"),c=e.get("type"),d=e.get("strand");return[...a,...N(i,l,c,d,t),...s.flatMap((e=>L(e,t,l,c)))].join("\n")}async function F(e){let{features:t,assemblyName:n,session:a}=e;const o=new Date,i=o.toLocaleString("en-US",{month:"short"}).toUpperCase(),s=o.toLocaleString("en-US",{day:"numeric"}),l=o.toLocaleString("en-US",{year:"numeric"}),d="".concat(s,"-").concat(i,"-").concat(l),u=(0,c.min)(t.map((e=>e.get("start")))),p=(0,c.max)(t.map((e=>e.get("end")))),h=p-u,g=t[0].get("refName"),f=["".concat("LOCUS".padEnd(12)),"".concat(g,":").concat(u+1,"..").concat(p).padEnd(20)," ".concat("".concat(h," bp")).padEnd(15)," ".concat("DNA".padEnd(10)),"".concat("linear".padEnd(10)),"".concat("UNK "+d)].join(""),m=await async function(e){let{session:t,regions:n,signal:a,assemblyName:o}=e;const{rpcManager:i,assemblyManager:s}=t,l=s.get(o);if(!l)throw new Error("assembly ".concat(o," not found"));const c="getSequence";return i.call(c,"CoreGetFeatures",{adapterConfig:(0,r.getConf)(l,["sequence","adapter"]),regions:n.map((e=>({...e,refName:l.getCanonicalRefName(e.refName)}))),sessionId:c,signal:a})}({session:a,assemblyName:n,regions:[{assemblyName:n,start:u,end:p,refName:g}]}),y=m.map((e=>e.get("seq")||"")).join("");return[f,"FEATURES             Location/Qualifiers",...t.map((e=>L(e,u))),...["ORIGIN","\t1 ".concat(y),"//"]].join("\n")}function j(e){let{features:t}=e;const n=["refName","start","end","name","score","strand"];return t.map((e=>n.map((t=>e.get(t))).join("\t").trim())).join("\n")}const D=(0,m.lazy)((()=>n.e(2746).then(n.bind(n,52746))));function B(e,t,n){return o.types.model(t,{id:d.ElementId,type:o.types.literal(t),configuration:(0,r.ConfigurationReference)(n),minimized:!1,displays:o.types.array(e.pluggableMstType("display","stateModel"))}).views((t=>({get rpcSessionId(){var e;return null===(e=t.configuration)||void 0===e?void 0:e.trackId},get name(){return(0,r.getConf)(t,"name")},get textSearchAdapter(){return(0,r.getConf)(t,"textSearchAdapter")},get adapterType(){const n=(0,r.getConf)(t,"adapter");if(!n)throw new Error("no adapter configuration provided for ".concat(t.type));const a=e.getAdapterType(n.type);if(!a)throw new Error("unknown adapter type ".concat(n.type));return a},get viewMenuActions(){return t.displays.flatMap((e=>e.viewMenuActions))},get canConfigure(){const e=(0,c.getSession)(t),{sessionTracks:n,adminMode:r}=e;return(0,v.cX)(e)&&(r||(null===n||void 0===n?void 0:n.find((e=>{var n;return e.trackId===(null===(n=t.configuration)||void 0===n?void 0:n.trackId)}))))}}))).actions((t=>({setMinimized(e){t.minimized=e},showDisplay(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=e.pluggableConfigSchemaType("display"),i=(0,o.resolveIdentifier)(a,(0,o.getRoot)(t),n),s=e.getDisplayType(i.type);if(!s)throw new Error("unknown display type ".concat(i.type));const l=s.stateModel.create({...r,type:i.type,configuration:i});t.displays.push(l)},hideDisplay(n){const r=e.pluggableConfigSchemaType("display"),a=(0,o.resolveIdentifier)(r,(0,o.getRoot)(t),n),i=t.displays.filter((e=>e.configuration===a));return(0,y.transaction)((()=>i.forEach((e=>t.displays.remove(e))))),i.length},replaceDisplay(n,r){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.displays.findIndex((e=>e.configuration.displayId===n));if(-1===i)throw new Error("could not find display id ".concat(n," to replace"));const s=e.pluggableConfigSchemaType("display"),l=(0,o.resolveIdentifier)(s,(0,o.getRoot)(t),r);if(!e.getDisplayType(l.type))throw new Error("unknown display type ".concat(l.type));t.displays.splice(i,1,{...a,type:l.type,configuration:l})}}))).views((()=>({saveTrackFileFormatOptions:()=>({gff3:{name:"GFF3",extension:"gff3",callback:k},genbank:{name:"GenBank",extension:"gbk",callback:F},bed:{name:"BED",extension:"bed",callback:j}})}))).views((t=>({trackMenuItems(){const n=t.displays.flatMap((e=>e.trackMenuItems())),r=t.displays[0].configuration.displayId,a=function(e){const{pluginManager:t}=(0,c.getEnv)(e),n=(0,c.getContainingView)(e),r=t.getViewType(n.type),a=new Set(r.displayTypes.map((e=>e.name)));return e.configuration.displays.filter((e=>a.has(e.type)))}(t);return[...n,{label:"Save track data",icon:b.vc,onClick:()=>{(0,c.getSession)(t).queueDialog((e=>[D,{model:t,handleClose:e}]))}},...a.length>1?[{type:"subMenu",label:"Display types",subMenu:a.map((n=>({type:"radio",label:e.getDisplayType(n.type).displayName,checked:n.displayId===r,onClick:()=>t.replaceDisplay(r,n.displayId)})))}]:[]]}})))}function E(e){return(0,r.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,r.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:o.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,r.ConfigurationSchema)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2"}}),formatAbout:(0,r.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const n=e.evaluateExtensionPoint("Core-preProcessTrackConfig",JSON.parse(JSON.stringify(t))),{displays:r=[]}=n;if("placeholderId"!==n.trackId){const t=new Set(r.filter((e=>!!e)).map((e=>e.type)));e.getTrackType(n.type).displayTypes.forEach((e=>{t.has(e.name)||r.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})}))}return{...n,displays:r}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:n}=t;if(!n)throw new Error("unknown display type ".concat(n));const r=e.displays.find((e=>(null===e||void 0===e?void 0:e.displayId)===t.displayId));if(r)return r;const a=e.displays.push(t);return e.displays[a-1]}})})}},88016:(e,t,n)=>{"use strict";n.r(t),n.d(t,{LayoutSession:()=>u,default:()=>p});var r=n(34399),a=n.n(r),o=n(42904),i=n(59612),s=n(54691),l=n(90176),c=n(90872),d=n(43800);class u{constructor(e){this.config=void 0,this.bpPerPx=void 0,this.filters=void 0,this.cachedLayout=void 0,this.config=e.config,this.bpPerPx=e.bpPerPx,this.filters=e.filters,this.update(e)}update(e){Object.assign(this,e)}makeLayout(){return new i.Z(o.Z,{maxHeight:(0,d.readConfObject)(this.config,"maxHeight"),displayMode:(0,d.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:(0,d.readConfObject)(this.config,"noSpacing")?1:3})}cachedLayoutIsValid(e){return e&&e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&a()((0,d.readConfObject)(this.config),e.config)&&a()(this.filters,e.filters)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,d.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}class p extends l.default{constructor(){super(...arguments),this.sessions={}}getWorkerSession(e){const t=(0,c.getLayoutId)(e);this.sessions[t]||(this.sessions[t]=this.createSession(e));const n=this.sessions[t];return n.update(e),n}getExpandedRegion(e,t){if(!e)return e;const{bpPerPx:n,config:r}=t,a=void 0===r?0:(0,d.readConfObject)(r,"maxFeatureGlyphExpansion");if(!a)return e;const o=Math.round(a*n);return{...e,start:Math.floor(Math.max(e.start-o,0)),end:Math.ceil(e.end+o)}}createSession(e){return new u(e)}async freeResourcesInClient(e,t){const{regions:n}=t,r=(0,c.getLayoutId)(t);let a=0;const o=this.sessions[r];return!n&&o&&(delete this.sessions[r],a=1),o&&n&&o.layout.discardRange(n[0].refName,n[0].start,n[0].end),a+await super.freeResourcesInClient(e,t)}deserializeLayoutInClient(e){return new s.Z(e)}deserializeResultsInClient(e,t){const n=this.deserializeLayoutInClient(e.layout);return super.deserializeResultsInClient({...e,layout:n},t)}createLayoutInWorker(e){const{regions:t}=e;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}serializeResultsInWorker(e,t){const n=super.serializeResultsInWorker(e,t),[r]=t.regions;return n.layout=e.layout.serializeRegion(this.getExpandedRegion(r,t)),n.layout.rectangles&&(n.features=n.features.filter((e=>Boolean(n.layout.rectangles[e.uniqueId])))),n.maxHeightReached=n.layout.maxHeightReached,n}async render(e){const t=e.layout||this.createLayoutInWorker(e);return{...await super.render({...e,layout:t}),layout:t}}}},25216:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r=n(41867),a=n(90872),o=n(90176),i=n(3762),s=n(81096),l=n(35421),c=n(31625),d=n(47155),u=n(80838);const p=(0,i.observer)((function(e){const{html:t,theme:n,RenderingComponent:o,...i}=e,d=(0,r.useRef)(null),p=(0,r.useRef)(),h=(0,c.getRoot)(e.displayModel).hydrateFn;return(0,r.useEffect)((()=>{const e=(0,a.rIC)((()=>{var e;if(!d.current)return;const t=(0,l.createJBrowseTheme)(n);p.current=null!==(e=p.current)&&void 0!==e?e:h(d.current,(0,u.jsx)(s.Z,{theme:t,children:(0,u.jsx)(o,{...i})}))}));return()=>{clearTimeout(e);const t=p.current;p.current=void 0,setTimeout((()=>{null===t||void 0===t||t.unmount()}))}}),[t,o,h,n,e,i]),(0,u.jsx)("g",{ref:d,dangerouslySetInnerHTML:{__html:t}})})),h=(0,i.observer)((function(e){const{html:t,RenderingComponent:n}=e,o=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const r=o.current;return r&&t&&(r.innerHTML&&(0,d.unmountComponentAtNode)(r),r.style.outline="none",r.innerHTML=t,(0,a.rIC)((()=>{(0,d.hydrate)((0,u.jsx)(n,{...e}),r)}))),()=>{r&&(0,d.unmountComponentAtNode)(r)}}),[t,n,e]),(0,u.jsx)("g",{ref:o})})),g=(0,i.observer)((function(e){return(0,c.getRoot)(e.displayModel).hydrateFn?(0,u.jsx)(p,{...e}):(0,u.jsx)(h,{...e})}));class f extends o.default{constructor(){super(...arguments),this.supportsSVG=!0}deserializeResultsInClient(e,t){const n=new Map(e.features.map((e=>a.SimpleFeature.fromJSON(e))).map((e=>[e.id(),e])));return t.exportSVG?{...e,features:n,blockKey:"circularChord",html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,features:n,blockKey:"circularChord",reactElement:(0,u.jsx)(g,{...t,...e,features:n,RenderingComponent:this.ReactComponent})}}}},52398:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(85164),a=n(26138),o=n(96595),i=n(93912),s=n(90872),l=n(24201);class c extends o.default{async renameRegionsIfNeeded(e){return e}serializeArgsInClient(e){const t={...e,displayModel:{}};return super.serializeArgsInClient(t)}deserializeResultsInClient(e,t){return{...super.deserializeResultsInClient(e,t),blockKey:t.blockKey}}async renderInClient(e,t){const n=await e.call(t.sessionId,"ComparativeRender",t);return"canvasRecordedData"in n&&(n.html=await(0,s.getSerializedSvg)(n),delete n.reactElement),n}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async getFeatures(e){const t=this.pluginManager,{sessionId:n,adapterConfig:o}=e,{dataAdapter:c}=await(0,i.uP)(t,n,o),d=e.regions;if(!d||0===d.length)return console.warn("no regions supplied to comparative renderer"),[];const u=d.map((e=>{const t={...e};return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),p=await(0,l.z)(c.getFeaturesInMultipleRegions(u,e).pipe((0,r.h)((t=>this.featurePassesFilters(e,t))),(0,a.q)()));return(0,s.dedupe)(p,(e=>e.id()))}}},90176:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n(26138),a=n(25217),o=n.n(a),i=n(24201),s=n(90872),l=n(85291),c=n(93912),d=n(96595),u=n(56798);class p extends d.default{serializeArgsInClient(e){const{displayModel:t,regions:n}=e,r={...e,displayModel:t&&{id:t.id,selectedFeatureId:t.selectedFeatureId},regions:o()(n)};return super.serializeArgsInClient(r)}deserializeResultsInClient(e,t){const n=new Map(e.features.map((e=>l.Z.fromJSON(e))).map((e=>[e.id(),e])));return{...super.deserializeResultsInClient({...e,features:n},t),blockKey:t.blockKey,features:n}}serializeResultsInWorker(e,t){const n=super.serializeResultsInWorker(e,t),{features:r}=e;return{...n,features:(0,s.iterMap)(r.values(),(e=>e.toJSON()),r.size)}}getExpandedRegion(e,t){return e}async getFeatures(e){const t=this.pluginManager,{signal:n,regions:a,sessionId:o,adapterConfig:l}=e,{dataAdapter:d}=await(0,c.uP)(t,o,l);if(!(0,u.isFeatureAdapter)(d))throw new Error("Adapter does not support retrieving features");const p=new Map;if(!a||0===a.length)return p;const h=a.map((e=>{const t={...e};return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.ceil(t.end)),t})),g=h[0],f=1===h.length?d.getFeatures(this.getExpandedRegion(g,e),e):d.getFeaturesInMultipleRegions(h,e),m=await(0,i.z)(f.pipe((0,r.q)()));return(0,s.checkAbortSignal)(n),new Map(m.filter((t=>this.featurePassesFilters(e,t))).map((e=>[e.id(),e])))}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async render(e){const t=e.features||await this.getFeatures(e);return{...await super.render({...e,features:t}),features:t}}}},14331:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});var r=n(41867),a=n(84535),o=n(28542);class i extends o.Z{constructor(e){if(super(e),this.ReactComponent=void 0,this.supportsSVG=!0,this.configSchema=void 0,this.pluginManager=void 0,this.ReactComponent=e.ReactComponent,this.configSchema=e.configSchema,this.pluginManager=e.pluginManager,!this.ReactComponent)throw new Error("no ReactComponent defined for renderer ".concat(this.name));if(!(0,a.getDefaultValue)(this.configSchema).type)throw new Error("".concat(this.name," config schema ").concat(this.configSchema.name," is not explicitlyTyped"));if(!this.pluginManager)throw new Error("no plugin manager defined for renderer ".concat(this.name))}async render(e){return{reactElement:r.createElement(this.ReactComponent,e,null)}}freeResources(){return 0}}},97198:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(41867),a=n(81096),o=n(35421),i=n(3762),s=n(31625),l=n(47155),c=n(90872),d=n(80838);const u=(0,i.observer)((function(e){let{theme:t,html:n,RenderingComponent:i,...l}=e;const u=(0,r.useRef)(null),p=(0,r.useRef)(),{hydrateFn:h}=(0,s.getRoot)(l.displayModel);return(0,r.useEffect)((()=>{const e=(0,c.rIC)((()=>{var e;if(!u.current)return;const n=(0,o.createJBrowseTheme)(t);p.current=null!==(e=p.current)&&void 0!==e?e:h(u.current,(0,d.jsx)(a.Z,{theme:n,children:(0,d.jsx)(i,{...l})}))}));return()=>{clearTimeout(e);const t=p.current;p.current=void 0,setTimeout((()=>{null===t||void 0===t||t.unmount()}))}}),[n,t,l,h,i]),(0,d.jsx)("div",{ref:u,dangerouslySetInnerHTML:{__html:n}})})),p=(0,i.observer)((function(e){let{theme:t,html:n,RenderingComponent:i,...s}=e;const u=(0,r.useRef)(null),p=(0,o.createJBrowseTheme)(t);return(0,r.useEffect)((()=>{const e=u.current;return e&&(e&&(0,l.unmountComponentAtNode)(e),e.innerHTML=n,(0,c.rIC)((()=>{(0,l.hydrate)((0,d.jsx)(a.Z,{theme:p,children:(0,d.jsx)(i,{...s})}),e)}))),()=>{e&&(0,l.unmountComponentAtNode)(e)}}),[n,p,s,i]),(0,d.jsx)("div",{ref:u})})),h=(0,i.observer)((function(e){return(0,s.getRoot)(e.displayModel).hydrateFn?(0,d.jsx)(u,{...e}):(0,d.jsx)(p,{...e})}))},96595:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});n(41867);var r=n(81096),a=n(49665),o=n(31625),i=n(90872),s=n(15974),l=n(35421),c=n(14331),d=n(97198),u=n(80838);class p extends c.default{serializeArgsInClient(e){var t;return{...e,config:(0,o.isStateTreeNode)(e.config)?(0,o.getSnapshot)(e.config):e.config,filters:null===(t=e.filters)||void 0===t?void 0:t.toJSON().filters}}deserializeResultsInClient(e,t){return t.exportSVG?{...e,html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,reactElement:(0,u.jsx)(d.Z,{...t,...e,RenderingComponent:this.ReactComponent})}}deserializeArgsInWorker(e){const t={...e};return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=new s.Z({filters:e.filters}),t}serializeResultsInWorker(e,t){const n=(0,a.Dq)((0,u.jsx)(r.Z,{theme:(0,l.createJBrowseTheme)(t.theme),children:e.reactElement}));return delete e.reactElement,{...e,html:n}}async renderInClient(e,t){const n=await e.call(t.sessionId,"CoreRender",t);return"canvasRecordedData"in n&&(n.html=await(0,i.getSerializedSvg)(n),delete n.reactElement),n}async renderInWorker(e){const{signal:t,statusCallback:n=(()=>{})}=e,r=this.deserializeArgsInWorker(e),a=await(0,i.updateStatus)("Rendering plot",n,(()=>this.render(r)));return(0,i.checkAbortSignal)(t),(0,i.updateStatus)("Serializing results",n,(()=>this.serializeResultsInWorker(a,r)))}async freeResourcesInClient(e,t){const n=this.serializeArgsInClient(t);return this.freeResources()+await e.call(t.sessionId,"CoreFreeResources",n)}}},15974:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(88826);class a{constructor(e){let{filters:t=[]}=e;this.filterChain=void 0,this.filterChain=t.map((e=>{if("string"===typeof e){return{expr:(0,r.P)(e),string:e}}throw new Error('invalid inputFilter string "'.concat(e,'"'))}))}passes(){for(const e of this.filterChain)if(!e.expr.evalSync({feature:arguments.length<=0?void 0:arguments[0]}))return!1;return!0}toJSON(){return{filters:this.filterChain.map((e=>e.string))}}static fromJSON(e){return new a(e)}}},69282:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});n(41867);var r=n(33681),a=n(68367),o=n(3762),i=n(77600),s=n(80838);const l=(0,o.observer)((function(e){let{children:t,menuItems:n,...o}=e;const l=(0,i.o_)({popupId:"viewMenu",variant:"popover"});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.Z,{...(0,i.vW)(l),...o,disabled:0===n.length,children:t}),(0,s.jsx)(r.Z,{...(0,i.ZW)(l),onMenuItemClick:(e,t)=>t(),menuItems:n,popupState:l})]})}))},59093:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(41867),a=n(23801),o=n(27341),i=n(87984),s=n(47409),l=n(27768),c=n(5146),d=n(86163),u=n(80838);const p=e=>{let{onFactoryReset:t,resetButtonText:n}=e;const[o,i]=(0,r.useState)(!1);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.Z,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:()=>i(!0),children:n}),(0,u.jsx)(c.default,{onClose:()=>i(!1),open:o,onFactoryReset:t})]})};function h(e){let{componentStack:t,error:n="No error message provided",onFactoryReset:r,resetButtonText:c="Factory Reset"}=e;return(0,u.jsxs)(o.Z,{maxWidth:"xl",open:!0,children:[(0,u.jsx)(i.Z,{children:"Fatal error"}),(0,u.jsxs)(s.Z,{children:[(0,u.jsx)(d.Z,{error:n}),(0,u.jsx)("pre",{children:t})]}),(0,u.jsxs)(l.Z,{children:[(0,u.jsx)(a.Z,{color:"secondary",variant:"contained",onClick:()=>window.location.reload(),children:"Refresh"}),(0,u.jsx)(p,{onFactoryReset:r,resetButtonText:c})]})]})}},77638:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});n(41867);var r=n(59025),a=n(90552),o=n(23801),i=n(51590),s=n(47192),l=n(90872),c=n(99512),d=n(80838);function u(e){return"blobId"in e}const p=(0,s.ZL)()((e=>({filename:{marginLeft:e.spacing(1)}})));const h=function(e){let{location:t,setLocation:n}=e;const{classes:s}=p(),h=t&&(u(t)&&t.name||function(e){return"localPath"in e}(t)&&t.localPath),g=t&&u(t)&&!(0,c.getBlob)(t.blobId);return(0,d.jsxs)(r.Z,{display:"flex",flexDirection:"row",alignItems:"center",children:[(0,d.jsx)(r.Z,{children:(0,d.jsx)(a.Z,{fullWidth:!0,children:(0,d.jsxs)(o.Z,{variant:"outlined",component:"label",children:["Choose File",(0,d.jsx)("input",{type:"file",hidden:!0,onChange:e=>{var t;let{target:r}=e;const a=null===r||void 0===r||null===(t=r.files)||void 0===t?void 0:t[0];a&&(l.isElectron?n({localPath:a.path,locationType:"LocalPathLocation"}):n((0,c.storeBlobLocation)({blob:a})))}})]})})}),(0,d.jsxs)(r.Z,{children:[(0,d.jsx)(i.Z,{component:"span",className:s.filename,color:h?"initial":"textSecondary",children:h||"No file chosen"}),g?(0,d.jsx)(i.Z,{color:"error",children:"(need to reload)"}):null]})]})}},20197:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});n(41867);var r=n(49133),a=n(3762),o=n(55022),i=n(80838);const s=(0,a.observer)((function(e){let{location:t,setLocation:n,label:a}=e;return(0,i.jsx)(r.Z,{fullWidth:!0,variant:"outlined",inputProps:{"data-testid":"urlInput"},defaultValue:t&&(0,o.hb)(t)?t.uri:"",label:a||"Enter URL",onChange:e=>{n({uri:e.target.value.trim(),locationType:"UriLocation"})}})}))},28164:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r,a=n(71171),o=(n(41867),n(51590)),i=n(47192),s=n(51665),l=n(80838);const c=(0,i.ZL)()({dots:{"&::after":{display:"inline-block",content:'""',width:"1em",textAlign:"left",animation:"".concat((0,s.F4)(r||(r=(0,a.Z)(["\n      0% {\n        content: '';\n      }\n      25% {\n          content: '.';\n      }\n      50% {\n        content: '..';\n      }\n      75% {\n        content: '...';\n      }\n      "])))," 1.2s infinite ease-in-out")}}});function d(e){let{message:t,variant:n="body2",...r}=e;const{classes:a}=c();return(0,l.jsx)(o.Z,{className:a.dots,...r,variant:n,children:"".concat(t||"Loading")})}},39092:(e,t,n)=>{"use strict";n.r(t),n.d(t,{category10:()=>r,dark2:()=>a,ggplot2Colors3:()=>u,ggplot2Colors4:()=>d,ggplot2Colors5:()=>c,ggplot2Colors6:()=>l,set1:()=>o,set2:()=>i,tableau10:()=>s});const r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],o=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],i=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],s=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],l=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"],c=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"],d=["#F8766D","#7CAE00","#00BFC4","#C77CFF"],u=["#F8766D","#00BA38","#619CFF"]},56726:(e,t,n)=>{"use strict";n.d(t,{Ao:()=>a,R:()=>s,j4:()=>i});var r=n(31625);function a(e,t,n){if(!t||!n)return;const{width:r,interRegionPaddingWidth:a,displayedRegions:o,bpPerPx:i,minimumBlockWidth:s}=e,l=function(e,t,n){let r=0;const{displayedRegions:a}=e;if(t.index===n.index)r+=n.offset-t.offset;else{const e=a[t.index];if(r+=e.end-e.start-t.offset,n.index-t.index>=2)for(let o=t.index+1;o<n.index;o++){const e=a[o];r+=e.end-e.start}r+=n.offset}return r}(e,t,n);let c=0;for(let g=t.index;g<n.index;g++){const e=o[g];(e.end-e.start)/i>s&&c++}const d=l/(r-a*c),u=e.zoomTo(d);let p=0;d<u&&(p=(u-d)*e.width/2);let h=-p;for(let g=0;g<e.displayedRegions.length;g+=1){const n=e.displayedRegions[g];if(t.index===g){h+=t.offset;break}h+=n.end-n.start}e.scrollTo(Math.round(h/e.bpPerPx))}function o(e,t){return Math.floor(e.reversed?e.end-t:e.start+t)+1}function i(e,t){let n=0;const{bpPerPx:a,offsetPx:i,displayedRegions:s,interRegionPaddingWidth:l,staticBlocks:c}=e,d=c.contentBlocks,u=(i+t)*a;if(u<0){const e=s[0];return{...(0,r.getSnapshot)(e),oob:!0,coord:o(e,u),offset:u,index:0}}const p=l*a;let h=0;for(let f=0;f<s.length;f++){var g;const e=s[f],t=e.end-e.start,a=u-n;if(t+n>u&&n<=u){return{...(0,r.getSnapshot)(e),oob:!1,offset:a,coord:o(e,a),index:f}}(null===(g=d[h])||void 0===g?void 0:g.regionNumber)===f?(n+=t+p,h++):n+=t}if(u>=n&&s.length>0){const e=s.at(-1),t=u-n+(e.end-e.start);return{...(0,r.getSnapshot)(e),oob:!0,offset:t,coord:o(e,t),index:s.length-1}}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}function s(e){let{refName:t,coord:n,regionNumber:r,self:a}=e,o=0;const{interRegionPaddingWidth:i,bpPerPx:s,displayedRegions:l,staticBlocks:c}=a,d=c.contentBlocks,u=i*s;let p=0,h=0;for(;h<l.length;h++){var g;const e=l[h],a=e.end-e.start;if(t===e.refName&&n>=e.start&&n<=e.end&&(!r||r===h)){o+=e.reversed?e.end-n:n-e.start;break}(null===(g=d[p])||void 0===g?void 0:g.regionNumber)===h?(o+=a+u,p++):o+=a}if(l[h])return{index:h,offsetPx:Math.round(o/s)}}},31996:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(31625),a=n(90872),o=n(1502),i=n(33322),s=n(4206),l=n(56726);const c=r.types.model("Base1DView",{id:o.ElementId,displayedRegions:r.types.array(o.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:r.types.optional(r.types.number,0),minimumBlockWidth:r.types.optional(r.types.number,0)}).volatile((()=>({features:void 0,volatileWidth:0}))).actions((e=>({setDisplayedRegions(t){e.displayedRegions=(0,r.cast)(t)},setBpPerPx(t){e.bpPerPx=t},setVolatileWidth(t){e.volatileWidth=t}}))).views((e=>({get width(){return e.volatileWidth},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return e.displayedRegions.map((e=>e.end-e.start)).reduce(((e,t)=>e+t),0)}}))).views((e=>({get dynamicBlocks(){return(0,i.Z)(e)},get staticBlocks(){return(0,s.Z)(e)},get currBp(){return this.dynamicBlocks.map((e=>e.end-e.start)).reduce(((e,t)=>e+t),0)}}))).views((e=>({pxToBp:t=>(0,l.j4)(e,t),bpToPx(t){var n;let{refName:r,coord:a,regionNumber:o}=t;return null===(n=(0,l.R)({refName:r,coord:a,regionNumber:o,self:e}))||void 0===n?void 0:n.offsetPx}}))).actions((e=>({setFeatures(t){e.features=t},showAllRegions(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut(){this.zoomTo(2*e.bpPerPx)},zoomIn(){this.zoomTo(e.bpPerPx/2)},zoomTo(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.width/2;const r=(0,a.clamp)(t,"minBpPerPx"in e?e.minBpPerPx:0,"maxBpPerPx"in e?e.maxBpPerPx:1/0),o=e.bpPerPx;return Math.abs(o-r)<1e-6?o:(e.bpPerPx=r,e.offsetPx=(0,a.clamp)(Math.round((e.offsetPx+n)*o/r-n),e.minOffset,e.maxOffset),e.bpPerPx)},scrollTo(t){const n=(0,a.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},centerAt(t,n,r){if(!n)return;const a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&this.scrollTo(Math.round(a-e.width/2))},scroll(t){const n=e.offsetPx,r=(0,a.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}}))).actions((e=>({moveTo(t,n){(0,l.Ao)(e,t,n)}})))},47685:(e,t,n)=>{"use strict";n.d(t,{ML:()=>s,N7:()=>c,O8:()=>i,fP:()=>l,zF:()=>d});var r=n(59276),a=n(24417);class o extends Error{constructor(){super(...arguments),this.code=void 0}}function i(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw l()}}async function s(e){var t;await(t=1,new Promise((e=>setTimeout(e,t)))),i(e)}function l(){if("undefined"!==typeof DOMException)return new DOMException("aborted","AbortError");const e=new o("aborted");return e.code="ERR_ABORTED",e}function c(e){return e?(0,a.R)(e,"abort"):r.y.create()}function d(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!/\b(aborted|aborterror)\b/i.test(e.message))}},76258:(e,t,n)=>{"use strict";function r(e){const t=new FileReader;return new Promise(((n,r)=>{t.onload=e=>{e.target?n(e.target.result):r(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)}))}n.d(t,{n:()=>r})},64019:(e,t,n)=>{"use strict";n.d(t,{Jw:()=>a,b0:()=>i,n2:()=>l,sh:()=>s});var r=n(90872);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.blocks=e}push(e){if(e instanceof s&&this.blocks.length>0){const t=this.blocks.at(-1);if(t instanceof s)return void t.push(e)}this.blocks.push(e)}getBlocks(){return this.blocks}getRegions(){return this.blocks.map((e=>e.toRegion()))}map(e,t){return this.blocks.map(e,t)}forEach(e,t){return this.blocks.forEach(e,t)}get length(){return this.blocks.length}get totalWidthPx(){return this.blocks.length>0?(0,r.sum)(this.blocks.map((e=>e.widthPx))):0}get totalWidthPxWithoutBorders(){return this.blocks.length>0?(0,r.sum)(this.blocks.filter((e=>"boundary"!==e.variant)).map((e=>e.widthPx))):0}get offsetPx(){return this.blocks.length>0?this.blocks[0].offsetPx:0}get contentBlocks(){return this.blocks.filter((e=>e instanceof i))}get totalBp(){return(0,r.sum)(this.contentBlocks.map((e=>e.end-e.start)))}}class o{constructor(e){this.regionNumber=void 0,this.reversed=void 0,this.refName=void 0,this.start=void 0,this.end=void 0,this.assemblyName=void 0,this.key=void 0,this.offsetPx=void 0,this.widthPx=0,this.variant=void 0,this.isLeftEndOfDisplayedRegion=void 0,Object.assign(this,e),this.assemblyName=e.assemblyName,this.refName=e.refName,this.start=e.start,this.end=e.end,this.key=e.key,this.offsetPx=e.offsetPx}toRegion(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}class i extends o{}class s extends o{constructor(e){super(e),this.widthPx=void 0,this.elidedBlockCount=0,this.widthPx=e.widthPx}push(e){this.elidedBlockCount+=1,e&&(this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx)}}class l extends o{}},33322:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(31625),a=n(19881),o=n(90872),i=n(64019);function s(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{offsetPx:s,displayedRegions:l,bpPerPx:c,width:d,minimumBlockWidth:u,interRegionPaddingWidth:p}=e;if(!d)throw new Error("view has no width, cannot calculate displayed blocks");const h=new i.Jw;let g=0;const f=s,m=f+d;for(let y=0;y<l.length;y++){const e=l[y],{assemblyName:b,refName:v,start:w,end:x,reversed:C}=e,S=g+(x-w)/c,k=(x-w)/c,T=(0,r.isStateTreeNode)(e)?(0,r.getSnapshot)(e):e;if(g<m&&S>f){const[e,r]=(0,a.U0)(f,m,g,S);let P,M,R,A,I;C?(P=Math.max(w,x-(r-g)*c),M=x-(e-g)*c,R=M===x,A=P===w,I=g+(x-M)/c):(P=(e-g)*c+w,M=Math.min(x,(r-g)*c+w),R=P===w,A=M===x,I=g+(P-w)/c);const N={assemblyName:b,refName:v,start:P,end:M,reversed:C,offsetPx:I,parentRegion:T,regionNumber:y,widthPx:(M-P)/c,isLeftEndOfDisplayedRegion:R,isRightEndOfDisplayedRegion:A,key:""};N.key="".concat((0,o.assembleLocStringFast)(N),"-").concat(y).concat(C?"-reversed":""),t&&0===h.length&&R&&h.push(new i.n2({key:"".concat(N.key,"-beforeFirstRegion"),widthPx:-s,offsetPx:N.offsetPx+s,variant:"boundary"})),n&&k<u?h.push(new i.sh(N)):h.push(new i.b0(N)),t&&(k>=u&&N.isRightEndOfDisplayedRegion&&y<l.length-1&&(h.push(new i.n2({key:"".concat(N.key,"-rightpad"),widthPx:p,offsetPx:N.offsetPx+N.widthPx})),g+=p),y===l.length-1&&N.isRightEndOfDisplayedRegion&&(I=N.offsetPx+N.widthPx,h.push(new i.n2({key:"".concat(N.key,"-afterLastRegion"),widthPx:d-I+s,offsetPx:I,variant:"boundary"}))))}g+=(x-w)/c}return h}},4206:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(31625),a=n(90872),o=n(64019);function i(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:800;const{offsetPx:l,displayedRegions:c,bpPerPx:d,minimumBlockWidth:u,interRegionPaddingWidth:p,width:h}=e,g=l*d,f=(l+h)*d,m=s,y=Math.ceil(m*d);let b=0;const v=new o.Jw;for(let w=0;w<c.length;w++){const e=c[w],{assemblyName:l,refName:h,start:m,end:x,reversed:C}=e,S=Math.ceil((x-m)/y),k=(0,r.isStateTreeNode)(e)?(0,r.getSnapshot)(e):e;let T=Math.floor((f-b)/y)+i;T>=S&&(T=S-1);let P=Math.floor((g-b)/y)-i;P<0&&(P=0);const M=(x-m)/d;for(let r=P;r<=T;r+=1){let e,i,g,f;C?(e=Math.max(m,x-(r+1)*y),i=x-r*y,g=i===x,f=e===m):(e=m+r*y,i=Math.min(x,m+(r+1)*y),g=e===m,f=i===x);const S={assemblyName:l,refName:h,start:e,end:i,reversed:C,offsetPx:(b+r*y)/d,parentRegion:k,regionNumber:w,widthPx:(i-e)/d,isLeftEndOfDisplayedRegion:g,isRightEndOfDisplayedRegion:f,key:""};S.key="".concat((0,a.assembleLocStringFast)(S),"-").concat(w).concat(C?"-reversed":""),t&&0===w&&0===r&&v.push(new o.n2({key:"".concat(S.key,"-beforeFirstRegion"),widthPx:s,offsetPx:S.offsetPx-s,variant:"boundary"})),n&&M<u?v.push(new o.sh(S)):v.push(new o.b0(S)),t&&(M>=u&&S.isRightEndOfDisplayedRegion&&w<c.length-1&&(b+=p*d,v.push(new o.n2({key:"".concat(S.key,"-rightpad"),widthPx:p,offsetPx:S.offsetPx+S.widthPx}))),w===c.length-1&&S.isRightEndOfDisplayedRegion&&(b+=p*d,v.push(new o.n2({key:"".concat(S.key,"-afterLastRegion"),widthPx:s,offsetPx:S.offsetPx+S.widthPx,variant:"boundary"}))))}b+=x-m}return v}},71472:(e,t,n)=>{"use strict";n.r(t),n.d(t,{contrastingTextColor:()=>s,emphasize:()=>c,isNamedColor:()=>i,makeContrasting:()=>d,namedColorToHex:()=>o});var r=n(71939);const a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(e){return a[e]}function i(e){return!!a[e]}function s(e){return l(e)>.5?"black":"white"}function l(e){const t=o(e);return(0,r.H3)(t||e)}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;const n=o(e);return(0,r._4)(n||e,t)}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"white",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=o(e)||e;const i=o(t)||t,s=l(i);let c=(0,r.mi)(a,i);const d=a;let u=.05;for(;c<n;)a=s>.5?(0,r._j)(d,u):(0,r.$n)(d,u),u+=.05,c=(0,r.mi)(a,i);return a}},622:(e,t,n)=>{"use strict";n.d(t,{V:()=>r.Vi});var r=n(74064),a=n(67845),o=n(58930);(0,r.l7)([a.Z,o.Z])},72160:(e,t,n)=>{"use strict";function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JSON.stringify;const n=[],r=new Set;for(const a of e){const e=t(a);r.has(e)||(n.push(a),r.add(e))}return n}n.d(t,{D:()=>r})},6416:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(90872);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=Object.keys(e);for(const r of n){if(t.length>5e3)break;t+="object"===typeof e[r]&&e[r]?a(e[r],t):"".concat(r,"-").concat(e[r],";")}return(0,r.hashCode)(t)}},59062:(e,t,n)=>{"use strict";n.r(t),n.d(t,{RemoteFileWithRangeCache:()=>d,getFetcher:()=>m,openLocation:()=>f,resolveUriLocation:()=>g});var r=n(37168),a=n(36618),o=n.n(a),i=n(19192),s=n(59737);const l={};const c=new i.t({fetch:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=l[e];if(!a)throw new Error("fetch not registered for ".concat(e));return a(e,t,n,r)},size:524288e3,chunkSize:131072,maxFetchSize:104857600,minimumTTL:864e5});class d extends r.kC{async fetch(e,t){l[String(e)]||(l[String(e)]=this.fetchBinaryRange.bind(this));const n=null===t||void 0===t?void 0:t.headers;let r;if(n&&(n instanceof Headers?r=n.get("range"):Array.isArray(n)?[,r]=n.find((e=>{let[t]=e;return"range"===t}))||[void 0,void 0]:r=n.range),r){const n=/bytes=(\d+)-(\d+)/.exec(r);if(n){const[,r,a]=n,o=Number.parseInt(r,10),i=Number.parseInt(a,10),s=await c.getRange(e,o,i-o+1,{signal:null===t||void 0===t?void 0:t.signal}),{headers:l}=s;return new Response(s.buffer,{status:206,headers:l})}}return super.fetch(e,t)}async fetchBinaryRange(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=new Date,o={...r.headers,range:"bytes=".concat(t,"-").concat(n)},i=await super.fetch(e,{...r,headers:o}),l=new Date;if(206!==i.status){const r="HTTP ".concat(i.status," (").concat(i.statusText,") when fetching ").concat(e," bytes ").concat(t,"-").concat(n),a=" (should be 206 for range requests)";throw new Error("".concat(r).concat(200===i.status?a:""))}const c={};for(const[s,u]of i.headers.entries())c[s]=u;const d=await i.arrayBuffer();return{headers:c,requestDate:a,responseDate:l,buffer:s.Buffer.from(d)}}}var u=n(55022),p=n(99512),h=n(90872);function g(e){return e.baseUri?{...e,uri:new URL(e.uri,e.baseUri).href}:e}function f(e,t){if(!e)throw new Error("must provide a location to openLocation");if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(o()||h.isElectron)return new r.S9(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){const t=(0,p.getBlob)(e.blobId);if(!t)throw new Error('file ("'.concat(e.name,'") was opened locally from a previous session. To restore it, go to track settings and reopen the file'));return new r.SH(t)}if((0,u.hb)(e)){if(!e.uri)throw new Error("No URI provided");const n=g(e);if(t){const r=y(e,t);if(r)return r.openLocation(n)}return new d(n.uri,{fetch:b})}throw new Error("invalid fileLocation")}function m(e,t){if(!(0,u.hb)(e))throw new Error("Not a valid UriLocation: ".concat(JSON.stringify(e)));if(t){const n=y(e,t);if(n)return n.getFetcher(e)}return b}function y(e,t){const{rootModel:n}=t;if(n&&(0,u.At)(n))return n.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}async function b(e,t){var n;const r=await fetch(e,t);if(401===r.status&&null!==(n=r.headers.get("WWW-Authenticate"))&&void 0!==n&&n.includes("Basic"))throw new u.yb("Accessing HTTPBasic resource without authentication",e.toString());return r}},15485:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(43467),a=n.n(r);function o(){const e=new(a().Jexl);return e.addFunction("get",((e,t)=>e.get(t))),e.addFunction("parent",(e=>e.parent())),e.addFunction("id",(e=>e.id())),e.addFunction("cast",(e=>e)),e.addFunction("log",(e=>(console.log(e),e))),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",((e,t)=>e.split(t))),e.addFunction("charAt",((e,t)=>e.charAt(t))),e.addFunction("charCodeAt",((e,t)=>e.charCodeAt(t))),e.addFunction("codePointAt",((e,t)=>e.codePointAt(t))),e.addFunction("startsWith",((e,t,n)=>e.startsWith(t,n))),e.addFunction("endsWith",((e,t,n)=>e.endsWith(t,n))),e.addFunction("padEnd",((e,t,n)=>e.padEnd(t,n))),e.addFunction("padStart",((e,t,n)=>e.padStart(t,n))),e.addFunction("repeat",((e,t)=>e.repeat(t))),e.addFunction("replace",((e,t,n)=>e.replace(t,n))),e.addFunction("replaceAll",((e,t,n)=>e.replaceAll(t,n))),e.addFunction("slice",((e,t,n)=>e.slice(t,n))),e.addFunction("startsWith",((e,t,n)=>e.startsWith(t,n))),e.addFunction("substring",((e,t,n)=>e.substring(t,n))),e.addFunction("toLowerCase",(e=>e.toLowerCase())),e.addFunction("toUpperCase",(e=>e.toUpperCase())),e.addFunction("trim",(e=>e.trim())),e.addFunction("trimEnd",(e=>e.trimEnd())),e.addFunction("trimStart",(e=>e.trimStart())),e.addFunction("getTag",((e,t)=>{const n=e.get("tags");return n?n[t]:e.get(t)})),e.addBinaryOp("&",15,((e,t)=>e&t)),e}},88826:(e,t,n)=>{"use strict";n.d(t,{P:()=>o});var r=n(15485);const a={};function o(e,t){const n="nosig|".concat(e);if(!a[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");const o=e.split("jexl:")[1],i=t?t.compile("".concat(o)):(0,r.Z)().compile("".concat(o));a[n]=i}return a[n]}},42904:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const r=1e4;function a(e,t,n,r){return t>=n&&r>=e}class o{constructor(){this.padding=1,this.allFilled=void 0,this.widthLimit=1e6,this.rowState=void 0}setAllFilled(e){this.allFilled=e}getItemAt(e){var t;return this.allFilled?this.allFilled:void 0===(null===(t=this.rowState)||void 0===t?void 0:t.min)||e<this.rowState.min||e>=this.rowState.max?void 0:this.rowState.bits[e-this.rowState.offset]}isRangeClear(e,t){if(this.allFilled)return!1;if(void 0===this.rowState||t<=this.rowState.min||e>=this.rowState.max)return!0;const{min:n,max:r,offset:a,bits:o}=this.rowState,i=Math.min(r,t)-a;let s=!0;for(let l=Math.max(n,e)-a;l<i&&s;l++)s=void 0===o[l];return s}initialize(e,t){const n=t-e;return{offset:e-n,min:e,max:t,bits:Array.from({length:3*n})}}addRect(e,t){const n=e.l,r=e.r+this.padding;this.rowState||(this.rowState=this.initialize(n,r));let a=n-this.rowState.offset,o=r-this.rowState.offset;const i=this.rowState.bits.length;if(o>=this.rowState.bits.length){const e=o+1;this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):e>0&&(this.rowState.bits=[...this.rowState.bits,...Array.from({length:e})])}if(n<this.rowState.offset){const e=Math.min(i-a,this.rowState.offset);this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):(this.rowState.bits=[...Array.from({length:e}),...this.rowState.bits],this.rowState.offset-=e)}o=r-this.rowState.offset,a=n-this.rowState.offset;const s=o-a;s>2e4&&console.warn("Layout X pitch set too low, feature spans ".concat(s," bits in a single row."),e,t);for(let l=a;l<o;l+=1)this.rowState.bits[l]=t;n<this.rowState.min&&(this.rowState.min=n),r>this.rowState.max&&(this.rowState.max=r)}discardRange(e,t){if(this.allFilled)return;if(!this.rowState)return;if(t<=this.rowState.min||e>=this.rowState.max)return;if(e<=this.rowState.min&&t>=this.rowState.max)return void(this.rowState=void 0);if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-r&&this.rowState.bits.length>this.rowState.max+r-this.rowState.offset){const e=this.rowState.min-this.rowState.offset,t=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(e,this.rowState.bits.length-t),this.rowState.offset+=e}else if(this.rowState.offset<this.rowState.min-r){const e=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,e),this.rowState.offset+=e}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+r){const e=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=e}const n=Math.max(this.rowState.min,e)-this.rowState.offset,a=Math.min(t,this.rowState.max)-this.rowState.offset;for(let r=n;r>=0&&r<a;r+=1)this.rowState.bits[r]=void 0}}class i{constructor(){let{pitchX:e=10,pitchY:t=10,maxHeight:n=1e4,hardRowLimit:r=1e4,displayMode:a="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pitchX=void 0,this.pitchY=void 0,this.hardRowLimit=void 0,this.bitmap=void 0,this.rectangles=void 0,this.maxHeightReached=void 0,this.maxHeight=void 0,this.displayMode=void 0,this.pTotalHeight=void 0,this.pitchX=e,this.pitchY=t,this.hardRowLimit=r,this.maxHeightReached=!1,this.displayMode=a,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(n/this.pitchY),this.pTotalHeight=0}addRect(e,t,n,r,a){const o=this.rectangles.get(e);if(o)return null===o.top?null:(this.addRectToBitmap(o),o.top*this.pitchY);const i=Math.floor(t/this.pitchX),s=Math.floor(n/this.pitchX),l=Math.ceil(r/this.pitchY),c={id:e,l:i,r:s,top:null,h:l,originalHeight:r,data:a},d=this.maxHeight-l;let u=0;if("collapse"!==this.displayMode){for(;u<=d&&this.collides(c,u);u+=1);if(u>d)return c.top=null,this.rectangles.set(e,c),this.maxHeightReached=!0,null}return c.top=u,this.addRectToBitmap(c),this.rectangles.set(e,c),this.pTotalHeight=Math.max(this.pTotalHeight||0,u+l),u*this.pitchY}collides(e,t){const{bitmap:n}=this,r=t+e.h;for(let a=t;a<r;a+=1){const t=n[a];if(void 0!==t&&!t.isRangeClear(e.l,e.r))return!0}return!1}autovivifyRow(e,t){let n=e[t];if(!n){if(t>this.hardRowLimit)throw new Error("layout hard limit (".concat(this.hardRowLimit*this.pitchY,"px) exceeded, aborting layout"));n=new o,e[t]=n}return n}addRectToBitmap(e){if(null===e.top)return;const t=e.id,n=e.top+e.h;if(e.r-e.l>2e4)for(let r=e.top;r<n;r+=1)this.autovivifyRow(this.bitmap,r).setAllFilled(t);else for(let r=e.top;r<n;r+=1)this.autovivifyRow(this.bitmap,r).addRect(e,t)}discardRange(e,t){const n=Math.floor(e/this.pitchX),r=Math.floor(t/this.pitchX),{bitmap:a}=this;for(const o of a)o&&o.discardRange(n,r)}hasSeen(e){return this.rectangles.has(e)}getByCoord(e,t){const n=Math.floor(t/this.pitchY),r=this.bitmap[n];if(!r)return;const a=Math.floor(e/this.pitchX);return r.getItemAt(a)}getByID(e){const t=this.rectangles.get(e);if(t){const e=t.top*this.pitchY;return[t.l*this.pitchX,e,t.r*this.pitchX,e+t.originalHeight]}}getDataByID(e){var t;return null===(t=this.rectangles.get(e))||void 0===t?void 0:t.data}cleanup(){}getTotalHeight(){return this.pTotalHeight*this.pitchY}get totalHeight(){return this.getTotalHeight()}getRectangles(){return new Map([...this.rectangles.entries()].map((e=>{let[t,n]=e;const{l:r,r:a,originalHeight:o,top:i}=n,s=(i||0)*this.pitchY,l=s+o;return[t,[r*this.pitchX,s,a*this.pitchX,l]]})))}serializeRegion(e){const t={};let n=!1;for(const[r,o]of this.rectangles.entries()){const{l:i,r:s,originalHeight:l,top:c}=o;if(null===o.top)n=!0;else{const n=(c||0)*this.pitchY,o=n+l,d=i*this.pitchX,u=s*this.pitchX;a(e.start,e.end,d-this.pitchX,u+this.pitchX)&&(t[r]=[d,n,u,o])}}return{rectangles:t,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:n}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}},59612:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});class r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.SubLayoutClass=e,this.subLayoutConstructorArgs=t,this.subLayouts=new Map}getDataByID(e){for(const t of this.subLayouts.values()){const n=t.getDataByID(e);if(n)return n}}getSublayout(e){let t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}addRect(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.getSublayout(e).addRect(t,n,r,a,o)}discardRange(e,t,n){var r;return null===(r=this.subLayouts.get(e))||void 0===r?void 0:r.discardRange(t,n)}toJSON(){const e={};for(const[t,n]of this.subLayouts.entries())e[t]=n.toJSON();return e}}},54691:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(84224),a=n.n(r);class o{constructor(e){let{rectangles:t,totalHeight:n,maxHeightReached:r}=e;this.rectangles=void 0,this.totalHeight=void 0,this.maxHeightReached=void 0,this.rbush=void 0,this.rectangles=new Map(Object.entries(t)),this.totalHeight=n,this.maxHeightReached=r,this.rbush=new(a());for(const[a,o]of Object.entries(t))this.rbush.insert({minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],name:a})}addRect(e){const t=this.rectangles.get(e);if(!t)throw new Error("id ".concat(e," not found in precomputed feature layout"));return t[1]}getRectangles(){return this.rectangles}getTotalHeight(){return this.totalHeight}collides(e,t){throw new Error("Method not implemented.")}getByCoord(e,t){const n={minX:e,minY:t,maxX:e+1,maxY:t+1};return this.rbush.collides(n)?this.rbush.search(n)[0].name:void 0}getByID(e){return this.rectangles.get(e)}addRectToBitmap(e,t){throw new Error("Method not implemented.")}discardRange(e,t){throw new Error("Method not implemented.")}serializeRegion(e){throw new Error("Method not implemented.")}toJSON(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}},19618:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GranularRectLayout:()=>r.Z,MultiLayout:()=>a.Z,PrecomputedLayout:()=>o.Z,PrecomputedMultiLayout:()=>s,SceneGraph:()=>l});var r=n(42904),a=n(59612),o=n(54691);class i{constructor(){throw new Error("invalid layout name")}}class s extends a.Z{constructor(e){super(i),Object.entries(e).forEach((e=>{let[t,n]=e;this.subLayouts.set(t,new o.Z(n))}))}}class l{constructor(e,t,n,r,a,o){this.name=e,this.left=t,this.top=n,this.width=r,this.height=a,this.data=o,this.children=void 0,this.absoluteCache=void 0,this.parent=void 0,this.children=new Map,this.absoluteCache={dirty:!0}}addChild(e,t,n,r,a,o){const i=e instanceof l?e:new l(e,t,n,r,a,o);if(!(i instanceof l))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(i.name))throw new Error('child named "'.concat(i.name,'" already exists'));i.parent=this;const{left:s,right:c,top:d,bottom:u}=i.absolute;return void 0!==s&&void 0!==c&&void 0!==d&&void 0!==u&&(this.expand(s,c,d,u),this.children.set(i.name,i)),i}getSubRecord(e){return this.children.get(e)}expand(e,t,n,r){const{left:a,right:o,top:i,bottom:s}=this.absolute;if(void 0!==a&&e<a){const t=a-e;this.width+=t,this.left-=t}if(void 0!==o&&t>o&&(this.width+=t-o),void 0!==i&&n<i){const e=i-n;this.height+=e,this.top-=e}void 0!==s&&r>s&&(this.height+=r-s),this.parent&&this.parent.expand(e,t,n,r),this.absoluteCache.dirty=!0}get bottom(){return this.top+this.height}get right(){return this.left+this.width}walkParents(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}walkChildren(e){for(const t of this.children.values())e(t),t.walkChildren(e)}get absolute(){if(this.absoluteCache.dirty){let e=0,t=0;this.walkParents((n=>{e+=n.left,t+=n.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}move(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((e=>{e.absoluteCache.dirty=!0}));const{left:n,right:r,top:a,bottom:o}=this.absolute;void 0!==n&&void 0!==r&&void 0!==a&&void 0!==o&&this.expand(n,r,a,o)}}},84535:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getDefaultValue:()=>s,getEnumerationValues:()=>l,getPropertyType:()=>i,getSubType:()=>a,getUnionSubTypes:()=>o,resolveLateType:()=>c});var r=n(31625);function a(e){let t;if((0,r.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,r.isArrayType)(e)&&!(0,r.isMapType)(e)){if("function"===typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function o(e){if(!(0,r.isUnionType)(e))throw new TypeError("not an MST union type");const t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function i(e,t){return e.properties[t]}function s(e){if(!(0,r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function l(e){return o(e).map((e=>e.value))}function c(e){return(0,r.isUnionType)(e)||(0,r.isArrayType)(e)||!(0,r.isLateType)(e)?e:e.getSubType()}},45466:(e,t,n)=>{"use strict";n.d(t,{x0:()=>r});let r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;return crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"")}},44632:(e,t,n)=>{"use strict";n.d(t,{Ck:()=>l,MC:()=>s,kv:()=>c,vL:()=>i});var r=n(36618),a=n.n(r),o=n(42511);let i,s,l;function c(e,t){if(e.serializedCommands){new o.CanvasSequence(e.serializedCommands).execute(t)}else t.drawImage(e,0,0)}const d="function"===typeof OffscreenCanvas,u=a();d?(i=(e,t)=>new OffscreenCanvas(e,t),s=window.createImageBitmap||self.createImageBitmap,l=window.ImageBitmap||self.ImageBitmap):u?(i=function(){return nodeCreateCanvas(...arguments)},s=async function(e){if((arguments.length<=1?0:arguments.length-1)>0)throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");const t=e.toDataURL(),n=new nodeImage;return new Promise(((e,r)=>{n.onload=()=>e(n),n.onerror=r,n.src=t}))}):(i=(e,t)=>{const n=new o.CanvasSequence;return{width:e,height:t,getContext:()=>n}},s=async e=>{const t=e.getContext("2d");return{height:e.height,width:e.width,serializedCommands:t.toJSON(),containsNoTransferables:!0}},l=String)},55619:(e,t,n)=>{"use strict";n.d(t,{AN:()=>d,Cj:()=>l,E9:()=>c});var r=n(41867),a=n(42511),o=n(44632),i=n(76258),s=n(80838);async function l(e,t,n,r){const{exportSVG:l,highResolutionScaling:c=1}=n;if(l){if(l.rasterizeLayers){const n=l.scale||c,a=(0,o.vL)(Math.ceil(e*n),t*n),d=a.getContext("2d");if(!d)throw new Error("2d canvas rendering not supported on this platform");d.scale(n,n);return{...await r(d),reactElement:(0,s.jsx)("image",{width:e,height:t,xlinkHref:"convertToBlob"in a?await(0,i.n)(await a.convertToBlob({type:"image/png"})):a.toDataURL("image/png")})}}{const e=new a.CanvasSequence;return{...await r(e),canvasRecordedData:e.toJSON()}}}{const n=c,a=(0,o.vL)(Math.ceil(e*n),t*n),i=a.getContext("2d");if(!i)throw new Error("2d canvas rendering not supported on this platform");i.scale(n,n);return{...await r(i),imageData:await(0,o.MC)(a)}}}async function c(e){const{width:t,height:r,canvasRecordedData:o}=e,i=new((await n.e(8887).then(n.t.bind(n,98887,23))).default)(t,r);return new a.CanvasSequence(o).execute(i),i.getSvg().innerHTML}function d(e){let{rendering:t}=e;return(0,s.jsx)(s.Fragment,{children:r.isValidElement(t.reactElement)?t.reactElement:(0,s.jsx)("g",{dangerouslySetInnerHTML:{__html:t.html||""}})})}},19881:(e,t,n)=>{"use strict";function r(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}function a(e,t,n,r){return t>n&&e<r}function o(e,t,n,r){return n<=e&&r>=t}n.d(t,{J7:()=>o,U0:()=>r,qY:()=>a})},16979:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ObservableCreate:()=>i});var r=n(59276),a=n(74039),o=n(90872);function i(e,t){return r.y.create((t=>{try{const n=e(t);n&&n.catch&&n.catch((e=>t.error(e)))}catch(n){t.error(n)}})).pipe((0,a.R)((0,o.observeAbortSignal)(t)))}},85291:(e,t,n)=>{"use strict";function r(e){return"object"===typeof e&&null!==e&&"function"===typeof e.get&&"function"===typeof e.id}function a(e){return"uniqueId"in e&&"object"!==typeof e.data}n.d(t,{T:()=>r,Z:()=>o});class o{constructor(e){this.data=void 0,this.subfeatures=void 0,this.parentHandle=void 0,this.uniqueId=void 0,a(e)?this.data=e:(this.data=e.data||{},this.parentHandle=e.parent);const t=a(e)?e.uniqueId:e.id;if(void 0===t||null===t)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(t),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));var n;this.data.subfeatures&&(this.subfeatures=null===(n=this.data.subfeatures)||void 0===n?void 0:n.map(((e,n)=>"function"!==typeof e.get?new o({id:e.uniqueId||"".concat(t,"-").concat(n),data:{strand:this.data.strand,...e},parent:this}):e)))}get(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}set(e,t){this.data[e]=t}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={...this.data,uniqueId:this.id()},t=this.parent();t&&(e.parentId=t.id());const n=this.children();return n&&(e.subfeatures=n.map((e=>e.toJSON()))),e}static fromJSON(e){return new o({...e})}}},81025:(e,t,n)=>{"use strict";n.d(t,{I9:()=>i,fK:()=>s,fY:()=>l});var r=n(24201),a=n(77469);function o(e,t,n){let r;return 0===n?0:(arguments.length>3&&void 0!==arguments[3]&&arguments[3]?r=t/n-e*e/(n*n):(r=t-e*e/n,n>1&&(r/=n-1)),r<0?0:Math.sqrt(r))}function i(e){return{...e,scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:o(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered}}async function s(e,t){const{start:n,end:o}=e,s={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0};let l=!1;const{scoreMin:c,scoreMax:d,scoreSum:u,scoreSumSquares:p,featureCount:h}=await(0,r.z)(t.pipe((0,a.u)(((e,t)=>{const n=t.get("score"),r=t.get("summary"),{scoreMax:a,scoreMin:o}=e;return e.scoreMax=Math.max(a,r?t.get("maxScore"):n),e.scoreMin=Math.min(o,r?t.get("minScore"):n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,l=!0,e}),s)));return l?i({scoreMax:d,scoreMin:c,scoreSum:u,scoreSumSquares:p,featureCount:h,basesCovered:o-n+1}):{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}function l(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},99512:(e,t,n)=>{"use strict";n.r(t),n.d(t,{UNKNOWN:()=>c,UNSUPPORTED:()=>d,generateUnknownTrackConf:()=>S,generateUnsupportedTrackConf:()=>C,getBlob:()=>p,getBlobMap:()=>h,getFileName:()=>v,getParentRenderProps:()=>l,getRpcSessionId:()=>s,getTrackAssemblyNames:()=>i,getTrackName:()=>k,guessAdapter:()=>w,guessTrackType:()=>x,makeIndex:()=>y,makeIndexType:()=>b,setBlobMap:()=>g,storeBlobLocation:()=>m});var r=n(31625),a=n(90872),o=n(43800);function i(e){const t=(0,o.getConf)(e,"assemblyNames");if(!t){const t=(0,r.getParent)(e.configuration);if("sequence"in t)return[(0,o.readConfObject)(t,"name")]}return t}function s(e){let t;for(let n=e;!(0,r.isRoot)(n);n=(0,r.getParent)(n))"rpcSessionId"in n&&(t=n.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function l(e){for(let t=(0,r.getParent)(e);!(0,r.isRoot)(t);t=(0,r.getParent)(t))if("renderProps"in t)return t.renderProps();return{}}const c="UNKNOWN",d="UNSUPPORTED";let u={};function p(e){return u[e]}function h(){return u}function g(e){u=e}let f=0;function m(e){if(e&&"blob"in e){const t="b".concat(+Date.now(),"-").concat(f++);return u[t]=e.blob,{name:null===e||void 0===e?void 0:e.blob.name,blobId:t,locationType:"BlobLocation"}}return e}function y(e,t){return"uri"in e?{uri:e.uri+t,locationType:"UriLocation"}:"localPath"in e?{localPath:e.localPath+t,locationType:"LocalPathLocation"}:e}function b(e,t,n){return null!==e&&void 0!==e&&e.toUpperCase().endsWith(t)?t:n}function v(e){const t="uri"in e?e.uri:void 0,n="localPath"in e?e.localPath:void 0,r="blobId"in e?e:void 0;return(null===r||void 0===r?void 0:r.name)||(null===t||void 0===t?void 0:t.slice(t.lastIndexOf("/")+1))||(null===n||void 0===n?void 0:n.slice(n.lastIndexOf("/")+1))||""}function w(e,t,n,r){if(r){const{pluginManager:o}=(0,a.getEnv)(r),i=o.evaluateExtensionPoint("Core-guessAdapterForLocation",((e,t,n)=>{}))(e,t,n);if(i)return i}return{type:c}}function x(e,t){if(t){const n=(0,a.getSession)(t),r=(0,a.getEnv)(n).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",(e=>{}))(e);if(r)return r}return"FeatureTrack"}function C(e,t,n){const r={type:"FeatureTrack",name:"".concat(e," (Unsupported)"),description:'Support not yet implemented for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=(0,a.objectHash)(r),r}function S(e,t,n){const r={type:"FeatureTrack",name:"".concat(e," (Unknown)"),description:'Could not determine track type for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=(0,a.objectHash)(r),r}function k(e,t){const n=(0,o.readConfObject)(e,"name");if(!n&&"ReferenceSequenceTrack"===(0,o.readConfObject)(e,"type")){const n=t.assemblies.find((t=>t.sequence===e));return n?"Reference sequence (".concat((0,o.readConfObject)(n,"displayName")||(0,o.readConfObject)(n,"name"),")"):"Reference sequence"}return n}},55022:(e,t,n)=>{"use strict";n.d(t,{At:()=>v,BQ:()=>a,J0:()=>w,Ms:()=>T,PK:()=>P,Um:()=>y,Z6:()=>M,_2:()=>u,_L:()=>s,cX:()=>i,d6:()=>f,dc:()=>b,fx:()=>C,gC:()=>d,gI:()=>c,gx:()=>l,hb:()=>x,k$:()=>o,ld:()=>S,uF:()=>p,yZ:()=>m,yb:()=>k,zL:()=>h,zN:()=>g});var r=n(31625);function a(e){return(0,r.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function o(e){return"object"===typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function i(e){return o(e)&&"editConfiguration"in e}function s(e){return o(e)&&"addTrackConf"in e&&!e.disableAddTracks}function l(e){return o(e)&&"shareURL"in e&&!!e.shareURL}function c(e){return o(e)&&"widgets"in e}function d(e){return o(e)&&"makeConnection"in e}function u(e){return o(e)&&"addConnectionConf"in e}function p(e){return o(e)&&"sessionPlugins"in e}function h(e){return"object"===typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function g(e){return"object"===typeof e&&null!==e&&"width"in e&&"setWidth"in e}function f(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function m(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function y(e){return"object"===typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function b(e){return"object"===typeof e&&null!==e&&"isAssemblyEditing"in e&&"findAppropriateInternetAccount"in e}function v(e){return"object"===typeof e&&null!==e&&"internetAccounts"in e&&"findAppropriateInternetAccount"in e}function w(e){return"object"===typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}function x(e){return"object"===typeof e&&null!==e&&"uri"in e&&!!e.uri}function C(e){return"object"===typeof e&&null!==e&&"localPath"in e&&!!e.localPath}function S(e){return"object"===typeof e&&null!==e&&"blobId"in e&&!!e.blobId}class k extends Error{constructor(e,t){super(e),this.message=e,this.url=t,this.name="AuthNeededError",Object.setPrototypeOf(this,k.prototype)}}class T extends Error{constructor(e,t){super(e),this.message=e,this.internetAccountId=t,this.name="RetryError"}}function P(e){return e instanceof Error&&("AuthNeededError"===e.name||void 0!==e.url)}function M(e){return"RetryError"===e.name||void 0!==e.internetAccountId}},57440:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(41867);function a(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)({width:void 0,height:void 0});return(0,r.useEffect)((()=>{if(!e.current)return;const t="undefined"!==typeof window&&"ResizeObserver"in window?window.ResizeObserver:void 0;if(!t)return;const r=new t((e=>{n({width:e[0].contentRect.width,height:e[0].contentRect.height})}));return r.observe(e.current),()=>{r.disconnect()}}),[]),[e,t]}},45445:(e,t,n)=>{"use strict";n.d(t,{g:()=>o,q:()=>i});var r=n(85815),a=n(47685);function o(e){let{timeout:t,signal:n,name:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((i,s)=>{let l=!1;const c=(0,r.when)(e);let d,u=()=>{};t&&(d=setTimeout((()=>{l||(l=!0,c.cancel(),s(new Error("timed out waiting for ".concat(o||"whenPresent"))))}),t),u=()=>d&&clearTimeout(d)),n&&n.addEventListener("abort",(()=>{l||(l=!0,c.cancel(),u(),s((0,a.fP)()))})),c.then((()=>{l||(l=!0,u(),i(!0))})).catch((e=>{l||(l=!0,u(),s(e))}))}))}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await o((()=>{const t=e();return void 0!==t&&null!==t}),t),e()}},41814:(e,t,n)=>{"use strict";n.r(t),n.d(t,{cigarToMismatches:()=>u,featurizeSA:()=>P,getClip:()=>k,getLength:()=>C,getLengthOnRef:()=>x,getLengthSansClipping:()=>S,getMethBins:()=>m,getMismatches:()=>h,getModificationPositions:()=>y,getModificationProbabilities:()=>f,getModificationTypes:()=>b,getNextRefPos:()=>g,getOrientedCigar:()=>v,getOrientedMismatches:()=>w,getTag:()=>T,mdToMismatches:()=>p,parseCigar:()=>d});var r=n(90872),a=n(39395);const o=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi),i=new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/),s=new RegExp(/([MIDNSHPX=])/),l=new RegExp(/(\d+)[SH]$/),c=new RegExp(/^(\d+)([SH])/);function d(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(s).slice(0,-1)}function u(e,t,n,r){let a=0,o=0;const i=[],s=n&&t;for(let l=0;l<e.length;l+=2){const c=+e[l],d=e[l+1];if("M"===d||"="===d||"E"===d){if(s)for(let e=0;e<c;e++)t[o+e].toUpperCase()!==n[a+e].toUpperCase()&&i.push({start:a+e,type:"mismatch",base:t[o+e],altbase:n[a+e],length:1});o+=c}if("I"===d)i.push({start:a,type:"insertion",base:"".concat(c),length:0}),o+=c;else if("D"===d)i.push({start:a,type:"deletion",base:"*",length:c});else if("N"===d)i.push({start:a,type:"skip",base:"N",length:c});else if("X"===d){const e=(null===t||void 0===t?void 0:t.slice(o,o+c))||[],n=(null===r||void 0===r?void 0:r.slice(o,o+c))||[];for(let t=0;t<c;t++)i.push({start:a+t,type:"mismatch",base:e[t],qual:n[t],length:1});o+=c}else"H"===d?i.push({start:a,type:"hardclip",base:"H".concat(c),cliplen:c,length:1}):"S"===d&&(i.push({start:a,type:"softclip",base:"S".concat(c),cliplen:c,length:1}),o+=c);"I"!==d&&"S"!==d&&"H"!==d&&(a+=c)}return i}function p(e,t,n,r,a){let i={start:0,base:"",length:0,type:"mismatch"},s=0,l=0,c=0,d=0;const u=[],p=n.filter((e=>"skip"===e.type));function h(e){let n=l,r=c;for(let a=s;a<t.length&&r<=e;a+=2,s=a){const e=+t[a],o=t[a+1];"S"===o||"I"===o?n+=e:"D"===o||"P"===o||"N"===o?r+=e:"H"!==o&&(n+=e,r+=e)}return l=n,c=r,n-(r-e)}const g=e.match(o)||[];for(const o of g){const e=+o;if(Number.isNaN(e))if(o.startsWith("^"))i.start+=o.length-1;else for(let t=0;t<o.length;t+=1){for(i.length=1;d<p.length;){const e=p[d];if(!(i.start>=e.start))break;i.start+=e.length,d++}const e=h(i.start);i.base=r[e]||"X",i.qual=null===a||void 0===a?void 0:a[e],i.altbase=o,u.push(i),i={start:i.start+i.length,length:0,base:"",type:"mismatch"}}else i.start+=e}return u}function h(e,t,n,r,a){let o=[];const i=d(e);return e&&(o=o.concat(u(i,n,r,a))),t&&n&&(o=o.concat(p(t,i,o,n,a))),o}function*g(e,t){let n=0,r=0,a=0;for(let o=0;o<e.length&&a<t.length;o+=2){const i=+e[o],s=e[o+1];if("S"===s||"I"===s){for(let e=0;e<i&&a<t.length;e++)t[a]===n+e&&a++;n+=i}else if("D"===s||"N"===s)r+=i;else if("M"===s||"X"===s||"="===s){for(let e=0;e<i&&a<t.length;e++)t[a]===n+e&&(yield r+e,a++);n+=i,r+=i}}}function f(e){var t;const n=(0,a.TN)(e,"ML","Ml")||[];return n?("string"===typeof n?n.split(",").map((e=>+e)):n).map((e=>e/255)):null===(t=(0,a.TN)(e,"MP","Mp"))||void 0===t?void 0:t.split("").map((e=>e.charCodeAt(0)-33)).map((e=>Math.min(1,e/50)))}function m(e){const t=e.get("start"),n=e.get("end"),r=e.get("strand"),o=n-t,i=(0,a.TN)(e,"MM","Mm")||"",s=new Array(o),l=new Array(o),c=e.get("seq");if(c){const t=d(e.get("CIGAR")),n=f(e),a=y(i,c,r);let u=0;for(const{type:e,positions:r}of a)if("m"===e)for(const a of g(t,r)){const e=(null===n||void 0===n?void 0:n[u])||0;u++,a>=0&&a<o&&(s[a]=1,l[a]=e)}}return{methBins:s,methProbs:l}}function y(e,t,n){const a=-1===n?(0,r.revcom)(t):t,o=e.split(";").filter((e=>!!e)),s=[];for(const r of o){const[e,...t]=r.split(","),o=e.match(i);if(!o)throw new Error("bad format for MM tag");const[,l,c,d]=o,u=d.split(/(\d+|.)/).filter((e=>!!e));"-"===c&&(console.warn("unsupported negative strand modifications"),s.push({type:"unsupported",positions:[]}));for(const r of u){let e=0;const o=[];for(const r of t){let t=+r;do{"N"!==l&&l!==a[e]||t--,e++}while(t>=0&&e<a.length);const i=e-1;o.push(-1===n?a.length-1-i:i)}-1===n&&o.sort(((e,t)=>e-t)),s.push({type:r,positions:o})}}return s}function b(e){return e.split(";").filter((e=>!!e)).flatMap((t=>{const[n]=t.split(","),r=n.match(i);if(!r)throw new Error("bad format for MM tag: ".concat(e));return r[3].split(/(\d+|.)/).filter((e=>!!e))}))}function v(e,t){if(e){const e=[];for(let n=0;n<t.length;n+=2){const r=t[n];let a=t[n+1];"D"===a?a="I":"I"===a&&(a="D"),e.push(r,a)}return e}return t}function w(e,t){const n=d(t);return u(e?v(e,n):n)}function x(e){const t=d(e);let n=0;for(let r=0;r<t.length;r+=2){const e=+t[r],a=t[r+1];"H"!==a&&"S"!==a&&"I"!==a&&(n+=e)}return n}function C(e){const t=d(e);let n=0;for(let r=0;r<t.length;r+=2){const e=+t[r],a=t[r+1];"D"!==a&&"N"!==a&&(n+=e)}return n}function S(e){const t=d(e);let n=0;for(let r=0;r<t.length;r+=2){const e=+t[r],a=t[r+1];"H"!==a&&"S"!==a&&"D"!==a&&"N"!==a&&(n+=e)}return n}function k(e,t){return-1===t?+(e.match(l)||[])[1]||0:+(e.match(c)||[])[1]||0}function T(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function P(e,t,n,r,a){return(null===e||void 0===e?void 0:e.split(";").filter((e=>!!e)).map(((e,o)=>{const[i,s,l,c]=e.split(","),d=x(c),u=C(c),p=S(c),h="-"===l?-1:1,g=k(c,(a?n:1)*h),f=+s-1;return{refName:i,start:f,end:f+d,seqLength:u,clipPos:g,CIGAR:c,strand:(a?n:1)*h,uniqueId:"".concat(t,"_SA").concat(o),mate:{start:g,end:g+p,refName:r}}})))||[]}},45627:(e,t,n)=>{"use strict";n.d(t,{MismatchParser:()=>j,P1:()=>yt,ZP:()=>Ct,Ct:()=>nt});var r=n(27032),a=n(31640),o=n(43800);const i=(0,o.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",description:"size in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:{type:"frozen",description:"sequence data adapter",defaultValue:null}},{explicitlyTyped:!0}),s=e=>{e.addAdapterType((()=>new a.Z({name:"CramAdapter",displayName:"CRAM adapter",configSchema:i,getAdapterClass:()=>Promise.all([n.e(9426),n.e(4229),n.e(7355),n.e(4013),n.e(287),n.e(6236)]).then(n.bind(n,78409)).then((e=>e.default))})))};var l=n(31625);const c=(0,o.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,o.ConfigurationSchema)("BamIndex",{indexType:{model:l.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",description:"size to fetch in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:5e6},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0}),d=e=>{e.addAdapterType((()=>new a.Z({name:"BamAdapter",displayName:"BAM adapter",configSchema:c,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(4229),n.e(2505),n.e(7843)]).then(n.bind(n,87843)).then((e=>e.default))})))};const u=(0,o.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",description:"the base URL to fetch from",defaultValue:""},htsgetTrackId:{type:"string",description:"the trackId, which is appended to the base URL",defaultValue:""},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0}),p=e=>{e.addAdapterType((()=>new a.Z({name:"HtsgetBamAdapter",displayName:"Htsget BAM adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:u,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(4229),n.e(2505),n.e(8015)]).then(n.bind(n,98015)).then((e=>e.default))})))};const h=(0,o.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0});function g(e){e.addAdapterType((()=>new a.Z({name:"SNPCoverageAdapter",displayName:"SNPCoverage adapter",adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(3139).then(n.bind(n,13139)).then((e=>e.default)),configSchema:h})))}const f=(0,o.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},drawArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0},color:{type:"color",description:"Background color for the SNPCoverage renderer",defaultValue:"#d3d3d3"}},{explicitlyTyped:!0});var m=n(35421),y=n(90872),b=n(42207);class v extends b.Aq{async draw(e,t){const{features:n,regions:r,bpPerPx:a,displayCrossHatches:i,modificationTagMap:s={},scaleOpts:l,height:c,theme:d,config:u,ticks:p}=t,h=(0,m.createJBrowseTheme)(d),[g]=r,f=(g.end-g.start)/a,v=b.Rv,w=c-2*v,{domain:x}=l;if(!x)return;const C={...l,range:[0,w]},S=(0,b.yZ)(C),k=(0,b.yZ)({...C,range:[0,w/2],scaleType:"linear"}),T=(0,b.P$)(l.scaleType),P=(0,b.P$)("linear"),M=(0,o.readConfObject)(u,"indicatorThreshold"),R=(0,o.readConfObject)(u,"drawInterbaseCounts"),A=(0,o.readConfObject)(u,"drawArcs"),I=(0,o.readConfObject)(u,"drawIndicators"),N=e=>w-(S(e)||0)+v,L=e=>N(T)-N(e),F=e=>w-(k(e)||0)+v,j=e=>F(P)-F(e),{bases:D}=h.palette,B={A:D.A.main,C:D.C.main,G:D.G.main,T:D.T.main,insertion:"purple",softclip:"blue",hardclip:"red",total:(0,o.readConfObject)(u,"color"),meth:"red",unmeth:"blue"},E=[...n.values()],V=E.filter((e=>"skip"!==e.get("type"))),z=E.filter((e=>"skip"===e.get("type")));e.fillStyle=B.total;for(const o of V){const[t,n]=(0,y.featureSpanPx)(o,g,a),r=n-t+.6,i=o.get("score");e.fillRect(t,N(i),r,L(i))}let O=0;const Z=g.reversed?1/a:0;for(const o of V){const[t,n]=(0,y.featureSpanPx)(o,g,a),r=o.get("score"),i=o.get("snpinfo"),l=Math.max(n-t,1),c=i.total,d=Object.keys(i.cov).sort();let u=0;for(const a of d){const{total:n}=i.cov[a];e.fillStyle=B[a]||s[a.replace("mod_","")]||"black";const o=L(r),c=N(r)+o;e.fillRect(Math.round(t),c-(n+u)/r*o,l,n/r*o),u+=n}const p=Object.keys(i.noncov),h=4.5;if(R){let n=0;for(const r of p){const{total:a}=i.noncov[r],o=.6;e.fillStyle=B[r],e.fillRect(t-o+Z,h+j(n),2*o,j(a)),n+=a}}if(I){let n=0,r=0,a="";for(const e of p){const{total:t}=i.noncov[e];n+=t,t>r&&(r=t,a=e)}const o=Math.max(c,O);if(n>o*M&&o>7){e.fillStyle=B[a],e.beginPath();const n=t+Z;e.moveTo(n-3.5,0),e.lineTo(n+3.5,0),e.lineTo(n,h),e.fill()}}O=c}if(A)for(const o of z){const[t,n]=(0,y.bpSpanPx)(o.get("start"),o.get("end"),g,a);e.beginPath();const r=o.get("strand"),i=o.get("xs"),s="rgba(255,200,200,0.7)",l="rgba(200,200,255,0.7)",c="rgba(200,200,200,0.7)";e.strokeStyle="+"===i?s:"-"===i?l:1===r?s:-1===r?l:c,e.lineWidth=Math.log(o.get("score")+1),e.moveTo(t,w-2*v),e.bezierCurveTo(t,0,n,0,n,w-2*v),e.stroke()}i&&(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",p.values.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(N(t))),e.lineTo(f,Math.round(N(t))),e.stroke()})))}}function w(e){e.addRendererType((()=>new v({name:"SNPCoverageRenderer",ReactComponent:b.Eh,configSchema:f,pluginManager:e})))}var x=n(88016),C=n(93912),S=n(34399),k=n.n(S);class T extends x.LayoutSession{constructor(e){super(e),this.sortedBy=void 0,this.filterBy=void 0,this.showSoftClip=!1,this.cachedLayout=void 0,this.config=e.config}cachedLayoutIsValid(e){return super.cachedLayoutIsValid(e)&&this.showSoftClip===e.showSoftClip&&k()(this.sortedBy,e.sortedBy)&&k()(this.filterBy,e.filterBy)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,o.readConfObject)(this.config),filters:this.filters,filterBy:this.filterBy,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}var P=n(39395);function M(e){const{layout:t,features:n,sortedBy:r,config:a,bpPerPx:i,showSoftClip:s,regions:l}=e,[c]=l;if(!t)throw new Error("layout required");if(!t.addRect)throw new Error("invalid layout object");const d=null!==r&&void 0!==r&&r.type&&c.start===r.pos?((e,t)=>{const n=Array.from(e.values()),r=[],a=[],{pos:o,type:i}=t;n.forEach((e=>{const t=e,n=t.get("start"),i=t.get("end");(0,y.doesIntersect2)(o-1,o,n,i)?r.push(e):a.push(e)}));const s=!!n.length&&n[0].get("tags");switch(i){case"Start location":r.sort(((e,t)=>e.get("start")-t.get("start")));break;case"tag":{const e=t.tag,n=(e,t)=>s?e.get("tags")[t]:e.get(t);r[0]&&"string"===typeof n(r[0],e)?r.sort(((t,r)=>n(r,e).localeCompare(n(t,e)))):r.sort(((t,r)=>(n(r,e)||0)-(n(t,e)||0)));break}case"Base pair":{const e=[];r.forEach((t=>{t.get("mismatches").forEach((n=>{const r=t.get("start")+n.start+1,a="insertion"===n.type||"softclip"===n.type?0:n.length;o>=r&&o<r+a&&e.push([t.id(),n])}))}));const t=new Map(e);r.sort(((e,n)=>{const r=t.get(e.id()),a=t.get(n.id()),o=null===a||void 0===a?void 0:a.base.toUpperCase(),i=null===r||void 0===r?void 0:r.base.toUpperCase();return o===i&&"*"===o?r.length-a.length:(o?o.charCodeAt(0):0)-(i?i.charCodeAt(0):0)}));break}case"Read strand":r.sort(((e,t)=>e.get("strand")<=t.get("strand")?1:-1))}return new Map([...r,...a].map((e=>[e.id(),e])))})(n,r):n,u=(0,o.readConfObject)(a,"height"),p=(0,o.readConfObject)(a,"displayMode");return(0,y.iterMap)(d.values(),(e=>function(e){let{feature:t,layout:n,bpPerPx:r,region:a,showSoftClip:o,heightPx:i,displayMode:s}=e,l=0,c=0;if(o){const e=t.get("mismatches");if(t.get("seq"))for(const{type:t,start:n,cliplen:r=0}of e)"softclip"===t&&(0===n?l=r:c=r)}const[d,u]=(0,y.bpSpanPx)(t.get("start")-l,t.get("end")+c,a,r);if("compact"===s&&(i/=3),t.get("refName")!==a.refName)throw new Error("feature ".concat(t.id()," is not on the current region's reference sequence ").concat(a.refName));const p=n.addRect(t.id(),t.get("start")-l,t.get("end")+c,i,t);return null===p?null:{feature:t,leftPx:d,rightPx:u,topPx:"collapse"===s?0:p,heightPx:i}}({feature:e,layout:t,bpPerPx:i,region:c,showSoftClip:s,heightPx:u,displayMode:p})),d.size)}function R(e,t,n,r,a,o,i){t+r<0||t>o||(i&&(e.fillStyle=i),e.fillRect(t,n,r,a))}function A(e){const{bases:t}=e.palette;return{A:t.A.main,C:t.C.main,G:t.G.main,T:t.T.main,deletion:"#808080"}}function I(){return{charWidth:(0,y.measureText)("A"),charHeight:(0,y.measureText)("M")-2}}var N=n(69349);function L(e,t){return N.If[function(e,t){const n=(0,o.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[P.uD[n][e.get("pair_orientation")]]}(e,t)||"color_nostrand"]}function F(e){let{colorType:t,tag:n,feature:r,config:a,defaultColor:i,colorTagMap:s}=e;switch(t){case"insertSize":return function(e){return e.get("is_paired")&&e.get("refName")!==e.get("next_ref")?"#555":"hsl(".concat(Math.abs(e.get("template_length"))/10,",50%,50%)")}(r);case"strand":return function(e){return-1===e.get("strand")?"#8F8FD8":"#EC8B8B"}(r);case"mappingQuality":return function(e){return"hsl(".concat(e.get("score"),",50%,50%)")}(r);case"pairOrientation":return L(r,a);case"stranded":return function(e){return N.If[function(e){const t=e.get("flags"),n=e.get("strand");if(1&t){const r=64&t?-1:1;return 2&t?n*r===1?"color_rev_strand":"color_fwd_strand":8&t?n*r===1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("refName")===e.get("next_ref")?n*r===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===n?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(e)]}(r);case"xs":case"tag":{const e=r.get("tags"),t=e?e[n]:r.get(n);return"XS"===n||"TS"===n?N.If[{"-":"color_rev_strand","+":"color_fwd_strand"}[t]||"color_nostrand"]:"ts"===n?N.If[{"-":-1===r.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===r.get("strand")?"color_rev_strand":"color_fwd_strand"}[t]||"color_nostrand"]:s[t]||N.If.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return i?"lightgrey":(0,o.readConfObject)(a,"color",{feature:r})}}var j=n(41814);var D=n(622);function B(e){let{ctx:t,feat:n,renderArgs:r,colorForBase:a,contrastForBase:o,charWidth:i,charHeight:s,defaultColor:l,canvasWidth:c}=e;const{config:d,bpPerPx:u,regions:p,colorBy:h,colorTagMap:g={}}=r,{tag:f="",type:m=""}=h||{},{feature:b}=n,v=p[0];switch(t.fillStyle=F({feature:b,config:d,tag:f,defaultColor:l,colorType:m,colorTagMap:g}),function(e){let{ctx:t,feat:n,renderArgs:r}=e;const{regions:a,bpPerPx:o}=r,{heightPx:i,topPx:s,feature:l}=n,[c]=a,d=l.get("start"),u=l.get("end"),[p,h]=(0,y.bpSpanPx)(d,u,c,o),g=c.reversed?-1:1,f=l.get("strand")*g;o<10&&i>5?-1===f?(t.beginPath(),t.moveTo(p-5,s+i/2),t.lineTo(p,s+i),t.lineTo(h,s+i),t.lineTo(h,s),t.lineTo(p,s),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(p,s),t.lineTo(p,s+i),t.lineTo(h,s+i),t.lineTo(h+5,s+i/2),t.lineTo(h,s),t.closePath(),t.fill()):t.fillRect(p,s,h-p,i)}({ctx:t,feat:n,renderArgs:r}),m){case"perBaseQuality":!function(e){let{ctx:t,feat:n,region:r,bpPerPx:a,canvasWidth:o}=e;const{feature:i,topPx:s,heightPx:l}=n,c=(i.get("qual")||"").split(" ").map((e=>+e)),d=(0,j.parseCigar)(i.get("CIGAR")),u=1/a,p=i.get("start");let h=0,g=0;for(let f=0;f<d.length;f+=2){const e=+d[f],n=d[f+1];if("S"===n||"I"===n)h+=e;else if("D"===n||"N"===n)g+=e;else if("M"===n||"X"===n||"="===n){for(let n=0;n<e;n++){const e=c[h+n],i=p+g+n;R(t,(0,y.bpSpanPx)(i,i+1,r,a)[0],s,u+.5,l,o,"hsl(".concat(255===e?150:1.5*e,",55%,50%)"))}h+=e,g+=e}}}({ctx:t,feat:n,region:v,bpPerPx:u,canvasWidth:c});break;case"perBaseLettering":!function(e){let{ctx:t,feat:n,region:r,bpPerPx:a,colorForBase:o,contrastForBase:i,charWidth:s,charHeight:l,canvasWidth:c}=e;const d=l-2,{feature:u,topPx:p,heightPx:h}=n,g=u.get("seq"),f=(0,j.parseCigar)(u.get("CIGAR")),m=1/a,b=u.get("start");let v=0,w=0;if(g)for(let x=0;x<f.length;x+=2){const e=+f[x],n=f[x+1];if("S"===n||"I"===n)v+=e;else if("D"===n||"N"===n)w+=e;else if("M"===n||"X"===n||"="===n){for(let n=0;n<e;n++){const e=g[v+n],l=b+w+n,[u]=(0,y.bpSpanPx)(l,l+1,r,a);R(t,u,p,m+.5,h,c,o[e]),m>=s&&h>=d&&(t.fillStyle=i[e],t.fillText(e,u+(m-s)/2+1,p+h))}v+=e,w+=e}}}({ctx:t,feat:n,region:v,bpPerPx:u,colorForBase:a,contrastForBase:o,charWidth:i,charHeight:s,canvasWidth:c});break;case"modifications":!function(e){let{ctx:t,feat:n,region:r,bpPerPx:a,renderArgs:o,canvasWidth:i}=e;const{feature:s,topPx:l,heightPx:c}=n,{modificationTagMap:d={}}=o,u=s.get("seq");if(!u)return;const p=(0,P.TN)(s,"MM","Mm")||"",h=s.get("CIGAR"),g=s.get("start"),f=s.get("strand"),m=(0,j.parseCigar)(h),b=(0,j.getModificationProbabilities)(s),v=(0,j.getModificationPositions)(p,u,f);let w=0;for(const{type:x,positions:C}of v){const e=d[x]||"black",n=(0,D.V)(e);for(const o of(0,j.getNextRefPos)(m,C)){const s=g+o,[d,u]=(0,y.bpSpanPx)(s,s+1,r,a),p=(null===b||void 0===b?void 0:b[w])||0;R(t,d,l,u-d+.5,c,i,1!==p?n.alpha(p+.1).toHslString():e),w++}}}({ctx:t,feat:n,region:v,bpPerPx:u,renderArgs:r,canvasWidth:c});break;case"methylation":!function(e){let{ctx:t,feat:n,region:r,bpPerPx:a,renderArgs:o,canvasWidth:i}=e;const{regionSequence:s}=o,{feature:l,topPx:c,heightPx:d}=n;if(!s)throw new Error("region sequence required for methylation");if(!l.get("seq"))return;const u=l.get("start"),p=l.get("end"),{methBins:h,methProbs:g}=(0,j.getMethBins)(l);function f(e){if(h[e]){const t=g[e]||0;return(t>.5?(0,D.V)("red").alpha(2*(t-.5)):(0,D.V)("blue").alpha(1-2*t)).toHslString()}}for(let v=0;v<p-u;v++){var m,b;const e=v+u,n=null===(m=s[e-r.start+1])||void 0===m?void 0:m.toLowerCase(),o=null===(b=s[e-r.start+2])||void 0===b?void 0:b.toLowerCase();if("c"===n&&"g"===o)if(a>2){const[n,o]=(0,y.bpSpanPx)(e,e+2,r,a);R(t,n,c,o-n+.5,d,i,f(v)||f(v+1)||"blue")}else{const[n,o]=(0,y.bpSpanPx)(e,e+1,r,a);R(t,n,c,o-n+.5,d,i,f(v)||"blue");const[s,l]=(0,y.bpSpanPx)(e+1,e+2,r,a);R(t,s,c,l-s+.5,d,i,f(v+1)||"blue")}}}({ctx:t,feat:n,region:v,bpPerPx:u,renderArgs:r,canvasWidth:c})}}function E(e){let{ctx:t,feat:n,renderArgs:r,minSubfeatureWidth:a,largeInsertionIndicatorScale:o,mismatchAlpha:i,charWidth:s,charHeight:l,colorForBase:c,contrastForBase:d,canvasWidth:u,drawSNPsMuted:p,drawIndels:h=!0}=e;const{bpPerPx:g,regions:f}=r,{heightPx:m,topPx:b,feature:v}=n,[w]=f,x=v.get("start"),C=Math.min(1/g,2),S=v.get("mismatches"),k=l-2,T=w.reversed?1/g+1:-1;if(S){for(const e of S){const n=x+e.start,r=e.length,o=e.base,[l,f]=(0,y.bpSpanPx)(n,n+r,w,g),v=Math.max(a,Math.abs(l-f));if("mismatch"===e.type){if(!p){const n=c[e.base]||"#888",r=i?void 0===e.qual?n:(0,D.V)(n).alpha(Math.min(1,e.qual/50)).toHslString():n;R(t,Math.round(l),b,v,m,u,r)}if(v>=s&&m>=k){const n=p?"black":d[e.base]||"black";t.fillStyle=i?void 0===e.qual?n:(0,D.V)(n).alpha(Math.min(1,e.qual/50)).toHslString():n,t.fillText(o,l+(v-s)/2+1,b+m)}}else if("deletion"===e.type&&h){R(t,l,b,Math.abs(l-f),m,u,c.deletion);const n="".concat(e.length),r=(0,y.measureText)(n,10);v>=r&&m>=k&&(t.fillStyle=d.deletion,t.fillText(n,(l+f)/2-r/2,b+m))}else if("insertion"===e.type&&h){t.fillStyle="purple";const n=l+T,r=+e.base||e.length,a=Math.max(0,Math.min(1.2,1/g));if(r<10&&(R(t,n,b,a,m,u,"purple"),1/g>=s&&m>=k)){const r=n-a;R(t,r,b,3*a,1,u),R(t,r,b+m-1,3*a,1,u),t.fillText("(".concat(e.base,")"),n+3,b+m)}}else if("hardclip"===e.type||"softclip"===e.type){const n=l+T,r="hardclip"===e.type?"red":"blue",o=Math.max(a,C);if(R(t,n,b,o,m,u,r),1/g>=s&&m>=k){const r=n-o;R(t,r,b,3*o,1,u),R(t,r,b+m-1,3*o,1,u),t.fillText("(".concat(e.base,")"),n+3,b+m)}}else if("skip"===e.type&&l+v>0){const e=v-(g>10?1.5:0);t.clearRect(l,b,e,m),R(t,Math.max(0,l),b+m/2-1,e+(l<0?l:0),2,u,"#333")}}if(h)for(const e of S){const n=x+e.start,r=e.length,[a]=(0,y.bpSpanPx)(n,n+r,w,g),i=+e.base||e.length,s="".concat(i);if("insertion"===e.type&&i>=10)if(g>o)R(t,a-1,b,2,m,u,"purple");else if(m>l){const e=(0,y.measureText)(s),n=5;R(t,a-e/2-n,b,e+2*n,m,u,"purple"),t.fillStyle="white",t.fillText(s,a-e/2,b+m)}else{const e=2;R(t,a-e,b,2*e,m,u,"purple")}}}}function V(e){let{ctx:t,feat:n,renderArgs:r,config:a,theme:i,colorForBase:s,canvasWidth:l}=e;const{feature:c,topPx:d,heightPx:u}=n,{regions:p,bpPerPx:h}=r,[g]=p,f=(0,o.readConfObject)(a,"minSubfeatureWidth"),m=c.get("mismatches"),b=c.get("seq"),{charWidth:v,charHeight:w}=I();if(!b||!m)return;const x=w-2;for(const o of m)if("softclip"===o.type){const e=o.cliplen||0,n=c.get("start"),r=0===o.start?n-e:n+o.start;for(let a=0;a<e;a+=1){const e=b.charAt(a+o.start);if(!e)return;const n=r+a,[c,p]=(0,y.bpSpanPx)(n,n+1,g,h),m=Math.max(f,p-c),w=s[e]||"#000000";t.fillStyle=w,R(t,c,d,m,u,l),m>=v&&u>=x&&(t.fillStyle=i.palette.getContrastText(w),t.fillText(e,c+(m-v)/2+1,d+u))}}}function z(e){let{ctx:t,layoutRecords:n,canvasWidth:r,renderArgs:a}=e;const{config:i,showSoftClip:s,colorBy:l,theme:c}=a,d=(0,o.readConfObject)(i,"mismatchAlpha"),u=(0,o.readConfObject)(i,"minSubfeatureWidth"),p=(0,o.readConfObject)(i,"largeInsertionIndicatorScale"),h="#f0f"===(0,o.readConfObject)(i,"color"),g=(0,m.createJBrowseTheme)(c),f=A(g),y=function(e){return Object.fromEntries(Object.entries(A(e)).map((t=>{let[n,r]=t;return[n,e.palette.getContrastText(r)]})))}(g);t.font="bold 10px Courier New,monospace";const{charWidth:b,charHeight:v}=I(),w=(x=null===l||void 0===l?void 0:l.type,["methylation","modifications"].includes(x||""));var x;for(const o of n)B({ctx:t,feat:o,renderArgs:a,defaultColor:h,colorForBase:f,contrastForBase:y,charWidth:b,charHeight:v,canvasWidth:r}),E({ctx:t,feat:o,renderArgs:a,mismatchAlpha:d,drawSNPsMuted:w,drawIndels:true,largeInsertionIndicatorScale:p,minSubfeatureWidth:u,charWidth:b,charHeight:v,colorForBase:f,contrastForBase:y,canvasWidth:r}),s&&V({ctx:t,feat:o,renderArgs:a,colorForBase:f,config:i,theme:g,canvasWidth:r})}class O extends x.default{constructor(){super(...arguments),this.supportsSVG=!0}async fetchSequence(e){const{sessionId:t,regions:n,adapterConfig:r}=e,{sequenceAdapter:a}=r;if(!a)return;const o=this.pluginManager,{dataAdapter:i}=await(0,C.uP)(o,t,a),[s]=n;return(0,P.O)(s,i)}getExpandedRegion(e,t){const{config:n,showSoftClip:r}=t,{start:a,end:i}=e,s=(0,o.readConfObject)(n,"maxClippingSize"),l=r?Math.round(s):0;return{...e,start:Math.floor(Math.max(a-l,0)),end:Math.ceil(i+l)}}async render(e){var t;const n=await this.getFeatures(e),r=this.createLayoutInWorker(e),{regions:a,bpPerPx:o}=e,[i]=a,s=M({...e,features:n,layout:r}),l=n.size&&(0,P.ES)(null===(t=e.colorBy)||void 0===t?void 0:t.type)?await this.fetchSequence(e):void 0,c=(i.end-i.start)/o,d=Math.max(r.getTotalHeight(),1),u=await(0,y.renderToAbstractCanvas)(c,d,e,(t=>z({ctx:t,layoutRecords:s.filter(y.notEmpty),canvasWidth:c,renderArgs:{...e,layout:r,features:n,regionSequence:l}})));return{...await super.render({...e,...u,features:n,layout:r,height:d,width:c}),...u,features:new Map,layout:r,height:d,width:c,maxHeightReached:r.maxHeightReached}}createSession(e){return new T(e)}}const Z=(0,o.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:l.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orientation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:l.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:1},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});var W=n(41867),H=n(3762),G=n(80838);const q=(0,H.observer)((function(e){var t;const{onMouseMove:n,blockKey:r,displayModel:a,width:o,height:i,regions:s,bpPerPx:l,sortedBy:c,colorBy:d,filterBy:u}=e,{selectedFeatureId:p,featureIdUnderMouse:h,contextMenuFeature:g}=a,[f]=s,b=(0,W.useRef)(null),[v,w]=(0,W.useState)(!1),[x,C]=(0,W.useState)(!1);function S(t,n){const r=e["onFeature".concat(t)],a=e["on".concat(t)];r&&h?r(n,h):a&&a(n,h)}(0,W.useEffect)((()=>{var e,t;const n=b.current;if(!n)return;const o=n.getContext("2d");if(!o)return;o.clearRect(0,0,n.width,n.height);const i=p?null===(e=a.getFeatureByID)||void 0===e?void 0:e.call(a,r,p):void 0;if(i){const[e,t,n,r]=i,[a,s]=(0,y.bpSpanPx)(e,n,f,l),c=Math.round(t),d=Math.round(r-t);o.shadowColor="#222266",o.shadowBlur=10,o.lineJoin="bevel",o.lineWidth=2,o.strokeStyle="#00b8ff",o.strokeRect(a-2,c-2,s-a+4,d+4),o.clearRect(a,c,s-a,d)}const s=h||(null===g||void 0===g?void 0:g.id()),c=s?null===(t=a.getFeatureByID)||void 0===t?void 0:t.call(a,r,s):void 0;if(c){const[e,t,n,r]=c,[a,i]=(0,y.bpSpanPx)(e,n,f,l),s=Math.round(t),d=Math.round(r-t);o.fillStyle="#0003",o.fillRect(a,s,i-a,d)}}),[l,f,r,p,a,h,g]);const k=Math.ceil(o);return(0,G.jsxs)("div",{"data-testid":"pileup-".concat([null===c||void 0===c?void 0:c.type,null===d||void 0===d?void 0:d.type,null===d||void 0===d?void 0:d.tag,null===u||void 0===u||null===(t=u.tagFilter)||void 0===t?void 0:t.tag].filter((e=>!!e)).join("-")),style:{position:"relative",width:k,height:i},children:[(0,G.jsx)(m.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:0}}),(0,G.jsx)("canvas",{"data-testid":"pileup_overlay_canvas",width:k,height:i+100,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:b,onMouseDown:e=>function(e){w(!0),C(!1),S("MouseDown",e)}(e),onMouseEnter:e=>function(e){S("MouseEnter",e)}(e),onMouseOut:e=>function(e){S("MouseOut",e),S("MouseLeave",e)}(e),onMouseOver:e=>function(e){S("MouseOver",e)}(e),onMouseUp:e=>function(e){w(!1),S("MouseUp",e)}(e),onMouseLeave:e=>function(e){S("MouseOut",e),S("MouseLeave",e)}(e),onMouseMove:e=>function(e){if(!b.current)return;v&&C(!0);const t=b.current.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top,c=f.reversed?o-i:i,d=f.start+l*c;null===n||void 0===n||n(e,a.getFeatureOverlapping(r,d,s))}(e),onClick:e=>function(e){x||S("Click",e)}(e),onContextMenu:e=>function(e){S("ContextMenu",e)}(e),onFocus:()=>{},onBlur:()=>{}})]})}));function _(e){e.addRendererType((()=>new O({name:"PileupRenderer",displayName:"Pileup renderer",ReactComponent:q,configSchema:Z,pluginManager:e})))}var U=n(63048),J=n(4592);var X=n(85815),Y=n(88057);function Q(e){return e.getDisplayElements().filter((e=>{var t;return"LinearAlignmentsDisplay"===(null===(t=e.subDisplay)||void 0===t?void 0:t.type)})).filter((e=>{var t;return null===(t=e.subDisplay)||void 0===t?void 0:t.lowerPanel}))}function K(e,t){return k()(e?(0,l.getSnapshot)(e):void 0,t?(0,l.getSnapshot)(t):void 0)}function $(e){const{PileupDisplay:t,SNPCoverageDisplay:n}=e;return t||(0,l.isAlive)(t)||n||(0,l.isAlive)(n)}const ee=function(e,t){return l.types.compose("LinearAlignmentsDisplay",Y.BaseDisplay,function(e,t){const n=Q(e).map((e=>e.stateModel));return l.types.model({PileupDisplay:l.types.maybe(l.types.union(...n)),SNPCoverageDisplay:l.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:l.types.literal("LinearAlignmentsDisplay"),configuration:(0,o.ConfigurationReference)(t),heightPreConfig:l.types.maybe(l.types.number),userFeatureScreenDensity:l.types.maybe(l.types.number),lowerPanelType:"LinearPileupDisplay"})}(e,t)).volatile((()=>({scrollTop:0}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setSNPCoverageHeight(t){e.snpCovHeight=t}}))).views((e=>({get height(){var t;return null!==(t=e.heightPreConfig)&&void 0!==t?t:(0,o.getConf)(e,"height")},get featureIdUnderMouse(){return e.PileupDisplay.featureIdUnderMouse||e.SNPCoverageDisplay.featureIdUnderMouse}}))).views((e=>({get pileupConf(){return{...(0,o.getConf)(e,"pileupDisplay"),type:e.lowerPanelType,displayId:"".concat(e.configuration.displayId,"_").concat(e.lowerPanelType,"_xyz")}},getFeatureByID:(t,n)=>e.PileupDisplay.getFeatureByID(t,n),searchFeatureByID(t){var n,r;return null===(n=(r=e.PileupDisplay).searchFeatureByID)||void 0===n?void 0:n.call(r,t)},get features(){return e.PileupDisplay.features},get DisplayBlurb(){var t;return null===(t=e.PileupDisplay)||void 0===t?void 0:t.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get coverageConf(){return{...(0,o.getConf)(e,"snpCoverageDisplay"),displayId:"".concat(e.configuration.displayId,"_snpcoverage_xyz")}}}))).actions((e=>({setSNPCoverageDisplay(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setFeatureDensityStatsLimit(t){e.PileupDisplay.setFeatureDensityStatsLimit(t),e.SNPCoverageDisplay.setFeatureDensityStatsLimit(t)},setPileupDisplay(t){e.PileupDisplay={type:t.type||"LinearPileupDisplay",configuration:t}},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.heightPreConfig),setLowerPanelType(t){e.lowerPanelType=t},resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n}}))).actions((e=>({afterAttach(){(0,l.addDisposer)(e,(0,X.autorun)((()=>{const{SNPCoverageDisplay:t,PileupDisplay:n,coverageConf:r,pileupConf:a}=e;t?k()(r,(0,l.getSnapshot)(t.configuration))||(t.setHeight(e.snpCovHeight),t.setConfig(e.coverageConf)):e.setSNPCoverageDisplay(r),n&&e.lowerPanelType===n.type?k()(a,(0,l.getSnapshot)(n.configuration))||n.setConfig(e.pileupConf):e.setPileupDisplay(a),function(e){const{PileupDisplay:t,SNPCoverageDisplay:n}=e;$(e)&&t.colorBy&&(K(t.colorBy,n.colorBy)||n.setColorBy((0,l.getSnapshot)(t.colorBy)))}(e),function(e){const{PileupDisplay:t,SNPCoverageDisplay:n}=e;$(e)&&t.filterBy&&(K(t.filterBy,n.filterBy)||n.setFilterBy((0,l.getSnapshot)(t.filterBy)))}(e)}))),(0,l.addDisposer)(e,(0,X.autorun)((()=>{e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)}))),(0,l.addDisposer)(e,(0,X.autorun)((()=>{e.PileupDisplay.setHeight(e.height-e.SNPCoverageDisplay.height)})))},async renderSvg(t){const n=e.height-e.SNPCoverageDisplay.height;return await(0,X.when)((()=>!e.PileupDisplay.renderProps().notReady&&!e.SNPCoverageDisplay.renderProps().notReady)),(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)("g",{children:await e.SNPCoverageDisplay.renderSvg(t)}),(0,G.jsx)("g",{transform:"translate(0 ".concat(e.SNPCoverageDisplay.height,")"),children:await e.PileupDisplay.renderSvg({...t,overrideHeight:n})})]})}}))).views((t=>{const{trackMenuItems:n}=t;return{trackMenuItems(){if(!t.PileupDisplay)return[];const r=Q(e).map((e=>({type:"radio",label:e.displayName,checked:e.name===t.PileupDisplay.type,onClick:()=>t.setLowerPanelType(e.name)})));return[...n(),{type:"subMenu",label:"Pileup settings",subMenu:t.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:t.SNPCoverageDisplay.trackMenuItems()},{type:"subMenu",label:"Replace lower panel with...",subMenu:r}]}}})).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...n}=e;return{heightPreConfig:t,...n}}))};var te=n(47192);const ne=(0,te.ZL)()({resizeHandle:{height:5,position:"absolute",zIndex:2}}),re=(0,H.observer)((function(e){var t;let{model:n}=e;const{PileupDisplay:r,SNPCoverageDisplay:a}=n,{classes:i}=ne();if(!a)return null;const s=null!==(t=a.height)&&void 0!==t?t:100;return(0,G.jsxs)("div",{"data-testid":"display-".concat((0,o.getConf)(n,"displayId")),style:{position:"relative"},children:[(0,G.jsx)("div",{"data-testid":"Blockset-snpcoverage",children:(0,G.jsx)(a.RenderingComponent,{model:a})}),(0,G.jsx)(m.ResizeHandle,{onDrag:e=>(a.setHeight(a.height+e),e),className:i.resizeHandle,style:{top:s-4}}),(0,G.jsx)("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:s},children:(0,G.jsx)(r.RenderingComponent,{model:r})})]})})),ae=re;function oe(e){e.addDisplayType((()=>{const t=(n=e,(0,o.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:n.getDisplayType("LinearPileupDisplay").configSchema,snpCoverageDisplay:n.getDisplayType("LinearSNPCoverageDisplay").configSchema,height:{type:"number",defaultValue:250}},{baseConfiguration:J.fU,explicitlyTyped:!0}));var n;return new U.Z({name:"LinearAlignmentsDisplay",displayName:"Alignments display (combination)",configSchema:t,stateModel:ee(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:ae})}))}var ie=n(15974);const se=e=>e.toLocaleString("en-US"),le=(e,t)=>"".concat(function(){return+(+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)).toFixed(1)}(e/(t||1)*100),"%"),ce=W.forwardRef((function(e,t){let{feature:n}=e;const r=n.get("start"),a=n.get("end"),o=n.get("refName"),{refbase:i,all:s,total:l,ref:c,"-1":d,1:u,0:p,...h}=n.get("snpinfo"),g=[o,r===a?se(r):"".concat(se(r),"..").concat(se(a))].filter((e=>!!e)).join(":");return(0,G.jsx)("div",{ref:t,children:(0,G.jsxs)("table",{children:[(0,G.jsx)("caption",{children:g}),(0,G.jsx)("thead",{children:(0,G.jsxs)("tr",{children:[(0,G.jsx)("th",{children:"Base"}),(0,G.jsx)("th",{children:"Count"}),(0,G.jsx)("th",{children:"% of Total"}),(0,G.jsx)("th",{children:"Strands"}),(0,G.jsx)("th",{children:"Source"})]})}),(0,G.jsxs)("tbody",{children:[(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{children:"Total"}),(0,G.jsx)("td",{children:s})]}),(0,G.jsxs)("tr",{children:[(0,G.jsxs)("td",{children:["REF ",i?"(".concat(i.toUpperCase(),")"):""]}),(0,G.jsx)("td",{children:c}),(0,G.jsx)("td",{children:le(c,s)}),(0,G.jsxs)("td",{children:[d?"".concat(d,"(-)"):"",u?"".concat(u,"(+)"):""]}),(0,G.jsx)("td",{})]}),Object.entries(h).map((e=>{let[t,n]=e;return Object.entries(n).map((e=>{let[n,r]=e;return(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{children:n.toUpperCase()}),(0,G.jsx)("td",{children:r.total}),(0,G.jsx)("td",{children:"total"===n||"skip"===n?"---":le(r.total,s)}),(0,G.jsxs)("td",{children:[r[-1]?"".concat(r[-1],"(-)"):"",r[1]?"".concat(r[1],"(+)"):""]}),(0,G.jsx)("td",{children:t})]},n)}))}))]})]})})})),de=(0,H.observer)((e=>{const{model:t}=e,{featureUnderMouse:n}=t;return n&&"skip"===n.get("type")?null:(0,G.jsx)(b.u,{TooltipContents:ce,...e})})),ue=de;var pe=n(99512);async function he(e,t,n,r,a){const{rpcManager:o}=(0,y.getSession)(e),i=(0,pe.getRpcSessionId)(e);return await o.call(i,"PileupGetVisibleModifications",{adapterConfig:t,tag:n.tag,sessionId:i,regions:r.contentBlocks,...a})}const ge=l.types.model({flagInclude:l.types.optional(l.types.number,0),flagExclude:l.types.optional(l.types.number,1540),readName:l.types.maybe(l.types.string),tagFilter:l.types.maybe(l.types.model({tag:l.types.string,value:l.types.string}))}),fe=new Map([["snpcoverage","SNPCoverageRenderer"]]);const me=function(e,t){return l.types.compose("LinearSNPCoverageDisplay",(0,b.LT)(e,t),l.types.model({type:l.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:l.types.maybe(l.types.boolean),drawIndicators:l.types.maybe(l.types.boolean),drawArcs:l.types.maybe(l.types.boolean),filterBy:l.types.optional(ge,{}),colorBy:l.types.maybe(l.types.model({type:l.types.string,tag:l.types.maybe(l.types.string)})),jexlFilters:l.types.optional(l.types.array(l.types.string),[])})).volatile((()=>({modificationTagMap:X.observable.map({}),modificationsReady:!1}))).actions((e=>({setConfig(t){e.configuration=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)},setColorBy(t){e.colorBy=(0,l.cast)(t)},setJexlFilters(t){e.jexlFilters=(0,l.cast)(t)},updateModificationColorMap(t){t.forEach((t=>{e.modificationTagMap.has(t)||e.modificationTagMap.set(t,P.b4[t]||(0,P.p)())}))}}))).views((e=>{const{renderProps:t}=e;return{get rendererConfig(){var t,n,r;const a=(0,o.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create({...a,drawInterbaseCounts:null!==(t=e.drawInterbaseCounts)&&void 0!==t?t:a.drawInterbaseCounts,drawIndicators:null!==(n=e.drawIndicators)&&void 0!==n?n:a.drawIndicators,drawArcs:null!==(r=e.drawArcs)&&void 0!==r?r:a.drawArcs},(0,l.getEnv)(e))},get drawArcsSetting(){var t;return null!==(t=e.drawArcs)&&void 0!==t?t:(0,o.readConfObject)(this.rendererConfig,"drawArcs")},get drawInterbaseCountsSetting(){var t;return null!==(t=e.drawInterbaseCounts)&&void 0!==t?t:(0,o.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){var t;return null!==(t=e.drawIndicators)&&void 0!==t?t:(0,o.readConfObject)(this.rendererConfig,"drawIndicators")},get autorunReady(){return(0,y.getContainingView)(e).initialized&&e.featureDensityStatsReady&&!e.regionTooLarge&&!e.error},get renderReady(){return!t().notReady&&e.modificationsReady},get ready(){return this.renderReady},renderProps(){const n=t(),{colorBy:r,filterBy:a,modificationTagMap:o}=e;return{...n,notReady:!this.ready,filters:e.filters,modificationTagMap:Object.fromEntries(o.toJSON()),colorBy:r?(0,l.getSnapshot)(r):void 0,filterBy:a?(0,l.getSnapshot)(a):void 0}}}})).actions((e=>({setModificationsReady(t){e.modificationsReady=t},toggleDrawIndicators(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting},toggleDrawArcs(){e.drawArcs=!e.drawArcsSetting}}))).actions((e=>({afterAttach(){(0,P.$X)(e,(async()=>{if(e.setModificationsReady(!1),!e.autorunReady)return;const t=(0,y.getContainingView)(e),{staticBlocks:n}=t,{colorBy:r}=e;if("modifications"===(null===r||void 0===r?void 0:r.type)){const t=(0,o.getConf)(e.parentTrack,"adapter"),a=await he(e,t,r,n);(0,l.isAlive)(e)&&(e.updateModificationColorMap(a),e.setModificationsReady(!0))}else e.setModificationsReady(!0)}),{delay:1e3})}}))).views((e=>{const{trackMenuItems:t}=e;return{get TooltipComponent(){return ue},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:(0,o.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return fe.get("snpcoverage")},get needsScalebar(){return!0},contextMenuItems:()=>[],trackMenuItems:()=>[...t(),{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:()=>e.toggleDrawIndicators()},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:()=>e.toggleDrawInterbaseCounts()},{label:"Draw arcs",type:"checkbox",checked:e.drawArcsSetting,onClick:()=>e.toggleDrawArcs()}],get filters(){return new ie.Z({filters:e.jexlFilters})}}}))};function ye(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:l.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:l.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:e.getRendererType("SNPCoverageRenderer").configSchema})},{baseConfiguration:J.fU,explicitlyTyped:!0})}(e);return new U.Z({name:"LinearSNPCoverageDisplay",displayName:"SNPCoverage display",configSchema:t,stateModel:me(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:b.Xl})}))}const be=(0,te.ZL)()((e=>({loading:{backgroundColor:e.palette.background.default,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, ".concat(e.palette.action.disabledBackground," 5px, ").concat(e.palette.action.disabledBackground," 10px)"),position:"absolute",bottom:0,height:50,width:300,right:0,pointerEvents:"none",textAlign:"center"}}))),ve=(0,H.observer)((function(e){let{model:t,children:n}=e;const{error:r,regionTooLarge:a}=t;return r?(0,G.jsx)(J.rK,{message:"".concat(r),severity:"error",buttonText:"Reload",action:t.reload}):a?t.regionCannotBeRendered():(0,G.jsx)(we,{model:t,children:n})})),we=(0,H.observer)((function(e){let{model:t,children:n}=e;const{drawn:r,loading:a}=t,o=(0,y.getContainingView)(t),i=(t.lastDrawnOffsetPx||0)-o.offsetPx;return(0,G.jsxs)("div",{"data-testid":"drawn-".concat(r),children:[(0,G.jsx)("div",{style:{position:"absolute",left:i},children:n}),0!==i||a?(0,G.jsx)(xe,{model:t}):null]})})),xe=(0,H.observer)((function(e){let{model:t}=e;const{classes:n}=be(),{message:r}=t;return(0,G.jsx)("div",{className:n.loading,children:(0,G.jsx)(m.LoadingEllipses,{message:r})})})),Ce=ve,Se=(0,H.observer)((function(e){let{model:t}=e;const n=(0,y.getContainingView)(t),r=Math.round(n.dynamicBlocks.totalWidthPx),a=t.height,o=(0,W.useCallback)((e=>{t.setRef(e)}),[t,r,a]);return(0,G.jsx)("canvas",{"data-testid":"arc-canvas",ref:o,style:{width:r,height:a,position:"absolute"},width:2*r,height:2*a})})),ke=(0,H.observer)((function(e){let{model:t}=e;return(0,G.jsx)(Ce,{model:t,children:(0,G.jsx)(Se,{model:t})})})),Te=ke;const Pe=function(e){return(0,o.ConfigurationSchema)("LinearReadArcsDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},lineWidth:{type:"number",description:"set arc line width",defaultValue:1},jitter:{type:"number",description:"jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them",defaultValue:0},colorScheme:{type:"stringEnum",model:l.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,J.RH)(e),explicitlyTyped:!0})};var Me=n(20592),Re=n(99740),Ae=n(21613);const Ie=(0,W.lazy)((()=>n.e(1475).then(n.bind(n,81475))));const Ne=function(e){return l.types.compose("LinearReadArcsDisplay",Me.BaseDisplay,(0,J.eW)(),(0,J.Ek)(),l.types.model({type:l.types.literal("LinearReadArcsDisplay"),configuration:(0,o.ConfigurationReference)(e),filterBy:l.types.optional(ge,{}),lineWidth:l.types.maybe(l.types.number),jitter:l.types.maybe(l.types.number),colorBy:l.types.maybe(l.types.model({type:l.types.string,tag:l.types.maybe(l.types.string),extra:l.types.frozen()})),drawInter:!0,drawLongRange:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).actions((e=>({setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBy=(0,l.cast)(t)},setChainData(t){e.chainData=t},setDrawInter(t){e.drawInter=t},setDrawLongRange(t){e.drawLongRange=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)},setLineWidth(t){e.lineWidth=t},setJitter(t){e.jitter=t}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx},get lineWidthSetting(){var t;return null!==(t=e.lineWidth)&&void 0!==t?t:(0,o.getConf)(e,"lineWidth")},get jitterVal(){var t;return null!==(t=e.jitter)&&void 0!==t?t:(0,o.getConf)(e,"jitter")}}))).views((e=>{const{trackMenuItems:t,renderProps:n}=e;return{renderProps:()=>({...n(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Filter by",icon:Ae.Z,onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[Ie,{model:e,handleClose:t}]))}},{label:"Line width",subMenu:[{label:"Thin",onClick:()=>e.setLineWidth(1)},{label:"Bold",onClick:()=>e.setLineWidth(2)},{label:"Extra bold",onClick:()=>e.setLineWidth(5)}]},{label:"Jitter x-positions",subMenu:[{type:"checkbox",checked:0===e.jitterVal,label:"None",onClick:()=>e.setJitter(0)},{type:"checkbox",checked:2===e.jitterVal,label:"Small",onClick:()=>e.setJitter(2)},{type:"checkbox",checked:10===e.jitterVal,label:"Large",onClick:()=>e.setJitter(10)}]},{label:"Draw inter-region vertical lines",type:"checkbox",checked:e.drawInter,onClick:()=>e.setDrawInter(!e.drawInter)},{label:"Draw long range connections",type:"checkbox",checked:e.drawLongRange,onClick:()=>e.setDrawLongRange(!e.drawLongRange)},{label:"Color scheme",icon:Re.Z,subMenu:[{label:"Insert size \xb1 3\u03c3 and orientation",onClick:()=>e.setColorScheme({type:"insertSizeAndOrientation"})},{label:"Insert size \xb1 3\u03c3",onClick:()=>e.setColorScheme({type:"insertSize"})},{label:"Orientation",onClick:()=>e.setColorScheme({type:"orientation"})},{label:"Insert size gradient",onClick:()=>e.setColorScheme({type:"gradient"})}]}]}})).views((e=>({async renderSvg(t){const{renderSvg:r}=await n.e(3880).then(n.bind(n,83880)),{drawFeats:a}=await n.e(6390).then(n.bind(n,26390));return r(e,t,a)}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(9070).then(n.bind(n,39070)),{drawFeats:r}=await n.e(6390).then(n.bind(n,26390));t(e,r)}catch(t){console.error(t),e.setError(t)}})()}})))};function Le(e){e.addDisplayType((()=>{const t=Pe(e);return new U.Z({name:"LinearReadArcsDisplay",displayName:"Arc display",configSchema:t,stateModel:Ne(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:Te})}))}const Fe=(0,H.observer)((function(e){let{model:t}=e;const n=(0,y.getContainingView)(t),r=Math.round(n.dynamicBlocks.totalWidthPx),a=t.height,o=(0,W.useCallback)((e=>t.setRef(e)),[t,r,a]);return(0,G.jsx)("canvas",{"data-testid":"cloud-canvas",ref:o,style:{width:r,height:a,position:"absolute"},width:2*r,height:2*a})})),je=(0,H.observer)((function(e){let{model:t}=e;return(0,G.jsx)(Ce,{model:t,children:(0,G.jsx)(Fe,{model:t})})})),De=je;const Be=function(e){return(0,o.ConfigurationSchema)("LinearReadCloudDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},featureHeight:{type:"number",defaultValue:7},colorScheme:{type:"stringEnum",model:l.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,J.RH)(e),explicitlyTyped:!0})},Ee=(0,W.lazy)((()=>n.e(1475).then(n.bind(n,81475))));const Ve=function(e){return l.types.compose("LinearReadCloudDisplay",Me.BaseDisplay,(0,J.eW)(),(0,J.Ek)(),l.types.model({type:l.types.literal("LinearReadCloudDisplay"),configuration:(0,o.ConfigurationReference)(e),filterBy:l.types.optional(ge,{}),colorBy:l.types.maybe(l.types.model({type:l.types.string,tag:l.types.maybe(l.types.string),extra:l.types.frozen()})),drawSingletons:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).actions((e=>({setDrawSingletons(t){e.drawSingletons=t},setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBy=(0,l.cast)(t)},setChainData(t){e.chainData=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Draw singletons",type:"checkbox",checked:e.drawSingletons,onClick:()=>e.setDrawSingletons(!e.drawSingletons)},{label:"Filter by",icon:Ae.Z,onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[Ee,{model:e,handleClose:t}]))}},{label:"Color scheme",icon:Re.Z,subMenu:[{label:"Insert size \xb1 3\u03c3 and orientation",onClick:()=>e.setColorScheme({type:"insertSizeAndOrientation"})},{label:"Insert size \xb1 3\u03c3",onClick:()=>e.setColorScheme({type:"insertSize"})},{label:"Orientation",onClick:()=>e.setColorScheme({type:"orientation"})},{label:"Insert size gradient",onClick:()=>e.setColorScheme({type:"gradient"})}]}],async renderSvg(t){const{renderSvg:r}=await n.e(3880).then(n.bind(n,83880)),{drawFeats:a}=await n.e(6530).then(n.bind(n,36530));return r(e,t,a)}}})).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(9070).then(n.bind(n,39070)),{drawFeats:r}=await n.e(6530).then(n.bind(n,36530));t(e,r)}catch(t){console.error(t),e.setError(t)}})()}})))};function ze(e){e.addDisplayType((()=>{const t=Be(e);return new U.Z({name:"LinearReadCloudDisplay",displayName:"Read cloud display",configSchema:t,stateModel:Ve(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:De})}))}var Oe=n(5889);function Ze(e){e.addTrackType((()=>{const t=(n=e,(0,o.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:(0,Me.createBaseTrackConfig)(n)}));var n;const r=new Oe.Z({name:"AlignmentsTrack",displayName:"Alignments track",configSchema:t,stateModel:(0,Y.createBaseTrackModel)(e,"AlignmentsTrack",t)}),a=e.getDisplayType("LinearAlignmentsDisplay");return r.addDisplayType(a),r}))}var We=n(25077),He=n(63211);const Ge=(0,o.ConfigurationSchema)("AlignmentsFeatureWidget",{});function qe(e){const t=(0,He.e$)(e);return l.types.compose(t,l.types.model("AlignmentsFeatureWidget",{type:l.types.literal("AlignmentsFeatureWidget")}))}function _e(e){e.addWidgetType((()=>new We.Z({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:Ge,stateModel:qe(e),ReactComponent:(0,W.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(2304)]).then(n.bind(n,75439))))})))}var Ue=n(26138),Je=n(24201);var Xe=n(83015);class Ye extends Xe.Z{async serializeArguments(e,t){var n;const{rootModel:r}=this.pluginManager,a=null===r||void 0===r||null===(n=r.session)||void 0===n?void 0:n.assemblyManager;if(!a)throw new Error("no assembly manager available");const o=await(0,y.renameRegionsIfNeeded)(a,e);return super.serializeArguments(o,t)}}class Qe extends Ye{constructor(){super(...arguments),this.name="PileupGetReducedFeatures"}async execute(e,t){const n=await this.deserializeArguments(e,t),{adapterConfig:r,sessionId:a,regions:o}=n,i=(await(0,C.uP)(this.pluginManager,a,r)).dataAdapter,s=await(0,Je.z)(i.getFeaturesInMultipleRegions(o,n).pipe((0,Ue.q)())),l=(0,y.dedupe)(s.map((e=>({id:e.id(),refName:e.get("refName"),name:e.get("name"),start:e.get("start"),strand:e.get("strand"),end:e.get("end"),flags:e.get("flags"),tlen:e.get("template_length"),pair_orientation:e.get("pair_orientation"),next_ref:e.get("next_ref"),next_pos:e.get("next_pos"),clipPos:e.get("clipPos"),SA:(0,P.h1)(e,"SA")}))),(e=>e.id)),c=l.filter((e=>2&e.flags&&!(256&e.flags)&&!(2048&e.flags)));const d=c.length?function(e){const t=e.map((e=>Math.abs(e.tlen))),n=t.reduce(((e,t)=>e+t),0),r=t.map((e=>e*e)).reduce(((e,t)=>e+t),0),a=t.length,o=n/a,i=Math.sqrt((a*r-n*n)/(a*a));return{upper:o+4*i,lower:o-3*i,avg:o,sd:i}}(c):void 0,u=(0,y.groupBy)(l,(e=>e.name));return{chains:Object.values(u),stats:d,hasPaired:!!d,containsNoTransferables:!0}}}class Ke extends Ye{constructor(){super(...arguments),this.name="PileupGetVisibleModifications"}async execute(e,t){const{adapterConfig:n,sessionId:r,regions:a}=await this.deserializeArguments(e,t),o=(await(0,C.uP)(this.pluginManager,r,n)).dataAdapter,i=await(0,Je.z)(o.getFeaturesInMultipleRegions(a).pipe((0,Ue.q)())),s=new Set;return i.forEach((e=>{(0,j.getModificationTypes)((0,P.TN)(e,"MM","Mm")||"").forEach((e=>s.add(e)))})),[...s]}}class $e extends Ye{constructor(){super(...arguments),this.name="PileupGetGlobalValueForTag"}async execute(e,t){const{adapterConfig:n,sessionId:r,regions:a,tag:o}=await this.deserializeArguments(e,t),i=(await(0,C.uP)(this.pluginManager,r,n)).dataAdapter.getFeaturesInMultipleRegions(a),s=await(0,Je.z)(i.pipe((0,Ue.q)()));return[...new Set(s.map((e=>(0,P.h1)(e,o))).filter((e=>void 0!==e)).map((e=>"".concat(e))))]}}const et=e=>{e.addRpcMethod((()=>new $e(e))),e.addRpcMethod((()=>new Ke(e))),e.addRpcMethod((()=>new Qe(e)))},tt=e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="CramAdapter",o=(0,pe.getFileName)(t),i={type:a,cramLocation:t,craiLocation:n||(0,pe.makeIndex)(t,".crai")};return/\.cram$/i.test(o)&&!r||r===a?i:e(t,n,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="BamAdapter",o=(0,pe.getFileName)(t),i=n&&(0,pe.getFileName)(n),s={type:a,bamLocation:t,index:{location:n||(0,pe.makeIndex)(t,".bai"),indexType:(0,pe.makeIndexType)(i,"CSI","BAI")}};return/\.bam$/i.test(o)&&!r||r===a?s:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t)))};const nt=function(e){return(0,o.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:l.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:e.getRendererType("PileupRenderer").configSchema}),maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorScheme:{type:"stringEnum",model:l.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,J.RH)(e),explicitlyTyped:!0})};var rt=n(12966),at=n(8533),ot=n(62877),it=n.n(ot),st=n(24728),lt=n(97470),ct=n(51590);const dt=(0,H.observer)((function(e){var t;let{model:n}=e;const{sortedBy:r}=n;return r?(0,G.jsx)("div",{"data-testid":"blurb-".concat(r),children:(0,G.jsx)(ct.Z,{color:"secondary",variant:"caption",children:r?"Sorted by ".concat(null!==(t=r.tag)&&void 0!==t?t:r.type," at ").concat(r.refName,":").concat(r.pos):null})}):null})),ut=dt,pt=(0,W.lazy)((()=>n.e(1475).then(n.bind(n,81475)))),ht=(0,W.lazy)((()=>n.e(6762).then(n.bind(n,63716)))),gt=(0,W.lazy)((()=>n.e(4655).then(n.bind(n,14655)))),ft=(0,W.lazy)((()=>n.e(5044).then(n.bind(n,5044)))),mt=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]);function yt(e){return l.types.compose(J.fV,l.types.model({configuration:(0,o.ConfigurationReference)(e),featureHeight:l.types.maybe(l.types.number),noSpacing:l.types.maybe(l.types.boolean),fadeLikelihood:l.types.maybe(l.types.boolean),trackMaxHeight:l.types.maybe(l.types.number),colorBy:N.zi,filterBy:l.types.optional(ge,{}),jexlFilters:l.types.optional(l.types.array(l.types.string),[])})).volatile((()=>({colorTagMap:X.observable.map({}),featureUnderMouseVolatile:void 0,tagsReady:!1}))).views((e=>({get autorunReady(){return(0,y.getContainingView)(e).initialized&&e.featureDensityStatsReady&&!e.regionTooLarge}}))).actions((e=>({setTagsReady(t){e.tagsReady=t},setMaxHeight(t){e.trackMaxHeight=t},setFeatureHeight(t){e.featureHeight=t},setNoSpacing(t){e.noSpacing=t},setColorScheme(t){e.colorTagMap=X.observable.map({}),e.colorBy=(0,l.cast)(t),t.tag&&(e.tagsReady=!1)},updateColorTagMap(t){const n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((t=>{if(!e.colorTagMap.has(t)){const r=[...e.colorTagMap.keys()].length;e.colorTagMap.set(t,n[r])}}))},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},selectFeature(t){const n=(0,y.getSession)(e);if((0,y.isSessionModelWithWidgets)(n)){const r=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,y.getContainingView)(e)});n.showWidget(r)}n.setSelection(t)},copyFeatureToClipboard(t){const{uniqueId:n,...r}=t.toJSON(),a=(0,y.getSession)(e);it()(JSON.stringify(r,null,4)),a.notify("Copied to clipboard","success")},setConfig(t){e.configuration=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)},setJexlFilters(t){e.jexlFilters=(0,l.cast)(t)}}))).views((e=>({get rendererConfig(){const{featureHeight:t,noSpacing:n,trackMaxHeight:r,rendererTypeName:a}=e,i=(0,o.getConf)(e,["renderers",a])||{};return e.rendererType.configSchema.create({...i,...void 0!==t?{height:t}:{},...void 0!==n?{noSpacing:n}:{},...void 0!==r?{maxHeight:r}:{}},(0,y.getEnv)(e))}}))).views((e=>({get maxHeight(){return(0,o.readConfObject)(e.rendererConfig,"maxHeight")},get featureHeightSetting(){return(0,o.readConfObject)(e.rendererConfig,"height")},get featureUnderMouse(){return e.featureUnderMouseVolatile},renderReady:()=>e.tagsReady,get filters(){return new ie.Z({filters:e.jexlFilters})}}))).views((e=>{const{trackMenuItems:t,renderProps:n}=e;return{get rendererTypeName(){const t=(0,o.getConf)(e,"defaultRendering"),n=mt.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},contextMenuItems(){const t=e.contextMenuFeature;return t?[{label:"Open feature details",icon:lt.Z,onClick:()=>{e.clearFeatureSelection(),t&&e.selectFeature(t)}},{label:"Copy info to clipboard",icon:st.pt,onClick:()=>{t&&e.copyFeatureToClipboard(t)}}]:[]},get DisplayBlurb(){return ut},renderPropsPre(){const{colorTagMap:t,colorBy:r,filterBy:a,rpcDriverName:o}=e,i=n();return{...i,notReady:i.notReady||!e.renderReady(),rpcDriverName:o,displayModel:e,colorBy:r?(0,l.getSnapshot)(r):void 0,filterBy:JSON.parse(JSON.stringify(a)),filters:e.filters,colorTagMap:Object.fromEntries(t.toJSON()),config:e.rendererConfig,async onFeatureClick(t,n){const r=(0,y.getSession)(e),{rpcManager:a}=r;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,pe.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,layoutId:(0,y.getContainingView)(e).id,rendererType:"PileupRenderer"});r&&e.selectFeature(new y.SimpleFeature(r))}else e.clearFeatureSelection()}catch(o){console.error(o),r.notify("".concat(o))}},onClick(){e.clearFeatureSelection()},async onFeatureContextMenu(t,n){const r=(0,y.getSession)(e),{rpcManager:a}=r;try{const t=n||e.featureIdUnderMouse;if(t){const n=(0,pe.getRpcSessionId)(e),{feature:r}=await a.call(n,"CoreGetFeatureDetails",{featureId:t,sessionId:n,layoutId:(0,y.getContainingView)(e).id,rendererType:"PileupRenderer"});r&&e.setContextMenuFeature(new y.SimpleFeature(r))}else e.clearFeatureSelection()}catch(o){console.error(o),r.notify("".concat(o))}}}},colorSchemeSubMenuItems:()=>[{label:"Normal",onClick:()=>e.setColorScheme({type:"normal"})},{label:"Mapping quality",onClick:()=>e.setColorScheme({type:"mappingQuality"})},{label:"Strand",onClick:()=>e.setColorScheme({type:"strand"})},{label:"Per-base quality",onClick:()=>e.setColorScheme({type:"perBaseQuality"})},{label:"Per-base lettering",onClick:()=>e.setColorScheme({type:"perBaseLettering"})},{label:"First-of-pair strand",onClick:()=>e.setColorScheme({type:"stranded"})},{label:"Color by tag...",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[ht,{model:e,handleClose:t}]))}}],trackMenuItems:()=>[...t(),{label:"Filter by",icon:Ae.Z,onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[pt,{model:e,handleClose:t}]))}},{label:"Set feature height",subMenu:[{label:"Normal",onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",onClick:()=>{e.setFeatureHeight(2),e.setNoSpacing(!0)}},{label:"Manually set height",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[gt,{model:e,handleClose:t}]))}}]},{label:"Set max height...",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[ft,{model:e,handleClose:t}]))}}]}})).views((e=>({renderProps:()=>e.renderPropsPre()}))).actions((e=>({afterAttach(){(0,P.$X)(e,(async()=>{const t=(0,y.getContainingView)(e);if(!e.autorunReady)return;const{colorBy:n,tagsReady:r}=e,{staticBlocks:a}=t;if(null!==n&&void 0!==n&&n.tag&&!r){const t=await async function(e,t,n,r){const{rpcManager:a}=(0,y.getSession)(e),{adapterConfig:o}=e,i=(0,pe.getRpcSessionId)(e);return await a.call((0,pe.getRpcSessionId)(e),"PileupGetGlobalValueForTag",{adapterConfig:o,tag:t.tag,sessionId:i,regions:n.contentBlocks,...r})}(e,n,a);e.updateColorTagMap(t)}e.setTagsReady(!0)}),{delay:1e3}),(0,l.addDisposer)(e,(0,X.autorun)((async()=>{const t=(0,y.getSession)(e);try{var n;const r=e.featureIdUnderMouse;if((null===(n=e.featureUnderMouse)||void 0===n?void 0:n.id())!==r)if(r){const n=(0,pe.getRpcSessionId)(e),a=(0,y.getContainingView)(e),{feature:o}=await t.rpcManager.call(n,"CoreGetFeatureDetails",{featureId:r,sessionId:n,layoutId:a.id,rendererType:"PileupRenderer"});e.featureIdUnderMouse===(null===o||void 0===o?void 0:o.uniqueId)&&e.setFeatureUnderMouse(new y.SimpleFeature(o))}else e.setFeatureUnderMouse(void 0)}catch(r){console.error(r),t.notify("".concat(r),"error")}})))}})))}const bt=(0,W.lazy)((()=>n.e(7025).then(n.bind(n,17025)))),vt=(0,W.lazy)((()=>n.e(6151).then(n.bind(n,96151))));const wt=function(e){return l.types.compose("LinearPileupDisplay",yt(e),l.types.model({type:l.types.literal("LinearPileupDisplay"),configuration:(0,o.ConfigurationReference)(e),showSoftClipping:!1,mismatchAlpha:l.types.maybe(l.types.boolean),sortedBy:l.types.maybe(l.types.model({type:l.types.string,pos:l.types.number,tag:l.types.maybe(l.types.string),refName:l.types.string,assemblyName:l.types.string}))})).volatile((()=>({sortReady:!1,currSortBpPerPx:0,modificationTagMap:X.observable.map({}),modificationsReady:!1}))).actions((e=>({setCurrSortBpPerPx(t){e.currSortBpPerPx=t},updateModificationColorMap(t){t.forEach((t=>{e.modificationTagMap.has(t)||e.modificationTagMap.set(t,P.b4[t]||(0,P.p)())}))},setModificationsReady(t){e.modificationsReady=t},setSortReady(t){e.sortReady=t},clearSelected(){e.sortedBy=void 0},toggleSoftClipping(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha(){e.mismatchAlpha=!e.mismatchAlpha},setSortedBy(t,n){const{centerLineInfo:r}=(0,y.getContainingView)(e);if(!r)return;const{refName:a,assemblyName:o,offset:i}=r,s=Math.round(i)+1;s<0||!a||(e.sortReady=!1,e.sortedBy={type:t,pos:s,refName:a,assemblyName:o,tag:n})}}))).actions((e=>{const t=e.reload;return{reload(){e.clearSelected(),t()}}})).views((e=>({get rendererConfig(){const{featureHeight:t,noSpacing:n,trackMaxHeight:r,mismatchAlpha:a,rendererTypeName:i}=e,s=(0,o.getConf)(e,["renderers",i])||{};return e.rendererType.configSchema.create({...s,...void 0!==t?{height:t}:{},...void 0!==n?{noSpacing:n}:{},...void 0!==a?{mismatchAlpha:a}:{},...void 0!==r?{maxHeight:r}:{}},(0,y.getEnv)(e))}}))).views((e=>{const{renderReady:t}=e;return{get mismatchAlphaSetting(){return(0,o.readConfObject)(e.rendererConfig,"mismatchAlpha")},renderReady(){const n=(0,y.getContainingView)(e);return e.modificationsReady&&e.currSortBpPerPx===n.bpPerPx&&t()}}})).views((e=>{const{trackMenuItems:t,renderPropsPre:n,renderProps:r,colorSchemeSubMenuItems:a}=e;return{renderPropsPre(){const{sortedBy:t,showSoftClipping:r,modificationTagMap:a}=e;return{...n(),showSoftClip:r,sortedBy:t,modificationTagMap:Object.fromEntries(a.toJSON())}},renderProps(){const{sortReady:t}=e,n=r();return{...n,notReady:n.notReady||!t}},trackMenuItems:()=>[...t(),{label:"Show soft clipping",icon:rt.Z,type:"checkbox",checked:e.showSoftClipping,onClick:()=>{e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Sort by",icon:at.Z,disabled:e.showSoftClipping,subMenu:[...["Start location","Read strand","Base pair"].map((t=>({label:t,onClick:()=>e.setSortedBy(t)}))),{label:"Sort by tag...",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[bt,{model:e,handleClose:t}]))}},{label:"Clear sort",onClick:()=>e.clearSelected()}]},{label:"Color scheme",subMenu:[{label:"Pair orientation",onClick:()=>e.setColorScheme({type:"pairOrientation"})},{label:"Modifications or methylation",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[vt,{model:e,handleClose:t}]))}},{label:"Insert size",onClick:()=>e.setColorScheme({type:"insertSize"})},...a()]},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:()=>e.toggleMismatchAlpha()}]}})).actions((e=>({afterAttach(){(0,P.$X)(e,(async()=>{const t=(0,y.getContainingView)(e);if(!e.autorunReady)return;const{bpPerPx:n}=t;e.setCurrSortBpPerPx(n)}),{delay:1e3}),(0,P.$X)(e,(async()=>{const{rpcManager:t}=(0,y.getSession)(e),n=(0,y.getContainingView)(e);if(!e.autorunReady)return;const{sortedBy:r,adapterConfig:a,rendererType:o,sortReady:i}=e,{bpPerPx:s}=n;if(r&&(!i||e.currSortBpPerPx===n.bpPerPx)){const{pos:i,refName:s,assemblyName:l}=r;await e.rendererType.renderInClient(t,{assemblyName:l,regions:[{start:i,end:i+1,refName:s,assemblyName:l}],adapterConfig:a,rendererType:o.name,sessionId:(0,pe.getRpcSessionId)(e),layoutId:n.id,timeout:1e6,...e.renderPropsPre()})}e.setCurrSortBpPerPx(s),e.setSortReady(!0)}),{delay:1e3}),(0,P.$X)(e,(async()=>{if(!e.autorunReady)return;const{parentTrack:t,colorBy:n}=e,{staticBlocks:r}=(0,y.getContainingView)(e);if("modifications"===(null===n||void 0===n?void 0:n.type)){const a=(0,o.getConf)(t,["adapter"]),i=await he(e,a,n,r);e.updateModificationColorMap(i)}e.setModificationsReady(!0)}))}})))};function xt(e){e.addDisplayType((()=>{const t=nt(e);return new U.Z({name:"LinearPileupDisplay",displayName:"Pileup display",configSchema:t,stateModel:wt(t),subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:J.qb})}))}class Ct extends r.Z{constructor(){super(...arguments),this.name="AlignmentsPlugin"}install(e){[d,s,xt,ye,Ze,g,p,_,et,w,Le,ze,oe,_e,tt].map((t=>t(e)))}}},69349:(e,t,n)=>{"use strict";n.d(t,{If:()=>o,Wh:()=>s,k5:()=>l,uE:()=>c,ue:()=>i,zi:()=>d});var r=n(31625),a=n(39395);const o={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unknown:"grey"},i={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00005A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unknown:"grey"};function s(e,t,n){const r=e.refName===t.refName,a=Math.abs(e.tlen||0);return r&&a>((null===n||void 0===n?void 0:n.upper)||0)?[o.color_longinsert,i.color_longinsert]:r&&a<((null===n||void 0===n?void 0:n.lower)||0)?[o.color_shortinsert,i.color_shortinsert]:r?void 0:[o.color_interchrom,i.color_interchrom]}function l(e,t,n){return s(e,t,n)||c(e)}function c(e){const t=a.uD.fr,n=a.oL[t[e.pair_orientation||""]];return[o[n]||o.color_unknown,i[n]||i.color_unknown]}const d=r.types.maybe(r.types.model({type:r.types.string,tag:r.types.maybe(r.types.string),extra:r.types.frozen()}))},39395:(e,t,n)=>{"use strict";n.d(t,{$X:()=>g,ES:()=>p,O:()=>u,TN:()=>l,b4:()=>h,h1:()=>s,oL:()=>d,p:()=>f,uD:()=>c});var r=n(26138),a=n(24201),o=n(31625),i=n(85815);function s(e,t){const n=e.get("tags");return void 0!==n?n[t]:e.get(t)}function l(e,t,n){var r;return null!==(r=s(e,t))&&void 0!==r?r:s(e,n)}const c={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}},d={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"};async function u(e,t){var n;const{start:o,end:i,originalRefName:s,refName:l}=e;return null===(n=(await(0,a.z)(t.getFeatures({...e,refName:s||l,end:i+1,start:Math.max(0,o-1)}).pipe((0,r.q)())))[0])||void 0===n?void 0:n.get("seq")}function p(e){return"methylation"===e}const h={m:"rgb(255,0,0)",h:"rgb(11, 132, 165)",o:"rgb(111, 78, 129)",f:"rgb(246, 200, 95)",c:"rgb(157, 216, 102)",g:"rgb(255, 160, 86)",e:"rgb(141, 221, 208)",b:"rgb(202, 71, 47)"};function g(e,t,n){(0,o.addDisposer)(e,(0,i.autorun)((async()=>{try{await t()}catch(n){(0,o.isAlive)(e)&&e.setError(n)}}),n))}function f(){return"hsl(".concat(200*Math.random(),", 50%, 50%)")}},71416:(e,t,n)=>{"use strict";n.d(t,{Go:()=>c,cO:()=>l,mu:()=>s,wf:()=>d});var r=n(41867),a=n(90872);const[,o,,i]=[0,1,2,3];function s(e,t,n){var r;return((null===(r=e.bpToPx({refName:t,coord:n}))||void 0===r?void 0:r.offsetPx)||0)-e.offsetPx}function l(e,t,n,r,s,l){const c=r[t].displays[0],d=c.height;let u=0;const{SNPCoverageDisplay:p}=c;p&&(u=p.height);const h=l?0:c.scrollTop;return(0,a.clamp)(s[o]-h+((g=s)[i]-g[o])/2+u,0,d)+function(e,t,n,r){var a;return r?r(t,n):(null===(a=e[n].trackRefs[t])||void 0===a?void 0:a.getBoundingClientRect().top)||0}(n,e,t,l)+c.scrollTop;var g}const c=e=>{const[,t]=(0,r.useState)();(0,r.useEffect)((()=>{t(e)}),[e])};function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=new Set((arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).map((t=>e(t)))),r=t.filter((t=>n.has(e(t))));for(var a=arguments.length,o=new Array(a>3?a-3:0),i=3;i<a;i++)o[i-3]=arguments[i];return 0===o.length?r:d(e,r,...o)}},88309:(e,t,n)=>{"use strict";n.d(t,{lJ:()=>N,pL:()=>z,_U:()=>V,ZP:()=>O});var r=n(90872),a=n(27032),o=n(41867),i=n(59366),s=n(31625),l=n(1502),c=n(85815),d=n(40753),u=n(43800),p=n(88057),h=n(24728),g=n(39841),f=n(10034);function m(e,t,n,r,a){const o=Math.abs(e-n);if(o>r)return;o===r&&a.push([t,e]);const i=Math.sqrt(r*r-o*o);a.push([t-i,e],[t+i,e])}function y(e,t,n,r,a){const o=Math.abs(e-t);if(o>r)return;o===r&&a.push([e,n]);const i=Math.sqrt(r*r-o*o);a.push([e,n-i],[e,n+i])}function b(e,t){const n=Math.sqrt(e*e+t*t);if(0===n)return[0,0];const r=function(e,t){let n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t);return[n,r]}const v=2*Math.PI;class w{constructor(e,t,n,a){this.region=t,this.offsetRadians=n,this.radianWidth=a,this.key=void 0,this.startRadians=void 0,this.endRadians=void 0,this.bpPerRadian=void 0,this.flipped=void 0;const{bpPerRadian:o}=e;this.key="regions"in t?JSON.stringify(t.regions):(0,r.assembleLocString)(t),this.bpPerRadian=o,this.flipped=!1,this.startRadians=n,this.endRadians=t.widthBp/this.bpPerRadian+n,Object.freeze(this)}bpToXY(e,t){let n;n=this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start;const a=n/this.bpPerRadian+this.offsetRadians;return(0,r.polarToCartesian)(t,a)}toJSON(){return Object.fromEntries(Object.entries(this))}}function x(e,t){const{theta:[n,r]}=e.visibleSection;return a=t.offsetRadians+e.offsetRadians,o=t.radianWidth,i=n,s=r-n,!(o<=0||s<=0)&&(o+1e-4>=v||s+1e-4>=v||(a=(a%v+v)%v+v)<(i=(i%v+v)%v+v)+s&&a+o>i||a<(i-=v)+s&&a+o>i||a<(i+=v+v)+s&&a+o>i);var a,o,i,s}const C=(0,o.lazy)((()=>n.e(3990).then(n.bind(n,23990))));const S=function(e){return s.types.compose("CircularView",p.BaseViewModel,s.types.model({type:s.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:200,tracks:s.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:s.types.optional(s.types.refinement("trackHeight",s.types.number,(e=>e>=40)),400),displayedRegions:s.types.array(l.Region),scrollX:0,scrollY:0,minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,trackSelectorType:"hierarchical"})).volatile((()=>({volatileWidth:void 0,error:void 0}))).views((e=>({get width(){if(void 0===e.volatileWidth)throw new Error("wait for view to be initialized first before accessing width");return e.volatileWidth},get visibleSection(){const{scrollX:t,scrollY:n,width:r,height:a}=e;return function(e,t,n){let[r,a,o,i]=e;const[s,l]=t;if(r-=s,a-=s,o-=l,i-=l,r<0&&a>0&&o<0&&i>0){const e=[[r,o],[a,o],[r,i],[a,i]];let t=-1/0;for(const[n,r]of e){const e=Math.sqrt(n*n+r*r);e>t&&(t=e)}return{rho:[0,Math.min(n,t)],theta:[0,2*Math.PI]}}const c=[[r,o],[a,o],[r,i],[a,i]];y(r,0,0,n,c),y(a,0,0,n,c),m(o,0,0,n,c),m(i,0,0,n,c),-r<n&&c.push([r,0]),a<n&&c.push([a,0]),-o<n&&c.push([0,o]),i<n&&c.push([0,i]);const d=r>=0?-1:1;let u=1/0,p=-1/0,h=1/0,g=-1/0;for(const[f,m]of c)if(f>=r&&f<=a&&m>=o&&m<=i){const[e,t]=b(f*d,m*d);e<=n+.001&&(t<h&&e>1e-4&&(h=t),t>g&&e>1e-4&&(g=t),e<u&&(u=e),e>p&&(p=e))}return-1===d&&(h+=Math.PI,g+=Math.PI),h>2*Math.PI&&g>2*Math.PI&&(h-=2*Math.PI,g-=2*Math.PI),{rho:[u,Math.min(n,p)],theta:[h,g]}}([t,t+r,n,n+a],this.centerXY,this.radiusPx)},get circumferencePx(){let t=0;for(const e of this.elidedRegions)t+=e.widthBp;return t/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){let t=0;for(const n of e.displayedRegions)t+=n.end-n.start;return t},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){const t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){const e=2*Math.PI*this.maximumRadiusPx;return(0,r.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){const t=[];e.displayedRegions.forEach((n=>{const r=n.end-n.start;if(r/e.bpPerPx<e.minVisibleWidth){const e=t.at(-1);null!==e&&void 0!==e&&e.elided?(e.regions.push({...n}),e.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[{...n}]})}else t.push({...n,widthBp:r,elided:!1})}));for(let e=0;e<t.length;e+=1){const n=t[e];n.elided&&1===n.regions.length&&(t[e]={...n,...n.regions[0],elided:!1})}return t},get assemblyNames(){const t=[];return e.displayedRegions.forEach((e=>{t.includes(e.assemblyName)||t.push(e.assemblyName)})),t},get initialized(){const{assemblyManager:t}=(0,r.getSession)(e);return void 0!==e.volatileWidth&&this.assemblyNames.every((e=>{var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))}}))).views((e=>({get staticSlices(){return function(e){const t=[];let n=0;const{bpPerRadian:r,spacingPx:a,pxPerRadian:o}=e;for(const i of e.elidedRegions){const s=i.widthBp/r+a/o;t.push(new w(e,i,n,s)),n+=s}return t}(e)}}))).views((e=>({get visibleStaticSlices(){return e.staticSlices.filter((t=>x(e,t)))}}))).actions((t=>({setWidth:e=>(t.volatileWidth=Math.max(e,100),t.volatileWidth),setHeight:e=>(t.height=Math.max(e,40),t.height),resizeHeight(e){const n=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},resizeWidth(e){const n=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},rotateClockwiseButton(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians+=e},rotateCounterClockwise(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians-=e},zoomInButton(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx(e){t.bpPerPx=(0,r.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},closeView(){(0,s.getParent)(t,2).removeView(t)},setDisplayedRegions(e){const n=0===t.displayedRegions.length;t.displayedRegions=(0,s.cast)(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector(){if("hierarchical"===t.trackSelectorType){const e=(0,r.getSession)(t);if((0,r.isSessionModelWithWidgets)(e)){const n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},toggleTrack(e){this.hideTrack(e)||this.showTrack(e)},setError(e){t.error=e},showTrack(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=e.pluggableConfigSchemaType("track"),o=(0,s.resolveIdentifier)(a,(0,s.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));const l=e.getViewType(t.type),c=new Set(l.displayTypes.map((e=>e.name))),d=o.displays.find((e=>c.has(e.type))),u=i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:d.type,configuration:d}]});t.tracks.push(u)},addTrackConf(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{type:a}=n,o=(0,u.readConfObject)(n,"name"),i=e.getTrackType(a);if(!i)throw new Error("unknown track type ".concat(a));const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=n.displays.find((e=>l.has(e.type)));t.tracks.push(i.stateModel.create({...r,name:o,type:a,configuration:n,displays:[{type:c.type,configuration:c}]}))},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=(0,s.resolveIdentifier)(r,(0,s.getRoot)(t),n),o=t.tracks.filter((e=>e.configuration===a));return(0,c.transaction)((()=>o.forEach((e=>t.tracks.remove(e))))),o.length},toggleFitToWindowLock(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow},async exportSvg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderToSvg:r}=await n.e(4223).then(n.bind(n,64223)),a=await r(t,e),o=new Blob([a],{type:"image/svg+xml"});(0,d.saveAs)(o,e.filename||"image.svg")}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>e.setDisplayedRegions([]),icon:g.Z},{label:"Export SVG",icon:f.Z,onClick:()=>{(0,r.getSession)(e).queueDialog((t=>[C,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:h.GD}]})))};var k=n(14263),T=n(3762),P=n(47192),M=n(80838);const R=(0,P.ZL)()((e=>{const{primary:t,secondary:n,tertiary:r,quaternary:a}=e.palette;return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash ".concat(1.4,"s ease-in-out infinite, $colors ").concat(5.6,"s ease-in-out infinite")},"@keyframes colors":{"0%":{stroke:t.light},"25%":{stroke:n.light},"50%":{stroke:r.light},"75%":{stroke:a.light},"100%":{stroke:t.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}})),A=(0,T.observer)((function(e){let{model:{renderProps:{radius:t}}}=e;const{classes:n}=R(),[r,a]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const e=setTimeout((()=>a(!0)),400);return()=>clearTimeout(e)})),r?(0,M.jsxs)("g",{children:[(0,M.jsx)("defs",{children:(0,M.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,M.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}})})}),(0,M.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"#f1f1f1"}),(0,M.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),(0,M.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:"Loading\u2026"}),(0,M.jsx)("circle",{className:n.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})]}):null})),I=(0,T.observer)((function(e){let{model:t}=e;const{renderProps:{radius:n},error:r}=t;return(0,M.jsxs)("g",{children:[(0,M.jsx)("defs",{children:(0,M.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,M.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}})})}),(0,M.jsx)("circle",{cx:"0",cy:"0",r:n,fill:"#ffb4b4"}),(0,M.jsx)("circle",{cx:"0",cy:"0",r:n,fill:"url(#diagonalHatch)"}),(0,M.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:String(r)})]})})),N=(0,T.observer)((function(e){let{display:t}=e;return t.error?(0,M.jsx)(I,{model:t}):t.filled?t.reactElement:(0,M.jsx)(A,{model:t})}));var L=n(25217),F=n.n(L),j=n(25216),D=n(99512);function B(e){var t;const n=(0,r.getContainingView)(e),{rendererType:a}=e,{rpcManager:o}=(0,r.getSession)(n);return{rendererType:a,rpcManager:o,renderProps:e.renderProps(),renderArgs:{assemblyName:null===(t=n.displayedRegions[0])||void 0===t?void 0:t.assemblyName,adapterConfig:F()(e.adapterConfig),rendererType:a.name,regions:F()(n.displayedRegions),blockDefinitions:e.blockDefinitions,sessionId:(0,D.getRpcSessionId)(e),timeout:1e6}}}async function E(e,t,n){var r;if(!e)throw new Error("cannot render with no props");const{rendererType:a,rpcManager:o,cannotBeRenderedReason:i,renderArgs:s,renderProps:l,exportSVG:c}=e;if(i)return{message:i};if(!l.radius||null===(r=s.regions)||void 0===r||!r.length)return{message:"Skipping render"};if(!n.isCompatibleWithRenderer(a))throw new Error("renderer ".concat(a.name," is not compatible with this display type"));const{html:d,...u}=await a.renderInClient(o,{...s,...l,exportSVG:c});return{html:d,data:u,reactElement:u.reactElement,renderingComponent:a.ReactComponent}}const V=(0,u.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"});const z=s.types.compose("BaseChordDisplay",p.BaseDisplay,s.types.model({bezierRadiusRatio:.1,assemblyName:s.types.maybe(s.types.string),configuration:(0,u.ConfigurationReference)(V)})).volatile((()=>({filled:!1,reactElement:void 0,data:void 0,html:void 0,message:"",renderingComponent:void 0,refNameMap:void 0}))).actions((e=>{const{pluginManager:t}=(0,r.getEnv)(e),n=e;return{onChordClick(r){(0,u.getConf)(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}})).views((e=>({get blockDefinitions(){const t=(0,r.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;const n=F()(t);return n.forEach((t=>{(t.region.elided?t.region.regions:[t.region]).forEach((t=>{var n;const r=null===(n=e.refNameMap)||void 0===n?void 0:n[t.refName];r&&t.refName!==r&&(t.refName=r)}))})),n},renderProps(){const t=(0,r.getContainingView)(e);return{...(0,D.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick}},get rendererType(){const t=e,{pluginManager:n}=(0,r.getEnv)(e),a=n.getRendererType(e.rendererTypeName);if(!a)throw new Error('renderer "'.concat(t.rendererTypeName,'" not found'));if(!a.ReactComponent)throw new Error("renderer ".concat(t.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return a},isCompatibleWithRenderer:e=>!!(e instanceof j.Z),get selectedFeatureId(){if(!(0,s.isAlive)(e))return;const t=(0,r.getSession)(e);if(!t)return;const{selection:n}=t;return(0,r.isFeature)(n)?n.id():void 0}}))).actions((e=>({renderStarted(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess(t){let{message:n,data:r,reactElement:a,html:o,renderingComponent:i}=t;n?(e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=a,e.data=r,e.html=o,e.error=void 0,e.renderingComponent=i)},renderError(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.html=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap(t){e.refNameMap=t}}))).actions((e=>({afterAttach(){(0,r.makeAbortableReaction)(e,B,E,{name:"".concat(e.type," ").concat(e.id," rendering"),fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,r.makeAbortableReaction)(e,(()=>({assemblyNames:(0,D.getTrackAssemblyNames)(e.parentTrack),adapter:(0,u.getConf)((0,s.getParent)(e,2),"adapter"),assemblyManager:(0,r.getSession)(e).assemblyManager})),(async(t,n)=>{let{assemblyNames:r,adapter:a,assemblyManager:o}=t;return o.getRefNameMapForAdapter(a,r[0],{signal:n,sessionId:(0,D.getRpcSessionId)(e)})}),{name:"".concat(e.type," ").concat(e.id," getting refNames"),fireImmediately:!0},(()=>{}),(t=>e.setRefNameMap(t)),(t=>{console.error(t),e.setError(t)}))}}))).views((e=>({async renderSvg(t){const n=B(e),a=await E({...n,exportSVG:t,theme:t.theme||n.renderProps.theme},0,e);return(0,M.jsx)(r.ReactRendering,{rendering:a})}})));class O extends a.Z{constructor(){super(...arguments),this.name="CircularViewPlugin"}install(e){(e=>{e.addViewType((()=>new i.Z({ReactComponent:(0,o.lazy)((()=>n.e(9790).then(n.bind(n,89790)))),stateModel:S(e),name:"CircularView",displayName:"Circular view"})))})(e),(e=>{e.addToExtensionPoint("LaunchView-CircularView",(async e=>{let{session:t,assembly:n,tracks:r=[]}=e;const{assemblyManager:a}=t,o=t.addView("CircularView",{});if(await(0,c.when)((()=>o.initialized)),!n)throw new Error("No assembly provided when launching circular genome view");const i=await a.waitForAssembly(n);if(!i)throw new Error('Assembly "'.concat(n,'" not found when launching circular genome view'));o.setDisplayedRegions(i.regions||[]),r.forEach((e=>o.showTrack(e)))}))})(e)}configure(e){(0,r.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:k.Z,onClick:e=>{e.addView("CircularView",{})}})}}},24137:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(41867),a=n(74735),o=n(49133),i=n(47192),s=n(3762),l=n(80838);const c='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',d=(0,i.ZL)()((e=>({error:{color:"red",fontSize:"0.8em"},callbackEditor:{fontFamily:c,fontSize:"12px",background:e.palette.background.default,width:800,marginTop:"16px",border:"1px solid rgba(0,0,0,0.42)"},callbackContainer:{width:"100%",overflowX:"auto"},textAreaFont:{fontFamily:c}}))),u=(0,s.observer)((function(e){let{slot:t}=e;const{classes:n}=d(),[i,s]=(0,r.useState)(JSON.stringify(t.value,null,2)),[c,u]=(0,r.useState)();return(0,r.useEffect)((()=>{try{u(void 0),t.set(JSON.parse(i))}catch(e){console.error({e:e}),u(e)}}),[i,t]),(0,l.jsxs)(l.Fragment,{children:[c?(0,l.jsx)("p",{className:n.error,children:"".concat(c)}):null,(0,l.jsxs)("div",{className:n.callbackContainer,children:[(0,l.jsx)(a.Z,{shrink:!0,htmlFor:"json-editor",children:t.name}),(0,l.jsx)(o.Z,{id:"json-editor",className:n.callbackEditor,value:i,helperText:t.description,multiline:!0,onChange:e=>s(e.target.value),style:{background:c?"#fdd":void 0},InputProps:{classes:{input:n.textAreaFont}}})]})]})}))},93533:(e,t,n)=>{"use strict";n.d(t,{wP:()=>w,ZP:()=>x});var r=n(41867),a=n(27032),o=n(20592),i=n(43800);const s=(0,i.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"});const l=(0,i.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"});const c=(0,i.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"});const d=(0,i.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0}},{explicitlyTyped:!0});var u=n(31625),p=n(1502);const h=e=>u.types.model("ConfigurationEditorWidget",{id:p.ElementId,type:u.types.literal("ConfigurationEditorWidget"),target:u.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((e=>({setTarget(t){e.target=t}})));var g=n(3762),f=n(80838);const m=(0,g.observer)((function(e){let{model:t}=e;if(null!==t&&void 0!==t&&t.target){if(t.target.type)return(0,f.jsx)(f.Fragment,{children:"".concat(t.target.type," settings")});if((0,u.isStateTreeNode)(t.target)){const e=(0,u.getType)(t.target);if(null!==e&&void 0!==e&&e.name)return(0,f.jsx)(f.Fragment,{children:"".concat(e.name.replace("ConfigurationSchema","")," settings")})}}return(0,f.jsx)(f.Fragment,{children:"Settings"})})),y=m,b=(0,i.ConfigurationSchema)("ConfigurationEditorWidget",{}),v=(0,r.lazy)((()=>Promise.all([n.e(2280),n.e(7221),n.e(6701)]).then(n.bind(n,86701))));n(24137);const w=(0,r.lazy)((()=>Promise.all([n.e(2280),n.e(7221),n.e(6701)]).then(n.bind(n,86701)))),x=class extends a.Z{constructor(){super(...arguments),this.name="ConfigurationPlugin"}install(e){(e=>{e.addAdapterType((()=>new o.AdapterType({name:"FromConfigAdapter",configSchema:s,getAdapterClass:()=>n.e(7658).then(n.bind(n,97658)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),(e=>{e.addAdapterType((()=>new o.AdapterType({name:"FromConfigRegionsAdapter",configSchema:l,getAdapterClass:()=>n.e(26).then(n.bind(n,20026)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),(e=>{e.addAdapterType((()=>new o.AdapterType({name:"FromConfigSequenceAdapter",configSchema:c,getAdapterClass:()=>n.e(9431).then(n.bind(n,79431)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),(e=>{e.addAdapterType((()=>new o.AdapterType({name:"RefNameAliasAdapter",configSchema:d,getAdapterClass:()=>n.e(9372).then(n.bind(n,99372)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),function(e){e.addWidgetType((()=>new o.WidgetType({name:"ConfigurationEditorWidget",HeadingComponent:y,configSchema:b,stateModel:h(e),ReactComponent:v})))}(e)}}},19462:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(43800),a=n(20592),o=n(41867),i=n(31625),s=n(1502);const l=i.types.model("AddConnectionModel",{id:s.ElementId,type:i.types.literal("AddConnectionWidget")}),c=(0,r.ConfigurationSchema)("AddConnectionWidget",{}),d=e=>{e.addWidgetType((()=>new a.WidgetType({name:"AddConnectionWidget",heading:"Add a connection",configSchema:c,stateModel:l,ReactComponent:(0,o.lazy)((()=>Promise.all([n.e(4064),n.e(4550)]).then(n.bind(n,94550))))})))}},88654:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(43800),a=n(20592),o=n(41867),i=n(31625),s=n(1502),l=n(99512);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function d(e){return i.types.model("AddTrackModel",{id:s.ElementId,type:i.types.literal("AddTrackWidget"),view:i.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((()=>({trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0}))).actions((e=>({setAdapterHint(t){e.adapterHint=t},setTrackSource(t){e.trackSource=t},setTextIndexingConf(t){e.textIndexingConf=t},setTextIndexTrack(t){e.textIndexTrack=t},setTrackData(t){e.trackData=t},setIndexTrackData(t){e.indexTrackData=t},setAssembly(t){e.altAssemblyName=t},setTrackName(t){e.altTrackName=t},setTrackType(t){e.altTrackType=t},clearData(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0,e.textIndexingConf=void 0,e.textIndexTrack=!0}}))).views((e=>({get trackAdapter(){const{trackData:t,indexTrackData:n,adapterHint:r}=e;return t?(0,l.guessAdapter)(t,n,r,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,l.getFileName)(e.trackData):"")},get isFtp(){var t,n;const{trackData:r,indexTrackData:a}=e;return!!(null!==a&&void 0!==a&&null!==(t=a.uri)&&void 0!==t&&t.startsWith("ftp://")||null!==r&&void 0!==r&&null!==(n=r.uri)&&void 0!==n&&n.startsWith("ftp://"))},get isRelativeTrackUrl(){var t;const n=null===(t=e.trackData)||void 0===t?void 0:t.uri;return!!n&&!c(n)},get isRelativeIndexUrl(){var t;const n=null===(t=e.indexTrackData)||void 0===t?void 0:t.uri;return!!n&&!c(n)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){var t,n;return null===(t=e.trackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get indexHttp(){var t,n;return null===(t=e.indexTrackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){var e;return(null===(e=this.trackAdapter)||void 0===e?void 0:e.type)===l.UNSUPPORTED},get assembly(){var t;return e.altAssemblyName||(null===(t=e.view.assemblyNames)||void 0===t?void 0:t[0])},get trackType(){return e.altTrackType||(this.trackAdapter?(0,l.guessTrackType)(this.trackAdapter.type,e):"")}}))).views((e=>({get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}})))}const u=(0,r.ConfigurationSchema)("AddTrackWidget",{}),p=e=>{e.addWidgetType((()=>new a.WidgetType({name:"AddTrackWidget",heading:"Add a track",configSchema:u,stateModel:d(e),ReactComponent:(0,o.lazy)((()=>Promise.all([n.e(2280),n.e(4064),n.e(9942)]).then(n.bind(n,39942))))})))}},66504:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>f});var r=n(31625),a=n(43800),o=n(90872),i=n(1502),s=n(31061);function l(e,t){const{assemblyManager:n}=(0,o.getSession)(t),{pluginManager:r}=(0,o.getEnv)(t),{view:i}=t;if(!i)return[];const l=t.assemblyNames.map((e=>n.get(e))).filter(o.notEmpty);return e.filter((e=>{const t=(0,a.readConfObject)(e,"assemblyNames"),r=null===t||void 0===t?void 0:t.map((e=>n.get(e))).filter(o.notEmpty);return i.trackSelectorAnyOverlap?(0,s.zL)(r,l):(0,s.xO)(r,l)})).filter((e=>{const{displayTypes:t}=r.getViewType(i.type),n=t.map((e=>e.name)),a=e.displays.map((e=>e.type));return(0,s.zL)(n,a)}))}var c=n(99512);function d(e){let{model:t,trackConfs:n,extra:r}=e;const i={children:[]},{collapsed:l,filterText:d,activeSortTrackNames:u,activeSortCategories:p,view:h}=t;if(!h)return[];const g=(0,o.getSession)(t),f=h.tracks,m=n.filter((e=>(0,s.wB)(d,e,g)));for(const o of function(e,t,n){const r=e.map((e=>{var t,n,r;return[e,(0,a.readConfObject)(e,"name"),(null===(t=(0,a.readConfObject)(e,"category"))||void 0===t?void 0:t[0])||"",(null===(n=(0,a.readConfObject)(e,"category"))||void 0===n?void 0:n[1])||"",(null===(r=(0,a.readConfObject)(e,"category"))||void 0===r?void 0:r[2])||""]}));return t&&r.sort(((e,t)=>e[1].localeCompare(t[1]))),n&&r.sort(((e,t)=>e[2]!==t[2]?e[2].localeCompare(t[2]):e[3]!==t[3]?e[3].localeCompare(t[3]):e[4]!==t[4]?e[4].localeCompare(t[4]):0)),r.map((e=>e[0]))}(m,u,p)){const e=[...(0,a.readConfObject)(o,"category")||[]];o.trackId.endsWith("sessionTrack")&&e.unshift(" Session tracks");let t=i;for(let a=0;a<e.length;a++){const n=e[a],o=t.children.find((e=>e.name===n)),i=[r,e.slice(0,a+1).join(",")].filter((e=>!!e)).join("-");if(o)t=o;else{const e={children:[],name:n,id:i,isOpenByDefault:!l.get(i)};t.children.push(e),t=e}}const n=t.children.findIndex((e=>e.children.length)),s=-1===n?t.children.length:n;t.children.splice(s,0,{id:o.trackId,name:(0,c.getTrackName)(o,g),conf:o,checked:f.some((e=>e.configuration===o)),children:[]})}return i.children}function u(e){return r.types.model("HierarchicalTrackSelectorWidget",{id:i.ElementId,type:r.types.literal("HierarchicalTrackSelectorWidget"),initialized:r.types.maybe(r.types.boolean),collapsed:r.types.map(r.types.boolean),sortTrackNames:r.types.maybe(r.types.boolean),sortCategories:r.types.maybe(r.types.boolean),view:r.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((()=>({selection:[],filterText:""}))).actions((e=>({setSortTrackNames(t){e.sortTrackNames=t},setSortCategories(t){e.sortCategories=t},setSelection(t){e.selection=t},addToSelection(t){e.selection=(0,o.dedupe)([...e.selection,...t],(e=>e.trackId))},removeFromSelection(t){e.selection=e.selection.filter((e=>!t.includes(e)))},clearSelection(){e.selection=[]},setView(t){e.view=t},toggleCategory(t){e.collapsed.set(t,!e.collapsed.get(t))},setCategoryCollapsed(t,n){e.collapsed.set(t,n)},expandAllCategories(){e.collapsed.clear()},clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}}))).views((t=>({getRefSeqTrackConf(n){const{assemblyManager:r}=(0,o.getSession)(t),a=r.get(n),i=null===a||void 0===a?void 0:a.configuration.sequence,s=e.getViewType(t.view.type);if(i)for(const e of i.displays)if(s.displayTypes.some((t=>t.name===e.type)))return i}}))).views((e=>({get assemblyNames(){var t;return(null===(t=e.view)||void 0===t?void 0:t.assemblyNames)||[]}}))).views((e=>({get activeSortTrackNames(){var t;return null!==(t=e.sortTrackNames)&&void 0!==t?t:(0,a.getConf)((0,o.getSession)(e),["hierarchical","sort","trackNames"])},get activeSortCategories(){var t;return null!==(t=e.sortCategories)&&void 0!==t?t:(0,a.getConf)((0,o.getSession)(e),["hierarchical","sort","categories"])},connectionTrackConfigurations:t=>l(t.tracks,e),get trackConfigurations(){return[...e.assemblyNames.map((t=>e.getRefSeqTrackConf(t))),...l((0,o.getSession)(e).tracks,e)].filter(o.notEmpty)}}))).views((e=>({connectionHierarchy:t=>d({model:e,trackConfs:e.connectionTrackConfigurations(t),extra:t.name})}))).views((e=>({get allTracks(){const{connectionInstances:t=[]}=(0,o.getSession)(e);return[{group:"Tracks",tracks:e.trackConfigurations},...t.flatMap((e=>({group:(0,a.getConf)(e,"name"),tracks:e.tracks})))]}}))).views((e=>({get hierarchy(){return{name:"Root",id:"Root",children:e.allTracks.map((t=>({name:t.group,id:t.group,children:d({model:e,trackConfs:t.tracks,extra:t.group})}))).filter(((e,t)=>0===t||!!e.children.length))}}}))).actions((e=>({collapseSubCategories(){const t=[];(0,s.h6)(e.hierarchy.children,t);for(const n of t)e.setCategoryCollapsed(n,!0)},collapseTopLevelCategories(){const t=[];for(const n of e.hierarchy.children)n.children.length&&(0,s.Ak)(n.children,t);for(const n of t)e.setCategoryCollapsed(n,!0)}}))).actions((e=>({afterCreate(){if(!e.initialized){const t=(0,o.getSession)(e);(0,a.getConf)(t,["hierarchical","defaultCollapsed","topLevelCategories"])&&e.collapseTopLevelCategories(),(0,a.getConf)(t,["hierarchical","defaultCollapsed","subCategories"])&&e.collapseSubCategories();for(const n of(0,a.getConf)(t,["hierarchical","defaultCollapsed","categoryNames"]))e.collapsed.set(n,!0);e.initialized=!0}}}))).views((e=>({get hasAnySubcategories(){return e.allTracks.some((e=>e.tracks.some((e=>{var t;return(null===(t=(0,a.readConfObject)(e,"category"))||void 0===t?void 0:t.length)>1}))))}})))}const p=(0,a.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{});var h=n(20592),g=n(41867);const f=e=>{e.addWidgetType((()=>new h.WidgetType({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:p,stateModel:u(e),ReactComponent:(0,g.lazy)((()=>Promise.all([n.e(5582),n.e(482)]).then(n.bind(n,37926))))})))}},31061:(e,t,n)=>{"use strict";n.d(t,{Ak:()=>c,h6:()=>l,wB:()=>s,xO:()=>i,zL:()=>o});var r=n(43800),a=n(99512);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e[0]===t[0])return!0;{const n=new Set(e);return t.some((e=>n.has(e)))}}function i(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const t=new Set(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]);return e.every((e=>t.has(e)))}function s(e,t,n){const o=(0,r.readConfObject)(t,"category")||[],i=e.toLowerCase();return(0,a.getTrackName)(t,n).toLowerCase().includes(i)||!!o.filter((e=>e.toLowerCase().includes(i))).length}function l(e,t){let n=!1;for(const r of e)if(r.children.length){l(r.children,t)&&t.push(r.id)}else n=!0;return n}function c(e,t){for(const n of e)n.children.length&&t.push(n.id)}},58391:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(43800),a=n(20592),o=n(41867),i=n(31625),s=n(1502);function l(e){return i.types.model("PluginStoreModel",{id:s.ElementId,type:i.types.literal("PluginStoreWidget"),filterText:"",view:i.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((e=>({clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}})))}const c=(0,r.ConfigurationSchema)("PluginStoreWidget",{}),d=e=>{e.addWidgetType((()=>new a.WidgetType({name:"PluginStoreWidget",heading:"Plugin store",configSchema:c,stateModel:l(e),ReactComponent:(0,o.lazy)((()=>Promise.all([n.e(2280),n.e(8130)]).then(n.bind(n,28130))))})))}},72602:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(20592),a=n(88057),o=n(43800),i=n(90872),s=n(31625);const l=(0,o.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:a.baseConnectionConfig});function c(e){return s.types.compose("UCSCTrackHubConnection",(0,a.BaseConnectionModelFactory)(e),s.types.model({configuration:(0,o.ConfigurationReference)(l),type:s.types.literal("UCSCTrackHubConnection")})).actions((e=>({async connect(){const t=(0,i.getSession)(e),r=[];try{const i=(0,o.getConf)(e,"hubTxtLocation"),{generateTracks:s,fetchGenomesFile:l,fetchTrackDbFile:c,fetchHubFile:d}=await n.e(7608).then(n.bind(n,97608)),u=(await d(i)).get("genomesFile");if(!u)throw new Error("genomesFile not found on hub");const p=new URL(i.uri,i.baseUri),h=p?{uri:new URL(u,p).href,locationType:"UriLocation"}:{localPath:u,locationType:"LocalPathLocation"},g=await l(h),f={};for(const[n,v]of g){var a;const i=(0,o.getConf)(e,"assemblyNames");if(i.length>0&&!i.includes(n))continue;const l=null===(a=t.assemblyManager.get(n))||void 0===a?void 0:a.configuration;if(!l){r.push(n);continue}const d=v.get("trackDb");if(!d)throw new Error("genomesFile not found on hub");const h=new URL(u,p),g=p?{uri:new URL(d,h).href,locationType:"UriLocation"}:{localPath:d,locationType:"LocalPathLocation"},m=await c(g),y=s(m,g,n,(0,o.readConfObject)(l,["sequence","adapter"]));e.addTrackConfs(y),f[n]=y.length}const m=Object.entries(f),y=m.length?"Loaded data from these assemblies: ".concat(m.map((e=>{let[t,n]=e;return"".concat(t," (").concat(n," tracks)")})).join(", ")):"",b=r.length?"Skipped data from these assemblies: ".concat(r.join(", ")):"";t.notify([y,b].filter((e=>!!e)).join(". "),"success")}catch(l){var s;console.error(l),t.notify('There was a problem connecting to the UCSC Track Hub "'.concat(e.configuration.name,'". Please make sure you have entered a valid hub.txt file. The error that was thrown is: "').concat(l,'"'),"error"),null===(s=t.breakConnection)||void 0===s||s.call(t,e.configuration)}}})))}const d=e=>{e.addConnectionType((()=>new r.ConnectionType({name:"UCSCTrackHubConnection",configSchema:l,stateModel:c(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})))}},63008:(e,t,n)=>{"use strict";function r(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{assemblyName:r,refName:a,start:o,offset:i,oob:s}=t.pxToBp(e),l=Math.floor(o+i);return s?"out of bounds":"".concat(n?"{"+r+"}":"").concat(a,":").concat(l.toLocaleString("en-US"))}function a(e,t,n){const r=new Set,a=[...e].sort(((e,t)=>{const n=e.end-e.start;return t.end-t.start-n})),o=Array.from({length:Math.round(t)});for(const{key:i,offsetPx:s}of a){const e=Math.round(t-s+n),a=[Math.max(e-12,0),e];0===e||o.slice(...a).some(Boolean)?r.add(i):o.fill(!0,...a)}return r}function o(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=[],o=function(e,t,n){const r=t*(e=Math.abs(e));let a=10**Number.parseInt(Number(r).toExponential().split(/e/i)[1],10);for(;a<r&&(a*=2,!(a>=r));)a*=2.5;a=Math.max(a,5);const o=a/e;let i=0;return!(a%10)&&o/10>=n?i=a/10:!(a%5)&&o/5>=n?i=a/5:!(a%2)&&o/2>=n&&(i=a/2),{majorPitch:a,minorPitch:i}}(t,60,15),i=o.minorPitch||o.majorPitch;for(const{start:s,end:l,refName:c}of e){let e=0;const t=s,d=l;for(let l=Math.floor(t/i)*i;l<Math.ceil(d/i)*i+1;l+=i)r&&l%o.majorPitch?(a.push({type:"minor",base:l-1,index:e,refName:c}),e+=1):n&&Math.abs(l-s)>o.minorPitch&&(a.push({type:"major",base:l-1,index:e,refName:c}),e+=1)}return a}n.d(t,{Cz:()=>o,F$:()=>a,c4:()=>r})},86394:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w});var r=n(41867),a=n(81108),o=n(89170),i=n(51590),s=n(6743),l=n(45673),c=n(47192),d=n(3762),u=n(95460),p=n(80838);const h=(0,d.observer)((function(e){let{job:t}=e;return(0,p.jsx)(s.Z,{variant:"outlined",children:(0,p.jsxs)(l.Z,{children:[(0,p.jsxs)(i.Z,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Name: "}),t.name]}),t.statusMessage?(0,p.jsxs)(i.Z,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Message: "}),t.statusMessage]}):null]})})}));var g=n(59025),f=n(81898),m=n(61633),y=n(23801);const b=(0,d.observer)((function(e){let{job:t}=e;const[n,a]=(0,r.useState)(!1);return(0,p.jsxs)(s.Z,{variant:"outlined",children:[(0,p.jsxs)(l.Z,{children:[(0,p.jsxs)(i.Z,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Name: "}),t.name]}),(0,p.jsxs)(i.Z,{variant:"body1",children:[(0,p.jsx)("strong",{children:"Message: "}),t.statusMessage||"No message provided"]}),(0,p.jsx)(g.Z,{sx:{display:"flex",alignItems:"center",marginTop:10,marginBottom:10,marginLeft:10},children:0===t.progressPct||100===t.progressPct?(0,p.jsx)(g.Z,{sx:{width:"100%"},children:(0,p.jsx)(f.Z,{variant:"indeterminate"})}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(g.Z,{sx:{width:"100%"},children:(0,p.jsx)(f.Z,{variant:"determinate",value:t.progressPct})}),(0,p.jsx)(g.Z,{sx:{m:1},children:(0,p.jsx)(i.Z,{children:"".concat(Math.round(t.progressPct||0),"%")})})]})})]}),t.cancelCallback?(0,p.jsx)(m.Z,{children:(0,p.jsx)(y.Z,{variant:"contained",color:"inherit",disabled:n||0===t.progressPct,onClick:()=>{t.setStatusMessage("Aborted via cancel button"),t.cancelCallback&&t.cancelCallback(),a(!0)},children:"Cancel"})}):null]})})),v=(0,c.ZL)()((e=>({root:{margin:e.spacing(1)},expandIcon:{color:e.palette.tertiary.contrastText}}))),w=(0,d.observer)((function(e){let{model:t}=e;const{classes:n}=v(),{jobs:r,finished:c,queued:d,aborted:g}=t;return(0,p.jsxs)("div",{className:n.root,children:[(0,p.jsxs)(a.Z,{defaultExpanded:!0,children:[(0,p.jsx)(o.Z,{expandIcon:(0,p.jsx)(u.Z,{className:n.expandIcon}),children:(0,p.jsx)(i.Z,{variant:"h5",children:"Running jobs"})}),r.length?r.map(((e,t)=>(0,p.jsx)(b,{job:e},"".concat(JSON.stringify(e),"-").concat(t)))):(0,p.jsx)(s.Z,{variant:"outlined",children:(0,p.jsx)(l.Z,{children:(0,p.jsx)(i.Z,{variant:"body1",children:"No running jobs"})})})]}),(0,p.jsxs)(a.Z,{defaultExpanded:!0,children:[(0,p.jsx)(o.Z,{expandIcon:(0,p.jsx)(u.Z,{className:n.expandIcon}),children:(0,p.jsx)(i.Z,{variant:"h5",children:"Queued jobs"})}),d.length?d.map(((e,t)=>(0,p.jsx)(h,{job:e},"".concat(JSON.stringify(e),"-").concat(t)))):(0,p.jsx)(s.Z,{variant:"outlined",children:(0,p.jsx)(l.Z,{children:(0,p.jsx)(i.Z,{variant:"body1",children:"No queued jobs"})})})]}),(0,p.jsxs)(a.Z,{defaultExpanded:!0,children:[(0,p.jsx)(o.Z,{expandIcon:(0,p.jsx)(u.Z,{className:n.expandIcon}),children:(0,p.jsx)(i.Z,{variant:"h5",children:"Completed jobs"})}),c.length?c.map(((e,t)=>(0,p.jsx)(h,{job:e},"".concat(JSON.stringify(e),"-").concat(t)))):(0,p.jsx)(s.Z,{variant:"outlined",children:(0,p.jsx)(l.Z,{children:(0,p.jsx)(i.Z,{variant:"body1",children:"No completed jobs"})})})]}),(0,p.jsxs)(a.Z,{defaultExpanded:!0,children:[(0,p.jsx)(o.Z,{expandIcon:(0,p.jsx)(u.Z,{className:n.expandIcon}),children:(0,p.jsx)(i.Z,{variant:"h5",children:"Aborted jobs"})}),g.length?g.map(((e,t)=>(0,p.jsx)(h,{job:e},"".concat(JSON.stringify(e),"-").concat(t)))):(0,p.jsx)(s.Z,{variant:"outlined",children:(0,p.jsx)(l.Z,{children:(0,p.jsx)(i.Z,{variant:"body1",children:"No aborted jobs"})})})]})]})}))},19150:(e,t,n)=>{"use strict";n.d(t,{b0:()=>s,n2:()=>c,sh:()=>l});n(41867);var r=n(47192),a=n(3762),o=n(80838);const i=(0,r.ZL)()((e=>({contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.disabled},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}))),s=(0,a.observer)((function(e){let{block:t,children:n}=e;const{classes:r}=i(),{widthPx:a}=t;return(0,o.jsx)("div",{style:{width:a},className:r.contentBlock,children:n})}));function l(e){let{width:t}=e;const{classes:n}=i();return(0,o.jsx)("div",{className:n.elidedBlock,style:{width:t}})}function c(e){let{boundary:t,width:n,style:r={}}=e;const{classes:a}=i();return(0,o.jsx)("div",{style:{...r,width:n},className:t?a.boundaryPaddingBlock:a.interRegionPaddingBlock})}},90482:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});n(41867);var r=n(23801),a=n(77327),o=n(77573),i=n(47192),s=n(80838);const l=(0,i.ZL)()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"}});function c(e){let{message:t,severity:n,buttonText:i,icon:c,action:d}=e;const{classes:u}=l(),p=d?(0,s.jsx)(r.Z,{"data-testid":"reload_button",onClick:d,startIcon:c,children:i}):null;return(0,s.jsx)(a.Z,{severity:n,action:p,classes:{message:u.ellipses},children:(0,s.jsx)(o.Z,{title:t,children:(0,s.jsx)("div",{children:t})})})}},57918:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v,m:()=>w});var r=n(31625),a=n(43800),o=n(90872),i=n(1502),s=n(55022),l=n(99512),c=n(41867),d=n(47192),u=n(3762),p=n(35421),h=n(43203),g=n(90482),f=n(80838);const m=(0,d.ZL)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, ".concat(t," 5px, ").concat(t," 10px)"),textAlign:"center"}}})),y=(0,u.observer)((e=>{let{model:t}=e;const{classes:n}=m(),{status:a}=t,{message:o}=(0,r.getParent)(t,2),i=o||a;return(0,f.jsx)("div",{className:n.loading,children:(0,f.jsx)(p.LoadingEllipses,{message:i})})})),b=(0,u.observer)((function(e){let{model:t}=e;return t.error?(0,f.jsx)(g.Z,{message:"".concat(t.error),severity:"error",buttonText:"reload",icon:(0,f.jsx)(h.Z,{}),action:t.reload}):t.message?c.isValidElement(t.message)?t.message:(0,f.jsx)(g.Z,{message:"".concat(t.message),severity:"info"}):t.filled?t.reactElement:(0,f.jsx)(y,{model:t})})),v=r.types.model("BlockState",{key:r.types.string,region:i.Region,reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((()=>({renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:b,renderProps:void 0}))).actions((e=>{let t;return{doReload(){e.reloadFlag=e.reloadFlag+1},afterAttach(){const t=(0,o.getContainingDisplay)(e);setTimeout((()=>{(0,r.isAlive)(e)&&(0,o.makeAbortableReaction)(e,w,x,{name:"".concat(t.id,"/").concat((0,o.assembleLocString)(e.region)," rendering"),delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)}),t.renderDelay)},setStatus(t){e.status=t},setLoading(n){void 0===t||t.signal.aborted||t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=n},setMessage(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered(n){if(!n)return;const{reactElement:r,features:a,layout:o,maxHeightReached:i,renderProps:s}=n;e.filled=!0,e.message=void 0,e.reactElement=r,e.features=a,e.layout=o,e.error=void 0,e.maxHeightReached=i,e.renderProps=s,t=void 0},setError(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=n,e.renderProps=void 0,t=void 0,(0,s.Z6)(n)&&this.reload()},reload(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=b,e.renderProps=void 0,(0,r.getParent)(e,2).reload()},beforeDestroy(){(async()=>{try{t&&!t.signal.aborted&&t.abort();const n=(0,o.getContainingDisplay)(e),{rpcManager:a}=(0,o.getSession)(e),{rendererType:i}=n,{renderArgs:s}=w((0,r.cast)(e));s&&await i.freeResourcesInClient(a,JSON.parse(JSON.stringify(s)))}catch(n){console.error("Error while destroying block",n)}})()}}}));function w(e,t){try{const n=t||(0,o.getContainingDisplay)(e),{assemblyManager:i,rpcManager:s}=(0,o.getSession)(n),{adapterConfig:c,rendererType:d,error:u,parentTrack:p}=n,h=(0,l.getTrackAssemblyNames)(p),g=e.region.assemblyName;if(!h.includes(g)&&!h.some((e=>{var t;return null===(t=i.get(e))||void 0===t?void 0:t.hasName(g)})))throw new Error("region assembly (".concat(g,") does not match track assemblies (").concat(h,")"));const f=n.renderProps(),{config:m}=f;(0,a.readConfObject)(m);const y=(0,l.getRpcSessionId)(n),b=(0,o.getContainingView)(n).id;return{rendererType:d,rpcManager:s,renderProps:f,cannotBeRenderedReason:n.regionCannotBeRendered(e.region),displayError:u,renderArgs:{statusCallback:t=>{(0,r.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[(0,r.getSnapshot)(e.region)],adapterConfig:c,rendererType:d.name,sessionId:y,layoutId:b,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(n){return{displayError:n}}}async function x(e,t,n){if(!e)return;const{rendererType:a,renderProps:i,rpcManager:s,renderArgs:l,cannotBeRenderedReason:c,displayError:d}=e;if(!(0,r.isAlive)(n))return;if(d)return void n.setError(d);if(c)return void n.setMessage(c);if(i.notReady)return;const{reactElement:u,features:p,layout:h,maxHeightReached:g}=await a.renderInClient(s,{...l,...i,viewParams:(0,o.getViewParams)(n),signal:t});return{reactElement:u,features:p,layout:h,maxHeightReached:g,renderProps:i}}},26809:(e,t,n)=>{"use strict";n.d(t,{Iy:()=>l,ej:()=>i,zv:()=>s});var r=n(90872),a=n(99512),o=n(31625);function i(e){let t;return t=Math.floor(e/1e6)>0?"".concat(Number.parseFloat((e/1e6).toPrecision(3))," Mb"):Math.floor(e/1e3)>0?"".concat(Number.parseFloat((e/1e3).toPrecision(3))," Kb"):"".concat(Math.floor(e)," bytes"),t}function s(e,t){const n="undefined"===typeof jest;return"clip-".concat(n?e:"jest","-").concat(t)}async function l(e){const t=(0,r.getContainingView)(e).staticBlocks.contentBlocks,{rpcManager:n}=(0,r.getSession)(e),{adapterConfig:i}=e;if(!i)return{};const s=(0,a.getRpcSessionId)(e);return n.call(s,"CoreGetFeatureDensityStats",{sessionId:s,regions:t,adapterConfig:i,statusCallback:t=>{(0,o.isAlive)(e)&&e.setMessage(t)}})}},4635:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});n(41867);var r=n(3762),a=n(39194),o=n(33846),i=n(80838);function s(e,t,n,r,a){return"M"+e+","+t+"h"+(n-a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(r-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(a-n)+"z"}function l(e,t,n,r,a){return"M"+(e+a)+","+t+"h"+(n-a)+"v"+r+"h"+(a-n)+"a"+a+","+a+" 0 0 1 "+-a+","+-a+"v"+(2*a-r)+"a"+a+","+a+" 0 0 1 "+a+","+-a+"z"}function c(e,t,n,r){return[[e,r/2],[e+n,0],[e+n,r]].toString()}const d={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},u=(0,r.observer)((function(e){let{overview:t,block:n,assembly:r}=e;const{offsetPx:u,reversed:p}=n,h=(0,o.wo)(r,n.refName),g=p?h.length-1:0,f=p?0:h.length-1,m=a.VH;let y=!1;return(0,i.jsx)("g",{transform:"translate(-".concat(u,")"),children:h.map(((e,n)=>{const r=JSON.stringify(e),{refName:a,type:o,start:u,end:p}=e,h=t.bpToPx({refName:a,coord:u})||0,b=t.bpToPx({refName:a,coord:p})||0,v=Math.min(h,b),w=Math.abs(b-h),x=d[o];return"acen"!==o||y?"acen"===o&&y?(0,i.jsx)("polygon",{points:c(h,0,w,m),fill:x},r):g===n?(0,i.jsx)("path",{d:l(v,0,w,m,8),fill:x},r):f===n?(0,i.jsx)("path",{d:s(v,0,w,m,8),fill:x},r):(0,i.jsx)("rect",{x:v,y:0,width:w,height:m,fill:x},r):(y=!0,(0,i.jsx)("polygon",{points:(C=h,S=w,k=m,[[C,0],[C+S,k/2],[C,k]].toString()),fill:x},r));var C,S,k}))})}))},38739:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>he});var r=n(41867),a=n(7229),o=n(51590),i=n(23801),s=n(47192),l=n(35421),c=n(90872),d=n(3762),u=n(24728),p=n(31625),h=n(97486),g=n(71939),f=n(68367),m=n(43800),y=n(99512),b=n(69282),v=n(30340),w=n(22177),x=n(18087),C=n(36686),S=n(18032),k=n(80838);const T=(0,s.ZL)()({dragHandle:{cursor:"grab"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"}});const P=function(e){let{trackId:t,view:n,track:r}=e;const{classes:a}=T();return(0,k.jsx)("span",{draggable:!0,className:a.dragHandle,onDragStart:e=>{const t=e.currentTarget;if(t.parentNode){const a=t.parentNode;e.dataTransfer.setDragImage(a,20,20),n.setDraggingTrackId(r.id)}},onDragEnd:()=>n.setDraggingTrackId(void 0),"data-testid":"dragHandle-".concat(n.id,"-").concat(t),children:(0,k.jsx)(S.Z,{className:a.dragHandleIcon,fontSize:"small"})})},M=(0,s.ZL)()((e=>({root:{background:(0,g.Fq)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}))),R=(0,d.observer)(r.forwardRef((function(e,t){var n;let{track:r,className:i}=e;const{classes:s,cx:d}=M(),u=(0,c.getContainingView)(r),p=(0,c.getSession)(r),h=r.configuration,g=r.minimized,S=(0,m.getConf)(r,"trackId"),T=(0,y.getTrackName)(h,p),R=[{label:g?"Restore track":"Minimize track",icon:g?C.Z:x.Z,onClick:()=>r.setMinimized(!g)},...(null===(n=p.getTrackActionMenuItems)||void 0===n?void 0:n.call(p,h))||[],...r.trackMenuItems()].sort(((e,t)=>((null===t||void 0===t?void 0:t.priority)||0)-((null===e||void 0===e?void 0:e.priority)||0)));return(0,k.jsxs)(a.Z,{ref:t,className:d(i,s.root),children:[(0,k.jsx)(P,{track:r,trackId:S,view:u}),(0,k.jsx)(f.Z,{onClick:()=>u.hideTrack(S),className:s.iconButton,title:"close this track",children:(0,k.jsx)(w.Z,{fontSize:"small"})}),(0,k.jsx)(o.Z,{variant:"body1",component:"span",className:s.trackName,children:(0,k.jsx)(l.SanitizedHTML,{html:[T,g?"(minimized)":""].filter((e=>!!e)).join(" ")})}),(0,k.jsx)(b.Z,{menuItems:R,"data-testid":"track_menu_icon",children:(0,k.jsx)(v.Z,{fontSize:"small"})})]})}))),A=(0,s.ZL)()({trackLabel:{zIndex:3},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"}}),I=(0,d.observer)((function(e){let{track:t,view:n}=e;const{classes:r,cx:a}=A(),o=t.displays[0],{trackLabel:i,trackLabelOverlap:s,trackLabelOffset:l}=r,c="overlapping"!==n.trackLabelsSetting||o.prefersOffset?l:s;return"hidden"!==n.trackLabelsSetting?(0,k.jsx)(R,{track:t,className:a(i,c)}):null})),N=(0,s.ZL)()({renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2}}),L=(0,d.observer)((function(e){let{model:t,track:n,onDragEnter:a}=e;const{classes:o}=N(),i=n.displays[0],{height:s,RenderingComponent:c,DisplayBlurb:d}=i,u=(0,m.getConf)(n,"trackId"),p=(0,r.useRef)(null),h=n.minimized;return(0,r.useEffect)((()=>(p.current&&(t.trackRefs[u]=p.current),()=>{delete t.trackRefs[u]})),[t.trackRefs,u]),(0,k.jsx)("div",{className:o.trackRenderingContainer,style:{height:h?20:s},onScroll:e=>i.setScrollTop(e.currentTarget.scrollTop),onDragEnter:a,"data-testid":"trackRenderingContainer-".concat(t.id,"-").concat(u),children:h?null:(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{ref:p,className:o.renderingComponentContainer,style:{transform:"scaleX(".concat(t.scaleFactor,")")},children:(0,k.jsx)(r.Suspense,{fallback:(0,k.jsx)(l.LoadingEllipses,{}),children:(0,k.jsx)(c,{model:i,onHorizontalScroll:t.horizontalScroll})})}),d?(0,k.jsx)("div",{style:{position:"absolute",left:0,top:i.height-20},children:(0,k.jsx)(d,{model:i})}):null]})})})),F=(0,s.ZL)()({root:{marginTop:2},resizeHandle:{height:3,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3}}),j=(0,d.observer)((function(e){let{model:t,track:n}=e;const{classes:o}=F(),i=n.displays[0],{draggingTrackId:s}=t,d=(0,r.useRef)(null),u=void 0!==s&&s!==i.id,g=(0,c.useDebouncedCallback)((()=>{(0,p.isAlive)(i)&&u&&t.moveTrack(s,n.id)}),100);return(0,k.jsxs)(a.Z,{ref:d,className:o.root,variant:"outlined",onClick:e=>{if(2===e.detail&&!n.displays[0].featureIdUnderMouse){var r;const n=(null===(r=d.current)||void 0===r?void 0:r.getBoundingClientRect().left)||0;t.zoomTo(t.bpPerPx/2,e.clientX-n,!0)}},children:[(0,k.jsx)(I,{track:n,view:t}),(0,k.jsx)(h.SV,{FallbackComponent:e=>(0,k.jsx)(l.ErrorMessage,{error:e.error}),children:(0,k.jsx)(L,{model:t,track:n,onDragEnter:g})}),(0,k.jsx)("div",{className:o.overlay,style:{height:i.height,background:u?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:g}),(0,k.jsx)(l.ResizeHandle,{onDrag:i.resizeHeight,className:o.resizeHandle})]})}));var D=n(39194),B=n(92937),E=n.n(B),V=n(33846);function z(e,t,n){const[a,o]=(0,r.useState)(),[i,s]=(0,r.useState)(),[l,c]=(0,r.useState)(),[d,u]=(0,r.useState)(),p=void 0!==a&&void 0===l;function h(t){if(n&&!t.shiftKey)return;t.preventDefault(),t.stopPropagation();const r=(0,V.c6)(t,e.current);o(r),s(r)}function g(t){n?t.shiftKey?u((0,V.c6)(t,e.current)):u(void 0):u((0,V.c6)(t,e.current))}function f(){u(void 0),t.setOffsets(void 0,void 0)}function m(){c(void 0),o(void 0),s(void 0)}function y(e,t){t(),m()}(0,r.useEffect)((()=>{function n(t){if(e.current&&p){const n=(0,V.c6)(t,e.current);s(n)}}function r(n){if(void 0!==a&&e.current){const{clientX:r,clientY:o}=n,i=(0,V.c6)(n,e.current);c({offsetX:i,clientX:r,clientY:o});const s=function(e){if(void 0===a)return;const n=Math.min(a,e),r=Math.max(a,e);return{leftOffset:t.pxToBp(n),rightOffset:t.pxToBp(r)}}(i);s&&t.setOffsets(s.leftOffset,s.rightOffset),u(void 0)}}return p?(window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)}):()=>{}}),[a,p,l,t,e]),(0,r.useEffect)((()=>{!p&&void 0!==i&&void 0!==a&&Math.abs(i-a)<=3&&m()}),[p,i,a]);const b=Boolean(l);if(void 0===a)return{open:b,guideX:d,mouseDown:h,mouseMove:g,mouseOut:f,handleMenuItemClick:y};{const e=l?l.offsetX:i||0,n=e<a?e:a,r=Math.abs(e-a);return{open:b,rubberbandOn:!0,mouseDown:h,mouseMove:g,mouseOut:f,handleClose:m,handleMenuItemClick:y,leftBpOffset:t.pxToBp(n),rightBpOffset:t.pxToBp(n+r),anchorPosition:l,numOfBpSelected:Math.ceil(r*t.bpPerPx),width:r,left:n}}}var O=n(77573);const Z=(0,s.ZL)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}),W=(0,d.observer)((function(e){let{model:t,coordX:n}=e;const{classes:r}=Z();return(0,k.jsx)(O.Z,{open:!0,placement:"top",title:(0,c.stringify)(t.pxToBp(n)),arrow:!0,children:(0,k.jsx)("div",{className:r.guide,style:{left:n,background:"red"}})})}));var H=n(47451);const G=(0,s.ZL)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8}}),q=(0,d.observer)((function(e){let{model:t,ControlComponent:n=(0,k.jsx)("div",{})}=e;const a=(0,r.useRef)(null),{classes:o}=G(),{guideX:i,rubberbandOn:s,leftBpOffset:c,rightBpOffset:d,numOfBpSelected:u,width:p,left:h,anchorPosition:g,handleMenuItemClick:f,open:m,handleClose:y,mouseMove:b,mouseDown:v,mouseOut:w}=z(a,t);return(0,k.jsxs)(k.Fragment,{children:[void 0!==i?(0,k.jsx)(W,{model:t,coordX:i}):s?(0,k.jsx)(H.Z,{leftBpOffset:c,rightBpOffset:d,numOfBpSelected:u,width:p,left:h}):null,g?(0,k.jsx)(l.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:g.clientX,top:g.clientY},onMenuItemClick:f,open:m,onClose:y,menuItems:t.rubberBandMenuItems()}):null,(0,k.jsx)("div",{"data-testid":"rubberband_controls",className:o.rubberbandControl,ref:a,onMouseDown:v,onMouseMove:b,onMouseOut:w,children:n})]})}));var _=n(64019),U=n(19150),J=n(22405);const X=(0,s.ZL)()((e=>({scalebarContainer:{overflow:"hidden",position:"relative"},scalebarZoomContainer:{position:"relative",zIndex:1},scalebar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:11,zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:11,position:"absolute",left:2,top:-1,fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}))),Y=(0,d.observer)((e=>{let{model:t}=e;const{classes:n}=X();let r=0;return t.staticBlocks.forEach(((e,n)=>{e.offsetPx-t.offsetPx<0&&(r=n)})),(0,k.jsx)(k.Fragment,{children:t.staticBlocks.map(((e,a)=>e instanceof _.b0&&(e.isLeftEndOfDisplayedRegion||a===r)?(0,k.jsx)(o.Z,{style:{left:a===r?Math.max(0,-t.offsetPx):e.offsetPx-t.offsetPx-1,paddingLeft:a===r?0:1},className:n.refLabel,"data-testid":"refLabel-".concat(e.refName),children:e.refName},"refLabel-".concat(e.key,"-").concat(a)):null))})})),Q=function(e){let{block:t,bpPerPx:n}=e;const{classes:r}=X(),{reversed:a,start:i,end:s}=t,l=(0,J.Cz)(i,s,n,!0,!1);return(0,k.jsx)(U.b0,{block:t,children:l.map((e=>{let{type:t,base:l}=e;if("major"===t){const e=(a?s-l:l-i)/n,t=l+1;return(0,k.jsx)("div",{className:r.tick,style:{left:e},children:t?(0,k.jsx)(o.Z,{className:r.majorTickLabel,children:(0,c.getTickDisplayStr)(t,n)}):null},l)}return null}))})},K=(0,d.observer)((e=>{let{model:t}=e;const{staticBlocks:n,bpPerPx:r}=t;return(0,k.jsx)(k.Fragment,{children:n.map(((e,t)=>{const{key:n,widthPx:a}=e,o="".concat(n,"-").concat(t);return e instanceof _.b0?(0,k.jsx)(Q,{block:e,bpPerPx:r},o):e instanceof _.sh?(0,k.jsx)(U.sh,{width:a},o):e instanceof _.n2?(0,k.jsx)(U.n2,{width:a,style:{background:"none"},boundary:"boundary"===e.variant},o):null}))})})),$=(0,d.observer)(r.forwardRef((function(e,t){let{model:n,style:r,className:o,...i}=e;const{classes:s,cx:l}=X(),c=n.staticBlocks.offsetPx-n.offsetPx;return(0,k.jsxs)(a.Z,{"data-resizer":"true",className:l(s.scalebarContainer,o),variant:"outlined",ref:t,style:r,...i,children:[(0,k.jsx)("div",{className:s.scalebarZoomContainer,style:{transform:1!==n.scaleFactor?"scaleX(".concat(n.scaleFactor,")"):void 0},children:(0,k.jsx)("div",{className:s.scalebar,style:{left:c-1,width:n.staticBlocks.totalWidthPx,...r},children:(0,k.jsx)(K,{model:n})})}),(0,k.jsx)(Y,{model:n})]})}))),ee=(0,s.ZL)()((e=>({verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.action.disabled},minorTick:{background:e.palette.divider}})));function te(e){let{block:t,bpPerPx:n}=e;const{classes:r,cx:a}=ee(),o=(0,J.Cz)(t.start,t.end,n);return(0,k.jsx)(U.b0,{block:t,children:o.map((e=>{let{type:o,base:i}=e;const s=(t.reversed?t.end-i:i-t.start)/n;return(0,k.jsx)("div",{className:a(r.tick,"major"===o||"labeledMajor"===o?r.majorTick:r.minorTick),style:{left:s}},i)}))})}const ne=(0,d.observer)((e=>{let{model:t}=e;const{staticBlocks:n,bpPerPx:r}=t;return(0,k.jsx)(k.Fragment,{children:n.map(((e,t)=>{const n="".concat(e.key,"-").concat(t);return e instanceof _.b0?(0,k.jsx)(te,{block:e,bpPerPx:r},n):e instanceof _.sh?(0,k.jsx)(U.sh,{width:e.widthPx},n):e instanceof _.n2?(0,k.jsx)(U.n2,{width:e.widthPx,boundary:"boundary"===e.variant},n):null}))})})),re=(0,d.observer)((function(e){let{model:t}=e;const{classes:n}=ee(),r=t.staticBlocks.offsetPx-t.offsetPx;return(0,k.jsx)("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==t.scaleFactor?"scaleX(".concat(t.scaleFactor,")"):void 0},children:(0,k.jsx)("div",{className:n.verticalGuidesContainer,style:{left:r,width:t.staticBlocks.totalWidthPx},children:(0,k.jsx)(ne,{model:t})})})})),ae=(0,s.ZL)()((e=>({centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px ".concat(e.palette.action.active," dashed"),borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}))),oe=(0,d.observer)((function(e){let{model:t}=e;const{bpPerPx:n,centerLineInfo:a,trackHeights:o,tracks:i,width:s}=t,l=(0,r.useRef)(null),{classes:c}=ae(),d=s/2;return i.length?(0,k.jsx)("div",{"data-testid":"centerline_container",className:c.centerLineContainer,role:"presentation",ref:l,style:{left:"".concat(d,"px"),width:Math.max(1/n,1)},children:a&&(0,k.jsxs)("div",{"data-testid":"centerline_text",className:c.centerLineText,role:"presentation",style:{left:Math.max(1/n,1)+5,top:o},children:[a.refName,":"," ",Math.max(Math.round(a.offset)+1,0)]})}):null})),ie=oe,se=(0,s.ZL)()({tracksContainer:{position:"relative",overflow:"hidden"}}),le=(0,d.observer)((function(e){let{children:t,model:n}=e;const{classes:a}=se(),{pluginManager:o}=(0,c.getEnv)(n),{mouseDown:i,mouseUp:s}=function(e){const[t,n]=(0,r.useState)(!1),a=(0,r.useRef)(!1),o=(0,r.useRef)(0);return(0,r.useEffect)((()=>{let r=()=>{};function i(t){t.preventDefault();const n=t.clientX-o.current;n&&(a.current||(a.current=!0,window.requestAnimationFrame((()=>{e.horizontalScroll(-n),a.current=!1,o.current=t.clientX}))))}function s(){o.current=0,t&&n(!1)}return t&&(window.addEventListener("mousemove",i,!0),window.addEventListener("mouseup",s,!0),r=()=>{window.removeEventListener("mousemove",i,!0),window.removeEventListener("mouseup",s,!0)}),r}),[e,t,o]),{mouseDown:function(e){if(e.shiftKey)return;const t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(o.current=e.clientX,n(!0))},mouseUp:function(e){e.preventDefault(),n(!1)}}}(n),d=(0,r.useRef)(null),{guideX:u,rubberbandOn:p,leftBpOffset:h,rightBpOffset:g,numOfBpSelected:f,width:m,left:y,anchorPosition:b,handleMenuItemClick:v,open:w,handleClose:x,mouseMove:C,mouseDown:S}=z(d,n,!0);!function(e,t){const n=(0,r.useRef)(0),a=(0,r.useRef)(),o=(0,r.useRef)(!1);(0,r.useEffect)((()=>{const r=e.current;function i(e){const i=E()(e);!0===e.ctrlKey?(e.preventDefault(),n.current+=i.pixelY/500,t.setScaleFactor(n.current<0?1-n.current:1/(1+n.current)),a.current&&clearTimeout(a.current),a.current=setTimeout((()=>{t.setScaleFactor(1),t.zoomTo(n.current>0?t.bpPerPx*(1+n.current):t.bpPerPx/(1-n.current),e.clientX-((null===r||void 0===r?void 0:r.getBoundingClientRect().left)||0)),n.current=0}),300)):(Math.abs(i.pixelX)>Math.abs(2*i.pixelY)&&e.preventDefault(),n.current+=i.pixelX,o.current||(o.current=!0,window.requestAnimationFrame((()=>{t.horizontalScroll(n.current),n.current=0,o.current=!1}))))}return r?(r.addEventListener("wheel",i),()=>{r.removeEventListener("wheel",i)}):()=>{}}),[t,e])}(d,n);const T=o.evaluateExtensionPoint("LinearGenomeView-TracksContainerComponent",void 0,{model:n});return(0,k.jsxs)("div",{ref:d,"data-testid":"trackContainer",className:a.tracksContainer,onMouseDown:e=>{i(e),S(e)},onMouseMove:C,onMouseUp:s,children:[n.showGridlines?(0,k.jsx)(re,{model:n}):null,n.showCenterLine?(0,k.jsx)(ie,{model:n}):null,void 0!==u?(0,k.jsx)(W,{model:n,coordX:u}):p?(0,k.jsx)(H.Z,{leftBpOffset:h,rightBpOffset:g,numOfBpSelected:f,width:m,left:y}):null,b?(0,k.jsx)(l.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:b.clientX,top:b.clientY},onMenuItemClick:v,open:w,onClose:x,menuItems:n.rubberBandMenuItems()}):null,(0,k.jsx)(q,{model:n,ControlComponent:(0,k.jsx)($,{model:n,style:{height:D.n8,boxSizing:"border-box"}})}),T,t]})})),ce=(0,r.lazy)((()=>n.e(4872).then(n.bind(n,84872)))),de=(0,s.ZL)()((e=>({note:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},rel:{position:"relative"},top:{zIndex:1e3}})));function ue(e){let{model:t}=e;const{classes:n}=de(),{hideNoTracksActive:r}=t;return(0,k.jsx)(a.Z,{className:n.note,children:r?(0,k.jsx)("div",{style:{height:"48px"}}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o.Z,{children:"No tracks active."}),(0,k.jsx)(i.Z,{variant:"contained",color:"primary",onClick:()=>t.activateTrackSelector(),className:n.top,startIcon:(0,k.jsx)(u.GD,{}),children:"Open track selector"})]})})}const pe=(0,d.observer)((e=>{let{model:t}=e;const{tracks:n,error:a,initialized:o,hasDisplayedRegions:i}=t,s=(0,r.useRef)(null),d=(0,c.getSession)(t),{classes:u}=de();if((0,r.useEffect)((()=>{function e(e){var n,r;e.target instanceof Element&&null!==s&&void 0!==s&&null!==(n=s.current)&&void 0!==n&&n.contains(e.target)&&(null===(r=d.setFocusedViewId)||void 0===r||r.call(d,t.id))}return document.addEventListener("mousedown",e),document.addEventListener("keydown",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",e)}}),[d,t]),!o&&!a)return(0,k.jsx)(l.LoadingEllipses,{variant:"h6"});if(!i||a)return(0,k.jsx)(ce,{model:t});const p=t.MiniControlsComponent(),h=t.HeaderComponent();return(0,k.jsxs)("div",{className:u.rel,ref:s,onMouseLeave:()=>d.setHovered(void 0),onMouseMove:e=>{const n=s.current;if(!n)return;const{tracks:r}=t,a=e.clientX-n.getBoundingClientRect().left,o=t.pxToBp(a),i=r.find((e=>e.displays[0].featureUnderMouse));d.setHovered({hoverPosition:o,hoverFeature:i})},children:[(0,k.jsx)(h,{model:t}),(0,k.jsx)(p,{model:t}),(0,k.jsx)(le,{model:t,children:n.length?n.map((e=>(0,k.jsx)(j,{model:t,track:e},e.id))):(0,k.jsx)(ue,{model:t})})]})})),he=pe},41499:(e,t,n)=>{"use strict";n.d(t,{mg:()=>S,ZP:()=>P});var r=n(41867),a=n(17280),o=n(71939),i=n(51590),s=n(47192),l=n(3762),c=n(31996),d=n(90872),u=n(64019),p=n(39194),h=n(22405),g=n(77573),f=n(47451),m=n(33846),y=n(80838);const b=(0,s.ZL)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10},rel:{position:"relative"}}),v=(0,l.observer)((function(e){var t;let{model:n,open:r,guideX:a,overview:o}=e;const{classes:i}=b(),{cytobandOffset:s}=n,{assemblyManager:l}=(0,d.getSession)(n),c=o.pxToBp(a-s),u=l.get(c.assemblyName),p=null===u||void 0===u||null===(t=u.cytobands)||void 0===t?void 0:t.find((e=>c.coord>e.get("start")&&c.coord<e.get("end")&&c.refName===u.getCanonicalRefName(e.get("refName"))));return(0,y.jsx)(g.Z,{open:r,placement:"top",title:[(0,d.stringify)(c),null===p||void 0===p?void 0:p.get("name")].join(" "),arrow:!0,children:(0,y.jsx)("div",{className:i.guide,style:{left:a}})})})),w=(0,l.observer)((function(e){let{model:t,overview:n,ControlComponent:a=(0,y.jsx)("div",{})}=e;const{cytobandOffset:o}=t,[i,s]=(0,r.useState)(),[l,c]=(0,r.useState)(),[u,p]=(0,r.useState)(),h=(0,r.useRef)(null),{classes:g}=b(),w=void 0!==i;function x(e){e.preventDefault(),e.stopPropagation(),s((0,m.c6)(e,h.current))}function C(e){p((0,m.c6)(e,h.current))}function S(){p(void 0)}if((0,r.useEffect)((()=>{function e(e){const t=h.current;t&&w&&c((0,m.c6)(e,t))}function r(){if(void 0!==i&&void 0!==l&&Math.abs(l-i)>3){const e=Math.min(i,l),r=Math.max(i,l);t.moveTo(n.pxToBp(e-o),n.pxToBp(r-o))}if(void 0!==i&&void 0===l){const e=n.pxToBp(i-o);e.refName?t.centerAt(Math.round(e.coord),e.refName,e.index):((0,d.getSession)(t).notify("unknown position clicked"),console.error("unknown position clicked",e))}s(void 0),c(void 0),void 0!==i&&p(void 0)}function a(e){"Escape"===e.key&&(s(void 0),c(void 0))}return w?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",r,!0),window.addEventListener("keydown",a,!0),()=>{window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",r,!0),window.removeEventListener("keydown",a,!0)}):()=>{}}),[w,l,i,t,n,o]),void 0===i)return(0,y.jsxs)("div",{className:g.rel,children:[void 0!==u?(0,y.jsx)(v,{model:t,open:!w,overview:n,guideX:u}):null,(0,y.jsx)("div",{className:g.rubberbandControl,ref:h,onMouseDown:x,onMouseOut:S,onMouseMove:C,children:a})]});let k,T,P=i||0,M=0;return void 0!==i&&void 0!==l&&(P=l<i?l:i,M=l-i),i&&(k=n.pxToBp(i-o),T=n.pxToBp(i+M-o),void 0!==l&&l<i&&([k,T]=[T,k])),(0,y.jsxs)("div",{className:g.rel,children:[k&&T?(0,y.jsx)(f.Z,{leftBpOffset:k,rightBpOffset:T,width:Math.abs(M),left:P}):null,(0,y.jsx)("div",{"data-testid":"rubberband_controls",className:g.rubberbandControl,ref:h,onMouseDown:x,onMouseOut:S,onMouseMove:C,children:a})]})}));var x=n(4635);const C=(0,s.ZL)()((e=>({scalebar:{height:p.VH},scalebarBorder:{border:"1px solid"},scalebarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:p.VH,overflow:"hidden"},scalebarContigForward:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='".concat(e.palette.divider,"'/%3E%3C/svg%3E\")"),backgroundRepeat:"repeat"},scalebarContigReverse:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='".concat(e.palette.divider,"'/%3E%3C/svg%3E\")"),backgroundRepeat:"repeat"},scalebarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scalebarLabel:{height:p.VH,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scalebarVisibleRegion:{position:"absolute",height:p.VH,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:p.Od,position:"relative"},overviewSvg:{pointerEvents:"none",width:"100%",position:"absolute"}}))),S=(0,l.observer)((function(e){let{model:t,overview:n,useOffset:r=!0}=e;const i=(0,a.Z)(),s=Number(r),{interRegionPaddingWidth:l,offsetPx:c,dynamicBlocks:d,cytobandOffset:u}=t,{contentBlocks:h,totalWidthPxWithoutBorders:g}=d,{tertiary:f,primary:m}=i.palette,b=f?f.light:m.light;if(!h.length)return null;const v=h.at(0),w=h.at(-1),x=(n.bpToPx({...v,coord:v.reversed?v.end:v.start})||0)+u*s,C=(n.bpToPx({...w,coord:w.reversed?w.start:w.end})||0)+u*s,S=Math.max(0,-c),k=S+g+h.length*l/2,T=[[S,p.Od],[k,p.Od],[C,0],[x,0]];return(0,y.jsx)("polygon",{points:T.toString(),fill:(0,o.Fq)(b,.3),stroke:(0,o.Fq)(b,.8)})})),k=(0,l.observer)((function(e){let{scale:t,model:n,block:r,overview:o}=e;const{classes:s,cx:l}=C(),c=(0,a.Z)(),{cytobandOffset:u,showCytobands:p}=n,{start:g,end:f,reversed:b,refName:v,assemblyName:w}=r,{majorPitch:S}=(0,h._S)(t,120,15),{assemblyManager:k}=(0,d.getSession)(n),T=k.get(w),P=null===T||void 0===T?void 0:T.getRefNameColor(v),M=[];for(let a=0;a<Math.floor((f-g)/S);a++){const e=(a+1)*S;M.push(b?f-e:g+e)}const R=p&&(0,m.wo)(T,r.refName).length;return(0,y.jsxs)("div",{children:[(0,y.jsx)(i.Z,{style:{left:r.offsetPx+3,color:R?c.palette.text.primary:P},className:s.scalebarRefName,children:v}),(0,y.jsxs)("div",{className:l(s.scalebarContig,R?void 0:b?s.scalebarContigReverse:s.scalebarContigForward,R?void 0:s.scalebarBorder),style:{left:r.offsetPx+u,width:r.widthPx,borderColor:P},children:[R?null:M.map(((e,n)=>(0,y.jsx)(i.Z,{className:s.scalebarLabel,variant:"body2",style:{left:(n+1)*S/t,pointerEvents:"none",color:P},children:(0,d.getTickDisplayStr)(e,o.bpPerPx)},"".concat(JSON.stringify(r),"-").concat(e,"-").concat(n)))),R?(0,y.jsx)("svg",{style:{width:"100%"},children:(0,y.jsx)(x.Z,{overview:o,assembly:T,block:r})}):null]})]})})),T=(0,l.observer)((function(e){let{model:t,scale:n,overview:r}=e;const{classes:i}=C(),s=(0,a.Z)(),{dynamicBlocks:l,showCytobands:c,cytobandOffset:d}=t,p=l.contentBlocks,h=r.dynamicBlocks,{tertiary:g,primary:f}=s.palette,m=g?g.light:f.light;if(!p.length)return null;const b=p.at(0),v=p.at(-1),w=r.bpToPx({...b,coord:b.reversed?b.end:b.start})||0,x=r.bpToPx({...v,coord:v.reversed?v.start:v.end})||0,S=c?"#f00":m,T=c?.1:.3;return(0,y.jsxs)("div",{className:i.scalebar,children:[(0,y.jsx)("div",{className:i.scalebarVisibleRegion,style:{width:x-w,left:w+d,background:(0,o.Fq)(S,T),borderColor:S}}),h.map(((e,a)=>e instanceof u.b0?(0,y.jsx)(k,{scale:n,block:e,model:t,overview:r},"".concat(JSON.stringify(e),"-").concat(a)):(0,y.jsx)("div",{className:i.scalebarContig,style:{width:e.widthPx,left:e.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}},"".concat(JSON.stringify(e),"-").concat(a))))]})})),P=(0,l.observer)((function(e){let{model:t,children:n}=e;const{classes:a}=C(),{totalBp:o,width:i,cytobandOffset:s,displayedRegions:l}=t,d=i-s,u=(0,r.useMemo)((()=>{const e=c.Z.create({displayedRegions:JSON.parse(JSON.stringify(l)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth});return e.setVolatileWidth(d),e.showAllRegions(),e}),[JSON.stringify(l),t.minimumBlockWidth,d,l]),h=o/(d-2*(l.length-1));return(0,y.jsxs)("div",{children:[(0,y.jsx)(w,{model:t,overview:u,ControlComponent:(0,y.jsx)(T,{model:t,overview:u,scale:h})}),(0,y.jsxs)("div",{className:a.overview,children:[(0,y.jsx)("svg",{height:p.Od,className:a.overviewSvg,children:(0,y.jsx)(S,{model:t,overview:u})}),n]})]})}))},85084:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(41867),a=n(3762),o=n(90872),i=n(45728),s=n(85196);var l=n(49133),c=n(68367),d=n(78693),u=n(42215),p=n(42844),h=n(80838);const g=(0,r.lazy)((()=>n.e(8940).then(n.bind(n,28940))));function f(){const[e,t]=(0,r.useState)(!1);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.Z,{onClick:()=>t(!0),size:"small",children:(0,h.jsx)(p.Z,{fontSize:"small"})}),e?(0,h.jsx)(r.Suspense,{fallback:(0,h.jsx)("div",{}),children:(0,h.jsx)(g,{handleClose:()=>t(!1)})}):null]})}function m(e){let{showHelp:t,endAdornment:n}=e;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(d.Z,{position:"end",style:{marginRight:7},children:[(0,h.jsx)(u.Z,{fontSize:"small"}),t?(0,h.jsx)(f,{}):null]}),n]})}function y(e){let{TextFieldProps:t,inputBoxVal:n,params:r,showHelp:a,setInputValue:o,setCurrentSearch:i}=e;const{helperText:s,InputProps:c={}}=t;return(0,h.jsx)(l.Z,{onBlur:()=>o(n),...r,...t,size:"small",helperText:s,InputProps:{...r.InputProps,...c,endAdornment:(0,h.jsx)(m,{showHelp:a,endAdornment:r.InputProps.endAdornment})},placeholder:"Search for location",onChange:e=>i(e.target.value)})}const b=(0,a.observer)((function(e){var t;let{model:n,onSelect:a,assemblyName:l,style:c,fetchResults:d,onChange:u,value:p,showHelp:g=!0,minWidth:f=200,maxWidth:m=550,TextFieldProps:b={}}=e;const v=(0,o.getSession)(n),{assemblyManager:w}=v,[x,C]=(0,r.useState)(!1),[S,k]=(0,r.useState)(!0),[T,P]=(0,r.useState)(""),[M,R]=(0,r.useState)(""),[A,I]=(0,r.useState)(),N=(0,o.useDebounce)(T,300),L=l?w.get(l):void 0,{coarseVisibleLocStrings:F,hasDisplayedRegions:j}=n;(0,r.useEffect)((()=>{let e=!0;return(async()=>{try{if(""===N||!l)return;k(!1);const t=await d(N);e&&(k(!0),I(function(e){return Object.entries(function(e){const t={};for(const n of e){const e=n.getDisplayString();t[e]||(t[e]=[]),t[e].push(n)}return t}(e)).map((e=>{let[t,n]=e;return 1===n.length?{result:n[0]}:{result:new i.Z({displayString:t,results:n,label:t})}}))}(t)))}catch(t){console.error(t),e&&v.notify("".concat(t),"error")}})(),()=>{e=!1}}),[l,d,N,v,n]);const D=F||p||"",B=Math.min(Math.max((0,o.measureText)(D,14)+100,f),m);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(s.Z,{"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!l,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:{...c,width:B},value:D,loading:!S,inputValue:M,onInputChange:(e,t)=>{R(t),null===u||void 0===u||u(t)},loadingText:"loading results",open:x,onOpen:()=>C(!0),onClose:()=>{C(!1),k(!0),j&&(P(""),I(void 0))},onChange:(e,t)=>{t&&l&&("string"===typeof t?null===a||void 0===a||a(new i.Z({label:t})):null===a||void 0===a||a(t.result),R(D))},options:null!==A&&void 0!==A&&A.length?A:(null===L||void 0===L||null===(t=L.regions)||void 0===t?void 0:t.map((e=>({result:new i.R({refName:e.refName,label:e.refName,matchedAttribute:"refName"})}))))||[],getOptionDisabled:e=>"limitOption"===e.group,filterOptions:(e,t)=>{let{inputValue:n}=t;return function(e,t){const n=(r=e,a=t.toLocaleLowerCase(),r.filter((e=>{let{result:t}=e;return t.getLabel().toLowerCase().includes(a)||t.matchedObject})));var r,a;return[...n.slice(0,100),...n.length>100?[{group:"limitOption",result:new i.Z({label:"keep typing for more results"})}]:[]]}(e,n)},renderInput:e=>(0,h.jsx)(y,{showHelp:g,params:e,inputBoxVal:D,TextFieldProps:b,setCurrentSearch:P,setInputValue:R}),getOptionLabel:e=>"string"===typeof e?e:e.result.getDisplayString()})})}))},47451:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(41867),a=n(47192),o=n(71939),i=n(64980),s=n(51590),l=n(90872),c=n(80838);const d=(0,a.ZL)()((e=>{const{primary:t,tertiary:n}=e.palette;return{rubberband:{height:"100%",background:n?(0,o.Fq)(n.light,.7):(0,o.Fq)(t.light,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:n?n.contrastText:t.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)}}}));function u(e){let{leftBpOffset:t,rightBpOffset:n,numOfBpSelected:a,left:o,width:u}=e;const p=(0,r.useRef)(null),{classes:h}=d();return(0,c.jsxs)(c.Fragment,{children:[p.current?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.ZP,{className:h.popover,classes:{paper:h.paper},open:!0,anchorEl:p.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:(0,c.jsx)(s.Z,{children:(0,l.stringify)(t)})}),(0,c.jsx)(i.ZP,{className:h.popover,classes:{paper:h.paper},open:!0,anchorEl:p.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:(0,c.jsx)(s.Z,{children:(0,l.stringify)(n)})})]}):null,(0,c.jsx)("div",{ref:p,className:h.rubberband,style:{left:o,width:u},children:a?(0,c.jsxs)(s.Z,{variant:"h6",className:h.rubberbandText,children:[(0,l.toLocale)(a)," bp"]}):null})]})}},33846:(e,t,n)=>{"use strict";n.d(t,{c6:()=>s,kx:()=>o,pG:()=>i,wo:()=>l});var r=n(90872),a=n(45728);async function o(e){var t;let{queryString:n,searchType:o,searchScope:i,rankSearchResults:s,textSearchManager:l,assembly:c}=e;l||console.warn("No text search manager");const d=await(null===l||void 0===l?void 0:l.search({queryString:n,searchType:o},i,s)),u=null===c||void 0===c||null===(t=c.allRefNames)||void 0===t?void 0:t.filter((e=>e.toLowerCase().startsWith(n.toLowerCase()))).slice(0,10).map((e=>new a.Z({label:e})));return(0,r.dedupe)([...u||[],...d||[]],(e=>e.getId()))}function i(e,t){const n=e.lastIndexOf(t);if(-1===n)return[e,""];return[e.slice(0,n),e.slice(n+1)]}function s(e,t){return e.clientX-((null===t||void 0===t?void 0:t.getBoundingClientRect().left)||0)}function l(e,t){var n;return(null===e||void 0===e||null===(n=e.cytobands)||void 0===n?void 0:n.map((t=>({refName:e.getCanonicalRefName(t.get("refName"))||t.get("refName"),start:t.get("start"),end:t.get("end"),type:t.get("type")}))).filter((e=>e.refName===t)))||[]}},39194:(e,t,n)=>{"use strict";n.d(t,{Od:()=>pe,VH:()=>he,I1:()=>oe.default,n8:()=>ge,N_:()=>ye,Rj:()=>Q,EE:()=>be,FX:()=>_,ZP:()=>we});var r=n(41867),a=n(20592),o=n(43800),i=n(88057),s=n(1502),l=n(90872),c=n(33322),d=n(4206),u=n(99512),p=n(85815),h=n(31625),g=n(31996),f=n(56726),m=n(40753),y=n(25217),b=n.n(y),v=n(24728),w=n(12041),x=n(12966),C=n(85013),S=n(39841),k=n(10034),T=n(13536),P=n(97470),M=n(3762),R=n(7229),A=n(68367),I=n(2885),N=n(2829),L=n(69282),F=n(47192),j=n(80838);const D=(0,F.ZL)()((e=>({background:{position:"absolute",right:0,zIndex:1001,background:e.palette.background.paper},focusedBackground:{background:e.palette.secondary.light,svg:{fill:e.palette.secondary.contrastText}}}))),B=(0,M.observer)((function(e){let{model:t}=e;const{classes:n,cx:r}=D(),{id:a,bpPerPx:o,maxBpPerPx:i,minBpPerPx:s,scaleFactor:c,hideHeader:d}=t,{focusedViewId:u}=(0,l.getSession)(t);return d?(0,j.jsxs)(R.Z,{className:r(n.background,u===a?n.focusedBackground:void 0),children:[(0,j.jsx)(L.Z,{menuItems:t.menuItems(),children:(0,j.jsx)(N.Z,{fontSize:"small"})}),(0,j.jsx)(A.Z,{"data-testid":"zoom_out",onClick:()=>t.zoom(2*o),disabled:o>=i-1e-4||1!==c,children:(0,j.jsx)(I.Z,{fontSize:"small"})}),(0,j.jsx)(A.Z,{"data-testid":"zoom_in",onClick:()=>t.zoom(o/2),disabled:o<=s+1e-4||1!==c,children:(0,j.jsx)(T.Z,{fontSize:"small"})})]}):null}));var E=n(71939),V=n(23801),z=n(51590),O=n(45489),Z=n(20243),W=n(50348),H=n(41499),G=n(89628);const q=(0,F.ZL)()((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70,color:e.palette.text.secondary}}))),_=(0,M.observer)((function(e){let{model:t}=e;const{classes:n}=q(),{maxBpPerPx:a,minBpPerPx:o,bpPerPx:i,scaleFactor:s}=t,[l,c]=(0,r.useState)(100*-Math.log2(i));return(0,r.useEffect)((()=>{c(100*-Math.log2(i))}),[c,i]),(0,j.jsxs)("div",{className:n.container,children:[(0,j.jsx)(A.Z,{"data-testid":"zoom_out",onClick:()=>t.zoom(2*i),disabled:i>=a-1e-4||1!==s,size:"large",children:(0,j.jsx)(I.Z,{})}),(0,j.jsx)(G.ZP,{size:"small",className:n.slider,value:l,min:100*-Math.log2(a),max:100*-Math.log2(o),onChange:(e,t)=>c(t),onChangeCommitted:()=>t.zoomTo(2**(-l/100)),disabled:1!==s}),(0,j.jsx)(A.Z,{"data-testid":"zoom_in",onClick:()=>t.zoom(t.bpPerPx/2),disabled:i<=o+1e-4||1!==s,size:"large",children:(0,j.jsx)(T.Z,{})})]})}));var U=n(17280),J=n(85084),X=n(33846);const Y=(0,F.ZL)()((()=>({headerRefName:{minWidth:100}})));const Q=(0,M.observer)((function(e){let{model:t,showHelp:n}=e;const{classes:r}=Y(),a=(0,U.Z)(),o=(0,l.getSession)(t),{textSearchManager:i,assemblyManager:s}=o,{assemblyNames:c,rankSearchResults:d}=t,u=c[0],p=s.get(u),h=t.searchScope(u);async function g(e){const n=e.getLocation(),r=e.getTrackId();n&&(await t.navToLocString(n,u),r&&t.showTrack(r))}return(0,j.jsx)(J.Z,{showHelp:n,onSelect:async function(e){try{var n;const r=e.getLabel(),a=(null===p||void 0===p?void 0:p.allRefNamesWithLowerCase)||[];if(e.hasLocation())await g(e);else if(null!==(n=e.results)&&void 0!==n&&n.length)t.setSearchResults(e.results,e.getLabel());else if(r.split(" ").every((e=>function(e,t){const[n,r]=(0,X.pG)(e,":");return t.includes(e)||t.includes(n)&&!Number.isNaN(Number.parseInt(r,10))}(e,a))))await t.navToLocString(r,u);else{const e=await(0,X.kx)({queryString:r,searchType:"exact",searchScope:h,rankSearchResults:d,textSearchManager:i,assembly:p});e.length>1?t.setSearchResults(e,r.toLowerCase()):1===e.length?await g(e[0]):await t.navToLocString(r,u)}}catch(r){console.error(r),o.notify("".concat(r),"warning")}},assemblyName:u,fetchResults:e=>(0,X.kx)({queryString:e,searchScope:h,rankSearchResults:d,textSearchManager:i,assembly:p}),model:t,minWidth:175,TextFieldProps:{variant:"outlined",className:r.headerRefName,style:{margin:ye},InputProps:{style:{padding:0,height:be,background:(0,E.Fq)(a.palette.background.paper,.8)}}}})})),K=(0,F.ZL)()((e=>({headerBar:{display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},panButton:{background:(0,E.Fq)(e.palette.background.paper,.8),color:e.palette.text.primary,margin:ye},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",marginLeft:e.spacing(4)},buttonSpacer:{marginRight:e.spacing(2)}}))),$=(0,M.observer)((e=>{let{model:t}=e;const{classes:n}=K();return(0,j.jsx)(A.Z,{onClick:t.activateTrackSelector,className:n.toggleButton,title:"Open track selector",value:"track_select",children:(0,j.jsx)(v.GD,{className:n.buttonSpacer})})}));function ee(e){let{model:t}=e;const{classes:n}=K();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(V.Z,{variant:"outlined",className:n.panButton,onClick:()=>t.slide(-.9),children:(0,j.jsx)(W.Z,{})}),(0,j.jsx)(V.Z,{variant:"outlined",className:n.panButton,onClick:()=>t.slide(.9),children:(0,j.jsx)(Z.Z,{})})]})}const te=(0,M.observer)((e=>{let{model:t}=e;const{classes:n}=K(),{coarseTotalBp:r}=t;return(0,j.jsx)(z.Z,{variant:"body2",color:"textSecondary",className:n.bp,children:(0,l.getBpDisplayStr)(r)})})),ne=e=>{let{model:t}=e;const{classes:n}=K();return(0,j.jsxs)("div",{className:n.headerBar,children:[(0,j.jsx)($,{model:t}),(0,j.jsx)("div",{className:n.spacer}),(0,j.jsxs)(O.Z,{row:!0,className:n.headerForm,children:[(0,j.jsx)(ee,{model:t}),(0,j.jsx)(Q,{model:t})]}),(0,j.jsx)(te,{model:t}),(0,j.jsx)(_,{model:t}),(0,j.jsx)("div",{className:n.spacer})]})},re=(0,M.observer)((e=>{let{model:t}=e;return t.hideHeader?null:t.hideHeaderOverview?(0,j.jsx)(ne,{model:t}):(0,j.jsx)(H.ZP,{model:t,children:(0,j.jsx)(ne,{model:t})})}));var ae=n(22405),oe=n(38739);n(26783);const ie=(0,r.lazy)((()=>Promise.resolve().then(n.bind(n,31547)))),se=(0,r.lazy)((()=>n.e(8900).then(n.bind(n,58900)))),le=(0,r.lazy)((()=>n.e(8404).then(n.bind(n,88404)))),ce=(0,r.lazy)((()=>n.e(6423).then(n.bind(n,6423)))),de=(0,r.lazy)((()=>n.e(9004).then(n.bind(n,79004))));function ue(e){if(!e.length)return"";const t=e.every((t=>t.assemblyName===e[0].assemblyName));return e.map((e=>(0,l.assembleLocString)({...e,start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))).join(" ")}const pe=48,he=20,ge=17,fe=3,me=2,ye=7,be=32;function ve(e){return h.types.compose("LinearGenomeView",i.BaseViewModel,h.types.model({id:s.ElementId,type:h.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:h.types.array(s.Region),tracks:h.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:h.types.optional(h.types.enumeration(["hierarchical"]),"hierarchical"),showCenterLine:h.types.optional(h.types.boolean,(()=>Boolean(JSON.parse((0,l.localStorageGetItem)("lgv-showCenterLine")||"false")))),showCytobandsSetting:h.types.optional(h.types.boolean,(()=>Boolean(JSON.parse((0,l.localStorageGetItem)("lgv-showCytobands")||"true")))),trackLabels:h.types.optional(h.types.string,(()=>(0,l.localStorageGetItem)("lgv-trackLabels")||"")),showGridlines:!0})).volatile((()=>({volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0}))).views((e=>({get trackLabelsSetting(){const t=(0,o.getConf)((0,l.getSession)(e),["LinearGenomeViewPlugin","trackLabels"]);return e.trackLabels||t},get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return me},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]}}))).views((e=>({MiniControlsComponent:()=>B,HeaderComponent:()=>re,get assemblyErrors(){const{assemblyManager:t}=(0,l.getSession)(e),{assemblyNames:n}=e;return n.map((e=>{var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,l.getSession)(e),{assemblyNames:n}=e;return n.every((e=>{var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get scaleBarHeight(){return ge+fe},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?pe:pe+he},get trackHeights(){return(0,l.sum)(e.tracks.map((e=>e.displays[0].height)))},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*fe},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return e.displayedRegions.reduce(((e,t)=>e+t.end-t.start),0)},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:()=>({...(0,u.getParentRenderProps)(e),bpPerPx:e.bpPerPx,highResolutionScaling:(0,o.getConf)((0,l.getSession)(e),"highResolutionScaling")}),searchScope:t=>({assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}),getTrack:t=>e.tracks.find((e=>e.configuration.trackId===t)),rankSearchResults(t){const n=new Set(e.tracks.map((e=>e.configuration.trackId)));for(const e of t)n.has(e.trackId)&&e.updateScore(e.getScore()+1);return t},rewriteOnClicks(t,n){n.forEach((n=>{if("subMenu"in n&&this.rewriteOnClicks(t,n.subMenu),"onClick"in n){const r=n.onClick;n.onClick=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];e.tracks.forEach((e=>{e.type===t&&r.apply(e,[e,...a])}))}}}))},get trackTypeActions(){const t=new Map;return e.tracks.forEach((e=>{if(!t.get(e.type)){const n=b()(e.viewMenuActions);this.rewriteOnClicks(e.type,n),t.set(e.type,n)}})),t}}))).actions((t=>({setShowCytobands(e){t.showCytobandsSetting=e},setWidth(e){t.volatileWidth=e},setError(e){t.volatileError=e},toggleHeader(){t.hideHeader=!t.hideHeader},toggleHeaderOverview(){t.hideHeaderOverview=!t.hideHeaderOverview},toggleNoTracksActive(){t.hideNoTracksActive=!t.hideNoTracksActive},toggleShowGridlines(){t.showGridlines=!t.showGridlines},scrollTo(e){const n=(0,l.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=n,n},zoomTo(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.width/2,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=(0,l.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(a===t.bpPerPx)return a;const o=t.bpPerPx;return Math.abs(o-a)<1e-6?(console.warn("zoomTo bpPerPx rounding error"),o):(t.bpPerPx=a,this.scrollTo(Math.round((t.offsetPx+n)*o/a-(r?t.width/2:n))),a)},setOffsets(e,n){t.leftOffset=e,t.rightOffset=n},setSearchResults(e,n,r){(0,l.getSession)(t).queueDialog((a=>[de,{model:t,searchResults:e,searchQuery:n,handleClose:a,assemblyName:r}]))},setNewView(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip(){t.displayedRegions=(0,h.cast)([...t.displayedRegions].reverse().map((e=>({...e,reversed:!e.reversed})))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=e.pluggableConfigSchemaType("track"),i=(0,h.resolveIdentifier)(o,(0,h.getRoot)(t),n);if(!i)throw new Error('Could not resolve identifier "'.concat(n,'"'));const s=e.getTrackType(null===i||void 0===i?void 0:i.type);if(!s)throw new Error("Unknown track type ".concat(i.type));const l=e.getViewType(t.type),c=new Set(l.displayTypes.map((e=>e.name))),d=i.displays.find((e=>c.has(e.type)));if(!d)throw new Error("Could not find a compatible display for view type ".concat(t.type));const u=t.tracks.filter((e=>e.configuration===i));if(0===u.length){const e=s.stateModel.create({...r,type:i.type,configuration:i,displays:[{type:d.type,configuration:d,...a}]});return t.tracks.push(e),e}return u[0]},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=(0,h.resolveIdentifier)(r,(0,h.getRoot)(t),n),o=t.tracks.filter((e=>e.configuration===a));return(0,p.transaction)((()=>o.forEach((e=>t.tracks.remove(e))))),o.length}}))).actions((e=>({moveTrack(t,n){const r=e.tracks.findIndex((e=>e.id===t));if(-1===r)throw new Error("Track ID ".concat(t," not found"));const a=e.tracks.findIndex((e=>e.id===n));if(-1===a)throw new Error("Track ID ".concat(n," not found"));const o=(0,h.getSnapshot)(e.tracks[r]);e.tracks.splice(r,1),e.tracks.splice(a,0,o)},closeView(){const t=(0,l.getContainingView)(e);t?(0,l.isViewContainer)(t)&&t.removeView(e):(0,l.getSession)(e).removeView(e)},toggleTrack(t){e.hideTrack(t)||e.showTrack(t)},setTrackLabels(t){localStorage.setItem("lgv-trackLabels",t),e.trackLabels=t},toggleCenterLine(){e.showCenterLine=!e.showCenterLine},setDisplayedRegions(t){e.displayedRegions=(0,h.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,l.getSession)(e);if((0,l.isSessionModelWithWidgets)(t)){const n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},getSelectedRegions(t,n){const r=(0,h.getSnapshot)(e),a=g.Z.create({...r,interRegionPaddingWidth:e.interRegionPaddingWidth});return a.setVolatileWidth(e.width),a.moveTo(t,n),a.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},afterDisplayedRegionsSet(t){e.afterDisplayedRegionsSetCallbacks.push(t)},horizontalScroll(t){const n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(Math.round(t-e.width/2))},showAllRegions(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly(t){const n=(0,l.getSession)(e),{assemblyManager:r}=n;if(!t){const r=new Set(e.displayedRegions.map((e=>e.assemblyName)));if(r.size>1)return void n.notify("Can't perform operation with multiple assemblies currently");[t]=[...r]}const a=r.get(t);if(a){const{regions:t}=a;t&&(this.setDisplayedRegions(t),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId(t){e.draggingTrackId=t},setScaleFactor(t){e.scaleFactor=t},clearView(){this.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},async exportSvg(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderToSvg:r}=await Promise.resolve().then(n.bind(n,26783)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,m.saveAs)(o,t.filename||"image.svg")}}))).actions((e=>{let t=()=>{};return{slide:function(n){const[r,a]=(0,l.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo);t(),t=a,r()}}})).actions((e=>{let t=()=>{};return{zoom:function(n){if(e.zoomTo(e.bpPerPx),n<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||n>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)return;const r=e.bpPerPx/n,[a,o]=(0,l.springAnimate)(1,r,e.setScaleFactor,(()=>{e.zoomTo(n),e.setScaleFactor(1)}));t(),t=o,a()}}})).views((e=>({get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){const{assemblyManager:t}=(0,l.getSession)(e);return e.assemblyNames.some((e=>{var n,r;return null===(n=t.get(e))||void 0===n||null===(r=n.cytobands)||void 0===r?void 0:r.length}))},get cytobandOffset(){return this.showCytobands?(0,l.measureText)(e.displayedRegions[0].refName,12)+15:0}}))).views((e=>({menuItems(){const{canShowCytobands:t,showCytobands:n}=e,r=(0,l.getSession)(e),a=[{label:"Return to import form",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[ie,{model:e,handleClose:t}]))},icon:S.Z},...(0,l.isSessionWithAddTracks)(r)?[{label:"Sequence search",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[se,{model:e,handleClose:t}]))}}]:[],{label:"Export SVG",icon:k.Z,onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[le,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:v.GD},{label:"Horizontally flip",icon:w.Z,onClick:e.horizontallyFlip},{label:"Show...",icon:x.Z,subMenu:[{label:"Show all regions in assembly",onClick:e.showAllRegionsInAssembly},{label:"Show center line",type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{label:"Show header",type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Show no tracks active button",type:"checkbox",checked:!e.hideNoTracksActive,onClick:e.toggleNoTracksActive},{label:"Show guidelines",type:"checkbox",checked:e.showGridlines,onClick:e.toggleShowGridlines},...t?[{label:"Show ideogram",type:"checkbox",checked:e.showCytobands,onClick:()=>e.setShowCytobands(!n)}]:[]]},{label:"Track labels",icon:C.Z,subMenu:[{label:"Overlapping",icon:x.Z,type:"radio",checked:"overlapping"===e.trackLabelsSetting,onClick:()=>e.setTrackLabels("overlapping")},{label:"Offset",icon:x.Z,type:"radio",checked:"offset"===e.trackLabelsSetting,onClick:()=>e.setTrackLabels("offset")},{label:"Hidden",icon:x.Z,type:"radio",checked:"hidden"===e.trackLabelsSetting,onClick:()=>e.setTrackLabels("hidden")}]}];for(const[o,i]of e.trackTypeActions.entries())i.length&&(a.push({type:"divider"},{type:"subHeader",label:o}),i.forEach((e=>a.push(e))));return a}}))).views((e=>{let t,n="";return{get staticBlocks(){const r=(0,d.Z)(e),a=JSON.stringify(r);return n!==a&&(t=r,n=a),t},get dynamicBlocks(){return(0,c.Z)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},get visibleLocStrings(){return ue(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return ue(e.coarseDynamicBlocks)}}})).actions((e=>({setCoarseDynamicBlocks(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach(){(0,h.addDisposer)(e,(0,p.autorun)((()=>{e.initialized&&this.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150})),(0,h.addDisposer)(e,(0,p.autorun)((()=>{const t=e=>JSON.stringify(e),{showCytobandsSetting:n,showCenterLine:r}=e;"undefined"!==typeof localStorage&&(localStorage.setItem("lgv-showCytobands",t(n)),localStorage.setItem("lgv-showCenterLine",t(r)))})))}}))).actions((e=>({moveTo(t,n){(0,f.Ao)(e,t,n)},async navToLocString(t,n){const{assemblyNames:r}=e,{assemblyManager:a}=(0,l.getSession)(e),{isValidRefName:o}=a,i=n||r[0];return i&&await a.waitForAssembly(i),this.navToLocations((0,ae.nT)(t,i,o),i)},async navToLocations(t,n){const{assemblyManager:r}=(0,l.getSession)(e);await(0,p.when)((()=>void 0!==e.volatileWidth));const a=await(0,ae.Gc)(t,r,n);if(1===a.length){const t=a[0],{reversed:n,parentRegion:r,start:o,end:i}=t;e.setDisplayedRegions([{reversed:n,...r}]),this.navTo({...t,start:(0,l.clamp)(null!==o&&void 0!==o?o:0,0,r.end),end:(0,l.clamp)(null!==i&&void 0!==i?i:r.end,0,r.end)})}else e.setDisplayedRegions(a.map((e=>void 0===e.start?e.parentRegion:e))),e.showAllRegions()},navTo(e){this.navToMultiple([e])},navToMultiple(t){if(t.some((e=>void 0!==e.start&&void 0!==e.end&&e.start>e.end)))throw new Error("found start greater than end");const n=t.at(0),r=t.at(-1);if(!n||!r)return;const a=e.assemblyNames[0],{assemblyManager:o}=(0,l.getSession)(e),i=o.get(n.assemblyName||a),s=o.get(r.assemblyName||a),c=(null===i||void 0===i?void 0:i.getCanonicalRefName(n.refName))||n.refName,d=(null===s||void 0===s?void 0:s.getCanonicalRefName(r.refName))||r.refName,u=e.displayedRegions.find((e=>e.refName===c)),p=(0,l.findLast)(e.displayedRegions,(e=>e.refName===d));if(!u)throw new Error('could not find a region with refName "'.concat(c,'"'));if(!p)throw new Error('could not find a region with refName "'.concat(d,'"'));const h=void 0===n.start?u.start:n.start,g=void 0===n.end?u.end:n.end,f=void 0===r.start?p.start:r.start,m=void 0===r.end?p.end:r.end,y=e.displayedRegions.findIndex((e=>c===e.refName&&h>=e.start&&h<=e.end&&g<=e.end&&g>=e.start)),b=e.displayedRegions.findIndex((e=>d===e.refName&&f>=e.start&&f<=e.end&&m<=e.end&&m>=e.start));if(-1===y||-1===b)throw new Error('could not find a region that contained "'.concat(t.map((e=>(0,l.assembleLocString)(e))),'"'));const v=e.displayedRegions[y],w=e.displayedRegions[b];this.moveTo({index:y,offset:v.reversed?v.end-g:h-v.start},{index:b,offset:w.reversed?w.end-f:m-w.start})}}))).views((e=>({rubberBandMenuItems:()=>[{label:"Zoom to region",icon:T.Z,onClick:()=>e.moveTo(e.leftOffset,e.rightOffset)},{label:"Get sequence",icon:P.Z,onClick:()=>(0,l.getSession)(e).queueDialog((t=>[ce,{model:e,handleClose:t}]))}],bpToPx(t){let{refName:n,coord:r,regionNumber:a}=t;return(0,f.R)({refName:n,coord:r,regionNumber:a,self:e})},centerAt(t,n,r){const a=this.bpToPx({refName:n,coord:t,regionNumber:r});void 0!==a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},pxToBp:t=>(0,f.j4)(e,t),get centerLineInfo(){return e.displayedRegions.length>0?this.pxToBp(e.width/2):void 0},get visibleRegions(){return e.dynamicBlocks.contentBlocks}}))).actions((e=>({afterCreate(){function t(t){(0,l.getSession)(e).focusedViewId===e.id&&(t.ctrlKey||t.metaKey)&&("ArrowLeft"===t.code?(t.preventDefault(),e.slide(-.9)):"ArrowRight"===t.code?(t.preventDefault(),e.slide(.9)):"ArrowUp"===t.code&&1===e.scaleFactor?(t.preventDefault(),e.zoom(e.bpPerPx/2)):"ArrowDown"===t.code&&1===e.scaleFactor&&(t.preventDefault(),e.zoom(2*e.bpPerPx)))}document.addEventListener("keydown",t),(0,h.addDisposer)(e,(()=>{document.removeEventListener("keydown",t)}))}})))}function we(e){e.addViewType((()=>new a.ViewType({name:"LinearGenomeView",displayName:"Linear genome view",stateModel:ve(e),ReactComponent:(0,r.lazy)((()=>Promise.resolve().then(n.bind(n,38739))))})))}},26783:(e,t,n)=>{"use strict";n.d(t,{Uc:()=>x,Ge:()=>g,renderToSvg:()=>T,hY:()=>k});n(41867);var r=n(49665),a=n(85815),o=n(90872),i=n(81096),s=n(35421),l=n(17280),c=n(80838);function d(e){let{width:t,height:n,shift:r}=e;const a=(0,l.Z)();return(0,c.jsx)("rect",{width:t+2*r,height:n,fill:(0,o.stripAlpha)(a.palette.background.default)})}var u=n(99512);function p(e){let{model:t,height:n}=e;const{dynamicBlocks:r,offsetPx:a,interRegionPaddingWidth:o}=t;return(0,c.jsx)(c.Fragment,{children:r.contentBlocks.slice(1).map((e=>(0,c.jsx)("rect",{x:e.offsetPx-a-o,width:o,y:0,height:n,fill:"grey"},e.key)))})}function h(e){let{trackLabels:t,trackName:n,fontSize:r,trackLabelOffset:a,x:i}=e;const s=(0,l.Z)().palette.text.primary,d="overlay"===t?5:0,u="offset"===t?5:0,p=(0,o.coarseStripHTML)(n);return"none"!==t?(0,c.jsx)("g",{children:"left"===t?(0,c.jsx)("text",{x:a-40,y:20,fill:s,fontSize:r,dominantBaseline:"hanging",textAnchor:"end",children:p}):(0,c.jsx)("text",{x:i+d,y:u,fill:s,fontSize:r,dominantBaseline:"hanging",children:p})}):null}function g(e){let{displayResults:t,model:n,offset:r,textHeight:a,fontSize:i,trackLabels:s="offset",trackLabelOffset:l=0}=e;const d=(0,o.getSession)(n),g="offset"===s?a:0;return(0,c.jsx)(c.Fragment,{children:t.map((e=>{let{track:t,result:a}=e;const o=r,f=t.configuration,m=(0,u.getTrackName)(f,d),y=t.displays[0],b=Math.max(-n.offsetPx,0);return r+=y.height+g,(0,c.jsxs)("g",{transform:"translate(0 ".concat(o,")"),children:[(0,c.jsxs)("g",{transform:"translate(".concat(l," ").concat(g,")"),children:[(0,c.jsx)(p,{model:n,height:y.height}),a]}),(0,c.jsx)(h,{trackName:m,fontSize:i,trackLabels:s,trackLabelOffset:l,x:b})]},f.trackId)}))})}var f=n(31996),m=n(39194),y=n(4635),b=n(41499),v=n(22405);function w(e){let{start:t,end:n,bpPerPx:r,reversed:a=!1,major:i=!0,minor:s=!0,hideText:d=!1}=e;const u=(0,v.Cz)(t,n,r,i,s),p=(0,l.Z)(),h=(0,o.stripAlpha)(p.palette.text.secondary);return(0,c.jsxs)(c.Fragment,{children:[u.map((e=>{const o=(a?n-e.base:e.base-t)/r;return(0,c.jsx)("line",{x1:o,x2:o,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:h},"tick-"+e.base)})),d?null:u.filter((e=>"major"===e.type)).map((e=>{const i=(a?n-e.base:e.base-t)/r;return(0,c.jsx)("text",{x:i-3,y:18,fontSize:11,fill:h,children:(0,o.getTickDisplayStr)(e.base+1,r)},"label-".concat(e.base))}))]})}function x(e){let{model:t,fontSize:n}=e;const{dynamicBlocks:{contentBlocks:r},offsetPx:a,bpPerPx:i}=t,s=r.length<5,d=(0,l.Z)(),u=(0,o.stripAlpha)(d.palette.text.primary);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(p,{model:t,height:30}),r.map((e=>{const{start:t,end:r,key:o,reversed:l,offsetPx:d,refName:p,widthPx:h}=e,g=d-a,f="clip-".concat(o);return(0,c.jsxs)("g",{children:[(0,c.jsx)("defs",{children:(0,c.jsx)("clipPath",{id:f,children:(0,c.jsx)("rect",{x:0,y:0,width:h,height:100})})}),(0,c.jsx)("g",{transform:"translate(".concat(g," 0)"),children:(0,c.jsxs)("g",{clipPath:"url(#".concat(f,")"),children:[(0,c.jsx)("text",{x:4,y:n,fontSize:n,fill:u,children:p}),(0,c.jsx)("g",{transform:"translate(0 20)",children:(0,c.jsx)(w,{hideText:!s,start:t,end:r,bpPerPx:i,reversed:l})})]})})]},o)}))]})}function C(e){let{model:t,fontSize:n}=e;const{offsetPx:r,dynamicBlocks:{totalWidthPxWithoutBorders:a,totalBp:i}}=t,s=(0,l.Z)(),d=(0,o.getBpDisplayStr)(i),u=Math.max(-r,0),p=u+a,h=(0,o.stripAlpha)(s.palette.text.secondary),g=u+(p-u)/2,f=n;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("line",{x1:u,x2:p,y1:10,y2:10,stroke:h}),(0,c.jsx)("line",{x1:u,x2:u,y1:5,y2:15,stroke:h}),(0,c.jsx)("line",{x1:p,x2:p,y1:5,y2:15,stroke:h}),(0,c.jsx)("text",{x:g,y:f,textAnchor:"middle",dominantBaseline:"hanging",fontSize:n,fill:h,children:d})]})}function S(e){let{model:t,fontSize:n,cytobandHeight:r,rulerHeight:a}=e;const{width:i,assemblyNames:s,showCytobands:d,displayedRegions:u}=t,{assemblyManager:p}=(0,o.getSession)(t),h=s.length>1?"":s[0],g=p.get(h),v=(0,l.Z)(),w=(0,o.stripAlpha)(v.palette.text.primary),S=f.Z.create({displayedRegions:JSON.parse(JSON.stringify(u)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth}),k=t.dynamicBlocks.contentBlocks;if(!k.length)return null;S.setVolatileWidth(i),S.showAllRegions();const T=S.dynamicBlocks.contentBlocks[0],P=k.at(0),M=k.at(-1),R=S.bpToPx({...P,coord:P.reversed?P.end:P.start})||0,A=S.bpToPx({...M,coord:M.reversed?M.start:M.end})||0,I=+d*r;return(0,c.jsxs)("g",{id:"header",children:[(0,c.jsx)("text",{x:0,y:0,dominantBaseline:"hanging",fontSize:n,fill:w,children:h}),d?(0,c.jsxs)("g",{transform:"translate(0 ".concat(a,")"),children:[(0,c.jsx)(y.Z,{overview:S,assembly:g,block:T}),(0,c.jsx)("rect",{stroke:"red",fill:"rgb(255,0,0,0.1)",width:Math.max(A-R,.5),height:m.VH-1,x:R,y:.5}),(0,c.jsx)("g",{transform:"translate(0,".concat(m.VH,")"),children:(0,c.jsx)(b.mg,{overview:S,model:t,useOffset:!1})})]}):null,(0,c.jsx)("g",{transform:"translate(0 ".concat(n+I,")"),children:(0,c.jsx)(C,{model:t,fontSize:n})}),(0,c.jsx)("g",{transform:"translate(0 ".concat(a+I,")"),children:(0,c.jsx)(x,{model:t,fontSize:n})})]})}function k(e,t,n){return(0,o.sum)(e.map((e=>e.displays[0].height+(["none","left"].includes(n)?0:t))))}async function T(e,t){var n;await(0,a.when)((()=>e.initialized));const{textHeight:l=18,headerHeight:p=40,rulerHeight:h=50,fontSize:f=13,cytobandHeight:m=100,trackLabels:y="offset",themeName:b="default",Wrapper:v=(e=>{let{children:t}=e;return(0,c.jsx)(c.Fragment,{children:t})})}=t,w=(0,o.getSession)(e),x=null===(n=w.allThemes)||void 0===n?void 0:n.call(w)[b],{width:C,tracks:T,showCytobands:P}=e,M=p+h+ +P*m+10,R=k(T,l,y)+M+100,A=await Promise.all(T.map((async e=>{const n=e.displays[0];return await(0,a.when)((()=>!n.renderProps().notReady)),{track:e,result:await n.renderSvg({...t,theme:x})}}))),I=(0,o.max)(T.map((e=>(0,o.measureText)((0,u.getTrackName)(e.configuration,w),f))),0)+40,N="left"===y?I:0,L=C+N;return(0,r.uS)((0,c.jsx)(i.Z,{theme:(0,s.createJBrowseTheme)(x),children:(0,c.jsx)(v,{children:(0,c.jsxs)("svg",{width:L,height:R,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,L+100,R].toString(),children:[(0,c.jsx)(d,{width:L,height:R,shift:50}),(0,c.jsxs)("g",{transform:"translate(".concat(50," 0)"),children:[(0,c.jsx)("g",{transform:"translate(".concat(N,")"),children:(0,c.jsx)(S,{model:e,fontSize:f,rulerHeight:h,cytobandHeight:m})}),(0,c.jsx)(g,{textHeight:l,fontSize:f,model:e,displayResults:A,offset:M,trackLabels:y,trackLabelOffset:N})]})]})})}))}},22405:(e,t,n)=>{"use strict";n.d(t,{Cz:()=>o,Gc:()=>i,_S:()=>a,nT:()=>s});var r=n(90872);function a(e,t,n){const r=t*(e=Math.abs(e));let a=10**Number.parseInt(Number(r).toExponential().split(/e/i)[1],10);for(;a<r&&(a*=2,!(a>=r));)a*=2.5;a=Math.max(a,5);const o=a/e;let i=0;return!(a%10)&&o/10>=n?i=a/10:!(a%5)&&o/5>=n?i=a/5:!(a%2)&&o/2>=n&&(i=a/2),{majorPitch:a,minorPitch:i}}function o(e,t,n){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const i=a(n,60,15);let s=e,l=t;if(null===s||null===l)return[];n<0&&([s,l]=[l,s]),s-=Math.abs(20*n)-1,l+=Math.abs(20*n)+1;const c=i.minorPitch||i.majorPitch;let d=0;const u=[];for(let a=Math.floor(s/c)*c;a<Math.ceil(l/c)*c+1;a+=c)o&&a%(2*i.majorPitch)?(u.push({type:"minor",base:a-1,index:d}),d+=1):!r||a%(2*i.majorPitch)||(u.push({type:"major",base:a-1,index:d}),d+=1);return u}async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return Promise.all(e.map((async e=>{const r=e.assemblyName||n;if(!r)throw new Error("no assembly provided");const a=await t.waitForAssembly(r),{refName:o}=e;if(!a)throw new Error("assembly ".concat(r," not found"));const{regions:i}=a;if(!i)throw new Error("regions not loaded yet for ".concat(r));const s=a.getCanonicalRefName(e.refName);if(!s)throw new Error("Could not find refName ".concat(o," in ").concat(a.name));const l=i.find((e=>e.refName===s));if(!l)throw new Error("Could not find refName ".concat(o," in ").concat(r));return{...e,assemblyName:r,parentRegion:l}})))}function s(e,t,n){const a=e.split(/(\s+)/).map((e=>e.trim())).filter((e=>!!e));try{return a.map((e=>(0,r.parseLocString)(e,(e=>n(e,t)))))}catch(o){const[e,i,s]=a;if("".concat(o).match(/Unknown reference sequence/)&&Number.isInteger(+i)&&Number.isInteger(+s))return[(0,r.parseLocString)(e+":"+i+".."+s,(e=>n(e,t)))];throw o}}},4592:(e,t,n)=>{"use strict";n.d(t,{fV:()=>H,qb:()=>B,rK:()=>F.Z,Ek:()=>W,Uc:()=>ee.Uc,Ge:()=>ee.Ge,Rj:()=>U.Rj,eW:()=>z,fU:()=>s,ZP:()=>te,RH:()=>J,l0:()=>Q,hY:()=>ee.hY});var r=n(27032),a=n(90872),o=n(65331),i=n(43800);const s=(0,i.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"},height:{type:"number",defaultValue:100,description:"default height for the track"},mouseover:{type:"string",description:"text to display when the cursor hovers over a feature",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]}},{explicitIdentifier:"displayId"});var l=n(88057);class c{constructor(e){this.submaps=e}has(e){for(const t of this.submaps.values())if(t.has(e))return!0;return!1}get(e){for(const t of this.submaps.values())if(t.has(e))return t.get(e)}*values(){for(const e of this.keys())yield this.get(e)}*keys(){const e=new Set;for(const t of this.submaps.values())for(const n of t.keys())e.add(n);for(const t of e)yield t}find(e){for(const t of this.submaps.values())for(const n of t.values()){if(e(n))return n}}*[Symbol.iterator](){for(const e of this.keys())yield[e,this.get(e)]}*entries(){for(const e of this.keys())yield[e,this.get(e)]}}var d=n(99512),u=n(85815),p=n(31625),h=n(97470),g=n(41867),f=n(3762),m=n(17280),y=n(47192),b=n(35421),v=n(64019),w=n(19150),x=n(80838);const C=(0,y.ZL)()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),S=(0,f.observer)((function(e){let{model:t}=e;const{classes:n}=C(),{blockDefinitions:r,blockState:a}=t;return(0,x.jsx)(x.Fragment,{children:r.map((e=>{if(e instanceof v.b0){const r=a.get(e.key);return(0,x.jsxs)(w.b0,{block:e,children:[r&&r.ReactComponent?(0,x.jsx)(r.ReactComponent,{model:r}):null,r&&r.maxHeightReached?(0,x.jsx)("div",{className:n.heightOverflowed,style:{top:r.layout.getTotalHeight()-16,pointerEvents:"none",height:16},children:"Max height reached"}):null]},"".concat(t.id,"-").concat(e.key))}if(e instanceof v.sh)return(0,x.jsx)(w.sh,{width:e.widthPx},"".concat(t.id,"-").concat(e.key));if(e instanceof v.n2)return(0,x.jsx)(w.n2,{width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant},e.key);throw new Error("invalid block type ".concat(JSON.stringify(e)))}))})})),k=(0,f.observer)((function(e){let{model:t}=e;const{classes:n}=C(),{blockDefinitions:r}=t,o=(0,a.getContainingView)(t);return(0,x.jsx)("div",{className:n.linearBlocks,style:{left:r.offsetPx-o.offsetPx},children:(0,x.jsx)(S,{model:t})})})),T=k;var P=n(71939),M=n(14564),R=n(71579);const A=(0,y.ZL)()((e=>{return{tooltip:{pointerEvents:"none",backgroundColor:(0,P.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat((t=1.4,Math.round(1e5*t)/1e5),"em"),maxWidth:300,wordWrap:"break-word"}};var t})),I=g.forwardRef((function(e,t){let{message:n}=e;return(0,x.jsx)("div",{ref:t,children:g.isValidElement(n)?n:n?(0,x.jsx)(b.SanitizedHTML,{html:String(n)}):null})})),N=(0,f.observer)((e=>{var t,n;let{model:r,clientMouseCoord:a}=e;const{theme:o,classes:s}=A(),{featureUnderMouse:l}=r,[c,d]=(0,g.useState)(0),[u,p]=(0,g.useState)(null),h=(0,g.useMemo)((()=>({getBoundingClientRect:()=>{const e=a[0]+c/2+20,t=a[1];return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON(){}}}})),[a,c]),{styles:f,attributes:m}=(0,R.D)(h,u),y=l?(0,i.getConf)(r,"mouseover",{feature:l}):void 0,b=null===o||void 0===o||null===(t=o.components)||void 0===t?void 0:t.MuiPopper;return l&&y?(0,x.jsx)(M.h,{container:null===b||void 0===b||null===(n=b.defaultProps)||void 0===n?void 0:n.container,children:(0,x.jsx)("div",{ref:p,className:s.tooltip,style:{...f.popper,zIndex:1e5},...m.popper,children:(0,x.jsx)(I,{ref:e=>d((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0),message:y})})}):null})),L=N;var F=n(90482);const j=(0,y.ZL)()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),D=(0,f.observer)((function(e){const{classes:t}=j(),n=(0,m.Z)(),r=(0,g.useRef)(null),[a,o]=(0,g.useState)(),[s,l]=(0,g.useState)([0,0]),[c,d]=(0,g.useState)([0,0]),[u,p]=(0,g.useState)(),{model:h,children:f}=e,{TooltipComponent:y,DisplayMessageComponent:v,contextMenuItems:w,height:C,setContextMenuFeature:S}=h;return(0,x.jsxs)("div",{ref:r,"data-testid":"display-".concat((0,i.getConf)(h,"displayId")),className:t.display,onContextMenu:e=>{e.preventDefault(),u?p(void 0):r.current&&p([e.clientX,e.clientY])},onMouseMove:e=>{if(!r.current)return;const t=r.current.getBoundingClientRect(),{left:n,top:a}=t;l([e.clientX-n,e.clientY-a]),d([e.clientX,e.clientY]),o(t)},children:[v?(0,x.jsx)(v,{model:h}):(0,x.jsx)(T,{...e}),f,(0,x.jsx)(y,{model:h,height:C,offsetMouseCoord:s,clientMouseCoord:c,clientRect:a,mouseCoord:s}),(0,x.jsx)(b.Menu,{open:Boolean(u)&&Boolean(w().length),onMenuItemClick:(e,t)=>{t(),p(void 0)},onClose:()=>{p(void 0),S(void 0)},TransitionProps:{onExit:()=>{p(void 0),S(void 0)}},anchorReference:"anchorPosition",anchorPosition:u?{top:u[1],left:u[0]}:void 0,style:{zIndex:n.zIndex.tooltip},menuItems:w()})]})})),B=D;var E=n(57918);const V=20;function z(){return p.types.model({heightPreConfig:p.types.maybe(p.types.refinement("displayHeight",p.types.number,(e=>e>=V)))}).volatile((()=>({scrollTop:0}))).views((e=>({get height(){var t;return null!==(t=e.heightPreConfig)&&void 0!==t?t:(0,i.getConf)(e,"height")}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,V),e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n}})))}const O=function(e){let{model:t}=e;const{regionTooLargeReason:n}=t;return(0,x.jsx)(F.Z,{severity:"warning",action:()=>{t.setFeatureDensityStatsLimit(t.featureDensityStats),t.reload()},buttonText:"Force load",message:[n,"Zoom in to see features or force load (may be slow)"].filter((e=>!!e)).join(". ")})};var Z=n(26809);function W(){return p.types.model({userBpPerPxLimit:p.types.maybe(p.types.number),userByteSizeLimit:p.types.maybe(p.types.number)}).volatile((()=>({featureDensityStatsP:void 0,featureDensityStats:void 0,currStatsBpPerPx:0}))).views((e=>({get currentBytesRequested(){var t;return(null===(t=e.featureDensityStats)||void 0===t?void 0:t.bytes)||0},get currentFeatureScreenDensity(){var t;const n=(0,a.getContainingView)(e);return((null===(t=e.featureDensityStats)||void 0===t?void 0:t.featureDensity)||0)*n.bpPerPx},get maxFeatureScreenDensity(){return(0,i.getConf)(e,"maxFeatureScreenDensity")},get featureDensityStatsReady(){const t=(0,a.getContainingView)(e);return e.currStatsBpPerPx===t.bpPerPx&&(!!e.featureDensityStats||!!e.userBpPerPxLimit)},get maxAllowableBytes(){var t;return e.userByteSizeLimit||(null===(t=e.featureDensityStats)||void 0===t?void 0:t.fetchSizeLimit)||(0,i.getConf)(e,"fetchSizeLimit")}}))).actions((e=>({afterAttach(){(0,p.addDisposer)(e,(0,u.autorun)((()=>async function(e){try{var t;const n=(0,a.getContainingView)(e);if(!n.initialized||!n.staticBlocks.contentBlocks.length||n.bpPerPx===e.currStatsBpPerPx||e.error)return;if(void 0!==(null===(t=e.featureDensityStats)||void 0===t?void 0:t.featureDensity))return void e.setCurrStatsBpPerPx(n.bpPerPx);e.clearFeatureDensityStats(),e.setCurrStatsBpPerPx(n.bpPerPx);const r=await e.getFeatureDensityStats();(0,p.isAlive)(e)&&e.setFeatureDensityStats(r)}catch(n){!(0,a.isAbortException)(n)&&(0,p.isAlive)(e)&&(console.error(n),e.setError(n))}}(e))))}}))).actions((e=>({setCurrStatsBpPerPx(t){e.currStatsBpPerPx=t},setFeatureDensityStatsLimit(t){const n=(0,a.getContainingView)(e);null!==t&&void 0!==t&&t.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=n.bpPerPx},async getFeatureDensityStats(){return e.featureDensityStatsP||(e.featureDensityStatsP=(0,Z.Iy)(e).catch((t=>{throw(0,p.isAlive)(e)&&this.setFeatureDensityStatsP(void 0),t}))),e.featureDensityStatsP},setFeatureDensityStatsP(t){e.featureDensityStatsP=t},setFeatureDensityStats(t){e.featureDensityStats=t},clearFeatureDensityStats(){e.featureDensityStatsP=void 0,e.featureDensityStats=void 0}}))).views((e=>({get regionTooLarge(){const t=(0,a.getContainingView)(e);return!(!e.featureDensityStatsReady||t.dynamicBlocks.totalBp<2e4)&&(e.currentBytesRequested>e.maxAllowableBytes||(e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity))},get regionTooLargeReason(){const t=e.currentBytesRequested,n=e.maxAllowableBytes;return t&&t>n?"Requested too much data (".concat((0,Z.ej)(t),")"):""}}))).views((e=>({regionCannotBeRenderedText:t=>e.regionTooLarge?"Force load to see features":"",regionCannotBeRendered:t=>e.regionTooLarge?(0,x.jsx)(O,{model:e}):null})))}const H=p.types.compose("BaseLinearDisplay",l.BaseDisplay,z(),W(),p.types.model({blockState:p.types.map(E.Z),configuration:(0,i.ConfigurationReference)(s)})).volatile((()=>({featureIdUnderMouse:void 0,contextMenuFeature:void 0}))).views((e=>({get blockType(){return"staticBlocks"},get blockDefinitions(){const t=(0,a.getContainingView)(e);if(!t.initialized)throw new Error("view not initialized yet");return t[this.blockType]}}))).views((e=>({get renderDelay(){return 50},get TooltipComponent(){return L},get selectedFeatureId(){if((0,p.isAlive)(e)){const{selection:t}=(0,a.getSession)(e);if((0,a.isFeature)(t))return t.id()}},get DisplayMessageComponent(){}}))).views((e=>({get features(){const t=[];for(const n of e.blockState.values())null!==n&&void 0!==n&&n.features&&t.push(n.features);return new c(t)},get featureUnderMouse(){const t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping(t,n,r){var a,o;return null===(a=e.blockState.get(t))||void 0===a||null===(o=a.layout)||void 0===o?void 0:o.getByCoord(n,r)},getFeatureByID(t,n){var r,a;return null===(r=e.blockState.get(t))||void 0===r||null===(a=r.layout)||void 0===a?void 0:a.getByID(n)},searchFeatureByID(t){let n;return e.blockState.forEach((e=>{var r;const a=null===e||void 0===e||null===(r=e.layout)||void 0===r?void 0:r.getByID(t);a&&(n=a)})),n}}))).actions((e=>({addBlock(t,n){e.blockState.set(t,E.Z.create({key:t,region:n.toRegion()}))},deleteBlock(t){e.blockState.delete(t)},selectFeature(t){const n=(0,a.getSession)(e);if((0,a.isSessionModelWithWidgets)(n)){const r=n.addWidget("BaseFeatureWidget","baseFeature",{view:(0,a.getContainingView)(e),track:(0,a.getContainingTrack)(e),featureData:t.toJSON()});n.showWidget(r)}(0,a.isSelectionContainer)(n)&&n.setSelection(t)},clearFeatureSelection(){(0,a.getSession)(e).clearSelection()},setFeatureIdUnderMouse(t){e.featureIdUnderMouse=t},setContextMenuFeature(t){e.contextMenuFeature=t}}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),e.setCurrStatsBpPerPx(0),e.clearFeatureDensityStats(),[...e.blockState.values()].map((e=>e.doReload())),t()}}})).views((e=>({trackMenuItems:()=>[],contextMenuItems:()=>[...e.contextMenuFeature?[{label:"Open feature details",icon:h.Z,onClick:()=>{e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[]],renderProps:()=>({...(0,d.getParentRenderProps)(e),notReady:!e.featureDensityStatsReady,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick(t,n){const r=n||e.featureIdUnderMouse;if(r){const t=e.features.get(r);t&&e.selectFeature(t)}else e.clearFeatureSelection()},onClick(){e.clearFeatureSelection()},onFeatureContextMenu(t,n){const r=n||e.featureIdUnderMouse;r?e.setContextMenuFeature(e.features.get(r)):e.clearFeatureSelection()},onMouseMove(t,n){e.setFeatureIdUnderMouse(n)},onMouseLeave(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})}))).actions((e=>({async renderSvg(t){const{renderBaseLinearDisplaySvg:r}=await n.e(737).then(n.bind(n,50737));return r(e,t)},afterAttach(){(0,p.addDisposer)(e,(0,u.autorun)((()=>{const t={};(0,a.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((n=>{t[n.key]=!0,e.blockState.has(n.key)||e.addBlock(n.key,n)})),e.blockState.forEach(((n,r)=>{t[r]||e.deleteBlock(r)})))})))}}))).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...n}=e;return{heightPreConfig:t,...n}})).postProcessSnapshot((e=>{const t=e,{blockState:n,...r}=t;return r}));var G=n(20592);function q(e){return(0,i.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:s,explicitlyTyped:!0})}function _(e){return p.types.compose("LinearBareDisplay",H,p.types.model({type:p.types.literal("LinearBareDisplay"),configuration:(0,i.ConfigurationReference)(e)})).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),...(0,d.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}}))}var U=n(39194);const J=function(e){return(0,i.ConfigurationSchema)("LinearBasicDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:s,explicitlyTyped:!0})};var X=n(12966);const Y=(0,g.lazy)((()=>n.e(7930).then(n.bind(n,39004))));const Q=function(e){return p.types.compose("LinearBasicDisplay",H,p.types.model({type:p.types.literal("LinearBasicDisplay"),trackShowLabels:p.types.maybe(p.types.boolean),trackShowDescriptions:p.types.maybe(p.types.boolean),trackDisplayMode:p.types.maybe(p.types.string),trackMaxHeight:p.types.maybe(p.types.number),configuration:(0,i.ConfigurationReference)(e)})).views((e=>({get rendererTypeName(){return(0,i.getConf)(e,["renderer","type"])},get showLabels(){var t;return null!==(t=e.trackShowLabels)&&void 0!==t?t:(0,i.getConf)(e,["renderer","showLabels"])},get showDescriptions(){var t;return null!==(t=e.trackShowDescriptions)&&void 0!==t?t:(0,i.getConf)(e,["renderer","showDescriptions"])},get maxHeight(){var t;return null!==(t=e.trackMaxHeight)&&void 0!==t?t:(0,i.getConf)(e,["renderer","maxHeight"])},get displayMode(){var t;return null!==(t=e.trackDisplayMode)&&void 0!==t?t:(0,i.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,i.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,showLabels:e.showLabels,showDescriptions:e.showDescriptions,displayMode:e.displayMode,maxHeight:e.maxHeight},(0,p.getEnv)(e))}}))).actions((e=>({toggleShowLabels(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode(t){e.trackDisplayMode=t},setMaxHeight(t){e.trackMaxHeight=t}}))).views((e=>{const{trackMenuItems:t,renderProps:n}=e;return{renderProps(){const t=e.rendererConfig;return{...n(),config:t}},trackMenuItems:()=>[...t(),{label:"Show labels",icon:X.Z,type:"checkbox",checked:e.showLabels,onClick:()=>e.toggleShowLabels()},{label:"Show descriptions",icon:X.Z,type:"checkbox",checked:e.showDescriptions,onClick:()=>e.toggleShowDescriptions()},{label:"Display mode",icon:X.Z,subMenu:["compact","reducedRepresentation","normal","collapse"].map((t=>({label:t,onClick:()=>e.setDisplayMode(t)})))},{label:"Set max height",onClick:()=>{(0,a.getSession)(e).queueDialog((t=>[Y,{model:e,handleClose:t}]))}}]}}))};const K=e=>(0,i.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:(0,G.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});const $=e=>(0,i.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:(0,G.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});var ee=n(26783);class te extends r.Z{constructor(){super(...arguments),this.name="LinearGenomeViewPlugin",this.exports={BaseLinearDisplayComponent:B,BaseLinearDisplay:H,baseLinearDisplayConfigSchema:s,SearchBox:U.Rj,ZoomControls:U.FX,LinearGenomeView:U.I1},this.configurationSchema=(0,i.ConfigurationSchema)("LinearGenomeViewConfigSchema",{trackLabels:{type:"string",defaultValue:"overlapping",model:p.types.enumeration("trackLabelOptions",["offset","overlapping","hidden"])}})}install(e){var t;(t=e).addTrackType((()=>{const e=K(t);return new G.TrackType({name:"FeatureTrack",displayName:"Feature track",configSchema:e,stateModel:(0,G.createBaseTrackModel)(t,"FeatureTrack",e)})})),(e=>{e.addTrackType((()=>{const t=$(e);return new G.TrackType({name:"BasicTrack",configSchema:t,stateModel:(0,G.createBaseTrackModel)(e,"BasicTrack",t)})}))})(e),(e=>{e.addDisplayType((()=>{const t=J(e);return new G.DisplayType({name:"LinearBasicDisplay",displayName:"Basic feature display",configSchema:t,stateModel:Q(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:B})}))})(e),(0,U.ZP)(e),(e=>{e.addDisplayType((()=>{const t=q(e);return new G.DisplayType({name:"LinearBareDisplay",configSchema:t,displayName:"Bare feature display",stateModel:_(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:B})}))})(e),(e=>{e.addToExtensionPoint("LaunchView-LinearGenomeView",(async e=>{let{session:t,assembly:n,loc:r,tracks:o=[]}=e;try{const{assemblyManager:e}=t,i=t.addView("LinearGenomeView",{});if(await(0,a.when)((()=>!!i.volatileWidth)),!n)throw new Error("No assembly provided when launching linear genome view");if(!await e.waitForAssembly(n))throw new Error('Assembly "'.concat(n,'" not found when launching linear genome view'));await i.navToLocString(r,n);const s=[];if(o.forEach((e=>{try{i.showTrack(e)}catch(t){if(!"".concat(t).match("Could not resolve identifier"))throw t;s.push(e)}})),s.length)throw new Error("Could not resolve identifiers: ".concat(s.join(",")))}catch(i){throw t.notify("".concat(i),"error"),i}}))})(e)}configure(e){(0,a.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:o.Z,onClick:e=>{e.addView("LinearGenomeView",{})}})}}},59131:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(98303);const a={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};function o(e,t,n){if(!t||0===t.length)return["remark","no alternative alleles"];const a=new Set;let o=new Set;if(t.forEach((t=>{let[l,c]=i(e,t,n);l||([l,c]=function(e,t){const n=(0,r.I)(t);if(n)return["breakend",t];if(1===e.length&&1===t.length)return["SNV",s("SNV",e,t)];if("<INS>"===t)return["insertion",t];if("<DEL>"===t)return["deletion",t];if("<INV>"===t)return["inversion",t];if("<TRA>"===t)return["translocation",t];if(t.includes("<"))return["sv",t];if(e.length===t.length)return e.split("").reverse().join("")===t?["inversion",s("inversion",e,t)]:["substitution",s("substitution",e,t)];if(e.length<=t.length){const n=t.length-e.length,r=n.toLocaleString("en-US");return["insertion",n>5?r+"bp INS":s("insertion",e,t)]}if(e.length>t.length){const n=e.length-t.length,r=n.toLocaleString("en-US");return["deletion",n>5?r+"bp DEL":s("deletion",e,t)]}return["indel",s("indel",e,t)]}(e,t)),l&&c&&(a.add(l),o.add(c))})),o.size>1){const e=[...o],t=new Set(e.map((e=>{const t=e.split("->");return t[1]?t[0]:e})));o=new Set([...t].map((e=>e.trim())).map((t=>{const n=e.map((e=>e.split("->").map((e=>e.trim())))).map((e=>e[1]&&e[0]===t?e[1]:"")).filter((e=>!!e));return n.length?"".concat(t," -> ").concat(n.join(",")):t})))}return a.size?[[...a].join(","),[...o].join(",")]:[]}function i(e,t,n){if("string"===typeof t&&!t.startsWith("<"))return[];let r=a[t];if(!r&&n.getMetadata("ALT",t)&&(r="sequence_variant"),r)return[r,t];const o=t.split(":");return o.length>1?i(e,"<".concat(o.slice(0,-1).join(":"),">"),n):[]}function s(e,t,n){return"".concat(e," ").concat(t," -> ").concat(n)}class l{constructor(e){this.variant=void 0,this.parser=void 0,this.data=void 0,this._id=void 0,this.variant=e.variant,this.parser=e.parser,this.data=this.dataFromVariant(this.variant),this._id=e.id}get(e){var t;return"samples"===e?this.variant.SAMPLES:null!==(t=this.data[e])&&void 0!==t?t:this.variant[e]}set(){}parent(){}children(){}tags(){return[...Object.keys(this.data),...Object.keys(this.variant),"samples"]}id(){return this._id}dataFromVariant(e){const{REF:t,ALT:n,POS:r,CHROM:a,INFO:i,ID:s}=e,l=r-1,[c,d]=o(t,n,this.parser),u=null===n||void 0===n?void 0:n.some((e=>"<TRA>"===e));return{refName:a,start:l,end:(null===n||void 0===n?void 0:n.some((e=>e.includes("<"))))&&i.END&&!u?+i.END[0]:l+t.length,description:d,type:c,name:null===s||void 0===s?void 0:s.join(","),aliases:s&&s.length>1?e.ID.slice(1):void 0}}toJSON(){return{uniqueId:this._id,...this.variant,...this.data,samples:this.variant.SAMPLES}}}},43405:(e,t,n)=>{"use strict";n.d(t,{B:()=>B.Z,Z:()=>E});var r=n(31640),a=n(43800);const o=(0,a.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}}},{explicitlyTyped:!0});var i=n(31625);const s=(0,a.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,a.ConfigurationSchema)("VcfIndex",{indexType:{model:i.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0});var l=n(99512);var c=n(5889),d=n(88057),u=n(20592);const p=e=>(0,a.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:(0,u.createBaseTrackConfig)(e)});function h(e){let{features:t}=e;const n=["refName","start","name","REF","ALT","QUAL","FILTER"];return t.map((e=>"".concat(n.map((t=>e.get(t)||".")).join("\t"),"\t").concat(function(e){return Object.entries(e.get("INFO")).map((e=>{let[t,n]=e;return"".concat(t,"=").concat(n)})).join(";")}(e)))).join("\n")}var g=n(27032),f=n(88309),m=n(63048);const y=function(e){return(0,a.ConfigurationSchema)("ChordVariantDisplay",{renderer:i.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:f._U,explicitlyTyped:!0})};var b=n(90872);const v=e=>i.types.compose("ChordVariantDisplay",f.pL,i.types.model({type:i.types.literal("ChordVariantDisplay"),configuration:(0,a.ConfigurationReference)(e)})).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},renderProps(){const t=(0,b.getContainingView)(e);return{...(0,l.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:e.blockDefinitions,config:e.configuration.renderer,onChordClick:t=>e.onChordClick(t)}}})));var w=n(4592);function x(e){return i.types.compose("LinearVariantDisplay",(0,w.l0)(e),i.types.model({type:i.types.literal("LinearVariantDisplay"),configuration:(0,a.ConfigurationReference)(e)})).actions((e=>({async selectFeature(t){const n=(0,b.getSession)(e);if((0,b.isSessionModelWithWidgets)(n)){const{rpcManager:r}=n,o=(0,l.getRpcSessionId)(e),i=(0,b.getContainingTrack)(e),s=(0,b.getContainingView)(e),c=(0,a.getConf)(i,"adapter"),d=await r.call(o,"CoreGetMetadata",{adapterConfig:c});n.showWidget(n.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:s,track:i,descriptions:d}))}n.setSelection(t)}})))}const C=e=>{e.addDisplayType((()=>{const t=function(e){return(0,a.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:(0,w.RH)(e),explicitlyTyped:!0})}(e);return new m.Z({name:"LinearVariantDisplay",displayName:"Variant display",configSchema:t,stateModel:x(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:w.qb})}))};var S=n(25216);const k=(0,a.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});var T=n(41867),P=n(3762),M=n(98303),R=n(80838);function A(e,t){const n=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-n)/e.bpPerRadian+e.startRadians}const I=(0,P.observer)((function(e){var t;let{feature:n,blocksForRefs:r,radius:o,config:i,bezierRadius:s,selected:l,onClick:c}=e;const[d,u]=(0,T.useState)(!1),p=r[n.get("refName")];if(!p)return null;let h,g,f;n.get("INFO")?[h]=n.get("INFO").SVTYPE||[]:n.get("mate")&&(h="mate");const m=null===(t=n.get("ALT"))||void 0===t?void 0:t[0],y=m&&(0,M.I)(m);if(y){const e=y.MatePosition.split(":");g=+e[1],f=r[e[0]]}else if("<TRA>"===m){var v,w,x,C;const e=null===(v=n.get("INFO"))||void 0===v||null===(w=v.CHR2)||void 0===w?void 0:w[0],t=null===(x=n.get("INFO"))||void 0===x||null===(C=x.END)||void 0===C?void 0:C[0];g=parseInt(t,10),f=r[e]}else if("mate"===h){const e=n.get("mate"),t=e.refName;g=e.start,f=r[t]}if(f){const e=n.get("start"),t=A(p,e),r=A(f,g),h=(0,b.polarToCartesian)(o,t),m=(0,b.polarToCartesian)(o,r),y=(0,b.polarToCartesian)(s,(r+t)/2),v=l?(0,a.readConfObject)(i,"strokeColorSelected",{feature:n}):(0,a.readConfObject)(i,"strokeColor",{feature:n}),w=(0,a.readConfObject)(i,"strokeColorHover",{feature:n});return(0,R.jsx)("path",{"data-testid":"chord-".concat(n.id()),d:["M",...h,"Q",...y,...m].join(" "),stroke:d?w:v,strokeWidth:d?3:1,onClick:e=>{f&&p&&c(n,p.region,f.region,e)},onMouseOver:()=>{l||u(!0)},onMouseOut:()=>{l||u(!1)}})}return null})),N=(0,P.observer)((function(e){let{features:t,config:n,displayModel:r,blockDefinitions:a,radius:o,bezierRadius:i,displayModel:{selectedFeatureId:s},onChordClick:l}=e;const c=(0,T.useMemo)((()=>{const e={};for(const t of a){const n=t.region.elided?t.region.regions:[t.region];for(const r of n)e[r.refName]=t}return e}),[a]),d="chords-".concat("undefined"!==typeof jest?"test":r.id);return(0,R.jsxs)("g",{id:d,"data-testid":"structuralVariantChordRenderer",children:[(0,R.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          #".concat(d," > path {\n            cursor: crosshair;\n            fill: none;\n          }\n")}}),[...t.values()].map((e=>{const t=e.id(),r=String(s)===String(t);return(0,R.jsx)(I,{feature:e,config:n,radius:o,bezierRadius:i,blocksForRefs:c,selected:r,onClick:l},t)}))]})}));var L=n(25077),F=n(63211);const j=(0,a.ConfigurationSchema)("VariantFeatureWidget",{});function D(e){const t=(0,F.e$)(e);return i.types.compose(t,i.types.model("VariantFeatureWidget",{type:i.types.literal("VariantFeatureWidget"),descriptions:i.types.frozen()}))}var B=n(59131);class E extends g.Z{constructor(){super(...arguments),this.name="VariantsPlugin"}install(e){var t;(e=>{e.addAdapterType((()=>new r.Z({name:"VcfAdapter",displayName:"VCF adapter",configSchema:o,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(5904),n.e(7452)]).then(n.bind(n,77452)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new r.Z({name:"VcfTabixAdapter",displayName:"VCF tabix adapter",configSchema:s,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(4229),n.e(441),n.e(4146)]).then(n.bind(n,24146)).then((e=>e.default))})))})(e),(e=>{e.addWidgetType((()=>new L.Z({name:"VariantFeatureWidget",heading:"Feature details",configSchema:j,stateModel:D(e),ReactComponent:(0,T.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(4990)]).then(n.bind(n,17560))))})))})(e),(t=e).addTrackType((()=>{const e=p(t);return new c.Z({name:"VariantTrack",displayName:"Variant track",configSchema:e,stateModel:(0,d.createBaseTrackModel)(t,"VariantTrack",e).views((()=>({saveTrackFileFormatOptions:()=>({vcf:{name:"VCF",extension:"vcf",callback:h}})})))})})),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="VcfTabixAdapter",o=(0,l.getFileName)(t),i=n&&(0,l.getFileName)(n),s={type:a,vcfGzLocation:t,index:{location:n||(0,l.makeIndex)(t,".tbi"),indexType:(0,l.makeIndexType)(i,"CSI","TBI")}};return/\.vcf\.b?gz$/i.test(o)&&!r||r===a?s:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"VcfTabixAdapter"===t||"VcfAdapter"===t?"VariantTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="VcfAdapter",o=(0,l.getFileName)(t);return/\.vcf$/i.test(o)||r===a?{type:a,vcfLocation:t}:e(t,n,r)}))})(e),C(e),(e=>{e.addRendererType((()=>new S.Z({name:"StructuralVariantChordRenderer",displayName:"SV chord renderer",ReactComponent:N,configSchema:k,pluginManager:e})))})(e),(e=>{e.addDisplayType((()=>{const t=y(e),n=v(t);return new m.Z({name:"ChordVariantDisplay",displayName:"Chord variant display",configSchema:t,stateModel:n,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:f.lJ})}))})(e)}}},68549:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});n(41867);var r=n(3762),a=n(90872),o=n(43800),i=n(4592),s=n(93524),l=n(80838);const c=(0,r.observer)((e=>{const{model:t}=e,{stats:n,height:r,needsScalebar:c}=t,{trackLabels:d}=(0,a.getContainingView)(t),u=(0,a.getContainingTrack)(t),p="overlapping"===d?(0,a.measureText)((0,o.getConf)(u,"name"),12.8)+100:50;return(0,l.jsxs)("div",{children:[(0,l.jsx)(i.qb,{...e}),n&&c?(0,l.jsx)("svg",{style:{position:"absolute",top:0,left:p,pointerEvents:"none",height:r,width:50},children:(0,l.jsx)(s.Z,{model:t})}):null]})}))},42207:(e,t,n)=>{"use strict";n.d(t,{Xl:()=>me.default,u:()=>de,Aq:()=>l,Eh:()=>z,Rv:()=>k,ZP:()=>et,P$:()=>P,yZ:()=>T,LT:()=>fe});var r={};n.r(r),n.d(r,{YSCALEBAR_LABEL_OFFSET:()=>k,fillRectCtx:()=>L,getNiceDomain:()=>M,getOrigin:()=>P,getQuantitativeStats:()=>R,getScale:()=>T,quantitativeStatsAutorun:()=>A,round:()=>N,toP:()=>I});var a=n(27032),o=n(99512),i=n(90176),s=n(90872);class l extends i.default{constructor(){super(...arguments),this.supportsSVG=!0}async render(e){const t=await this.getFeatures(e),{height:n,regions:r,bpPerPx:a}=e,[o]=r,i=(o.end-o.start)/a,{reducedFeatures:l,...c}=await(0,s.renderToAbstractCanvas)(i,n,e,(n=>this.draw(n,{...e,features:t}))),d=await super.render({...e,...c,features:t,height:n,width:i});return{...d,...c,features:l?new Map(l.map((e=>[e.id(),e]))):d.features,height:n,width:i,containsNoTransferables:!0}}}var c=n(31640),d=n(43800);const u=(0,d.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"}},{explicitlyTyped:!0});var p=n(88057),h=n(5889);const g=function(e){return(0,d.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:(0,p.createBaseTrackConfig)(e)})};const f=e=>(0,d.ConfigurationSchema)("MultiQuantitativeTrack",{},{baseConfiguration:(0,p.createBaseTrackConfig)(e)});const m=(0,d.ConfigurationSchema)("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[],description:"array of subadapter JSON objects"},bigWigs:{type:"frozen",description:"array of bigwig filenames, alternative to the subadapters slot",defaultValue:[]}},{explicitlyTyped:!0});var y=n(31625);const b=(0,d.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:y.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0});const v=(0,d.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:b,explicitlyTyped:!0});var w=n(14085),x=n(69988),C=n(20784),S=n(85815);const k=5;function T(e){let t,{domain:n=[],range:r=[],scaleType:a,pivotValue:o,inverted:i}=e;const[s,l]=n;if(void 0===s||void 0===l)throw new Error("invalid domain");if("linear"===a)t=(0,w.Z)();else if("log"===a)t=(0,x.Z)(),t.base(2);else{if("quantize"!==a)throw new Error("undefined scaleType");t=(0,C.Z)()}t.domain(void 0!==o?[s,o,l]:[s,l]),t.nice();const[c,d]=r;if(void 0===c||void 0===d)throw new Error("invalid range");return t.range(i?r.slice().reverse():r),t}function P(e){return"log"===e?1:0}function M(e){let{scaleType:t,domain:n,bounds:r}=e;const[a,o]=r;let[i,s]=n;if("linear"===t&&(s<0&&(s=0),i>0&&(i=0)),"log"===t&&(0===i||i>1)&&(i=1),void 0===i||void 0===s)throw new Error("invalid domain supplied to stats function");void 0!==a&&a!==Number.MIN_VALUE&&(i=a),void 0!==o&&o!==Number.MAX_VALUE&&(s=o);const l=(e=>{if("linear"===e)return(0,w.Z)();if("log"===e){const e=(0,x.Z)();return e.base(2),e}if("quantize"===e)return(0,C.Z)();throw new Error("undefined scaleType ".concat(e))})(t);return l.domain([i,s]),l.nice(),l.domain()}async function R(e,t){const{rpcManager:n}=(0,s.getSession)(e),r=(0,d.getConf)(e,"numStdDev")||3,{adapterConfig:a,autoscaleType:i}=e,l=(0,o.getRpcSessionId)(e),c={sessionId:l,adapterConfig:a,statusCallback:t=>{(0,y.isAlive)(e)&&e.setMessage(t)},...t};if("global"===i||"globalsd"===i){const e=await n.call(l,"WiggleGetGlobalQuantitativeStats",c),{scoreMin:t,scoreMean:a,scoreStdDev:o}=e;return"globalsd"===i?{...e,scoreMin:t>=0?0:a-r*o,scoreMax:a+r*o}:e}if("local"===i||"localsd"===i){const{dynamicBlocks:t,bpPerPx:a}=(0,s.getContainingView)(e),o=await n.call(l,"WiggleGetMultiRegionQuantitativeStats",{...c,regions:t.contentBlocks.map((e=>{const{start:t,end:n}=e;return{...JSON.parse(JSON.stringify(e)),start:Math.floor(t),end:Math.ceil(n)}})),bpPerPx:a}),{scoreMin:d,scoreMean:u,scoreStdDev:p}=o;return"localsd"===i?{...o,scoreMin:d>=0?0:u-r*p,scoreMax:u+r*p}:o}if("zscale"===i)return n.call(l,"WiggleGetGlobalQuantitativeStats",c);throw new Error("invalid autoscaleType '".concat(i,"'"))}function A(e){(0,y.addDisposer)(e,(0,S.autorun)((async()=>{try{const t=new AbortController,n=(0,s.getContainingView)(e);if(e.setLoading(t),!n.initialized||!e.featureDensityStatsReady||e.regionTooLarge||e.error)return;const r=JSON.stringify(n.dynamicBlocks),a=await R(e,{signal:t.signal,...e.renderProps()});(0,y.isAlive)(e)&&e.updateQuantitativeStats(a,r)}catch(t){!(0,s.isAbortException)(t)&&(0,y.isAlive)(e)&&(console.error(t),e.setError(t))}}),{delay:1e3}))}function I(){return+(+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)).toPrecision(6)}function N(e){return Math.round(1e5*e)/1e5}function L(e,t,n,r,a,o){n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),o&&(a.fillStyle=o),a.fillRect(e,t,n,r)}function F(e,t){const{features:n,regions:r,bpPerPx:a,scaleOpts:o,height:i,config:l}=t,[c]=r,u=(0,d.readConfObject)(l,"bicolorPivot"),p=(0,d.readConfObject)(l,"bicolorPivotValue"),h=(0,d.readConfObject)(l,"negColor"),g=(0,d.readConfObject)(l,"posColor"),f=(0,d.readConfObject)(l,"color"),m=(0,d.readConfObject)(l,"clipColor"),y="none"!==u&&"log"!==o.scaleType,b=T({...o,pivotValue:y?p:void 0,range:y?[h,"white",g]:["white",g]}),v=T({...o,range:[0,i]}),w="#f0f"===f?(e,t)=>b(t):(e,t)=>(0,d.readConfObject)(l,"color",{feature:e,score:t}),[x,C]=v.domain();let S=-1/0,k=!1;const P=[];for(const d of n.values()){const[t,n]=(0,s.featureSpanPx)(d,c,a);Math.floor(t)!==Math.floor(S)&&(P.push(d),S=t);const r=d.get("score");k=k||r>C||r<x;const o=n-t+.3;e.fillStyle=w(d,r),e.fillRect(t,0,o,i)}if(e.save(),k){e.fillStyle=m;for(const t of n.values()){const[n,r]=(0,s.featureSpanPx)(t,c,a),i=r-n+.3,l=t.get("score");(l>C||l<x&&"log"!==o.scaleType)&&L(n,0,i,2,e)}}return e.restore(),{reducedFeatures:P}}class j extends l{async draw(e,t){return F(e,t)}}var D=n(3762),B=n(41867),E=n(35421),V=n(80838);const z=(0,D.observer)((function(e){const{regions:t,features:n,bpPerPx:r,width:a,height:o,onMouseLeave:i=(()=>{}),onMouseMove:s=(()=>{}),onFeatureClick:l=(()=>{})}=e,[c]=t,d=(0,B.useRef)(null);function u(e){let t=0;d.current&&(t=d.current.getBoundingClientRect().left);const o=e-t,i=c.reversed?a-o:o,s=c.start+r*i;let l;for(const a of n.values())if(s<=a.get("end")+r&&s>=a.get("start")){l=a;break}return l}return(0,V.jsx)("div",{ref:d,"data-testid":"wiggle-rendering-test",onMouseMove:e=>{var t;return s(e,null===(t=u(e.clientX))||void 0===t?void 0:t.id())},onClick:e=>{var t;return l(e,null===(t=u(e.clientX))||void 0===t?void 0:t.id())},onMouseLeave:e=>i(e),style:{overflow:"visible",position:"relative",height:o},children:(0,V.jsx)(E.PrerenderedCanvas,{...e})})}));var O=n(622);function Z(e,t){const n=e.toHsl(),r=n.l*(1+t);return(0,O.V)({...n,l:(0,s.clamp)(r,0,100)})}function W(e,t){const n=e.toHsl(),r=n.l*(1-t);return(0,O.V)({...n,l:(0,s.clamp)(r,0,100)})}const H=.3;function G(e,t){const{features:n,bpPerPx:r,regions:a,scaleOpts:o,height:i,config:l,ticks:c,displayCrossHatches:u,offset:p=0,colorCallback:h}=t,[g]=a,f=(g.end-g.start)/r,m=i-2*p,y=(0,d.readConfObject)(l,"filled"),b=(0,d.readConfObject)(l,"clipColor"),v=(0,d.readConfObject)(l,"summaryScoreMode"),w=(0,d.readConfObject)(l,"bicolorPivotValue"),x=(0,d.readConfObject)(l,"minSize"),C=T({...o,range:[0,m]}),S=P(o.scaleType),[k,M]=C.domain(),R=e=>(0,s.clamp)(m-(C(e)||0),0,m)+p,A=e=>y?(e=>R(S)-R(e))(e):Math.max(x,1);let I=!1,N=-1/0;const F=[],j=k<w&&M>w;if("whiskers"===v){let t,a;for(const o of n.values()){const[n,i]=(0,s.featureSpanPx)(o,g,r);if(o.get("summary")){const r=Math.max(i-n+H,x),s=o.get("maxScore"),l=h(o,s),c=j?l:l===t?a:a=Z((0,O.V)(l),.4).toHex();L(n,R(s),r,A(s),e,c),t=l}}a=void 0,t=void 0;for(const o of n.values()){const[n,i]=(0,s.featureSpanPx)(o,g,r),l=o.get("score"),c=o.get("maxScore"),d=o.get("minScore"),u=o.get("summary"),p=h(o,l),f=j&&u?p===t?a:a=(0,O.V)(h(o,c)).mix((0,O.V)(h(o,d))).toString():p,m=Math.max(i-n+H,x);Math.floor(n)!==Math.floor(N)&&(F.push(o),N=n),I=I||l<k||l>M,L(n,R(l),m,A(l),e,f),t=p}a=void 0,t=void 0;for(const o of n.values()){const[n,i]=(0,s.featureSpanPx)(o,g,r);if(o.get("summary")){const r=o.get("minScore"),s=h(o,r),l=Math.max(i-n+H,x),c=j?s:s===t?a:a=W((0,O.V)(s),.4).toHex();L(n,R(r),l,A(r),e,c),t=s}}}else for(const d of n.values()){const[t,n]=(0,s.featureSpanPx)(d,g,r);Math.floor(t)!==Math.floor(N)&&(F.push(d),N=t);const a=d.get("score"),o=h(d,a);I=I||a<k||a>M;const i=Math.max(n-t+H,x);if("max"===v){const n=d.get("summary")?d.get("maxScore"):a;L(t,R(n),i,A(n),e,o)}else if("min"===v){const n=d.get("summary")?d.get("minScore"):a;L(t,R(n),i,A(n),e,o)}else L(t,R(a),i,A(a),e,o)}if(e.save(),I){e.fillStyle=b;for(const t of n.values()){const[n,a]=(0,s.featureSpanPx)(t,g,r),l=a-n+H,c=t.get("score");c>M?L(n,p,l,2,e):c<k&&"log"!==o.scaleType&&L(n,i,l,2,e)}}return e.restore(),u&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",c.values.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(R(t))),e.lineTo(f,Math.round(R(t))),e.stroke()}))),{reducedFeatures:F}}class q extends l{async draw(e,t){const{features:n,config:r}=t,a=(0,d.readConfObject)(r,"bicolorPivotValue"),o=(0,d.readConfObject)(r,"negColor"),i=(0,d.readConfObject)(r,"posColor");return G(e,{...t,colorCallback:"#f0f"===(0,d.readConfObject)(r,"color")?(e,t)=>t<a?o:i:(e,t)=>(0,d.readConfObject)(r,"color",{feature:e}),offset:k,features:[...n.values()]})}}const _=(0,d.ConfigurationSchema)("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:y.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:b,explicitlyTyped:!0});const U=(0,d.ConfigurationSchema)("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:b,explicitlyTyped:!0});function J(e,t){const{features:n,regions:r,bpPerPx:a,scaleOpts:o,height:i,ticks:{values:l},displayCrossHatches:c,colorCallback:u,config:p,offset:h=0}=t,[g]=r,f=(g.end-g.start)/a,m=i-2*h,y=(0,d.readConfObject)(p,"clipColor"),b=T({...o,range:[0,m]}),[v,w]=b.domain(),x=e=>(0,s.clamp)(m-(b(e)||0),0,m)+h;let C,S=-1/0;const k=[];for(const d of n.values()){const[t,n]=(0,s.featureSpanPx)(d,g,a);Math.floor(t)!==Math.floor(S)&&(k.push(d),S=t);const r=d.get("score"),i=r<v,l=r>w,c=n-t+.3,p=u(d,r);e.beginPath(),e.strokeStyle=p;const f=void 0!==C?C:r;g.reversed?(e.moveTo(n,x(f)),e.lineTo(n,x(r)),e.lineTo(t,x(r))):(e.moveTo(t,x(f)),e.lineTo(t,x(r)),e.lineTo(n,x(r))),e.stroke(),C=r,l?(e.fillStyle=y,e.fillRect(t,h,c,2)):i&&"log"!==o.scaleType&&(e.fillStyle=y,e.fillRect(t,m-2,c,m))}return c&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",l.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(x(t))),e.lineTo(f,Math.round(x(t))),e.stroke()}))),{reducedFeatures:k}}class X extends l{async draw(e,t){return J(e,{...t,offset:k,colorCallback:()=>"grey"})}}var Y=n(63048),Q=n(4592);function K(){return(0,d.ConfigurationSchema)("MultiLinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:y.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:y.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:Q.fU,explicitlyTyped:!0})}var $=n(36896),ee=n(71939),te=n(17280),ne=n(14564),re=n(47192),ae=n(71579);const oe=(0,re.ZL)()((e=>({tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,ee.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat(N(1.4),"em"),maxWidth:300,wordWrap:"break-word"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:k,cursor:"default",position:"absolute",pointerEvents:"none"}}))),ie=(0,D.observer)((function(e){var t,n;let{model:r,height:a,clientMouseCoord:o,offsetMouseCoord:i,clientRect:s,TooltipContents:l,useClientY:c}=e;const d=(0,te.Z)(),{featureUnderMouse:u}=r,[p,h]=(0,B.useState)(0),[g,f]=(0,B.useState)(null),{classes:m}=oe(),y=(0,B.useMemo)((()=>({getBoundingClientRect:()=>{const e=o[0]+p/2+20,t=c?o[1]:(null===s||void 0===s?void 0:s.top)||0;return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON(){}}}})),[null===s||void 0===s?void 0:s.top,o,p,c]),{styles:b,attributes:v}=(0,ae.D)(y,g),w=null===d||void 0===d||null===(t=d.components)||void 0===t?void 0:t.MuiPopper;return u?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(ne.h,{container:null===w||void 0===w||null===(n=w.defaultProps)||void 0===n?void 0:n.container,children:(0,V.jsx)("div",{ref:f,className:m.tooltip,style:{...b.popper,zIndex:1e5},...v.popper,children:(0,V.jsx)(l,{ref:e=>h((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0),model:r,feature:u})})}),(0,V.jsx)("div",{className:m.hoverVertical,style:{left:i[0],height:a-2*k}})]}):null})),se=ie,le=e=>e.toLocaleString("en-US"),ce=B.forwardRef((function(e,t){let{feature:n}=e;const r=n.get("start"),a=n.get("end"),o=[n.get("refName"),r===a?le(r):"".concat(le(r),"..").concat(le(a))].filter((e=>!!e)).join(":");return void 0!==n.get("summary")?(0,V.jsxs)("div",{ref:t,children:[o,(0,V.jsx)("br",{}),"Max: ",I(n.get("maxScore")),(0,V.jsx)("br",{}),"Avg: ",I(n.get("score")),(0,V.jsx)("br",{}),"Min: ",I(n.get("minScore"))]}):(0,V.jsxs)("div",{ref:t,children:[o,(0,V.jsx)("br",{}),"".concat(I(n.get("score")))]})})),de=(0,D.observer)((function(e){return(0,V.jsx)(se,{TooltipContents:ce,...e})})),ue=(0,B.lazy)((()=>n.e(8300).then(n.bind(n,98300))));function pe(e){return y.types.compose(Q.fV,y.types.model({selectedRendering:y.types.optional(y.types.string,""),resolution:y.types.optional(y.types.number,1),fill:y.types.maybe(y.types.boolean),minSize:y.types.maybe(y.types.number),color:y.types.maybe(y.types.string),posColor:y.types.maybe(y.types.string),negColor:y.types.maybe(y.types.string),summaryScoreMode:y.types.maybe(y.types.string),rendererTypeNameState:y.types.maybe(y.types.string),scale:y.types.maybe(y.types.string),autoscale:y.types.maybe(y.types.string),displayCrossHatches:y.types.maybe(y.types.boolean),constraints:y.types.optional(y.types.model({max:y.types.maybe(y.types.number),min:y.types.maybe(y.types.number)}),{}),configuration:(0,d.ConfigurationReference)(e)})).volatile((()=>({message:void 0,stats:void 0,statsFetchInProgress:void 0}))).actions((e=>({updateQuantitativeStats(t){const{scoreMin:n,scoreMax:r}=t,a=1e-6;e.stats?(Math.abs(e.stats.scoreMax-r)>a||Math.abs(e.stats.scoreMin-n)>a)&&(e.stats={scoreMin:n,scoreMax:r}):e.stats={scoreMin:n,scoreMax:r}},setColor(t){e.color=t},setPosColor(t){e.posColor=t},setNegColor(t){e.negColor=t},setLoading(t){const{statsFetchInProgress:n}=e;void 0===n||n.signal.aborted||n.abort(),e.statsFetchInProgress=t},selectFeature(t){const n=(0,s.getSession)(e);(0,s.isSelectionContainer)(n)&&n.setSelection(t)},setResolution(t){e.resolution=t},setFill(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale(){e.scale="log"===e.scale?"linear":"log"},setScaleType(t){e.scale=t},setSummaryScoreMode(t){e.summaryScoreMode=t},setAutoscale(t){e.autoscale=t},setMaxScore(t){e.constraints.max=t},setRendererType(t){e.rendererTypeNameState=t},setMinScore(t){e.constraints.min=t},toggleCrossHatches(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches(t){e.displayCrossHatches=t}}))).views((e=>({get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){var t;return null!==(t=e.rendererTypeNameState)&&void 0!==t?t:(0,d.getConf)(e,"defaultRendering")},get filters(){},get scaleType(){var t;return null!==(t=e.scale)&&void 0!==t?t:(0,d.getConf)(e,"scaleType")},get maxScore(){var t;return null!==(t=e.constraints.max)&&void 0!==t?t:(0,d.getConf)(e,"maxScore")},get minScore(){var t;return null!==(t=e.constraints.min)&&void 0!==t?t:(0,d.getConf)(e,"minScore")}}))).views((e=>({get adapterCapabilities(){const t=e.adapterTypeName,{pluginManager:n}=(0,s.getEnv)(e);return n.getAdapterType(t).adapterCapabilities},get rendererConfig(){const{color:t,displayCrossHatches:n,fill:r,minSize:a,negColor:o,posColor:i,summaryScoreMode:l,scaleType:c,rendererTypeName:u}=e,p=(0,d.getConf)(e,["renderers",u])||{};return e.rendererType.configSchema.create({...p,...c?{scaleType:c}:{},...void 0!==r?{filled:r}:{},...void 0!==n?{displayCrossHatches:n}:{},...void 0!==l?{summaryScoreMode:l}:{},...void 0!==t?{color:t}:{},...void 0!==o?{negColor:o}:{},...void 0!==i?{posColor:i}:{},...void 0!==a?{minSize:a}:{}},(0,s.getEnv)(e))},get autoscaleType(){var t;return null!==(t=e.autoscale)&&void 0!==t?t:(0,d.getConf)(e,"autoscale")}}))).views((e=>{let t=[0,0];return{get domain(){const{stats:n,scaleType:r,minScore:a,maxScore:o}=e;if(!n)return;const i=M({domain:[n.scoreMin,n.scoreMax],bounds:[a,o],scaleType:r});return"log"===r&&i[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(i)&&(t=i),t)}}})).views((e=>({get filled(){const{fill:t,rendererConfig:n}=e;return null!==t&&void 0!==t?t:(0,d.readConfObject)(n,"filled")},get summaryScoreModeSetting(){const{summaryScoreMode:t,rendererConfig:n}=e;return null!==t&&void 0!==t?t:(0,d.readConfObject)(n,"summaryScoreMode")},get scaleOpts(){return{domain:e.domain,stats:e.stats,autoscaleType:e.autoscaleType,scaleType:e.scaleType,inverted:(0,d.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get displayCrossHatchesSetting(){const{displayCrossHatches:t,rendererConfig:n}=e;return null!==t&&void 0!==t?t:(0,d.readConfObject)(n,"displayCrossHatches")},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")}}))).views((e=>({scoreTrackMenuItems:()=>[...e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>e.setResolution(5*e.resolution)},{label:"Coarser resolution",onClick:()=>e.setResolution(e.resolution/5)}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((t=>({label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:()=>e.setSummaryScoreMode(t)})))}]:[],{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:()=>e.toggleLogScale()},{label:"Autoscale type",subMenu:[["local","Local"],...e.hasGlobalStats?[["global","Global"],["globalsd","Global \xb1 3\u03c3"]]:[],["localsd","Local \xb1 3\u03c3"]].map((t=>{let[n,r]=t;return{label:r,type:"radio",checked:e.autoscaleType===n,onClick:()=>e.setAutoscale(n)}}))},{label:"Set min/max score",onClick:()=>{(0,s.getSession)(e).queueDialog((t=>[ue,{model:e,handleClose:t}]))}}]}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),t()}}}))}const he=(0,B.lazy)((()=>n.e(2986).then(n.bind(n,32986)))),ge=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]);const fe=function(e,t){return y.types.compose("LinearWiggleDisplay",pe(t),y.types.model({type:y.types.literal("LinearWiggleDisplay")})).views((e=>({get TooltipComponent(){return de},get rendererTypeName(){const t=e.rendererTypeNameSimple,n=ge.get(t);if(!n)throw new Error("unknown renderer ".concat(t));return n}}))).views((e=>({get ticks(){const{scaleType:t,domain:n,height:r}=e,a=(0,d.getConf)(e,"minimalTicks"),o=(0,d.getConf)(e,"inverted");if(!n)return;const i=T({scaleType:t,domain:n,range:[r-k,k],inverted:o}),s=(0,$.axisPropsFromTickScale)(i,4);return r<100||a?{...s,values:n}:s}}))).views((e=>{const{renderProps:t}=e;return{renderProps(){const n=t(),{filters:r,ticks:a,height:o,resolution:i,scaleOpts:s}=e;return{...n,notReady:n.notReady||!e.stats,rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig,displayCrossHatches:e.displayCrossHatchesSetting,scaleOpts:s,resolution:i,height:o,ticks:a,filters:r}},get needsScalebar(){const{rendererTypeName:t}=e;return"XYPlotRenderer"===t||"LinePlotRenderer"===t},get fillSetting(){return e.filled?0:e.filled||1!==e.minSize?2:1}}})).views((e=>{const{trackMenuItems:t}=e,n=(0,d.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,n)=>({label:t,type:"radio",checked:e.fillSetting===n,onClick:()=>e.setFill(n)})))}]:[],...e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>e.toggleCrossHatches()}]:[],...n?[{label:"Renderer type",subMenu:["xyplot","density","line"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>e.setRendererType(t)})))}]:[],{label:"Set color",onClick:()=>{(0,s.getSession)(e).queueDialog((t=>[he,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){A(e)},async renderSvg(r){const{renderSvg:a}=await n.e(8240).then(n.bind(n,18240));return a(e,r,t)}}}))};var me=n(68549);const ye=e=>{e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return(0,d.ConfigurationSchema)("LinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:y.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,d.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:K(),explicitlyTyped:!0})}(e),r=fe(e,t);return new Y.Z({name:"LinearWiggleDisplay",displayName:"Wiggle display",configSchema:t,stateModel:r,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,B.lazy)((()=>Promise.resolve().then(n.bind(n,68549))))})}))};var be=n(34399),ve=n.n(be),we=n(39092);const xe=e=>e.toLocaleString("en-US"),Ce=B.forwardRef((function(e,t){let{model:n,feature:r}=e;const a=r.get("start"),o=r.get("end"),i=r.get("refName"),s=a===o?xe(a):"".concat(xe(a),"..").concat(xe(o)),l=r.get("sources"),c=r.get("source"),d=r.get("summary"),u=Object.fromEntries(n.sources.map((e=>[e.name,e])));return(0,V.jsxs)("div",{ref:t,children:[[i,s].filter((e=>!!e)).join(":"),(0,V.jsx)("br",{}),l?(0,V.jsxs)("table",{children:[(0,V.jsx)("thead",{children:(0,V.jsxs)("tr",{children:[(0,V.jsx)("th",{children:"color"}),(0,V.jsx)("th",{children:"source"}),(0,V.jsx)("th",{children:"score"})]})}),(0,V.jsx)("tbody",{children:Object.entries(l).map((e=>{var t;let[n,r]=e;return(0,V.jsxs)("tr",{children:[(0,V.jsx)("td",{style:{background:null===(t=u[n])||void 0===t?void 0:t.color},children:" "}),(0,V.jsx)("td",{children:n}),(0,V.jsx)("td",{children:I(r.score)})]},n)}))})]}):(0,V.jsxs)("span",{children:[c," ",d?"min:".concat(I(r.get("minScore"))," avg:").concat(I(r.get("score"))," max:").concat(I(r.get("maxScore"))):I(r.get("score"))]})]})})),Se=(0,D.observer)((e=>(0,V.jsx)(se,{useClientY:!0,TooltipContents:Ce,...e}))),ke=(0,B.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(3633),n.e(9810)]).then(n.bind(n,39810)))),Te=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]);const Pe=function(e,t){return y.types.compose("MultiLinearWiggleDisplay",pe(t),y.types.model({type:y.types.literal("MultiLinearWiggleDisplay"),layout:y.types.optional(y.types.frozen(),[])})).volatile((()=>({featureUnderMouseVolatile:void 0,sourcesVolatile:void 0}))).actions((e=>({setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSources(t){ve()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t}}))).views((e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return Se},get rendererTypeName(){const t=e.rendererTypeNameSimple,n=Te.get(t);if(!n)throw new Error("unknown renderer ".concat(t));return n}}))).views((e=>({get needsScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName},get needsFullHeightScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName},get isMultiRow(){return"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName||"MultiDensityRenderer"===e.rendererTypeName},get needsCustomLegend(){return"MultiDensityRenderer"===e.rendererTypeName},get canHaveFill(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName},get renderColorBoxes(){return!("MultiRowLineRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName)},get prefersOffset(){return this.isMultiRow},get sources(){var t;const n=Object.fromEntries((null===(t=e.sourcesVolatile)||void 0===t?void 0:t.map((e=>[e.name,e])))||[]),r=e.layout.length?e.layout:e.sourcesVolatile;return null===r||void 0===r?void 0:r.map((e=>({...n[e.name],...e}))).map(((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":we.set1[t]||"#000000".replaceAll("0",(()=>(~~(16*Math.random())).toString(16))))})))}}))).views((e=>({get rowHeight(){const{sources:t,height:n,isMultiRow:r}=e;return r?n/((null===t||void 0===t?void 0:t.length)||1):n},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return(0,d.getConf)(e,"minimalTicks")||this.rowHeightTooSmallForScalebar}}))).views((e=>({get ticks(){const{scaleType:t,domain:n,isMultiRow:r,rowHeight:a,useMinimalTicks:o}=e;if(!n)return;const i=r?0:k,s=(0,$.axisPropsFromTickScale)(T({scaleType:t,domain:n,range:[a-i,i],inverted:(0,d.getConf)(e,"inverted")}),4);return o?{...s,values:n}:s},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]}}))).views((e=>{const{renderProps:t}=e;return{renderProps(){const n=t(),{displayCrossHatches:r,filters:a,height:o,resolution:i,rpcDriverName:s,scaleOpts:l,stats:c,sources:d,ticks:u,rendererConfig:p}=e;return{...n,notReady:n.notReady||!d||!c,displayModel:e,config:p,displayCrossHatches:r,filters:a,height:o,resolution:i,rpcDriverName:s,scaleOpts:l,sources:d,ticks:u,onMouseMove:(t,n)=>e.setFeatureUnderMouse(n),onMouseLeave:()=>e.setFeatureUnderMouse(void 0)}},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:e.filled||1!==e.minSize?2:1}}})).views((e=>{const{trackMenuItems:t}=e,n=(0,d.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,n)=>({label:t,type:"radio",checked:e.fillSetting===n,onClick:()=>e.setFill(n)})))}]:[],...e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>e.toggleCrossHatches()}]:[],...n?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>e.setRendererType(t)})))}]:[],{label:"Edit colors/arrangement...",onClick:()=>{(0,s.getSession)(e).queueDialog((t=>[ke,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){A(e),(0,y.addDisposer)(e,(0,S.autorun)((async()=>{const{rpcManager:t}=(0,s.getSession)(e),{adapterConfig:n}=e,r=(0,o.getRpcSessionId)(e),a=await t.call(r,"MultiWiggleGetSources",{sessionId:r,adapterConfig:n});(0,y.isAlive)(e)&&e.setSources(a)})))},async renderSvg(r){const{renderSvg:a}=await n.e(2754).then(n.bind(n,22754));return a(e,r,t)}}}))},Me=e=>{e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("MultiXYPlotRenderer").configSchema,n=e.getRendererType("MultiDensityRenderer").configSchema,r=e.getRendererType("MultiRowXYPlotRenderer").configSchema,a=e.getRendererType("MultiLineRenderer").configSchema,o=e.getRendererType("MultiRowLineRenderer").configSchema;return(0,d.ConfigurationSchema)("MultiLinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:y.types.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:(0,d.ConfigurationSchema)("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:n,MultiRowXYPlotRenderer:r,MultiLineRenderer:a,MultiRowLineRenderer:o}),height:{type:"number",defaultValue:200}},{baseConfiguration:K(),explicitlyTyped:!0})}(e);return new Y.Z({name:"MultiLinearWiggleDisplay",displayName:"Multi-wiggle display",configSchema:t,stateModel:Pe(e,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,B.lazy)((()=>n.e(9443).then(n.bind(n,9443))))})}))},Re=(0,D.observer)((function(e){const{regions:t,features:n,bpPerPx:r,width:a,height:o,sources:i,onMouseLeave:l=(()=>{}),onMouseMove:c=(()=>{}),onFeatureClick:d=(()=>{}),displayModel:u}=e,[p]=t,h=(0,B.useRef)(null);function g(e,t){if(!h.current)return;const l=h.current.getBoundingClientRect(),c=e-l.left,d=t-l.top,g=i[Math.floor(d/o*i.length)];if(!g)return;const f=p.reversed?a-c:c,m=p.start+r*f;let y;if(u.isMultiRow){for(const a of n.values())if(a.get("source")===g.name&&m<=a.get("end")+r&&m>=a.get("start")){y=a;break}}else{const e=[];for(const t of n.values())m<=t.get("end")+r&&m>=t.get("start")&&e.push(t);if(e.length){const t=Math.floor(m);y=new s.SimpleFeature({uniqueId:"mouseoverfeat",sources:Object.fromEntries(e.map((e=>e.toJSON())).map((e=>{const{refName:t,start:n,end:r,source:a,...o}=e;return[a,o]}))),...p,start:t,end:t+1})}}return y}return(0,V.jsx)("div",{ref:h,onMouseMove:e=>{const{clientX:t,clientY:n}=e,r=g(t,n);c(e,r)},onClick:e=>{const{clientX:t,clientY:n}=e,r=g(t,n);d(e,r)},onMouseLeave:e=>l(e),style:{overflow:"visible",position:"relative",height:o},children:(0,V.jsx)(E.PrerenderedCanvas,{...e})})}));class Ae extends l{async draw(e,t){const{sources:n,features:r}=t,a=(0,s.groupBy)(r.values(),(e=>e.get("source")));let o=[];for(const i of n){const n=a[i.name]||[],{reducedFeatures:r}=G(e,{...t,features:n,offset:k,colorCallback:()=>i.color||"blue"});o=o.concat(r)}return{reducedFeatures:o}}}const Ie=(0,d.ConfigurationSchema)("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:y.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:b,explicitlyTyped:!0});class Ne extends l{async draw(e,t){const{bpPerPx:n,sources:r,regions:a,features:o}=t,[i]=a,l=(0,s.groupBy)(o.values(),(e=>e.get("source"))),c=t.height/r.length,d=(i.end-i.start)/n;let u=[];return e.save(),r.forEach((n=>{const{reducedFeatures:r}=G(e,{...t,features:l[n.name]||[],height:c,colorCallback:()=>n.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,c),e.lineTo(d,c),e.stroke(),e.translate(0,c),u=u.concat(r)})),e.restore(),{reducedFeatures:u}}}const Le=(0,d.ConfigurationSchema)("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:y.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:b,explicitlyTyped:!0});const Fe=(0,d.ConfigurationSchema)("MultiDensityRenderer",{},{baseConfiguration:b,explicitlyTyped:!0});class je extends l{async draw(e,t){const{bpPerPx:n,sources:r,regions:a,features:o}=t,[i]=a,l=(0,s.groupBy)(o.values(),(e=>e.get("source"))),c=t.height/r.length,d=(i.end-i.start)/n;let u=[];return e.save(),r.forEach((n=>{const r=l[n.name]||[],{reducedFeatures:a}=F(e,{...t,features:r,height:c});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,c),e.lineTo(d,c),e.stroke(),e.translate(0,c),u=u.concat(a)})),e.restore(),{reducedFeatures:u}}}class De extends l{async draw(e,t){const{sources:n,features:r}=t,a=(0,s.groupBy)(r.values(),(e=>e.get("source")));let o=[];return n.forEach((n=>{const{reducedFeatures:r}=J(e,{...t,features:a[n.name]||[],colorCallback:()=>n.color||"blue"});o=o.concat(r)})),{reducedFeatures:o}}}const Be=(0,d.ConfigurationSchema)("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:y.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:b,explicitlyTyped:!0});class Ee extends l{async draw(e,t){const{bpPerPx:n,sources:r,regions:a,features:o}=t,[i]=a,l=(0,s.groupBy)(o.values(),(e=>e.get("source"))),c=t.height/r.length,d=(i.end-i.start)/n;let u=[];return e.save(),r.forEach((n=>{const{reducedFeatures:r}=J(e,{...t,features:l[n.name]||[],height:c,colorCallback:()=>n.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,c),e.lineTo(d,c),e.stroke(),e.translate(0,c),u=u.concat(r)})),e.restore(),{reducedFeatures:u}}}const Ve=(0,d.ConfigurationSchema)("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:y.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:b,explicitlyTyped:!0}),ze=(0,B.lazy)((()=>n.e(7063).then(n.bind(n,17063))));function Oe(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",((e,t)=>{const{session:n}=t;return[...e,...(0,s.isSessionWithAddTracks)(n)?[{label:"Create multi-wiggle track",onClick:e=>{const t=e.selection,n=t.map((e=>(0,d.readConfObject)(e,"name")));(0,s.getSession)(e).queueDialog((r=>[ze,{tracks:t,onClose:(a,o)=>{a&&o&&function(r){const a=t.map((e=>(0,d.readConfObject)(e,"adapter"))).map(((e,t)=>({...e,source:n[t]}))),o=[...new Set(t.flatMap((e=>(0,d.readConfObject)(e,"assemblyNames"))))],i=+Date.now(),l="multitrack-".concat(i,"-sessionTrack"),c=(0,s.getSession)(e);(0,s.isSessionWithAddTracks)(c)&&(c.addTrackConf({type:"MultiQuantitativeTrack",trackId:l,name:r.name,assemblyNames:o,adapter:{type:"MultiWiggleAdapter",subadapters:a}}),e.view.showTrack(l))}(o),r()}}]))}}]:[]]}))}var Ze=n(20592),We=n(7229),He=n(49133),Ge=n(23801);const qe=(0,re.ZL)()((e=>({textbox:{width:"100%"},paper:{margin:e.spacing(),padding:e.spacing()},submit:{marginTop:25,marginBottom:100,display:"block"}})));function _e(e){let{model:t}=e;const{classes:n}=qe(),[r,a]=(0,B.useState)(""),[i,l]=(0,B.useState)("MultiWiggle".concat(+Date.now()));return(0,V.jsxs)(We.Z,{className:n.paper,children:[(0,V.jsxs)("ul",{children:[(0,V.jsx)("li",{children:"Enter list of URLs for bigwig files in the textbox"}),(0,V.jsx)("li",{children:"Or, use the button below the text box to select files from your computer"})]}),(0,V.jsx)(He.Z,{multiline:!0,rows:10,value:r,onChange:e=>a(e.target.value),placeholder:"Paste list of URLs here, or use file selector below",variant:"outlined",className:n.textbox}),(0,V.jsxs)(Ge.Z,{variant:"outlined",component:"label",children:["Choose Files from your computer",(0,V.jsx)("input",{type:"file",hidden:!0,multiple:!0,onChange:e=>{let{target:t}=e;const n=[...(null===t||void 0===t?void 0:t.files)||[]].map((e=>({type:"BigWigAdapter",bigWigLocation:s.isElectron?{localPath:e.path,locationType:"LocalPathLocation"}:(0,o.storeBlobLocation)({blob:e}),source:e.name})));a(JSON.stringify(n,null,2))}})]}),(0,V.jsx)(He.Z,{value:i,onChange:e=>l(e.target.value),helperText:"Track name"}),(0,V.jsx)(Ge.Z,{variant:"contained",className:n.submit,onClick:()=>{const e=(0,s.getSession)(t),n=["".concat(i.toLowerCase().replaceAll(" ","_"),"-").concat(Date.now()),"".concat(e.adminMode?"":"-sessionTrack")].join("");let a;try{a=JSON.parse(r)}catch(c){a=r.split(/\n|\r\n|\r/)}const o="string"===typeof a[0]?{bigWigs:a}:{subadapters:a};var l;(0,s.isSessionWithAddTracks)(e)&&(e.addTrackConf({trackId:n,type:"MultiQuantitativeTrack",name:i,assemblyNames:[t.assembly],adapter:{type:"MultiWiggleAdapter",...o}}),null===(l=t.view)||void 0===l||l.showTrack(n));t.clearData(),(0,s.isSessionModelWithWidgets)(e)&&e.hideWidget(t)},children:"Submit"}),(0,V.jsx)("p",{children:"Additional notes: "}),(0,V.jsxs)("ul",{children:[(0,V.jsxs)("li",{children:["The list of bigwig files in the text box can be a list of URLs, or a list of elements like"," ",(0,V.jsx)("code",{children:'[{"type":"BigWigAdapter","bigWigLocation":{"uri":"http://host/file.bw"}, "color":"green","source":"name for subtrack"}]'})," ","to apply e.g. the color attribute to the view"]}),(0,V.jsx)("li",{children:'Adding local files will update the textbox with JSON contents that are ready to submit with the "Submit" button'})]})]})}var Ue=n(83015),Je=n(15974),Xe=n(93912);class Ye extends Ue.Z{constructor(){super(...arguments),this.name="MultiWiggleGetSources"}async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new Je.Z({filters:e.filters}):void 0}}async serializeArguments(e,t){var n,r,a;const o=null===(n=this.pluginManager.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager;if(!o)return e;const i=await(0,s.renameRegionsIfNeeded)(o,{...e,filters:null===(a=e.filters)||void 0===a?void 0:a.toJSON().filters});return super.serializeArguments(i,t)}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:a,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,Xe.uP)(n,i,o);return s.getSources(a,r)}}var Qe=n(56798);class Ke extends Ue.Z{constructor(){super(...arguments),this.name="WiggleGetMultiRegionQuantitativeStats"}async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new Je.Z({filters:e.filters}):void 0}}async serializeArguments(e,t){var n,r,a;const o=null===(n=this.pluginManager.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager;if(!o)return e;const i=await(0,s.renameRegionsIfNeeded)(o,{...e,filters:null===(a=e.filters)||void 0===a?void 0:a.toJSON().filters});return super.serializeArguments(i,t)}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{regions:a,adapterConfig:o,sessionId:i}=r,{dataAdapter:s}=await(0,Xe.uP)(n,i,o);if(s instanceof Qe.BaseFeatureDataAdapter)return s.getMultiRegionQuantitativeStats(a,r);throw new Error("Data adapter not found")}}class $e extends Ue.Z{constructor(){super(...arguments),this.name="WiggleGetGlobalQuantitativeStats"}async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new Je.Z({filters:e.filters}):void 0}}async execute(e,t){const n=this.pluginManager,r=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:o}=r,{dataAdapter:i}=await(0,Xe.uP)(n,o,a);return i.getGlobalStats(r)}}class et extends a.Z{constructor(){super(...arguments),this.name="WigglePlugin",this.exports={LinearWiggleDisplayReactComponent:me.default,XYPlotRendererReactComponent:z,XYPlotRenderer:q,WiggleBaseRenderer:l,linearWiggleDisplayModelFactory:fe,xyPlotRendererConfigSchema:_,utils:r}}install(e){e.addAdapterType((()=>new c.Z({name:"MultiWiggleAdapter",displayName:"Multi-wiggle adapter",configSchema:m,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(8837).then(n.bind(n,88837)).then((e=>e.default))}))),(e=>{e.addAdapterType((()=>new c.Z({name:"BigWigAdapter",displayName:"BigWig adapter",configSchema:u,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>Promise.all([n.e(8385),n.e(3757)]).then(n.bind(n,23757)).then((e=>e.default))})))})(e),(e=>{e.addTrackType((()=>{const t=g(e);return new h.Z({name:"QuantitativeTrack",displayName:"Quantitative track",configSchema:t,stateModel:(0,p.createBaseTrackModel)(e,"QuantitativeTrack",t)})}))})(e),(e=>{e.addTrackType((()=>{const t=f(e);return new h.Z({name:"MultiQuantitativeTrack",displayName:"Multi-quantitative track",configSchema:t,stateModel:(0,p.createBaseTrackModel)(e,"MultiQuantitativeTrack",t)})}))})(e),ye(e),Me(e),(e=>{e.addRendererType((()=>new X({name:"LinePlotRenderer",ReactComponent:z,configSchema:U,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new q({name:"XYPlotRenderer",ReactComponent:z,configSchema:_,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new j({name:"DensityRenderer",ReactComponent:z,configSchema:v,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new Ae({name:"MultiXYPlotRenderer",ReactComponent:Re,configSchema:Ie,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new Ne({name:"MultiRowXYPlotRenderer",ReactComponent:Re,configSchema:Le,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new je({name:"MultiDensityRenderer",ReactComponent:Re,configSchema:Fe,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new De({name:"MultiLineRenderer",ReactComponent:Re,configSchema:Be,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new Ee({name:"MultiRowLineRenderer",ReactComponent:Re,configSchema:Ve,pluginManager:e})))})(e),(e=>{e.addAddTrackWorkflowType((()=>new Ze.AddTrackWorkflowType({name:"Multi-wiggle track",ReactComponent:_e,stateModel:y.types.model({})})))})(e),Oe(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="BigWigAdapter",i=(0,o.getFileName)(t),s={type:a,bigWigLocation:t};return/\.(bw|bigwig)$/i.test(i)&&!r||r===a?s:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BigWigAdapter"===t?"QuantitativeTrack":e(t))),e.addRpcMethod((()=>new $e(e))),e.addRpcMethod((()=>new Ke(e))),e.addRpcMethod((()=>new Ye(e)))}}},93524:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});n(41867);var r=n(17280),a=n(3762),o=n(36896),i=n(80838);const s=(0,a.observer)((function(e){let{model:t,orientation:n}=e;const{ticks:a}=t,s=(0,r.Z)();return a?(0,i.jsx)(o.Axis,{...a,shadow:2,format:e=>e,style:{orient:"left"===n?o.LEFT:o.RIGHT},bg:s.palette.background.default,fg:s.palette.text.primary}):null}))},41882:(e,t,n)=>{"use strict";n.d(t,{Z:()=>si});var r=n(45627),a=n(27032),o=n(99831),i=n(43800),s=n(88057);const l=(0,i.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},state:{description:"optional state for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint. can be 'token' or 'code'",type:"string",defaultValue:"code"}},{baseConfiguration:s.BaseInternetAccountConfig,explicitlyTyped:!0});var c=n(90872),d=n(31625);function u(e){return e.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}function p(e,t){try{var n;const r=JSON.parse(e);return"invalid_grant"===r.error&&t(),null!==(n=null===r||void 0===r?void 0:r.error_description)&&void 0!==n?n:e}catch(r){}return e}function h(e,t){return e.refresh_token&&t(e.refresh_token),e.access_token}async function g(e){let{response:t,reason:n,statusText:r}=e;return["HTTP ".concat(t.status),n,null!==r&&void 0!==r?r:await f(t)].filter((e=>!!e)).join(" - ")}async function f(e){try{return e.text()}catch(t){return e.statusText}}var m=n(35051).lW;const y=e=>s.InternetAccount.named("OAuthInternetAccount").props({type:d.types.literal("OAuthInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((()=>{let e;return{get codeVerifierPKCE(){if(e)return e;const t=new Uint8Array(32);return globalThis.crypto.getRandomValues(t),e=u(m.from(t).toString("base64")),e}}})).views((e=>({get authEndpoint(){return(0,i.getConf)(e,"authEndpoint")},get tokenEndpoint(){return(0,i.getConf)(e,"tokenEndpoint")},get needsPKCE(){return(0,i.getConf)(e,"needsPKCE")},get clientId(){return(0,i.getConf)(e,"clientId")},get scopes(){return(0,i.getConf)(e,"scopes")},state:()=>(0,i.getConf)(e,"state"),get responseType(){return(0,i.getConf)(e,"responseType")},get refreshTokenKey(){return"".concat(e.internetAccountId,"-refreshToken")}}))).actions((e=>({storeRefreshToken(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:()=>localStorage.getItem(e.refreshTokenKey),async exchangeAuthorizationForAccessToken(t,n){const r=new URLSearchParams(Object.entries({code:t,grant_type:"authorization_code",client_id:e.clientId,redirect_uri:n,...e.needsPKCE?{code_verifier:e.codeVerifierPKCE}:{}})),a=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});if(!a.ok)throw new Error(await g({response:a,reason:"Failed to obtain token"}));return h(await a.json(),(e=>this.storeRefreshToken(e)))},async exchangeRefreshForAccessToken(t){const n=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Object.entries({grant_type:"refresh_token",refresh_token:t,client_id:e.clientId})).toString()});if(!n.ok){e.removeToken();const t=await n.text();throw new Error(await g({response:n,statusText:p(t,(()=>this.removeRefreshToken()))}))}return h(await n.json(),(e=>this.storeRefreshToken(e)))}}))).actions((e=>{let t,r;return{addMessageChannel(e,n){t=t=>{this.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},async finishOAuthWindow(t,n,r){if(t.data.name!=="JBrowseAuthWindow-".concat(e.internetAccountId))return this.deleteMessageChannel();const a=t.data.redirectUri,o=a.replace("#","?"),i=new URL(o),s=i.search,l=new URLSearchParams(s);if(l.has("access_token")){const t=l.get("access_token");return t?(e.storeToken(t),n(t)):r(new Error("Error with token endpoint"))}if(l.has("code")){const t=l.get("code");if(!t)return r(new Error("Error with authorization endpoint"));try{const r=await e.exchangeAuthorizationForAccessToken(t,i.origin+i.pathname);return e.storeToken(r),n(r)}catch(c){return c instanceof Error?r(c):r(new Error(String(c)))}}return a.includes("access_denied")?r(new Error("OAuth flow was cancelled")):a.includes("error")?r(new Error("OAuth flow error: "+s)):void this.deleteMessageChannel()},async useEndpointForAuthorization(t,r){const a=c.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,o={client_id:e.clientId,redirect_uri:a,response_type:e.responseType||"code",token_access_type:"offline"};e.state()&&(o.state=e.state()),e.scopes&&(o.scope=e.scopes),e.needsPKCE&&(o.code_challenge=await async function(e){const t=await Promise.all([n.e(7626),n.e(9607)]).then(n.t.bind(n,87727,23)).then((e=>e.default));return u((await Promise.all([n.e(7626),n.e(1474)]).then(n.t.bind(n,39466,23))).stringify(t(e)))}(e.codeVerifierPKCE),o.code_challenge_method="S256");const i=new URLSearchParams(Object.entries(o)),s=new URL(e.authEndpoint);s.search=i.toString();const l="JBrowseAuthWindow-".concat(e.internetAccountId);if(c.isElectron){const{ipcRenderer:n}=window.require("electron"),a=await n.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:o,url:s.toString()}),i=new MessageEvent("message",{data:{name:l,redirectUri:a}});this.finishOAuthWindow(i,t,r)}else window.open(s,l,"width=500,height=600,left=0,top=0")},async getTokenFromUser(t,n){const r=e.retrieveRefreshToken();let a=!0;if(r)try{t(await e.exchangeRefreshForAccessToken(r)),a=!1}catch(o){console.error(o),e.removeRefreshToken()}a&&(this.addMessageChannel(t,n),this.useEndpointForAuthorization(t,n))},async validateToken(t,n){const a=e.addAuthHeaderToInit({method:"HEAD"},t),o=await fetch(n.uri,a);if(!o.ok){e.removeToken();const t=e.retrieveRefreshToken();if(t)try{r||(r=e.exchangeRefreshForAccessToken(t));const n=await r;return r=void 0,n}catch(i){console.error("Token could not be refreshed",i)}throw new Error(await g({response:o,reason:"Error validating token"}))}return t}}})).actions((e=>{const t=e.getFetcher;return{getFetcher(n){const r=t(n);return async(t,a)=>(n&&await e.validateToken(await e.getToken(n),n),r(t,a))}}}));const b=(0,i.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:s.BaseInternetAccountConfig,explicitlyTyped:!0});var v=n(41867),w=n(47409),x=n(49133),C=n(27768),S=n(23801),k=n(35421),T=n(80838);const P=e=>{let{internetAccountId:t,handleClose:n}=e;const[r,a]=(0,v.useState)("");return(0,T.jsxs)(k.Dialog,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",title:"Enter token for ".concat(t),children:[(0,T.jsx)(w.Z,{style:{display:"flex",flexDirection:"column"},children:(0,T.jsx)(x.Z,{required:!0,label:"Enter Token",variant:"outlined",inputProps:{"data-testid":"entry-externalToken"},onChange:e=>a(e.target.value),margin:"dense"})}),(0,T.jsxs)(C.Z,{children:[(0,T.jsx)(S.Z,{variant:"contained",color:"primary",type:"submit",disabled:!r,onClick:()=>{r&&n(r)},children:"Add"}),(0,T.jsx)(S.Z,{variant:"contained",color:"secondary",onClick:()=>n(),children:"Cancel"})]})]})},M=e=>s.InternetAccount.named("ExternalTokenInternetAccount").props({type:d.types.literal("ExternalTokenInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,i.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,n){const{session:r}=(0,d.getRoot)(e);r.queueDialog((r=>[P,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):n(new Error("user cancelled entry")),r()}}]))},async validateToken(t,n){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(n.uri,r);if(!a.ok){let e;try{e=await a.text()}catch(o){e=""}throw new Error("Token could not be validated \u2014 ".concat(a.status," (").concat(a.statusText,")").concat(e?" (".concat(e,")"):""))}return t}})));const R=(0,i.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:s.BaseInternetAccountConfig,explicitlyTyped:!0}),A=e=>{let{internetAccountId:t,handleClose:n}=e;const[r,a]=(0,v.useState)(""),[o,i]=(0,v.useState)("");return(0,T.jsx)(k.Dialog,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",title:"Log In for ".concat(t),children:(0,T.jsxs)("form",{onSubmit:e=>{r&&o?n(btoa("".concat(r,":").concat(o))):n(),e.preventDefault()},children:[(0,T.jsxs)(w.Z,{style:{display:"flex",flexDirection:"column"},children:[(0,T.jsx)(x.Z,{required:!0,label:"Username",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-username"},onChange:e=>a(e.target.value),margin:"dense"}),(0,T.jsx)(x.Z,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-password"},onChange:e=>i(e.target.value),margin:"dense"})]}),(0,T.jsxs)(C.Z,{children:[(0,T.jsx)(S.Z,{variant:"contained",color:"primary",type:"submit",children:"Submit"}),(0,T.jsx)(S.Z,{variant:"contained",color:"secondary",type:"submit",onClick:()=>n(),children:"Cancel"})]})]})})},I=e=>s.InternetAccount.named("HTTPBasicInternetAccount").props({type:d.types.literal("HTTPBasicInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,i.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,n){const{session:r}=(0,d.getRoot)(e);r.queueDialog((r=>[A,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):n(new Error("User cancelled entry")),r()}}]))},async validateToken(t,n){if(!e.validateWithHEAD)return t;const r=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(n.uri,r);if(!a.ok)throw new Error(await g({response:a,reason:"Error validating token"}));return t}})));const N=(0,i.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]}},{baseConfiguration:l,explicitlyTyped:!0}),L={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};async function F(e,t){let n="";try{const t=JSON.parse(await e.text()).error[".tag"];n=L[t]||t}catch(r){}return g({response:e,reason:t,statusText:n})}var j=n(77081);function D(e){return(0,T.jsx)(j.Z,{...e,children:(0,T.jsx)("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"})})}const B=e=>y(l).named("DropboxOAuthInternetAccount").props({type:d.types.literal("DropboxOAuthInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return(0,T.jsx)(D,{})},get selectorLabel(){return"Enter Dropbox share link"}}))).actions((e=>({getFetcher:t=>async(n,r)=>{const a=await e.getToken(t),o=e.addAuthHeaderToInit({...r,method:"POST"},a);o.headers.append("Dropbox-API-Arg",JSON.stringify({url:n}));const i=await fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",o);if(!i.ok)throw new Error(await F(i));return i},async validateToken(t,n){const r=await fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({url:n.uri})});if(!r.ok){const t=e.retrieveRefreshToken();if(t){e.removeRefreshToken();const r=await e.exchangeRefreshForAccessToken(t);return this.validateToken(r,n)}throw new Error(await F(r,"Token could not be validated"))}return t}})));const E=(0,i.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:l,explicitlyTyped:!0});async function V(e,t){let n="";try{n=JSON.parse(await e.text()).error.message}catch(r){}return g({response:e,reason:t,statusText:n})}var z=n(59062);class O extends z.RemoteFileWithRangeCache{constructor(e,t){super(e,t),this.statsPromise=void 0,this.statsPromise=this.fetch(e,{metadataOnly:!0}).then((e=>e.json()))}async fetch(e,t){return super.fetch(e,t)}async stat(){return this.statsPromise}}function Z(e){return(0,T.jsx)(j.Z,{...e,children:(0,T.jsx)("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"})})}function W(e){const t=e.match(/[-\w]{25,}/);return"https://www.googleapis.com/drive/v3/files/".concat(t)}function H(e){return y(l).named("GoogleDriveOAuthInternetAccount").props({type:d.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return(0,T.jsx)(Z,{})},get selectorLabel(){return"Enter Google Drive share link"}}))).actions((e=>({getFetcher:t=>async(n,r)=>{const a=new URL(W(String(n))),o=new URLSearchParams;null!==r&&void 0!==r&&r.metadataOnly?o.append("fields","size"):o.append("alt","media"),a.search=o.toString();const i=await e.getToken(t),s=await fetch(a,e.addAuthHeaderToInit({...r,method:"GET",credentials:"same-origin"},i));if(!s.ok)throw new Error(await V(s));return s},openLocation(e){return new O(e.uri,{fetch:this.getFetcher(e)})},async validateToken(e,t){const n=await fetch(W(t.uri),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/x-www-form-urlencoded"}});if(!n.ok)throw new Error(await V(n,"Token could not be validated"));return e}})))}class G extends a.Z{constructor(){super(...arguments),this.name="AuthenticationPlugin",this.exports={OAuthConfigSchema:l,OAuthInternetAccountModelFactory:y,ExternalTokenConfigSchema:b,ExternalTokenInternetAccountModelFactory:M,HTTPBasicConfigSchema:R,HTTPBasicInternetAccountModelFactory:I,DropboxOAuthConfigSchema:N,DropboxOAuthInternetAccountModelFactory:B,GoogleDriveOAuthConfigSchema:E,GoogleDriveOAuthInternetAccountModelFactory:H}}install(e){e.addInternetAccountType((()=>new o.Z({name:"OAuthInternetAccount",configSchema:l,stateModel:y(l)}))),e.addInternetAccountType((()=>new o.Z({name:"ExternalTokenInternetAccount",configSchema:b,stateModel:M(b)}))),e.addInternetAccountType((()=>new o.Z({name:"HTTPBasicInternetAccount",configSchema:R,stateModel:I(R)}))),e.addInternetAccountType((()=>new o.Z({name:"DropboxOAuthInternetAccount",configSchema:N,stateModel:B(N)}))),e.addInternetAccountType((()=>new o.Z({name:"GoogleDriveOAuthInternetAccount",configSchema:E,stateModel:H(E)})))}}var q=n(31640);const _=(0,i.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}}},{explicitlyTyped:!0});const U=(0,i.ConfigurationSchema)("BedpeAdapter",{bedpeLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedpe.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0});const J=(0,i.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("TabixIndex",{indexType:{model:d.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0});const X=(0,i.ConfigurationSchema)("BedAdapter",{bedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0});var Y=n(99512);class Q extends a.Z{constructor(){super(...arguments),this.name="BedPlugin"}install(e){(e=>{e.addAdapterType((()=>new q.Z({name:"BigBedAdapter",displayName:"BigBed adapter",configSchema:_,getAdapterClass:()=>Promise.all([n.e(2078),n.e(8385),n.e(8100)]).then(n.bind(n,38100)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"BedAdapter",displayName:"BED adapter",configSchema:X,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(5904),n.e(2078),n.e(5668)]).then(n.bind(n,15668)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"BedpeAdapter",displayName:"BEDPE adapter",configSchema:U,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(5904),n.e(8258)]).then(n.bind(n,78258)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"BedTabixAdapter",displayName:"BED tabix adapter",configSchema:J,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(4229),n.e(2078),n.e(441),n.e(2323)]).then(n.bind(n,82323)).then((e=>e.default))})))})(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="BigBedAdapter",o=(0,Y.getFileName)(t),i={type:a,bigBedLocation:t};return/\.(bb|bigbed)$/i.test(o)&&!r||r===a?i:e(t,n,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="BedpeAdapter",o=(0,Y.getFileName)(t);return/\.bedpe(\.gz)?$/i.test(o)||r===a?{type:a,bedpeLocation:t}:e(t,n,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="BedTabixAdapter",o=(0,Y.getFileName)(t),i=n&&(0,Y.getFileName)(n);return/\.bed\.b?gz$/i.test(o)||r===a?{type:a,bedGzLocation:t,index:{location:n||(0,Y.makeIndex)(t,".tbi"),indexType:(0,Y.makeIndexType)(i,"CSI","TBI")}}:e(t,n,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="BedAdapter",o=(0,Y.getFileName)(t);return/\.bed$/i.test(o)||r===a?{type:a,bedLocation:t}:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BedpeAdapter"===t?"VariantTrack":e(t)))}}var K=n(1502),$=n(20592);const ee=(0,i.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),te=d.types.model("BreakpointAlignmentsWidget",{id:K.ElementId,type:d.types.literal("BreakpointAlignmentsWidget"),featureData:d.types.frozen()}).actions((e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}})));var ne=n(59366),re=n(98303);class ae extends ne.Z{snapshotFromBreakendFeature(e,t){var n;const r=null===(n=e.get("ALT"))||void 0===n?void 0:n[0],a=r?(0,re.I)(r):void 0,o=e.get("start");let i;const{assemblyName:s}=t.displayedRegions[0],{assemblyManager:l}=(0,c.getSession)(t),d=l.get(s);if(!d)throw new Error("assembly ".concat(s," not found"));if(!d.regions)throw new Error("assembly ".concat(s," regions not loaded"));const u=d.getCanonicalRefName(e.get("refName")),p=d.regions.find((e=>e.refName===u));let h,g=0,f=0;if("<TRA>"===r){const t=e.get("INFO");i=t.END[0]-1,h=d.getCanonicalRefName(t.CHR2[0])}else if(null!==a&&void 0!==a&&a.MatePosition){const e=a.MatePosition.split(":");i=+e[1]-1,h=d.getCanonicalRefName(e[0]),"left"===a.Join&&(g=-1),"left"===a.MateDirection&&(f=-1)}else if(e.get("mate")){const t=e.get("mate");h=d.getCanonicalRefName(t.refName),i=t.start}if(!h)throw new Error("unable to resolve mate refName ".concat(h," in reference genome"));const m=d.regions.find((e=>e.refName===h));if(!p||!m)throw new Error("unable to find the refName for the top or bottom of the breakpoint view");const y=[{...p},{...p}],b=[{...m},{...m}];return y[0].end=o+g,y[1].start=o+g,b[0].end=i+f,b[1].start=i+f,{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:y,hideHeader:!0,bpPerPx:10,offsetPx:(p.start+e.get("start"))/10},{type:"LinearGenomeView",displayedRegions:b,hideHeader:!0,bpPerPx:10,offsetPx:(m.start+i)/10}],displayName:"".concat(e.get("name")||e.get("id")||"breakend"," split detail"),featureData:void 0}}}var oe=n(85815),ie=n(40753),se=n(10034),le=n(53709),ce=n(71416);const de=(0,v.lazy)((()=>n.e(8142).then(n.bind(n,48142))));function ue(e,t){var n,r;return null===(n=(r=e.displays[0]).searchFeatureByID)||void 0===n?void 0:n.call(r,t.id())}async function pe(e,t){const{views:n}=e,{rpcManager:r,assemblyManager:a}=(0,c.getSession)(e),o=e.views[0].assemblyNames[0];if(!await a.waitForAssembly(o))return;const s=t.configuration.trackId;return Promise.all(n.map((async e=>(await r.call(s,"CoreGetFeatures",{adapterConfig:(0,i.getConf)(t,["adapter"]),sessionId:s,regions:e.staticBlocks.contentBlocks})).flat())))}function he(e){return d.types.compose("BreakpointSplitView",s.BaseViewModel,d.types.model({type:d.types.literal("BreakpointSplitView"),height:d.types.optional(d.types.refinement("viewHeight",d.types.number,(e=>e>=40)),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:d.types.array(e.getViewType("LinearGenomeView").stateModel)})).volatile((()=>({width:800,matchedTrackFeatures:{}}))).views((e=>({async exportSvg(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderToSvg:r}=await n.e(6194).then(n.bind(n,76194)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,ie.saveAs)(o,t.filename||"image.svg")}}))).views((e=>({get matchedTracks(){return(0,ce.wf)((e=>e.configuration.trackId),...e.views.map((e=>e.tracks)))},getMatchedTracks:t=>e.views.map((e=>e.getTrack(t))).filter((e=>!!e)),hasTranslocations(e){return[...this.getTrackFeatures(e).values()].find((e=>"translocation"===e.get("type")))},getTrackFeatures(t){var n;return new Map(null===(n=e.matchedTrackFeatures[t])||void 0===n?void 0:n.flat().map((e=>[e.id(),e])))},getMatchedFeaturesInLayout(e,t){const n=this.getMatchedTracks(e);return t.map((e=>e.map((e=>{const t=n.findIndex((t=>ue(t,e)));return-1!==t?{feature:e,layout:ue(n[t],e),level:t}:void 0})).filter(c.notEmpty)))}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,d.onAction)(e,(t=>{let{name:n,path:r,args:a}=t;if(e.linkViews){["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(n)&&r&&this.onSubviewAction(n,r,a)}})))},onSubviewAction(t,n,r){e.views.forEach((e=>{(0,d.getPath)(e).endsWith(n)||e[t](null===r||void 0===r?void 0:r[0])}))},setWidth(t){e.width=t,e.views.forEach((e=>e.setWidth(t)))},removeView(t){e.views.remove(t)},closeView(){(0,d.getParent)(e,2).removeView(e)},toggleInteract(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews(){e.linkViews=!e.linkViews},setMatchedTrackFeatures(t){e.matchedTrackFeatures=t}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,oe.autorun)((async()=>{try{if(!e.views.every((e=>e.initialized)))return;e.setMatchedTrackFeatures(Object.fromEntries(await Promise.all(e.matchedTracks.map((async t=>[t.configuration.trackId,await pe(e,t)])))))}catch(t){console.error(t),(0,c.getSession)(e).notify("".concat(t),"error")}})))},menuItems:()=>[...e.views.map(((e,t)=>{var n;return[t,null===(n=e.menuItems)||void 0===n?void 0:n.call(e)]})).filter((e=>!!e[1])).map((e=>({label:"View ".concat(e[0]+1," Menu"),subMenu:e[1]}))),{label:"Show intra-view links",type:"checkbox",checked:e.showIntraviewLinks,onClick:()=>e.toggleIntraviewLinks()},{label:"Allow clicking alignment squiggles?",type:"checkbox",checked:e.interactToggled,onClick:()=>e.toggleInteract()},{label:"Link views",type:"checkbox",icon:le.Z,checked:e.linkViews,onClick:()=>{e.toggleLinkViews()}},{label:"Export SVG",icon:se.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[de,{model:e,handleClose:t}]))}}]})))}class ge extends a.Z{constructor(){super(...arguments),this.name="BreakpointSplitViewPlugin"}install(e){(e=>{e.addViewType((()=>new ae({name:"BreakpointSplitView",displayName:"Breakpoint split view",stateModel:he(e),ReactComponent:(0,v.lazy)((()=>n.e(5968).then(n.bind(n,95968))))})))})(e),(e=>{e.addWidgetType((()=>new $.WidgetType({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:ee,stateModel:te,ReactComponent:(0,v.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(7323)]).then(n.bind(n,86183))))})))})(e)}configure(){}}var fe=n(88309),me=n(93533);const ye=(0,i.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0});const be=(0,i.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0});const ve=(0,i.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0});const we=(0,i.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0});const xe=(0,i.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0});const Ce=(0,i.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0});class Se extends a.Z{constructor(){super(...arguments),this.name="ComparativeAdaptersPlugin"}install(e){(e=>{e.addAdapterType((()=>new q.Z({name:"PAFAdapter",displayName:"PAF adapter",configSchema:ye,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(8111)]).then(n.bind(n,98111)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"DeltaAdapter",displayName:"MUMmer delta adapter",configSchema:xe,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(7647)]).then(n.bind(n,77647)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"ChainAdapter",displayName:"Liftover chain adapter",configSchema:Ce,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(9572)]).then(n.bind(n,89572)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"MCScanAnchorsAdapter",displayName:"MCScan anchors adapter",configSchema:be,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(7736)]).then(n.bind(n,7736)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"MCScanSimpleAnchorsAdapter",displayName:"MCScan anchors.simple adapter",configSchema:ve,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(2053)]).then(n.bind(n,42053)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"MashMapAdapter",displayName:"MashMap adapter",configSchema:we,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(327)]).then(n.bind(n,50327)).then((e=>e.default))})))})(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="PAFAdapter",o=(0,Y.getFileName)(t);return/\.paf/i.test(o)||r===a?{type:a,pafLocation:t}:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"PAFAdapter"===t?"SyntenyTrack":e(t)))}}var ke=n(35354),Te=n(94051),Pe=n(77911),Me=n(24728),Re=n(39841),Ae=n(31996),Ie=n(33322);const Ne=Ae.Z.extend((e=>{const t=oe.observable.box(1);return{views:{get dynamicBlocks(){return(0,Ie.Z)(e,!1,!1)},get scaleFactor(){return t.get()},get maxBpPerPx(){return e.totalBp/(e.width-50)},get minBpPerPx(){return.02},get maxOffset(){return e.displayedRegionsTotalPx-.2*e.width},get minOffset(){return.8*-e.width}},actions:{setScaleFactor(e){t.set(e)},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(t-e.width/2)}}}})),Le=Ne.extend((e=>({views:{get width(){return(0,d.getParent)(e).viewWidth}}}))),Fe=Ne.extend((e=>({views:{get width(){return(0,d.getParent)(e).viewHeight}}})));var je=n(63008);const De=(0,v.lazy)((()=>n.e(3529).then(n.bind(n,63529)))),Be=(0,v.lazy)((()=>Promise.resolve().then(n.bind(n,31547)))),Ee=e=>(0,c.measureText)(e.slice(0,30)),Ve=(e,t)=>(0,c.max)([...e.filter((e=>!t.has(e.key))).map((e=>Ee(e.refName))),...e.filter((e=>!t.has(e.key))).map((e=>Ee(e.end.toLocaleString("en-us"))))]);function ze(e){return d.types.compose("DotplotView",Pe.Z,d.types.model({id:K.ElementId,type:d.types.literal("DotplotView"),height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:d.types.array(d.types.string),drawCigar:!0,hview:d.types.optional(Le,{}),vview:d.types.optional(Fe,{}),tracks:d.types.array(e.pluggableMstType("track","stateModel")),viewTrackConfigs:d.types.array(e.pluggableConfigSchemaType("track"))})).volatile((()=>({volatileWidth:void 0,volatileError:void 0,cursorMode:(0,c.localStorageGetItem)("dotplot-cursorMode")||"crosshair",showPanButtons:Boolean(JSON.parse((0,c.localStorageGetItem)("dotplot-showPanbuttons")||"true")),wheelMode:(0,c.localStorageGetItem)("dotplot-wheelMode")||"zoom",borderX:100,borderY:100}))).views((e=>({get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}))).views((e=>({get assemblyErrors(){const{assemblyManager:t}=(0,c.getSession)(e);return e.assemblyNames.map((e=>{var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,c.getSession)(e);return e.assemblyNames.every((e=>{var n,r;return null===(n=null===(r=t.get(e))||void 0===r?void 0:r.initialized)||void 0===n||n}))}}))).views((e=>({get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){const{hview:t}=e,{dynamicBlocks:n,staticBlocks:r,bpPerPx:a}=t;return n.contentBlocks.length>5?[]:(0,je.Cz)(r.contentBlocks,a)},get vticks(){const{vview:t}=e,{dynamicBlocks:n,staticBlocks:r,bpPerPx:a}=t;return n.contentBlocks.length>5?[]:(0,je.Cz)(r.contentBlocks,a)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps(){const t=(0,c.getSession)(e);return{...(0,Y.getParentRenderProps)(e),drawCigar:e.drawCigar,highResolutionScaling:(0,i.getConf)(t,"highResolutionScaling")}}}))).actions((t=>({setShowPanButtons(e){t.showPanButtons=e},setWheelMode(e){t.wheelMode=e},setCursorMode(e){t.cursorMode=e},setDrawCigar(e){t.drawCigar=e},clearView(){t.hview.setDisplayedRegions([]),t.vview.setDisplayedRegions([]),t.assemblyNames=(0,d.cast)([]),t.tracks.clear()},setBorderX(e){t.borderX=e},setBorderY(e){t.borderY=e},setWidth:e=>(t.volatileWidth=e,t.volatileWidth),setHeight:e=>(t.height=e,t.height),setError(e){t.volatileError=e},closeView(){(0,d.getParent)(t,2).removeView(t)},zoomOutButton(){t.hview.zoomOut(),t.vview.zoomOut()},zoomInButton(){t.hview.zoomIn(),t.vview.zoomIn()},activateTrackSelector(){if("hierarchical"===t.trackSelectorType){const e=(0,c.getSession)(t);if((0,c.isSessionModelWithWidgets)(e)){const n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},showTrack(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=e.pluggableConfigSchemaType("track"),o=(0,d.resolveIdentifier)(a,(0,d.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));const s=e.getViewType(t.type),l=o.displays.find((e=>s.displayTypes.find((t=>t.name===e.type))));if(!l)throw new Error("could not find a compatible display for view type ".concat(t.type));const c=i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:l.type,configuration:l}]});t.tracks.push(c)},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=(0,d.resolveIdentifier)(r,(0,d.getRoot)(t),n),o=t.tracks.filter((e=>e.configuration===a));return(0,oe.transaction)((()=>o.forEach((e=>t.tracks.remove(e))))),o.length},toggleTrack(e){this.hideTrack(e)||this.showTrack(e)},setAssemblyNames(e,n){t.assemblyNames=(0,d.cast)([e,n])},setViews(e){t.hview=(0,d.cast)(e[0]),t.vview=(0,d.cast)(e[1])},getCoords(e,n){const[r,a]=(0,c.minmax)(n[0],e[0]),[o,i]=(0,c.minmax)(n[1],e[1]);return Math.abs(a-r)>3&&Math.abs(i-o)>3?[t.hview.pxToBp(r),t.hview.pxToBp(a),t.vview.pxToBp(t.viewHeight-o),t.vview.pxToBp(t.viewHeight-i)]:void 0},zoomIn(e,n){const r=this.getCoords(e,n);if(r){const[e,n,a,o]=r;t.hview.moveTo(e,n),t.vview.moveTo(o,a)}},showAllRegions(){t.hview.zoomTo(t.hview.maxBpPerPx),t.vview.zoomTo(t.vview.maxBpPerPx),t.vview.center(),t.hview.center()},onDotplotView(e,n){const r=this.getCoords(e,n);if(r){const[e,n,a,o]=r,i=(0,c.getSession)(t),s=Ne.create({...(0,d.getSnapshot)(t.hview),minimumBlockWidth:0,interRegionPaddingWidth:0}),l=Ne.create({...(0,d.getSnapshot)(t.vview),minimumBlockWidth:0,interRegionPaddingWidth:0});s.setVolatileWidth(t.hview.width),l.setVolatileWidth(t.vview.width),s.moveTo(e,n),l.moveTo(o,a),s.zoomTo(s.bpPerPx/(t.width/t.hview.width),0),l.zoomTo(l.bpPerPx/(t.width/t.vview.width),0);const u=t.tracks.map((e=>e.configuration.displays.find((e=>"LinearSyntenyDisplay"===e.type)))).filter((e=>!!e)).map((e=>{const t=(0,d.getParent)(e,2);return{type:t.type,configuration:t,displays:[{type:e.type,configuration:e}]}})),{id:p,...h}=(0,d.getSnapshot)(s),{id:g,...f}=(0,d.getSnapshot)(l),m={type:"LinearSyntenyView",views:[{type:"LinearGenomeView",tracks:[],hideHeader:!0,...h},{type:"LinearGenomeView",tracks:[],hideHeader:!0,...f}],tracks:u};i.addView("LinearSyntenyView",m)}}}))).actions((e=>({async exportSvg(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{renderToSvg:r}=await n.e(1007).then(n.bind(n,41007)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,ie.saveAs)(o,t.filename||"image.svg")},beforeDestroy(){const t=(0,c.getSession)(e);for(const r in e.assemblyNames){var n;null===(n=t.removeTemporaryAssembly)||void 0===n||n.call(t,r)}},afterAttach(){(0,d.addDisposer)(e,(0,oe.autorun)((()=>{const{showPanButtons:t,wheelMode:n,cursorMode:r}=e;"undefined"!==typeof localStorage&&(localStorage.setItem("dotplot-showPanbuttons",(e=>JSON.stringify(e))(t)),localStorage.setItem("dotplot-cursorMode",r),localStorage.setItem("dotplot-wheelMode",n))}))),(0,d.addDisposer)(e,(0,oe.autorun)((()=>{const t=(0,c.getSession)(e);if(void 0===e.volatileWidth||!e.assembliesInitialized)return;if(e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0)return;const n=[e.hview,e.vview];(0,oe.transaction)((()=>{e.assemblyNames.forEach(((e,r)=>{const a=t.assemblyManager.get(e);n[r].setDisplayedRegions((null===a||void 0===a?void 0:a.regions)||[])})),e.showAllRegions()}))}),{delay:1e3})),(0,d.addDisposer)(e,(0,oe.autorun)((function(){if(void 0===e.volatileWidth)return;const{vview:t,hview:n,viewHeight:r,viewWidth:a}=e,o=t.dynamicBlocks.contentBlocks,i=n.dynamicBlocks.contentBlocks,s=n.offsetPx,l=t.offsetPx,c=(0,je.F$)(o,r,l),d=(0,je.F$)(i,a,s),u=Ve(i,d),p=Ve(o,c);e.setBorderY(Math.max(u+40,50)),e.setBorderX(Math.max(p+40,50))})))},squareView(){const{hview:t,vview:n}=e,r=(t.bpPerPx+n.bpPerPx)/2,a=t.pxToBp(t.width/2),o=n.pxToBp(n.width/2);t.setBpPerPx(r),t.centerAt(a.coord,a.refName,a.index),n.setBpPerPx(r),n.centerAt(o.coord,o.refName,o.index)},squareViewProportional(){const{hview:t,vview:n}=e,r=t.width/n.width,a=(t.bpPerPx+n.bpPerPx)/2,o=t.pxToBp(t.width/2),i=n.pxToBp(n.width/2);t.setBpPerPx(a/r),t.centerAt(o.coord,o.refName,o.index),n.setBpPerPx(a),n.centerAt(i.coord,i.refName,i.index)}}))).views((e=>({menuItems(){const t=(0,c.getSession)(e);return[{label:"Return to import form",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[Be,{model:e,handleClose:t}]))},icon:Re.Z},{label:"Square view - same bp per pixel",onClick:()=>e.squareView()},{label:"Rectangular view - same total bp",onClick:()=>e.squareView()},{label:"Show all regions",onClick:()=>e.showAllRegions()},{label:"Export SVG",icon:se.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[De,{model:e,handleClose:t}]))}},...(0,c.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:Me.GD}]:[]]},get error(){return e.volatileError||e.assemblyErrors}})))}var Oe=n(63048),Ze=n(47192),We=n(51590),He=n(3762);const Ge=(0,Ze.ZL)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, ".concat(t," 5px, ").concat(t," 10px)"),textAlign:"center"},blockMessage:{backgroundColor:t,padding:"10px"},blockError:{backgroundColor:t,padding:"10px",color:"red"}}}));function qe(){const[e,t]=(0,v.useState)(!1),{classes:n}=Ge();return(0,v.useEffect)((()=>{const e=setTimeout((()=>t(!0)),300);return()=>clearTimeout(e)}),[]),e?(0,T.jsx)("div",{className:n.loading,children:(0,T.jsx)(k.LoadingEllipses,{})}):null}function _e(e){let{messageText:t}=e;const{classes:n}=Ge();return(0,T.jsx)("div",{className:n.blockMessage,children:(0,T.jsx)(We.Z,{children:"".concat(t)})})}function Ue(e){let{error:t}=e;const{classes:n}=Ge();return(0,T.jsx)("div",{className:n.blockError,children:(0,T.jsx)(We.Z,{children:"".concat(t)})})}const Je=(0,He.observer)((function(e){let{model:t,style:n}=e;return t.error?(0,T.jsx)(Ue,{error:t.error,"data-testid":"reload_button"}):t.message?(0,T.jsx)(_e,{messageText:t.message}):t.filled?t.shouldDisplay?(0,T.jsx)("div",{style:n,children:t.reactElement}):null:(0,T.jsx)(qe,{})})),Xe=Je;var Ye=n(25217),Qe=n.n(Ye);function Ke(e){const{rpcManager:t}=(0,c.getSession)(e),{rendererType:n}=e,{adapterConfig:r}=e,a=(0,c.getContainingView)(e);if((0,i.readConfObject)(e.configuration),(0,d.getSnapshot)(a),a.initialized){const{viewWidth:o,viewHeight:i,borderSize:s,borderX:l,borderY:c}=a;return{rendererType:n,rpcManager:t,renderProps:{...e.renderProps(),view:Qe()((0,d.getSnapshot)(a)),width:o,height:i,borderSize:s,borderX:l,borderY:c,adapterConfig:r,rendererType:n.name,sessionId:(0,Y.getRpcSessionId)(e),timeout:1e6}}}}function $e(e){return d.types.compose("DotplotDisplay",s.BaseDisplay,d.types.model({type:d.types.literal("DotplotDisplay"),configuration:(0,i.ConfigurationReference)(e)}).volatile((()=>({warnings:[],renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:Xe})))).views((e=>({get shouldDisplay(){const{vview:t,hview:n}=(0,c.getContainingView)(e);return t.bpPerPx===e.data.bpPerPxY&&n.bpPerPx===e.data.bpPerPxX},get rendererTypeName(){return(0,i.getConf)(e,["renderer","type"])},renderProps:()=>({...(0,Y.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}))).views((e=>({async renderSvg(t){const n=Ke(e);if(!n)return null;const{rendererType:r,rpcManager:a,renderProps:o}=n,i=await r.renderInClient(a,{...o,exportSVG:t,theme:t.theme||o.theme}),{hview:s,vview:l}=(0,c.getContainingView)(e),d=-s.offsetPx+i.offsetX,u=-l.offsetPx+i.offsetY;return(0,T.jsx)("g",{transform:"translate(".concat(d," ").concat(-u,")"),children:(0,T.jsx)(c.ReactRendering,{rendering:i})})}}))).actions((e=>{let t;return{afterAttach(){(0,c.makeAbortableReaction)(e,(()=>Ke(e)),(e=>async function(e){if(!e)return;const{rendererType:t,rpcManager:n,renderProps:r}=e,{reactElement:a,...o}=await t.renderInClient(n,r);return{reactElement:a,data:o,renderingComponent:t.ReactComponent}}(e)),{name:"".concat(e.type," ").concat(e.id," rendering"),delay:500,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered(n){if(void 0===n)return;const{data:r,reactElement:a,renderingComponent:o}=n;e.warnings=r.warnings,e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=o,t=void 0},setError(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}const et=(0,He.observer)((function(e){const{model:t,children:n}=e,{offsetX:r=0,offsetY:a=0}=t.data||{},o=(0,c.getContainingView)(t),i=o.vview.offsetPx-a,s=-(o.hview.offsetPx-r);return(0,T.jsxs)("div",{style:{position:"relative"},children:[(0,T.jsx)(t.ReactComponent2,{...e,style:{position:"absolute",top:i,left:s}}),n]})})),tt=et,nt=e=>{e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("DotplotDisplay",{renderer:d.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(e);return new Oe.Z({name:"DotplotDisplay",displayName:"Dotplot display",configSchema:t,stateModel:$e(t),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:tt})}))};const rt=(0,He.observer)((function(e){return(0,T.jsx)(k.PrerenderedCanvas,{...e})}));var at=n(56726),ot=n(52398);const{parseCigar:it}=r.MismatchParser,st="fell outside of range due to CIGAR string",lt="(less than min coordinate of feature)",ct="(greater than max coordinate of feature)";function dt(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.beginPath(),e.arc(t,n,r/2,0,2*Math.PI),e.fill()}class ut extends ot.Z{constructor(){super(...arguments),this.supportsSVG=!0}async renameRegionsIfNeeded(e){var t,n;const r=null===(t=this.pluginManager.rootModel)||void 0===t||null===(n=t.session)||void 0===n?void 0:n.assemblyManager,{view:a,sessionId:o,adapterConfig:i}=e;async function s(e){if(!r)throw new Error("No assembly manager provided");return(await(0,c.renameRegionsIfNeeded)(r,{sessionId:o,adapterConfig:i,regions:e})).regions}return a.hview.displayedRegions=await s(a.hview.displayedRegions),a.vview.displayedRegions=await s(a.vview.displayedRegions),e}async drawDotplot(e,t){var n,r;const{config:a,views:o,height:s,drawCigar:l,theme:c}=t,u=(0,i.readConfObject)(a,"color"),p=(0,i.readConfObject)(a,"posColor"),h=(0,i.readConfObject)(a,"negColor"),g=(0,i.readConfObject)(a,"colorBy"),f=(0,i.readConfObject)(a,"lineWidth"),m=(0,i.readConfObject)(a,"thresholds"),y=(0,i.readConfObject)(a,"thresholdsPalette"),b=a.color.isCallback,[v,w]=o,x=null===(n=v.dynamicBlocks.contentBlocks[0])||void 0===n?void 0:n.offsetPx,C=null===(r=w.dynamicBlocks.contentBlocks[0])||void 0===r?void 0:r.offsetPx,S=[];e.lineWidth=f;const{bpPerPx:T}=v,{bpPerPx:P}=w;function M(e,t,n,r){const a=r.get("strand")||1;if(-1===a&&([n,t]=[t,n]),e<t-1){let e=r.get("start"),n=r.get("end");const o=r.get("refName");return-1===a&&([n,e]=[e,n]),S.push({message:"feature at (X ".concat(o,":").concat(e,"-").concat(n,") ").concat(st," ").concat(lt),effect:"clipped the feature"}),t}if(e>n+1){const e=r.get("strand")||1,t=1===e?r.get("start"):r.get("end"),a=1===e?r.get("end"):r.get("start"),o=r.get("refName");return S.push({message:"feature at (X ".concat(o,":").concat(t,"-").concat(a,") ").concat(st," ").concat(ct),effect:"clipped the feature"}),n}return e}function R(e,t,n,r){if(e<t-1){const e=r.get("mate"),{refName:n,start:a,end:o}=e;return S.push({message:"feature at (Y ".concat(n,":").concat(a,"-").concat(o,") ").concat(st," ").concat(lt),effect:"clipped the feature"}),t}if(e>n+1){const e=r.get("mate"),{refName:t,start:a,end:o}=e;return S.push({message:"feature at (Y ".concat(t,":").concat(a,"-").concat(o,") ").concat(st," ").concat(ct),effect:"clipped the feature"}),n}return e}const A={...(0,d.getSnapshot)(v),staticBlocks:v.staticBlocks,width:v.width},I={...(0,d.getSnapshot)(w),staticBlocks:w.staticBlocks,width:w.width},N=(0,k.createJBrowseTheme)(c);for(const d of v.features||[]){const t=d.get("strand")||1,n=1===t?d.get("start"):d.get("end"),r=1===t?d.get("end"):d.get("start"),o=d.get("refName"),c=d.get("mate"),v=c.refName;let w;if("identity"===g){const e=d.get("identity");for(let t=0;t<m.length;t++)if(e>+m[t]){w=y[t];break}}else"meanQueryIdentity"===g?w="hsl(".concat(200*d.get("meanScore"),",100%,40%)"):"mappingQuality"===g?w="hsl(".concat(d.get("mappingQual"),",100%,40%)"):"strand"===g?w=-1===t?h:p:"default"===g&&(w=b?(0,i.readConfObject)(a,"color",{feature:d}):"#f0f"===u?N.palette.text.primary:u);e.fillStyle=w,e.strokeStyle=w;const k=(0,at.R)({self:A,refName:o,coord:n}),L=(0,at.R)({self:A,refName:o,coord:r}),F=(0,at.R)({self:I,refName:v,coord:c.start}),j=(0,at.R)({self:I,refName:v,coord:c.end});if(void 0!==k&&void 0!==L&&void 0!==F&&void 0!==j){const n=k.offsetPx-x,r=L.offsetPx-x,a=F.offsetPx-C,o=j.offsetPx-C;if(Math.abs(n-r)<=4&&Math.abs(a-o)<=4)dt(e,n,s-a,f);else{let i=n,c=a;const u=d.get("CIGAR");if(l&&u){const l=it(u);e.beginPath(),e.moveTo(i,s-c);let p=i,h=i;for(let u=0;u<l.length;u+=2){const g=+l[u],f=l[u+1];"M"===f||"="===f||"X"===f?(i+=g/T*t,c+=g/P):"D"===f||"N"===f?i+=g/T*t:"I"===f&&(c+=g/P),i=M(i,n,r,d),c=R(c,a,o,d),(Math.abs(i-p)>.5||Math.abs(c-h)>.5)&&(e.lineTo(i,s-c),p=i,h=c)}e.stroke()}else e.beginPath(),e.moveTo(n,s-a),e.lineTo(r,s-o),e.stroke()}}else S.length<=5&&(void 0===k||void 0===L?S.push({message:"feature at (X ".concat(o,":").concat(n,"-").concat(r,") not plotted, fell outside of range"),effect:"feature not rendered"}):S.push({message:"feature at (Y ".concat(v,":").concat(c.start,"-").concat(c.end,") not plotted, fell outside of range"),effect:"feature not rendered"}))}return{warnings:S}}async render(e){var t,n;const{width:r,height:a,view:{hview:o,vview:i}}=e,s=[r,a],l=[o,i].map(((e,t)=>{const n=Ne.create(e);return n.setVolatileWidth(s[t]),n})),d=l[0],u=await this.getFeatures({...e,regions:d.dynamicBlocks.contentBlocks});d.setFeatures(u);const p=await(0,c.renderToAbstractCanvas)(r,a,e,(t=>this.drawDotplot(t,{...e,views:l})));return{...await super.render({...e,...p,height:a,width:r}),...p,height:a,width:r,offsetX:(null===(t=l[0].dynamicBlocks.blocks[0])||void 0===t?void 0:t.offsetPx)||0,offsetY:(null===(n=l[1].dynamicBlocks.blocks[0])||void 0===n?void 0:n.offsetPx)||0,bpPerPxX:l[0].bpPerPx,bpPerPxY:l[1].bpPerPx}}}const pt=(0,i.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"blue"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:d.types.enumeration("colorBy",["identity","meanQueryIdentity","mappingQuality","strand","default"]),description:'Color by options:<br/>\n<ul>\n  <li>"identity" - the identity of the particular hit, similar to D-GENIES, use the other config slots \'thresholds\' and \'thresholdsPalette\' to define colors for this setting</li>\n  <li>"meanQueryIdentity" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>"mappingQuality" - uses mapping quality from PAF, some adapters don\'t have this setting</li>\n  <li>"strand" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>"default" - uses the \'color\' config slot</li>\n</ul>',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0});var ht=n(83015);class gt extends ht.Z{constructor(){super(...arguments),this.name="ComparativeRender"}async renameRegionsIfNeeded(e,t){return t.renameRegionsIfNeeded(e)}getRenderer(e){return this.pluginManager.getRendererType(e)}async serializeArguments(e,t){const{rendererType:n}=e,r=this.getRenderer(n),a=await super.serializeArguments(e,t),o=await this.renameRegionsIfNeeded(a,r);return"MainThreadRpcDriver"===t?o:r.serializeArgsInClient(o)}async execute(e,t){let n=e;"MainThreadRpcDriver"!==t&&(n=await this.deserializeArguments(e,t));const{sessionId:r,rendererType:a,signal:o}=n;if(!r)throw new Error("must pass a unique session id");(0,c.checkAbortSignal)(o);const i=this.getRenderer(a);return"MainThreadRpcDriver"===t?i.render(n):i.renderInWorker(n)}async deserializeReturn(e,t,n){const r=await super.deserializeReturn(e,t,n);if("MainThreadRpcDriver"===n)return r;return this.getRenderer(t.rendererType).deserializeResultsInClient(r,t)}}var ft=n(36686);const{featurizeSA:mt,getClip:yt,getTag:bt,getLength:vt,getLengthSansClipping:wt}=r.MismatchParser;function xt(e){e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearPileupDisplay"===e.name){const{stateModel:t}=e,n=t.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const n=e.contextMenuFeature;return[...t(),...n?[{label:"Dotplot of read vs ref",icon:ft.Z,onClick:()=>function(e,t){const n=(0,c.getSession)(t);try{const r=e.get("CIGAR"),a=yt(r,1),o=e.get("flags"),s=e.get("strand"),l=e.get("name"),d="".concat(l,"_assembly_").concat(Date.now()),{parentTrack:u}=t,[p]=(0,i.getConf)(u,"assemblyNames"),h=[p,d],g="track-".concat(Date.now()),f="".concat(l,"_vs_").concat(p),m=bt(e,"SA")||"",y=mt(m,e.id(),s,l,!0),b=e.toJSON();b.strand=1,b.mate={refName:l,start:a,end:a+wt(r)};const v=vt(2048&o?y[0].CIGAR:r),w=[b,...y];w.sort(((e,t)=>e.clipPos-t.clipPos));const x=w.reduce(((e,t)=>e+t.end-t.start),0);n.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:x/800,displayedRegions:(0,c.gatherOverlaps)(w.map(((e,t)=>{const{start:n,end:r,refName:a}=e;return{start:n,end:r,refName:a,index:t,assemblyName:p}})))},vview:{offsetPx:0,bpPerPx:v/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:d,start:0,end:v,refName:l}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:h,adapter:{type:"FromConfigAdapter",features:w},trackId:g,name:f}],assemblyNames:h,tracks:[{configuration:g,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:"".concat(g,"-DotplotDisplay")}]}],displayName:"".concat(l," vs ").concat(p)})}catch(r){console.error(r),n.notify("".concat(r),"error")}}(n,e)}]:[]]}}}}));e.stateModel=n}return e}))}class Ct extends a.Z{constructor(){super(...arguments),this.name="DotplotPlugin"}install(e){!function(e){e.addViewType((()=>new ne.Z({name:"DotplotView",displayName:"Dotplot view",stateModel:ze(e),ReactComponent:(0,v.lazy)((()=>Promise.all([n.e(4429),n.e(1098)]).then(n.bind(n,41098))))})))}(e),nt(e),(e=>{e.addRendererType((()=>new ut({name:"DotplotRenderer",configSchema:pt,ReactComponent:rt,pluginManager:e})))})(e),function(e){e.addToExtensionPoint("LaunchView-DotplotView",(async e=>{let{session:t,views:n,tracks:r=[]}=e;try{const e=t.addView("DotplotView",{}),a=n.map((e=>e.assembly));(0,oe.transaction)((()=>{e.setViews([{bpPerPx:.1,offsetPx:0},{bpPerPx:.1,offsetPx:0}]),e.setAssemblyNames(a[0],a[1])}));const o=[];if(r.forEach((t=>function(e,t,n){try{e.showTrack(t)}catch(r){if(!"".concat(r).match("Could not resolve identifier"))throw r;n.push(t)}}(e,t,o))),o.length)throw new Error("Could not resolve identifiers: ".concat(o.join(",")))}catch(a){throw t.notify("".concat(a),"error"),a}}))}(e),xt(e),e.addRpcMethod((()=>new gt(e)))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:Te.Z,onClick:e=>{e.addView("DotplotView",{})}})}}const St=(0,i.ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}}},{explicitlyTyped:!0});class kt extends a.Z{constructor(){super(...arguments),this.name="GTFPlugin"}install(e){e.addAdapterType((()=>new q.Z({name:"GtfAdapter",displayName:"GTF adapter",configSchema:St,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(5904),n.e(5174),n.e(1243)]).then(n.bind(n,56936)).then((e=>e.default))}))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="GtfAdapter",o=(0,Y.getFileName)(t),i={type:a,gtfLocation:t};return/\.gtf(\.gz)?$/i.test(o)&&!r||r===a?i:e(t,n,r)}))}}const Tt=(0,i.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:d.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0});const Pt=(0,i.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Mt=class extends a.Z{constructor(){super(...arguments),this.name="GFF3Plugin"}install(e){(e=>{e.addAdapterType((()=>new $.AdapterType({name:"Gff3TabixAdapter",displayName:"GFF3 tabix adapter",configSchema:Tt,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(4229),n.e(5174),n.e(441),n.e(6922),n.e(4731)]).then(n.bind(n,67072)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new $.AdapterType({name:"Gff3Adapter",displayName:"GFF3 adapter",configSchema:Pt,getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(5904),n.e(5174),n.e(6922),n.e(8537)]).then(n.bind(n,58354)).then((e=>e.default))})))})(e),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="Gff3TabixAdapter",o=(0,Y.getFileName)(t),i=n&&(0,Y.getFileName)(n);return/\.gff3?\.b?gz$/i.test(o)||r===a?{type:a,bamLocation:t,gffGzLocation:t,index:{location:n||(0,Y.makeIndex)(t,".tbi"),indexType:(0,Y.makeIndexType)(i,"CSI","TBI")}}:e(t,n,r)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="Gff3Adapter",o=(0,Y.getFileName)(t),i={type:a,gffLocation:t};return/\.gff3?$/i.test(o)&&!r||r===a?i:e(t,n,r)}))})(e)}};var Rt=n(25077);n(86394);const At=d.types.model("Job",{name:d.types.string,statusMessage:d.types.maybe(d.types.string),progressPct:d.types.number}).volatile((()=>({cancelCallback(){}}))).actions((e=>({setCancelCallback(t){e.cancelCallback=t},setStatusMessage(t){e.statusMessage=t},setProgressPct(t){e.progressPct=t}})));const It=(0,i.ConfigurationSchema)("JobsListWidget",{}),Nt=class extends a.Z{constructor(){super(...arguments),this.name="JobsManagementPlugin"}install(e){e.addWidgetType((()=>new Rt.Z({name:"JobsListWidget",heading:"Jobs list",configSchema:It,stateModel:d.types.model("JobsListModel",{id:K.ElementId,type:d.types.literal("JobsListWidget"),jobs:d.types.array(At),finished:d.types.array(At),queued:d.types.array(At),aborted:d.types.array(At)}).actions((e=>({addJob(t){const{cancelCallback:n}=t,r=e.jobs.push(t),a=e.jobs[r-1];return a.setCancelCallback(n),a},removeJob(t){const n=e.jobs.findIndex((e=>e.name===t)),r=e.jobs[n];return e.jobs.splice(n,1),r},addFinishedJob:t=>(e.finished.push(t),e.finished),addQueuedJob:t=>(e.queued.push(t),e.finished),addAbortedJob:t=>(e.aborted.push(t),e.aborted),removeQueuedJob(t){const n=e.queued.findIndex((e=>e.name===t)),r=e.queued[n];return e.queued.splice(n,1),r},updateJobStatusMessage(t,n){const r=e.jobs.find((e=>e.name===t));if(!r)throw new Error("No job found with name ".concat(t));r.setStatusMessage(n)},updateJobProgressPct(t,n){const r=e.jobs.find((e=>e.name===t));if(!r)throw new Error("No job found with name ".concat(t));r.setProgressPct(n)}}))),ReactComponent:(0,v.lazy)((()=>Promise.resolve().then(n.bind(n,86394))))})))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Jobs list",icon:Me.ks,onClick:e=>{if((0,c.isSessionModelWithWidgets)(e)){const{widgets:t}=e;let n=t.get("JobsList");n||(n=e.addWidget("JobsListWidget","JobsList")),e.showWidget(n)}}})}};const Lt=(0,i.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0});var Ft=n(49368),jt=n(56798),Dt=n(45728),Bt=n(9231),Et=n.n(Bt),Vt=n(35051).lW;class zt{constructor(e){this.url=void 0,this.url=e.url.endsWith("/")?e.url:"".concat(e.url,"/")}async readMeta(){const e=await this.loadFile("meta.json"),{compress:t,track_names:n}=e;return{hashHexCharacters:Math.ceil(e.hash_bits/4),compress:t,tracks:n}}async getHashHexCharacters(){return(await this.readMeta()).hashHexCharacters}async getCompress(){return(await this.readMeta()).compress}async getTrackNames(){return(await this.readMeta()).tracks}async get(e){return(await this.getBucket(e))[e]}async getBucket(e){const t=this.hash(e),n=await this.hexToDirPath(t);return this.loadFile(n)}async loadFile(e){const t=await fetch("".concat(this.url).concat(e));if(!t.ok)throw new Error("HTTP ".concat(t.status," ").concat(t.statusText));return t.json()}async hexToDirPath(e){const t=await this.getHashHexCharacters();if(t){const n=await this.getCompress();for(;e.length<8;)e="0".concat(e);e=e.slice(8-t);const r=[];for(let t=0;t<e.length;t+=3)r.push(e.slice(t,t+3));return"".concat(r.join("/"),".json").concat(n?"z":"")}return""}hash(e){return Et()(Vt.from(e)).toString("hex").toLowerCase().replace("-","n")}}class Ot extends jt.BaseAdapter{constructor(e,t,n){super(e,t,n),this.httpMap=void 0,this.tracksNames=void 0;const r=(0,i.readConfObject)(e,"namesIndexLocation"),{baseUri:a,uri:o}=r;this.httpMap=new zt({url:a?new URL(o,a).href:o})}async loadIndexFile(e){return this.httpMap.getBucket(e)}async searchIndex(e){const{searchType:t,queryString:n}=e,r=this.tracksNames||await this.httpMap.getTrackNames(),a=n.toLowerCase(),o=await this.loadIndexFile(a);return o[a]?this.formatResults(o[a],r,t):[]}formatResults(e,t,n){return[..."exact"===n?[]:e.prefix.map((e=>new Dt.Z({label:"object"===typeof e?e.name:e,matchedAttribute:"name",matchedObject:{result:e}}))),...e.exact.map((e=>{const n=e[0],r=e[1],a=e[3],o=e[4],i=e[5],s="".concat(a||n,":").concat(o,"-").concat(i);return new Dt.Z({locString:s,label:n,matchedAttribute:"name",matchedObject:e,trackId:t[r]})}))].filter((e=>"too many matches"!==e.getLabel()))}freeResources(){}}const Zt=(0,i.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"});var Wt=n(66511);const Ht=(0,i.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:s.baseConnectionConfig});function Gt(e){return d.types.compose("JBrowse1Connection",(0,s.BaseConnectionModelFactory)(e),d.types.model({configuration:(0,i.ConfigurationReference)(Ht),type:d.types.literal("JBrowse1Connection")})).actions((e=>({async connect(){const t=(0,c.getSession)(e);try{var r;const a=(0,i.getConf)(e,"dataDirLocation"),{fetchJb1:o}=await n.e(3577).then(n.bind(n,83577)),{convertTrackConfig:s}=await n.e(9901).then(n.bind(n,9901)),l=await o(a),c=(0,i.getConf)(e,"assemblyNames")[0];if(!c)throw new Error("assembly name required for JBrowse 1 connection");const d=t.assemblies.find((e=>(0,i.readConfObject)(e,"name")===c));if(!d)throw new Error('Assembly "'.concat(c,'" not found'));const u=(0,i.readConfObject)(d,["sequence","adapter"]),p=null===(r=l.tracks)||void 0===r?void 0:r.map((e=>({...s(e,l.dataRoot||"",u),assemblyNames:[c]})));e.setTrackConfs(p)}catch(o){var a;console.error(o),t.notify('There was a problem connecting to the JBrowse 1 data directory "'.concat(e.name,'". Please make sure you have entered a valid location. The error that was thrown is: "').concat(o,'"'),"error"),null===(a=t.breakConnection)||void 0===a||a.call(t,e.configuration)}}})))}class qt extends a.Z{constructor(){super(...arguments),this.name="LegacyJBrowsePlugin"}install(e){(e=>{e.addAdapterType((()=>new $.AdapterType({name:"NCListAdapter",displayName:"NCList adapter",configSchema:Lt,getAdapterClass:()=>Promise.all([n.e(7355),n.e(7844)]).then(n.bind(n,5479)).then((e=>e.default))})))})(e),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="NCListAdapter",o=(0,Y.getFileName)(t);return/trackData.jsonz?$/i.test(o)||r===a?{type:a,rootUrlTemplate:t}:e(t,n,r)}))})(e),(e=>{e.addTextSearchAdapterType((()=>new Ft.Z({name:"JBrowse1TextSearchAdapter",configSchema:Zt,AdapterClass:Ot,description:"A JBrowse 1 text search adapter"})))})(e),(e=>{e.addConnectionType((()=>new Wt.Z({name:"JBrowse1Connection",configSchema:Ht,stateModel:Gt(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})))})(e)}}var _t=n(4592),Ut=n(15005);const Jt=function(e){return(0,i.ConfigurationSchema)("LinearComparativeDisplay",{},{explicitlyTyped:!0,explicitIdentifier:"displayId"})};function Xt(e){const{rpcManager:t}=(0,c.getSession)(e),n=e;(0,i.readConfObject)(e.configuration);const{adapterConfig:r}=e,a=(0,c.getContainingView)(e),o=(0,Y.getRpcSessionId)(e);return(0,d.getSnapshot)(a),a.initialized?{rpcManager:t,renderProps:{...n.renderProps(),view:a,adapterConfig:r,sessionId:o,timeout:1e6,self:e}}:void 0}async function Yt(e){if(!e)return;const{rpcManager:t,renderProps:n}=e,{adapterConfig:r}=n,a=n.view.views[0],o=await t.call("getFeats","CoreGetFeatures",{regions:a.staticBlocks.contentBlocks,sessionId:"getFeats",adapterConfig:r});return{features:(0,c.dedupe)(o,(e=>e.id()))}}const Qt=function(e){return d.types.compose("LinearComparativeDisplay",s.BaseDisplay,d.types.model({type:d.types.literal("LinearComparativeDisplay"),configuration:(0,i.ConfigurationReference)(e),height:100})).volatile((()=>({renderInProgress:void 0,features:void 0,message:void 0}))).views((e=>({renderProps:()=>({rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2})}))).actions((e=>{let t;return{setLoading(n){e.message=void 0,e.error=void 0,t=n},setMessage(n){t&&!t.signal.aborted&&t.abort(),e.message=n,e.error=void 0,t=void 0},setRendered(n){if(!n)return;const{features:r}=n,a=e.features||[],o=new Set(a.map((e=>e.id()))||[]),i=new Set((null===r||void 0===r?void 0:r.map((e=>e.id())))||[]);let s=!1,l=!1;for(const e of r)if(!o.has(e.id())){s=!0;break}for(const e of a)if(!i.has(e.id())){l=!0;break}e.message=void 0,e.error=void 0,t=void 0,(s||l||!e.features)&&(e.features=r)},setError(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.message=void 0,e.error=n,t=void 0}}})).actions((e=>({afterAttach(){(0,c.makeAbortableReaction)(e,Xt,Yt,{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)}})))},Kt=(0,v.lazy)((()=>Promise.resolve().then(n.bind(n,31547))));const $t=function(e){return d.types.compose("LinearComparativeView",Pe.Z,d.types.model({id:K.ElementId,type:d.types.literal("LinearComparativeView"),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,middleComparativeHeight:100,tracks:d.types.array(e.pluggableMstType("track","stateModel")),views:d.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:d.types.array(e.pluggableConfigSchemaType("track"))})).volatile((()=>({width:void 0}))).views((e=>({get highResolutionScaling(){return 2},get initialized(){return void 0!==e.width&&e.views.length>0&&e.views.every((e=>e.initialized))},get refNames(){return e.views.map((e=>[...new Set(e.staticBlocks.map((e=>e.refName)))]))},get assemblyNames(){return[...new Set(e.views.flatMap((e=>e.assemblyNames)))]}}))).actions((t=>({afterAttach(){(0,d.addDisposer)(t,(0,d.onAction)(t,(e=>{if(t.linkViews){const{name:t,path:n,args:r}=e;["horizontalScroll","zoomTo","setScaleFactor"].includes(t)&&n&&this.onSubviewAction(t,n,r)}})))},beforeDestroy(){const e=(0,c.getSession)(t);for(const r of t.assemblyNames){var n;null===(n=e.removeTemporaryAssembly)||void 0===n||n.call(e,r)}},onSubviewAction(e,n,r){t.views.forEach((t=>{(0,d.getPath)(t).endsWith(n)||t[e](null===r||void 0===r?void 0:r[0])}))},setWidth(e){t.width=e},setViews(e){t.views=(0,d.cast)(e)},removeView(e){t.views.remove(e)},closeView(){(0,d.getParent)(t,2).removeView(t)},setMiddleComparativeHeight:e=>(t.middleComparativeHeight=e,t.middleComparativeHeight),toggleLinkViews(){t.linkViews=!t.linkViews},activateTrackSelector(){if("hierarchical"!==t.trackSelectorType)throw new Error("invalid track selector type ".concat(t.trackSelectorType));{const e=(0,c.getSession)(t);if((0,c.isSessionModelWithWidgets)(e)){const n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}},toggleTrack(e){this.hideTrack(e)||this.showTrack(e)},showTrack(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=e.pluggableConfigSchemaType("track"),o=(0,d.resolveIdentifier)(a,(0,d.getRoot)(t),n);if(!o)throw new Error("track not found ".concat(n));const i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=o.displays.find((e=>l.has(e.type)));if(!c)throw new Error("could not find a compatible display for view type ".concat(t.type));t.tracks.push(i.stateModel.create({...r,type:o.type,configuration:o,displays:[{type:c.type,configuration:c}]}))},hideTrack(n){const r=e.pluggableConfigSchemaType("track"),a=(0,d.resolveIdentifier)(r,(0,d.getRoot)(t),n),o=t.tracks.filter((e=>e.configuration===a));return(0,oe.transaction)((()=>o.forEach((e=>t.tracks.remove(e))))),o.length},squareView(){const e=(0,c.avg)(t.views.map((e=>e.bpPerPx)));t.views.forEach((t=>{const n=t.pxToBp(t.width/2);t.setNewView(e,t.offsetPx),n.refName&&t.centerAt(n.coord,n.refName,n.index)}))},clearView(){t.views=(0,d.cast)([]),t.tracks=(0,d.cast)([])}}))).views((()=>({headerMenuItems:()=>[]}))).views((e=>({menuItems:()=>[...e.views.map(((e,t)=>{var n;return[t,null===(n=e.menuItems)||void 0===n?void 0:n.call(e)]})).filter((e=>!!e[1])).map((e=>({label:"View ".concat(e[0]+1," Menu"),subMenu:e[1]}))),{label:"Return to import form",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[Kt,{model:e,handleClose:t}]))},icon:Re.Z},{label:"Open track selector",onClick:e.activateTrackSelector,icon:Me.GD}],rubberBandMenuItems:()=>[{label:"Zoom to region(s)",onClick:()=>{e.views.forEach((e=>{const{leftOffset:t,rightOffset:n}=e;t&&n&&e.moveTo(t,n)}))}}]}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,oe.autorun)((()=>{e.width&&e.views.forEach((t=>t.setWidth(e.width)))})))}})))};const en=function(e){return(0,i.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:Jt(e),explicitlyTyped:!0})};const tn=function(e){return d.types.compose("LinearSyntenyDisplay",Qt(e),d.types.model({type:d.types.literal("LinearSyntenyDisplay"),configuration:(0,i.ConfigurationReference)(e)})).volatile((()=>({mainCanvas:null,clickMapCanvas:null,cigarClickMapCanvas:null,mouseoverCanvas:null,featPositions:[],mouseoverId:void 0,clickId:void 0,cigarMouseoverId:-1}))).actions((e=>({setFeatPositions(t){e.featPositions=t},setMainCanvasRef(t){e.mainCanvas=t},setClickMapCanvasRef(t){e.clickMapCanvas=t},setCigarClickMapCanvasRef(t){e.cigarClickMapCanvas=t},setMouseoverCanvasRef(t){e.mouseoverCanvas=t},setMouseoverId(t){e.mouseoverId=t},setCigarMouseoverId(t){e.cigarMouseoverId=t},setClickId(t){e.clickId=t}}))).views((e=>({get adapterConfig(){return{name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,i.getConf)(e,"assemblyNames"),...(0,i.getConf)(e.parentTrack,"adapter")}},get trackIds(){return(0,i.getConf)(e,"trackIds")},get numFeats(){return e.featPositions.length},get ready(){return this.numFeats>0},get featMap(){return Object.fromEntries(e.featPositions.map((e=>[e.f.id(),e])))}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(5828).then(n.bind(n,55828));t(e)}catch(t){console.error(t),e.setError(t)}})()}})))};const nn=function(e){return(0,i.ConfigurationSchema)("LGVSyntenyDisplay",{},{baseConfiguration:(0,r.Ct)(e),explicitlyTyped:!0})},rn=(0,v.lazy)((()=>n.e(9321).then(n.bind(n,59321))));const an=function(e){return d.types.compose("LGVSyntenyDisplay",(0,r.P1)(e),d.types.model({type:d.types.literal("LGVSyntenyDisplay"),configuration:(0,i.ConfigurationReference)(e)})).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const n=e.contextMenuFeature;return[...t(),...n?[{label:"Open synteny view for this position",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[rn,{model:e,handleClose:t,feature:n}]))}}]:[]]}}})).views((e=>{const{trackMenuItems:t,colorSchemeSubMenuItems:n}=e;return{trackMenuItems:()=>[...t(),{label:"Color scheme",subMenu:[...n()]}]}})).actions((e=>({afterCreate(){e.colorBy?e.setColorScheme({...e.colorBy}):e.setColorScheme({type:"strand"})}})))};var on=n(61583),sn=n(12966);function ln(e){return(0,T.jsx)(j.Z,{...e,children:(0,T.jsx)("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"})})}const cn=(0,v.lazy)((()=>n.e(555).then(n.bind(n,70555))));function dn(e){return d.types.compose("LinearSyntenyView",$t(e),d.types.model({type:d.types.literal("LinearSyntenyView"),drawCIGAR:!0,drawCurves:!1})).actions((e=>({toggleCurves(){e.drawCurves=!e.drawCurves},toggleCIGAR(){e.drawCIGAR=!e.drawCIGAR},showAllRegions(){(0,oe.transaction)((()=>{e.views.forEach((e=>e.showAllRegionsInAssembly()))}))}}))).actions((e=>({async exportSvg(t){const{renderToSvg:r}=await n.e(3378).then(n.bind(n,73378)),a=await r(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,ie.saveAs)(o,t.filename||"image.svg")}}))).views((e=>{const t=e.headerMenuItems,n=e.menuItems;return{headerMenuItems:()=>[...t(),{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:on.Z},{label:"Show all regions",onClick:e.showAllRegions,description:"Show entire genome assemblies",icon:sn.Z},{label:"Draw CIGAR",onClick:e.toggleCIGAR,checked:e.drawCIGAR,type:"checkbox",description:"Draws per-base CIGAR level alignments"},{label:"Link views",type:"checkbox",checked:e.linkViews,onClick:e.toggleLinkViews,icon:le.Z},{label:"Use curved lines",type:"checkbox",checked:e.drawCurves,onClick:e.toggleCurves,icon:ln},{label:"Export SVG",icon:se.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[cn,{model:e,handleClose:t}]))}}],menuItems:()=>[...n(),{label:"Export SVG",icon:se.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[cn,{model:e,handleClose:t}]))}}]}}))}function un(e,t,n){try{e.showTrack(t)}catch(r){if(!"".concat(r).match("Could not resolve identifier"))throw r;n.push(t)}}var pn=n(5889);const hn=e=>(0,i.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:(0,s.createBaseTrackConfig)(e)});const gn=(0,i.ConfigurationSchema)("SyntenyFeatureWidget",{}),fn=d.types.model("SyntenyFeatureWidget",{id:K.ElementId,type:d.types.literal("SyntenyFeatureWidget"),featureData:d.types.frozen()}).actions((e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}})));var mn=n(93764);const{featurizeSA:yn,getClip:bn,getLength:vn,getLengthSansClipping:wn,getTag:xn}=r.MismatchParser,Cn=(0,Ze.ZL)()({root:{width:300}});function Sn(e){let{track:t,feature:n,handleClose:r}=e;const{classes:a}=Cn(),[o,s]=(0,v.useState)("0"),[l,d]=(0,v.useState)(),[u,p]=(0,v.useState)(),h=+o;return(0,v.useEffect)((()=>{(async()=>{d(void 0);try{if(2048&n.get("flags")){const e=(xn(n,"SA")||"").split(";")[0],[r,a]=e.split(","),{rpcManager:o}=(0,c.getSession)(t),s=(0,i.getConf)(t,"adapter"),l=(0,Y.getRpcSessionId)(t),d=(await o.call(l,"CoreGetFeatures",{adapterConfig:s,sessionId:l,regions:[{refName:r,start:+a-1,end:+a}]})).find((e=>e.get("name")===n.get("name")&&!(2048&e.get("flags"))&&!(256&e.get("flags"))));if(!d)throw new Error("primary feature not found");p(d)}else p(n)}catch(e){console.error(e),d(e)}})()}),[n,t]),(0,T.jsxs)(k.Dialog,{open:!0,onClose:r,title:"Set window size",children:[(0,T.jsx)(w.Z,{children:l?(0,T.jsx)(We.Z,{color:"error",children:"".concat(l)}):u?(0,T.jsxs)("div",{className:a.root,children:[256&u.get("flags")?(0,T.jsx)(We.Z,{style:{color:"orange"},children:"Note: You selected a secondary alignment (which generally does not have SA tags or SEQ fields) so do a full reconstruction of the alignment"}):null,(0,T.jsx)(We.Z,{children:"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."}),(0,T.jsx)(x.Z,{value:h,onChange:e=>s(e.target.value),label:"Set window size"})]}):(0,T.jsxs)("div",{children:[(0,T.jsx)(We.Z,{children:"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."}),(0,T.jsx)(mn.Z,{})]})}),(0,T.jsxs)(C.Z,{children:[(0,T.jsx)(S.Z,{variant:"contained",color:"secondary",onClick:r,children:"Cancel"}),(0,T.jsx)(S.Z,{disabled:!u,variant:"contained",color:"primary",onClick:function(){try{var e;if(!u)return;const n=u,a=(0,c.getSession)(t),o=(0,c.getContainingView)(t),s=n.get("CIGAR"),l=n.get("flags"),d=n.get("strand"),p=xn(n,"SA")||"",g=n.get("name"),f=bn(s,1),m="".concat(g,"_assembly_").concat(Date.now()),[y]=(0,i.getConf)(t,"assemblyNames"),b=[y,m],v="track-".concat(Date.now()),w="".concat(g,"_vs_").concat(y),{assemblyManager:x}=a,C=x.get(y);if(!C)throw new Error("assembly not found");const S=yn(p,n.id(),d,g,!0),k=n.toJSON();k.clipPos=f,k.strand=1,k.mate={refName:g,start:f,end:f+wn(s)};const T=vn(2048&l?S[0].CIGAR:s),P=[k,...S];P.forEach(((e,t)=>{e.refName=(null===C||void 0===C?void 0:C.getCanonicalRefName(e.refName))||e.refName,e.syntenyId=t,e.mate.syntenyId=t,e.mate.uniqueId="".concat(e.uniqueId,"_mate")})),P.sort(((e,t)=>e.clipPos-t.clipPos));const M=n.get("seq"),R=[...P,...P.map((e=>e.mate))],A=2*h,I=P.reduce(((e,t)=>e+t.end-t.start+A),0),N="".concat(g,"_").concat(Date.now()),L=(0,i.getConf)(C,"sequence"),F=(0,c.gatherOverlaps)(P.map((e=>({...e,start:Math.max(0,e.start-h),end:e.end+h,assemblyName:y}))));null===(e=a.addTemporaryAssembly)||void 0===e||e.call(a,{name:"".concat(m),sequence:{type:"ReferenceSequenceTrack",name:"Read sequence",trackId:N,assemblyNames:[m],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:T,seq:M||"",refName:g,uniqueId:"".concat(Math.random())}]}}}),a.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:I/o.width,displayedRegions:F,tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",assemblyNames:[y],configuration:L.trackId,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(N,"-LinearReferenceSequenceDisplay")}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:T/o.width,displayedRegions:[{assemblyName:m,start:0,end:T,refName:g}],tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",configuration:N,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(N,"-LinearReferenceSequenceDisplay")}]}]}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:b,adapter:{type:"FromConfigAdapter",features:R},trackId:v,name:w}],tracks:[{configuration:v,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:"".concat(v,"-LinearSyntenyDisplay")}]}],displayName:"".concat(g," vs ").concat(y)}),r()}catch(n){console.error(n),d(n)}},children:"Submit"})]})]})}const kn=class extends a.Z{constructor(){super(...arguments),this.name="LinearComparativeViewPlugin"}install(e){(e=>{e.addViewType((()=>new ne.Z({name:"LinearComparativeView",displayName:"Linear comparative view",stateModel:$t(e),ReactComponent:(0,v.lazy)((()=>n.e(4535).then(n.bind(n,64535))))})))})(e),(e=>{e.addViewType((()=>new ne.Z({name:"LinearSyntenyView",displayName:"Linear synteny view",stateModel:dn(e),ReactComponent:(0,v.lazy)((()=>n.e(4594).then(n.bind(n,94594))))})))})(e),(e=>{e.addDisplayType((()=>{const t=Jt(e);return new Oe.Z({name:"LinearComparativeDisplay",configSchema:t,stateModel:Qt(t),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:()=>null})}))})(e),(e=>{e.addDisplayType((()=>{const t=en(e);return new Oe.Z({name:"LinearSyntenyDisplay",configSchema:t,stateModel:tn(t),trackType:"SyntenyTrack",viewType:"LinearSyntenyView",ReactComponent:(0,v.lazy)((()=>n.e(2286).then(n.bind(n,62286))))})}))})(e),(e=>{e.addDisplayType((()=>{const t=nn(e),n=an(t);return new Oe.Z({name:"LGVSyntenyDisplay",configSchema:t,stateModel:n,trackType:"SyntenyTrack",viewType:"LinearGenomeView",ReactComponent:_t.qb})}))})(e),function(e){e.addToExtensionPoint("LaunchView-LinearSyntenyView",(async e=>{let{session:t,views:n,tracks:r=[]}=e;try{const{assemblyManager:e}=t,a=t.addView("LinearSyntenyView",{});await(0,oe.when)((()=>!!a.width)),a.setViews(await Promise.all(n.map((async t=>{const n=await e.waitForAssembly(t.assembly);if(!n)throw new Error("Assembly ".concat(t.assembly," failed to load"));return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:n.regions}})))),await Promise.all(a.views.map((e=>(0,oe.when)((()=>e.initialized)))));const o=[];if(await Promise.all(n.map((async(e,t)=>{const n=a.views[t],{loc:r,tracks:i=[]}=e;await n.navToLocString(r),i.forEach((e=>un(n,e,o)))}))),r.forEach((e=>un(a,e,o))),o.length)throw new Error("Could not resolve identifiers: ".concat(o.join(",")))}catch(a){throw t.notify("".concat(a),"error"),a}}))}(e),function(e){e.addTrackType((()=>{const t=hn(e);return new pn.Z({name:"SyntenyTrack",configSchema:t,stateModel:(0,s.createBaseTrackModel)(e,"SyntenyTrack",t)})}))}(e),(e=>{e.addWidgetType((()=>new Rt.Z({name:"SyntenyFeatureWidget",heading:"Synteny feature details",configSchema:gn,stateModel:fn,ReactComponent:(0,v.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(5354),n.e(3437),n.e(4047),n.e(2838)]).then(n.bind(n,21846))))})))})(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>("LinearPileupDisplay"!==e.name||(e.stateModel=e.stateModel.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const n=e.contextMenuFeature,r=(0,c.getContainingTrack)(e);return[...t(),...n?[{label:"Linear read vs ref",icon:ft.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((e=>[Sn,{track:r,feature:n,handleClose:e}]))}}]:[]]}}}}))),e)))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:Ut.Z,onClick:e=>{e.addView("LinearSyntenyView",{})}})}};function Tn(e){return d.types.compose("LinearLollipopDisplay",_t.fV,d.types.model({type:d.types.literal("LinearLollipopDisplay"),configuration:(0,i.ConfigurationReference)(e)})).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}}))}var Pn=n(71472);function Mn(e){let{feature:t,config:n,layoutRecord:{y:r,data:{anchorX:a,radiusPx:o,score:s}}}=e;const l=(0,i.readConfObject)(n,"innerColor",{feature:t}),c=String(s),d=1.1*(2*o/c.length);return d<12?null:(0,T.jsx)("text",{style:{fontSize:d,fill:(0,Pn.contrastingTextColor)(l)},x:a,y:r+o-d/2.4,textAnchor:"middle",dominantBaseline:"hanging",children:c})}const Rn=(0,He.observer)((function(e){const{feature:t,config:n,layoutRecord:r,selectedFeatureId:a}=e,{anchorLocation:o,y:s,data:{radiusPx:l}}=r,c=t=>{const{onFeatureMouseDown:n,feature:r}=e;return null===n||void 0===n?void 0:n(t,r.id())},d=t=>{const{onFeatureMouseEnter:n,feature:r}=e;return null===n||void 0===n?void 0:n(t,r.id())},u=t=>{const{onFeatureMouseOut:n,feature:r}=e;return null===n||void 0===n?void 0:n(t,r.id())},p=t=>{const{onFeatureMouseOver:n,feature:r}=e;return null===n||void 0===n?void 0:n(t,r.id())},h=t=>{const{onFeatureMouseUp:n,feature:r}=e;return null===n||void 0===n?void 0:n(t,r.id())},g=t=>{const{onFeatureMouseLeave:n,feature:r}=e;return null===n||void 0===n?void 0:n(t,r.id())},f=t=>{const{onFeatureMouseMove:n,feature:r}=e;return null===n||void 0===n?void 0:n(t,r.id())},m=t=>{const{onFeatureClick:n,feature:r}=e;return t.stopPropagation(),null===n||void 0===n?void 0:n(t,r.id())},y={fill:(0,i.readConfObject)(n,"strokeColor",{feature:t})};String(a)===String(t.id())&&(y.fill="red");const b={fill:(0,i.readConfObject)(n,"innerColor",{feature:t})},v=(0,i.readConfObject)(n,"strokeWidth",{feature:t});return(0,T.jsxs)("g",{"data-testid":t.id(),children:[(0,T.jsx)("title",{children:(0,i.readConfObject)(n,"caption",{feature:t})}),(0,T.jsx)("circle",{cx:o,cy:s+l,r:l,style:y,onMouseDown:c,onMouseEnter:d,onMouseOut:u,onMouseOver:p,onMouseUp:h,onMouseLeave:g,onMouseMove:f,onClick:m,onFocus:p,onBlur:u}),l-v<=2?null:(0,T.jsx)("circle",{cx:o,cy:s+l,r:l-v,style:b,onMouseDown:c,onMouseEnter:d,onMouseOut:u,onMouseOver:p,onMouseUp:h,onMouseLeave:g,onMouseMove:f,onClick:m,onFocus:p,onBlur:u}),(0,T.jsx)(Mn,{feature:t,config:n,layoutRecord:r})]})})),An=(0,He.observer)((function(e){let{feature:t,config:n,layoutRecord:{anchorLocation:r,y:a,data:{radiusPx:o}}}=e;return(0,T.jsx)("line",{x1:r,y1:0,x2:r,y2:a+2*o,stroke:(0,i.readConfObject)(n,"stickColor",{feature:t}),strokeWidth:(0,i.readConfObject)(n,"stickWidth",{feature:t})})}));function In(e){const{feature:t,bpPerPx:n,config:r,region:a,layout:o}=e,s=Math.abs(t.get("end")+t.get("start"))/2,l=(0,c.bpToPx)(s,a,n),d=(0,i.readConfObject)(r,"radius",{feature:t});d||console.error(new Error("lollipop radius ".concat(d," configured for feature ").concat(t.id()))),o.add(t.id(),l,2*d,2*d,{featureId:t.id(),anchorX:l,radiusPx:d,score:(0,i.readConfObject)(e.config,"score",{feature:t})})}const Nn=(0,He.observer)((function(e){const t=t=>{const{onMouseEnter:n}=e;return null===n||void 0===n?void 0:n(t)},n=t=>{const{onMouseLeave:n}=e;return null===n||void 0===n?void 0:n(t)},{regions:r,bpPerPx:a,layout:o,config:i,features:s=new Map,displayModel:l={}}=e,{selectedFeatureId:c}=l,[d]=r;for(const g of s.values())In({feature:g,bpPerPx:a,region:d,config:i,layout:o});const u=(d.end-d.start)/a,p=[...o.getLayout(i).values()],h=o.getTotalHeight();return(0,T.jsx)("svg",{width:u,height:h,style:{position:"relative"},onMouseDown:t=>{const{onMouseDown:n}=e;return null===n||void 0===n?void 0:n(t)},onMouseUp:t=>{const{onMouseUp:n}=e;return null===n||void 0===n?void 0:n(t)},onMouseEnter:t,onMouseLeave:n,onMouseOver:t=>{const{onMouseOver:n}=e;return null===n||void 0===n?void 0:n(t)},onMouseOut:t=>{const{onMouseOut:n}=e;return null===n||void 0===n?void 0:n(t)},onFocus:t,onBlur:n,onClick:t=>{const{onClick:n}=e;return null===n||void 0===n?void 0:n(t)},children:p.map((t=>{const n=s.get(t.data.featureId);return(0,T.jsxs)(v.Fragment,{children:[(0,v.createElement)(An,{...e,config:i,layoutRecord:t,feature:n,key:"stick-".concat(n.id())}),(0,v.createElement)(Rn,{...e,layoutRecord:t,feature:n,key:"body-".concat(n.id()),selectedFeatureId:c})]},n.id())}))})})),Ln=(0,i.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0});var Fn=n(88016),jn=n(59612),Dn=n(19881);class Bn{constructor(e){let{width:t}=e;if(this.width=void 0,this.totalHeight=0,this.items=[],this.layout=new Map,this.layoutDirty=!1,!t)throw new Error("width required to make a new FloatingLayout");this.width=t}add(e,t,n,r,a){this.items.push({uniqueId:e,anchorLocation:t,width:n,height:r,data:a}),this.layoutDirty=!0}getLayout(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");const t=(0,i.readConfObject)(e,"minStickLength"),n=this.items.sort(((e,t)=>e.data.score-t.data.score));let r=0;const a=new Array(n.length);for(let o=0;o<n.length;o+=1){const e=n[o],{anchorLocation:i,width:s,height:l}=e,c=i-s/2,d=c+s;let u=t,p=u+l;for(let t=0;t<o;t+=1){const[,e]=a[t],{x:n,y:r,width:o,height:i}=e,s=n+o,h=r+i;(0,Dn.qY)(n,s,c,d)&&(0,Dn.qY)(r,h,u,p)&&(u=h,p=u+l,t=-1)}a[o]=[e.uniqueId,{...e,x:c,y:u}],p>r&&(r=p)}return this.totalHeight=r,this.layout=new Map(a),this.layoutDirty=!1,this.layout}getTotalHeight(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}serializeRegion(){return this.toJSON()}toJSON(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:[...this.getLayout()],totalHeight:this.getTotalHeight()}}static fromJSON(){throw new Error("not supported")}}class En{constructor(e){let{pairs:t,totalHeight:n}=e;this.layout=void 0,this.totalHeight=void 0,this.layout=new Map(t),this.totalHeight=n}add(e){if(!this.layout.has(e))throw new Error("layout error, precomputed layout is missing ".concat(e))}getLayout(){return this.layout}getTotalHeight(){return this.totalHeight}static fromJSON(e){return new En(e)}}class Vn extends Fn.LayoutSession{makeLayout(){const{end:e,start:t}=this.regions[0],n=(e-t)/this.bpPerPx;return new jn.Z(Bn,{width:n})}layoutIsValid(){return!1}}const zn=class extends Fn.default{createSession(e){return new Vn(e)}deserializeLayoutInClient(e){return new En(e)}},On=class extends a.Z{constructor(){super(...arguments),this.name="LollipopPlugin"}install(e){e.addRendererType((()=>new zn({name:"LollipopRenderer",ReactComponent:Nn,configSchema:Ln,pluginManager:e}))),e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:_t.fU,explicitlyTyped:!0})}(e);return new Oe.Z({name:"LinearLollipopDisplay",configSchema:t,stateModel:Tn(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:_t.qb})}))}};function Zn(e){return d.types.compose("LinearArcDisplay",_t.fV,d.types.model({type:d.types.literal("LinearArcDisplay"),configuration:(0,i.ConfigurationReference)(e),displayMode:d.types.maybe(d.types.string)})).views((e=>({get blockType(){return"staticBlocks"},get renderDelay(){return 500},get rendererTypeName(){return e.configuration.renderer.type}}))).views((e=>({get displayModeSetting(){var t;return null!==(t=e.displayMode)&&void 0!==t?t:(0,i.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,i.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,displayMode:e.displayModeSetting},(0,c.getEnv)(e))}}))).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.rendererConfig,height:e.height})}})).actions((e=>({setDisplayMode(t){e.displayMode=t}}))).views((e=>{const t=e.trackMenuItems;return{trackMenuItems:()=>[...t(),{label:"Display mode",subMenu:[{type:"radio",label:"Arcs",onClick:()=>e.setDisplayMode("arcs"),checked:"arcs"===e.displayMode},{type:"radio",label:"Semi-circles",onClick:()=>e.setDisplayMode("semicircles"),checked:"semicircles"===e.displayMode}]}]}}))}const Wn=e=>{e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearArcDisplay",{renderer:d.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:_t.fU,explicitlyTyped:!0})}(e);return new $.DisplayType({name:"LinearArcDisplay",displayName:"Arc display",configSchema:t,stateModel:Zn(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:_t.qb})}))};function Hn(e){return d.types.compose("LinearPairedArcDisplay",$.BaseDisplay,(0,_t.eW)(),(0,_t.Ek)(),d.types.model({type:d.types.literal("LinearPairedArcDisplay"),configuration:(0,i.ConfigurationReference)(e),displayMode:d.types.maybe(d.types.string)})).volatile((()=>({lastDrawnOffsetPx:0,features:void 0,loading:!1,drawn:!0}))).views((e=>({get displayModeSetting(){var t;return null!==(t=e.displayMode)&&void 0!==t?t:(0,i.getConf)(e,["renderer","displayMode"])}}))).actions((e=>({selectFeature(t){const n=(0,c.getSession)(e);if((0,c.isSessionModelWithWidgets)(n)){const r=n.addWidget("VariantFeatureWidget","variantFeature",{view:(0,c.getContainingView)(e),track:(0,c.getContainingTrack)(e),featureData:t.toJSON()});n.showWidget(r)}(0,c.isSelectionContainer)(n)&&n.setSelection(t)},setLoading(t){e.loading=t},setFeatures(t){e.features=t},setDisplayMode(t){e.displayMode=t}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await n.e(6486).then(n.bind(n,16486));t(e)}catch(t){console.error(t),e.setError(t)}})()},async renderSvg(t){const{renderArcSvg:r}=await n.e(8238).then(n.bind(n,68238));return r(e,t)}})))}function Gn(e){e.addDisplayType((()=>{const e=(0,i.ConfigurationSchema)("LinearPairedArcDisplay",{color:{type:"color",description:"the color of the arcs",defaultValue:"jexl:defaultPairedArcColor(feature,alt)",contextVariable:["feature","alt"]}},{baseConfiguration:_t.fU,explicitlyTyped:!0});return new $.DisplayType({name:"LinearPairedArcDisplay",displayName:"Arc display",configSchema:e,stateModel:Hn(e),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,v.lazy)((()=>n.e(9141).then(n.bind(n,59141))))})}))}var qn=n(11233);function _n(e){let{selectedFeatureId:t,region:n,bpPerPx:r,config:a,onFeatureClick:o,feature:s}=e;const[l,d]=(0,c.bpSpanPx)(s.get("start"),s.get("end"),n,r),u=s.id();let p=(0,i.readConfObject)(a,"color",{feature:s}),h="black";t&&String(t)===String(s.id())&&(p=h="red");const g=(0,i.readConfObject)(a,"label",{feature:s}),f=(0,i.readConfObject)(a,"caption",{feature:s}),m=(0,i.readConfObject)(a,"thickness",{feature:s})||1,y=(0,i.readConfObject)(a,"height",{feature:s})||100,b=v.createRef(),w=20+(0,c.measureText)(null===f||void 0===f?void 0:f.toString()),x=.5,C=0+x*y*.75+.375*y+0;return(0,T.jsxs)("g",{children:[(0,T.jsx)("path",{d:"M ".concat(l," 0 C ").concat(l," ").concat(y,", ").concat(d," ").concat(y,", ").concat(d," 0"),stroke:p,strokeWidth:m,fill:"transparent",onClick:e=>null===o||void 0===o?void 0:o(e,u),ref:b,pointerEvents:"stroke"}),(0,T.jsxs)(qn.u,{triggerRef:b,children:[(0,T.jsx)("rect",{x:12,y:0,width:w,height:20,rx:5,ry:5,fill:"black",fillOpacity:"50%"}),(0,T.jsx)("text",{x:22,y:14,fontSize:10,fill:"white",textLength:w-20,children:f})]}),(0,T.jsx)("text",{x:l+(d-l)/2,y:C+3,style:{stroke:"white",strokeWidth:"0.6em"},children:g}),(0,T.jsx)("text",{x:l+(d-l)/2,y:C+3,style:{stroke:h},children:g})]})}function Un(e,t,n,r){const a=(r-90)*Math.PI/180;return{x:e+n*Math.cos(a),y:t+n*Math.sin(a)}}function Jn(e,t,n,r,a){const o=Un(e,t,n,a),i=Un(e,t,n,r),s=a-r<=180?"0":"1";return["M",o.x,o.y,"A",n,n,0,s,0,i.x,i.y].join(" ")}function Xn(e){let{selectedFeatureId:t,region:n,bpPerPx:r,config:a,onFeatureClick:o,feature:s}=e;const[l,d]=(0,c.bpSpanPx)(s.get("start"),s.get("end"),n,r),u=s.id();let p=(0,i.readConfObject)(a,"color",{feature:s}),h="black";t&&String(t)===String(s.id())&&(p=h="red");const g=(0,i.readConfObject)(a,"label",{feature:s}),f=(0,i.readConfObject)(a,"caption",{feature:s}),m=(0,i.readConfObject)(a,"thickness",{feature:s})||1,y=v.createRef(),b=20+(0,c.measureText)(null===f||void 0===f?void 0:f.toString()),w=(d-l)/2;return(0,T.jsxs)("g",{children:[(0,T.jsx)("path",{d:Jn(l+(d-l)/2,0,(d-l)/2,90,270),stroke:p,strokeWidth:m,fill:"transparent",onClick:e=>null===o||void 0===o?void 0:o(e,u),ref:y,pointerEvents:"stroke"}),(0,T.jsxs)(qn.u,{triggerRef:y,children:[(0,T.jsx)("rect",{x:12,y:0,width:b,height:20,rx:5,ry:5,fill:"black",fillOpacity:"50%"}),(0,T.jsx)("text",{x:22,y:14,fontSize:10,fill:"white",textLength:b-20,children:f})]}),(0,T.jsx)("text",{x:l+(d-l)/2,y:w+3,style:{stroke:"white",strokeWidth:"0.6em"},children:g}),(0,T.jsx)("text",{x:l+(d-l)/2,y:w+3,style:{stroke:h},children:g})]})}const Yn=(0,He.observer)((function(e){let{features:t,config:n,regions:r,bpPerPx:a,height:o,exportSVG:s,displayModel:{selectedFeatureId:l}}=e;const[c]=r,d=(c.end-c.start)/a,u="semicircles"===(0,i.readConfObject)(n,"displayMode");return(0,T.jsx)(Qn,{exportSVG:s,width:d,height:o,children:[...t.values()].map((e=>u?(0,T.jsx)(Xn,{config:n,region:c,bpPerPx:a,selectedFeatureId:l,feature:e},e.id()):(0,T.jsx)(_n,{config:n,region:c,bpPerPx:a,selectedFeatureId:l,feature:e},e.id())))})}));function Qn(e){let{exportSVG:t,width:n,height:r,children:a}=e;return t?(0,T.jsx)(T.Fragment,{children:a}):(0,T.jsx)("svg",{width:n,height:r,children:a})}const Kn=Yn;const $n=(0,i.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue",contextVariable:["feature"]},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')",contextVariable:["feature"]},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50",contextVariable:["feature"]},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},displayMode:{type:"enum",defaultValue:"arcs",model:d.types.enumeration("DisplayMode",["arcs","semicircles"]),description:"render semi-circles instead of arcs"}},{explicitlyTyped:!0});var er=n(90176);const tr=class extends er.default{};var nr=n(39092);class rr extends a.Z{constructor(){super(...arguments),this.name="ArcRenderer"}install(e){(e=>{e.addRendererType((()=>new tr({name:"ArcRenderer",ReactComponent:Kn,configSchema:$n,pluginManager:e})))})(e),Wn(e),Gn(e),e.jexl.addFunction("logThickness",((e,t)=>Math.log(e.get(t)+1))),e.jexl.addFunction("defaultPairedArcColor",((e,t)=>null!==t&&void 0!==t&&t.startsWith("<DEL")?nr.set1[0]:null!==t&&void 0!==t&&t.startsWith("<DUP")?nr.set1[1]:null!==t&&void 0!==t&&t.startsWith("<INV")?nr.set1[2]:null!==t&&void 0!==t&&t.startsWith("<TRA")?nr.set1[3]:null!==t&&void 0!==t&&t.startsWith("<CNV")?nr.set1[4]:nr.set1[6]))}}var ar=n(42844),or=n(84382);const ir=(0,i.ConfigurationSchema)("AboutWidget",{}),sr=d.types.model("AboutWidget",{id:K.ElementId,type:d.types.literal("AboutWidget")}),lr=(0,i.ConfigurationSchema)("HelpWidget",{}),cr=d.types.model("HelpWidget",{id:K.ElementId,type:d.types.literal("HelpWidget")}),dr=(0,i.ConfigurationSchema)("ImportSessionWidget",{}),ur=d.types.model("ImportSessionWidget",{id:K.ElementId,type:d.types.literal("ImportSessionWidget")}),pr=(0,i.ConfigurationSchema)("SessionManager",{}),hr=d.types.model("SessionManager",{id:K.ElementId,type:d.types.literal("SessionManager")}),gr=class extends a.Z{constructor(){super(...arguments),this.name="MenusPlugin"}install(e){e.addWidgetType((()=>new Rt.Z({name:"AboutWidget",heading:"About",configSchema:ir,stateModel:sr,ReactComponent:(0,v.lazy)((()=>n.e(1227).then(n.bind(n,21227))))}))),e.addWidgetType((()=>new Rt.Z({name:"HelpWidget",heading:"Help",configSchema:lr,stateModel:cr,ReactComponent:(0,v.lazy)((()=>n.e(7438).then(n.bind(n,47438))))}))),e.addWidgetType((()=>new Rt.Z({name:"ImportSessionWidget",heading:"Import session",configSchema:dr,stateModel:ur,ReactComponent:(0,v.lazy)((()=>Promise.all([n.e(9357),n.e(150)]).then(n.bind(n,20150))))}))),e.addWidgetType((()=>new Rt.Z({name:"SessionManager",heading:"Sessions",configSchema:pr,stateModel:hr,ReactComponent:(0,v.lazy)((()=>Promise.all([n.e(2280),n.e(8426)]).then(n.bind(n,48426))))})))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:or.Z,onClick:e=>{const t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:ar.Z,onClick:e=>{const t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}};var fr=n(16979),mr=n(85291),yr=n(97408),br=n.n(yr);class vr extends jt.BaseFeatureDataAdapter{constructor(e,t,n){super(e,t,n),this.endpoint=void 0,this.queryTemplate=void 0,this.refNamesQueryTemplate=void 0,this.additionalQueryParams=void 0,this.configRefNames=void 0,this.refNames=void 0,this.endpoint=(0,i.readConfObject)(e,"endpoint").uri,this.queryTemplate=(0,i.readConfObject)(e,"queryTemplate"),this.additionalQueryParams=(0,i.readConfObject)(e,"additionalQueryParams"),this.refNamesQueryTemplate=(0,i.readConfObject)(e,"refNamesQueryTemplate"),this.configRefNames=(0,i.readConfObject)(e,"refNames")}async getRefNames(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.refNames)return this.refNames;let t=[];if(this.refNamesQueryTemplate){const n=encodeURIComponent(this.refNamesQueryTemplate),r=await this.querySparql(n,e);t=this.resultsToRefNames(r)}else this.configRefNames&&(t=this.configRefNames);return this.refNames=t,t}getFeatures(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,fr.ObservableCreate)((async n=>{const r=encodeURIComponent(br()(this.queryTemplate,e)),{refName:a}=e,o=await this.querySparql(r,t);this.resultsToFeatures(o,a).forEach((e=>{n.next(e)})),n.complete()}),t.signal)}async querySparql(e,t){let n="";this.additionalQueryParams.length&&(n="&".concat(this.additionalQueryParams.join("&")));const r=null===t||void 0===t?void 0:t.signal;return(await fetch("".concat(this.endpoint,"?query=").concat(e).concat(n),{headers:{accept:"application/json,application/sparql-results+json"},signal:r})).json()}resultsToRefNames(e){var t;const n=(null===e||void 0===e||null===(t=e.results)||void 0===t?void 0:t.bindings)||[];if(!n.length)return[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return n.map((e=>e.refName.value))}resultsToFeatures(e,t){var n;const r=(null===e||void 0===e||null===(n=e.results)||void 0===n?void 0:n.bindings)||[];if(!r.length)return[];const a=e.head.vars;["start","end","uniqueId"].forEach((e=>{a.includes(e)||console.error("Required field ".concat(e," missing from feature data"))}));const o={};r.forEach((e=>{const n=[{}];a.forEach((t=>{if(t in e){const{value:r}=e[t];let a=0;for(;t.startsWith("sub_");)t=t.slice(4),a+=1;for(;a>n.length-1;)n.push({});n[a][t]=r}})),n.forEach(((e,r)=>{const{uniqueId:a}=e;r<n.length-1&&(n[r+1].parentUniqueId=a),o[a]={data:{...e,uniqueId:a,refName:t,start:parseInt(e.start,10),end:parseInt(e.end,10),strand:parseInt(e.strand,10)||0}}}))}));for(const[i,s]of Object.entries(o)){const e=s.data.parentUniqueId;if(delete s.data.parentUniqueId,e){const t=o[e];if(t)t.data.subfeatures||(t.data.subfeatures=[]),t.data.subfeatures.push({...s.data,uniqueId:i}),delete o[i];else{const t=Object.values(o).map((e=>e.data.subfeatures)).filter((e=>!!e)).flat();let n=!1;for(const r of t){if(r&&r.uniqueId===e){r.subfeatures||(r.subfeatures=[]),r.subfeatures.push({...s.data,uniqueId:i}),delete o[i],n=!0;break}null!==r&&void 0!==r&&r.subfeatures&&t.push(...r.subfeatures)}n||console.error("Could not find parentID ".concat(e))}}}return Object.keys(o).map((e=>new mr.Z({...o[e].data,uniqueId:e,subfeatures:o[e].data.subfeatures})))}async hasDataForRefName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.getRefNames(t);return!(n.length&&!n.includes(e))}freeResources(){}}const wr=(0,i.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0});class xr extends a.Z{constructor(){super(...arguments),this.name="RdfPlugin"}install(e){e.addAdapterType((()=>new q.Z({name:"SPARQLAdapter",displayName:"SPARQL adapter",configSchema:wr,AdapterClass:vr}))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="SPARQLAdapter",o=(0,Y.getFileName)(t);return/\/sparql$/i.test(o)||r===a?{type:a,endpoint:t}:e(t,n,r)}))}}const Cr=(0,i.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0});function Sr(e){const{codonTable:t,seq:n,frame:r,bpPerPx:a,region:o,height:i,y:s,reverse:l=!1,theme:d}=e,u=a,p=3-o.start%3,h=(r+p+3)%3,g=n.slice(h),f=[];for(let v=0;v<g.length;v+=3){const e=g.slice(v,v+3),n=l?(0,c.revcom)(e):e,r=t[n]||"";f.push({letter:r,codon:n.toUpperCase()})}const m=1/u*3,y=0===o.start?0:m,b=1/a>=12,w=(o.end-o.start)/a,x=["#d8d8d8","#adadad","#8f8f8f"].reverse();return(0,T.jsx)(T.Fragment,{children:f.map(((e,t)=>{const n=o.reversed?w-(m*(t+1)+h/u-y):m*t+h/u-y,{letter:a,codon:l}=e;return(0,T.jsxs)(v.Fragment,{children:[(0,T.jsx)("rect",{x:n,y:s,width:b?m:m+.7,height:i,stroke:b?"#555":"none",fill:c.defaultStarts.includes(l)?null===d||void 0===d?void 0:d.palette.startCodon:c.defaultStops.includes(l)?null===d||void 0===d?void 0:d.palette.stopCodon:x[Math.abs(r)]}),b?(0,T.jsx)("text",{x:n+m/2,y:s+i/2,dominantBaseline:"middle",textAnchor:"middle",children:a}):null]},"".concat(t,"-").concat(a))}))})}function kr(e){const{bpPerPx:t,region:n,feature:r,theme:a,height:o,seq:i,y:s}=e,l=1/t>=12,[d,u]=(0,c.bpSpanPx)(r.get("start"),r.get("end"),n,t),p=n.reversed,h=r.get("end")-r.get("start"),g=Math.max((u-d)/h,.8);return(0,T.jsx)(T.Fragment,{children:i.split("").map(((e,t)=>{const n=a.palette.bases[e.toUpperCase()],r=p?u-(t+1)*g:d+t*g;return(0,T.jsxs)(v.Fragment,{children:[(0,T.jsx)("rect",{x:r,y:s,width:g,height:o,fill:n?n.main:"#aaa",stroke:l?"#555":"none"}),l?(0,T.jsx)("text",{x:r+g/2,y:s+o/2,dominantBaseline:"middle",textAnchor:"middle",fill:n?a.palette.getContrastText(n.main):"black",children:e}):null]},t)}))})}function Tr(e){let{regions:t,theme:n,features:r=new Map,showReverse:a=!0,showForward:o=!0,showTranslation:i=!0,bpPerPx:s}=e;const[l]=t,d=(0,k.createJBrowseTheme)(n),u=(0,c.generateCodonTable)(c.defaultCodonTable),[p]=[...r.values()];if(!p)return null;const h=p.get("seq");if(!h)return null;let g=-20;return(0,T.jsxs)(T.Fragment,{children:[i&&(l.reversed?a:o)?[2,1,0].map((e=>(0,T.jsx)(Sr,{seq:h,y:g+=20,codonTable:u,frame:e,bpPerPx:s,region:l,theme:d,height:20,reverse:l.reversed},"translation-".concat(e)))):null,o?(0,T.jsx)(kr,{height:20,y:g+=20,feature:p,region:l,seq:l.reversed?(0,c.complement)(h):h,bpPerPx:s,theme:d}):null,a?(0,T.jsx)(kr,{height:20,y:g+=20,feature:p,region:l,seq:l.reversed?h:(0,c.complement)(h),bpPerPx:s,theme:d}):null,i&&(l.reversed?o:a)?[0,-1,-2].map((e=>(0,T.jsx)(Sr,{seq:h,y:g+=20,codonTable:u,frame:e,bpPerPx:s,region:l,theme:d,height:20,reverse:!l.reversed},"rev-translation-".concat(e)))):null]})}function Pr(e){let{exportSVG:t,width:n,totalHeight:r,children:a}=e;return t?(0,T.jsx)(T.Fragment,{children:a}):(0,T.jsx)("svg",{"data-testid":"sequence_track",width:n,height:r,style:{width:n,height:r},children:a})}const Mr=(0,He.observer)((function(e){const{regions:t,bpPerPx:n}=e,[r]=t,a=(r.end-r.start)/n;return(0,T.jsx)(Pr,{...e,totalHeight:200,width:a,children:(0,T.jsx)(Tr,{...e})})}));const Rr=(0,i.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0});class Ar extends er.default{constructor(){super(...arguments),this.supportsSVG=!0}getExpandedRegion(e){return{...e,start:Math.max(e.start-3,0),end:e.end+3}}}const Ir=(0,i.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0});const Nr=(0,i.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0});const Lr=(0,i.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0});const Fr=(0,i.ConfigurationSchema)("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0});const jr=e=>{e.addTrackType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:d.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:'optional track name, otherwise uses the "Reference sequence (assemblyName)"',defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},formatAbout:(0,i.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const n=JSON.parse(JSON.stringify(t)),r=new Set,{displays:a=[]}=n;return"placeholderId"!==n.trackId&&(a.forEach((e=>e&&r.add(e.type))),e.getTrackType(n.type).displayTypes.forEach((e=>{r.has(e.name)||a.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})}))),{...n,displays:a}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:n}=t;if(!n)throw new Error("unknown display type ".concat(n));const r=e.displays.find((e=>e&&e.displayId===t.displayId));if(r)return r;const a=e.displays.push(t);return e.displays[a-1]}})})}(e);return new pn.Z({name:"ReferenceSequenceTrack",displayName:"Reference sequence track",configSchema:t,stateModel:(0,s.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})}))};const Dr=(0,i.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:Rr},{explicitIdentifier:"displayId",explicitlyTyped:!0});const Br=e=>{e.addDisplayType((()=>{const e=function(e){return d.types.compose("LinearReferenceSequenceDisplay",_t.fV,d.types.model({type:d.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,i.ConfigurationReference)(e),showForward:!0,showReverse:!0,showTranslation:!0})).views((e=>{const{renderProps:t}=e;return{renderProps(){const{showForward:n,rpcDriverName:r,showReverse:a,showTranslation:o}=e;return{...t(),config:e.configuration.renderer,rpcDriverName:r,showForward:n,showReverse:a,showTranslation:o}}}})).views((e=>({regionCannotBeRendered(){const t=(0,c.getContainingView)(e);return(null===t||void 0===t?void 0:t.bpPerPx)>=1?"Zoom in to see sequence":void 0},get rendererTypeName(){return e.configuration.renderer.type}}))).actions((e=>({toggleShowForward(){e.showForward=!e.showForward},toggleShowReverse(){e.showReverse=!e.showReverse},toggleShowTranslation(){e.showTranslation=!e.showTranslation},afterAttach(){(0,d.addDisposer)(e,(0,oe.autorun)((()=>{const t=(0,c.getContainingView)(e);if((null===t||void 0===t?void 0:t.bpPerPx)>=1)e.setHeight(50);else{const{showTranslation:t,showReverse:n,showForward:r}=e,a=(n&&t?60:0)+(r&&t?60:0),o=n?20:0,i=r?20:0;e.setHeight(a+o+i)}})))}}))).views((e=>({trackMenuItems:()=>[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:()=>e.toggleShowForward()},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:()=>e.toggleShowReverse()},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:()=>e.toggleShowTranslation()}]})))}(Dr);return new $.DisplayType({name:"LinearReferenceSequenceDisplay",configSchema:Dr,stateModel:e,displayName:"Reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:_t.qb})}))};class Er extends a.Z{constructor(){super(...arguments),this.name="SequencePlugin"}install(e){(e=>{e.addRendererType((()=>new Ar({name:"DivSequenceRenderer",ReactComponent:Mr,configSchema:Rr,pluginManager:e})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"TwoBitAdapter",displayName:"TwoBit adapter",configSchema:Cr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(4229),n.e(4013),n.e(7306)]).then(n.bind(n,77306)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"BgzipFastaAdapter",displayName:"Bgzip-indexed FASTA adapter",configSchema:Ir,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(4391)]).then(n.bind(n,24391)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"ChromSizesAdapter",displayName:"Chrom sizes adapter",configSchema:Nr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>n.e(2955).then(n.bind(n,92955)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"IndexedFastaAdapter",displayName:"Indexed FASTA adapter",configSchema:Lr,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([n.e(9426),n.e(1238),n.e(2673)]).then(n.bind(n,22673)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new q.Z({name:"SequenceSearchAdapter",displayName:"Sequence search adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:Fr,getAdapterClass:()=>n.e(5490).then(n.bind(n,5490)).then((e=>e.default))})))})(e),jr(e),Br(e),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="TwoBitAdapter",o=(0,Y.getFileName)(t),i={type:a,twoBitLocation:t};return/\.2bit$/i.test(o)&&!r||r===a?i:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="IndexedFastaAdapter",o=(0,Y.getFileName)(t),i={type:a,fastaLocation:t,faiLocation:n||(0,Y.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(o)&&!r||r===a?i:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="BgzipFastaAdapter",o=(0,Y.getFileName)(t),i={type:a,faiLocation:(0,Y.makeIndex)(t,".fai"),gziLocation:(0,Y.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(o)&&!r||r===a?i:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t)))})(e)}}var Vr=n(19618),zr=n(17280);const Or=(0,He.observer)((function(e){let{text:t,x:n,y:r,region:a,reversed:o,bpPerPx:i,exportSVG:s,feature:l,viewParams:u,color:p="black",fontHeight:h=11,featureWidth:g=0,allowedWidthExpansion:f=0,displayModel:m={}}=e;const y=g+f,b=(0,c.measureText)(t,h),w=(0,d.isStateTreeNode)(m)&&(0,d.isAlive)(m)&&!s?(0,c.getViewParams)(m):u,x=o?w.end:w.start,[C,S]=(0,v.useState)(s),k=(0,zr.Z)();if((0,v.useEffect)((()=>{S(!0)}),[]),(0,d.isStateTreeNode)(a)&&!(0,d.isAlive)(a))return null;const P=a.start,M=a.end,R=l.get("start"),A=l.get("end"),I=b*i;return x<M&&x>P&&R<x&&x+I<A?n=w.offsetPx:R<x&&x+I<A&&x+I>P&&x+I<M&&(n=w.offsetPx1),C?(0,T.jsx)("text",{x:n,y:r+h,fill:"#f0f"===p?(0,c.stripAlpha)(k.palette.text.primary):p,fontSize:h,children:b>y?"".concat(t.slice(0,y/(.6*h)),"..."):t}):null})),Zr=Or,Wr=(0,He.observer)((function(e){var t,n,r,a;const{feature:o,rootLayout:s,config:l,name:c,description:d,shouldShowName:u,shouldShowDescription:p}=e,h=s.getSubRecord(String(o.id()));if(!h)return null;const{GlyphComponent:g}=h.data||{};return(0,T.jsxs)("g",{children:[(0,T.jsx)(g,{featureLayout:h,...e}),u?(0,T.jsx)(Zr,{text:c,x:(null===(t=s.getSubRecord("nameLabel"))||void 0===t?void 0:t.absolute.left)||0,y:(null===(n=s.getSubRecord("nameLabel"))||void 0===n?void 0:n.absolute.top)||0,color:(0,i.readConfObject)(l,["labels","nameColor"],{feature:o}),featureWidth:h.width,...e}):null,p?(0,T.jsx)(Zr,{text:d,x:(null===(r=s.getSubRecord("descriptionLabel"))||void 0===r?void 0:r.absolute.left)||0,y:(null===(a=s.getSubRecord("descriptionLabel"))||void 0===a?void 0:a.absolute.top)||0,color:(0,i.readConfObject)(l,["labels","descriptionColor"],{feature:o}),featureWidth:h.width,...e}):null]})}));function Hr(e){let{rect:t,region:n,bpPerPx:r,...a}=e;if(!t)return null;const[o,i,s,l]=t,[d,u]=(0,c.bpSpanPx)(o,s,n,r),p=Math.round(i),h=(n.end-n.start)/r,g=Math.round(l-i),f=u-d;if(d+f<0)return null;const m=Math.max(d,0),y=m-d,b=Math.max(1,Math.min(f-y,h));return(0,T.jsx)("rect",{x:m-2,y:p-2,width:b+4,height:g+4,...a})}const Gr=(0,He.observer)((function(e){var t,n;let{displayModel:r={},blockKey:a,region:o,bpPerPx:i,movedDuringLastMouseDown:s,...l}=e;const{selectedFeatureId:c,featureIdUnderMouse:d,contextMenuFeature:u}=r,p=d||(null===u||void 0===u?void 0:u.id()),[h,g]=(0,v.useState)(!1);function f(e){const{onFeatureMouseOut:t}=l;if(t&&p)return t(e,p)}function m(e){const{onFeatureMouseOver:t}=l;if(t&&p)return t(e,p)}return(0,v.useEffect)((()=>{g(!0)}),[]),h?(0,T.jsxs)(T.Fragment,{children:[p?(0,T.jsx)(Hr,{rect:null===(t=r.getFeatureByID)||void 0===t?void 0:t.call(r,a,p),region:o,bpPerPx:i,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){const{onFeatureMouseDown:t}=l;if(t&&p)return t(e,p)},onMouseEnter:function(e){const{onFeatureMouseEnter:t}=l;if(t&&p)return t(e,p)},onMouseOut:f,onMouseOver:m,onMouseUp:function(e){const{onFeatureMouseUp:t}=l;if(t&&p)return t(e,p)},onMouseLeave:function(e){const{onFeatureMouseLeave:t}=l;if(t&&p)return t(e,p)},onMouseMove:function(e){const{onFeatureMouseMove:t}=l;if(t&&p)return t(e,p)},onClick:function(e){if(s)return;const{onFeatureClick:t}=l;return t&&p?(e.stopPropagation(),t(e,p)):void 0},onContextMenu:function(e){const{onFeatureContextMenu:t}=l;if(t&&p)return t(e,p)},onFocus:m,onBlur:f,"data-testid":p}):null,c?(0,T.jsx)(Hr,{rect:null===(n=r.getFeatureByID)||void 0===n?void 0:n.call(r,a,c),region:o,bpPerPx:i,stroke:"#00b8ff",fill:"none"}):null]}):null})),qr=(0,He.observer)((function(e){let{feature:t,featureLayout:n,config:r,region:a}=e;const o=t.get("strand"),s=a.reversed?-1:1,l=7*o*s,{left:d=0,top:u=0,width:p=0,height:h=0}=n.absolute,g=(0,i.readConfObject)(r,"color2",{feature:t}),f=(0,zr.Z)(),m="#f0f"===g?(0,c.stripAlpha)(f.palette.text.secondary):g,y=o*s===-1?d:o*s===1?d+p:null,b=u+h/2;return y?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("line",{x1:y,x2:y+l,y1:b,y2:b,stroke:m}),(0,T.jsx)("polygon",{points:[[y+l/2,b-2.5],[y+l/2,b+2.5],[y+l,b]].toString(),stroke:m,fill:m})]}):null})),_r=(0,He.observer)((function(e){const{feature:t,region:n,config:r,featureLayout:a,bpPerPx:o,topLevel:s}=e,{start:l,end:c}=n,d=(c-l)/o,u=(t.get("end")-t.get("start"))/o,{left:p=0}=a.absolute;let{top:h=0,height:g=0}=a.absolute;if(p+u<0)return null;oa(t)&&(h+=.175*g,g*=.65);const f=Math.max(p,0),m=f-p,y=Math.max(2,Math.min(u-m,d));return t.parent()&&"intron"===t.get("type")?null:(0,T.jsxs)(T.Fragment,{children:[s?(0,T.jsx)(qr,{...e}):null,(0,T.jsx)("rect",{"data-testid":"box-".concat(t.id()),x:f,y:h,width:y,height:g,fill:oa(t)?(0,i.readConfObject)(r,"color3",{feature:t}):(0,i.readConfObject)(r,"color1",{feature:t}),stroke:(0,i.readConfObject)(r,"outline",{feature:t})})]})})),Ur=(0,He.observer)((function(e){const{feature:t,featureLayout:n,selected:r,config:a,subfeatures:o=t.get("subfeatures")}=e,s=(0,zr.Z)(),l=(0,i.readConfObject)(a,"color2",{feature:t}),d="#f0f"===l?(0,c.stripAlpha)(s.palette.text.secondary):l,{left:u=0,top:p=0,width:h=0,height:g=0}=n.absolute,f=p+g/2;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("line",{"data-testid":t.id(),x1:u,y1:f,y2:f,x2:u+h,stroke:d}),null===o||void 0===o?void 0:o.map((t=>{const a=String(t.id()),o=n.getSubRecord(a);if(!o)return null;const{GlyphComponent:i}=o.data||{};return(0,T.jsx)(i,{...e,feature:t,topLevel:!1,featureLayout:o,selected:r},"glyph-".concat(a))})),(0,T.jsx)(qr,{...e})]})}));function Jr(e,t){return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"subParts",t=arguments.length>1?arguments[1]:void 0,n=(0,i.readConfObject)(t,e);return"string"==typeof n&&(n=n.split(/\s*,\s*/)),e=>n.map((e=>e.toLowerCase())).includes(e.get("type").toLowerCase())}("subParts",t)(e)}function Xr(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function Yr(e,t){let n=e.get("subfeatures");if(!n||0===n.length)return[];const r=n.some((e=>Xr(e))),a=["mRNA","transcript"].includes(e.get("type"));return(!r&&a||(0,i.readConfObject)(t,"impliedUTRs"))&&(n=function(e,t){const n=[...t];let r,a,o=1/0,i=-1/0;const s=[];for(const c of n){const t=c.get("type");/^cds/i.test(t)?(o>c.get("start")&&(o=c.get("start")),i<c.get("end")&&(i=c.get("end"))):/exon/i.test(t)?s.push(c):Xr(c)&&(r=c.get("start")===e.get("start"),a=c.get("end")===e.get("end"))}if(!(s.length&&o<1/0&&i>-1/0))return n;s.sort(((e,t)=>e.get("start")-t.get("start")));const l=e.get("strand");let d,u;if(!r)for(let p=0;p<s.length&&(d=s[p].get("start"),!(d>=o));p++){u=o>s[p].get("end")?s[p].get("end"):o;const t=l>=0?"five_prime_UTR":"three_prime_UTR";n.unshift(new c.SimpleFeature({parent:e,id:"".concat(e.id(),"_").concat(t,"_").concat(p),data:{start:d,end:u,strand:l,type:t}}))}if(!a)for(let p=s.length-1;p>=0&&(u=s[p].get("end"),!(u<=i));p--){d=i<s[p].get("start")?s[p].get("start"):i;const t=l>=0?"three_prime_UTR":"five_prime_UTR";n.push(new c.SimpleFeature({parent:e,id:"".concat(e.id(),"_").concat(t,"_").concat(p),data:{start:d,end:u,strand:l,type:t}}))}return n}(e,n)),n.filter((e=>Jr(e,t)))}const Qr=(0,He.observer)((function(e){const{feature:t,config:n}=e,r=Yr(t,n);return(0,T.jsx)(Ur,{...e,subfeatures:r})}));Qr.layOut=e=>{let{layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}=e;const s=ra({layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i});return aa({layout:s,subfeatures:Yr(n,o),bpPerPx:r,reversed:a,config:o,extraGlyphs:i}),s};const Kr=Qr,$r=(0,He.observer)((function(e){var t;const{feature:n,featureLayout:r,selected:a}=e;return(0,T.jsx)(T.Fragment,{children:null===(t=n.get("subfeatures"))||void 0===t?void 0:t.map((t=>{const n=String(t.id()),o=r.getSubRecord(n);if(!o)return null;const{GlyphComponent:i}=o.data||{};return(0,T.jsx)(i,{...e,feature:t,featureLayout:o,selected:a},"glyph-".concat(n))}))})}));$r.layOut=e=>{let{layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:s}=e;const l=ra({layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:s}),c=(0,i.readConfObject)(o,"displayMode");if("reducedRepresentation"!==c){var d;let e=0;null===(d=n.get("subfeatures"))||void 0===d||d.forEach((t=>{const n=ta(t,s),d=(0,i.readConfObject)(o,"height",{feature:t});(n.layOut||na)({layout:l,feature:t,bpPerPx:r,reversed:a,config:o,extraGlyphs:s}).move(0,e),e+="collapse"===c?0:("compact"===c?d/3:d)+2}))}return l};const ea=$r;function ta(e,t){var n;const r=e.get("type"),a=e.get("subfeatures");if(a&&"CDS"!==r){const t=a.find((e=>!!e.get("subfeatures")));return["mRNA","transcript","primary_transcript"].includes(r)&&a.some((e=>"CDS"===e.get("type")))?Kr:!e.parent()&&t?ea:Ur}return(null===t||void 0===t||null===(n=t.find((t=>t.validator(e))))||void 0===n?void 0:n.glyph)||_r}function na(e){let{layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:s}=e;const l=(0,i.readConfObject)(o,"displayMode"),c=ra({layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:s});return"reducedRepresentation"!==l&&aa({layout:c,subfeatures:n.get("subfeatures")||[],bpPerPx:r,reversed:a,config:o,extraGlyphs:s}),c}function ra(e){const{layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:s}=e,l=(0,i.readConfObject)(o,"displayMode"),c="reducedRepresentation"===l?_r:ta(n,s),d=n.parent();let u=0;d&&(u=(a?d.get("end")-n.get("end"):n.get("start")-d.get("start"))/r);const p=(0,i.readConfObject)(o,"height",{feature:n}),h=(n.get("end")-n.get("start"))/r,g=t.parent,f=g?g.top:0;return t.addChild(String(n.id()),u,"collapse"===l?0:f,Math.max(h,1),"compact"===l?p/2:p,{GlyphComponent:c})}function aa(e){const{layout:t,subfeatures:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}=e;n.forEach((e=>{(ta(e,i).layOut||na)({layout:t,feature:e,bpPerPx:r,reversed:a,config:o,extraGlyphs:i})}))}function oa(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function ia(e){const{feature:t,detectRerender:n,bpPerPx:r,region:a,config:o,displayMode:s,layout:l,extraGlyphs:d}=e;null===n||void 0===n||n();const{reversed:u}=a,p=t.get(u?"end":"start"),h=(0,c.bpToPx)(p,a,r),g="collapsed"!==s,f=new Vr.SceneGraph("root",0,0,0,0),m=(ta(t,d).layOut||na)({layout:f,feature:t,bpPerPx:r,reversed:u,config:o,extraGlyphs:d});let y=!1,b=!1,v="",w="",x=0,C=0;if(g){const e=(0,i.readConfObject)(o,"showLabels"),n=(0,i.readConfObject)(o,"showDescriptions");x=(0,i.readConfObject)(o,["labels","fontSize"],{feature:t}),C=(0,i.readConfObject)(o,"maxFeatureGlyphExpansion")||0,v=String((0,i.readConfObject)(o,["labels","name"],{feature:t})||""),y=/\S/.test(v)&&e;const r=e=>{const t=f.width+C,n=(0,c.measureText)(e,x);return Math.round(Math.min(n,t))};if(w=String((0,i.readConfObject)(o,["labels","description"],{feature:t})||""),b=/\S/.test(w)&&n,y&&f.addChild("nameLabel",0,m.bottom,r(v),x),b){const e=y?f.getSubRecord("nameLabel"):m;f.addChild("descriptionLabel",0,e.bottom,r(w),x)}}const S=l.addRect(t.id(),t.get("start"),t.get("start")+f.width*r+3*r,f.height+5);return null===S?null:(f.move(h,S),(0,T.jsx)(Wr,{rootLayout:f,name:v,shouldShowName:y,description:w,shouldShowDescription:b,fontHeight:x,allowedWidthExpansion:C,reversed:a.reversed,topLevel:!0,...e}))}const sa=(0,He.observer)((e=>{const{features:t=new Map,isFeatureDisplayed:n}=e;return(0,T.jsx)(T.Fragment,{children:[...t.values()].filter((e=>!n||n(e))).map((t=>(0,T.jsx)(ia,{feature:t,...e},t.id())))})})),la=(0,He.observer)((function(e){const{layout:t,blockKey:n,regions:r=[],bpPerPx:a,config:o,displayModel:s={},exportSVG:l,featureDisplayHandler:c,onMouseOut:d,onMouseDown:u,onMouseLeave:p,onMouseEnter:h,onMouseOver:g,onMouseMove:f,onMouseUp:m,onClick:y}=e,[b]=r,w=(b.end-b.start)/a,x=(0,i.readConfObject)(o,"displayMode"),C=(0,v.useRef)(null),[S,k]=(0,v.useState)(!1),[P,M]=(0,v.useState)(0),[R,A]=(0,v.useState)(!1),I=(0,v.useCallback)((e=>(k(!0),A(!1),null===u||void 0===u?void 0:u(e))),[u]),N=(0,v.useCallback)((e=>(k(!1),null===m||void 0===m?void 0:m(e))),[m]),L=(0,v.useCallback)((e=>{var t;if(!C.current)return;S&&A(!0);const{left:r,top:o}=C.current.getBoundingClientRect(),i=e.clientX-r,l=e.clientY-o,c=b.reversed?w-i:i,d=b.start+a*c,u=null===(t=s.getFeatureOverlapping)||void 0===t?void 0:t.call(s,n,d,l);f&&f(e,u)}),[n,a,S,f,b.reversed,b.start,s,w]),F=(0,v.useCallback)((e=>{R||null===y||void 0===y||y(e)}),[R,y]);return(0,v.useEffect)((()=>{M(t.getTotalHeight())}),[t]),l?(0,T.jsx)(sa,{displayMode:x,isFeatureDisplayed:c,region:b,...e}):(0,T.jsxs)("svg",{ref:C,"data-testid":"svgfeatures",width:w,height:P+100,onMouseDown:I,onMouseUp:N,onMouseEnter:h,onMouseLeave:p,onMouseOver:g,onMouseOut:d,onMouseMove:L,onClick:F,children:[(0,T.jsx)(sa,{displayMode:x,region:b,movedDuringLastMouseDown:R,isFeatureDisplayed:c,...e}),(0,T.jsx)(Gr,{...e,region:b,movedDuringLastMouseDown:R})]})})),ca=la;const da=(0,i.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"#f0f",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:(0,i.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"#f0f",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:12,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:d.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:1200},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0});class ua extends Fn.default{constructor(){super(...arguments),this.supportsSVG=!0}}class pa extends a.Z{constructor(){super(...arguments),this.name="SVGPlugin"}install(e){e.addRendererType((()=>new ua({name:"SvgFeatureRenderer",ReactComponent:ca,configSchema:da,pluginManager:e})))}}var ha=n(43405),ga=n(42207);const fa=e=>(0,i.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:{type:"frozen",defaultValue:null},windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{explicitlyTyped:!0});const ma=(0,v.lazy)((()=>n.e(7045).then(n.bind(n,77045))));const ya=e=>{e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearGCContentDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),n=function(e,t){return d.types.compose("LinearGCContentDisplay",(0,ga.LT)(e,t),d.types.model({type:d.types.literal("LinearGCContentDisplay"),windowSize:d.types.maybe(d.types.number),windowDelta:d.types.maybe(d.types.number)})).actions((e=>({setGCContentParams(t){let{windowSize:n,windowDelta:r}=t;e.windowSize=n,e.windowDelta=r}}))).views((e=>({get windowSizeSetting(){var t;return null!==(t=e.windowSize)&&void 0!==t?t:(0,i.getConf)(e,"windowSize")},get windowDeltaSetting(){var t;return null!==(t=e.windowDelta)&&void 0!==t?t:(0,i.getConf)(e,"windowDelta")}}))).views((e=>{const{trackMenuItems:t,renderProps:n}=e;return{trackMenuItems:()=>[...t(),{label:"Change GC parameters",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[ma,{model:e,handleClose:t}]))}}],renderProps(){const t=(0,i.getConf)(e.parentTrack,"adapter");return{...n(),adapterConfig:{type:"GCContentAdapter",sequenceAdapter:t,windowSize:e.windowSizeSetting,windowDelta:e.windowDeltaSetting}}}}}))}(e,t);return new $.DisplayType({name:"LinearGCContentDisplay",configSchema:t,stateModel:n,displayName:"GC content display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:ga.Xl})}))};class ba extends a.Z{constructor(){super(...arguments),this.name="GCContentPlugin"}install(e){(e=>{e.addAdapterType((()=>new q.Z({name:"GCContentAdapter",displayName:"GC content adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:fa(e),getAdapterClass:()=>n.e(6548).then(n.bind(n,86548)).then((e=>e.default))})))})(e),ya(e)}}var va=n(88212),wa=n(99814),xa=n(88826),Ca=n(36669),Sa=n(59231),ka=n(78693),Ta=n(68367),Pa=n(84535),Ma=n(64688);function Ra(e,t){let{DataCellReactComponent:n=null,FilterModelType:r=null,compare:a,displayName:o,categoryName:i}=t;return d.types.model("ColumnDataType".concat(e),{type:d.types.literal(e)}).volatile((()=>({DataCellReactComponent:n,FilterModelType:r,displayName:o||e,categoryName:i}))).views((()=>({compare:a,get hasFilter(){return!!r}})))}const Aa=(0,Ze.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),Ia=(0,He.observer)((function(e){let{filterModel:t}=e;const{classes:n}=Aa(),r=(0,Pa.getEnumerationValues)((0,Pa.getSubType)((0,Pa.getPropertyType)((0,d.getPropertyMembers)(t),"operation")));return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Ca.Z,{value:t.operation,onChange:e=>t.setOperation(String(e.target.value)),children:r.map((e=>(0,T.jsx)(Sa.Z,{value:e,children:e},e)))})," ",(0,T.jsx)(x.Z,{label:"range",placeholder:"chr1:100-200",error:t.locStringIsInvalid,value:t.locString,onChange:e=>t.setLocString(e.target.value),className:n.textFilterControl,InputProps:{endAdornment:(0,T.jsx)(ka.Z,{className:n.textFilterControlAdornment,position:"end",children:(0,T.jsx)(Ta.Z,{"aria-label":"clear filter",onClick:()=>t.setLocString(""),children:(0,T.jsx)(Ma.Z,{})})})}})]})})),Na=["overlaps with","contained within","fully contains","does not overlap","not contained within","does not contain"],La={"overlaps with":(e,t)=>e.refName===t.refName&&(0,c.doesIntersect2)(e.start,e.end,t.start,t.end),"contained within":(e,t)=>e.refName===t.refName&&(0,c.isContainedWithin)(e.start,e.end,t.start,t.end),"fully contains":(e,t)=>e.refName===t.refName&&(0,c.isContainedWithin)(t.start,t.end,e.start,e.end),"does not overlap":(e,t)=>!La["overlaps with"](e,t),"not contained within":(e,t)=>!La["contained within"](e,t),"does not contain":(e,t)=>!La["fully contains"](e,t)},Fa=d.types.model("ColumnLocStringFilter",{type:d.types.literal("LocString"),columnNumber:d.types.integer,locString:"",operation:d.types.optional(d.types.enumeration(Na),Na[0])}).views((e=>({get locStringIsInvalid(){if(e.locString){const e=this.parsedLocString;return!e||""===e.refName||"number"!==typeof e.start||"number"!==typeof e.end||e.start>e.end}return!1},get parsedLocString(){const t=(0,c.getSession)(e),n=(0,d.getParent)(e,3).spreadsheet,{assemblyName:r}=n;try{return(0,c.parseLocString)(e.locString,(e=>t.assemblyManager.isValidRefName(e,r)))}catch(a){return}}}))).views((e=>({get predicate(){const{locString:t,locStringIsInvalid:n,parsedLocString:r,operation:a,columnNumber:o}=e;return t&&!n&&r?function(e,t){const{cellsWithDerived:n}=t,i=n[o];if(null===i||void 0===i||!i.text||!i.extendedData)return!1;const s=i.extendedData;if(!s.refName)return!1;const l=La[a];if(!l)throw new Error('"'.concat(a,'" not implemented in location filter'));return l(s,r)}:function(){return!0}}}))).actions((e=>({setLocString(t){e.locString=t},setOperation(t){e.operation=t}}))).volatile((()=>({ReactComponent:Ia})));const ja=Ra("LocString",{categoryName:"Location",displayName:"Full location",compare:(e,t)=>(0,c.compareLocs)(e.extendedData,t.extendedData),FilterModelType:Fa,DataCellReactComponent:(0,He.observer)((function(e){let{cell:t,columnNumber:n,spreadsheet:r}=e;return(0,T.jsx)("a",{onClick:async e=>{e.preventDefault();const n=(0,c.getSession)(r);try{await async function(e,t,n){const r=(0,c.getSession)(e),{assemblyName:a}=e,{id:o}=(0,d.getParent)(e),i="".concat(o,"_").concat(a);let s=r.views.find((e=>e.id===i));s||(s=r.addView("LinearGenomeView",{id:i})),await s.navToLocString(n.text,a)}(r,0,t)}catch(a){console.error(a),n.notify("".concat(a),"error")}},title:"open a new linear genome view here",href:"#link",children:t.text})}))}),Da=["equals","contains","does not contain","does not equal","starts with","ends with"],Ba={contains:(e,t)=>e.toLowerCase().includes(t),equals:(e,t)=>e.toLowerCase()===t,"starts with":(e,t)=>e.toLowerCase().startsWith(t),"ends with":(e,t)=>{const n=e.toLowerCase().indexOf(t);return-1!==n&&n===e.length-t.length},"does not contain":(e,t)=>!Ba.contains(e,t),"does not equal":(e,t)=>!Ba.equals(e,t)},Ea=(0,Ze.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:0,"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),Va=(0,He.observer)((e=>{let{filterModel:t}=e;const{classes:n}=Ea(),r=(0,Pa.getEnumerationValues)((0,Pa.getSubType)((0,Pa.getPropertyType)((0,d.getPropertyMembers)(t),"operation")));return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Ca.Z,{value:t.operation,onChange:e=>{t.setOperation(String(e.target.value))},children:r.map((e=>(0,T.jsx)(Sa.Z,{value:e,children:e},e)))})," ",(0,T.jsx)(x.Z,{label:"text",value:t.stringToFind,onChange:e=>t.setString(e.target.value),className:n.textFilterControl,InputProps:{endAdornment:(0,T.jsx)(ka.Z,{className:n.textFilterControlAdornment,position:"end",children:(0,T.jsx)(Ta.Z,{"aria-label":"clear filter",onClick:()=>t.setString(""),children:(0,T.jsx)(Ma.Z,{})})})}})]})})),za=d.types.model("ColumnTextFilter",{type:d.types.literal("Text"),columnNumber:d.types.integer,stringToFind:"",operation:d.types.optional(d.types.enumeration(Da),Da[0])}).views((e=>({get predicate(){const{stringToFind:t,columnNumber:n,operation:r}=e;if(!t)return function(){return!0};const a=t.toLowerCase();return function(e,t){const{cellsWithDerived:o}=t,i=o[n];if(null===i||void 0===i||!i.text)return!1;const s=Ba[r];if(!s)throw new Error('"'.concat(r,'" not implemented in location filter'));return s(i.text,a)}}}))).actions((e=>({setString(t){e.stringToFind=t},setOperation(t){e.operation=t}}))).volatile((()=>({ReactComponent:Va}))),Oa=Ra("Text",{compare:(e,t)=>e.text.localeCompare(t.text),FilterModelType:za}),Za=Ra("LocRef",{categoryName:"Location",displayName:"Reference seq",compare:(e,t)=>e.text.localeCompare(t.text),FilterModelType:d.types.compose(za,d.types.model({type:d.types.literal("LocRef")}))}),Wa=["equals","greater than","less than","between","not between"],Ha={equals:(e,t)=>e===t,"greater than":(e,t)=>e>t,"less than":(e,t)=>e<t,between:(e,t,n)=>e>t&&void 0!==n&&e<n,"not between":(e,t,n)=>!Ha.between(e,t,n)},Ga=(0,Ze.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),qa=(0,He.observer)((e=>{let{filterModel:t}=e;const{classes:n}=Ga(),r=Wa;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(Ca.Z,{value:t.operation,onChange:e=>t.setOperation(String(e.target.value)),children:r.map((e=>(0,T.jsx)(Sa.Z,{value:e,children:e},e)))})," ",(0,T.jsx)(x.Z,{label:"number",placeholder:"123",type:"number",error:t.firstNumberIsInvalid,defaultValue:t.firstNumber,onChange:e=>{t.setFirstNumber(parseFloat(e.target.value))},className:n.textFilterControl}),"between"!==t.operation&&"not between"!==t.operation?null:(0,T.jsxs)(T.Fragment,{children:[" and ",(0,T.jsx)(x.Z,{label:"number",placeholder:"456",type:"number",error:t.secondNumberIsInvalid,defaultValue:t.secondNumber,onChange:e=>t.setSecondNumber(parseFloat(e.target.value)),className:n.textFilterControl})]})]})})),_a=d.types.model("ColumnNumberFilter",{type:d.types.literal("Number"),columnNumber:d.types.integer,firstNumber:d.types.maybe(d.types.number),secondNumber:d.types.maybe(d.types.number),operation:d.types.optional(d.types.enumeration(Wa),Wa[0])}).views((e=>({get predicate(){if("number"!==typeof e.firstNumber)return function(){return!0};const{firstNumber:t,secondNumber:n,operation:r,columnNumber:a}=e;return function(e,o){const{cellsWithDerived:i}=o,s=i[a];if(null===s||void 0===s||!s.text)return!1;const l=parseFloat(s.text);if("number"!==typeof l)return!1;const c=Ha[r];if(!c)throw new Error('"'.concat(r,'" not implemented in location filter'));return c(l,t,n)}}}))).actions((e=>({setFirstNumber(t){e.firstNumber=Number.isNaN(t)||"number"!==typeof t?void 0:t},setSecondNumber(t){e.secondNumber=Number.isNaN(t)||"number"!==typeof t?void 0:t},setOperation(t){e.operation=t}}))).volatile((()=>({ReactComponent:qa}))),Ua={Number:Ra("Number",{compare:(e,t)=>parseFloat(e.text)-parseFloat(t.text),FilterModelType:_a}),Text:Oa,LocString:ja,LocRef:Za,LocStart:Ra("LocStart",{categoryName:"Location",displayName:"Start",compare:(e,t)=>parseFloat(e.text)-parseFloat(t.text),FilterModelType:d.types.compose(_a,d.types.model({type:d.types.literal("LocStart")}))}),LocEnd:Ra("LocEnd",{categoryName:"Location",displayName:"End",compare:(e,t)=>parseFloat(e.text)-parseFloat(t.text),FilterModelType:d.types.compose(_a,d.types.model({type:d.types.literal("LocEnd")}))})},Ja=Object.values(Ua),Xa=d.types.union(...Ja),Ya=d.types.union(...Ja.map((e=>{const{FilterModelType:t}=e.create({type:e.properties.type.value});return t})).filter((e=>!!e))),Qa=d.types.model("SpreadsheetCell",{text:d.types.string,extendedData:d.types.maybe(d.types.frozen())}),Ka=d.types.model("SpreadsheetRow",{id:d.types.identifier,cells:d.types.array(Qa),extendedData:d.types.maybe(d.types.frozen()),isSelected:!1}).actions((e=>({toggleSelect(){e.isSelected=!e.isSelected},unSelect(){e.isSelected=!1},select(){e.isSelected=!0},setExtendedData(t){e.extendedData=t}}))).views((e=>({get cellsWithDerived(){const{columns:t}=(0,d.getParent)(e,3);let n=0;return t.map((t=>t.isDerived?t.expr.evalSync({row:e}):e.cells[n++]))}}))),$a=d.types.model("StaticRowSet",{isLoaded:d.types.literal(!0),rows:d.types.array(Ka)}).views((e=>({get count(){return e.rows.length},get passingFiltersCount(){return this.sortedFilteredRows.length},get selectedCount(){return this.selectedRows.length},get selectedAndPassingFiltersCount(){return this.selectedFilteredRows.length},get sortedRows(){const t=(0,d.getParent)(e);return[...e.rows].sort(t.rowSortingComparisonFunction)},get selectedRows(){return e.rows.filter((e=>e.isSelected))},get selectedFilteredRows(){const t=(0,d.getParent)(e),n=(0,d.getParent)(t),{filterControls:r}=n;return this.selectedRows.filter((e=>r.rowPassesFilters(t,e)))},get sortedFilteredRows(){const t=(0,d.getParent)(e),n=(0,d.getParent)(t),{filterControls:r}=n;return e.rows.filter((e=>r.rowPassesFilters(t,e))).sort(t.rowSortingComparisonFunction)}}))).actions((e=>({unselectAll(){e.rows.forEach((e=>e.unSelect()))}}))),eo=$a,to=d.types.model("ColumnDefinition",{name:d.types.maybe(d.types.string),dataType:d.types.optional(Xa,(()=>({type:"Text"}))),isDerived:!1,derivationFunctionText:d.types.maybe(d.types.string)}).views((e=>({get expr(){if(e.isDerived)return(0,xa.P)(String(e.derivationFunctionText),(0,c.getEnv)(e).pluginManager.jexl)}})));const no=d.types.model("Spreadsheet",{rowSet:d.types.optional(eo,(()=>eo.create())),columns:d.types.array(to),columnDisplayOrder:d.types.array(d.types.number),hasColumnNames:!1,sortColumns:d.types.array(d.types.model("SortColumns",{columnNumber:d.types.number,descending:!1}).actions((e=>({switchDirection(){e.descending=!e.descending}})))),assemblyName:d.types.maybe(d.types.string)}).volatile((()=>({defaultDataType:Ua.Text,rowMenuPosition:null,isLoaded:!1}))).views((e=>({get initialized(){var t;const n=(0,c.getSession)(e),r=e.assemblyName;return!!r&&(null===(t=n.assemblyManager.get(r))||void 0===t?void 0:t.initialized)},get hideRowSelection(){return(0,d.getParent)(e).hideRowSelection},get dataTypeChoices(){return Object.keys(Ua).map((e=>{const t=Ua[e].create({type:e}),{displayName:n,categoryName:r}=t;return{typeName:e,displayName:n,categoryName:r}}))},rowSortingComparisonFunction(t,n){for(const{columnNumber:r,descending:a}of e.sortColumns){const{dataType:o}=e.columns[r],i=o.compare(t.cellsWithDerived[r],n.cellsWithDerived[r]);if(i)return a?-i:i}return 0}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,oe.autorun)((async()=>{const t=(0,c.getSession)(e),{assemblyManager:n}=t;try{e.assemblyName&&(await n.waitForAssembly(e.assemblyName),this.setLoaded(!0))}catch(r){t.notify("failed to load assembly ".concat(e.assemblyName," ").concat(r),"error")}})))},setLoaded(t){e.isLoaded=t},setRowMenuPosition(t){e.rowMenuPosition=t},setSortColumns(t){t&&(e.sortColumns=t)},setColumnType(t,n){e.columns[t].dataType={type:n}},unselectAll:()=>e.rowSet.unselectAll()}))),ro=3e7,ao=["CSV","TSV","VCF","BED","BEDPE","STAR-Fusion"],oo={CSV:()=>n.e(3285).then(n.bind(n,23285)).then((e=>e.parseCsvBuffer)),TSV:()=>n.e(3285).then(n.bind(n,23285)).then((e=>e.parseTsvBuffer)),VCF:()=>n.e(1564).then(n.bind(n,51564)).then((e=>e.parseVcfBuffer)),BED:()=>n.e(5696).then(n.bind(n,5696)).then((e=>e.parseBedBuffer)),BEDPE:()=>n.e(5696).then(n.bind(n,5696)).then((e=>e.parseBedPEBuffer)),"STAR-Fusion":()=>n.e(8180).then(n.bind(n,18180)).then((e=>e.parseSTARFusionBuffer))},io=new RegExp("\\.(".concat(ao.join("|"),")(\\.gz)?$"),"i");const so=d.types.model("SpreadsheetImportWizard",{fileType:d.types.optional(d.types.enumeration(ao),"CSV"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:d.types.maybe(d.types.string)}).volatile((()=>({fileTypes:ao,fileSource:void 0,error:void 0,loading:!1}))).views((e=>({get isReadyToOpen(){return!e.error&&e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get canCancel(){return(0,d.getParent)(e).readyToDisplay},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName(t,n){const{assemblyManager:r}=(0,c.getSession)(e);return!!n&&r.isValidRefName(t,n)}}))).actions((e=>({setSelectedAssemblyName(t){e.selectedAssemblyName=t},setFileSource(t){if(e.fileSource=t,e.error=void 0,e.fileSource){const t=e.fileName;if(t){var n;const r=null===(n=io.exec(t))||void 0===n?void 0:n[1];r&&(e.fileType="tsv"===r&&t.includes("star-fusion")?"STAR-Fusion":r.toUpperCase())}}},toggleHasColumnNameLine(){e.hasColumnNameLine=!e.hasColumnNameLine},setColumnNameLineNumber(t){t>0&&(e.columnNameLineNumber=t)},setFileType(t){e.fileType=t},setError(t){console.error(t),e.loading=!1,e.error=t},setLoaded(){e.loading=!1,e.error=void 0},cancelButton(){e.error=void 0,(0,d.getParent)(e).setDisplayMode()},async import(t){if(!e.fileSource)return;if(e.loading)throw new Error("Cannot import, load already in progress");e.selectedAssemblyName=t,e.loading=!0;const r=e.fileType,a=await oo[r]();if(!a)throw new Error("cannot open files of type '".concat(e.fileType,"'"));const{unzip:o}=await Promise.all([n.e(9426),n.e(1238)]).then(n.bind(n,31238)),{pluginManager:i}=(0,c.getEnv)(e),s=(0,z.openLocation)(e.fileSource,i);try{if((await s.stat()).size>ro)throw new Error("File is too big. Tabular files are limited to at most ".concat(3e4.toLocaleString(),"kb."))}catch(l){console.warn(l)}try{await s.readFile().then((t=>e.requiresUnzip?o(t):t)).then((t=>a(t,e))).then((t=>{this.setLoaded(),(0,d.getParent)(e).displaySpreadsheet(t)}))}catch(l){this.setError(l)}}}))),lo=d.types.model("RowFullTextFilter",{type:d.types.literal("RowFullText"),stringToFind:""}).views((e=>({get predicate(){let t=e.stringToFind;return t?(t=t.toLowerCase(),function(e,n){const{cellsWithDerived:r}=n;for(const a of r)if(a.text&&a.text.toLowerCase().includes(t))return!0;return!1}):function(){return!0}}}))).actions((e=>({setString(t){e.stringToFind=t},clear(){e.stringToFind=""}}))),co=d.types.model("SpreadsheetFilterControls",{rowFullText:d.types.optional(lo,(()=>({type:"RowFullText",stringToFind:""}))),columnFilters:d.types.array(Ya)}).views((e=>({get filters(){return[e.rowFullText,...e.columnFilters].filter((e=>!!e))},setRowFullTextFilter(t){e.rowFullText={type:"RowFullText",stringToFind:t}},rowPassesFilters(e,t){for(const n of this.filters)if(!n.predicate(e,t))return!1;return!0}}))).actions((e=>({addBlankColumnFilter(t){const{dataType:n}=(0,d.getParent)(e).spreadsheet.columns[t];e.columnFilters.push({type:n.type,columnNumber:t})},removeColumnFilter:t=>e.columnFilters.remove(t),clearAllFilters(){e.columnFilters.clear(),e.rowFullText.clear()}}))),uo=co,po=[{label:"Toggle select",icon:wa.Z,onClick(e,t){var n;const r=null===(n=t.rowMenuPosition)||void 0===n?void 0:n.rowNumber;void 0!==r&&t.rowSet.rows[+r-1].toggleSelect()}}];const ho=d.types.model("SpreadsheetView",{type:d.types.literal("SpreadsheetView"),offsetPx:0,height:d.types.optional(d.types.refinement("SpreadsheetViewHeight",d.types.number,(e=>e>=40)),440),hideVerticalResizeHandle:!1,hideFilterControls:!1,filterControls:d.types.optional(uo,(()=>uo.create({}))),mode:d.types.optional(d.types.enumeration("SpreadsheetViewMode",["import","display"]),"import"),importWizard:d.types.optional(so,(()=>so.create())),spreadsheet:d.types.maybe(no)}).volatile((()=>({width:400,rowMenuItems:po}))).views((e=>({get readyToDisplay(){return!!e.spreadsheet&&e.spreadsheet.isLoaded},get hideRowSelection(){return!!(0,d.getEnv)(e).hideRowSelection},get outputRows(){if(e.spreadsheet&&e.spreadsheet.rowSet.isLoaded){const t=e.spreadsheet.rowSet.selectedFilteredRows;return t.length?t:e.spreadsheet.rowSet.sortedFilteredRows}},get assembly(){var t;const n=null===(t=e.spreadsheet)||void 0===t?void 0:t.assemblyName;if(n){const t=(0,c.getSession)(e).assemblies;return null===t||void 0===t?void 0:t.find((e=>(0,i.readConfObject)(e,"name")===n))}}}))).actions((e=>({setRowMenuItems(t){e.rowMenuItems=t},setWidth:t=>(e.width=t,e.width),setHeight:t=>(e.height=t>40?t:40,e.height),resizeHeight(t){const n=e.height;return this.setHeight(e.height+t)-n},resizeWidth(t){const n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet(t){e.filterControls.clearAllFilters(),e.spreadsheet=(0,d.cast)(t),e.mode="display"},setImportMode(){e.mode="import"},setDisplayMode(){e.readyToDisplay&&(e.mode="display")},closeView(){(0,d.getParent)(e,2).removeView(e)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>e.setImportMode(),icon:Re.Z}]}))),go=d.types.compose(s.BaseViewModel,ho);class fo extends a.Z{constructor(){super(...arguments),this.name="SpreadsheetViewPlugin"}install(e){(e=>{e.addViewType((()=>new $.ViewType({name:"SpreadsheetView",displayName:"Spreadsheet view",stateModel:go,ReactComponent:(0,v.lazy)((()=>Promise.all([n.e(3650),n.e(1296),n.e(2167)]).then(n.bind(n,32167))))})))})(e),(e=>{e.addToExtensionPoint("LaunchView-SpreadsheetView",(async e=>{var t;let{session:n,assembly:r,uri:a,fileType:o}=e;const i=n.addView("SpreadsheetView");if(!i)throw new Error("Failed to initialize view");const s=a.split(".");let l=null===s||void 0===s||null===(t=s.pop())||void 0===t?void 0:t.toUpperCase();var c;"GZ"===l&&(l=null===s||void 0===s||null===(c=s.pop())||void 0===c?void 0:c.toUpperCase()),i.importWizard.setFileType(o||l||""),i.importWizard.setSelectedAssemblyName(r),i.importWizard.setFileSource({uri:a,locationType:"UriLocation"}),await i.importWizard.import(r)}))})(e)}configure(e){const{rootModel:t}=e;(0,c.isAbstractMenuManager)(t)&&t.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:va.Z,onClick:e=>{e.addView("SpreadsheetView",{})}})}}var mo=n(55022),yo=n(8563),bo=n(45294),vo=n(96614),wo=n(83171);const xo=(0,Ze.ZL)()((e=>({circularViewOptions:{padding:e.spacing(1)}}))),Co=(0,He.observer)((function(e){let{svInspector:t}=e;const{classes:n}=xo();return(0,T.jsx)(bo.ZP,{container:!0,className:n.circularViewOptions,style:{height:t.circularViewOptionsBarHeight},children:(0,T.jsx)(bo.ZP,{item:!0,children:(0,T.jsx)(vo.Z,{control:(0,T.jsx)(wo.Z,{checked:t.onlyDisplayRelevantRegionsInCircularView,onChange:e=>t.setOnlyDisplayRelevantRegionsInCircularView(e.target.checked)}),label:"show only regions with data"})})})})),So=(0,Ze.ZL)()((e=>({resizeHandleVert:{background:e.palette.action.selected,width:4,boxSizing:"border-box",borderTop:"1px solid #fafafa"},resizeHandleHoriz:{background:e.palette.action.selected,height:4,boxSizing:"border-box",borderTop:"1px solid #fafafa"},viewControls:{margin:0},viewsContainer:{display:"flex"},container:{overflow:"hidden"}}))),ko=(0,He.observer)((function(e){let{model:t}=e;const{classes:n}=So(),{SpreadsheetViewReactComponent:r,CircularViewReactComponent:a,showCircularView:o}=t;return(0,T.jsxs)("div",{className:n.container,children:[(0,T.jsxs)("div",{className:n.viewsContainer,children:[(0,T.jsx)("div",{style:{width:t.spreadsheetView.width},className:n.container,children:(0,T.jsx)(r,{model:t.spreadsheetView})}),o?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(k.ResizeHandle,{onDrag:e=>{const n=t.circularView.resizeWidth(-e);return t.spreadsheetView.resizeWidth(-n)},vertical:!0,flexbox:!0,className:n.resizeHandleVert}),(0,T.jsxs)("div",{style:{width:t.circularView.width},children:[(0,T.jsx)(Co,{svInspector:t}),(0,T.jsx)(a,{model:t.circularView})]})]}):null]}),(0,T.jsx)(k.ResizeHandle,{onDrag:t.resizeHeight,className:n.resizeHandleHoriz})]})})),To=ko;var Po=n(84623);function Mo(e,t,n,r,a,o){const i={};return e.forEach(((e,r)=>{if(t.includes(r))return;let{text:a}=n.cells[r];"Number"===e.dataType.type&&(a=parseFloat(a)),i[e.name]=a})),{...i,uniqueId:"sv-inspector-adhoc-".concat(o),refName:r.refName,start:r.start,end:r.end,mate:{refName:a.refName,start:a.start,end:a.end}}}function Ro(e,t,n,r){const{columns:a,columnDisplayOrder:o}=e,i={};o.forEach((e=>{const t=a[e];i[t.dataType.type]||(i[t.dataType.type]=[]),i[t.dataType.type].push(e)}));const s=i.LocString||[],l=i.LocStart||[],d=i.LocEnd||[],u=i.LocRef||[];return s.length>=2?function(e,t,n,r,a){const o=(0,c.parseLocString)(n.cells[t[0]].text,a),i=(0,c.parseLocString)(n.cells[t[1]].text,a);return Mo(e,[t[0],t[1]],n,o,i,r)}(a,s,n,t,r):u.length>=2&&l.length>=2&&d.length>=2?function(e,t,n,r,a,o){const i=e=>a.cells[e].text,s={refName:i(t[0]),start:parseInt(i(n[0]),10)-1,end:parseInt(i(r[0]),10)},l={refName:i(t[1]),start:parseInt(i(n[1]),10)-1,end:parseInt(i(r[1]),10)};return Mo(e,[t[0],n[0],r[0],t[1],n[1],r[1]],a,s,l,o)}(a,u,l,d,n,t):void 0}function Ao(e,t,n,r){var a,o;return(null===(a=n.extendedData)||void 0===a?void 0:a.vcfFeature)||(null===(o=n.extendedData)||void 0===o?void 0:o.feature)||Ro(t.spreadsheet,r,n,e.assemblyManager.isValidRefName)}function Io(e,t,n,r,a){const{pluginManager:o}=(0,c.getEnv)(e),i=(0,c.getSession)(t),s=Ao(i,n,r,a);if(s){const t=new c.SimpleFeature(s);return i.setSelection(t),o.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(t,e.circularView)}}const No=function(e){const t=e.getViewType("SpreadsheetView"),n=e.getViewType("CircularView"),r=t.stateModel,a=n.stateModel;return d.types.compose("SvInspectorView",s.BaseViewModel,d.types.model({id:K.ElementId,type:d.types.literal("SvInspectorView"),height:d.types.optional(d.types.refinement("SvInspectorViewHeight",d.types.number,(e=>e>=400)),550),onlyDisplayRelevantRegionsInCircularView:!1,mode:d.types.optional(d.types.enumeration("SvInspectorViewMode",["import","display"]),"import"),spreadsheetView:d.types.optional(r,(()=>r.create({type:"SpreadsheetView",hideVerticalResizeHandle:!0}))),circularView:d.types.optional(a,(()=>a.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})))})).volatile((()=>({width:800}))).views((e=>({get selectedRows(){return e.spreadsheetView.rowSet.selectedRows},get assemblyName(){const{assembly:t}=e.spreadsheetView;return t?(0,i.readConfObject)(t,"name"):void 0},get showCircularView(){return"display"===e.spreadsheetView.mode},get features(){const t=(0,c.getSession)(e),{spreadsheetView:n}=e,{outputRows:r=[]}=n;return r.map(((e,r)=>Ao(t,n,e,r))).filter((e=>!!e))},get featuresAdapterConfigSnapshot(){return{type:"FromConfigAdapter",features:this.features}},get featureRefNames(){const e=this.features.map((e=>e.refName)),t=this.features.flatMap((e=>{var t;return null===(t=e.INFO)||void 0===t?void 0:t.CHR2})).filter((e=>!!e));return[...e,...t]},get featuresCircularTrackConfiguration(){return{type:"VariantTrack",trackId:"sv-inspector-variant-track-".concat(e.id),name:"features from tabular data",adapter:this.featuresAdapterConfigSnapshot,assemblyNames:[this.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:"sv-inspector-variant-track-chord-display-".concat(e.id),onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}))).volatile((()=>({SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:n.ReactComponent,circularViewOptionsBarHeight:52}))).actions((e=>({setWidth(t){e.width=t},setHeight:t=>(e.height=t>400?t:400,e.height),setImportMode(){e.spreadsheetView.setImportMode()},setDisplayMode(){e.spreadsheetView.setDisplayMode()},closeView(){(0,d.getParent)(e,2).removeView(e)},setDisplayedRegions(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>e.setImportMode(),icon:Re.Z}]}))).actions((e=>({resizeHeight(t){const n=e.height;return e.setHeight(e.height+t)-n},afterAttach(){(0,d.addDisposer)(e,(0,oe.autorun)((()=>{if(e.showCircularView){const t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),(0,d.addDisposer)(e,(0,oe.autorun)((()=>{e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),(0,d.addDisposer)(e,(0,oe.autorun)((async()=>{const{assemblyName:t,onlyDisplayRelevantRegionsInCircularView:n,circularView:r,featureRefNames:a}=e,{tracks:o}=r,{assemblyManager:i}=(0,c.getSession)(e);if(!t)return;const s=await i.waitForAssembly(t);if(!s)return;const{getCanonicalRefName:l,regions:d=[]}=s;if(n){if(1===o.length)try{const e=new Set(a.map((e=>l(e)||e)));r.setDisplayedRegions(Qe()(d.filter((t=>e.has(t.refName)))))}catch(u){r.setError(u)}}else r.setDisplayedRegions(d)}),{name:"SvInspectorView displayed regions bind"})),(0,d.addDisposer)(e,(0,oe.reaction)((()=>({generatedTrackConf:null===e||void 0===e?void 0:e.featuresCircularTrackConfiguration,assemblyName:null===e||void 0===e?void 0:e.assemblyName})),(t=>{if(!t)return;const{assemblyName:n,generatedTrackConf:r}=t,{circularView:a}=e;a.tracks.forEach((e=>a.hideTrack(e.configuration.trackId))),n&&r&&a.addTrackConf(r,{assemblyName:n})}),{name:"SvInspectorView track configuration binding",fireImmediately:!0})),(0,d.addDisposer)(e,(0,oe.autorun)((()=>{e.spreadsheetView.setRowMenuItems([{label:"Open split detail view",icon:Po.Z,disabled:(t,n,r,a)=>!function(e,t,n,r,a){try{return Boolean(Io(e,t,n,r,a))}catch(o){return console.error("Unable to open breakpoint split view from table row",o),!1}}(e,t,n,a,r),onClick(t,n,r,a){!function(e,t,n,r,a){const o=Io(e,t,n,r,a);if(o){const{circularView:n}=e;o.views[0].offsetPx-=n.width/2+100,o.views[1].offsetPx-=n.width/2+100,(0,c.getSession)(t).addView("BreakpointSplitView",o)}}(e,t,n,a,r)}}])})))}})))};function Lo(e,t,n){const r=(0,c.getSession)(t);r.setSelection(e);const a=(0,c.getContainingView)(t),o=n.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(e,a);o.views[0].offsetPx-=a.width/2+100,o.views[1].offsetPx-=a.width/2+100,o.featureData=e.toJSON(),r.addView("BreakpointSplitView",o)}class Fo extends a.Z{constructor(){super(...arguments),this.name="SvInspectorViewPlugin"}install(e){(e=>{e.jexl.addFunction("defaultOnChordClick",Lo),e.addViewType((()=>{const t=No(e);return new ne.Z({name:"SvInspectorView",displayName:"SV inspector",stateModel:t,ReactComponent:To})}))})(e),(e=>{e.addToExtensionPoint("LaunchView-SvInspectorView",(async e=>{var t;let{session:n,assembly:r,uri:a,fileType:o}=e;const i=n.addView("SvInspectorView");if(!i)throw new Error("Failed to initialize view");const s=a.split(".");let l=null===s||void 0===s||null===(t=s.pop())||void 0===t?void 0:t.toUpperCase();var c;"GZ"===l&&(l=null===s||void 0===s||null===(c=s.pop())||void 0===c?void 0:c.toUpperCase()),i.spreadsheetView.importWizard.setFileType(o||l||""),i.spreadsheetView.importWizard.setSelectedAssemblyName(r),i.spreadsheetView.importWizard.setFileSource({uri:a,locationType:"UriLocation"}),await i.spreadsheetView.importWizard.import(r)}))})(e)}configure(e){(0,mo.J0)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:yo.Z,onClick:e=>{e.addView("SvInspectorView",{})}})}}var jo=n(622);const Do=(0,He.observer)((function(e){const{width:t,height:n}=e,r=Math.ceil(t);return(0,T.jsx)("div",{style:{position:"relative",width:r,height:n},children:(0,T.jsx)(k.PrerenderedCanvas,{...e,style:{position:"absolute",left:0,top:0}})})}));const Bo=(0,i.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:colorString(hsl(alpha(baseColor,min(1,count/(maxScore/20)))))",contextVariable:["count","maxScore","baseColor"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0});var Eo=n(96595),Vo=n(55619),zo=n(26138),Oo=n(93912);class Zo extends Eo.default{constructor(){super(...arguments),this.supportsSVG=!0}async makeImageData(e,t){const{features:n,config:r,bpPerPx:a,signal:o,resolution:s,sessionId:l,adapterConfig:d,regions:u}=t,[p]=u,{dataAdapter:h}=await(0,Oo.uP)(this.pluginManager,l,d),g=await h.getResolution(a/s)/(a*Math.sqrt(2)),f=(0,jo.V)((0,i.readConfObject)(r,"baseColor"));if(n.length){const m=n[0].bin1;let y=0,b=0,v=0;await(0,c.abortBreakPoint)(o);for(const{bin1:C,bin2:S,counts:k}of n)y=Math.max(k,y),b=Math.min(Math.min(C,S),b),v=Math.max(Math.max(C,S),v);function w(){e.scale(-1,1);const t=(p.end-p.start)/a;e.translate(-t,0)}await(0,c.abortBreakPoint)(o),!0===p.reversed&&w(),e.rotate(-Math.PI/4);let x=Date.now();for(const{bin1:T,bin2:P,counts:M}of n)e.fillStyle=(0,i.readConfObject)(r,"color",{count:M,maxScore:y,baseColor:f}),e.fillRect((T-m)*g,(P-m)*g,g,g),+Date.now()-x>400&&(await(0,c.abortBreakPoint)(o),x=+Date.now())}}async render(e){const{config:t,regions:n,bpPerPx:r}=e,[a]=n,o=(a.end-a.start)/r,s=(0,i.readConfObject)(t,"maxHeight"),l=await this.getFeatures(e),c=await(0,Vo.Cj)(o,s,e,(t=>this.makeImageData(t,{...e,features:l})));return{...await super.render({...e,...c,features:l,region:e.regions[0],height:s,width:o}),...c,height:s,width:o}}async getFeatures(e){const{regions:t,sessionId:n,adapterConfig:r}=e,{dataAdapter:a}=await(0,Oo.uP)(this.pluginManager,n,r);return await a.getFeatures(t[0],e).pipe((0,zo.q)()).toPromise()}}const Wo=e=>(0,i.ConfigurationSchema)("HicTrack",{},{baseConfiguration:(0,$.createBaseTrackConfig)(e)});const Ho=e=>(0,i.ConfigurationSchema)("LinearHicDisplay",{renderer:e.getRendererType("HicRenderer").configSchema},{baseConfiguration:_t.fU,explicitlyTyped:!0});const Go=e=>d.types.compose("LinearHicDisplay",_t.fV,d.types.model({type:d.types.literal("LinearHicDisplay"),configuration:(0,i.ConfigurationReference)(e),resolution:d.types.optional(d.types.number,1)})).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps(){const n=e.rendererType.configSchema.create((0,i.getConf)(e,"renderer")||{},(0,d.getEnv)(e));return{...t(),config:n,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution}}}})).actions((e=>({setResolution(t){e.resolution=t}}))).views((e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/2)}}]}]}}));const qo=(0,i.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}}},{explicitlyTyped:!0});class _o extends a.Z{constructor(){super(...arguments),this.name="HicPlugin"}install(e){(e=>{e.addAdapterType((()=>new $.AdapterType({name:"HicAdapter",displayName:"Hi-C adapter",configSchema:qo,getAdapterClass:()=>Promise.all([n.e(7886),n.e(9742)]).then(n.bind(n,29742)).then((e=>e.default))})))})(e),(e=>{e.addRendererType((()=>new Zo({name:"HicRenderer",ReactComponent:Do,configSchema:Bo,pluginManager:e})))})(e),(e=>{e.addTrackType((()=>{const t=Wo(e);return new pn.Z({name:"HicTrack",displayName:"Hi-C track",configSchema:t,stateModel:(0,s.createBaseTrackModel)(e,"HicTrack",t)})}))})(e),(e=>{e.addDisplayType((()=>{const t=Ho(e);return new $.DisplayType({name:"LinearHicDisplay",displayName:"Hi-C contact matrix display",configSchema:t,stateModel:Go(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:_t.qb})}))})(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,n,r)=>{const a="HicAdapter",o=(0,Y.getFileName)(t),i={type:a,hicLocation:t};return/\.hic/i.test(o)&&!r||r===a?i:e(t,n,r)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"HicAdapter"===t?"HicTrack":e(t)))}configure(e){const{jexl:t}=e;t.addFunction("alpha",((e,t)=>e.alpha(t))),t.addFunction("hsl",(e=>(0,jo.V)(e.toHsl()))),t.addFunction("colorString",(e=>e.toHex()))}}var Uo=n(24951);function Jo(e){try{return decodeURIComponent(e)}catch(t){return e}}function Xo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;const r=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,r-n)>0?"...":"")+e.slice(Math.max(0,r-n),r+t.length+n).trim()+(r+t.length<e.length?"...":"")}class Yo extends jt.BaseAdapter{constructor(e,t,n){super(e,t,n),this.indexingAttributes=void 0,this.trixJs=void 0,this.tracksNames=void 0;const r=(0,i.readConfObject)(e,"ixFilePath"),a=(0,i.readConfObject)(e,"ixxFilePath");if(!r)throw new Error("must provide out.ix");if(!a)throw new Error("must provide out.ixx");this.trixJs=new Uo.Z((0,z.openLocation)(a,n),(0,z.openLocation)(r,n),1500)}async searchIndex(e){const t=e.queryString.toLowerCase(),n=t.split(" "),r=(await this.trixJs.search(t)).filter((e=>{let[,t]=e;return n.every((e=>Jo(t).toLowerCase().includes(e)))})).map((e=>{let[t,n]=e;const r=JSON.parse(n.replaceAll("|",",")),[a,o,...i]=r.map((e=>Jo(e))),s=i.findIndex((e=>!!e)),l=i.map((e=>e.toLowerCase())).findIndex((e=>e.includes(t.toLowerCase()))),c=i[s],d=i[l],u=-1!==l?Xo(d,t):void 0,p=Xo(c,t),h=u&&p.toLowerCase()!==u.toLowerCase()?"".concat(p," (").concat(u,")"):p;return new Dt.Z({locString:a,label:c,displayString:h,matchedObject:r.map((e=>decodeURIComponent(e))),trackId:o})}));return"exact"===e.searchType?r.filter((t=>t.getLabel().toLowerCase()===e.queryString.toLowerCase())):r}freeResources(){}}const Qo=(0,i.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"},description:"the location of the trix ix file"},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"},description:"the location of the trix ixx file"},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"},description:"the location of the metadata json file for the trix index"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),Ko=class extends a.Z{constructor(){super(...arguments),this.name="TrixPlugin"}install(e){e.addTextSearchAdapterType((()=>new Ft.Z({name:"TrixTextSearchAdapter",displayName:"Trix text search adapter",configSchema:Qo,AdapterClass:Yo,description:"Trix adapter"})))}};var $o=n(80),ei=n(5118);const ti=d.types.compose(K.Region,d.types.model("Label",{label:d.types.optional(d.types.string,"")})).actions((e=>({setLabel(t){e.label=t}}))),ni=d.types.model("SharedBookmarksModel",{sharedBookmarks:d.types.maybe(d.types.array(ti))}),ri=()=>void 0!==typeof window?"bookmarks-".concat([window.location.host+window.location.pathname].join("-")):"empty";const ai=(0,i.ConfigurationSchema)("GridBookmarkWidget",{}),oi=e=>{e.addWidgetType((()=>new $.WidgetType({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:ai,stateModel:d.types.model("GridBookmarkModel",{id:K.ElementId,type:d.types.literal("GridBookmarkWidget"),bookmarks:d.types.optional(d.types.array(ti),(()=>JSON.parse((0,c.localStorageGetItem)(ri())||"[]")))}).volatile((()=>({selectedBookmarks:[],selectedAssembliesPre:void 0}))).views((e=>({get bookmarkAssemblies(){return[...new Set(e.bookmarks.map((e=>e.assemblyName)))]},get validAssemblies(){const{assemblyManager:t}=(0,c.getSession)(e);return new Set(this.bookmarkAssemblies.filter((e=>t.get(e))))}}))).views((e=>({get bookmarksWithValidAssemblies(){return e.bookmarks.filter((t=>e.validAssemblies.has(t.assemblyName)))}}))).views((e=>({get sharedBookmarksModel(){return ni.create({sharedBookmarks:JSON.parse(JSON.stringify(e.selectedBookmarks))})},get allBookmarksModel(){return ni.create({sharedBookmarks:JSON.parse(JSON.stringify(e.bookmarksWithValidAssemblies))})}}))).actions((e=>({setSelectedAssemblies(t){e.selectedAssembliesPre=t}}))).views((e=>({get selectedAssemblies(){var t,n;return null!==(t=null===(n=e.selectedAssembliesPre)||void 0===n?void 0:n.filter((t=>e.validAssemblies.has(t))))&&void 0!==t?t:[...e.validAssemblies]}}))).actions((e=>({importBookmarks(t){e.bookmarks=(0,d.cast)([...e.bookmarks,...t])},addBookmark(t){e.bookmarks.push(t)},removeBookmark(t){e.bookmarks.splice(t,1)},updateBookmarkLabel(e,t){e.correspondingObj.setLabel(t)},setSelectedBookmarks(t){e.selectedBookmarks=t},setBookmarkedRegions(t){e.bookmarks=(0,d.cast)(t)}}))).actions((e=>({clearAllBookmarks(){for(const t of e.bookmarks)e.validAssemblies.has(t.assemblyName)&&e.bookmarks.remove(t)},clearSelectedBookmarks(){for(const t of e.selectedBookmarks)e.bookmarks.remove(t.correspondingObj);e.selectedBookmarks=[]}}))).actions((e=>({afterAttach(){const t=ri();(0,d.addDisposer)(e,(0,oe.autorun)((()=>{(0,c.localStorageSetItem)(t,JSON.stringify(e.bookmarks))})))}}))).postProcessSnapshot((e=>{const{bookmarks:t,...n}=e;return n})),ReactComponent:(0,v.lazy)((()=>Promise.all([n.e(3650),n.e(7102),n.e(895)]).then(n.bind(n,40402))))})))},ii=class extends a.Z{constructor(){super(...arguments),this.name="GridBookmarkPlugin"}install(e){oi(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,n=t.actions((e=>({activateBookmarkWidget(){const t=(0,c.getSession)(e);if((0,c.isSessionModelWithWidgets)(t)){let e=t.widgets.get("GridBookmark");return e||(e=t.addWidget("GridBookmarkWidget","GridBookmark")),t.showWidget(e),t.widgets.get("GridBookmark")}throw new Error("Could not open bookmark widget")}}))).actions((e=>({navigateNewestBookmark(){const t=(0,c.getSession)(e),n=e.activateBookmarkWidget().bookmarks;null!==n&&void 0!==n&&n.length?e.navTo(n.at(-1)):t.notify("There are no recent bookmarks to navigate to.","info")},bookmarkCurrentRegion(){if(e.id===(0,c.getSession)(e).focusedViewId){const t=e.getSelectedRegions(void 0,void 0);e.activateBookmarkWidget().addBookmark(t[0])}}}))).views((e=>{const t=e.menuItems,n=e.rubberBandMenuItems;return{menuItems:()=>[...t(),{type:"divider"},{label:"Open bookmark widget",icon:ei.Z,onClick:()=>e.activateBookmarkWidget()},{label:"Bookmark current region",icon:$o.Z,onClick:()=>e.bookmarkCurrentRegion()}],rubberBandMenuItems:()=>[...n(),{label:"Bookmark region",icon:$o.Z,onClick:()=>{const{leftOffset:t,rightOffset:n}=e,r=e.getSelectedRegions(t,n);e.activateBookmarkWidget().addBookmark(r[0])}}]}})).actions((e=>({afterCreate(){document.addEventListener("keydown",(t=>{const n=(t.ctrlKey||t.metaKey)&&t.shiftKey;n&&"KeyD"===t.code&&(t.preventDefault(),e.activateBookmarkWidget(),e.bookmarkCurrentRegion(),(0,c.getSession)(e).notify("Bookmark created.","success")),n&&"KeyM"===t.code&&(t.preventDefault(),e.navigateNewestBookmark())}))}})));e.stateModel=n}return e}))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Bookmarks",icon:ei.Z,onClick:e=>{let t=e.widgets.get("GridBookmark");t||(t=e.addWidget("GridBookmarkWidget","GridBookmark")),e.showWidget(t)}})}},si=[pa,_t.ZP,r.ZP,G,Q,fe.ZP,me.ZP,ke.Z,Ct,kt,Mt,Nt,qt,kn,On,gr,xr,Er,ha.Z,ga.ZP,ba,fo,Fo,ge,_o,Ko,ii,Se,rr]},31158:()=>{}}]);
//# sourceMappingURL=2771.d40a5795.chunk.js.map