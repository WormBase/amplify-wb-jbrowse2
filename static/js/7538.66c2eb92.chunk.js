"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[7538],{37538:function(e,n,t){t.r(n),t.d(n,{default:function(){return ce}});var o=t(96234),i=t(33028),r=t(96902),s=t(4782),c=t(67540),l=t(88539),a=t(5966),d=t(15996),u=t(91188),f=t(27664),h=t(51467),g=t(29938),m=(0,u.ZL)()((function(e){return{fab:{position:"absolute",bottom:e.spacing(6),right:e.spacing(6)}}})),x=(0,s.observer)((function(e){var n=e.model,t=m().classes,i=(0,f.getSession)(n),s=(0,r.useState)(null),c=(0,o.Z)(s,2),u=c[0],x=c[1];function v(){x(null)}var k=(0,f.isSessionModelWithConnections)(i),j=(0,f.isSessionWithAddTracks)(i);return(0,g.jsx)(g.Fragment,{children:j||k?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(l.Z,{color:"secondary",className:t.fab,onClick:function(e){return x(e.currentTarget)},children:(0,g.jsx)(h.Z,{})}),(0,g.jsxs)(a.Z,{anchorEl:u,open:Boolean(u),onClose:function(){return x(null)},children:[k?(0,g.jsx)(d.Z,{onClick:function(){v(),(0,f.isSessionModelWithWidgets)(i)&&i.showWidget(i.addWidget("AddConnectionWidget","addConnectionWidget"))},children:"Add connection"}):null,j?(0,g.jsx)(d.Z,{onClick:function(){v(),(0,f.isSessionModelWithWidgets)(i)&&i.showWidget(i.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))},children:"Add track"}):null]})]}):null})})),v=t(32723),k=t(19869),j=t(35388),p=t(25322),b=t(41590),C=t(74859),Z=t(90001),y=t(90386);function S(e){return((null===e||void 0===e?void 0:e.children.map((function(e){return e.children.length?S(e):e.conf})))||[]).flat(1/0)}function W(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;e.id&&e.children.length&&n.set(e.id,e);for(var t=0;t<e.children.length;t++){W(e.children[t],n)}return n}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.endsWith("(Unsupported)")||e.endsWith("(Unknown)")}var w=(0,u.ZL)()((function(e){return{contrastColor:{color:e.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}}));function I(e){var n=e.isOpen,t=e.setOpen,i=e.data,s=w().classes,c=(0,r.useState)(null),l=(0,o.Z)(c,2),a=l[0],d=l[1],u=i.name,f=i.model,h=i.id,m=i.tree,x=i.toggleCollapse;return(0,g.jsxs)("div",{className:s.accordionText,onClick:function(){a||(x(h),t(!n))},children:[(0,g.jsxs)(j.Z,{children:[n?(0,g.jsx)(C.Z,{}):(0,g.jsx)(Z.Z,{}),u,(0,g.jsx)(p.Z,{onClick:function(e){d(e.currentTarget),e.stopPropagation()},className:s.contrastColor,children:(0,g.jsx)(y.Z,{})})]}),a?(0,g.jsx)(b.Z,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:function(){var e=W(m).get(h);f.addToSelection(S(e))}},{label:"Remove from selection",onClick:function(){var e=W(m).get(h);f.removeFromSelection(S(e))}}],onMenuItemClick:function(e,n){n(),d(null)},open:Boolean(a),onClose:function(){return d(null)}}):null]})}var M=t(68079),L=t(50543),A=t(80367),B=t(32114),N=t(99836),F=t(17867),O=(0,u.ZL)()((function(e){return{compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:e.palette.action.selected}}}}));function E(e){var n,t,i=e.data,s=O().classes,c=i.checked,l=i.conf,a=i.model,d=i.drawerPosition,u=i.id,h=i.name,m=i.onChange,x=i.selected,v=(0,r.useState)(),k=(0,o.Z)(v,2),j=k[0],C=k[1],Z=l&&(0,N.readConfObject)(l,["description"])||"";return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(L.Z,{title:Z+(x?" (in selection)":""),placement:"left"===d?"right":"left",children:(0,g.jsx)(A.Z,{className:s.checkboxLabel,control:(0,g.jsx)(B.Z,{className:s.compactCheckbox,checked:c,onChange:function(){return m(u)},disabled:T(h),inputProps:{"data-testid":"htsTrackEntry-".concat(u)}}),label:(0,g.jsx)("div",{style:{background:x?"#cccc":void 0},children:(0,g.jsx)(F.SanitizedHTML,{html:h})})})}),(0,g.jsx)(p.Z,{onClick:function(e){return C({target:e.currentTarget,id:u,conf:l})},style:{padding:0},"data-testid":"htsTrackEntryMenu-".concat(u),children:(0,g.jsx)(y.Z,{})}),j?(0,g.jsx)(b.Z,{anchorEl:null===j||void 0===j?void 0:j.target,menuItems:[].concat((0,M.Z)((null===(n=(t=(0,f.getSession)(a)).getTrackActionMenuItems)||void 0===n?void 0:n.call(t,j.conf))||[]),[{label:"Add to selection",onClick:function(){return a.addToSelection([j.conf])}}],(0,M.Z)(x?[{label:"Remove from selection",onClick:function(){return a.removeFromSelection([j.conf])}}]:[])),onMenuItemClick:function(e,n){n(),C(void 0)},open:Boolean(j),onClose:function(){return C(void 0)}}):null]})}var H=(0,u.ZL)()((function(e){return{accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:e.palette.tertiary.main,color:e.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}}));function P(e){var n=e.data,t=e.isOpen,o=e.style,i=e.setOpen,r=n.isLeaf,s=n.nestingLevel,c=H().classes,l=10*s+(r?10:0);return(0,g.jsxs)("div",{style:o,className:r?void 0:c.accordionBase,children:[new Array(s).fill(0).map((function(e,n){return(0,g.jsx)("div",{style:{left:10*n+4,height:null===o||void 0===o?void 0:o.height},className:c.nestingLevelMarker},"mark-".concat(n))})),(0,g.jsx)("div",{className:r?void 0:c.accordionCard,style:{marginLeft:l,whiteSpace:"nowrap",width:"100%"},children:(0,g.jsx)("div",{className:r?void 0:c.accordionColor,children:r?(0,g.jsx)(E,{data:n}):(0,g.jsx)(I,{isOpen:t,data:n,setOpen:i})})})]})}function D(e,n,t,o){var r=!!e.conf,s=!!o[e.id];return{data:(0,i.Z)((0,i.Z)({defaultHeight:r?22:40,isLeaf:r,isOpenByDefault:!0,nestingLevel:n,selected:s},e),t),nestingLevel:n,node:e}}var R=(0,s.observer)((function(e){var n=e.height,t=e.tree,o=e.model,i=o.filterText,s=o.selection,c=o.view,l=(0,r.useRef)(null),a=(0,f.getSession)(o).drawerPosition,d=(0,r.useMemo)((function(){return Object.fromEntries(s.map((function(e){return[e.trackId,e]})))}),[s]),u=(0,r.useMemo)((function(){return{onChange:function(e){return c.toggleTrack(e)},toggleCollapse:function(e){return o.toggleCategory(e)},tree:t,model:o,drawerPosition:a}}),[c,o,a,t]),h=(0,r.useCallback)((0,v.Z)().mark((function e(){var n,o,i,r,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.children.length)){e.next=8;break}return o=t.children[n],e.next=5,D(o,0,u,d);case 5:n++,e.next=1;break;case 8:return void(e.next=11);case 11:i=e.sent,r=0;case 13:if(!(r<i.node.children.length)){e.next=20;break}return s=i.node.children[r],e.next=17,D(s,i.nestingLevel+1,u,d);case 17:r++,e.next=13;break;case 20:e.next=8;break;case 22:case"end":return e.stop()}}),e)})),[t,u,d]);return(0,r.useEffect)((function(){l.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})}),[t,i]),(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(k.qF,{ref:l,treeWalker:h,height:n,children:P})})})),z=t(66519),_=t(5738),U=t(44536),q=t(30570),G=t(4645),J=(0,r.lazy)((function(){return Promise.all([t.e(8581),t.e(2501)]).then(t.bind(t,52501))})),K=(0,r.lazy)((function(){return t.e(7406).then(t.bind(t,87406))})),Q=(0,r.lazy)((function(){return t.e(6417).then(t.bind(t,56417))})),V=(0,r.lazy)((function(){return t.e(870).then(t.bind(t,30870))})),X=(0,u.ZL)()((function(e){return{menuIcon:{marginRight:e.spacing(1),marginBottom:0}}})),Y=(0,s.observer)((function(e){var n=e.model,t=e.setAssemblyIdx,i=(0,f.getSession)(n),s=(0,r.useState)(),c=(0,o.Z)(s,2),l=c[0],a=c[1],d=(0,r.useState)(),u=(0,o.Z)(d,2),h=u[0],m=u[1],x=(0,r.useState)(),v=(0,o.Z)(x,2),k=v[0],j=v[1],C=(0,r.useState)(!1),Z=(0,o.Z)(C,2),y=Z[0],S=Z[1],W=(0,r.useState)(!1),T=(0,o.Z)(W,2),w=T[0],I=T[1],L=X().classes,A=n.assemblyNames;function B(e,n){var t=(0,N.readConfObject)(e,"name"),r=i.prepareToBreakConnection(e);if(r){var s=(0,o.Z)(r,2),c=s[0],l=s[1];Object.keys(l).length>0?m({connectionConf:e,safelyBreakConnection:c,dereferenceTypeCount:l,name:t}):c()}n&&j({name:t,connectionConf:e})}var F=[{label:"Turn on/off connections...",onClick:function(){return S(!0)}}];(0,f.isSessionModelWithConnections)(i)&&(F.unshift({label:"Add connection...",onClick:function(){(0,f.isSessionModelWithWidgets)(i)&&i.showWidget(i.addWidget("AddConnectionWidget","addConnectionWidget"))}}),F.push({label:"Delete connections...",onClick:function(){return I(!0)}}));var O=[{label:"Add track...",onClick:function(){(0,f.isSessionModelWithWidgets)(i)&&i.showWidget(i.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))}}];return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(p.Z,{className:L.menuIcon,onClick:function(e){return a(e.currentTarget)},children:(0,g.jsx)(G.Z,{})}),(0,g.jsx)(b.Z,{anchorEl:l,open:Boolean(l),onMenuItemClick:function(e,n){n(),a(void 0)},onClose:function(){return a(void 0)},menuItems:[].concat((0,M.Z)((0,f.isSessionWithAddTracks)(i)?O:[]),(0,M.Z)(i.makeConnection?F:[]),(0,M.Z)(A.length>1?[{label:"Select assembly...",subMenu:A.map((function(e,n){return{label:e,onClick:function(){return t(n)}}}))}]:[]))}),(0,g.jsxs)(r.Suspense,{fallback:(0,g.jsx)("div",{}),children:[h?(0,g.jsx)(J,{modalInfo:h,setModalInfo:m}):null,k?(0,g.jsx)(K,{handleClose:function(){return j(void 0)},deleteDialogDetails:k,session:i}):null,w?(0,g.jsx)(Q,{handleClose:function(){return I(!1)},breakConnection:B,session:i}):null,y?(0,g.jsx)(V,{handleClose:function(){return S(!1)},session:i,breakConnection:B}):null]})]})})),$=t(35920),ee=(0,r.lazy)((function(){return Promise.all([t.e(534),t.e(615),t.e(1637),t.e(317)]).then(t.bind(t,71960))})),ne=(0,u.ZL)()((function(e){return{searchBox:{margin:e.spacing(2)},menuIcon:{marginRight:e.spacing(1),marginBottom:0}}}));var te=(0,s.observer)((function(e){var n=e.model,t=e.setHeaderHeight,i=e.setAssemblyIdx,s=ne().classes,c=(0,r.useState)(!1),l=(0,o.Z)(c,2),a=l[0],d=l[1],u=n.filterText;return(0,g.jsxs)("div",{ref:function(e){return t((null===e||void 0===e?void 0:e.getBoundingClientRect().height)||0)},"data-testid":"hierarchical_track_selector",children:[(0,g.jsxs)("div",{style:{display:"flex"},children:[(0,g.jsx)(Y,{model:n,setAssemblyIdx:i}),(0,g.jsx)($.Z,{model:n}),(0,g.jsx)(z.Z,{className:s.searchBox,label:"Filter tracks",value:u,onChange:function(e){return n.setFilterText(e.target.value)},fullWidth:!0,InputProps:{endAdornment:(0,g.jsx)(_.Z,{position:"end",children:(0,g.jsx)(p.Z,{onClick:function(){return n.clearFilterText()},children:(0,g.jsx)(q.Z,{})})})}}),(0,g.jsx)(U.Z,{className:s.menuIcon,onClick:function(){return d(!0)},children:"Open faceted selector"})]}),(0,g.jsx)(r.Suspense,{fallback:(0,g.jsx)("div",{}),children:a?(0,g.jsx)(ee,{handleClose:function(){return d(!1)},model:n}):null})]})})),oe=function(e){var n=e.tree,t=e.model,o=e.offset;return"undefined"===typeof jest?(0,g.jsx)(c.Z,{disableWidth:!0,children:function(e){var i=e.height;return(0,g.jsx)(R,{height:(i||o)-o,model:t,tree:n})}}):(0,g.jsx)(R,{height:9e3,model:t,tree:n})},ie=function(e){var n=e.overrideDimensions,t=e.children;return n?(0,g.jsx)("div",{style:(0,i.Z)({},n),children:t}):(0,g.jsx)(g.Fragment,{children:t})},re=(0,s.observer)((function(e){var n=e.model,t=e.toolbarHeight,o=e.overrideDimensions;return(0,g.jsxs)(ie,{overrideDimensions:o,children:[(0,g.jsx)(se,{model:n,toolbarHeight:t}),(0,g.jsx)(x,{model:n})]})})),se=(0,s.observer)((function(e){var n=e.model,t=e.toolbarHeight,i=void 0===t?0:t,s=(0,r.useState)(0),c=(0,o.Z)(s,2),l=c[0],a=c[1],d=(0,r.useState)(0),u=(0,o.Z)(d,2),f=u[0],h=u[1],m=n.assemblyNames[l];return m?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(te,{model:n,setHeaderHeight:h,setAssemblyIdx:a}),(0,g.jsx)(oe,{tree:n.hierarchy(m),model:n,offset:i+f})]}):null})),ce=re},35920:function(e,n,t){var o=t(33028),i=t(68079),r=t(96234),s=t(96902),c=t(25322),l=t(98453),a=t(91188),d=t(4782),u=t(41590),f=t(27664),h=t(87771),g=t(29938),m=(0,a.ZL)()((function(e){return{searchBox:{margin:e.spacing(2)},menuIcon:{marginRight:e.spacing(1),marginBottom:0}}}));n.Z=(0,d.observer)((function(e){var n=e.model,t=m().classes,a=n.selection,d=(0,f.getEnv)(n).pluginManager,x=(0,f.getSession)(n),v=(0,s.useState)(),k=(0,r.Z)(v,2),j=k[0],p=k[1],b=d.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:x});return(0,g.jsxs)(g.Fragment,{children:[a.length?(0,g.jsx)(c.Z,{className:t.menuIcon,onClick:function(e){return p(e.currentTarget)},children:(0,g.jsx)(l.Z,{badgeContent:a.length,color:"primary",children:(0,g.jsx)(h.Z,{})})}):null,(0,g.jsx)(u.Z,{anchorEl:j,open:Boolean(j),onMenuItemClick:function(e,n){n(),p(void 0)},onClose:function(){return p(void 0)},menuItems:[{label:"Clear",onClick:function(){return n.clearSelection()}}].concat((0,i.Z)(b.map((function(e){return(0,o.Z)((0,o.Z)({},e),"onClick"in e?{onClick:function(){return e.onClick(n)}}:{})}))))})]})}))}}]);
//# sourceMappingURL=7538.66c2eb92.chunk.js.map