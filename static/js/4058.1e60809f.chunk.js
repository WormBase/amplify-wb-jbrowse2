"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4058],{54058:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var r=a(66885),s=a(99546),n=a(32598),i=a(46377),l=a(99834);class o extends i.BaseFeatureDataAdapter{intervalTrees={};async getNames(){const{header:e,columnNames:t}=await this.loadData();if(t.length)return t;const a=e.split(/\n|\r\n|\r/).filter((e=>!!e)).at(-1);return a?.includes("\t")?a.slice(1).split("\t").map((e=>e.trim())):void 0}async loadFeatureIntervalTreeHelper(e){const{features:t}=await this.loadData(),a=t[e];if(!a)return;const r=(await this.getNames())?.slice(3)||[],i=new n.Ay;for(let e=0;e<a.length;e++){const t=a[e],[n,l,o,...c]=t.split("\t");for(let t=0;t<c.length;t++){const a=`${this.id}-${n}-${e}-${t}`,h=+l,u=+o,d=+c[t],f=r[t]||`col${t}`;d&&i.insert([h,u],new s.SimpleFeature({id:a,data:{refName:n,start:h,end:u,score:d,source:f}}))}}return i}async getRefNames(e={}){const{features:t}=await this.loadData(e);return Object.keys(t)}async loadDataP(e={}){const t=this.pluginManager,a=this.getConf("bedGraphLocation"),r=await(0,s.fetchAndMaybeUnzip)((0,l.openLocation)(a,t),e);if(r.length>536870888)throw new Error("Data exceeds maximum string length (512MB)");const n=new TextDecoder("utf8",{fatal:!0}).decode(r).split(/\n|\r\n|\r/).filter((e=>!!e)),i=[];let o=0;for(;o<n.length&&n[o].startsWith("#");o++)i.push(n[o]);const c=i.join("\n"),h={};for(;o<n.length;o++){const e=n[o],t=e.indexOf("\t"),a=e.slice(0,t);h[a]||(h[a]=[]),h[a].push(e)}return{header:c,features:h,columnNames:this.getConf("columnNames")}}async loadFeatureIntervalTree(e){return this.intervalTrees[e]||(this.intervalTrees[e]=this.loadFeatureIntervalTreeHelper(e).catch((t=>{throw this.intervalTrees[e]=void 0,t}))),this.intervalTrees[e]}async loadData(e={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(e).catch((e=>{throw this.bedFeatures=void 0,e}))),this.bedFeatures}getFeatures(e,t={}){return(0,r.ObservableCreate)((async t=>{const{start:a,end:r,refName:s}=e,n=await this.loadFeatureIntervalTree(s);n?.search([a,r]).forEach((e=>{t.next(e)})),t.complete()}))}freeResources(){}}}}]);
//# sourceMappingURL=4058.1e60809f.chunk.js.map