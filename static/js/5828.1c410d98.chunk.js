"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[5828],{55828:(e,t,i)=>{i.d(t,{doAfterAttach:()=>l});var o=i(31625),a=i(90872),n=i(56726),s=i(45627),r=i(85815),f=i(46997);function l(e){(0,o.addDisposer)(e,(0,r.autorun)((()=>{var t,i;const o=(0,a.getContainingView)(e);if(!o.initialized)return;const n=null===(t=e.mainCanvas)||void 0===t?void 0:t.getContext("2d"),s=null===(i=e.cigarClickMapCanvas)||void 0===i?void 0:i.getContext("2d");if(!n||!s)return;const r=o.middleComparativeHeight,l=o.width;n.clearRect(0,0,l,r),s.clearRect(0,0,l,r),(0,f.Bf)(e,n,s)}))),(0,o.addDisposer)(e,(0,r.autorun)((()=>{(0,a.getContainingView)(e).initialized&&(0,f.z8)(e)}))),(0,o.addDisposer)(e,(0,r.reaction)((()=>{const t=(0,a.getContainingView)(e);return{bpPerPx:t.views.map((e=>e.bpPerPx)),displayedRegions:JSON.stringify(t.views.map((e=>e.displayedRegions))),features:e.features,initialized:t.initialized}}),(t=>{let{initialized:i}=t;if(!i)return;const{assemblyManager:r}=(0,a.getSession)(e),f=(0,a.getContainingView)(e).views.map((e=>({...(0,o.getSnapshot)(e),width:e.width,staticBlocks:e.staticBlocks,interRegionPaddingWidth:e.interRegionPaddingWidth,minimumBlockWidth:e.minimumBlockWidth}))),l=[],c=e.features||[];for(const e of c){const t=e.get("mate");let i=e.get("start"),o=e.get("end");const a=t.start,c=t.end;-1===e.get("strand")&&([o,i]=[i,o]);const d=null===r||void 0===r?void 0:r.get(e.get("assemblyName")),h=null===r||void 0===r?void 0:r.get(t.assemblyName),g=e.get("refName"),v=t.refName,m=(null===d||void 0===d?void 0:d.getCanonicalRefName(g))||g,u=(null===h||void 0===h?void 0:h.getCanonicalRefName(v))||v,b=f[0],p=f[1],w=(0,n.R)({self:b,refName:m,coord:i}),C=(0,n.R)({self:b,refName:m,coord:o}),M=(0,n.R)({self:p,refName:u,coord:a}),P=(0,n.R)({self:p,refName:u,coord:c});if(void 0===w||void 0===C||void 0===M||void 0===P)continue;const x=e.get("CIGAR");l.push({p11:w,p12:C,p21:M,p22:P,f:e,cigar:s.MismatchParser.parseCigar(x)})}e.setFeatPositions(l)}),{fireImmediately:!0}))}},46997:(e,t,i)=>{i.d(t,{EU:()=>s,z8:()=>g,Bf:()=>h,zv:()=>d});var o=i(90872);function a(e){let{feature:t,ctx:i,offsets:a,cb:s,height:r,drawCurves:f,oobLimit:l,viewWidth:c,hideTiny:d}=e;const{p11:h,p12:g,p21:v,p22:m}=t,u=h.offsetPx-a[0],b=g.offsetPx-a[0],p=v.offsetPx-a[1],w=m.offsetPx-a[1],C=Math.abs(b-u),M=Math.abs(w-p),P=r,x=(P-0)/2,y=Math.min(p,w),T=Math.max(p,w);(0,o.doesIntersect2)(y,T,-l,c+l)&&(C<=1&&M<=1?d||(i.beginPath(),i.moveTo(u,0),f?i.bezierCurveTo(u,x,p,x,p,P):i.lineTo(p,P),i.stroke()):(n(i,u,b,0,w,p,P,x,f),s(i)))}function n(e,t,i,o,a,n,s,r,f){f?function(e,t,i,o,a,n,s,r){const f=Math.abs(t-i),l=Math.abs(t-i);if(f<5&&l<5&&i<t&&Math.abs(t-a)>100){const e=t;t=i,i=e}e.beginPath(),e.moveTo(t,o),e.lineTo(i,o),e.bezierCurveTo(i,r,a,r,a,s),e.lineTo(n,s),e.bezierCurveTo(n,r,t,r,t,o),e.closePath(),e.fill()}(e,t,i,o,a,n,s,r):function(e,t,i,o,a,n,s){e.beginPath(),e.moveTo(t,o),e.lineTo(i,o),e.lineTo(a,s),e.lineTo(n,s),e.closePath(),e.fill()}(e,t,i,o,a,n,s)}const s=16581375;function r(e){const t=Math.floor(e/65025)%255,i=Math.floor(e/255)%255,o=e%255;return"rgb(".concat(t,",").concat(i,",").concat(o,")")}const f={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},l=3,c=1600;function d(e,t,i,o){return Math.floor((255*e*255+255*t+i-1)/o)}function h(e,t,i){var d;const h=(0,o.getContainingView)(e),g=h.drawCurves,v=h.drawCIGAR,m=h.middleComparativeHeight,u=h.width,b=h.views.map((e=>e.bpPerPx));i&&(i.imageSmoothingEnabled=!1),t.beginPath();const p=e.featPositions,w=h.views.map((e=>e.offsetPx)),C=Math.floor(s/p.length);t.fillStyle=f.M,t.strokeStyle=f.M;for(const{p11:o,p12:a,p21:n,p22:s}of p){const e=o.offsetPx-w[0],i=a.offsetPx-w[0],r=n.offsetPx-w[1],f=s.offsetPx-w[1],d=Math.abs(i-e),h=Math.abs(f-r),v=0,b=m,p=(b-v)/2;d<=l&&h<=l&&r<u+c&&r>-c&&(t.moveTo(e,v),g?t.bezierCurveTo(e,p,r,p,r,b):t.lineTo(r,b))}t.stroke(),t.fillStyle=f.M,t.strokeStyle=f.M;for(const{p11:a,p12:P,p21:x,p22:y,f:T,cigar:k}of p){const e=a.offsetPx-w[0],d=P.offsetPx-w[0],p=x.offsetPx-w[1],C=y.offsetPx-w[1],M=Math.abs(d-e),R=Math.abs(C-p),S=Math.min(p,C),N=Math.max(p,C),z=0,I=m,W=(I-z)/2;if(!(M<=l&&R<=l)&&(0,o.doesIntersect2)(S,N,-c,h.width+c)){const o=T.get("strand"),a=-1===o?d:e,l=a<(-1===o?e:d)?1:-1,c=(p<C?1:-1)*o;let h=a,m=-1===o?C:p;if(null!==k&&void 0!==k&&k.length&&v){let e=!1,o=0,a=0;const d=Math.floor(s/k.length);for(let s=0;s<k.length;s+=2){const v=s*d+1,p=+k[s],w=k[s+1];e||(o=h,a=m);const C=p/b[0],M=p/b[1];if("M"===w||"="===w||"X"===w?(h+=C*l,m+=M*c):"D"===w||"N"===w?h+=C*l:"I"===w&&(m+=M*c),!(Math.max(o,a,h,m)<0||Math.min(o,a,h,m)>u)){const l=s<k.length-2;Math.abs(h-o)<=1&&Math.abs(m-a)<=1&&l?e=!0:(e=!1,t.fillStyle=f[e&&C>1||M>1?w:"M"],n(t,o,h,z,m,a,I,W,g),i&&(i.fillStyle=r(v),n(i,o,h,z,m,a,I,W,g)))}}}else n(t,e,d,z,C,p,I,W,g)}}const M=null===(d=e.clickMapCanvas)||void 0===d?void 0:d.getContext("2d");if(M){M.imageSmoothingEnabled=!1,M.clearRect(0,0,u,m);for(let e=0;e<p.length;e++){const t=p[e],i=e*C+1;M.fillStyle=r(i),a({cb:e=>e.fill(),feature:t,ctx:M,drawCurves:g,offsets:w,oobLimit:c,viewWidth:h.width,hideTiny:!0,height:m})}}}function g(e){var t;const{clickId:i,mouseoverId:n}=e,s=(0,o.getContainingView)(e),r=s.drawCurves,f=s.middleComparativeHeight,l=s.width,d=null===(t=e.mouseoverCanvas)||void 0===t?void 0:t.getContext("2d"),h=s.views.map((e=>e.offsetPx));if(!d)return;d.resetTransform(),d.scale(1,1),d.clearRect(0,0,l,f);const g=e.featMap[n||""];g&&(d.fillStyle="rgb(0,0,0,0.1)",a({cb:e=>e.fill(),feature:g,ctx:d,oobLimit:c,viewWidth:s.width,drawCurves:r,offsets:h,height:f}));const v=e.featMap[i||""];v&&(d.strokeStyle="rgb(0, 0, 0, 0.9)",a({cb:e=>e.stroke(),feature:v,ctx:d,oobLimit:c,viewWidth:s.width,drawCurves:r,offsets:h,height:f}))}}}]);
//# sourceMappingURL=5828.1c410d98.chunk.js.map