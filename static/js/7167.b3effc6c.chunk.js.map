{"version":3,"file":"static/js/7167.b3effc6c.chunk.js","mappings":"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","sources":["../../../plugins/wiggle/src/MultiWiggleAdapter/MultiWiggleAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature, min, max } from '@jbrowse/core/util'\nimport { merge } from 'rxjs'\nimport { map } from 'rxjs/operators'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nfunction getFilename(uri: string) {\n  const filename = uri.slice(uri.lastIndexOf('/') + 1)\n  return filename.slice(0, filename.lastIndexOf('.'))\n}\n\ninterface AdapterEntry {\n  dataAdapter: BaseFeatureDataAdapter\n  source: string\n  [key: string]: unknown\n}\n\nexport default class MultiWiggleAdapter extends BaseFeatureDataAdapter {\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  public async getAdapters(): Promise<AdapterEntry[]> {\n    const getSubAdapter = this.getSubAdapter\n    if (!getSubAdapter) {\n      throw new Error('no getSubAdapter available')\n    }\n    let subConfs = this.getConf('subadapters')\n    if (!subConfs?.length) {\n      const entries = this.getConf('bigWigs') as string[]\n      subConfs = entries.map(entry => ({\n        type: 'BigWigAdapter',\n        source: getFilename(entry),\n        bigWigLocation: {\n          uri: entry,\n        },\n      }))\n    }\n\n    return Promise.all(\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      subConfs.map(async (conf: any) => {\n        const dataAdapter = (await getSubAdapter(conf))\n          .dataAdapter as BaseFeatureDataAdapter\n        return {\n          source: conf.name || dataAdapter.id,\n          ...conf,\n          dataAdapter,\n        }\n      }),\n    )\n  }\n\n  // note: can't really have dis-agreeing refNames\n  public async getRefNames(opts?: BaseOptions) {\n    const adapters = await this.getAdapters()\n    const allNames = await Promise.all(\n      adapters.map(a => a.dataAdapter.getRefNames(opts)),\n    )\n    return [...new Set(allNames.flat())]\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const adapters = await this.getAdapters()\n    const stats = (\n      await Promise.all(\n        // @ts-expect-error\n        adapters.map(adp => adp.dataAdapter.getGlobalStats?.(opts)),\n      )\n    ).filter(f => !!f)\n    const scoreMin = min(stats.map(s => s.scoreMin))\n    const scoreMax = max(stats.map(s => s.scoreMax))\n    return { scoreMin, scoreMax }\n  }\n\n  public getFeatures(region: Region, opts: WiggleOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const adapters = await this.getAdapters()\n      merge(\n        ...adapters.map(adp =>\n          adp.dataAdapter.getFeatures(region, opts).pipe(\n            map(p =>\n              // add source field if it does not exist\n              p.get('source')\n                ? p\n                : new SimpleFeature({\n                    ...p.toJSON(),\n                    uniqueId: `${adp.source}-${p.id()}`,\n                    source: adp.source,\n                  }),\n            ),\n          ),\n        ),\n      ).subscribe(observer)\n    }, opts.signal)\n  }\n\n  // always render bigwig instead of calculating a feature density for it\n  async getMultiRegionFeatureDensityStats(_regions: Region[]) {\n    return { featureDensity: 0 }\n  }\n\n  // in another adapter type, this could be dynamic depending on region or\n  // something, but it is static for this particular multi-wiggle adapter type\n  async getSources() {\n    const adapters = await this.getAdapters()\n    return adapters.map(({ dataAdapter, source, name, ...rest }) => ({\n      name: source,\n      __name: name,\n      ...rest,\n    }))\n  }\n\n  public freeResources(): void {}\n}\n"],"names":["getFilename","uri","filename","slice","lastIndexOf","MultiWiggleAdapter","_BaseFeatureDataAdapt","_getAdapters","_getRefNames","_getGlobalStats","_getMultiRegionFeatureDensityStats","_getSources","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","_subConfs","_ref","getSubAdapter","subConfs","entries","wrap","_context2","prev","next","this","Error","getConf","length","map","entry","type","source","bigWigLocation","abrupt","Promise","all","_x","_callee","conf","dataAdapter","_context","sent","_objectSpread","name","id","stop","_x2","_callee3","opts","adapters","allNames","_context3","getAdapters","a","getRefNames","_toConsumableArray","Set","flat","_x3","_callee4","stats","scoreMin","scoreMax","_context4","adp","_adp$dataAdapter$getG","_adp$dataAdapter","getGlobalStats","call","filter","f","min","s","max","region","_ref2","_this","undefined","ObservableCreate","_x4","_callee5","observer","_context5","merge","getFeatures","pipe","p","get","SimpleFeature","toJSON","uniqueId","concat","subscribe","signal","_x5","_callee6","_regions","_context6","featureDensity","_callee7","_context7","_ref3","rest","_objectWithoutProperties","_excluded","__name","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}