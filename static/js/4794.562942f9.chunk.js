"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[4794,6824],{16824:function(e,t,r){r.r(t),r.d(t,{default:function(){return Z}});var n=r(41361),a=r(32723),i=r(34795),u=r(9249),s=r(87371),c=r(93069),o=r(95058),f=r(45754),h=r(13820),d=r(77431),p=r(20783),l=r(81073),g=r(33528),v=r(26131),k=r(95915),m=r(81450),b=r(33028),y=r(68079),x=r(46079),_=function(){function e(t,r,n){(0,u.Z)(this,e),this.record=t,this.adapter=r,this.ref=n}return(0,s.Z)(e,[{key:"_get_name",value:function(){return this.record.get("name")}},{key:"_get_type",value:function(){return"match"}},{key:"_get_score",value:function(){return this.record.get("mq")}},{key:"_get_flags",value:function(){return this.record.flags}},{key:"_get_strand",value:function(){return this.record.isReverseComplemented()?-1:1}},{key:"_get_pair_orientation",value:function(){return this.record.isPaired()?this.record.getPairOrientation():void 0}},{key:"_get_next_ref",value:function(){return this.record.isPaired()?this.adapter.refIdToName(this.record._next_refid()):void 0}},{key:"_get_next_pos",value:function(){return this.record.isPaired()?this.record._next_pos():void 0}},{key:"_get_next_segment_position",value:function(){return this.record.isPaired()?"".concat(this.adapter.refIdToName(this.record._next_refid()),":").concat(this.record._next_pos()+1):void 0}},{key:"_get_seq",value:function(){return this.record.getReadBases()}},{key:"qualRaw",value:function(){return this.record.qualRaw()}},{key:"set",value:function(){}},{key:"tags",value:function(){var t=Object.getOwnPropertyNames(e.prototype);return(0,y.Z)(new Set(t.filter((function(e){return e.startsWith("_get_")&&"_get_mismatches"!==e&&"_get_tags"!==e})).map((function(e){return e.replace("_get_","")})).concat(this.record._tags())))}},{key:"id",value:function(){return"".concat(this.adapter.id,"-").concat(this.record.id())}},{key:"get",value:function(e){var t="_get_".concat(e);return this[t]?this[t]():this.record.get(e)}},{key:"_get_refName",value:function(){return this.adapter.refIdToName(this.record.seq_id())}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"pairedFeature",value:function(){return!1}},{key:"toJSON",value:function(){var e=this;return(0,b.Z)((0,b.Z)({},Object.fromEntries(this.tags().map((function(t){return[t,e.get(t)]})).filter((function(e){return void 0!==e[1]})))),{},{uniqueId:this.id()})}},{key:"_get_mismatches",value:function(){return(0,x.getMismatches)(this.get("CIGAR"),this.get("MD"),this.get("seq"),this.ref,this.qualRaw())}},{key:"_get_clipPos",value:function(){var e=this.get("CIGAR")||"";return(0,x.getClip)(e,this.get("strand"))}}]),e}(),Z=function(e,t,r,p,b,y,x,Z,w){(0,f.Z)(S,e);var P=(0,h.Z)(S);function S(){var e;(0,u.Z)(this,S);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=P.call.apply(P,[this].concat(r))).samHeader=void 0,e.setupP=void 0,e.configureP=void 0,e}return(0,s.Z)(S,[{key:"configurePre",value:function(){return(t=t||(0,i.Z)((0,a.Z)().mark((function e(){var t,r,n,i,u,s,c,o,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getConf("bamLocation"),r=this.getConf(["index","location"]),n=this.getConf(["index","indexType"]),i=this.pluginManager,u="CSI"===n,s=new d.$({bamFilehandle:(0,g.openLocation)(t,i),csiFilehandle:u?(0,g.openLocation)(r,i):void 0,baiFilehandle:u?void 0:(0,g.openLocation)(r,i),yieldThreadTime:1/0}),!(c=this.getConf("sequenceAdapter"))||!this.getSubAdapter){e.next=15;break}return e.next=10,this.getSubAdapter(c);case 10:return o=e.sent,f=o.dataAdapter,e.abrupt("return",{bam:s,sequenceAdapter:f});case 15:return e.abrupt("return",{bam:s});case 16:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"configure",value:function(){return(r=r||(0,i.Z)((0,a.Z)().mark((function e(){var t=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.configureP||(this.configureP=this.configurePre().catch((function(e){throw t.configureP=void 0,e}))),e.abrupt("return",this.configureP);case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getHeader",value:function(e){return(p=p||(0,i.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:return r=e.sent,n=r.bam,e.abrupt("return",n.getHeaderText(t));case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"setupPre",value:function(e){return(b=b||(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,u,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t||{}).statusCallback,n=void 0===r?function(){}:r,e.next=3,this.configure();case 3:return u=e.sent,s=u.bam,e.next=7,(0,l.updateStatus)("Downloading index",n,(0,i.Z)((0,a.Z)().mark((function e(){var r,n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getHeader(t);case 2:return r=e.sent,n=[],i={},null===r||void 0===r||r.filter((function(e){return"SQ"===e.tag})).forEach((function(e,t){e.data.forEach((function(e){if("SN"===e.tag){var r=e.value;i[r]=t,n[t]=r}}))})),e.abrupt("return",{idToName:n,nameToId:i});case 7:case"end":return e.stop()}}),e)}))));case 7:return this.samHeader=e.sent,e.abrupt("return",this.samHeader);case 9:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"setup",value:function(e){return(y=y||(0,i.Z)((0,a.Z)().mark((function e(t){var r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw r.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getRefNames",value:function(e){return(x=x||(0,i.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setup(t);case 2:return r=e.sent,n=r.idToName,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"seqFetch",value:function(e,t,r){return(Z=Z||(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var i,u,s,c,o,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:if(i=e.sent,u=i.sequenceAdapter,s=u){e.next=7;break}return e.abrupt("return",void 0);case 7:if(t){e.next=9;break}return e.abrupt("return",void 0);case 9:return c=s.getFeatures({refName:t,start:r,end:n,assemblyName:""}),e.next=12,(0,m.z)(c.pipe((0,k.q)()));case 12:if(o=e.sent,f="",o.sort((function(e,t){return e.get("start")-t.get("start")})).forEach((function(e){var t=e.get("start"),a=e.get("end"),i=Math.max(r-t,0),u=Math.min(n-t,a-t)-i,s=e.get("seq")||e.get("residues");f+=s.slice(i,i+u)})),f.length===n-r){e.next=17;break}throw new Error("sequence fetch failed: fetching ".concat(t,":").concat((r-1).toLocaleString(),"-").concat(n.toLocaleString()," returned ").concat(f.length.toLocaleString()," bases, but should have returned ").concat((n-r).toLocaleString()));case 17:return e.abrupt("return",f);case 18:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getFeatures",value:function(e,t){var r,u=this,s=e.refName,c=e.start,o=e.end,f=e.originalRefName,h=t||{},d=h.signal,p=h.filterBy,g=h.statusCallback,k=void 0===g?function(){}:g;return(0,v.ObservableCreate)((function(e){return(r=r||(0,i.Z)((0,a.Z)().mark((function e(r){var h,d,g;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.configure();case 2:return h=e.sent,d=h.bam,e.next=6,u.setup(t);case 6:return e.next=8,(0,l.updateStatus)("Downloading alignments",k,(function(){return d.getRecordsForRange(s,c,o,t)}));case 8:return g=e.sent,e.next=11,(0,l.updateStatus)("Processing alignments",k,(0,i.Z)((0,a.Z)().mark((function e(){var t,i,c,o,h,d,l,v,k,m,b,y,x;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(t=p||{}).flagInclude,c=void 0===i?0:i,o=t.flagExclude,h=void 0===o?0:o,d=t.tagFilter,l=t.readName,v=(0,n.Z)(g),e.prev=2,v.s();case 4:if((k=v.n()).done){e.next=23;break}if(m=k.value,b=void 0,m.get("MD")){e.next=11;break}return e.next=10,u.seqFetch(f||s,m.get("start"),m.get("end"));case 10:b=e.sent;case 11:if(((y=m.flags)&c)===c||y&h){e.next=14;break}return e.abrupt("continue",21);case 14:if(!d){e.next=18;break}if("*"===(x=m.get(d.tag))?void 0!==x:"".concat(x)===d.value){e.next=18;break}return e.abrupt("continue",21);case 18:if(!l||m.get("name")===l){e.next=20;break}return e.abrupt("continue",21);case 20:r.next(new _(m,u,b));case 21:e.next=4;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(2),v.e(e.t0);case 28:return e.prev=28,v.f(),e.finish(28);case 31:r.complete();case 32:case"end":return e.stop()}}),e,null,[[2,25,28,31]])}))));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}),d)}},{key:"getMultiRegionFeatureDensityStats",value:function(e,t){return(w=w||(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,u,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:if(n=e.sent,!(i=n.bam).index){e.next=12;break}return e.next=7,(0,l.bytesForRegions)(t,i);case 7:return u=e.sent,s=this.getConf("fetchSizeLimit"),e.abrupt("return",{bytes:u,fetchSizeLimit:s});case 12:return e.abrupt("return",(0,c.Z)((0,o.Z)(S.prototype),"getMultiRegionFeatureDensityStats",this).call(this,t,r));case 13:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"freeResources",value:function(){}},{key:"refIdToName",value:function(e){var t;return null===(t=this.samHeader)||void 0===t?void 0:t.idToName[e]}}]),S}(p.BaseFeatureDataAdapter)},64794:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var n=r(32723),a=r(34795),i=r(9249),u=r(87371),s=r(45754),c=r(13820),o=r(77431),f=function(e,t){(0,s.Z)(f,e);var r=(0,c.Z)(f);function f(){return(0,i.Z)(this,f),r.apply(this,arguments)}return(0,u.Z)(f,[{key:"configurePre",value:function(){return(t=t||(0,a.Z)((0,n.Z)().mark((function e(){var t,r,a,i,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getConf("htsgetBase"),r=this.getConf("htsgetTrackId"),a=new o.S5({baseUrl:t,trackId:r}),!(i=this.getConf("sequenceAdapter"))||!this.getSubAdapter){e.next=9;break}return e.next=7,this.getSubAdapter(i);case 7:return u=e.sent,e.abrupt("return",{bam:a,sequenceAdapter:u.dataAdapter});case 9:return e.abrupt("return",{bam:a});case 10:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}}]),f}(r(16824).default)}}]);
//# sourceMappingURL=4794.562942f9.chunk.js.map