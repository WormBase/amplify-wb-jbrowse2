"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7649],{17649:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var o=n(7552),a=n(75785),r=n(68446),i=n(49823),s=n(99546),l=n(42489),c=n(18283),f=n(48231),u=n(57833),d=n(77089);function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},g.apply(null,arguments)}const h=(0,a.n9)()((e=>({tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,c.X4)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:(1.4,Math.round(14e4)/1e5+"em"),maxWidth:300,wordWrap:"break-word"}}))),m=(0,r.observer)((function({title:e}){const t=(0,f.A)(),{classes:n}=h(),{refs:a,floatingStyles:r,context:s}=(0,d.we)({placement:"right",strategy:"fixed"}),l=(0,d.ju)(s),{getFloatingProps:c}=(0,d.bv)([l]),m=t?.components?.MuiPopper;return e?o.createElement(u.Z,{container:m?.defaultProps?.container},o.createElement("div",g({className:n.tooltip,ref:a.setFloating,style:{...r,zIndex:1e5,pointerEvents:"none"}},c()),o.createElement(i.SanitizedHTML,{html:e}))):null}));var v=n(30385);function p({model:e,onClose:t,anchorEl:n}){const a=(0,s.getContainingView)(e),{clientX:r,clientY:l,feature:c}=n;return o.createElement(i.Menu,{onMenuItemClick:(e,n)=>{n(e),t()},anchorEl:{nodeType:1,getBoundingClientRect:()=>({top:l,left:r,bottom:l,right:r,width:0,height:0,x:r,y:l,toJSON(){}})},onClose:t,open:Boolean(n),menuItems:[{label:"Center on feature",onClick:()=>{const{f:t}=c,n=t.get("start"),o=t.get("end"),r=t.get("refName"),i=t.get("mate");a.views[0].navToLocString(`${r}:${n}-${o}`).catch((t=>{console.error(t),(0,s.getSession)(e).notifyError(`${t}`,t)})),a.views[1].navToLocString(`${i.refName}:${i.start}-${i.end}`).catch((t=>{console.error(t),(0,s.getSession)(e).notifyError(`${t}`,t)}))}}]})}var b=n(79610);const C=(0,a.n9)()({pix:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},rel:{position:"relative"},abs:{position:"absolute"},none:{pointEvents:"none"}}),M=(0,r.observer)((function({model:e}){const{classes:t,cx:n}=C(),a=(0,o.useRef)(0),r=(0,o.useRef)(),i=(0,s.getContainingView)(e),c=i.width,f=(0,o.useRef)(0),u=(0,o.useRef)(),[d,g]=(0,o.useState)(),[h,M]=(0,o.useState)(""),[x,w]=(0,o.useState)(),[S,k]=(0,o.useState)(),[y,P]=(0,o.useState)(),[E,T]=(0,o.useState)(),{mouseoverId:$,height:I}=e,R=(0,o.useCallback)((t=>e.setMouseoverCanvasRef(t)),[e,I,c]),X=(0,o.useCallback)((t=>{e.setMainCanvasRef(t),t&&t.addEventListener("wheel",(function(e){if(!0===e.ctrlKey){e.preventDefault(),f.current+=e.deltaY/500;for(const e of i.views)e.setScaleFactor(f.current<0?1-f.current:1/(1+f.current));u.current&&clearTimeout(u.current),u.current=setTimeout((()=>{for(const n of i.views)n.setScaleFactor(1),n.zoomTo(f.current>0?n.bpPerPx*(1+f.current):n.bpPerPx/(1-f.current),e.clientX-(t?.getBoundingClientRect().left||0));f.current=0}),300)}else Math.abs(e.deltaY)<Math.abs(e.deltaX)&&(e.preventDefault(),a.current+=e.deltaX/2),void 0===r.current&&(r.current=requestAnimationFrame((()=>{(0,l.transaction)((()=>{for(const e of i.views)e.horizontalScroll(a.current);a.current=0,r.current=void 0}))})))}))}),[e,I,c]),N=(0,o.useCallback)((t=>e.setClickMapCanvasRef(t)),[e,I,c]),L=(0,o.useCallback)((t=>e.setCigarClickMapCanvasRef(t)),[e,I,c]);return o.createElement("div",{className:t.rel},o.createElement("canvas",{ref:R,width:c,height:I,className:n(t.abs,t.none)}),o.createElement("canvas",{ref:X,onMouseMove:t=>{if(void 0!==S)a.current+=S-t.clientX,k(t.clientX),void 0===r.current&&(r.current=requestAnimationFrame((()=>{(0,l.transaction)((()=>{for(const e of i.views)e.horizontalScroll(a.current);a.current=0,r.current=void 0}))})));else{const n=e.clickMapCanvas,o=e.cigarClickMapCanvas;if(!n||!o)return;const a=n.getBoundingClientRect(),r=n.getContext("2d"),i=o.getContext("2d");if(!r||!i)return;const{clientX:s,clientY:l}=t,c=s-a.left,f=l-a.top;w(s),T(l);const[u,d,g]=r.getImageData(c,f,1,1).data,[h,m,p]=i.getImageData(c,f,1,1).data,C=Math.floor(v.xx/e.numFeats),x=(0,v.OX)(u,d,g,C);if(e.setMouseoverId(e.featPositions[x]?.f.id()),-1===x)M("");else if(e.featPositions[x]){const{f:t,cigar:n}=e.featPositions[x],o=Math.floor(v.xx/n.length),a=(0,v.OX)(h,m,p,o);M((0,b.Eg)(t,n[a],n[a+1]))}}},onMouseLeave:()=>{e.setMouseoverId(void 0),P(void 0),k(void 0)},onMouseDown:e=>{k(e.clientX),P(e.clientX)},onMouseUp:t=>{k(void 0),void 0!==y&&Math.abs(t.clientX-y)<5&&(0,b.WT)(t,e)},onContextMenu:t=>(0,b.f0)(t,e,g),"data-testid":"synteny_canvas",className:t.abs,width:c,height:I}),o.createElement("canvas",{ref:N,className:t.pix,width:c,height:I}),o.createElement("canvas",{ref:L,className:t.pix,width:c,height:I}),$&&h&&x&&E?o.createElement(m,{title:h}):null,d?o.createElement(p,{model:e,anchorEl:d,onClose:()=>g(void 0)}):null)})),x=(0,a.n9)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:10},blockError:{background:"#f1f1f1",padding:10,color:"red"}}}));function w(){const[e,t]=(0,o.useState)(!1),{classes:n}=x();return(0,o.useEffect)((()=>{const e=setTimeout((()=>t(!0)),300);return()=>clearTimeout(e)})),e?o.createElement("div",{className:n.loading},o.createElement(i.LoadingEllipses,null)):null}function S({messageText:e}){const{classes:t}=x();return o.createElement("div",{className:t.blockMessage},e)}function k({error:e}){const{classes:t}=x();return o.createElement("div",{className:t.blockError},`${e}`)}const y=(0,r.observer)((function({model:e}){return e.error?o.createElement(k,{error:e.error}):e.message?o.createElement(S,{messageText:e.message}):e.features?o.createElement(M,{model:e}):o.createElement(w,null)}))},79610:(e,t,n)=>{n.d(t,{$2:()=>i,Eg:()=>c,WT:()=>s,f0:()=>l,mr:()=>r});var o=n(99546),a=n(30385);function r({feature:e,ctx:t,offsets:n,cb:a,height:r,drawCurves:s,oobLimit:l,viewWidth:c,hideTiny:f}){const{p11:u,p12:d,p21:g,p22:h}=e,m=u.offsetPx-n[0],v=d.offsetPx-n[0],p=g.offsetPx-n[1],b=h.offsetPx-n[1],C=Math.abs(v-m),M=Math.abs(b-p),x=r,w=(x-0)/2,S=Math.min(p,b),k=Math.max(p,b);(0,o.doesIntersect2)(S,k,-l,c+l)&&(C<=1&&M<=1?f||(t.beginPath(),t.moveTo(m,0),s?t.bezierCurveTo(m,w,p,w,p,x):t.lineTo(p,x),t.stroke()):(i(t,m,v,0,b,p,x,w,s),a(t)))}function i(e,t,n,o,a,r,i,s,l){l?function(e,t,n,o,a,r,i,s){const l=Math.abs(t-n),c=Math.abs(t-n);if(l<5&&c<5&&n<t&&Math.abs(t-a)>100){const e=t;t=n,n=e}e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.bezierCurveTo(n,s,a,s,a,i),e.lineTo(r,i),e.bezierCurveTo(r,s,t,s,t,o),e.closePath(),e.fill()}(e,t,n,o,a,r,i,s):function(e,t,n,o,a,r,i){e.beginPath(),e.moveTo(t,o),e.lineTo(n,o),e.lineTo(a,i),e.lineTo(r,i),e.closePath(),e.fill()}(e,t,n,o,a,r,i)}function s(e,t){const n=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(!n||!r)return;const i=n.getBoundingClientRect(),s=n.getContext("2d"),l=r.getContext("2d");if(!s||!l)return;const c=e.clientX-i.left,f=e.clientY-i.top,[u,d,g]=s.getImageData(c,f,1,1).data,h=Math.floor(a.xx/t.numFeats),m=(0,a.OX)(u,d,g,h),v=t.featPositions[m];if(v){const{f:e}=v;t.setClickId(e.id());const n=(0,o.getSession)(t);(0,o.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:{feature1:e.toJSON(),feature2:e.get("mate")}}))}return v}function l(e,t,n){e.preventDefault();const o=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(!o||!r)return;const i=o.getBoundingClientRect(),s=o.getContext("2d"),l=r.getContext("2d");if(!s||!l)return;const{clientX:c,clientY:f}=e,u=c-i.left,d=f-i.top,[g,h,m]=s.getImageData(u,d,1,1).data,v=Math.floor(a.xx/t.numFeats),p=(0,a.OX)(g,h,m,v),b=t.featPositions[p];b&&(t.setClickId(b.f.id()),n({clientX:c,clientY:f,feature:b}))}function c(e,t,n){const a=e.toJSON(),r=a.mate,i=a.end-a.start,s=r.end-r.start,l=a.identity,c=a.name,f=r.name;return[`Loc1: ${(0,o.assembleLocString)(a)}`,`Loc2: ${(0,o.assembleLocString)(r)}`,`Inverted: ${-1===a.strand}`,`Query len: ${i.toLocaleString("en-US")}`,`Target len: ${s.toLocaleString("en-US")}`,l?`Identity: ${l.toPrecision(2)}`:"",t?`CIGAR operator: ${t}${n}`:"",c?`Name 1: ${c}`:"",f?`Name 1: ${f}`:""].filter((e=>!!e)).join("<br/>")}},30385:(e,t,n)=>{n.d(t,{C4:()=>g,OX:()=>u,Ww:()=>d,xx:()=>i});var o=n(99546),a=n(79610),r=n(36422);const i=16581375;function s(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const l={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,f=1600;function u(e,t,n,o){return Math.floor((255*e*255+255*t+n-1)/o)}function d(e,t,n){const u=(0,o.getContainingView)(e),d=(0,r.getParent)(e,4).level,g=u.drawCurves,h=u.drawCIGAR,{height:m,featPositions:v}=e,p=u.width,b=u.views.map((e=>e.bpPerPx));n&&(n.imageSmoothingEnabled=!1),t.beginPath();const C=u.views.map((e=>e.offsetPx)),M=Math.floor(i/v.length);t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:n,p21:o,p22:a}of v){const r=e.offsetPx-C[d],i=n.offsetPx-C[d],s=o.offsetPx-C[d+1],l=a.offsetPx-C[d+1],u=Math.abs(i-r),h=Math.abs(l-s),v=0,b=m,M=(b-v)/2;u<=c&&h<=c&&s<p+f&&s>-f&&(t.moveTo(r,v),g?t.bezierCurveTo(r,M,s,M,s,b):t.lineTo(s,b))}t.stroke(),t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:r,p21:M,p22:x,f:w,cigar:S}of v){const v=e.offsetPx-C[d],k=r.offsetPx-C[d],y=M.offsetPx-C[d+1],P=x.offsetPx-C[d+1],E=Math.abs(k-v),T=Math.abs(P-y),$=Math.min(y,P),I=Math.max(y,P),R=0,X=m,N=(X-R)/2;if(!(E<=c&&T<=c)&&(0,o.doesIntersect2)($,I,-f,u.width+f)){const e=w.get("strand"),o=-1===e?k:v,r=o<(-1===e?v:k)?1:-1,c=(y<P?1:-1)*e;let f=o,u=-1===e?P:y;if(S?.length&&h){let e=!1,o=0,h=0;const m=Math.floor(i/S.length);for(let i=0;i<S.length;i+=2){const v=i*m+1,C=+S[i],M=S[i+1];e||(o=f,h=u);const x=C/b[d],w=C/b[d+1];if("M"===M||"="===M||"X"===M?(f+=x*r,u+=w*c):"D"===M||"N"===M?f+=x*r:"I"===M&&(u+=w*c),!(Math.max(o,h,f,u)<0||Math.min(o,h,f,u)>p)){const r=i<S.length-2;Math.abs(f-o)<=1&&Math.abs(u-h)<=1&&r?e=!0:(e=!1,t.fillStyle=l[e&&x>1||w>1?M:"M"],(0,a.$2)(t,o,f,R,u,h,X,N,g),n&&(n.fillStyle=s(v),(0,a.$2)(n,o,f,R,u,h,X,N,g)))}}}else(0,a.$2)(t,v,k,R,P,y,X,N,g)}}const x=e.clickMapCanvas?.getContext("2d");if(x){x.imageSmoothingEnabled=!1,x.clearRect(0,0,p,m);for(let e=0;e<v.length;e++){const t=v[e],n=e*M+1;x.fillStyle=s(n),(0,a.mr)({cb:e=>e.fill(),feature:t,ctx:x,drawCurves:g,offsets:C,oobLimit:f,viewWidth:u.width,hideTiny:!0,height:m})}}}function g(e){const{clickId:t,mouseoverId:n}=e,r=(0,o.getContainingView)(e),i=r.drawCurves,s=e.height,l=r.width,c=e.mouseoverCanvas?.getContext("2d"),u=r.views.map((e=>e.offsetPx));if(!c)return;c.resetTransform(),c.scale(1,1),c.clearRect(0,0,l,s);const d=e.featMap[n||""];d&&(c.fillStyle="rgb(0,0,0,0.1)",(0,a.mr)({cb:e=>e.fill(),feature:d,ctx:c,oobLimit:f,viewWidth:r.width,drawCurves:i,offsets:u,height:s}));const g=e.featMap[t||""];g&&(c.strokeStyle="rgb(0, 0, 0, 0.9)",(0,a.mr)({cb:e=>e.stroke(),feature:g,ctx:c,oobLimit:f,viewWidth:r.width,drawCurves:i,offsets:u,height:s}))}}}]);
//# sourceMappingURL=7649.654bcdb7.chunk.js.map