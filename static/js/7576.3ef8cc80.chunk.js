"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[7576],{7576:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var r,a=n(96234),s=n(32723),o=n(34795),i=n(9249),c=n(87371),u=n(45754),f=n(13820),d=n(20783),l=n(14956),p=n(26131),v=n(95915),h=n(81450),b=n(41361),g=n(33028),k=n(54685),x=n(46079),y=n(81073);function Z(e){return m(e.type)?1:e.length}function m(e){return"softclip"===e||"hardclip"===e||"insertion"===e}function w(e,t,n,r){var a=e[n][r];void 0===a&&(a=e[n][r]={total:0,"-1":0,0:0,1:0}),a.total++,a[t]++}function q(e,t,n,a){return(r=r||(0,o.Z)((0,s.Z)().mark((function e(t,n,r,a){var o,i,c,u,f,d,l,p,v,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.colorBy,c=(0,g.Z)((0,g.Z)({},n),{},{start:Math.max(0,n.start-1),end:n.end+1}),u=Math.ceil(c.end-c.start),f={},!t.length||!(0,k.ES)(null===(o=r.colorBy)||void 0===o?void 0:o.type)){e.next=10;break}return e.next=7,a(n);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=void 0;case 11:d=e.t0,l=[],p=(0,b.Z)(t),e.prev=14,h=(0,s.Z)().mark((function e(){var t,r,a,o,c,p,h,g,q,A,M,S,C,R,_,F,N,B,E,j,D,I,O,P,L,T,Y,z,G,U,X,H,J,K,Q,V,W,$,ee,te,ne,re,ae;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=v.value,r=t.get("start"),a=t.get("end"),o=t.get("strand"),c=t.get("mismatches")||[],p=r;p<a+1;p++)(h=p-n.start)>=0&&h<u&&(void 0===l[h]&&(l[h]={total:0,all:0,ref:0,"-1":0,0:0,1:0,lowqual:{},cov:{},delskips:{},noncov:{}}),p!==a&&(l[h].total++,l[h].all++,l[h].ref++,l[h][o]++));if("modifications"===(null===i||void 0===i?void 0:i.type)&&(g=t.get("seq"),q=(0,k.TN)(t,"MM","Mm")||"",A=(0,x.parseCigar)(t.get("CIGAR")),M=t.get("end"),g)){S=(0,x.getModificationPositions)(q,g,o),C=(0,b.Z)(S);try{for(C.s();!(R=C.n()).done;){_=R.value,F=_.type,N=_.positions,B="mod_".concat(F),E=(0,b.Z)((0,x.getNextRefPos)(A,N));try{for(E.s();!(j=E.n()).done;)D=j.value,(I=D+r-n.start)>=0&&I<l.length&&D+r<M&&(void 0===l[I]&&(l[I]={total:0,all:0,ref:0,"-1":0,0:0,1:0,lowqual:{},cov:{},delskips:{},noncov:{}}),(O=l[I])?w(O,o,"cov",B):console.warn("Undefined position in modifications snpcoverage encountered"))}catch(se){E.e(se)}finally{E.f()}}}catch(se){C.e(se)}finally{C.f()}}if("methylation"!==(null===i||void 0===i?void 0:i.type)){e.next=22;break}if(d){e.next=10;break}throw new Error("no region sequence detected, need sequenceAdapter configuration");case 10:if(t.get("seq")){e.next=13;break}return e.abrupt("return",1);case 13:P=(0,x.getMethBins)(t),L=P.methBins,T=P.methProbs,Y=c.filter((function(e){return"deletion"===e.type})),z=(0,s.Z)().mark((function e(){var t,a,i,c,u,f,p,v,h,b,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=null===(t=d[(i=G+r)-n.start+1])||void 0===t?void 0:t.toLowerCase(),u=null===(a=d[i-n.start+2])||void 0===a?void 0:a.toLowerCase(),"c"===c&&"g"===u&&(f=l[i-n.start],p=l[i-n.start+1],v=L[G],h=L[G+1],b=T[G],g=T[G+1],v&&(void 0===b||b>.5)||h&&(void 0===g||g>.5)?(f&&(w(f,o,"cov","meth"),f.ref--,f[o]--),p&&(w(p,o,"cov","meth"),p.ref--,p[o]--)):(f&&(null!==Y&&void 0!==Y&&Y.some((function(e){return(0,y.doesIntersect2)(i,i+1,e.start+r,e.start+r+e.length)}))||(w(f,o,"cov","unmeth"),f.ref--,f[o])),p&&(null!==Y&&void 0!==Y&&Y.some((function(e){return(0,y.doesIntersect2)(i+1,i+2,e.start+r,e.start+r+e.length)}))||(w(p,o,"cov","unmeth"),p.ref--,p[o]--))));case 4:case"end":return e.stop()}}),e)})),G=0;case 17:if(!(G<a-r)){e.next=22;break}return e.delegateYield(z(),"t0",19);case 19:G++,e.next=17;break;case 22:U="modifications"!==(null===i||void 0===i?void 0:i.type)&&"methylation"!==(null===i||void 0===i?void 0:i.type),X=(0,b.Z)(c);try{for(X.s();!(H=X.n()).done;){for(J=H.value,K=r+J.start,Q=Z(J),V=K+Q,W=K;W<K+Q;W++)($=W-n.start)>=0&&$<l.length&&(ee=l[$],te=J.base,ne=J.type,(re=m(ne))?w(ee,o,"noncov",ne):(ee.ref--,ee[o]--),"deletion"===ne||"skip"===ne?(w(ee,o,"delskips",ne),ee.total--):!re&&U&&(w(ee,o,"cov",te),ee.refbase=J.altbase));"skip"===J.type&&(ae="".concat(K,"_").concat(V,"_").concat(o),void 0===f[ae]&&(f[ae]={feature:t,start:K,end:V,strand:o,xs:(0,k.h1)(t,"XS")||(0,k.h1)(t,"TS"),score:0}),f[ae].score++)}}catch(se){X.e(se)}finally{X.f()}case 25:case"end":return e.stop()}}),e)})),p.s();case 17:if((v=p.n()).done){e.next=23;break}return e.delegateYield(h(),"t1",19);case 19:if(!e.t1){e.next=21;break}return e.abrupt("continue",21);case 21:e.next=17;break;case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(14),p.e(e.t2);case 28:return e.prev=28,p.f(),e.finish(28);case 31:return e.abrupt("return",{bins:l,skipmap:f});case 32:case"end":return e.stop()}}),e,null,[[14,25,28,31]])})))).apply(this,arguments)}var A=function(e,t,n,r,d){(0,u.Z)(g,e);var b=(0,f.Z)(g);function g(){return(0,i.Z)(this,g),b.apply(this,arguments)}return(0,c.Z)(g,[{key:"configure",value:function(){return(t=t||(0,o.Z)((0,s.Z)().mark((function e(){var t,n,r,a,o,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getConf("subadapter"),a=r.sequenceAdapter,e.next=4,null===(t=this.getSubAdapter)||void 0===t?void 0:t.call(this,r);case 4:if(o=e.sent,!a){e.next=11;break}return e.next=8,null===(n=this.getSubAdapter)||void 0===n?void 0:n.call(this,a);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=void 0;case 12:if(i=e.t0,o){e.next=15;break}throw new Error("Failed to get subadapter");case 15:return e.abrupt("return",{subadapter:o.dataAdapter,sequenceAdapter:null===i||void 0===i?void 0:i.dataAdapter});case 16:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"fetchSequence",value:function(e){return(n=n||(0,o.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:if(n=e.sent,r=n.sequenceAdapter){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",(0,k.O)(t,r));case 7:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getFeatures",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,p.ObservableCreate)((function(i){return(t=t||(0,o.Z)((0,s.Z)().mark((function t(o){var i,c,u,f,d,p;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.configure();case 2:return i=t.sent,c=i.subadapter,t.next=6,(0,h.z)(c.getFeatures(e,r).pipe((0,v.q)()));case 6:return u=t.sent,t.next=9,q(u,e,r,(function(e){return n.fetchSequence(e)}));case 9:f=t.sent,d=f.bins,p=f.skipmap,d.forEach((function(t,r){var a=e.start+r;o.next(new l.Z({id:"".concat(n.id,"-").concat(a),data:{score:t.total,snpinfo:t,start:a,end:a+1,refName:e.refName}}))})),Object.entries(p).forEach((function(e){var t=(0,a.Z)(e,2),n=t[0],r=t[1];o.next(new l.Z({id:n,data:{type:"skip",start:r.start,end:r.end,strand:r.strand,score:r.score,xs:r.xs}}))})),o.complete();case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}),r.signal)}},{key:"getMultiRegionFeatureDensityStats",value:function(e,t){return(r=r||(0,o.Z)((0,s.Z)().mark((function e(t,n){var r,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:return r=e.sent,a=r.subadapter,e.abrupt("return",a.getMultiRegionFeatureDensityStats(t,n));case 5:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"getRefNames",value:function(){return(d=d||(0,o.Z)((0,s.Z)().mark((function e(){var t,n,r,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},e.next=3,this.configure();case 3:return n=e.sent,r=n.subadapter,e.abrupt("return",r.getRefNames(t));case 6:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}},{key:"freeResources",value:function(){}}]),g}(d.BaseFeatureDataAdapter)}}]);
//# sourceMappingURL=7576.3ef8cc80.chunk.js.map