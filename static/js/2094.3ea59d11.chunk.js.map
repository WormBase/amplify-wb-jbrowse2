{"version":3,"file":"static/js/2094.3ea59d11.chunk.js","mappings":"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","sources":["../../../plugins/wiggle/src/BigWigAdapter/BigWigAdapter.ts"],"sourcesContent":["import { BigWig } from '@gmod/bbi'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { updateStatus, Feature } from '@jbrowse/core/util'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport {\n  rectifyStats,\n  UnrectifiedQuantitativeStats,\n} from '@jbrowse/core/util/stats'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nexport default class BigWigAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private setupP?: Promise<{ bigwig: BigWig; header: any }>\n\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  private async setupPre(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    const pm = this.pluginManager\n    const bigwig = new BigWig({\n      filehandle: openLocation(this.getConf('bigWigLocation'), pm),\n    })\n    const header = await updateStatus(\n      'Downloading bigwig header',\n      statusCallback,\n      () => bigwig.getHeader(opts),\n    )\n    return { bigwig, header }\n  }\n\n  async setup(opts?: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n\n  public async getRefNames(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return Object.keys(header.refsByName)\n  }\n\n  public async refIdToName(refId: number) {\n    const { header } = await this.setup()\n    return header.refsByNumber[refId]?.name\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return rectifyStats(header.totalSummary as UnrectifiedQuantitativeStats)\n  }\n\n  public getFeatures(region: Region, opts: WiggleOptions = {}) {\n    const { refName, start, end } = region\n    const {\n      bpPerPx = 0,\n      signal,\n      resolution = 1,\n      statusCallback = () => {},\n    } = opts\n    return ObservableCreate<Feature>(async observer => {\n      statusCallback('Downloading bigwig data')\n      const source = this.getConf('source')\n      const { bigwig } = await this.setup(opts)\n      const feats = await bigwig.getFeatures(refName, start, end, {\n        ...opts,\n        basesPerSpan: bpPerPx / resolution,\n      })\n\n      for (const data of feats) {\n        if (source) {\n          // @ts-expect-error\n          data.source = source\n        }\n        const uniqueId = `${source}:${region.refName}:${data.start}-${data.end}`\n        // @ts-expect-error\n        data.refName = refName\n        data.uniqueId = uniqueId\n        observer.next({\n          // @ts-expect-error\n          get: (str: string) => (data as Record<string, unknown>)[str],\n          id: () => uniqueId,\n          // @ts-expect-error\n          toJSON: () => data,\n        })\n      }\n      observer.complete()\n    }, signal)\n  }\n\n  // always render bigwig instead of calculating a feature density for it\n  async getMultiRegionFeatureDensityStats(_regions: Region[]) {\n    return { featureDensity: 0 }\n  }\n\n  public freeResources(): void {}\n}\n"],"names":["BigWigAdapter","_BaseFeatureDataAdapt","_setupPre","_setup","_getRefNames","_refIdToName","_getGlobalStats","_getMultiRegionFeatureDensityStats","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","setupP","_createClass","key","value","_x","_asyncToGenerator","_regeneratorRuntime","mark","_callee","opts","_ref$statusCallback","statusCallback","pm","bigwig","header","wrap","_context","prev","next","this","pluginManager","BigWig","filehandle","openLocation","getConf","updateStatus","getHeader","sent","abrupt","stop","_x2","_callee2","_this2","_context2","setupPre","catch","e","undefined","_x3","_callee3","_yield$this$setup","_context3","setup","Object","keys","refsByName","_x4","_callee4","refId","_header$refsByNumber$","_yield$this$setup2","_context4","refsByNumber","name","_x5","_callee5","_yield$this$setup3","_context5","rectifyStats","totalSummary","region","_ref2","_this3","refName","start","end","_opts$bpPerPx","bpPerPx","signal","_opts$resolution","resolution","_opts$statusCallback","ObservableCreate","_x6","_callee6","observer","source","_yield$_this3$setup","feats","_iterator","_step","_loop","_context7","getFeatures","_objectSpread","basesPerSpan","_createForOfIteratorHelper","data","uniqueId","_context6","get","str","id","toJSON","s","n","done","delegateYield","t1","f","finish","complete","_x7","_callee7","_regions","_context8","featureDensity","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}