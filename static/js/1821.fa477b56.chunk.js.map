{"version":3,"file":"static/js/1821.fa477b56.chunk.js","mappings":"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CACA,kCACA,sCACA,4BACA,2BACA,wBACA,yBACA,gCACA,8BACA,gCACA,qCACA,mCACA,8BACA,yBACA,yBACA,yBACA,+BACA,0BACA,8BACA,+BACA,mCACA,yBACA,mCACA,yBACA,6BACA,mCACA,4CACA,iCACA,kCACA,iCACA,yBACA,6BACA,6BACA,0BACA,iCACA,kCACA,+BACA,mCACA,0BACA,4BACA,2BACA,2BACA,0BACA,+BACA,2BACA,sCACA,2BACA,6BACA,2BACA,6BACA,oCACA,8BACA,oCACA,kCACA,0BACA,yBACA,+BACA,kCACA,8BACA,6BACA,4BACA,4BACA,2BACA,wBACA,0BACA,8BACA,8BACA,mCACA,gCACA,8BACA,oCACA,6BACA,mCACA,yBACA,8BACA,qCACA,iCACA,sCACA,4BACA,4BACA,+BACA,0BACA,iCACA,iCACA,sBACA,2BACA,6BACA,uBACA,4BACA,yBACA,sBACA,oBACA,4BACA,uBACA,4BACA,qBACA,4BACA,+BACA,4BACA,2BACA,0BACA,iCACA,yBACA,kCACA,qBACA,yBACA,0BACA,uBACA,8BACA,4BACA,8BACA,kCACA,wBACA,uBACA,oBACA,qBACA,4BACA,0BACA,4BACA,iCACA,+BACA,0BACA,qBACA,qBACA,qBACA,2BACA,sBACA,0BACA,2BACA,+BACA,qBACA,+BACA,qBACA,yBACA,+BACA,wCACA,6BACA,8BACA,6BACA,qBACA,yBACA,yBACA,sBACA,6BACA,8BACA,2BACA,+BACA,sBACA,wBACA,uBACA,uBACA,sBACA,2BACA,uBACA,kCACA,uBACA,yBACA,uBACA,yBACA,gCACA,0BACA,gCACA,8BACA,sBACA,qBACA,2BACA,8BACA,0BACA,yBACA,wBACA,wBACA,uBACA,oBACA,sBACA,0BACA,0BACA,+BACA,4BACA,0BACA,gCACA,yBACA,+BACA,qBACA,0BACA,iCACA,6BACA,kCACA,wBACA,wBACA,2BACA,gCACA,qCACA,gCACA,yBACA,mBACA,uBACA,sCACA,+CACA,kDACA,kDACA,g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","sources":["../../../packages/core/BaseFeatureWidget/configSchema.ts","../../../packages/core/BaseFeatureWidget/SequenceFeatureDetails/model.ts","../../../packages/core/BaseFeatureWidget/stateModelFactory.ts","../../../packages/core/Plugin.ts","../../../packages/core/rpc/methods/CoreGetRefNames.ts","../../../packages/core/rpc/methods/util.ts","../../../packages/core/rpc/methods/CoreGetFeatureDetails.ts","../../../packages/core/rpc/methods/CoreGetMetadata.ts","../../../packages/core/rpc/methods/CoreGetFileInfo.ts","../../../packages/core/rpc/methods/CoreGetFeatures.ts","../../../packages/core/rpc/methods/CoreRender.ts","../../../packages/core/rpc/methods/CoreFreeResources.ts","../../../packages/core/rpc/methods/CoreGetFeatureDensityStats.ts","../../../packages/core/data_adapters/CytobandAdapter/configSchema.ts","../../../packages/core/CorePlugin.ts","../../../packages/core/data_adapters/CytobandAdapter/index.ts","../../../packages/core/PluginManager.ts","../../../packages/core/ReExports/list.ts","../../../packages/core/ReExports/modules.tsx","../../../packages/core/TextSearch/BaseResults.ts","../../../packages/core/configuration/configurationSlot.ts","../../../packages/core/configuration/configurationSchema.ts","../../../packages/core/configuration/util.ts","../../../packages/core/data_adapters/BaseAdapter/util.ts","../../../packages/core/data_adapters/BaseAdapter/BaseAdapter.ts","../../../packages/core/data_adapters/BaseAdapter/BaseFeatureDataAdapter.ts","../../../packages/core/data_adapters/BaseAdapter/BaseSequenceAdapter.ts","../../../packages/core/pluggableElementTypes/AdapterType.ts","../../../packages/core/pluggableElementTypes/AddTrackWorkflowType.ts","../../../packages/core/pluggableElementTypes/ConnectionType.ts","../../../packages/core/pluggableElementTypes/DisplayType.ts","../../../packages/core/pluggableElementTypes/InternetAccountType.ts","../../../packages/core/pluggableElementTypes/PluggableElementBase.ts","../../../packages/core/util/map-obj.ts","../../../packages/core/pluggableElementTypes/RpcMethodType.ts","../../../packages/core/pluggableElementTypes/TextSearchAdapterType.ts","../../../packages/core/pluggableElementTypes/TrackType.ts","../../../packages/core/pluggableElementTypes/ViewType.ts","../../../packages/core/pluggableElementTypes/WidgetType.ts","../../../packages/core/pluggableElementTypes/models/BaseViewModel.ts","../../../packages/core/pluggableElementTypes/models/baseConnectionConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseConnectionModelFactory.ts","../../../packages/core/pluggableElementTypes/models/BaseDisplayModel.tsx","../../../packages/core/pluggableElementTypes/models/baseInternetAccountConfig.ts","../../../packages/core/pluggableElementTypes/models/InternetAccountModel.ts","../../../packages/core/pluggableElementTypes/models/BaseTrackModel.ts","../../../packages/core/pluggableElementTypes/models/baseTrackConfig.ts","../../../packages/core/pluggableElementTypes/renderers/BoxRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/RpcRenderedSvgGroup.tsx","../../../packages/core/pluggableElementTypes/renderers/CircularChordRendererType.tsx","../../../packages/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/FeatureRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/RendererType.ts","../../../packages/core/pluggableElementTypes/renderers/ServerSideRenderedContent.tsx","../../../packages/core/pluggableElementTypes/renderers/ServerSideRendererType.tsx","../../../packages/core/pluggableElementTypes/renderers/util/serializableFilterChain.ts","../../../packages/core/ui/CascadingMenuButton.tsx","../../../packages/core/ui/FatalErrorDialog.tsx","../../../packages/core/ui/FileSelector/LocalFileChooser.tsx","../../../packages/core/ui/FileSelector/UrlChooser.tsx","../../../packages/core/ui/LoadingEllipses.tsx","../../../packages/core/ui/RedErrorMessageBox.tsx","../../../packages/core/ui/colors.ts","../../../packages/core/util/Base1DUtils.ts","../../../packages/core/util/Base1DViewModel.ts","../../../packages/core/util/aborting.ts","../../../packages/core/util/blobToDataURL.ts","../../../packages/core/util/blockTypes.ts","../../../packages/core/util/calculateDynamicBlocks.ts","../../../packages/core/util/calculateStaticBlocks.ts","../../../packages/core/util/color/cssColorsLevel4.ts","../../../packages/core/util/color/index.ts","../../../packages/core/util/colord.ts","../../../packages/core/util/dedupe.ts","../../../packages/core/util/idMaker.ts","../../../packages/core/util/io/RemoteFileWithRangeCache.ts","../../../packages/core/util/io/index.ts","../../../packages/core/util/jexl.ts","../../../packages/core/util/jexlStrings.ts","../../../packages/core/util/layouts/GranularRectLayout.ts","../../../packages/core/util/layouts/MultiLayout.ts","../../../packages/core/util/layouts/PrecomputedLayout.ts","../../../packages/core/util/layouts/PrecomputedMultiLayout.js","../../../packages/core/util/layouts/SceneGraph.ts","../../../packages/core/util/mst-reflection.ts","../../../packages/core/util/nanoid.js","../../../packages/core/util/offscreenCanvasPonyfill.tsx","../../../packages/core/util/offscreenCanvasUtils.tsx","../../../packages/core/util/range.ts","../../../packages/core/util/rxjs.ts","../../../packages/core/util/simpleFeature.ts","../../../packages/core/util/stats.ts","../../../packages/core/util/types/index.ts","../../../packages/core/util/useMeasure.ts","../../../packages/core/util/when.ts","../../../plugins/alignments/src/MismatchParser/index.ts","../../../plugins/alignments/src/CramAdapter/configSchema.ts","../../../plugins/alignments/src/CramAdapter/index.ts","../../../plugins/alignments/src/BamAdapter/configSchema.ts","../../../plugins/alignments/src/BamAdapter/index.ts","../../../plugins/alignments/src/HtsgetBamAdapter/configSchema.ts","../../../plugins/alignments/src/HtsgetBamAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageAdapter/configSchema.ts","../../../plugins/alignments/src/SNPCoverageAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageRenderer/configSchema.ts","../../../plugins/alignments/src/SNPCoverageRenderer/SNPCoverageRenderer.ts","../../../plugins/alignments/src/SNPCoverageRenderer/index.ts","../../../plugins/alignments/src/PileupRenderer/PileupLayoutSession.ts","../../../plugins/alignments/src/PileupRenderer/PileupRenderer.ts","../../../plugins/alignments/src/PileupRenderer/layoutFeatures.ts","../../../plugins/alignments/src/PileupRenderer/sortUtil.ts","../../../plugins/alignments/src/PileupRenderer/layoutFeature.ts","../../../plugins/alignments/src/PileupRenderer/configSchema.ts","../../../plugins/alignments/src/PileupRenderer/components/PileupRendering.tsx","../../../plugins/alignments/src/PileupRenderer/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/util.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/model.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/alignmentsModel.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/components/AlignmentsDisplay.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/configSchema.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/components/Tooltip.tsx","../../../plugins/alignments/src/shared/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/model.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/configSchema.ts","../../../plugins/alignments/src/shared/BaseDisplayComponent.tsx","../../../plugins/alignments/src/LinearReadArcsDisplay/components/ReactComponent.tsx","../../../plugins/alignments/src/LinearReadArcsDisplay/model.ts","../../../plugins/alignments/src/LinearReadArcsDisplay/index.ts","../../../plugins/alignments/src/LinearReadArcsDisplay/configSchema.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/components/ReactComponent.tsx","../../../plugins/alignments/src/LinearReadCloudDisplay/model.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/index.ts","../../../plugins/alignments/src/LinearReadCloudDisplay/configSchema.ts","../../../plugins/alignments/src/AlignmentsTrack/index.ts","../../../plugins/alignments/src/AlignmentsTrack/configSchemaF.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/configSchema.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/stateModelFactory.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/index.ts","../../../plugins/alignments/src/PileupRPC/base.ts","../../../plugins/alignments/src/PileupRPC/methods/GetReducedFeatures.ts","../../../plugins/alignments/src/PileupRPC/util.ts","../../../plugins/alignments/src/PileupRPC/methods/GetVisibleModifications.ts","../../../plugins/alignments/src/PileupRPC/methods/GetGlobalValueForTag.ts","../../../plugins/alignments/src/PileupRPC/index.ts","../../../plugins/alignments/src/GuessAlignmentsTypes/index.ts","../../../plugins/alignments/src/LinearPileupDisplay/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/LinearPileupDisplayBlurb.tsx","../../../plugins/alignments/src/LinearPileupDisplay/SharedLinearPileupDisplayMixin.ts","../../../plugins/alignments/src/LinearPileupDisplay/model.ts","../../../plugins/alignments/src/LinearPileupDisplay/index.ts","../../../plugins/alignments/src/index.ts","../../../plugins/alignments/src/shared/color.ts","../../../plugins/alignments/src/util.ts","../../../plugins/arc/src/ArcTooltip.tsx","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/util.ts","../../../plugins/circular-view/src/CircularView/models/viewportVisibleRegion.ts","../../../plugins/circular-view/src/CircularView/models/slices.ts","../../../plugins/circular-view/src/CircularView/models/model.ts","../../../plugins/circular-view/src/BaseChordDisplay/components/Loading.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/DisplayError.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/BaseChordDisplay.tsx","../../../plugins/circular-view/src/BaseChordDisplay/models/renderReaction.ts","../../../plugins/circular-view/src/BaseChordDisplay/models/configSchema.ts","../../../plugins/circular-view/src/BaseChordDisplay/models/model.tsx","../../../plugins/circular-view/src/index.ts","../../../plugins/circular-view/src/CircularView/index.ts","../../../plugins/circular-view/src/LaunchCircularView/index.ts","../../../plugins/config/src/ConfigurationEditorWidget/components/JsonEditor.tsx","../../../plugins/config/src/FromConfigAdapter/configSchema.ts","../../../plugins/config/src/FromConfigRegionsAdapter/configSchema.ts","../../../plugins/config/src/FromConfigSequenceAdapter/configSchema.ts","../../../plugins/config/src/RefNameAliasAdapter/configSchema.ts","../../../plugins/config/src/ConfigurationEditorWidget/model.ts","../../../plugins/config/src/ConfigurationEditorWidget/components/HeadingComponent.tsx","../../../plugins/config/src/ConfigurationEditorWidget/index.ts","../../../plugins/config/src/index.ts","../../../plugins/config/src/FromConfigAdapter/index.ts","../../../plugins/config/src/FromConfigRegionsAdapter/index.ts","../../../plugins/config/src/FromConfigSequenceAdapter/index.ts","../../../plugins/config/src/RefNameAliasAdapter/index.ts","../../../plugins/data-management/src/AddConnectionWidget/model.ts","../../../plugins/data-management/src/AddConnectionWidget/index.ts","../../../plugins/data-management/src/AddTrackWidget/model.ts","../../../plugins/data-management/src/AddTrackWidget/index.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/components/faceted/util.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/util.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/filterTracks.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/generateHierarchy.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/facetedUtil.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/facetedModel.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/model.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/configSchema.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/index.ts","../../../plugins/data-management/src/PluginStoreWidget/model.ts","../../../plugins/data-management/src/PluginStoreWidget/index.ts","../../../plugins/data-management/src/ucsc-trackhub/configSchema.ts","../../../plugins/data-management/src/ucsc-trackhub/model.ts","../../../plugins/data-management/src/ucsc-trackhub/index.ts","../../../plugins/dotplot-view/src/DotplotView/components/util.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Block.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BlockMsg.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/serverSideRenderedBlock.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Cytobands.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabelDragHandle.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabelContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackRenderingContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/hooks.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/VerticalGuide.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Rubberband.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Scalebar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Gridlines.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/CenterLine.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Highlight.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TracksContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeView.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScalebarPolygon.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/EndAdornment.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/AutocompleteTextField.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/index.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RubberbandSpan.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/MiniControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewRubberband.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewHighlight.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScalebar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ZoomControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SearchBox.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Header.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/model.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/index.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGBackground.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGRegionSeparators.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGTrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGTracks.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGRuler.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGScalebar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGHeader.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/SVGLinearGenomeView.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/svgcomponents/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/util.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/configSchema.ts","../../../packages/core/util/compositeMap.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/LinearBlocks.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Tooltip.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BaseLinearDisplay.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/TrackHeightMixin.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/TooLargeMessage.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/FeatureDensityMixin.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/autorunFeatureDensityStats.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/BaseLinearDisplayModel.tsx","../../../plugins/linear-genome-view/src/LinearBareDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/model.ts","../../../plugins/linear-genome-view/src/index.ts","../../../plugins/linear-genome-view/src/FeatureTrack/index.ts","../../../plugins/linear-genome-view/src/FeatureTrack/configSchema.ts","../../../plugins/linear-genome-view/src/BasicTrack/index.ts","../../../plugins/linear-genome-view/src/BasicTrack/configSchema.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/index.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/index.ts","../../../plugins/linear-genome-view/src/LaunchLinearGenomeView/index.ts","../../../plugins/linear-genome-view/src/searchUtils.ts","../../../plugins/variants/src/VcfFeature/util.ts","../../../plugins/variants/src/VcfFeature/index.ts","../../../plugins/variants/src/VcfAdapter/configSchema.ts","../../../plugins/variants/src/VcfTabixAdapter/configSchema.ts","../../../plugins/variants/src/LinearVariantDisplay/model.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/configSchema.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/Chord.tsx","../../../plugins/variants/src/StructuralVariantChordRenderer/ReactComponent.tsx","../../../plugins/variants/src/VariantFeatureWidget/stateModelFactory.ts","../../../plugins/variants/src/VariantFeatureWidget/configSchema.ts","../../../plugins/variants/src/index.ts","../../../plugins/variants/src/VariantTrack/index.ts","../../../plugins/variants/src/VcfAdapter/index.ts","../../../plugins/variants/src/VcfTabixAdapter/index.ts","../../../plugins/variants/src/VariantFeatureWidget/index.ts","../../../plugins/variants/src/VariantTrack/configSchema.ts","../../../plugins/variants/src/extensionPoints.ts","../../../plugins/variants/src/LinearVariantDisplay/index.ts","../../../plugins/variants/src/LinearVariantDisplay/configSchema.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/index.ts","../../../plugins/variants/src/ChordVariantDisplay/index.ts","../../../plugins/variants/src/ChordVariantDisplay/models/configSchema.ts","../../../plugins/variants/src/ChordVariantDisplay/models/stateModelFactory.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/components/WiggleDisplayComponent.tsx","../../../plugins/wiggle/src/WiggleBaseRenderer.tsx","../../../plugins/wiggle/src/BigWigAdapter/configSchema.ts","../../../plugins/wiggle/src/QuantitativeTrack/configSchema.ts","../../../plugins/wiggle/src/MultiWiggleAdapter/configSchema.ts","../../../plugins/wiggle/src/configSchema.ts","../../../plugins/wiggle/src/DensityRenderer/configSchema.ts","../../../plugins/wiggle/src/drawDensity.ts","../../../plugins/wiggle/src/DensityRenderer/DensityRenderer.ts","../../../plugins/wiggle/src/WiggleRendering.tsx","../../../plugins/wiggle/src/drawXY.ts","../../../plugins/wiggle/src/XYPlotRenderer/XYPlotRenderer.ts","../../../plugins/wiggle/src/XYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/LinePlotRenderer/configSchema.ts","../../../plugins/wiggle/src/drawLine.ts","../../../plugins/wiggle/src/LinePlotRenderer/LinePlotRenderer.ts","../../../plugins/wiggle/src/shared/configShared.ts","../../../plugins/wiggle/src/Tooltip.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/Tooltip.tsx","../../../plugins/wiggle/src/shared/modelShared.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/models/model.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/components/Tooltip.tsx","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/models/model.ts","../../../plugins/wiggle/src/MultiWiggleRendering.tsx","../../../plugins/wiggle/src/MultiXYPlotRenderer/MultiXYPlotRenderer.ts","../../../plugins/wiggle/src/MultiXYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/MultiRowXYPlotRenderer.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiDensityRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiDensityRenderer/MultiDensityRenderer.ts","../../../plugins/wiggle/src/MultiLineRenderer/MultiLineRenderer.ts","../../../plugins/wiggle/src/MultiLineRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/MultiRowLineRenderer.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/configSchema.ts","../../../plugins/wiggle/src/CreateMultiWiggleExtension/index.ts","../../../plugins/wiggle/src/WiggleRPC/MultiWiggleGetSources.ts","../../../plugins/wiggle/src/WiggleRPC/WiggleGetMultiRegionQuantitativeStats.ts","../../../plugins/wiggle/src/WiggleRPC/WiggleGetGlobalQuantitativeStats.ts","../../../plugins/wiggle/src/index.ts","../../../plugins/wiggle/src/MultiWiggleAdapter/index.ts","../../../plugins/wiggle/src/BigWigAdapter/index.ts","../../../plugins/wiggle/src/QuantitativeTrack/index.ts","../../../plugins/wiggle/src/MultiQuantitativeTrack/index.ts","../../../plugins/wiggle/src/MultiQuantitativeTrack/configSchema.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/models/configSchema.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/index.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/models/configSchema.ts","../../../plugins/wiggle/src/LinePlotRenderer/index.ts","../../../plugins/wiggle/src/XYPlotRenderer/index.ts","../../../plugins/wiggle/src/DensityRenderer/index.ts","../../../plugins/wiggle/src/MultiXYPlotRenderer/index.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/index.ts","../../../plugins/wiggle/src/MultiDensityRenderer/index.ts","../../../plugins/wiggle/src/MultiLineRenderer/index.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/index.ts","../../../plugins/wiggle/src/MultiWiggleAddTrackWorkflow/index.ts","../../../plugins/wiggle/src/shared/YScaleBar.tsx","../../../plugins/wiggle/src/util.ts","../../../plugins/authentication/src/OAuthModel/configSchema.ts","../../../plugins/authentication/src/OAuthModel/util.ts","../../../plugins/authentication/src/util.ts","../../../plugins/authentication/src/OAuthModel/model.tsx","../../../plugins/authentication/src/ExternalTokenModel/configSchema.ts","../../../plugins/authentication/src/ExternalTokenModel/ExternalTokenEntryForm.tsx","../../../plugins/authentication/src/ExternalTokenModel/model.tsx","../../../plugins/authentication/src/HTTPBasicModel/configSchema.ts","../../../plugins/authentication/src/HTTPBasicModel/HTTPBasicLoginForm.tsx","../../../plugins/authentication/src/HTTPBasicModel/model.tsx","../../../plugins/authentication/src/DropboxOAuthModel/configSchema.ts","../../../plugins/authentication/src/DropboxOAuthModel/util.ts","../../../plugins/authentication/src/DropboxOAuthModel/DropboxIcon.tsx","../../../plugins/authentication/src/DropboxOAuthModel/model.tsx","../../../plugins/authentication/src/GoogleDriveOAuthModel/configSchema.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/util.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/GoogleDriveFilehandle.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/GoogleDriveIcon.tsx","../../../plugins/authentication/src/GoogleDriveOAuthModel/model.tsx","../../../plugins/authentication/src/index.ts","../../../plugins/bed/src/BigBedAdapter/configSchema.ts","../../../plugins/bed/src/BedpeAdapter/configSchema.ts","../../../plugins/bed/src/BedTabixAdapter/configSchema.ts","../../../plugins/bed/src/BedAdapter/configSchema.ts","../../../plugins/bed/src/index.ts","../../../plugins/bed/src/BigBedAdapter/index.ts","../../../plugins/bed/src/BedAdapter/index.ts","../../../plugins/bed/src/BedpeAdapter/index.ts","../../../plugins/bed/src/BedTabixAdapter/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointAlignmentsFeatureDetail/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/BreakpointSplitView.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/model.ts","../../../plugins/breakpoint-split-view/src/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView/index.ts","../../../plugins/comparative-adapters/src/PAFAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/PairwiseIndexedPAFAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/ChainAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/index.ts","../../../plugins/comparative-adapters/src/PAFAdapter/index.ts","../../../plugins/comparative-adapters/src/PairwiseIndexedPAFAdapter/index.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/index.ts","../../../plugins/comparative-adapters/src/ChainAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/index.ts","../../../plugins/dotplot-view/src/DotplotView/1dview.ts","../../../plugins/dotplot-view/src/DotplotView/model.ts","../../../plugins/dotplot-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/renderDotplotBlock.ts","../../../plugins/dotplot-view/src/DotplotDisplay/stateModelFactory.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/components/DotplotDisplay.tsx","../../../plugins/dotplot-view/src/DotplotRenderer/components/DotplotRendering.tsx","../../../plugins/dotplot-view/src/DotplotRenderer/DotplotRenderer.ts","../../../plugins/dotplot-view/src/DotplotRenderer/configSchema.ts","../../../plugins/dotplot-view/src/ComparativeRenderer/index.ts","../../../plugins/dotplot-view/src/DotplotReadVsRef/DotplotReadVsRef.ts","../../../plugins/dotplot-view/src/index.ts","../../../plugins/dotplot-view/src/DotplotDisplay/index.ts","../../../plugins/dotplot-view/src/DotplotView/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/index.ts","../../../plugins/dotplot-view/src/LaunchDotplotView.ts","../../../plugins/dotplot-view/src/DotplotReadVsRef/index.ts","../../../plugins/gtf/src/GtfAdapter/configSchema.ts","../../../plugins/gtf/src/index.ts","../../../plugins/gff3/src/Gff3TabixAdapter/configSchema.ts","../../../plugins/gff3/src/Gff3Adapter/configSchema.ts","../../../plugins/gff3/src/index.ts","../../../plugins/gff3/src/Gff3TabixAdapter/index.ts","../../../plugins/gff3/src/Gff3Adapter/index.ts","../../../plugins/gff3/src/GuessGff3/index.ts","../../../plugins/jobs-management/src/JobsListWidget/jobModel.ts","../../../plugins/jobs-management/src/JobsListWidget/index.ts","../../../plugins/jobs-management/src/index.ts","../../../plugins/jobs-management/src/JobsListWidget/model.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSearchAdapter/HttpMap.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSearchAdapter/JBrowse1TextSearchAdapter.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSearchAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/model.ts","../../../plugins/legacy-jbrowse/src/index.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/index.ts","../../../plugins/legacy-jbrowse/src/GuessNCList/index.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSearchAdapter/index.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/stateModelFactory.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/model.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/components/Icons.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyView/model.ts","../../../plugins/linear-comparative-view/src/LaunchLinearSyntenyView.ts","../../../plugins/linear-comparative-view/src/SyntenyFeatureDetail/index.ts","../../../plugins/linear-comparative-view/src/LinearReadVsRef/index.ts","../../../plugins/linear-comparative-view/src/index.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeView/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/SyntenyTrack/index.tsx","../../../plugins/linear-comparative-view/src/SyntenyTrack/configSchema.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/model.ts","../../../plugins/lollipop/src/LollipopRenderer/Layout.ts","../../../plugins/lollipop/src/LollipopRenderer/LollipopRenderer.js","../../../plugins/lollipop/src/LollipopRenderer/configSchema.ts","../../../plugins/lollipop/src/index.ts","../../../plugins/lollipop/src/LollipopRenderer/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/configSchema.ts","../../../plugins/arc/src/LinearArcDisplay/model.ts","../../../plugins/arc/src/LinearPairedArcDisplay/model.ts","../../../plugins/arc/src/ArcRenderer/ArcRendering.tsx","../../../plugins/arc/src/ArcRenderer/configSchema.ts","../../../plugins/arc/src/ArcRenderer/ArcRenderer.ts","../../../plugins/arc/src/index.ts","../../../plugins/arc/src/ArcRenderer/index.ts","../../../plugins/arc/src/LinearArcDisplay/index.ts","../../../plugins/arc/src/LinearArcDisplay/configSchema.ts","../../../plugins/arc/src/LinearPairedArcDisplay/index.ts","../../../plugins/arc/src/LinearPairedArcDisplay/configSchema.ts","../../../plugins/menus/src/AboutWidget/index.ts","../../../plugins/menus/src/HelpWidget/index.ts","../../../plugins/menus/src/ImportSessionWidget/index.ts","../../../plugins/menus/src/SessionManager/index.ts","../../../plugins/menus/src/index.ts","../../../plugins/rdf/src/SPARQLAdapter/SPARQLAdapter.ts","../../../plugins/rdf/src/SPARQLAdapter/configSchema.ts","../../../plugins/rdf/src/index.ts","../../../plugins/sequence/src/TwoBitAdapter/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/components/DivSequenceRendering.tsx","../../../plugins/sequence/src/DivSequenceRenderer/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/configSchema.ts","../../../plugins/sequence/src/ChromSizesAdapter/configSchema.ts","../../../plugins/sequence/src/IndexedFastaAdapter/configSchema.ts","../../../plugins/sequence/src/SequenceSearchAdapter/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/configSchema.ts","../../../plugins/sequence/src/index.ts","../../../plugins/sequence/src/TwoBitAdapter/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/index.ts","../../../plugins/sequence/src/ChromSizesAdapter/index.ts","../../../plugins/sequence/src/IndexedFastaAdapter/index.ts","../../../plugins/sequence/src/SequenceSearchAdapter/index.ts","../../../plugins/sequence/src/ReferenceSequenceTrack/index.ts","../../../plugins/sequence/src/ReferenceSequenceTrack/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/index.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/model.ts","../../../plugins/sequence/src/createExtensionPoints.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureLabel.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureGlyph.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgOverlay.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Arrow.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Box.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Segments.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/ProcessedTranscript.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Subfeatures.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/util.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgFeatureRendering.tsx","../../../plugins/svg/src/SvgFeatureRenderer/configSchema.ts","../../../plugins/svg/src/index.ts","../../../plugins/gccontent/src/GCContentAdapter/configSchema.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/shared.ts","../../../plugins/gccontent/src/index.ts","../../../plugins/gccontent/src/GCContentTrack/index.ts","../../../plugins/gccontent/src/GCContentAdapter/index.ts","../../../plugins/gccontent/src/GCContentTrack/configSchema.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/index.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/config1.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/stateModel1.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/config2.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/stateModel2.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/MakeSpreadsheetColumnType.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocString.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Text.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocRef.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Number.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocStart.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocEnd.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Row.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/StaticRowSet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Spreadsheet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ImportWizard.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/FilterControls.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/SpreadsheetView.ts","../../../plugins/spreadsheet-view/src/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/index.ts","../../../plugins/spreadsheet-view/src/LaunchSpreadsheetView/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/components/CircularViewOptions.tsx","../../../plugins/sv-inspector/src/SvInspectorView/components/SvInspectorView.tsx","../../../plugins/sv-inspector/src/SvInspectorView/models/adhocFeatureUtils.js","../../../plugins/sv-inspector/src/SvInspectorView/models/breakpointSplitViewFromTableRow.js","../../../plugins/sv-inspector/src/SvInspectorView/index.ts","../../../plugins/sv-inspector/src/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/models/SvInspectorView.ts","../../../plugins/sv-inspector/src/LaunchSvInspectorView/index.ts","../../../plugins/hic/src/HicRenderer/components/HicRendering.tsx","../../../plugins/hic/src/HicRenderer/configSchema.ts","../../../plugins/hic/src/HicRenderer/HicRenderer.tsx","../../../plugins/hic/src/LinearHicDisplay/model.ts","../../../plugins/hic/src/HicAdapter/configSchema.ts","../../../plugins/hic/src/index.ts","../../../plugins/hic/src/HicAdapter/index.ts","../../../plugins/hic/src/HicRenderer/index.ts","../../../plugins/hic/src/HicTrack/index.ts","../../../plugins/hic/src/HicTrack/configSchema.ts","../../../plugins/hic/src/LinearHicDisplay/index.ts","../../../plugins/hic/src/LinearHicDisplay/configSchema.ts","../../../plugins/trix/src/TrixTextSearchAdapter/TrixTextSearchAdapter.ts","../../../plugins/trix/src/TrixTextSearchAdapter/configSchema.ts","../../../plugins/trix/src/index.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/model.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/Highlight/Highlight.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/Highlight/OverviewHighlight.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/index.ts","../../../plugins/grid-bookmark/src/index.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/Highlight/index.tsx","corePlugins.ts"],"sourcesContent":["import { ConfigurationSchema } from '../configuration'\n\nconst configSchema = ConfigurationSchema('BaseFeatureWidget', {})\nexport { configSchema }\n","import { types, addDisposer, Instance } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\n\n// locals\nimport { localStorageGetItem, localStorageSetItem } from '../../util'\n\nfunction localStorageGetNumber(key: string, defaultVal: number) {\n  return +(localStorageGetItem(key) ?? defaultVal)\n}\n\nexport function SequenceFeatureDetailsF() {\n  return types\n    .model('SequenceFeatureDetails')\n    .volatile(() => ({\n      showCoordinates2:\n        localStorageGetItem('sequenceFeatureDetails-showCoordinates2') ||\n        'none',\n      intronBp: localStorageGetNumber('sequenceFeatureDetails-intronBp', 10),\n      upDownBp: localStorageGetNumber('sequenceFeatureDetails-upDownBp', 100),\n      upperCaseCDS: Boolean(\n        JSON.parse(\n          localStorageGetItem('sequenceFeatureDetails-upperCaseCDS') || 'true',\n        ),\n      ),\n      width: 100,\n    }))\n    .views(self => ({\n      get showCoordinates() {\n        return self.showCoordinates2 !== 'none'\n      },\n    }))\n    .actions(self => ({\n      setUpDownBp(f: number) {\n        self.upDownBp = f\n      },\n      setIntronBp(f: number) {\n        self.intronBp = f\n      },\n      setUpperCaseCDS(f: boolean) {\n        self.upperCaseCDS = f\n      },\n      setShowCoordinates(f: string) {\n        self.showCoordinates2 = f\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            localStorageSetItem(\n              'sequenceFeatureDetails-upDownBp',\n              JSON.stringify(self.upDownBp),\n            )\n            localStorageSetItem(\n              'sequenceFeatureDetails-intronBp',\n              JSON.stringify(self.intronBp),\n            )\n            localStorageSetItem(\n              'sequenceFeatureDetails-upperCaseCDS',\n              JSON.stringify(self.upperCaseCDS),\n            )\n            localStorageSetItem(\n              'sequenceFeatureDetails-showCoordinates2',\n              self.showCoordinates2,\n            )\n          }),\n        )\n      },\n    }))\n}\n\nexport type SequenceFeatureDetailsStateModel = ReturnType<\n  typeof SequenceFeatureDetailsF\n>\nexport type SequenceFeatureDetailsModel =\n  Instance<SequenceFeatureDetailsStateModel>\n","import { types, addDisposer, Instance } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport clone from 'clone'\n\n// locals\nimport PluginManager from '../PluginManager'\nimport { getConf } from '../configuration'\nimport { getSession } from '../util'\nimport { ElementId } from '../util/types/mst'\nimport { SequenceFeatureDetailsF } from './SequenceFeatureDetails/model'\n\ninterface Feat {\n  subfeatures?: Record<string, unknown>[]\n}\n\nfunction formatSubfeatures(\n  obj: Feat,\n  depth: number,\n  parse: (obj: Record<string, unknown>) => void,\n  currentDepth = 0,\n  returnObj = {} as Record<string, unknown>,\n) {\n  if (depth <= currentDepth) {\n    return\n  }\n  obj.subfeatures?.map(sub => {\n    formatSubfeatures(sub, depth, parse, currentDepth + 1, returnObj)\n    parse(sub)\n  })\n}\n\n/**\n * #stateModel BaseFeatureWidget\n * displays data about features, allowing configuration callbacks to modify the\n * contents of what is displayed\n *\n * see: formatDetails-\\>feature,formatDetails-\\>subfeatures\n */\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('BaseFeatureWidget', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('BaseFeatureWidget'),\n      /**\n       * #property\n       */\n      featureData: types.frozen(),\n      /**\n       * #property\n       */\n      formattedFields: types.frozen(),\n      /**\n       * #property\n       */\n      unformattedFeatureData: types.frozen(),\n      /**\n       * #property\n       */\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      /**\n       * #property\n       */\n      track: types.safeReference(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n      /**\n       * #property\n       */\n      trackId: types.maybe(types.string),\n      /**\n       * #property\n       */\n      trackType: types.maybe(types.string),\n      /**\n       * #property\n       */\n      maxDepth: types.maybe(types.number),\n\n      /**\n       * #property\n       */\n      sequenceFeatureDetails: types.optional(SequenceFeatureDetailsF(), {}),\n    })\n    .volatile(() => ({\n      error: undefined as unknown,\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFeatureData(featureData: Record<string, unknown>) {\n        self.unformattedFeatureData = featureData\n      },\n      /**\n       * #action\n       */\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n      /**\n       * #action\n       */\n      setFormattedData(feat: Record<string, unknown>) {\n        self.featureData = feat\n      },\n      /**\n       * #action\n       */\n      setExtra(type?: string, trackId?: string, maxDepth?: number) {\n        self.trackId = trackId\n        self.trackType = type\n        self.maxDepth = maxDepth\n      },\n      /**\n       * #action\n       */\n      setError(e: unknown) {\n        self.error = e\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        addDisposer(\n          self,\n          autorun(() => {\n            try {\n              const { unformattedFeatureData, track } = self\n              const session = getSession(self)\n              if (track) {\n                self.setExtra(\n                  track.type,\n                  track.configuration.trackId,\n                  getConf(track, ['formatDetails', 'maxDepth']),\n                )\n              }\n              if (unformattedFeatureData) {\n                const feature = clone(unformattedFeatureData)\n\n                const combine = (\n                  arg2: string,\n                  feature: Record<string, unknown>,\n                ) => ({\n                  ...getConf(session, ['formatDetails', arg2], { feature }),\n                  ...getConf(track, ['formatDetails', arg2], { feature }),\n                })\n\n                if (track) {\n                  // eslint-disable-next-line no-underscore-dangle\n                  feature.__jbrowsefmt = combine('feature', feature)\n\n                  formatSubfeatures(\n                    feature,\n                    getConf(track, ['formatDetails', 'depth']),\n                    sub => {\n                      // eslint-disable-next-line no-underscore-dangle\n                      sub.__jbrowsefmt = combine('subfeatures', sub)\n                    },\n                  )\n                }\n\n                self.setFormattedData(feature)\n              }\n            } catch (e) {\n              console.error(e)\n              self.setError(e)\n            }\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // @ts-expect-error\n      const { featureData, finalizedFeatureData, ...rest } = snap\n      return {\n        unformattedFeatureData: featureData,\n        featureData: finalizedFeatureData,\n        ...rest,\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const { unformattedFeatureData, featureData, ...rest } = snap as Omit<\n        typeof snap,\n        symbol\n      >\n      // finalizedFeatureData avoids running formatter twice if loading from\n      // snapshot\n      return {\n        // replacing undefined with null helps with allowing fields to be\n        // hidden, setting null is not allowed by jexl so we set it to\n        // undefined to hide. see config guide. this replacement happens both\n        // here and when displaying the featureData in base feature widget\n        finalizedFeatureData: JSON.parse(\n          JSON.stringify(featureData, (_, v) => (v === undefined ? null : v)),\n        ),\n        ...rest,\n      }\n    })\n}\n\nexport type BaseFeatureWidgetStateModel = ReturnType<typeof stateModelFactory>\nexport type BaseFeatureWidgetModel = Instance<BaseFeatureWidgetStateModel>\n","import PluginManager from './PluginManager'\nimport { AnyConfigurationSchemaType } from './configuration'\n\n/**\n * base class for a JBrowse plugin\n */\nexport default abstract class Plugin {\n  abstract name: string\n\n  url?: string\n\n  version?: string\n\n  install(_pluginManager: PluginManager): void {}\n\n  configure(_pluginManager: PluginManager): void {}\n\n  configurationSchema?: AnyConfigurationSchemaType\n}\n\nexport type PluginConstructor = new (...args: unknown[]) => Plugin\n","import { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\n\nimport { RemoteAbortSignal } from '../remoteAbortSignals'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\n\nexport default class CoreGetRefNames extends RpcMethodType {\n  name = 'CoreGetRefNames'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (isFeatureAdapter(dataAdapter)) {\n      return dataAdapter.getRefNames(deserializedArgs)\n    }\n    return []\n  }\n}\n","import { ServerSideRendererType } from '../../pluggableElementTypes'\nimport {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n} from '../../pluggableElementTypes/renderers/ServerSideRendererType'\nimport { Region } from '../../util'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  assemblyName: string\n  regions: Region[]\n  adapterConfig: {}\n  rendererType: string\n}\n\nexport function validateRendererType<T>(\n  rendererType: string,\n  RendererType: T,\n): ServerSideRendererType {\n  if (!RendererType) {\n    throw new Error(`renderer \"${rendererType}\" not found`)\n  }\n  // @ts-expect-error\n  if (!RendererType.ReactComponent) {\n    throw new Error(\n      `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n    )\n  }\n  return RendererType as unknown as ServerSideRendererType\n}\n\nexport {\n  type RenderResults,\n  type ResultsSerialized,\n} from '../../pluggableElementTypes/renderers/ServerSideRendererType'\n","import RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from './util'\nimport { RemoteAbortSignal } from '../remoteAbortSignals'\nimport { renameRegionsIfNeeded, getLayoutId } from '../../util'\nimport { RenderArgsSerialized, validateRendererType } from './util'\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport default class CoreGetFeatureDetails extends RpcMethodType {\n  name = 'CoreGetFeatureDetails'\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    )) as RenderArgs\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return RendererType.serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { rendererType, featureId } = deserializedArgs\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return {\n      // @ts-expect-error\n      feature: RendererType.sessions[getLayoutId(args)]?.cachedLayout.layout\n        .getDataByID(featureId)\n        ?.toJSON(),\n    }\n  }\n}\n","import { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\n\nimport { RemoteAbortSignal } from '../remoteAbortSignals'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\n\nexport default class CoreGetMetadata extends RpcMethodType {\n  name = 'CoreGetMetadata'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getMetadata(deserializedArgs)\n      : null\n  }\n}\n","import { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\n\nimport { RemoteAbortSignal } from '../remoteAbortSignals'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\n\nexport default class CoreGetFileInfo extends RpcMethodType {\n  name = 'CoreGetInfo'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getHeader(deserializedArgs)\n      : null\n  }\n}\n","import { toArray } from 'rxjs/operators'\nimport { firstValueFrom } from 'rxjs'\n\n// locals\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from './util'\nimport { RemoteAbortSignal } from '../remoteAbortSignals'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { renameRegionsIfNeeded, Region } from '../../util'\nimport SimpleFeature, {\n  SimpleFeatureSerialized,\n} from '../../util/simpleFeature'\n\nexport default class CoreGetFeatures extends RpcMethodType {\n  name = 'CoreGetFeatures'\n\n  async deserializeReturn(\n    feats: SimpleFeatureSerialized[],\n    args: unknown,\n    rpcDriver: string,\n  ) {\n    const superDeserialized = (await super.deserializeReturn(\n      feats,\n      args,\n      rpcDriver,\n    )) as SimpleFeatureSerialized[]\n    return superDeserialized.map(feat => new SimpleFeature(feat))\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n    return super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    ) as Promise<RenderArgs>\n  }\n\n  async execute(\n    args: {\n      sessionId: string\n      regions: Region[]\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      opts?: any\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { signal, sessionId, adapterConfig, regions, opts } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    const ret = dataAdapter.getFeaturesInMultipleRegions(regions, {\n      ...opts,\n      signal,\n    })\n    const r = await firstValueFrom(ret.pipe(toArray()))\n    return r.map(f => f.toJSON())\n  }\n}\n","import RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport {\n  RenderResults,\n  ResultsSerialized,\n  RenderArgs,\n  RenderArgsSerialized,\n  validateRendererType,\n} from './util'\nimport { RemoteAbortSignal } from '../remoteAbortSignals'\nimport { checkAbortSignal, renameRegionsIfNeeded } from '../../util'\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport default class CoreRender extends RpcMethodType {\n  name = 'CoreRender'\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    )) as RenderArgs\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return RendererType.serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { sessionId, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    const result =\n      rpcDriver === 'MainThreadRpcDriver'\n        ? await RendererType.render(deserializedArgs)\n        : await RendererType.renderInWorker(deserializedArgs)\n\n    checkAbortSignal(signal)\n    return result\n  }\n\n  async deserializeReturn(\n    serializedReturn: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriver: string,\n  ): Promise<unknown> {\n    const des = await super.deserializeReturn(serializedReturn, args, rpcDriver)\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return des\n    }\n\n    const { rendererType } = args\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n    return RendererType.deserializeResultsInClient(\n      des as ResultsSerialized,\n      args,\n    )\n  }\n}\n","import RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { freeAdapterResources } from '../../data_adapters/dataAdapterCache'\n\n/**\n * free up any resources (e.g. cached adapter objects)\n * that are only associated with the given track ID.\n *\n * returns number of objects deleted\n */\nexport default class CoreFreeResources extends RpcMethodType {\n  name = 'CoreFreeResources'\n\n  async execute(specification: {}) {\n    let deleteCount = 0\n\n    deleteCount += freeAdapterResources(specification)\n\n    // pass the freeResources hint along to all the renderers as well\n    this.pluginManager.getRendererTypes().forEach(renderer => {\n      const count = renderer.freeResources(/* specification */)\n      if (count) {\n        deleteCount += count\n      }\n    })\n\n    return deleteCount\n  }\n  async serializeArguments(args: {}, _rpcDriver: string): Promise<{}> {\n    return args\n  }\n}\n","import { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../../pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from './util'\nimport { RemoteAbortSignal } from '../remoteAbortSignals'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { renameRegionsIfNeeded, Region } from '../../util'\n\nexport default class CoreGetFeatureDensityStats extends RpcMethodType {\n  name = 'CoreGetFeatureDensityStats'\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriver: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriver)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      regions: Region[]\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    return dataAdapter.getMultiRegionFeatureDensityStats(\n      regions,\n      deserializedArgs,\n    )\n  }\n}\n","import { ConfigurationSchema } from '../../configuration'\n\n/**\n * #config CytobandAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'CytobandAdapter',\n  {\n    /**\n     * #slot\n     */\n    cytobandLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/cytoband.txt.gz' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import { lazy } from 'react'\nimport { configSchema, stateModelFactory } from './BaseFeatureWidget'\nimport Plugin from './Plugin'\nimport PluginManager from './PluginManager'\nimport * as coreRpcMethods from './rpc/coreRpcMethods'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport CytobandAdapterF from './data_adapters/CytobandAdapter'\n\n// the core plugin, which registers types that ALL JBrowse applications are\n// expected to need.\nexport default class CorePlugin extends Plugin {\n  name = 'CorePlugin'\n\n  install(pluginManager: PluginManager) {\n    // register all our core rpc methods\n    Object.values(coreRpcMethods).forEach(RpcMethod => {\n      pluginManager.addRpcMethod(() => new RpcMethod(pluginManager))\n    })\n\n    CytobandAdapterF(pluginManager)\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'BaseFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./BaseFeatureWidget/BaseFeatureDetail'),\n        ),\n      })\n    })\n  }\n}\n","import { AdapterType } from '../../pluggableElementTypes'\nimport PluginManager from '../../PluginManager'\nimport configSchema from './configSchema'\n\nexport default function CytobandAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'CytobandAdapter',\n        configSchema,\n        getAdapterClass: () => import('./CytobandAdapter').then(f => f.default),\n      }),\n  )\n}\n","import {\n  isModelType,\n  isType,\n  types,\n  IAnyType,\n  IAnyModelType,\n} from 'mobx-state-tree'\n\n// Pluggable elements\nimport PluggableElementBase from './pluggableElementTypes/PluggableElementBase'\nimport RendererType from './pluggableElementTypes/renderers/RendererType'\nimport AdapterType from './pluggableElementTypes/AdapterType'\nimport TrackType from './pluggableElementTypes/TrackType'\nimport DisplayType from './pluggableElementTypes/DisplayType'\nimport ViewType from './pluggableElementTypes/ViewType'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport ConnectionType from './pluggableElementTypes/ConnectionType'\nimport RpcMethodType from './pluggableElementTypes/RpcMethodType'\nimport InternetAccountType from './pluggableElementTypes/InternetAccountType'\nimport TextSearchAdapterType from './pluggableElementTypes/TextSearchAdapterType'\nimport AddTrackWorkflowType from './pluggableElementTypes/AddTrackWorkflowType'\n\nimport {\n  ConfigurationSchema,\n  isBareConfigurationSchemaType,\n} from './configuration'\n\nimport Plugin from './Plugin'\nimport ReExports from './ReExports'\n\nimport {\n  PluggableElementType,\n  PluggableElementMember,\n} from './pluggableElementTypes'\nimport { AbstractRootModel } from './util'\nimport CorePlugin from './CorePlugin'\nimport createJexlInstance from './util/jexl'\nimport { PluginDefinition } from './PluginLoader'\n\n// helper class that keeps groups of callbacks that are then run in a specified\n// order by group\nclass PhasedScheduler<PhaseName extends string> {\n  phaseCallbacks = new Map<PhaseName, Function[]>()\n\n  phaseOrder: PhaseName[] = []\n\n  constructor(...phaseOrder: PhaseName[]) {\n    this.phaseOrder = phaseOrder\n  }\n\n  add(phase: PhaseName, callback: Function) {\n    if (!this.phaseOrder.includes(phase)) {\n      throw new Error(`unknown phase ${phase}`)\n    }\n    let phaseCallbacks = this.phaseCallbacks.get(phase)\n    if (!phaseCallbacks) {\n      phaseCallbacks = []\n      this.phaseCallbacks.set(phase, phaseCallbacks)\n    }\n    phaseCallbacks.push(callback)\n  }\n\n  run() {\n    this.phaseOrder.forEach(phaseName => {\n      this.phaseCallbacks.get(phaseName)?.forEach(callback => callback())\n    })\n  }\n}\n\ntype PluggableElementTypeGroup =\n  | 'renderer'\n  | 'adapter'\n  | 'display'\n  | 'track'\n  | 'connection'\n  | 'view'\n  | 'widget'\n  | 'rpc method'\n  | 'internet account'\n  | 'text search adapter'\n  | 'add track workflow'\n\n/** internal class that holds the info for a certain element type */\nclass TypeRecord<ElementClass extends PluggableElementBase> {\n  registeredTypes: Record<string, ElementClass> = {}\n\n  constructor(\n    public typeName: string,\n    public baseClass:\n      | (new (...args: unknown[]) => ElementClass)\n      // covers abstract class case\n      | (Function & {\n          prototype: ElementClass\n        }),\n  ) {}\n\n  add(name: string, t: ElementClass) {\n    this.registeredTypes[name] = t\n  }\n\n  has(name: string) {\n    return name in this.registeredTypes\n  }\n\n  get(name: string) {\n    if (!this.has(name)) {\n      throw new Error(\n        `${this.typeName} '${name}' not found, perhaps its plugin is not loaded or its plugin has not added it.`,\n      )\n    }\n    return this.registeredTypes[name]\n  }\n\n  all() {\n    return Object.values(this.registeredTypes)\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AnyFunction = (...args: any) => any\n\n/**\n * free-form string-to-unknown mapping of metadata related to the instance of\n * this plugin. `isCore` is typically set to `Boolean(true)` if the plugin was\n * loaded as part of the \"core\" set of plugins for this application. Can also\n * use this metadata to stash other things about why the plugin is loaded, such\n * as where it came from, what plugin depends on it, etc.\n */\nexport type PluginMetadata = Record<string, unknown>\n\nexport interface PluginLoadRecord {\n  metadata?: PluginMetadata\n  plugin: Plugin\n}\nexport interface RuntimePluginLoadRecord extends PluginLoadRecord {\n  definition: PluginDefinition\n}\n\nexport default class PluginManager {\n  plugins: Plugin[] = []\n\n  jexl = createJexlInstance()\n\n  pluginMetadata: Record<string, PluginMetadata> = {}\n\n  runtimePluginDefinitions: PluginDefinition[] = []\n\n  elementCreationSchedule = new PhasedScheduler<PluggableElementTypeGroup>(\n    'renderer',\n    'adapter',\n    'text search adapter',\n    'display',\n    'track',\n    'connection',\n    'view',\n    'widget',\n    'rpc method',\n    'internet account',\n    'add track workflow',\n  ) as PhasedScheduler<PluggableElementTypeGroup> | undefined\n\n  rendererTypes = new TypeRecord('RendererType', RendererType)\n\n  adapterTypes = new TypeRecord('AdapterType', AdapterType)\n\n  textSearchAdapterTypes = new TypeRecord(\n    'TextSearchAdapterType',\n    TextSearchAdapterType,\n  )\n\n  trackTypes = new TypeRecord('TrackType', TrackType)\n\n  displayTypes = new TypeRecord('DisplayType', DisplayType)\n\n  connectionTypes = new TypeRecord('ConnectionType', ConnectionType)\n\n  viewTypes = new TypeRecord('ViewType', ViewType)\n\n  widgetTypes = new TypeRecord('WidgetType', WidgetType)\n\n  rpcMethods = new TypeRecord('RpcMethodType', RpcMethodType)\n\n  addTrackWidgets = new TypeRecord('AddTrackWorkflow', AddTrackWorkflowType)\n\n  internetAccountTypes = new TypeRecord(\n    'InternetAccountType',\n    InternetAccountType,\n  )\n\n  configured = false\n\n  rootModel?: AbstractRootModel\n\n  extensionPoints = new Map<string, Function[]>()\n\n  constructor(initialPlugins: (Plugin | PluginLoadRecord)[] = []) {\n    // add the core plugin\n    this.addPlugin({\n      plugin: new CorePlugin(),\n      metadata: {\n        isCore: true,\n      },\n    })\n\n    // add all the initial plugins\n    initialPlugins.forEach(plugin => {\n      this.addPlugin(plugin)\n    })\n  }\n\n  pluginConfigurationSchemas() {\n    const configurationSchemas: Record<string, unknown> = {}\n    this.plugins.forEach(plugin => {\n      if (plugin.configurationSchema) {\n        configurationSchemas[plugin.name] = plugin.configurationSchema\n      }\n    })\n    return configurationSchemas\n  }\n\n  addPlugin(load: Plugin | PluginLoadRecord | RuntimePluginLoadRecord) {\n    if (this.configured) {\n      throw new Error('JBrowse already configured, cannot add plugins')\n    }\n\n    // check for availability of 'install' and 'configure' as a proxy for being\n    // an 'instanceof Plugin'\n    const [plugin, metadata = {}] =\n      'install' in load && 'configure' in load\n        ? [load, {}]\n        : [load.plugin, load.metadata]\n\n    if (this.plugins.includes(plugin)) {\n      throw new Error('plugin already installed')\n    }\n\n    this.pluginMetadata[plugin.name] = metadata\n    if ('definition' in load) {\n      this.runtimePluginDefinitions.push(load.definition)\n    }\n    plugin.install(this)\n    this.plugins.push(plugin)\n    return this\n  }\n\n  getPlugin(name: string) {\n    return this.plugins.find(p => p.name === name)\n  }\n\n  hasPlugin(name: string) {\n    return this.getPlugin(name) !== undefined\n  }\n\n  createPluggableElements() {\n    // run the creation callbacks for each element type in order.\n    // see elementCreationSchedule above for the creation order\n    if (this.elementCreationSchedule) {\n      this.elementCreationSchedule.run()\n      delete this.elementCreationSchedule\n    }\n    return this\n  }\n\n  setRootModel(rootModel: AbstractRootModel) {\n    this.rootModel = rootModel\n  }\n\n  configure() {\n    if (this.configured) {\n      throw new Error('already configured')\n    }\n\n    this.plugins.forEach(plugin => plugin.configure(this))\n\n    this.configured = true\n\n    return this\n  }\n\n  getElementTypeRecord(\n    groupName: PluggableElementTypeGroup,\n  ): TypeRecord<PluggableElementBase> {\n    switch (groupName) {\n      case 'adapter':\n        return this.adapterTypes\n      case 'text search adapter':\n        return this.textSearchAdapterTypes\n      case 'connection':\n        return this.connectionTypes\n      case 'widget':\n        return this.widgetTypes\n      case 'renderer':\n        return this.rendererTypes\n      case 'display':\n        return this.displayTypes\n      case 'track':\n        return this.trackTypes\n      case 'view':\n        return this.viewTypes\n      case 'rpc method':\n        return this.rpcMethods\n      case 'internet account':\n        return this.internetAccountTypes\n      case 'add track workflow':\n        return this.addTrackWidgets\n      default:\n        throw new Error(`invalid element type '${groupName}'`)\n    }\n  }\n\n  addElementType(\n    groupName: PluggableElementTypeGroup,\n    creationCallback: (pluginManager: PluginManager) => PluggableElementType,\n  ) {\n    if (typeof creationCallback !== 'function') {\n      throw new Error(\n        'must provide a callback function that returns the new type object',\n      )\n    }\n    const typeRecord = this.getElementTypeRecord(groupName)\n\n    this.elementCreationSchedule?.add(groupName, () => {\n      const newElement = creationCallback(this)\n      if (!newElement.name) {\n        throw new Error(`cannot add a ${groupName} with no name`)\n      }\n\n      if (typeRecord.has(newElement.name)) {\n        throw new Error(\n          `${groupName} ${newElement.name} already registered, cannot register it again`,\n        )\n      }\n\n      typeRecord.add(\n        newElement.name,\n        this.evaluateExtensionPoint(\n          'Core-extendPluggableElement',\n          newElement,\n        ) as PluggableElementType,\n      )\n    })\n\n    return this\n  }\n\n  getElementType(groupName: PluggableElementTypeGroup, typeName: string) {\n    return this.getElementTypeRecord(groupName).get(typeName)\n  }\n\n  getElementTypesInGroup(groupName: PluggableElementTypeGroup) {\n    return this.getElementTypeRecord(groupName).all()\n  }\n\n  getTrackElements() {\n    return this.getElementTypesInGroup('track') as TrackType[]\n  }\n\n  getConnectionElements() {\n    return this.getElementTypesInGroup('connection') as ConnectionType[]\n  }\n\n  getAddTrackWorkflowElements() {\n    return this.getElementTypesInGroup(\n      'add track workflow',\n    ) as AddTrackWorkflowType[]\n  }\n\n  getRpcElements() {\n    return this.getElementTypesInGroup('rpc method') as RpcMethodType[]\n  }\n\n  getDisplayElements() {\n    return this.getElementTypesInGroup('display') as DisplayType[]\n  }\n\n  getAdapterElements() {\n    return this.getElementTypesInGroup('adapter') as AdapterType[]\n  }\n\n  /** get a MST type for the union of all specified pluggable MST types */\n  pluggableMstType(\n    groupName: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember,\n    fallback: IAnyType = types.maybe(types.null),\n  ) {\n    const pluggableTypes = this.getElementTypeRecord(groupName)\n      .all()\n      // @ts-expect-error\n      .map(t => t[fieldName])\n      .filter(t => isType(t) && isModelType(t)) as IAnyType[]\n\n    // try to smooth over the case when no types are registered, mostly\n    // encountered in tests\n    if (pluggableTypes.length === 0 && typeof jest === 'undefined') {\n      console.warn(\n        `No pluggable types found matching ('${groupName}','${fieldName}')`,\n      )\n      return fallback\n    }\n    return types.union(...pluggableTypes)\n  }\n\n  /** get a MST type for the union of all specified pluggable config schemas */\n  pluggableConfigSchemaType(\n    typeGroup: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember = 'configSchema',\n  ) {\n    const pluggableTypes = this.getElementTypeRecord(typeGroup)\n      .all()\n      // @ts-expect-error\n      .map(t => t[fieldName])\n      .filter(t => isBareConfigurationSchemaType(t)) as IAnyType[]\n\n    if (pluggableTypes.length === 0) {\n      pluggableTypes.push(ConfigurationSchema('Null', {}))\n    }\n    return types.union(...pluggableTypes) as IAnyModelType\n  }\n\n  jbrequireCache = new Map()\n\n  lib = ReExports\n\n  load = <FTYPE extends AnyFunction>(lib: FTYPE): ReturnType<FTYPE> => {\n    if (!this.jbrequireCache.has(lib)) {\n      this.jbrequireCache.set(lib, lib(this))\n    }\n    return this.jbrequireCache.get(lib)\n  }\n\n  /**\n   * Get the re-exported version of the given package name.\n   * Throws an error if the package is not re-exported by the plugin manager.\n   *\n   * @returns the library's default export\n   */\n  jbrequire = (\n    lib: keyof typeof ReExports | AnyFunction | { default: AnyFunction },\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any => {\n    if (typeof lib === 'string') {\n      const pack = this.lib[lib]\n      if (!pack) {\n        throw new TypeError(\n          `No jbrequire re-export defined for package '${lib}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`,\n        )\n      }\n      return pack\n    }\n\n    if (typeof lib === 'function') {\n      return this.load(lib)\n    }\n\n    if (lib.default) {\n      return this.jbrequire(lib.default)\n    }\n\n    throw new TypeError(\n      'lib passed to jbrequire must be either a string or a function',\n    )\n  }\n\n  getRendererType(typeName: string): RendererType {\n    return this.rendererTypes.get(typeName)\n  }\n\n  getRendererTypes(): RendererType[] {\n    return this.rendererTypes.all()\n  }\n\n  getAdapterType(typeName: string): AdapterType {\n    return this.adapterTypes.get(typeName)\n  }\n\n  getTextSearchAdapterType(typeName: string): TextSearchAdapterType {\n    return this.textSearchAdapterTypes.get(typeName)\n  }\n\n  getTrackType(typeName: string): TrackType {\n    return this.trackTypes.get(typeName)\n  }\n\n  getDisplayType(typeName: string): DisplayType {\n    return this.displayTypes.get(typeName)\n  }\n\n  getViewType(typeName: string): ViewType {\n    return this.viewTypes.get(typeName)\n  }\n\n  getAddTrackWorkflow(typeName: string): AddTrackWorkflowType {\n    return this.addTrackWidgets.get(typeName)\n  }\n\n  getWidgetType(typeName: string): WidgetType {\n    return this.widgetTypes.get(typeName)\n  }\n\n  getConnectionType(typeName: string): ConnectionType {\n    return this.connectionTypes.get(typeName)\n  }\n\n  getRpcMethodType(methodName: string): RpcMethodType {\n    return this.rpcMethods.get(methodName)\n  }\n\n  getInternetAccountType(name: string): InternetAccountType {\n    return this.internetAccountTypes.get(name)\n  }\n\n  addRendererType(cb: (pm: PluginManager) => RendererType) {\n    return this.addElementType('renderer', cb)\n  }\n\n  addAdapterType(cb: (pm: PluginManager) => AdapterType) {\n    return this.addElementType('adapter', cb)\n  }\n\n  addTextSearchAdapterType(cb: (pm: PluginManager) => TextSearchAdapterType) {\n    return this.addElementType('text search adapter', cb)\n  }\n\n  addTrackType(cb: (pm: PluginManager) => TrackType) {\n    // Goes through the already-created displays and registers the ones that\n    // specify this track type\n    const callback = () => {\n      const track = cb(this)\n      const displays = this.getElementTypesInGroup('display') as DisplayType[]\n      displays.forEach(display => {\n        // track may have already added the displayType in its cb\n        if (\n          display.trackType === track.name &&\n          !track.displayTypes.includes(display)\n        ) {\n          track.addDisplayType(display)\n        }\n      })\n      return track\n    }\n    return this.addElementType('track', callback)\n  }\n\n  addDisplayType(cb: (pluginManager: PluginManager) => DisplayType) {\n    return this.addElementType('display', cb)\n  }\n\n  addViewType(cb: (pluginManager: PluginManager) => ViewType) {\n    const callback = () => {\n      const newView = cb(this)\n      const displays = this.getElementTypesInGroup('display') as DisplayType[]\n      displays.forEach(display => {\n        // view may have already added the displayType in its callback\n        // see ViewType for description of extendedName\n        if (\n          (display.viewType === newView.name ||\n            display.viewType === newView.extendedName) &&\n          !newView.displayTypes.includes(display)\n        ) {\n          newView.addDisplayType(display)\n        }\n      })\n      return newView\n    }\n    return this.addElementType('view', callback)\n  }\n\n  addWidgetType(cb: (pm: PluginManager) => WidgetType) {\n    return this.addElementType('widget', cb)\n  }\n\n  addConnectionType(cb: (pm: PluginManager) => ConnectionType) {\n    return this.addElementType('connection', cb)\n  }\n\n  addRpcMethod(cb: (pm: PluginManager) => RpcMethodType) {\n    return this.addElementType('rpc method', cb)\n  }\n\n  addInternetAccountType(cb: (pm: PluginManager) => InternetAccountType) {\n    return this.addElementType('internet account', cb)\n  }\n\n  addAddTrackWorkflowType(cb: (pm: PluginManager) => AddTrackWorkflowType) {\n    return this.addElementType('add track workflow', cb)\n  }\n\n  addToExtensionPoint<T>(\n    extensionPointName: string,\n    callback: (extendee: T, props: Record<string, unknown>) => T,\n  ) {\n    let callbacks = this.extensionPoints.get(extensionPointName)\n    if (!callbacks) {\n      callbacks = []\n      this.extensionPoints.set(extensionPointName, callbacks)\n    }\n    callbacks.push(callback)\n  }\n\n  evaluateExtensionPoint(\n    extensionPointName: string,\n    extendee: unknown,\n    props?: Record<string, unknown>,\n  ) {\n    const callbacks = this.extensionPoints.get(extensionPointName)\n    let accumulator = extendee\n    if (callbacks) {\n      for (const callback of callbacks) {\n        try {\n          accumulator = callback(accumulator, props)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    return accumulator\n  }\n\n  async evaluateAsyncExtensionPoint(\n    extensionPointName: string,\n    extendee: unknown,\n    props?: Record<string, unknown>,\n  ) {\n    const callbacks = this.extensionPoints.get(extensionPointName)\n    let accumulator = extendee\n    if (callbacks) {\n      for (const callback of callbacks) {\n        try {\n          accumulator = await callback(accumulator, props)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    return accumulator\n  }\n}\n","/**\n * Used by plugin build systems to determine if a module is provided by JBrowse\n * globally and thus doesn't need to be bundled. A check in ./modules.tsx makes\n * sure this is in sync with the re-exported modules.\n */\nexport default [\n  'mobx',\n  'mobx-state-tree',\n  'react',\n  'react/jsx-runtime',\n  'react-dom',\n  'mobx-react',\n  '@mui/x-data-grid',\n  '@mui/material/utils',\n  '@material-ui/core/utils',\n  'tss-react/mui',\n  '@material-ui/core',\n  '@mui/material',\n  'prop-types',\n\n  '@mui/material/styles',\n  '@material-ui/core/styles',\n  '@material-ui/core/Accordion',\n  '@material-ui/core/AccordionActions',\n  '@material-ui/core/AccordionDetails',\n  '@material-ui/core/Alert',\n  '@material-ui/core/AlertTitle',\n  '@material-ui/core/Autocomplete',\n  '@material-ui/core/Avatar',\n  '@material-ui/core/AvatarGroup',\n  '@material-ui/core/Backdrop',\n  '@material-ui/core/Badge',\n  '@material-ui/core/Box',\n  '@material-ui/core/Breadcrumbs',\n  '@material-ui/core/Button',\n  '@material-ui/core/ButtonGroup',\n  '@material-ui/core/Card',\n  '@material-ui/core/CardActions',\n  '@material-ui/core/CardActionArea',\n  '@material-ui/core/CardContent',\n  '@material-ui/core/CardHeader',\n  '@material-ui/core/CardMedia',\n  '@material-ui/core/CircularProgress',\n  '@material-ui/core/Collapse',\n  '@material-ui/core/ClickAwayListener',\n  '@material-ui/core/Chip',\n  '@material-ui/core/Checkbox',\n  '@material-ui/core/Container',\n  '@material-ui/core/Dialog',\n  '@material-ui/core/DialogActions',\n  '@material-ui/core/DialogTitle',\n  '@material-ui/core/DialogContent',\n  '@material-ui/core/DialogContentText',\n  '@material-ui/core/Divider',\n  '@material-ui/core/Drawer',\n  '@material-ui/core/Fab',\n  '@material-ui/core/Fade',\n  '@material-ui/core/FilledInput',\n  '@material-ui/core/FormLabel',\n  '@material-ui/core/FormControl',\n  '@material-ui/core/FormControlLabel',\n  '@material-ui/core/FormHelperText',\n  '@material-ui/core/FormGroup',\n  '@material-ui/core/Grid',\n  '@material-ui/core/Grow',\n  '@material-ui/core/Icon',\n  '@material-ui/core/IconButton',\n  '@material-ui/core/Input',\n  '@material-ui/core/InputBase',\n  '@material-ui/core/InputLabel',\n  '@material-ui/core/InputAdornment',\n  '@material-ui/core/Link',\n  '@material-ui/core/LinearProgress',\n  '@material-ui/core/List',\n  '@material-ui/core/ListItem',\n  '@material-ui/core/ListItemAvatar',\n  '@material-ui/core/ListItemSecondaryAction',\n  '@material-ui/core/ListItemIcon',\n  '@material-ui/core/ListSubheader',\n  '@material-ui/core/ListItemText',\n  '@material-ui/core/Menu',\n  '@material-ui/core/MenuItem',\n  '@material-ui/core/MenuList',\n  '@material-ui/core/Modal',\n  '@material-ui/core/NativeSelect',\n  '@material-ui/core/OutlinedInput',\n  '@material-ui/core/Pagination',\n  '@material-ui/core/PaginationItem',\n  '@material-ui/core/Paper',\n  '@material-ui/core/Popover',\n  '@material-ui/core/Popper',\n  '@material-ui/core/Portal',\n  '@material-ui/core/Radio',\n  '@material-ui/core/RadioGroup',\n  '@material-ui/core/Rating',\n  '@material-ui/core/ScopedCssBaseline',\n  '@material-ui/core/Select',\n  '@material-ui/core/Skeleton',\n  '@material-ui/core/Slider',\n  '@material-ui/core/Snackbar',\n  '@material-ui/core/SnackbarContent',\n  '@material-ui/core/SpeedDial',\n  '@material-ui/core/SpeedDialAction',\n  '@material-ui/core/SpeedDialIcon',\n  '@material-ui/core/Stack',\n  '@material-ui/core/Step',\n  '@material-ui/core/StepButton',\n  '@material-ui/core/StepConnector',\n  '@material-ui/core/StepLabel',\n  '@material-ui/core/StepIcon',\n  '@material-ui/core/Stepper',\n  '@material-ui/core/SvgIcon',\n  '@material-ui/core/Switch',\n  '@material-ui/core/Tab',\n  '@material-ui/core/Table',\n  '@material-ui/core/TableBody',\n  '@material-ui/core/TableCell',\n  '@material-ui/core/TableContainer',\n  '@material-ui/core/TableFooter',\n  '@material-ui/core/TableHead',\n  '@material-ui/core/TablePagination',\n  '@material-ui/core/TableRow',\n  '@material-ui/core/TableSortLabel',\n  '@material-ui/core/Tabs',\n  '@material-ui/core/TextField',\n  '@material-ui/core/TextareaAutosize',\n  '@material-ui/core/ToggleButton',\n  '@material-ui/core/ToggleButtonGroup',\n  '@material-ui/core/Toolbar',\n  '@material-ui/core/Tooltip',\n  '@material-ui/core/Typography',\n  '@mui/material/Accordion',\n  '@mui/material/AccordionActions',\n  '@mui/material/AccordionDetails',\n  '@mui/material/Alert',\n  '@mui/material/AlertTitle',\n  '@mui/material/Autocomplete',\n  '@mui/material/Avatar',\n  '@mui/material/AvatarGroup',\n  '@mui/material/Backdrop',\n  '@mui/material/Badge',\n  '@mui/material/Box',\n  '@mui/material/Breadcrumbs',\n  '@mui/material/Button',\n  '@mui/material/ButtonGroup',\n  '@mui/material/Card',\n  '@mui/material/CardActions',\n  '@mui/material/CardActionArea',\n  '@mui/material/CardContent',\n  '@mui/material/CardHeader',\n  '@mui/material/CardMedia',\n  '@mui/material/CircularProgress',\n  '@mui/material/Collapse',\n  '@mui/material/ClickAwayListener',\n  '@mui/material/Chip',\n  '@mui/material/Checkbox',\n  '@mui/material/Container',\n  '@mui/material/Dialog',\n  '@mui/material/DialogActions',\n  '@mui/material/DialogTitle',\n  '@mui/material/DialogContent',\n  '@mui/material/DialogContentText',\n  '@mui/material/Divider',\n  '@mui/material/Drawer',\n  '@mui/material/Fab',\n  '@mui/material/Fade',\n  '@mui/material/FilledInput',\n  '@mui/material/FormLabel',\n  '@mui/material/FormControl',\n  '@mui/material/FormControlLabel',\n  '@mui/material/FormHelperText',\n  '@mui/material/FormGroup',\n  '@mui/material/Grid',\n  '@mui/material/Grow',\n  '@mui/material/Icon',\n  '@mui/material/IconButton',\n  '@mui/material/Input',\n  '@mui/material/InputBase',\n  '@mui/material/InputLabel',\n  '@mui/material/InputAdornment',\n  '@mui/material/Link',\n  '@mui/material/LinearProgress',\n  '@mui/material/List',\n  '@mui/material/ListItem',\n  '@mui/material/ListItemAvatar',\n  '@mui/material/ListItemSecondaryAction',\n  '@mui/material/ListItemIcon',\n  '@mui/material/ListSubheader',\n  '@mui/material/ListItemText',\n  '@mui/material/Menu',\n  '@mui/material/MenuItem',\n  '@mui/material/MenuList',\n  '@mui/material/Modal',\n  '@mui/material/NativeSelect',\n  '@mui/material/OutlinedInput',\n  '@mui/material/Pagination',\n  '@mui/material/PaginationItem',\n  '@mui/material/Paper',\n  '@mui/material/Popover',\n  '@mui/material/Popper',\n  '@mui/material/Portal',\n  '@mui/material/Radio',\n  '@mui/material/RadioGroup',\n  '@mui/material/Rating',\n  '@mui/material/ScopedCssBaseline',\n  '@mui/material/Select',\n  '@mui/material/Skeleton',\n  '@mui/material/Slider',\n  '@mui/material/Snackbar',\n  '@mui/material/SnackbarContent',\n  '@mui/material/SpeedDial',\n  '@mui/material/SpeedDialAction',\n  '@mui/material/SpeedDialIcon',\n  '@mui/material/Stack',\n  '@mui/material/Step',\n  '@mui/material/StepButton',\n  '@mui/material/StepConnector',\n  '@mui/material/StepLabel',\n  '@mui/material/StepIcon',\n  '@mui/material/Stepper',\n  '@mui/material/SvgIcon',\n  '@mui/material/Switch',\n  '@mui/material/Tab',\n  '@mui/material/Table',\n  '@mui/material/TableBody',\n  '@mui/material/TableCell',\n  '@mui/material/TableContainer',\n  '@mui/material/TableFooter',\n  '@mui/material/TableHead',\n  '@mui/material/TablePagination',\n  '@mui/material/TableRow',\n  '@mui/material/TableSortLabel',\n  '@mui/material/Tabs',\n  '@mui/material/TextField',\n  '@mui/material/TextareaAutosize',\n  '@mui/material/ToggleButton',\n  '@mui/material/ToggleButtonGroup',\n  '@mui/material/Toolbar',\n  '@mui/material/Tooltip',\n  '@mui/material/Typography',\n  '@material-ui/lab/ToggleButton',\n  '@material-ui/lab/ToggleButtonGroup',\n  '@material-ui/lab/Autocomplete',\n  '@material-ui/lab/Alert',\n  '@material-ui/lab',\n  '@jbrowse/core/Plugin',\n  '@jbrowse/core/pluggableElementTypes',\n  '@jbrowse/core/pluggableElementTypes/ViewType',\n  '@jbrowse/core/pluggableElementTypes/AdapterType',\n  '@jbrowse/core/pluggableElementTypes/DisplayType',\n  '@jbrowse/core/pluggableElementTypes/TrackType',\n  '@jbrowse/core/pluggableElementTypes/WidgetType',\n\n  '@jbrowse/core/pluggableElementTypes/models',\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType',\n  '@jbrowse/core/configuration',\n  '@jbrowse/core/util/types/mst',\n  '@jbrowse/core/ui',\n  '@jbrowse/core/util',\n  '@jbrowse/core/util/color',\n  '@jbrowse/core/util/layouts',\n  '@jbrowse/core/util/tracks',\n  '@jbrowse/core/util/Base1DViewModel',\n  '@jbrowse/core/util/io',\n  '@jbrowse/core/util/mst-reflection',\n  '@jbrowse/core/util/rxjs',\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail',\n  '@jbrowse/core/data_adapters/BaseAdapter',\n]\n","/* eslint-disable react-refresh/only-export-components */\n// this is all the stuff that the pluginManager re-exports for plugins to use\nimport React, { lazy, LazyExoticComponent, Suspense } from 'react'\nimport * as ReactJSXRuntime from 'react/jsx-runtime'\nimport * as ReactDom from 'react-dom'\nimport * as mobx from 'mobx'\nimport * as mst from 'mobx-state-tree'\nimport * as mxreact from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport PropTypes from 'prop-types'\n\nimport * as MUIStyles from '@mui/material/styles'\nimport * as MUIUtils from '@mui/material/utils'\nimport { useTheme } from '@mui/material'\nimport {\n  useGridApiContext,\n  useGridApiRef,\n  useGridRootProps,\n} from '@mui/x-data-grid'\n\n// material-ui lab\nimport * as BaseAdapterExports from '../data_adapters/BaseAdapter'\n\nimport Base1DView from '../util/Base1DViewModel'\nimport * as pluggableElementTypes from '../pluggableElementTypes'\nimport ViewType from '../pluggableElementTypes/ViewType'\nimport AdapterType from '../pluggableElementTypes/AdapterType'\nimport DisplayType from '../pluggableElementTypes/DisplayType'\nimport TrackType from '../pluggableElementTypes/TrackType'\nimport WidgetType from '../pluggableElementTypes/WidgetType'\n\nimport * as pluggableElementTypeModels from '../pluggableElementTypes/models'\nimport * as ServerSideRendererType from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport CircularChordRendererType from '../pluggableElementTypes/renderers/CircularChordRendererType'\nimport * as BoxRendererType from '../pluggableElementTypes/renderers/BoxRendererType'\nimport * as FeatureRendererType from '../pluggableElementTypes/renderers/FeatureRendererType'\nimport * as RendererType from '../pluggableElementTypes/renderers/RendererType'\n\nimport * as Configuration from '../configuration'\nimport Plugin from '../Plugin'\nimport * as coreUi from '../ui'\nimport * as coreUtil from '../util'\nimport * as coreColor from '../util/color'\nimport * as coreLayouts from '../util/layouts'\nimport * as trackUtils from '../util/tracks'\nimport * as coreIo from '../util/io'\nimport * as coreMstReflection from '../util/mst-reflection'\nimport * as rxjs from '../util/rxjs'\nimport * as mstTypes from '../util/types/mst'\n\nimport reExportsList from './list'\n\nconst Entries = {\n  Accordion: lazy(() => import('@mui/material/Accordion')),\n  AccordionActions: lazy(() => import('@mui/material/AccordionActions')),\n  AccordionDetails: lazy(() => import('@mui/material/AccordionDetails')),\n  Alert: lazy(() => import('@mui/material/Alert')),\n  AlertTitle: lazy(() => import('@mui/material/AlertTitle')),\n  Autocomplete: lazy(() => import('@mui/material/Autocomplete')),\n  Avatar: lazy(() => import('@mui/material/Avatar')),\n  AvatarGroup: lazy(() => import('@mui/material/AvatarGroup')),\n  Backdrop: lazy(() => import('@mui/material/Backdrop')),\n  Badge: lazy(() => import('@mui/material/Badge')),\n  Box: lazy(() => import('@mui/material/Box')),\n  Breadcrumbs: lazy(() => import('@mui/material/Breadcrumbs')),\n  Button: lazy(() => import('@mui/material/Button')),\n  ButtonGroup: lazy(() => import('@mui/material/ButtonGroup')),\n  Card: lazy(() => import('@mui/material/Card')),\n  CardActions: lazy(() => import('@mui/material/CardActions')),\n  CardActionArea: lazy(() => import('@mui/material/CardActionArea')),\n  CardContent: lazy(() => import('@mui/material/CardContent')),\n  CardHeader: lazy(() => import('@mui/material/CardHeader')),\n  CardMedia: lazy(() => import('@mui/material/CardMedia')),\n  CircularProgress: lazy(() => import('@mui/material/CircularProgress')),\n  Collapse: lazy(() => import('@mui/material/Collapse')),\n  ClickAwayListener: lazy(() => import('@mui/material/ClickAwayListener')),\n  Chip: lazy(() => import('@mui/material/Chip')),\n  Checkbox: lazy(() => import('@mui/material/Checkbox')),\n  Container: lazy(() => import('@mui/material/Container')),\n  Dialog: lazy(() => import('@mui/material/Dialog')),\n  DialogActions: lazy(() => import('@mui/material/DialogActions')),\n  DialogTitle: lazy(() => import('@mui/material/DialogTitle')),\n  DialogContent: lazy(() => import('@mui/material/DialogContent')),\n  DialogContentText: lazy(() => import('@mui/material/DialogContentText')),\n  Divider: lazy(() => import('@mui/material/Divider')),\n  Drawer: lazy(() => import('@mui/material/Drawer')),\n  Fab: lazy(() => import('@mui/material/Fab')),\n  Fade: lazy(() => import('@mui/material/Fade')),\n  FilledInput: lazy(() => import('@mui/material/FilledInput')),\n  FormLabel: lazy(() => import('@mui/material/FormLabel')),\n  FormControl: lazy(() => import('@mui/material/FormControl')),\n  FormControlLabel: lazy(() => import('@mui/material/FormControlLabel')),\n  FormHelperText: lazy(() => import('@mui/material/FormHelperText')),\n  FormGroup: lazy(() => import('@mui/material/FormGroup')),\n  Grid: lazy(() => import('@mui/material/Grid')),\n  Grow: lazy(() => import('@mui/material/Grow')),\n  Icon: lazy(() => import('@mui/material/Icon')),\n  IconButton: lazy(() => import('@mui/material/IconButton')),\n  Input: lazy(() => import('@mui/material/Input')),\n  InputBase: lazy(() => import('@mui/material/InputBase')),\n  InputLabel: lazy(() => import('@mui/material/InputLabel')),\n  InputAdornment: lazy(() => import('@mui/material/InputAdornment')),\n  Link: lazy(() => import('@mui/material/Link')),\n  LinearProgress: lazy(() => import('@mui/material/LinearProgress')),\n  List: lazy(() => import('@mui/material/List')),\n  ListItem: lazy(() => import('@mui/material/ListItem')),\n  ListItemAvatar: lazy(() => import('@mui/material/ListItemAvatar')),\n  ListItemSecondaryAction: lazy(\n    () => import('@mui/material/ListItemSecondaryAction'),\n  ),\n  ListItemIcon: lazy(() => import('@mui/material/ListItemIcon')),\n  ListSubheader: lazy(() => import('@mui/material/ListSubheader')),\n  ListItemText: lazy(() => import('@mui/material/ListItemText')),\n  Menu: lazy(() => import('@mui/material/Menu')),\n  MenuItem: lazy(() => import('@mui/material/MenuItem')),\n  MenuList: lazy(() => import('@mui/material/MenuList')),\n  Modal: lazy(() => import('@mui/material/Modal')),\n  NativeSelect: lazy(() => import('@mui/material/NativeSelect')),\n  OutlinedInput: lazy(() => import('@mui/material/OutlinedInput')),\n  Pagination: lazy(() => import('@mui/material/Pagination')),\n  PaginationItem: lazy(() => import('@mui/material/PaginationItem')),\n  Paper: lazy(() => import('@mui/material/Paper')),\n  Popover: lazy(() => import('@mui/material/Popover')),\n  Popper: lazy(() => import('@mui/material/Popper')),\n  Portal: lazy(() => import('@mui/material/Portal')),\n  Radio: lazy(() => import('@mui/material/Radio')),\n  RadioGroup: lazy(() => import('@mui/material/RadioGroup')),\n  Rating: lazy(() => import('@mui/material/Rating')),\n  ScopedCssBaseline: lazy(() => import('@mui/material/ScopedCssBaseline')),\n  Select: lazy(() => import('@mui/material/Select')),\n  Skeleton: lazy(() => import('@mui/material/Skeleton')),\n  Slider: lazy(() => import('@mui/material/Slider')),\n  Snackbar: lazy(() => import('@mui/material/Snackbar')),\n  SnackbarContent: lazy(() => import('@mui/material/SnackbarContent')),\n  SpeedDial: lazy(() => import('@mui/material/SpeedDial')),\n  SpeedDialAction: lazy(() => import('@mui/material/SpeedDialAction')),\n  SpeedDialIcon: lazy(() => import('@mui/material/SpeedDialIcon')),\n  Stack: lazy(() => import('@mui/material/Stack')),\n  Step: lazy(() => import('@mui/material/Step')),\n  StepButton: lazy(() => import('@mui/material/StepButton')),\n  StepConnector: lazy(() => import('@mui/material/StepConnector')),\n  StepLabel: lazy(() => import('@mui/material/StepLabel')),\n  StepIcon: lazy(() => import('@mui/material/StepIcon')),\n  Stepper: lazy(() => import('@mui/material/Stepper')),\n  SvgIcon: lazy(() => import('@mui/material/SvgIcon')),\n  Switch: lazy(() => import('@mui/material/Switch')),\n  Tab: lazy(() => import('@mui/material/Tab')),\n  Table: lazy(() => import('@mui/material/Table')),\n  TableBody: lazy(() => import('@mui/material/TableBody')),\n  TableCell: lazy(() => import('@mui/material/TableCell')),\n  TableContainer: lazy(() => import('@mui/material/TableContainer')),\n  TableFooter: lazy(() => import('@mui/material/TableFooter')),\n  TableHead: lazy(() => import('@mui/material/TableHead')),\n  TablePagination: lazy(() => import('@mui/material/TablePagination')),\n  TableRow: lazy(() => import('@mui/material/TableRow')),\n  TableSortLabel: lazy(() => import('@mui/material/TableSortLabel')),\n  Tabs: lazy(() => import('@mui/material/Tabs')),\n  TextField: lazy(() => import('@mui/material/TextField')),\n  TextareaAutosize: lazy(() => import('@mui/material/TextareaAutosize')),\n  ToggleButton: lazy(() => import('@mui/material/ToggleButton')),\n  ToggleButtonGroup: lazy(() => import('@mui/material/ToggleButtonGroup')),\n  Toolbar: lazy(() => import('@mui/material/Toolbar')),\n  Tooltip: lazy(() => import('@mui/material/Tooltip')),\n  Typography: lazy(() => import('@mui/material/Typography')),\n}\n\nconst LazyMUICore = Object.fromEntries(\n  Object.entries(Entries).map(([key, ReactComponent]) => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const Component = React.forwardRef((props: any, ref) => (\n      <Suspense fallback={null}>\n        <ReactComponent {...props} ref={ref} />\n      </Suspense>\n    ))\n    Component.displayName = key\n    return [key, Component]\n  }),\n)\n\nconst MaterialPrefixMUI = Object.fromEntries(\n  Object.entries(LazyMUICore).map(([key, value]) => [\n    '@material-ui/core/' + key,\n    value,\n  ]),\n)\n\nconst MuiPrefixMUI = Object.fromEntries(\n  Object.entries(LazyMUICore).map(([key, value]) => [\n    '@mui/material/' + key,\n    value,\n  ]),\n)\n\nconst Attributes = lazy(() => import('./Attributes'))\nconst FeatureDetails = lazy(() => import('./FeatureDetails'))\nconst BaseCard = lazy(() => import('./BaseCard'))\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst DataGridEntries: Record<string, LazyExoticComponent<any>> = {\n  DataGrid: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.DataGrid })),\n  ),\n  GridActionsCellItem: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridActionsCellItem,\n    })),\n  ),\n  GridAddIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridAddIcon,\n    })),\n  ),\n  GridArrowDownwardIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridArrowDownwardIcon,\n    })),\n  ),\n  GridArrowUpwardIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridArrowUpwardIcon,\n    })),\n  ),\n  GridCellCheckboxForwardRef: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCellCheckboxForwardRef,\n    })),\n  ),\n  GridCellCheckboxRenderer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCellCheckboxRenderer,\n    })),\n  ),\n  GridCheckCircleIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCheckCircleIcon,\n    })),\n  ),\n  GridCheckIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCheckIcon,\n    })),\n  ),\n  GridCloseIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCloseIcon,\n    })),\n  ),\n  GridColumnHeaderSeparator: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnHeaderSeparator,\n    })),\n  ),\n  GridColumnHeaderSortIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnHeaderSortIcon,\n    })),\n  ),\n  GridColumnIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnIcon,\n    })),\n  ),\n  GridColumnMenu: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnMenu,\n    })),\n  ),\n  GridColumnMenuContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnMenuContainer,\n    })),\n  ),\n  GridDragIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridDragIcon,\n    })),\n  ),\n  GridExpandMoreIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridExpandMoreIcon,\n    })),\n  ),\n  GridFilterAltIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterAltIcon,\n    })),\n  ),\n  GridFilterForm: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterForm,\n    })),\n  ),\n  GridFilterListIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterListIcon,\n    })),\n  ),\n  GridFilterPanel: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterPanel,\n    })),\n  ),\n  GridFooter: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridFooter })),\n  ),\n  GridFooterContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFooterContainer,\n    })),\n  ),\n  GridHeader: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridHeader })),\n  ),\n  GridHeaderCheckbox: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridHeaderCheckbox,\n    })),\n  ),\n  GridKeyboardArrowRight: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridKeyboardArrowRight,\n    })),\n  ),\n  GridLoadIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridLoadIcon,\n    })),\n  ),\n  GridLoadingOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridLoadingOverlay,\n    })),\n  ),\n  GridMenuIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridMenuIcon,\n    })),\n  ),\n  GridMoreVertIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridMoreVertIcon,\n    })),\n  ),\n  GridNoRowsOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridNoRowsOverlay,\n    })),\n  ),\n  GridOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridOverlay,\n    })),\n  ),\n  GridPagination: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridPagination,\n    })),\n  ),\n  GridPanel: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridPanel })),\n  ),\n  GridPanelWrapper: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridPanelWrapper,\n    })),\n  ),\n  GridRemoveIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridRemoveIcon,\n    })),\n  ),\n  GridRoot: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridRoot })),\n  ),\n  GridRowCount: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridRowCount,\n    })),\n  ),\n  GridSaveAltIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSaveAltIcon,\n    })),\n  ),\n  GridSearchIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSearchIcon,\n    })),\n  ),\n  GridSelectedRowCount: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSelectedRowCount,\n    })),\n  ),\n  GridSeparatorIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSeparatorIcon,\n    })),\n  ),\n  GridTableRowsIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridTableRowsIcon,\n    })),\n  ),\n  GridToolbar: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbar,\n    })),\n  ),\n  GridToolbarColumnsButton: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarColumnsButton,\n    })),\n  ),\n  GridToolbarContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarContainer,\n    })),\n  ),\n  GridToolbarDensitySelector: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarDensitySelector,\n    })),\n  ),\n  GridToolbarExport: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarExport,\n    })),\n  ),\n  GridToolbarExportContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarExportContainer,\n    })),\n  ),\n  GridToolbarFilterButton: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarFilterButton,\n    })),\n  ),\n  GridTripleDotsVerticalIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridTripleDotsVerticalIcon,\n    })),\n  ),\n  GridViewHeadlineIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridViewHeadlineIcon,\n    })),\n  ),\n  GridViewStreamIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridViewStreamIcon,\n    })),\n  ),\n}\n\nconst LazyDataGridComponents = Object.fromEntries(\n  Object.entries(DataGridEntries).map(([key, ReactComponent]) => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const Component = React.forwardRef((props: any, ref) => (\n      <Suspense fallback={null}>\n        <ReactComponent {...props} ref={ref} />\n      </Suspense>\n    ))\n    Component.displayName = key\n    return [key, Component]\n  }),\n)\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LazyAttributes = React.forwardRef((props: any, ref) => (\n  <Suspense fallback={null}>\n    <Attributes {...props} ref={ref} />\n  </Suspense>\n))\nLazyAttributes.displayName = 'Attributes'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LazyFeatureDetails = React.forwardRef((props: any, ref) => (\n  <Suspense fallback={null}>\n    <FeatureDetails {...props} ref={ref} />\n  </Suspense>\n))\nLazyFeatureDetails.displayName = 'FeatureDetails'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LazyBaseCard = React.forwardRef((props: any, ref) => (\n  <Suspense fallback={null}>\n    <BaseCard {...props} ref={ref} />\n  </Suspense>\n))\nLazyBaseCard.displayName = 'BaseCard'\n\nconst libs = {\n  mobx,\n  'mobx-state-tree': mst,\n  react: React,\n  'react/jsx-runtime': ReactJSXRuntime,\n  'react-dom': ReactDom,\n  'mobx-react': mxreact,\n  '@mui/x-data-grid': {\n    useGridApiContext,\n    useGridApiRef,\n    useGridRootProps,\n    ...LazyDataGridComponents,\n  },\n\n  // special case so plugins can easily use @mui/icons-material; don't remove\n  '@mui/material/utils': MUIUtils,\n  '@material-ui/core/utils': MUIUtils,\n  'tss-react/mui': { makeStyles },\n\n  '@material-ui/core': {\n    ...LazyMUICore,\n    useTheme,\n    alpha: MUIStyles.alpha,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    makeStyles: (args: any) => {\n      const useStyles = makeStyles()(args)\n      return () => useStyles().classes\n    },\n  },\n  '@mui/material': {\n    ...LazyMUICore,\n    alpha: MUIStyles.alpha,\n    useTheme: MUIStyles.useTheme,\n  },\n  'prop-types': PropTypes,\n\n  // end special case\n  // material-ui subcomponents, should get rid of these\n  '@mui/material/styles': {\n    MUIStyles,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    makeStyles: (args: any) => {\n      const useStyles = makeStyles()(args)\n      return () => useStyles().classes\n    },\n  },\n  '@material-ui/core/styles': {\n    MUIStyles,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    makeStyles: (args: any) => {\n      const useStyles = makeStyles()(args)\n      return () => useStyles().classes\n    },\n  },\n  ...MaterialPrefixMUI,\n  ...MuiPrefixMUI,\n\n  // these are core in @mui/material, but used to be in @material-ui/lab\n  '@material-ui/lab/ToggleButton': Entries.ToggleButton,\n  '@material-ui/lab/ToggleButtonGroup': Entries.ToggleButtonGroup,\n  '@material-ui/lab/Autocomplete': Entries.Autocomplete,\n  '@material-ui/lab/Alert': Entries.Alert,\n  '@material-ui/lab': {\n    Alert: Entries.Alert,\n    Autocomplete: Entries.Autocomplete,\n    ToggleButton: Entries.ToggleButton,\n    ToggleButtonGroup: Entries.ToggleButtonGroup,\n  },\n\n  '@jbrowse/core/Plugin': Plugin,\n  '@jbrowse/core/pluggableElementTypes': pluggableElementTypes,\n  '@jbrowse/core/pluggableElementTypes/ViewType': ViewType,\n  '@jbrowse/core/pluggableElementTypes/AdapterType': AdapterType,\n  '@jbrowse/core/pluggableElementTypes/DisplayType': DisplayType,\n  '@jbrowse/core/pluggableElementTypes/TrackType': TrackType,\n  '@jbrowse/core/pluggableElementTypes/WidgetType': WidgetType,\n  '@jbrowse/core/pluggableElementTypes/models': pluggableElementTypeModels,\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType':\n    ServerSideRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType':\n    CircularChordRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType':\n    BoxRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType':\n    FeatureRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType': RendererType,\n  '@jbrowse/core/configuration': Configuration,\n  '@jbrowse/core/util/types/mst': mstTypes,\n  '@jbrowse/core/ui': coreUi,\n  '@jbrowse/core/util': coreUtil,\n  '@jbrowse/core/util/color': coreColor,\n  '@jbrowse/core/util/layouts': coreLayouts,\n  '@jbrowse/core/util/tracks': trackUtils,\n  '@jbrowse/core/util/Base1DViewModel': Base1DView,\n  '@jbrowse/core/util/io': coreIo,\n  '@jbrowse/core/util/mst-reflection': coreMstReflection,\n  '@jbrowse/core/util/rxjs': rxjs,\n\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail': {\n    Attributes: LazyAttributes,\n    FeatureDetails: LazyFeatureDetails,\n    BaseCard: LazyBaseCard,\n  },\n  '@jbrowse/core/data_adapters/BaseAdapter': BaseAdapterExports,\n}\n\nconst libsList = Object.keys(libs)\n\n// make sure that all the items in the ReExports/list array (used by build\n// systems and such) are included here, and vice versa\nconst inLibsOnly = libsList.filter(mod => !reExportsList.includes(mod))\nif (inLibsOnly.length > 0) {\n  throw new Error(\n    `The following modules are in the modules libs, but not the re-exports list: ${inLibsOnly.join(\n      ', ',\n    )}`,\n  )\n}\nconst inReExportsOnly = reExportsList.filter(mod => !libsList.includes(mod))\nif (inReExportsOnly.length) {\n  throw new Error(\n    `The following modules are in the re-exports list, but not the modules libs: ${inReExportsOnly.join(\n      ', ',\n    )}`,\n  )\n}\n\nexport default libs\n","import React from 'react'\nimport TextSearchAdapterType from '../pluggableElementTypes/TextSearchAdapterType'\nimport { SearchType } from '../data_adapters/BaseAdapter'\n\nexport interface BaseResultArgs {\n  label: string\n\n  displayString?: string\n\n  renderingComponent?: React.ReactElement\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  locString?: string\n\n  refName?: string\n\n  trackId?: string\n\n  score?: number\n\n  results?: BaseResult[]\n}\n\nexport default class BaseResult {\n  label: string\n\n  renderingComponent?: React.ReactElement\n\n  displayString?: string\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  trackId?: string\n\n  score: number\n\n  locString?: string\n\n  results?: BaseResult[]\n  constructor(args: BaseResultArgs) {\n    this.label = args.label\n    this.locString = args.locString\n    this.renderingComponent = args.renderingComponent\n    this.displayString = args.displayString\n    this.matchedAttribute = args.matchedAttribute\n    this.matchedObject = args.matchedObject\n    this.textSearchAdapter = args.textSearchAdapter\n    this.relevance = args.relevance\n    this.trackId = args.trackId\n    this.score = args.score || 1\n    this.results = args.results || []\n  }\n\n  getLabel() {\n    return this.label\n  }\n\n  getDisplayString() {\n    return this.displayString || this.label\n  }\n\n  getRenderingComponent() {\n    return this.renderingComponent\n  }\n\n  getTrackId() {\n    return this.trackId\n  }\n\n  getScore() {\n    return this.score\n  }\n\n  updateScore(newScore: number) {\n    this.score = newScore\n    return this.score\n  }\n\n  getId() {\n    return `${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`\n  }\n\n  hasLocation() {\n    return !!this.locString\n  }\n\n  getLocation() {\n    return this.locString\n  }\n\n  getComboResults() {\n    return this.results\n  }\n}\n\nexport class RefSequenceResult extends BaseResult {\n  refName: string\n\n  constructor(args: BaseResultArgs) {\n    super(args)\n    this.refName = args.refName ?? ''\n  }\n\n  getLocation() {\n    return this.refName\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, IAnyModelType, IAnyComplexType } from 'mobx-state-tree'\nimport { stringToJexlExpression } from '../util/jexlStrings'\nimport { FileLocation } from '../util/types/mst'\nimport { getEnv } from '../util'\n\nfunction isValidColorString(/* str */) {\n  // TODO: check all the crazy cases for whether it's a valid HTML/CSS color string\n  return true\n}\nconst typeModels: Record<string, any> = {\n  stringArray: types.array(types.string),\n  stringArrayMap: types.map(types.array(types.string)),\n  numberMap: types.map(types.number),\n  boolean: types.boolean,\n  color: types.refinement('Color', types.string, isValidColorString),\n  integer: types.integer,\n  number: types.number,\n  string: types.string,\n  text: types.string,\n  fileLocation: FileLocation,\n  frozen: types.frozen(),\n}\n\n// default values we use if the defaultValue is malformed or does not work\nconst fallbackDefaults: Record<string, any> = {\n  stringArray: [],\n  stringArrayMap: {},\n  numberMap: {},\n  boolean: true,\n  color: 'black',\n  integer: 1,\n  number: 1,\n  string: '',\n  text: '',\n  fileLocation: { uri: '/path/to/resource.txt', locationType: 'UriLocation' },\n  frozen: {},\n}\n\nconst literalJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return self.value\n    },\n  },\n})\n\nconst objectJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return JSON.stringify(self.value)\n    },\n  },\n})\n\n// custom actions for modifying the value models\nconst typeModelExtensions: Record<string, (self: any) => any> = {\n  fileLocation: objectJSON,\n  number: literalJSON,\n  integer: literalJSON,\n  boolean: literalJSON,\n  frozen: objectJSON,\n  // special actions for working with stringArray slots\n  stringArray: (self: { value: string[] }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(val: string) {\n        self.value.push(val)\n      },\n      removeAtIndex(idx: number) {\n        self.value.splice(idx, 1)\n      },\n      setAtIndex(idx: number, val: string) {\n        self.value[idx] = val\n      },\n    },\n  }),\n  stringArrayMap: (self: { value: Map<string, string[]> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: any) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n      addToKey(key: string, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.push(val)\n      },\n      removeAtKeyIndex(key: string, idx: number) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.splice(idx, 1)\n      },\n      setAtKeyIndex(key: string, idx: number, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar[idx] = val\n      },\n    },\n  }),\n  numberMap: (self: { value: Map<string, number> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: number) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n    },\n  }),\n}\n\n// const FunctionStringType = types.refinement(\n//   'FunctionString',\n//   types.string,\n//   str => functionRegexp.test(str),\n// )\n\nconst JexlStringType = types.refinement('JexlString', types.string, str =>\n  str.startsWith('jexl:'),\n)\nfunction json(value: any) {\n  return value?.toJSON ? value.toJSON() : `\"${value}\"`\n}\nexport interface ConfigSlotDefinition {\n  /** human-readable description of the slot's meaning */\n  description?: string\n  /** custom base MST model for the slot's value */\n  model?: IAnyModelType | IAnyComplexType\n  /** name of the type of slot, e.g. \"string\", \"number\", \"stringArray\" */\n  type: string\n  /** default value of the slot */\n  defaultValue: any\n  /** parameter names of the function callback */\n  contextVariable?: string[]\n}\n\n/**\n * builds a MST model for a configuration slot\n *\n * @param slotName -\n * @param  definition -\n */\nexport default function ConfigSlot(\n  slotName: string,\n  {\n    description = '',\n    model,\n    type,\n    defaultValue,\n    contextVariable = [],\n  }: ConfigSlotDefinition,\n) {\n  if (!type) {\n    throw new Error('type name required')\n  }\n  if (!model) {\n    model = typeModels[type]\n  }\n  if (!model) {\n    throw new Error(\n      `no builtin config slot type \"${type}\", and no 'model' param provided`,\n    )\n  }\n\n  if (defaultValue === undefined) {\n    throw new Error(\"no 'defaultValue' provided\")\n  }\n\n  // if the `type` is something like `color`, then the model name\n  // here will be `ColorConfigSlot`\n  const configSlotModelName = `${slotName\n    .charAt(0)\n    .toUpperCase()}${slotName.slice(1)}ConfigSlot`\n  let slot = types\n    .model(configSlotModelName, {\n      name: types.literal(slotName),\n      description: types.literal(description),\n      type: types.literal(type),\n      value: types.optional(types.union(JexlStringType, model), defaultValue),\n    })\n    .volatile(() => ({\n      contextVariable,\n    }))\n    .views(self => ({\n      get isCallback() {\n        return String(self.value).startsWith('jexl:')\n      },\n    }))\n    .views(self => ({\n      get expr() {\n        if (self.isCallback) {\n          // compile as jexl function\n          const { pluginManager } = getEnv(self)\n          if (!pluginManager && typeof jest === 'undefined') {\n            console.warn(\n              'no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)',\n            )\n          }\n          return stringToJexlExpression(String(self.value), pluginManager?.jexl)\n        }\n        return { evalSync: () => self.value }\n      },\n\n      // JS representation of the value of this slot, suitable\n      // for embedding in either JSON or a JS function string.\n      // many of the data types override this in typeModelExtensions\n      get valueJSON(): any[] | Record<string, any> | string | undefined {\n        if (self.isCallback) {\n          return undefined\n        }\n\n        return json(self.value)\n      },\n    }))\n    .preProcessSnapshot(val =>\n      typeof val === 'object' && val.name === slotName\n        ? val\n        : {\n            name: slotName,\n            description,\n            type,\n            value: val,\n          },\n    )\n    .postProcessSnapshot(snap => {\n      if (typeof snap.value === 'object') {\n        return JSON.stringify(snap.value) !== JSON.stringify(defaultValue)\n          ? snap.value\n          : undefined\n      }\n      return snap.value !== defaultValue ? snap.value : undefined\n    })\n    .actions(self => ({\n      set(newVal: any) {\n        self.value = newVal\n      },\n      reset() {\n        self.value = defaultValue\n      },\n      convertToCallback() {\n        if (self.isCallback) {\n          return\n        }\n        self.value = `jexl:${self.valueJSON || \"''\"}`\n      },\n      convertToValue() {\n        if (!self.isCallback) {\n          return\n        }\n        // try calling it with no arguments\n        try {\n          const funcResult = self.expr.evalSync()\n          if (funcResult !== undefined) {\n            self.value = funcResult\n            return\n          }\n        } catch (e) {\n          /* ignore */\n        }\n        self.value = defaultValue\n        // if it is still a callback (happens if the defaultValue is a callback),\n        // then use the last-resort fallback default\n\n        // if defaultValue has jexl: string, run this part\n        if (self.isCallback) {\n          if (!(type in fallbackDefaults)) {\n            throw new Error(`no fallbackDefault defined for type ${type}`)\n          }\n          self.value = fallbackDefaults[type]\n        }\n      },\n    }))\n\n  // if there are any type-specific extensions (views or actions)\n  //  to the slot, add those in\n  if (typeModelExtensions[type]) {\n    slot = slot.extend(typeModelExtensions[type])\n  }\n\n  const completeModel = types.optional(slot, {\n    name: slotName,\n    type,\n    description,\n    value: defaultValue,\n  })\n  const m = completeModel\n  Object.defineProperty(m, 'isJBrowseConfigurationSlot', { value: true })\n  return m\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  types,\n  isStateTreeNode,\n  isType,\n  isLateType,\n  getSnapshot,\n  IAnyType,\n  SnapshotOut,\n} from 'mobx-state-tree'\n\nimport { ElementId } from '../util/types/mst'\n\nimport ConfigSlot, { ConfigSlotDefinition } from './configurationSlot'\nimport { isConfigurationSchemaType } from './util'\nimport { AnyConfigurationSchemaType } from './types'\n\nexport type {\n  AnyConfigurationSchemaType,\n  AnyConfigurationModel,\n  AnyConfigurationSlot,\n  AnyConfigurationSlotType,\n} from './types'\n\nfunction isEmptyObject(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    !Array.isArray(thing) &&\n    thing !== null &&\n    Object.keys(thing).length === 0\n  )\n}\n\nfunction isEmptyArray(thing: unknown) {\n  return Array.isArray(thing) && thing.length === 0\n}\n\nexport interface ConfigurationSchemaDefinition {\n  [n: string]:\n    | ConfigSlotDefinition\n    | ConfigurationSchemaDefinition\n    | string\n    | number\n    | IAnyType\n}\n\nexport interface ConfigurationSchemaOptions<\n  BASE_SCHEMA extends AnyConfigurationSchemaType | undefined,\n  EXPLICIT_IDENTIFIER extends string | undefined,\n> {\n  explicitlyTyped?: boolean\n  explicitIdentifier?: EXPLICIT_IDENTIFIER\n  implicitIdentifier?: string | boolean\n  baseConfiguration?: BASE_SCHEMA\n\n  actions?: (self: unknown) => any\n  views?: (self: unknown) => any\n  extend?: (self: unknown) => any\n  preProcessSnapshot?: (snapshot: {}) => {}\n}\n\nfunction preprocessConfigurationSchemaArguments(\n  modelName: string,\n  inputSchemaDefinition: ConfigurationSchemaDefinition,\n  inputOptions: ConfigurationSchemaOptions<any, any> = {},\n) {\n  if (typeof modelName !== 'string') {\n    throw new Error(\n      'first arg must be string name of the model that this config schema goes with',\n    )\n  }\n\n  // if we have a base configuration schema that we are\n  // extending, grab the slot definitions from that\n  let schemaDefinition = inputSchemaDefinition\n  let options = inputOptions\n  if (inputOptions.baseConfiguration?.jbrowseSchemaDefinition) {\n    schemaDefinition = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaDefinition,\n      ...schemaDefinition,\n    }\n    options = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaOptions,\n      ...inputOptions,\n    }\n    delete options.baseConfiguration\n  }\n  return { schemaDefinition, options }\n}\n\nfunction makeConfigurationSchemaModel<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions<any, any>,\n>(modelName: string, schemaDefinition: DEFINITION, options: OPTIONS) {\n  // now assemble the MST model of the configuration schema\n  const modelDefinition: Record<string, any> = {}\n  let identifier\n\n  if (options.explicitlyTyped) {\n    modelDefinition.type = types.optional(types.literal(modelName), modelName)\n  }\n\n  if (options.explicitIdentifier && options.implicitIdentifier) {\n    throw new Error(\n      `Cannot have both explicit and implicit identifiers in ${modelName}`,\n    )\n  }\n  if (options.explicitIdentifier) {\n    if (typeof options.explicitIdentifier === 'string') {\n      modelDefinition[options.explicitIdentifier] = types.identifier\n      identifier = options.explicitIdentifier\n    } else {\n      modelDefinition.id = types.identifier\n      identifier = 'id'\n    }\n  } else if (options.implicitIdentifier) {\n    if (typeof options.implicitIdentifier === 'string') {\n      modelDefinition[options.implicitIdentifier] = ElementId\n      identifier = options.implicitIdentifier\n    } else {\n      modelDefinition.id = ElementId\n      identifier = 'id'\n    }\n  }\n\n  const volatileConstants: Record<string, any> = {\n    isJBrowseConfigurationSchema: true,\n    jbrowseSchema: {\n      modelName,\n      definition: schemaDefinition,\n      options,\n    },\n  }\n  Object.entries(schemaDefinition).forEach(([slotName, slotDefinition]) => {\n    if (\n      (isType(slotDefinition) && isLateType(slotDefinition)) ||\n      isConfigurationSchemaType(slotDefinition)\n    ) {\n      // this is either an MST late() type (which we assume to be a sub-configuration),\n      // or an actual sub-configuration\n      modelDefinition[slotName] = slotDefinition\n    } else if (\n      typeof slotDefinition === 'string' ||\n      typeof slotDefinition === 'number'\n    ) {\n      volatileConstants[slotName] = slotDefinition\n    } else if (typeof slotDefinition === 'object') {\n      // this is a slot definition\n      if (!slotDefinition.type) {\n        throw new Error(`no type set for config slot ${modelName}.${slotName}`)\n      }\n      try {\n        modelDefinition[slotName] = ConfigSlot(\n          slotName,\n          slotDefinition as ConfigSlotDefinition,\n        )\n      } catch (e) {\n        throw new Error(\n          `invalid config slot definition for ${modelName}.${slotName}: ${e}`,\n        )\n      }\n    } else {\n      throw new Error(\n        `invalid configuration schema definition, \"${slotName}\" must be either a valid configuration slot definition, a constant, or a nested configuration schema`,\n      )\n    }\n  })\n\n  let completeModel = types\n    .model(`${modelName}ConfigurationSchema`, modelDefinition)\n    .actions(self => ({\n      setSubschema(slotName: string, data: unknown) {\n        if (!isConfigurationSchemaType(modelDefinition[slotName])) {\n          throw new Error(`${slotName} is not a subschema, cannot replace`)\n        }\n        const newSchema = isStateTreeNode(data)\n          ? data\n          : modelDefinition[slotName].create(data)\n        self[slotName] = newSchema\n        return newSchema\n      },\n    }))\n\n  if (Object.keys(volatileConstants).length) {\n    completeModel = completeModel.volatile((/* self */) => volatileConstants)\n  }\n  if (options.actions) {\n    completeModel = completeModel.actions(options.actions)\n  }\n  if (options.views) {\n    completeModel = completeModel.views(options.views)\n  }\n  if (options.extend) {\n    completeModel = completeModel.extend(options.extend)\n  }\n\n  const identifierDefault = identifier ? { [identifier]: 'placeholderId' } : {}\n  const modelDefault = options.explicitlyTyped\n    ? { type: modelName, ...identifierDefault }\n    : identifierDefault\n\n  const defaultSnap = getSnapshot(completeModel.create(modelDefault))\n  completeModel = completeModel.postProcessSnapshot(snap => {\n    const newSnap: SnapshotOut<typeof completeModel> = {}\n    let matchesDefault = true\n    // let keyCount = 0\n    for (const [key, value] of Object.entries(snap)) {\n      if (matchesDefault) {\n        if (typeof defaultSnap[key] === 'object' && typeof value === 'object') {\n          if (JSON.stringify(defaultSnap[key]) !== JSON.stringify(value)) {\n            matchesDefault = false\n          }\n        } else if (defaultSnap[key] !== value) {\n          matchesDefault = false\n        }\n      }\n      if (\n        value !== undefined &&\n        volatileConstants[key] === undefined &&\n        !isEmptyObject(value) &&\n        !isEmptyArray(value)\n      ) {\n        // keyCount += 1\n        newSnap[key] = value\n      }\n    }\n    if (matchesDefault) {\n      return {}\n    }\n    return newSnap\n  })\n\n  if (options.preProcessSnapshot) {\n    completeModel = completeModel.preProcessSnapshot(options.preProcessSnapshot)\n  }\n\n  return types.optional(completeModel, modelDefault)\n}\n\nexport interface ConfigurationSchemaType<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions<any, any>,\n> extends ReturnType<typeof makeConfigurationSchemaModel<DEFINITION, OPTIONS>> {\n  isJBrowseConfigurationSchema: boolean\n  jbrowseSchemaDefinition: DEFINITION\n  jbrowseSchemaOptions: OPTIONS\n  type: string\n  [key: string]: unknown\n}\n\nexport function ConfigurationSchema<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions<BASE_SCHEMA, EXPLICIT_IDENTIFIER>,\n  BASE_SCHEMA extends AnyConfigurationSchemaType | undefined = undefined,\n  EXPLICIT_IDENTIFIER extends string | undefined = undefined,\n>(\n  modelName: string,\n  inputSchemaDefinition: DEFINITION,\n  inputOptions?: ConfigurationSchemaOptions<BASE_SCHEMA, EXPLICIT_IDENTIFIER>,\n): ConfigurationSchemaType<DEFINITION, OPTIONS> {\n  const { schemaDefinition, options } = preprocessConfigurationSchemaArguments(\n    modelName,\n    inputSchemaDefinition,\n    inputOptions,\n  )\n  const schemaType = makeConfigurationSchemaModel(\n    modelName,\n    schemaDefinition,\n    options,\n  ) as AnyConfigurationSchemaType\n  // saving a couple of jbrowse-specific things in the type object. hope nobody gets mad.\n  schemaType.isJBrowseConfigurationSchema = true\n  schemaType.jbrowseSchemaDefinition = schemaDefinition\n  schemaType.jbrowseSchemaOptions = options\n  return schemaType\n}\n\nexport function ConfigurationReference<\n  SCHEMATYPE extends AnyConfigurationSchemaType,\n>(schemaType: SCHEMATYPE) {\n  // we cast this to SCHEMATYPE, because the reference *should* behave just\n  // like the object it points to. It won't be undefined (this is a\n  // `reference`, not a `safeReference`)\n  return types.union(types.reference(schemaType), schemaType) as SCHEMATYPE\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  isStateTreeNode,\n  getSnapshot,\n  getType,\n  isMapType,\n  isType,\n  isUnionType,\n  isOptionalType,\n  isArrayType,\n  isModelType,\n  isLateType,\n} from 'mobx-state-tree'\n\nimport {\n  getUnionSubTypes,\n  getDefaultValue,\n  getSubType,\n  resolveLateType,\n} from '../util/mst-reflection'\n\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  ConfigurationSlotName,\n  ConfigurationSchemaForModel,\n} from './types'\n\n/**\n * given a configuration model (an instance of a ConfigurationSchema),\n * read the configuration variable at the given path\n *\n * @param model - instance of ConfigurationSchema\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *  will be sent to each of the slotNames\n */\nexport function readConfObject<CONFMODEL extends AnyConfigurationModel>(\n  confObject: CONFMODEL,\n  slotPath?:\n    | ConfigurationSlotName<ConfigurationSchemaForModel<CONFMODEL>>\n    | string[],\n  args: Record<string, unknown> = {},\n): any {\n  if (!confObject) {\n    throw new TypeError('must provide conf object to read')\n  }\n  if (!slotPath) {\n    return JSON.parse(JSON.stringify(getSnapshot(confObject)))\n  }\n  if (typeof slotPath === 'string') {\n    let slot = confObject[slotPath]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !slot &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      slot = confObject.get(slotPath)\n    }\n    if (!slot) {\n      return undefined\n      // if we want to be very strict about config slots, we could uncomment the below\n      // instead of returning undefined\n      //\n      // const modelType = getType(model)\n      // const schemaType = model.configuration && getType(model.configuration)\n      // throw new Error(\n      //   `no slot \"${slotName}\" found in ${modelType.name} configuration (${\n      //     schemaType.name\n      //   })`,\n      // )\n    }\n\n    const val = slot.expr ? slot.expr.evalSync(args) : slot\n    return isStateTreeNode(val)\n      ? JSON.parse(JSON.stringify(getSnapshot(val)))\n      : val\n  }\n\n  if (Array.isArray(slotPath)) {\n    const slotName = slotPath[0]\n    if (slotPath.length > 1) {\n      const newPath = slotPath.slice(1)\n      let subConf = confObject[slotName]\n      // check for the subconf being a map if we don't find it immediately\n      if (\n        !subConf &&\n        isStateTreeNode(confObject) &&\n        isMapType(getType(confObject))\n      ) {\n        subConf = confObject.get(slotName)\n      }\n      return subConf ? readConfObject(subConf, newPath, args) : undefined\n    }\n    return readConfObject(\n      confObject,\n      slotName as ConfigurationSlotName<ConfigurationSchemaForModel<CONFMODEL>>,\n      args,\n    )\n  }\n  throw new TypeError('slotPath must be a string or array')\n}\n\n/**\n * helper method for readConfObject, reads the config from a mst model\n *\n * @param model - object containing a 'configuration' member\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *   will be sent to each of the slotNames\n */\nexport function getConf<CONFMODEL extends AnyConfigurationModel>(\n  model: { configuration: CONFMODEL },\n  slotPath?: Parameters<typeof readConfObject<CONFMODEL>>[1],\n  args?: Parameters<typeof readConfObject<CONFMODEL>>[2],\n) {\n  if (!model) {\n    throw new TypeError('must provide a model object')\n  }\n  const { configuration } = model\n  if (isConfigurationModel(configuration)) {\n    return readConfObject<CONFMODEL>(configuration, slotPath, args)\n  }\n  throw new TypeError('cannot getConf on this model, it has no configuration')\n}\n\n/**\n * given a union of explicitly typed configuration schema types,\n * extract an array of the type names contained in the union\n *\n * @param unionType -\n * @returns Array of type names contained in the union\n */\nexport function getTypeNamesFromExplicitlyTypedUnion(maybeUnionType: unknown) {\n  if (isType(maybeUnionType)) {\n    maybeUnionType = resolveLateType(maybeUnionType)\n    // @ts-expect-error\n    if (isUnionType(maybeUnionType)) {\n      const typeNames: string[] = []\n      getUnionSubTypes(maybeUnionType).forEach(type => {\n        type = resolveLateType(type)\n        let typeName = getTypeNamesFromExplicitlyTypedUnion(type)\n        if (!typeName.length) {\n          const def = getDefaultValue(type)\n          typeName = [def.type]\n        }\n        if (!typeName[0]) {\n          // debugger\n          throw new Error(`invalid config schema type ${type}`)\n        }\n        typeNames.push(...typeName)\n      })\n      return typeNames\n    }\n  }\n  return []\n}\n\nexport function isBareConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (isType(thing)) {\n    if (\n      isModelType(thing) &&\n      ('isJBrowseConfigurationSchema' in thing ||\n        thing.name.includes('ConfigurationSchema'))\n    ) {\n      return true\n    }\n    // if it's a late type, assume its a config schema\n    if (isLateType(thing)) {\n      return true\n    }\n  }\n  return false\n}\n\nexport function isConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (!isType(thing)) {\n    return false\n  }\n\n  // written as a series of if-statements instead of a big logical OR\n  // because this construction gives much better debugging backtraces.\n\n  // also, note that the order of these statements matters, because\n  // for example some union types are also optional types\n\n  if (isBareConfigurationSchemaType(thing)) {\n    return true\n  }\n\n  if (isUnionType(thing)) {\n    return getUnionSubTypes(thing).every(\n      t => isConfigurationSchemaType(t) || t.name === 'undefined',\n    )\n  }\n\n  if (isOptionalType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isArrayType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isMapType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  return false\n}\n\nexport function isConfigurationModel(\n  thing: unknown,\n): thing is AnyConfigurationModel {\n  return isStateTreeNode(thing) && isConfigurationSchemaType(getType(thing))\n}\n\nexport function isConfigurationSlotType(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'isJBrowseConfigurationSlot' in thing\n  )\n}\n","import { BaseAdapter } from './BaseAdapter'\nimport { BaseFeatureDataAdapter } from './BaseFeatureDataAdapter'\nimport { BaseRefNameAliasAdapter } from './BaseRefNameAliasAdapter'\nimport { BaseSequenceAdapter } from './BaseSequenceAdapter'\nimport { BaseTextSearchAdapter } from './BaseTextSearchAdapter'\nimport { RegionsAdapter } from './RegionsAdapter'\n\nexport type AnyDataAdapter =\n  | BaseAdapter\n  | BaseFeatureDataAdapter\n  | BaseRefNameAliasAdapter\n  | BaseTextSearchAdapter\n  | RegionsAdapter\n  | BaseSequenceAdapter\n\nexport function isSequenceAdapter(t: AnyDataAdapter): t is BaseSequenceAdapter {\n  return 'getRegions' in t && 'getFeatures' in t\n}\n\nexport function isRegionsAdapter(t: AnyDataAdapter): t is RegionsAdapter {\n  return 'getRegions' in t\n}\n\nexport function isFeatureAdapter(\n  t: AnyDataAdapter,\n): t is BaseFeatureDataAdapter {\n  return 'getFeatures' in t\n}\n\nexport function isRefNameAliasAdapter(t: object): t is BaseRefNameAliasAdapter {\n  return 'getRefNameAliases' in t\n}\n\nexport function isTextSearchAdapter(\n  t: AnyDataAdapter,\n): t is BaseTextSearchAdapter {\n  return 'searchIndex' in t\n}\n","import { isStateTreeNode, getSnapshot } from 'mobx-state-tree'\n\n// locals\nimport { readConfObject, AnyConfigurationModel } from '../../configuration'\nimport { getSubAdapterType } from '../dataAdapterCache'\nimport { AugmentedRegion as Region } from '../../util/types'\nimport idMaker from '../../util/idMaker'\nimport PluginManager from '../../PluginManager'\nimport { ConfigurationSchema } from '../../configuration'\n\nconst EmptyConfig = ConfigurationSchema('empty', {})\n\nexport abstract class BaseAdapter {\n  public id: string\n\n  static capabilities = [] as string[]\n\n  constructor(\n    public config: AnyConfigurationModel = EmptyConfig.create(),\n    public getSubAdapter?: getSubAdapterType,\n    public pluginManager?: PluginManager,\n  ) {\n    // note: we use switch on jest here for more simple feature IDs\n    // in test environment\n    if (typeof jest === 'undefined') {\n      const data = isStateTreeNode(config) ? getSnapshot(config) : config\n      this.id = `${idMaker(data)}`\n    } else {\n      this.id = 'test'\n    }\n  }\n\n  /**\n   * Same as `readConfObject(this.config, arg)`.\n   * @deprecated Does not offer the same TS type checking as `readConfObject`, consider using that instead.\n   */\n  getConf(arg: string | string[]) {\n    return readConfObject(this.config, arg)\n  }\n\n  /**\n   * Called to provide a hint that data tied to a certain region will not be\n   * needed for the foreseeable future and can be purged from caches, etc\n   * @param region - Region\n   */\n  public abstract freeResources(region: Region): void\n}\n","import { Observable, firstValueFrom, merge } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\n\n// locals\nimport { BaseAdapter } from './BaseAdapter'\nimport { BaseOptions } from './BaseOptions'\nimport { FeatureDensityStats } from './types'\nimport { ObservableCreate } from '../../util/rxjs'\nimport { checkAbortSignal, sum, max, min } from '../../util'\nimport { Feature } from '../../util/simpleFeature'\nimport { AugmentedRegion as Region } from '../../util/types'\nimport { blankStats, rectifyStats, scoresToStats } from '../../util/stats'\n\n/**\n * Base class for feature adapters to extend. Defines some methods that\n * subclasses must implement.\n */\nexport abstract class BaseFeatureDataAdapter extends BaseAdapter {\n  /**\n   * Get all reference sequence names used in the data source\n   * Example:\n   * public async getRefNames(opts?: BaseOptions): Promise\\<string[]\\> \\}\n   *   await this.setup()\n   *   const \\{ refNames \\} = this.metadata\n   *   return refNames\n   * \\}\n   *\n   *\n   * NOTE: If an adapter is unable to determine the reference sequence names,\n   * the array will be empty\n   * @param opts - Feature adapter options\n   */\n  public abstract getRefNames(opts?: BaseOptions): Promise<string[]>\n\n  /**\n   * Get features from the data source that overlap a region\n   * Example:\n   * public getFeatures(\n   *   region: Region,\n   *   opts: BaseOptions,\n   * ): Observable<Feature> \\{\n   *   return ObservableCreate(observer =\\> \\{\n   *     const records = getRecords(assembly, refName, start, end)\n   *     records.forEach(record =\\> \\{\n   *       observer.next(this.recordToFeature(record))\n   *     \\})\n   *     observer.complete()\n   *   \\})\n   * \\}\n   * @param region - Region\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the region\n   */\n  public abstract getFeatures(\n    region: Region,\n    opts?: BaseOptions,\n  ): Observable<Feature>\n\n  /**\n   * Return \"header info\" that is fetched from the data file, or other info\n   * that would not simply be in the config of the file. The return value can\n   * be `{tag:string, data: any}[]` e.g. list of tags with their values which\n   * is how VCF,BAM,CRAM return values for getInfo or it can be a nested JSON\n   * object\n   */\n  public async getHeader(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Return info that is primarily used for interpreting the data that is there,\n   * primarily in reference to being used for augmenting feature details panels\n   */\n  public async getMetadata(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   */\n  public getFeaturesInRegion(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const hasData = await this.hasDataForRefName(region.refName, opts)\n      checkAbortSignal(opts.signal)\n      if (!hasData) {\n        observer.complete()\n      } else {\n        this.getFeatures(region, opts).subscribe(observer)\n      }\n    })\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   *\n   * @param regions - Regions\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the regions\n   */\n  public getFeaturesInMultipleRegions(\n    regions: Region[],\n    opts: BaseOptions = {},\n  ) {\n    return merge(\n      ...regions.map(region => this.getFeaturesInRegion(region, opts)),\n    )\n  }\n\n  /**\n   * Check if the store has data for the given reference name.\n   * @param refName - Name of the reference sequence\n   * @returns Whether data source has data for the given reference name\n   */\n  public async hasDataForRefName(refName: string, opts: BaseOptions = {}) {\n    const refNames = await this.getRefNames(opts)\n    return refNames.includes(refName)\n  }\n\n  /**\n   * Calculates the minimum score, maximum score, and other statistics from\n   * features over a region, primarily used for quantitative tracks\n   */\n  public async getRegionQuantitativeStats(region: Region, opts?: BaseOptions) {\n    const feats = this.getFeatures(region, opts)\n    return scoresToStats(region, feats)\n  }\n  /**\n   * Calculates the minimum score, maximum score, and other statistics from\n   * features over multiple regions, primarily used for quantitative tracks\n   */\n  public async getMultiRegionQuantitativeStats(\n    regions: Region[] = [],\n    opts?: BaseOptions,\n  ) {\n    if (!regions.length) {\n      return blankStats()\n    }\n    const feats = await Promise.all(\n      regions.map(region => this.getRegionQuantitativeStats(region, opts)),\n    )\n\n    const scoreMax = max(feats.map(a => a.scoreMax))\n    const scoreMin = min(feats.map(a => a.scoreMin))\n    const scoreSum = sum(feats.map(a => a.scoreSum))\n    const scoreSumSquares = sum(feats.map(a => a.scoreSumSquares))\n    const featureCount = sum(feats.map(a => a.featureCount))\n    const basesCovered = sum(feats.map(a => a.basesCovered))\n\n    return rectifyStats({\n      scoreMin,\n      scoreMax,\n      featureCount,\n      basesCovered,\n      scoreSumSquares,\n      scoreSum,\n    })\n  }\n\n  /**\n   * Calculates the \"feature density\" of a region. The primary purpose of this\n   * API is to alert the user if they are going to be downloading too much\n   * information, and give them a hint to zoom in to see more. The default\n   * implementation samples from the regions, downloads feature data with\n   * getFeatures, and returns an object with the form \\{featureDensity:number\\}\n   *\n   * Derived classes can override this to return alternative calculations for\n   * featureDensity, or they can also return an object containing a byte size\n   * calculation with the format \\{bytes:number, fetchSizeLimit:number\\} where\n   * fetchSizeLimit is the adapter-defined limit for what it thinks is 'too much\n   * data' (e.g. CRAM and\n   * BAM may vary on what they think too much data is)\n   */\n  getRegionFeatureDensityStats(region: Region, opts?: BaseOptions) {\n    let lastTime = +Date.now()\n    const statsFromInterval = async (length: number, expansionTime: number) => {\n      const { start, end } = region\n      const sampleCenter = start * 0.75 + end * 0.25\n\n      const features = await firstValueFrom(\n        this.getFeatures(\n          {\n            ...region,\n            start: Math.max(0, Math.round(sampleCenter - length / 2)),\n            end: Math.min(Math.round(sampleCenter + length / 2), end),\n          },\n          opts,\n        ).pipe(toArray()),\n      )\n\n      return maybeRecordStats(\n        length,\n        { featureDensity: features.length / length },\n        features.length,\n        expansionTime,\n      )\n    }\n\n    const maybeRecordStats = async (\n      interval: number,\n      stats: FeatureDensityStats,\n      statsSampleFeatures: number,\n      expansionTime: number,\n    ): Promise<FeatureDensityStats> => {\n      const refLen = region.end - region.start\n      if (statsSampleFeatures >= 70 || interval * 2 > refLen) {\n        return stats\n      } else if (expansionTime <= 5000) {\n        const currTime = +Date.now()\n        expansionTime += currTime - lastTime\n        lastTime = currTime\n        return statsFromInterval(interval * 2, expansionTime)\n      } else {\n        console.warn(\n          \"Stats estimation reached timeout, or didn't get enough features\",\n        )\n        return { featureDensity: Number.POSITIVE_INFINITY }\n      }\n    }\n\n    return statsFromInterval(1000, 0)\n  }\n\n  /**\n   * Calculates the \"feature density\" of a set of regions. The primary purpose\n   * of this API is to alert the user if they are going to be downloading too\n   * much information, and give them a hint to zoom in to see more. The default\n   * implementation samples from the regions, downloads feature data with\n   * getFeatures, and returns an object with the form \\{featureDensity:number\\}\n   *\n   * Derived classes can override this to return alternative calculations for\n   * featureDensity, or they can also return an object containing a byte size\n   * calculation with the format \\{bytes:number, fetchSizeLimit:number\\} where\n   * fetchSizeLimit is the adapter-defined limit for what it thinks is 'too much\n   * data' (e.g. CRAM and\n   * BAM may vary on what they think too much data is)\n   */\n  public async getMultiRegionFeatureDensityStats(\n    regions: Region[],\n    opts?: BaseOptions,\n  ) {\n    if (!regions.length) {\n      throw new Error('No regions supplied')\n    }\n    return this.getRegionFeatureDensityStats(regions[0], opts)\n  }\n}\n","import { NoAssemblyRegion } from '../../util'\nimport { BaseOptions } from './types'\nimport { RegionsAdapter } from '../BaseAdapter'\nimport { BaseFeatureDataAdapter } from './BaseFeatureDataAdapter'\n\nexport abstract class BaseSequenceAdapter\n  extends BaseFeatureDataAdapter\n  implements RegionsAdapter\n{\n  async getMultiRegionFeatureDensityStats() {\n    return { featureDensity: 0 }\n  }\n\n  /**\n   * Fetches a list of 'regions' with refName, start, and extends\n   */\n  abstract getRegions(opts: BaseOptions): Promise<NoAssemblyRegion[]>\n}\n","import PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration'\nimport { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport interface AdapterMetadata {\n  category?: string\n  hiddenFromGUI?: boolean\n  description?: string\n}\n\nexport default class AdapterType extends PluggableElementBase {\n  AdapterClass?: AnyAdapter\n\n  getAdapterClass: () => Promise<AnyAdapter>\n\n  configSchema: AnyConfigurationSchemaType\n\n  adapterCapabilities: string[]\n\n  adapterMetadata?: AdapterMetadata\n\n  constructor(\n    stuff: {\n      name: string\n      configSchema: AnyConfigurationSchemaType\n      displayName?: string\n      adapterCapabilities?: string[]\n      adapterMetadata?: AdapterMetadata\n    } & (\n      | { AdapterClass: AnyAdapter }\n      | { getAdapterClass: () => Promise<AnyAdapter> }\n    ),\n  ) {\n    super(stuff)\n    if ('AdapterClass' in stuff) {\n      this.AdapterClass = stuff.AdapterClass\n      this.getAdapterClass = async () => stuff.AdapterClass\n    } else if ('getAdapterClass' in stuff) {\n      this.getAdapterClass = stuff.getAdapterClass\n    } else {\n      throw new Error(\n        `no AdapterClass or getAdapterClass is defined for adapter type ${this.name}`,\n      )\n    }\n    this.configSchema = stuff.configSchema\n    this.adapterCapabilities = stuff.adapterCapabilities || []\n    this.adapterMetadata = stuff.adapterMetadata\n  }\n}\n","import React from 'react'\nimport { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\n\ntype BasicComponent = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  model: any\n}>\ntype AddTrackWorkflowComponentType =\n  | React.LazyExoticComponent<BasicComponent>\n  | BasicComponent\n\nexport default class AddTrackWorkflow extends PluggableElementBase {\n  ReactComponent: AddTrackWorkflowComponentType\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AddTrackWorkflowComponentType\n    stateModel: IAnyModelType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for view ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for view ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration'\nimport { AnyReactComponentType } from '../util'\n\nexport default class ConnectionType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  description: string\n\n  url: string\n\n  configEditorComponent?: AnyReactComponentType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n    displayName: string\n    description: string\n    configEditorComponent?: AnyReactComponentType\n    url: string\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.description = stuff.description\n    this.url = stuff.url\n    this.configEditorComponent = stuff.configEditorComponent\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for connection ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema defined for connection ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyReactComponentType } from '../util'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration'\n\nexport default class DisplayType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  ReactComponent: AnyReactComponentType\n\n  /**\n   * The track type the display is associated with\n   */\n  trackType: string\n\n  /*\n   * Indicates that this display type can be a \"sub-display\" of another type of\n   * display, e.g. in AlignmentsDisplay, has Pileup and SNPCoverage subDisplays\n   */\n  subDisplay?: unknown\n\n  /**\n   * The view type the display is associated with\n   */\n  viewType: string\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    trackType: string\n    viewType: string\n    displayName?: string\n    subDisplay?: unknown\n    configSchema: AnyConfigurationSchemaType\n    ReactComponent: AnyReactComponentType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.subDisplay = stuff.subDisplay\n    this.configSchema = stuff.configSchema\n    this.ReactComponent = stuff.ReactComponent\n    this.trackType = stuff.trackType\n    this.viewType = stuff.viewType\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for display ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for display ${this.name}`)\n    }\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent provided for display ${this.name}`)\n    }\n    if (!this.trackType) {\n      throw new Error(`no trackType provided for display ${this.name}`)\n    }\n    if (!this.viewType) {\n      throw new Error(`no viewType provided for display ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/types'\n\nexport default class InternetAccountType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(\n        `no stateModel defined for internet account type ${this.name}`,\n      )\n    }\n    if (!this.configSchema) {\n      throw new Error(\n        `no configSchema provided for internet account type ${this.name}`,\n      )\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","export default abstract class PluggableElementBase {\n  name: string\n  maybeDisplayName?: string\n\n  constructor(args: { name?: string; displayName?: string }) {\n    this.name = args.name || 'UNKNOWN'\n    this.maybeDisplayName = args.displayName\n  }\n\n  get displayName() {\n    return this.maybeDisplayName || this.name\n  }\n}\n","// adapted from map-obj (MIT), with modifications to pass the \"whole object\"\n// from an array of objects into itself\nconst isObject = (value: unknown) => typeof value === 'object' && value !== null\n\n// Customized for this use-case\nconst isObjectCustom = (value: unknown) =>\n  isObject(value) &&\n  !(value instanceof RegExp) &&\n  !(value instanceof Error) &&\n  !(value instanceof Date) &&\n  !(globalThis.Blob && value instanceof globalThis.Blob)\n\ntype Obj = Record<string, unknown>\n\nexport default function map(\n  object: Obj,\n  mapper: (val: unknown) => void,\n  isSeen = new WeakSet(),\n) {\n  if (isSeen.has(object)) {\n    return\n  }\n\n  isSeen.add(object)\n\n  const mapArray = (array: unknown[]) =>\n    array.forEach(element => {\n      mapper(element)\n      if (isObject(element)) {\n        map(element as Record<string, unknown>, mapper, isSeen)\n      }\n    })\n\n  if (Array.isArray(object)) {\n    mapArray(object)\n  }\n\n  for (const value of Object.values(object)) {\n    mapper(value)\n\n    if (isObjectCustom(value)) {\n      Array.isArray(value) ? mapArray(value) : map(value as Obj, mapper, isSeen)\n    }\n  }\n}\n","import mapObject from '../util/map-obj'\nimport PluginManager from '../PluginManager'\nimport PluggableElementBase from './PluggableElementBase'\nimport { setBlobMap, getBlobMap } from '../util/tracks'\nimport {\n  isAppRootModel,\n  isUriLocation,\n  isAuthNeededException,\n  RetryError,\n  UriLocation,\n} from '../util/types'\n\nimport {\n  deserializeAbortSignal,\n  isRemoteAbortSignal,\n  RemoteAbortSignal,\n} from '../rpc/remoteAbortSignals'\n\ninterface SerializedArgs {\n  signal?: RemoteAbortSignal\n  blobMap?: Record<string, File>\n}\nexport type RpcMethodConstructor = new (pm: PluginManager) => RpcMethodType\n\nexport default abstract class RpcMethodType extends PluggableElementBase {\n  constructor(public pluginManager: PluginManager) {\n    super({})\n  }\n\n  async serializeArguments(args: {}, rpcDriverClassName: string): Promise<{}> {\n    const blobMap = getBlobMap()\n    await this.augmentLocationObjects(args, rpcDriverClassName)\n    return { ...args, blobMap }\n  }\n\n  async serializeNewAuthArguments(\n    loc: UriLocation,\n    rpcDriverClassName: string,\n  ) {\n    const rootModel = this.pluginManager.rootModel\n\n    // args dont need auth or already have auth\n    if (!isAppRootModel(rootModel) || loc.internetAccountPreAuthorization) {\n      return loc\n    }\n\n    const account = rootModel.findAppropriateInternetAccount(loc)\n\n    // mutating loc object is not allowed in MainThreadRpcDriver, and is only\n    // needed for web worker RPC\n    if (account && rpcDriverClassName !== 'MainThreadRpcDriver') {\n      loc.internetAccountPreAuthorization =\n        await account.getPreAuthorizationInformation(loc)\n    }\n    return loc\n  }\n\n  async deserializeArguments<T extends SerializedArgs>(\n    serializedArgs: T,\n    _rpcDriverClassName: string,\n  ) {\n    if (serializedArgs.blobMap) {\n      setBlobMap(serializedArgs.blobMap)\n    }\n    const { signal } = serializedArgs\n\n    return {\n      ...serializedArgs,\n      signal: isRemoteAbortSignal(signal)\n        ? deserializeAbortSignal(signal)\n        : undefined,\n    }\n  }\n\n  abstract execute(\n    serializedArgs: unknown,\n    rpcDriverClassName: string,\n  ): Promise<unknown>\n\n  async serializeReturn(\n    originalReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ) {\n    return originalReturn\n  }\n\n  async deserializeReturn(\n    serializedReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ) {\n    let r\n    try {\n      r = await serializedReturn\n    } catch (error) {\n      if (isAuthNeededException(error)) {\n        const retryAccount = // @ts-expect-error\n          this.pluginManager.rootModel?.createEphemeralInternetAccount(\n            `HTTPBasicInternetAccount-${new URL(error.url).origin}`,\n            {},\n            error.url,\n          )\n        throw new RetryError(\n          'Retrying with created internet account',\n          retryAccount.internetAccountId,\n        )\n      }\n      throw error\n    }\n    return r\n  }\n\n  private async augmentLocationObjects(\n    thing: Record<string, unknown>,\n    rpcDriverClassName: string,\n  ) {\n    const uris = [] as UriLocation[]\n\n    // using map-obj avoids cycles, seen in circular view svg export\n    mapObject(thing, val => {\n      if (isUriLocation(val)) {\n        uris.push(val)\n      }\n    })\n    for (const uri of uris) {\n      await this.serializeNewAuthArguments(uri, rpcDriverClassName)\n    }\n    return thing\n  }\n}\n","import PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration'\nimport { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport default class TextSearchAdapterType extends PluggableElementBase {\n  AdapterClass: AnyAdapter\n\n  configSchema: AnyConfigurationSchemaType\n\n  description?: string\n\n  constructor(stuff: {\n    name: string\n    displayName?: string\n    description?: string\n    configSchema: AnyConfigurationSchemaType\n    AdapterClass: AnyAdapter\n  }) {\n    super(stuff)\n    this.description = stuff.description\n    this.configSchema = stuff.configSchema\n    this.AdapterClass = stuff.AdapterClass\n    if (!this.AdapterClass) {\n      throw new Error(`no AdapterClass defined for adapter type ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration'\nimport DisplayType from './DisplayType'\n\nexport default class TrackType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    displayName?: string\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for track ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for track ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import React from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport DisplayType from './DisplayType'\n\ntype BasicView = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  model: any\n  session?: IAnyStateTreeNode\n}>\ntype ViewComponentType = React.LazyExoticComponent<BasicView> | BasicView\n\nexport default class ViewType extends PluggableElementBase {\n  ReactComponent: ViewComponentType\n\n  stateModel: IAnyModelType\n\n  displayTypes: DisplayType[] = []\n\n  // extendedName can be used for when you extend a given view type, and want\n  // to register all of that view types displays to yourself e.g. you create a\n  // linear-genome-view subtype, and want all the tracks that are compatible\n  // display types for the linear-genome-view to be compatible with your type\n  // also (without this, display types are only registered to a single view\n  // type)\n  extendedName?: string\n\n  constructor(stuff: {\n    name: string\n    displayName?: string\n    ReactComponent: ViewComponentType\n    stateModel: IAnyModelType\n    extendedName?: string\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n    this.extendedName = stuff.extendedName\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for view ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for view ${this.name}`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import React, { ComponentType, LazyExoticComponent } from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype WidgetComponentType = LazyExoticComponent<React.FC<any>> | React.FC<any>\n\ntype HeadingComponentType = ComponentType<{ model: IAnyStateTreeNode }>\n\nexport default class WidgetType extends PluggableElementBase {\n  heading?: string\n\n  configSchema: AnyConfigurationSchemaType\n\n  HeadingComponent?: HeadingComponentType\n\n  ReactComponent: WidgetComponentType\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    heading?: string\n    HeadingComponent?: HeadingComponentType\n    configSchema: AnyConfigurationSchemaType\n    stateModel: IAnyModelType\n    ReactComponent: WidgetComponentType\n  }) {\n    super(stuff)\n    this.heading = stuff.heading\n    this.HeadingComponent = stuff.HeadingComponent\n    this.configSchema = stuff.configSchema\n    this.stateModel = stuff.stateModel\n    this.ReactComponent = stuff.ReactComponent\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for widget ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for widget ${this.name}`)\n    }\n  }\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport { ElementId } from '../../util/types/mst'\nimport { MenuItem } from '../../ui'\nimport { Region } from '../../util/types/mst'\n\n/**\n * #stateModel BaseViewModel\n * #category view\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseViewModel = types\n  .model('BaseView', {\n    /**\n     * #property\n     */\n    id: ElementId,\n\n    /**\n     * #property\n     * displayName is displayed in the header of the view, or assembly names\n     * being used if none is specified\n     */\n    displayName: types.maybe(types.string),\n\n    /**\n     * #property\n     */\n    minimized: false,\n  })\n  .volatile(() => ({\n    width: 800,\n  }))\n  .views(() => ({\n    /**\n     * #getter\n     */\n    menuItems(): MenuItem[] {\n      return []\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setDisplayName(name: string) {\n      self.displayName = name\n    },\n\n    /**\n     * #action\n     * width is an important attribute of the view model, when it becomes set, it\n     * often indicates when the app can start drawing to it. certain views like\n     * lgv are strict about this because if it tries to draw before it knows the\n     * width it should draw to, it may start fetching data for regions it doesn't\n     * need to\n     *\n     * setWidth is updated by a ResizeObserver generally, the views often need\n     * to know how wide they are to properly draw genomic regions\n     */\n    setWidth(newWidth: number) {\n      self.width = newWidth\n    },\n\n    /**\n     * #action\n     */\n    setMinimized(flag: boolean) {\n      self.minimized = flag\n    },\n  }))\n\nexport default BaseViewModel\n\nexport type IBaseViewModel = Instance<typeof BaseViewModel>\n\nexport const BaseViewModelWithDisplayedRegions = BaseViewModel.props({\n  displayedRegions: types.array(Region),\n})\nexport type IBaseViewModelWithDisplayedRegions = Instance<\n  typeof BaseViewModelWithDisplayedRegions\n>\n","import type { Instance } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../../configuration'\n\n/**\n * #config BaseConnection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseConnectionConfig = ConfigurationSchema(\n  'BaseConnection',\n  {\n    /**\n     * #slot\n     */\n    name: {\n      type: 'string',\n      defaultValue: 'nameOfConnection',\n      description: 'a unique name for this connection',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'optional list of names of assemblies in this connection',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'connectionId',\n  },\n)\n\nexport default BaseConnectionConfig\nexport type BaseConnectionConfigSchema = typeof BaseConnectionConfig\nexport type BaseConnectionConfigModel = Instance<BaseConnectionConfigSchema>\n","import { cast, types } from 'mobx-state-tree'\nimport {\n  AnyConfigurationModel,\n  ConfigurationReference,\n} from '../../configuration'\nimport PluginManager from '../../PluginManager'\n\nimport configSchema from './baseConnectionConfig'\n\n/**\n * #stateModel BaseConnectionModel\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('Connection', {\n      /**\n       * #property\n       */\n      name: types.identifier,\n      /**\n       * #property\n       */\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .actions(() => ({\n      /**\n       * #action\n       */\n      connect(_arg: AnyConfigurationModel) {},\n    }))\n    .actions(self => ({\n      afterAttach() {\n        if (self.tracks.length === 0) {\n          self.connect(self.configuration)\n        }\n      },\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: AnyConfigurationModel) {\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      /**\n       * #action\n       */\n      addTrackConfs(trackConfs: AnyConfigurationModel[]) {\n        const length = self.tracks.push(...trackConfs)\n        return self.tracks.slice(length - 1 - trackConfs.length, length - 1)\n      },\n      /**\n       * #action\n       */\n      setTrackConfs(trackConfs: AnyConfigurationModel[]) {\n        self.tracks = cast(trackConfs)\n        return self.tracks\n      },\n      /**\n       * #action\n       */\n      clear() {},\n    }))\n}\n\nexport type BaseConnectionModel = ReturnType<typeof stateModelFactory>\nexport default stateModelFactory\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { getParent, Instance, types, isRoot } from 'mobx-state-tree'\n\n// locals\nimport { getConf } from '../../configuration'\nimport { MenuItem } from '../../ui'\nimport { getParentRenderProps } from '../../util/tracks'\nimport { getContainingView, getEnv } from '../../util'\nimport { ElementId } from '../../util/types/mst'\n\n/**\n * #stateModel BaseDisplay\n * #category display\n */\nfunction stateModelFactory() {\n  return types\n    .model('BaseDisplay', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.string,\n      /**\n       * #property\n       */\n      rpcDriverName: types.maybe(types.string),\n    })\n    .volatile(() => ({\n      rendererTypeName: '',\n      error: undefined as unknown,\n      message: undefined as string | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get RenderingComponent(): React.FC<{\n        model: typeof self\n        onHorizontalScroll?: Function\n        blockState?: Record<string, any>\n      }> {\n        const { pluginManager } = getEnv(self)\n        const displayType = pluginManager.getDisplayType(self.type)\n        return displayType.ReactComponent as React.FC<{\n          model: typeof self\n          onHorizontalScroll?: Function\n          blockState?: Record<string, any>\n        }>\n      },\n\n      /**\n       * #getter\n       */\n      get DisplayBlurb(): React.FC<{ model: typeof self }> | null {\n        return null\n      },\n\n      /**\n       * #getter\n       */\n      get adapterConfig() {\n        return getConf(this.parentTrack, 'adapter')\n      },\n\n      /**\n       * #getter\n       */\n      get parentTrack() {\n        let track = getParent<any>(self)\n        while (!(track.configuration && getConf(track, 'trackId'))) {\n          if (isRoot(track)) {\n            throw new Error(`No parent track found for ${self.type} ${self.id}`)\n          }\n          track = getParent<any>(track)\n        }\n        return track\n      },\n\n      /**\n       * #method\n       * the react props that are passed to the Renderer when data\n       * is rendered in this display\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          notReady: getContainingView(self).minimized,\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n        }\n      },\n\n      /**\n       * #getter\n       * the pluggable element type object for this display's\n       * renderer\n       */\n      get rendererType() {\n        const { pluginManager } = getEnv(self)\n        const RendererType = pluginManager.getRendererType(\n          self.rendererTypeName,\n        )\n        if (!RendererType) {\n          throw new Error(`renderer \"${self.rendererTypeName}\" not found`)\n        }\n        if (!RendererType.ReactComponent) {\n          throw new Error(\n            `renderer ${self.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n          )\n        }\n        return RendererType\n      },\n\n      /**\n       * #getter\n       * if a display-level message should be displayed instead,\n       * make this return a react component\n       */\n      get DisplayMessageComponent() {\n        return undefined as undefined | React.FC<any>\n      },\n      /**\n       * #method\n       */\n      trackMenuItems(): MenuItem[] {\n        return []\n      },\n\n      /**\n       * #getter\n       */\n      get viewMenuActions(): MenuItem[] {\n        return []\n      },\n      /**\n       * #method\n       * @param region -\n       * @returns falsy if the region is fine to try rendering. Otherwise,\n       * return a react node + string of text. string of text describes why it\n       * cannot be rendered react node allows user to force load at current\n       * setting\n       */\n      regionCannotBeRendered(/* region */) {\n        return null\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setMessage(arg?: string) {\n        self.message = arg\n      },\n      /**\n       * #action\n       */\n      setError(error?: unknown) {\n        self.error = error\n      },\n      /**\n       * #action\n       */\n      setRpcDriverName(rpcDriverName: string) {\n        self.rpcDriverName = rpcDriverName\n      },\n      /**\n       * #action\n       * base display reload does nothing, see specialized displays for details\n       */\n      reload() {},\n    }))\n}\n\nexport const BaseDisplay = stateModelFactory()\nexport type BaseDisplayStateModel = typeof BaseDisplay\nexport type BaseDisplayModel = Instance<BaseDisplayStateModel>\n","import { ConfigurationSchema } from '../../configuration'\n\n/**\n * #config BaseInternetAccount\n * the \"base\" internet account type\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const BaseInternetAccountConfig = ConfigurationSchema(\n  'InternetAccount',\n  {\n    /**\n     * #slot\n     */\n    name: {\n      description: 'descriptive name of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    description: {\n      description: 'a description of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    authHeader: {\n      description: 'request header for credentials',\n      type: 'string',\n      defaultValue: 'Authorization',\n    },\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'internetAccountId',\n    explicitlyTyped: true,\n  },\n)\n","import React from 'react'\nimport { Instance, types } from 'mobx-state-tree'\nimport { ConfigurationReference, getConf } from '../../configuration'\nimport { RemoteFileWithRangeCache } from '../../util/io'\nimport { ElementId } from '../../util/types/mst'\nimport { UriLocation, AnyReactComponentType } from '../../util/types'\nimport { BaseInternetAccountConfig } from './baseInternetAccountConfig'\n\nconst inWebWorker = typeof sessionStorage === 'undefined'\n\n/**\n * #stateModel BaseInternetAccountModel\n * #category internetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const InternetAccount = types\n  .model('InternetAccount', {\n    /**\n     * #property\n     */\n    id: ElementId,\n    /**\n     * #property\n     */\n    type: types.string,\n    /**\n     * #property\n     */\n    configuration: ConfigurationReference(BaseInternetAccountConfig),\n  })\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get name(): string {\n      return getConf(self, 'name')\n    },\n    /**\n     * #getter\n     */\n    get description(): string {\n      return getConf(self, 'description')\n    },\n    /**\n     * #getter\n     */\n    get internetAccountId(): string {\n      return getConf(self, 'internetAccountId') // NOTE: this is the explicitIdentifier of the config schema\n    },\n    /**\n     * #getter\n     */\n    get authHeader(): string {\n      return getConf(self, 'authHeader')\n    },\n    /**\n     * #getter\n     */\n    get tokenType(): string {\n      return getConf(self, 'tokenType')\n    },\n    /**\n     * #getter\n     */\n    get domains(): string[] {\n      return getConf(self, 'domains')\n    },\n    /**\n     * #getter\n     * Can use this to customize what is displayed in fileSelector's toggle box\n     */\n    get toggleContents(): React.ReactNode {\n      return null\n    },\n    /**\n     * #getter\n     * Can use this to customize what the fileSelector. It takes a prop called\n     * `setLocation` that should be used to set a UriLocation\n     */\n    get SelectorComponent(): AnyReactComponentType | undefined {\n      return undefined\n    },\n    /**\n     * #getter\n     * Can use this to add a label to the UrlChooser. Has no effect if a custom\n     * SelectorComponent is supplied\n     */\n    get selectorLabel(): string | undefined {\n      return undefined\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     * Determine whether this internetAccount provides credentials for a URL\n     * @param location  - UriLocation of resource\n     * @returns true or false\n     */\n    handlesLocation(location: UriLocation) {\n      return self.domains.some(domain => location?.uri.includes(domain))\n    },\n    /**\n     * #getter\n     * The key used to store this internetAccount's token in sessionStorage\n     */\n    get tokenKey() {\n      return `${self.internetAccountId}-token`\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Must be implemented by a model extending or composing this one. Pass the\n     * user's token to `resolve`.\n     * @param resolve - Pass the token to this function\n     * @param reject - If there is an error getting the token, call this function\n     */\n    getTokenFromUser(\n      _resolve: (token: string) => void,\n      _reject: (error: Error) => void,\n    ): void {\n      throw new Error('getTokenFromUser must be implemented by extending model')\n    },\n    /**\n     * #action\n     */\n    storeToken(token: string) {\n      sessionStorage.setItem(self.tokenKey, token)\n    },\n    /**\n     * #action\n     */\n    removeToken() {\n      sessionStorage.removeItem(self.tokenKey)\n    },\n    /**\n     * #action\n     */\n    retrieveToken() {\n      return sessionStorage.getItem(self.tokenKey)\n    },\n    /**\n     * #action\n     * This can be used by an internetAccount to validate a token works before\n     * it is used. This is run when preAuthorizationInformation is requested,\n     * so it can be used to check that a token is valid before sending it to a\n     * worker thread. It expects the token to be returned so that this action\n     * can also be used to generate a new token (e.g. by using a refresh token)\n     * if the original one was invalid. Should throw an error if a token is\n     * invalid.\n     *\n     * @param token - Auth token\n     * @param loc - UriLocation of the resource\n     * @returns - Valid auth token\n     */\n    async validateToken(token: string, _loc: UriLocation) {\n      return token\n    },\n  }))\n  .actions(self => {\n    let tokenPromise: Promise<string> | undefined = undefined\n    return {\n      /**\n       * #action\n       * Try to get the token from the location pre-auth, from local storage,\n       * or from a previously cached promise. If token is not available, uses\n       * `getTokenFromUser`.\n       *\n       * @param location - UriLocation of the resource\n       * @returns A promise for the token\n       */\n      async getToken(location?: UriLocation): Promise<string> {\n        if (tokenPromise) {\n          return tokenPromise\n        }\n        let token = location?.internetAccountPreAuthorization?.authInfo?.token\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        if (inWebWorker) {\n          throw new Error(\n            'Did not get internet account pre-authorization info in worker',\n          )\n        }\n        token = self.retrieveToken()\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        tokenPromise = new Promise((resolve, reject) =>\n          self.getTokenFromUser(\n            token => {\n              self.storeToken(token)\n              resolve(token)\n            },\n            error => {\n              self.removeToken()\n              reject(error)\n            },\n          ),\n        )\n        return tokenPromise\n      },\n    }\n  })\n  .actions(self => ({\n    /**\n     * #action\n     */\n    addAuthHeaderToInit(init: RequestInit = {}, token: string) {\n      return {\n        ...init,\n        headers: new Headers({\n          ...init.headers,\n          [self.authHeader]: self.tokenType\n            ? `${self.tokenType} ${token}`\n            : token,\n        }),\n      }\n    },\n    /**\n     * #action\n     * Gets the token and returns it along with the information needed to\n     * create a new internetAccount.\n     *\n     * @param location - UriLocation of the resource\n     * @returns\n     */\n    async getPreAuthorizationInformation(location: UriLocation) {\n      const authToken = await self.getToken(location)\n      let validatedToken: string | undefined\n      try {\n        validatedToken = await self.validateToken(authToken, location)\n      } catch (error) {\n        self.removeToken()\n        throw error\n      }\n      return {\n        internetAccountType: self.type,\n        authInfo: {\n          token: validatedToken,\n          configuration: getConf(self),\n        },\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Get a fetch method that will add any needed authentication headers to\n     * the request before sending it. If location is provided, it will be\n     * checked to see if it includes a token in it pre-auth information.\n     *\n     * @param loc - UriLocation of the resource\n     * @returns A function that can be used to fetch\n     */\n    getFetcher(loc?: UriLocation) {\n      return async (input: RequestInfo, init?: RequestInit) => {\n        const authToken = await self.getToken(loc)\n        const newInit = self.addAuthHeaderToInit(init, authToken)\n        return fetch(input, newInit)\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Gets a filehandle that uses a fetch that adds auth headers\n     * @param location - UriLocation of the resource\n     * @returns A filehandle\n     */\n    openLocation(location: UriLocation) {\n      return new RemoteFileWithRangeCache(location.uri, {\n        fetch: self.getFetcher(location),\n      })\n    },\n  }))\n\nexport type BaseInternetAccountStateModel = typeof InternetAccount\nexport type BaseInternetAccountModel = Instance<BaseInternetAccountStateModel>\n","import { transaction } from 'mobx'\nimport {\n  getRoot,\n  resolveIdentifier,\n  types,\n  Instance,\n  IAnyStateTreeNode,\n} from 'mobx-state-tree'\n\n// locals\nimport {\n  getConf,\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '../../configuration'\nimport PluginManager from '../../PluginManager'\nimport { MenuItem } from '../../ui'\nimport { getContainingView, getEnv, getSession } from '../../util'\nimport { isSessionModelWithConfigEditing } from '../../util/types'\nimport { ElementId } from '../../util/types/mst'\n\nexport function getCompatibleDisplays(self: IAnyStateTreeNode) {\n  const { pluginManager } = getEnv(self)\n  const view = getContainingView(self)\n  const viewType = pluginManager.getViewType(view.type)\n  const compatTypes = new Set(viewType.displayTypes.map(d => d.name))\n  const displays = self.configuration.displays as AnyConfigurationModel[]\n  return displays.filter(d => compatTypes.has(d.type))\n}\n\n/**\n * #stateModel BaseTrackModel\n * #category track\n *\n * these MST models only exist for tracks that are *shown*. they should contain\n * only UI state for the track, and have a reference to a track configuration.\n * note that multiple displayed tracks could use the same configuration.\n */\nexport function createBaseTrackModel(\n  pm: PluginManager,\n  trackType: string,\n  baseTrackConfig: AnyConfigurationSchemaType,\n) {\n  return types\n    .model(trackType, {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal(trackType),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(baseTrackConfig),\n      /**\n       * #property\n       */\n      minimized: false,\n      /**\n       * #property\n       */\n      displays: types.array(pm.pluggableMstType('display', 'stateModel')),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       * determines which webworker to send the track to, currently based on trackId\n       */\n      get rpcSessionId() {\n        return self.configuration?.trackId\n      },\n      /**\n       * #getter\n       */\n      get name() {\n        return getConf(self, 'name')\n      },\n      /**\n       * #getter\n       */\n      get textSearchAdapter() {\n        return getConf(self, 'textSearchAdapter')\n      },\n\n      /**\n       * #getter\n       */\n      get adapterType() {\n        const adapterConfig = getConf(self, 'adapter')\n        if (!adapterConfig) {\n          throw new Error(`no adapter configuration provided for ${self.type}`)\n        }\n        const adapterType = pm.getAdapterType(adapterConfig.type)\n        if (!adapterType) {\n          throw new Error(`unknown adapter type ${adapterConfig.type}`)\n        }\n        return adapterType\n      },\n\n      /**\n       * #getter\n       */\n      get viewMenuActions(): MenuItem[] {\n        return self.displays.flatMap(d => d.viewMenuActions)\n      },\n\n      /**\n       * #getter\n       */\n      get canConfigure() {\n        const session = getSession(self)\n        const { sessionTracks, adminMode } = session\n        return (\n          isSessionModelWithConfigEditing(session) &&\n          (adminMode ||\n            sessionTracks?.find(t => t.trackId === self.configuration?.trackId))\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setMinimized(flag: boolean) {\n        self.minimized = flag\n      },\n\n      /**\n       * #action\n       */\n      showDisplay(displayId: string, initialSnapshot = {}) {\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), displayId)\n        const displayType = pm.getDisplayType(conf.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${conf.type}`)\n        }\n        const display = displayType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n        })\n        self.displays.push(display)\n      },\n\n      /**\n       * #action\n       */\n      hideDisplay(displayId: string) {\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), displayId)\n        const t = self.displays.filter(d => d.configuration === conf)\n        transaction(() => t.forEach(d => self.displays.remove(d)))\n        return t.length\n      },\n\n      /**\n       * #action\n       */\n      replaceDisplay(oldId: string, newId: string, initialSnapshot = {}) {\n        const idx = self.displays.findIndex(\n          d => d.configuration.displayId === oldId,\n        )\n        if (idx === -1) {\n          throw new Error(`could not find display id ${oldId} to replace`)\n        }\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), newId)\n        const displayType = pm.getDisplayType(conf.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${conf.type}`)\n        }\n        self.displays.splice(idx, 1, {\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n        })\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      trackMenuItems() {\n        const menuItems: MenuItem[] = self.displays.flatMap(d =>\n          d.trackMenuItems(),\n        )\n        const shownId = self.displays[0].configuration.displayId\n        const compatDisp = getCompatibleDisplays(self)\n\n        return [\n          ...menuItems,\n          ...(compatDisp.length > 1\n            ? [\n                {\n                  type: 'subMenu',\n                  label: 'Display types',\n                  subMenu: compatDisp.map(d => ({\n                    type: 'radio',\n                    label: pm.getDisplayType(d.type).displayName,\n                    checked: d.displayId === shownId,\n                    onClick: () => self.replaceDisplay(shownId, d.displayId),\n                  })),\n                },\n              ]\n            : []),\n        ]\n      },\n    }))\n}\n\nexport type BaseTrackStateModel = ReturnType<typeof createBaseTrackModel>\nexport type BaseTrackModel = Instance<BaseTrackStateModel>\n","import { types, Instance } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../../configuration'\nimport PluginManager from '../../PluginManager'\n\n/**\n * #config BaseTrack\n */\nexport function createBaseTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseTrack',\n    {\n      /**\n       * #slot\n       */\n      name: {\n        description: 'descriptive name of the track',\n        type: 'string',\n        defaultValue: 'Track',\n      },\n      /**\n       * #slot\n       */\n      assemblyNames: {\n        description: 'name of the assembly (or assemblies) track belongs to',\n        type: 'stringArray',\n        defaultValue: ['assemblyName'],\n      },\n      /**\n       * #slot\n       */\n      description: {\n        description: 'a description of the track',\n        type: 'string',\n        defaultValue: '',\n      },\n      /**\n       * #slot\n       */\n      category: {\n        description: 'the category and sub-categories of a track',\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      /**\n       * #slot\n       */\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n      /**\n       * #slot\n       */\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n\n      textSearching: ConfigurationSchema('textSearching', {\n        /**\n         * #slot textSearching.indexedAttributes\n         */\n        indexingAttributes: {\n          type: 'stringArray',\n          description:\n            'list of which feature attributes to index for text searching',\n          defaultValue: ['Name', 'ID'],\n        },\n        /**\n         * #slot textSearching.indexingFeatureTypesToExclude\n         */\n        indexingFeatureTypesToExclude: {\n          type: 'stringArray',\n          description: 'list of feature types to exclude in text search index',\n          defaultValue: ['CDS', 'exon'],\n        },\n\n        /**\n         * #slot textSearching.textSearchAdapter\n         */\n        textSearchAdapter: pluginManager.pluggableConfigSchemaType(\n          'text search adapter',\n        ),\n      }),\n\n      /**\n       * #slot\n       */\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n\n      formatDetails: ConfigurationSchema('FormatDetails', {\n        /**\n         * #slot formatDetails.feature\n         */\n        feature: {\n          type: 'frozen',\n          description: 'adds extra fields to the feature details',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n        /**\n         * #slot formatDetails.subfeatures\n         */\n        subfeatures: {\n          type: 'frozen',\n          description: 'adds extra fields to the subfeatures of a feature',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n        /**\n         * #slot formatDetails.depth\n         */\n        depth: {\n          type: 'number',\n          defaultValue: 2,\n          description:\n            'depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2',\n        },\n        /**\n         * #slot formatDetails.maxDepth\n         */\n        maxDepth: {\n          type: 'number',\n          defaultValue: 99999,\n          description: 'Maximum depth to render subfeatures',\n        },\n      }),\n      formatAbout: ConfigurationSchema('FormatAbout', {\n        /**\n         * #slot formatAbout.config\n         */\n        config: {\n          type: 'frozen',\n          description: 'formats configuration object in about dialog',\n          defaultValue: {},\n          contextVariable: ['config'],\n        },\n\n        /**\n         * #slot formatAbout.hideUris\n         */\n        hideUris: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n      }),\n    },\n    {\n      preProcessSnapshot: s2 => {\n        const snap = pluginManager.evaluateExtensionPoint(\n          'Core-preProcessTrackConfig',\n          JSON.parse(JSON.stringify(s2)),\n        ) as {\n          trackId: string\n          name: string\n          type: string\n          displays: { type: string; displayId: string }[]\n        }\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          const configDisplayTypes = new Set(\n            displays.filter(d => !!d).map(d => d.type),\n          )\n          pluginManager.getTrackType(snap.type).displayTypes.forEach(d => {\n            if (!configDisplayTypes.has(d.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${d.name}`,\n                type: d.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      actions: (self: any) => ({\n        addDisplayConf(conf: { type: string; displayId: string }) {\n          const { type } = conf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            (d: any) => d?.displayId === conf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(conf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n\nexport type BaseTrackConfigSchema = ReturnType<typeof createBaseTrackConfig>\nexport type BaseTrackConfig = Instance<BaseTrackConfigSchema>\n","import deepEqual from 'fast-deep-equal'\n\n// layouts\nimport GranularRectLayout from '../../util/layouts/GranularRectLayout'\nimport MultiLayout from '../../util/layouts/MultiLayout'\nimport { SerializedLayout, BaseLayout } from '../../util/layouts/BaseLayout'\nimport PrecomputedLayout from '../../util/layouts/PrecomputedLayout'\n\n// other\nimport FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsSerialized as FeatureRenderArgsSerialized,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderResults as FeatureRenderResults,\n  ResultsSerialized as FeatureResultsSerialized,\n  ResultsDeserialized as FeatureResultsDeserialized,\n} from './FeatureRendererType'\nimport { getLayoutId, Region, Feature } from '../../util'\nimport { readConfObject, AnyConfigurationModel } from '../../configuration'\nimport SerializableFilterChain from './util/serializableFilterChain'\nimport RpcManager from '../../rpc/RpcManager'\n\nexport interface LayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n}\n\nexport type MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\nexport interface CachedLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport class LayoutSession implements LayoutSessionProps {\n  config: AnyConfigurationModel\n\n  bpPerPx: number\n\n  filters: SerializableFilterChain\n\n  constructor(args: LayoutSessionProps) {\n    this.config = args.config\n    this.bpPerPx = args.bpPerPx\n    this.filters = args.filters\n    this.update(args)\n  }\n\n  update(props: LayoutSessionProps) {\n    Object.assign(this, props)\n  }\n\n  makeLayout() {\n    return new MultiLayout(GranularRectLayout, {\n      maxHeight: readConfObject(this.config, 'maxHeight'),\n      displayMode: readConfObject(this.config, 'displayMode'),\n      pitchX: this.bpPerPx,\n      pitchY: readConfObject(this.config, 'noSpacing') ? 1 : 3,\n    })\n  }\n\n  /**\n   * @param layout -\n   * @returns true if the given layout is a valid one to use for this session\n   */\n  cachedLayoutIsValid(cachedLayout: CachedLayout) {\n    return (\n      cachedLayout &&\n      cachedLayout.layout.subLayoutConstructorArgs.pitchX === this.bpPerPx &&\n      deepEqual(readConfObject(this.config), cachedLayout.config) &&\n      deepEqual(this.filters, cachedLayout.filters)\n    )\n  }\n\n  cachedLayout: CachedLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\nexport interface RenderArgs extends FeatureRenderArgs {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderArgsSerialized extends FeatureRenderArgsSerialized {\n  bpPerPx: number\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderResults extends FeatureRenderResults {\n  layout: BaseLayout<Feature>\n}\n\nexport interface ResultsSerialized extends FeatureResultsSerialized {\n  maxHeightReached: boolean\n  layout: SerializedLayout\n}\n\nexport interface ResultsDeserialized extends FeatureResultsDeserialized {\n  maxHeightReached: boolean\n  layout: PrecomputedLayout<string>\n}\n\nexport default class BoxRendererType extends FeatureRendererType {\n  sessions: Record<string, LayoutSession> = {}\n\n  getWorkerSession(\n    props: LayoutSessionProps & { sessionId: string; layoutId: string },\n  ) {\n    const key = getLayoutId(props)\n    if (!this.sessions[key]) {\n      this.sessions[key] = this.createSession(props)\n    }\n    const session = this.sessions[key]\n    session.update(props)\n    return session\n  }\n\n  // expands region for glyphs to use\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    if (!region) {\n      return region\n    }\n    const { bpPerPx, config } = renderArgs\n    const maxFeatureGlyphExpansion =\n      config === undefined\n        ? 0\n        : readConfObject(config, 'maxFeatureGlyphExpansion')\n    if (!maxFeatureGlyphExpansion) {\n      return region\n    }\n    const bpExpansion = Math.round(maxFeatureGlyphExpansion * bpPerPx)\n    return {\n      ...region,\n      start: Math.floor(Math.max(region.start - bpExpansion, 0)),\n      end: Math.ceil(region.end + bpExpansion),\n    }\n  }\n\n  createSession(props: LayoutSessionProps) {\n    return new LayoutSession(props)\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const { regions } = args\n    const key = getLayoutId(args)\n    let freed = 0\n    const session = this.sessions[key]\n    if (!regions && session) {\n      delete this.sessions[key]\n      freed = 1\n    }\n    if (session && regions) {\n      session.layout.discardRange(\n        regions[0].refName,\n        regions[0].start,\n        regions[0].end,\n      )\n    }\n    return freed + (await super.freeResourcesInClient(rpcManager, args))\n  }\n\n  deserializeLayoutInClient(json: SerializedLayout) {\n    return new PrecomputedLayout(json)\n  }\n\n  deserializeResultsInClient(result: ResultsSerialized, args: RenderArgs) {\n    const layout = this.deserializeLayoutInClient(result.layout)\n    return super.deserializeResultsInClient(\n      { ...result, layout } as FeatureResultsSerialized,\n      args,\n    ) as ResultsDeserialized\n  }\n\n  createLayoutInWorker(args: RenderArgsDeserialized) {\n    const { regions } = args\n    const session = this.getWorkerSession(args)\n    return session.layout.getSublayout(regions[0].refName)\n  }\n\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(\n      results,\n      args,\n    ) as ResultsSerialized\n\n    const [region] = args.regions\n    serialized.layout = results.layout.serializeRegion(\n      this.getExpandedRegion(region, args),\n    )\n    if (serialized.layout.rectangles) {\n      serialized.features = serialized.features.filter(f => {\n        return Boolean(serialized.layout.rectangles[f.uniqueId])\n      })\n    }\n\n    serialized.maxHeightReached = serialized.layout.maxHeightReached\n    return serialized\n  }\n\n  /**\n   * gets layout and renders\n   *\n   * @param props - render args\n   */\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const layout =\n      (props.layout as undefined | BaseLayout<unknown>) ||\n      this.createLayoutInWorker(props)\n    const result = await super.render({ ...props, layout })\n    return { ...result, layout }\n  }\n}\n","import React, { useEffect, useRef } from 'react'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { AnyReactComponentType, Feature, rIC } from '../../util'\nimport { ThemeOptions, ThemeProvider } from '@mui/material'\nimport { createJBrowseTheme } from '../../ui'\nimport { getRoot } from 'mobx-state-tree'\n// eslint-disable-next-line react/no-deprecated\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\n\ninterface Props {\n  html: string\n  features: Map<string, Feature>\n  theme: ThemeOptions\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  displayModel: any\n  RenderingComponent: AnyReactComponentType\n}\n\nconst NewHydrate = observer(function RpcRenderedSvgGroup(props: Props) {\n  const { html, theme, RenderingComponent, ...rest } = props\n  const ref = useRef<SVGGElement>(null)\n\n  // this `any` is a react-dom/client::Root\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const rootRef = useRef<any>()\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const root = getRoot<any>(props.displayModel)\n  const hydrateRoot = root.hydrateFn\n\n  useEffect(() => {\n    const renderTimeout = rIC(() => {\n      if (!ref.current) {\n        return\n      }\n      const jbrowseTheme = createJBrowseTheme(theme)\n      rootRef.current =\n        rootRef.current ??\n        hydrateRoot(\n          ref.current,\n          <ThemeProvider theme={jbrowseTheme}>\n            <RenderingComponent {...rest} />\n          </ThemeProvider>,\n        )\n    })\n    return () => {\n      clearTimeout(renderTimeout)\n      const root = rootRef.current\n      rootRef.current = undefined\n\n      setTimeout(() => {\n        root?.unmount()\n      })\n    }\n  }, [html, RenderingComponent, hydrateRoot, theme, props, rest])\n\n  // eslint-disable-next-line react/no-danger\n  return <g ref={ref} dangerouslySetInnerHTML={{ __html: html }} />\n})\n\nconst OldHydrate = observer(function OldHydrate(props: Props) {\n  const { html, RenderingComponent } = props\n  const ref = useRef<SVGGElement>(null)\n  useEffect(() => {\n    const domNode = ref.current\n    function doHydrate() {\n      if (domNode && html) {\n        if (domNode.innerHTML) {\n          unmountComponentAtNode(domNode)\n        }\n\n        // setting outline:none fixes react \"focusable\" element issue. see\n        // https://github.com/GMOD/jbrowse-components/issues/2160\n        domNode.style.outline = 'none'\n        domNode.innerHTML = html\n        // use requestIdleCallback to defer main-thread rendering\n        // and hydration for when we have some free time. helps\n        // keep the framerate up.\n        rIC(() => {\n          hydrate(<RenderingComponent {...props} />, domNode)\n        })\n      }\n    }\n    doHydrate()\n    return () => {\n      if (domNode) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  }, [html, RenderingComponent, props])\n\n  return <g ref={ref} />\n})\n\nconst RpcRenderedSvgGroup = observer(function (props: Props) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const root = getRoot<any>(props.displayModel)\n  return root.hydrateFn ? <NewHydrate {...props} /> : <OldHydrate {...props} />\n})\n\nexport default RpcRenderedSvgGroup\n","import React from 'react'\nimport { SimpleFeature, SimpleFeatureSerialized } from '../../util'\nimport FeatureRenderer from './FeatureRendererType'\nimport RpcRenderedSvgGroup from './RpcRenderedSvgGroup'\nimport { ThemeOptions } from '@mui/material'\n\nexport default class CircularChordRendererType extends FeatureRenderer {\n  supportsSVG = true\n\n  deserializeResultsInClient(\n    res: { features: SimpleFeatureSerialized[]; html: string },\n    args: {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      displayModel: any\n      theme: ThemeOptions\n      exportSVG?: { rasterizeLayers?: boolean }\n    },\n  ) {\n    const deserializedFeatures = new Map(\n      res.features.map(f => SimpleFeature.fromJSON(f)).map(f => [f.id(), f]),\n    )\n    // if we are rendering svg, we skip hydration\n    if (args.exportSVG) {\n      // only return the res if the renderer explicitly has\n      // this.supportsSVG support to avoid garbage being rendered in SVG\n      // document\n      return {\n        ...res,\n        features: deserializedFeatures,\n        blockKey: 'circularChord',\n        html: this.supportsSVG\n          ? res.html\n          : '<text y=\"12\" fill=\"black\">SVG export not supported for this track</text>',\n      }\n    }\n\n    // hydrate res using ServerSideRenderedContent\n    return {\n      ...res,\n      features: deserializedFeatures,\n      blockKey: 'circularChord',\n      reactElement: (\n        <RpcRenderedSvgGroup\n          {...args}\n          {...res}\n          features={deserializedFeatures}\n          RenderingComponent={this.ReactComponent}\n        />\n      ),\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { filter, toArray } from 'rxjs/operators'\nimport { Feature } from '../../util/simpleFeature'\nimport { Region } from '../../util/types'\nimport ServerSideRenderer, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from './ServerSideRendererType'\nimport RpcManager from '../../rpc/RpcManager'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\nimport { dedupe, getSerializedSvg } from '../../util'\nimport { firstValueFrom } from 'rxjs'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  blockKey: string\n}\n\nexport interface ResultsSerializedSvgExport extends ResultsSerialized {\n  canvasRecordedData: unknown\n  width: number\n  height: number\n  reactElement: unknown\n}\n\nfunction isSvgExport(e: ResultsSerialized): e is ResultsSerializedSvgExport {\n  return 'canvasRecordedData' in e\n}\n\nexport default class ComparativeServerSideRenderer extends ServerSideRenderer {\n  /**\n   * directly modifies the render arguments to prepare\n   * them to be serialized and sent to the worker.\n   *\n   * the base class replaces the `displayModel` param\n   * (which on the client is a MST model) with a stub\n   * that only contains the `selectedFeature`, since\n   * this is the only part of the track model that most\n   * renderers read.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n\n  async renameRegionsIfNeeded(args: RenderArgs) {\n    return args\n  }\n\n  serializeArgsInClient(args: RenderArgs) {\n    const deserializedArgs = {\n      ...args,\n      displayModel: {},\n    }\n\n    return super.serializeArgsInClient(deserializedArgs)\n  }\n\n  // deserialize some of the results that came back from the worker\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserialized = super.deserializeResultsInClient(result, args)\n    return { ...deserialized, blockKey: args.blockKey }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then\n   * calls `render` with the RPC manager.\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const results = (await rpcManager.call(\n      args.sessionId,\n      'ComparativeRender',\n      args,\n    )) as ResultsSerialized\n\n    if (isSvgExport(results)) {\n      results.html = await getSerializedSvg(results)\n      delete results.reactElement\n    }\n    return results\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    return renderArgs.filters\n      ? renderArgs.filters.passes(feature, renderArgs)\n      : true\n  }\n\n  async getFeatures(renderArgs: any) {\n    const pm = this.pluginManager\n    const { sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    const regions = renderArgs.regions as Region[]\n    if (!regions || regions.length === 0) {\n      console.warn('no regions supplied to comparative renderer')\n      return []\n    }\n\n    const requestRegions = regions.map(r => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.floor(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    // note that getFeaturesInMultipleRegions does not do glyph expansion\n    const res = await firstValueFrom(\n      (dataAdapter as BaseFeatureDataAdapter)\n        .getFeaturesInMultipleRegions(requestRegions, renderArgs)\n        .pipe(\n          filter(f => this.featurePassesFilters(renderArgs, f)),\n          toArray(),\n        ),\n    )\n\n    // dedupe needed xref https://github.com/GMOD/jbrowse-components/pull/3404/\n    return dedupe(res, f => f.id())\n  }\n}\n\nexport { type RenderResults } from './ServerSideRendererType'\n","import { toArray } from 'rxjs/operators'\nimport clone from 'clone'\nimport { firstValueFrom } from 'rxjs'\n\n// locals\nimport { checkAbortSignal, iterMap } from '../../util'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '../../util/simpleFeature'\nimport { AugmentedRegion as Region } from '../../util/types'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults as ServerSideRenderResults,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n} from './ServerSideRendererType'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { AnyConfigurationModel } from '../../configuration'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n  adapterConfig: AnyConfigurationModel\n}\n\nexport interface RenderResults extends ServerSideRenderResults {\n  features: Map<string, Feature>\n}\n\nexport interface ResultsSerialized extends ServerSideResultsSerialized {\n  features: SimpleFeatureSerialized[]\n}\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  features: Map<string, Feature>\n  blockKey: string\n}\n\nexport default class FeatureRendererType extends ServerSideRendererType {\n  /**\n   * replaces the `displayModel` param (which on the client is a MST model)\n   * with a stub that only contains the `selectedFeature`, since this is the only\n   * part of the track model that most renderers read. also serializes the config\n   * and regions to JSON from MST objects.\n   *\n   * @param args - the arguments passed to render\n   */\n  serializeArgsInClient(args: RenderArgs) {\n    const { displayModel, regions } = args\n    const serializedArgs = {\n      ...args,\n      displayModel: displayModel && {\n        id: displayModel.id,\n        selectedFeatureId: displayModel.selectedFeatureId,\n      },\n      regions: clone(regions),\n    }\n    return super.serializeArgsInClient(serializedArgs)\n  }\n\n  /**\n   * Adds feature deserialization to base server-side result deserialization\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserializedFeatures = new Map<string, SimpleFeature>(\n      result.features.map(f => SimpleFeature.fromJSON(f)).map(f => [f.id(), f]),\n    )\n\n    const deserialized = super.deserializeResultsInClient(\n      {\n        ...result,\n        features: deserializedFeatures,\n      } as ServerSideResultsSerialized,\n      args,\n    )\n    return {\n      ...deserialized,\n      blockKey: args.blockKey,\n      features: deserializedFeatures,\n    }\n  }\n\n  /**\n   * Adds feature serialization to base server-side result serialization\n   *\n   * @param result - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    result: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(result, args)\n    const { features } = result\n    return {\n      ...serialized,\n      features: iterMap(features.values(), f => f.toJSON(), features.size),\n    }\n  }\n\n  /**\n   * will expand if soft clipping or feature glyphs are shown\n   *\n   * @param region - rendering region\n   * @param _renderArgs - render args, unused, may be used in deriving classes\n   */\n  getExpandedRegion(region: Region, _renderArgs: RenderArgsDeserialized) {\n    return region\n  }\n\n  /**\n   * use the dataAdapter to fetch the features to be rendered\n   *\n   * @param renderArgs -\n   * @returns Map of features as `{ id => feature, ... }`\n   */\n  async getFeatures(\n    renderArgs: RenderArgsDeserialized,\n  ): Promise<Map<string, Feature>> {\n    const pm = this.pluginManager\n    const { signal, regions, sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    const features = new Map()\n\n    if (!regions || regions.length === 0) {\n      return features\n    }\n    // make sure the requested region's start and end are integers, if\n    // there is a region specification.\n    const requestRegions = regions.map((r: Region) => {\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.ceil(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    const region = requestRegions[0]\n\n    const featureObservable =\n      requestRegions.length === 1\n        ? dataAdapter.getFeatures(\n            this.getExpandedRegion(region, renderArgs),\n            renderArgs,\n          )\n        : dataAdapter.getFeaturesInMultipleRegions(requestRegions, renderArgs)\n\n    const feats = await firstValueFrom(featureObservable.pipe(toArray()))\n    checkAbortSignal(signal)\n    return new Map<string, Feature>(\n      feats\n        .filter(feat => this.featurePassesFilters(renderArgs, feat))\n        .map(feat => [feat.id(), feat] as const),\n    )\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    return renderArgs.filters\n      ? renderArgs.filters.passes(feature, renderArgs)\n      : true\n  }\n\n  /**\n   * gets features and renders\n   *\n   * @param props - render args\n   */\n  async render(\n    props: RenderArgsDeserialized & { features?: Map<string, Feature> },\n  ): Promise<RenderResults> {\n    const features = props.features || (await this.getFeatures(props))\n    const result = await super.render({ ...props, features })\n    return { ...result, features }\n  }\n}\n","import React, { ReactElement } from 'react'\nimport { getDefaultValue } from '../../util/mst-reflection'\nimport PluggableElementBase from '../PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../../configuration'\nimport { AnyReactComponentType } from '../../util'\nimport PluginManager from '../../PluginManager'\n\nexport type RenderProps = Record<string, unknown>\n\nexport interface RenderResults {\n  reactElement?: ReactElement\n  html?: string\n}\n\nexport default class RendererType extends PluggableElementBase {\n  ReactComponent: AnyReactComponentType\n\n  supportsSVG = true\n\n  configSchema: AnyConfigurationSchemaType\n\n  pluginManager: PluginManager\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AnyReactComponentType\n    displayName?: string\n    configSchema: AnyConfigurationSchemaType\n    pluginManager: PluginManager\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.configSchema = stuff.configSchema\n    this.pluginManager = stuff.pluginManager\n\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for renderer ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      throw new Error(\n        `${this.name} config schema ${this.configSchema.name} is not explicitlyTyped`,\n      )\n    }\n    if (!this.pluginManager) {\n      throw new Error(`no plugin manager defined for renderer ${this.name}`)\n    }\n  }\n\n  async render(props: RenderProps): Promise<RenderResults> {\n    return {\n      reactElement: React.createElement(this.ReactComponent, props, null),\n    }\n  }\n\n  /**\n   * frees resources associated with the given range, session, etc.\n   * optionally returns the number of data items deleted\n   */\n  freeResources(/* specification: {} */): number {\n    return 0\n  }\n}\n","import React, { useEffect, useRef } from 'react'\nimport { ThemeProvider } from '@mui/material/styles'\n\n// locals\nimport { createJBrowseTheme } from '../../ui'\nimport { ResultsSerialized, RenderArgs } from './ServerSideRendererType'\nimport { observer } from 'mobx-react'\nimport { getRoot } from 'mobx-state-tree'\n// eslint-disable-next-line react/no-deprecated\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\nimport { rIC } from '../../util'\n\ninterface Props extends ResultsSerialized, RenderArgs {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  RenderingComponent: React.ComponentType<any>\n}\n\nconst NewHydrate = observer(function ServerSideRenderedContent({\n  theme,\n  html,\n  RenderingComponent,\n  ...rest\n}: Props) {\n  const ref = useRef<HTMLDivElement>(null)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const rootRef = useRef<any>()\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const { hydrateFn } = getRoot<any>(rest.displayModel)\n\n  useEffect(() => {\n    // requestIdleCallback here helps to avoid hydration mismatch\n    // because it provides time for dangerouslySetInnerHTML to set the innerHTML\n    // contents of the node, otherwise ref.current.innerHTML can be empty\n    const renderTimeout = rIC(() => {\n      if (!ref.current) {\n        return\n      }\n      const jbrowseTheme = createJBrowseTheme(theme)\n      // if there is a hydration mismatch, investigate value of\n      // - value of ref.current.innerHTML\n      // - value of `html` variable\n      // - renderToString of the below React element\n      rootRef.current =\n        rootRef.current ??\n        hydrateFn(\n          ref.current,\n          <ThemeProvider theme={jbrowseTheme}>\n            <RenderingComponent {...rest} />\n          </ThemeProvider>,\n        )\n    })\n    return () => {\n      clearTimeout(renderTimeout)\n      const root = rootRef.current\n      rootRef.current = undefined\n\n      setTimeout(() => {\n        root?.unmount()\n      })\n    }\n  }, [html, theme, rest, hydrateFn, RenderingComponent])\n\n  return (\n    <div\n      data-testid=\"hydrationContainer\"\n      ref={ref}\n      // eslint-disable-next-line react/no-danger\n      dangerouslySetInnerHTML={{ __html: html }}\n    />\n  )\n})\n\nconst OldHydrate = observer(function ({\n  theme,\n  html,\n  RenderingComponent,\n  ...rest\n}: Props) {\n  const ref = useRef<HTMLDivElement>(null)\n  const jbrowseTheme = createJBrowseTheme(theme)\n\n  useEffect(() => {\n    const domNode = ref.current\n    function doHydrate() {\n      if (domNode) {\n        if (domNode) {\n          unmountComponentAtNode(domNode)\n        }\n        domNode.innerHTML = html\n\n        rIC(() => {\n          hydrate(\n            <ThemeProvider theme={jbrowseTheme}>\n              <RenderingComponent {...rest} />\n            </ThemeProvider>,\n            domNode,\n          )\n        })\n      }\n    }\n\n    doHydrate()\n\n    return () => {\n      if (domNode) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  }, [html, jbrowseTheme, rest, RenderingComponent])\n\n  return <div ref={ref} />\n})\n\nconst ServerSideRenderedContent = observer(function (props: Props) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const root = getRoot<any>(props.displayModel)\n  return root.hydrateFn ? <NewHydrate {...props} /> : <OldHydrate {...props} />\n})\n\nexport default ServerSideRenderedContent\n","import React from 'react'\nimport { ThemeOptions } from '@mui/material'\nimport { ThemeProvider } from '@mui/material/styles'\nimport { renderToString } from 'react-dom/server'\nimport {\n  SnapshotOrInstance,\n  SnapshotIn,\n  getSnapshot,\n  isStateTreeNode,\n} from 'mobx-state-tree'\n\n// locals\nimport { checkAbortSignal, getSerializedSvg, updateStatus } from '../../util'\nimport SerializableFilterChain, {\n  SerializedFilterChain,\n} from './util/serializableFilterChain'\nimport { AnyConfigurationModel } from '../../configuration'\nimport RpcManager from '../../rpc/RpcManager'\nimport { createJBrowseTheme } from '../../ui'\n\nimport RendererType, { RenderProps, RenderResults } from './RendererType'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\n\ninterface BaseRenderArgs extends RenderProps {\n  sessionId: string\n  // Note that signal serialization happens after serializeArgsInClient and\n  // deserialization happens before deserializeArgsInWorker\n  signal?: AbortSignal\n  theme: ThemeOptions\n  exportSVG: { rasterizeLayers?: boolean }\n}\n\nexport interface RenderArgs extends BaseRenderArgs {\n  config: SnapshotOrInstance<AnyConfigurationModel>\n  filters: SerializableFilterChain\n}\n\nexport interface RenderArgsSerialized extends BaseRenderArgs {\n  statusCallback?: (arg: string) => void\n  config: SnapshotIn<AnyConfigurationModel>\n  filters: SerializedFilterChain\n}\nexport interface RenderArgsDeserialized extends BaseRenderArgs {\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport interface ResultsSerialized extends Omit<RenderResults, 'reactElement'> {\n  html: string\n}\n\nexport interface ResultsSerializedSvgExport extends ResultsSerialized {\n  canvasRecordedData: unknown\n  width: number\n  height: number\n  reactElement: unknown\n}\n\nexport type ResultsDeserialized = RenderResults\n\nfunction isSvgExport(e: ResultsSerialized): e is ResultsSerializedSvgExport {\n  return 'canvasRecordedData' in e\n}\n\nexport default class ServerSideRenderer extends RendererType {\n  /**\n   * directly modifies the render arguments to prepare them to be serialized and\n   * sent to the worker.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs): RenderArgsSerialized {\n    return {\n      ...args,\n      config: isStateTreeNode(args.config)\n        ? getSnapshot(args.config)\n        : args.config,\n      filters: args.filters?.toJSON().filters,\n    }\n  }\n\n  /**\n   * Deserialize the render results from the worker in the client. Includes\n   * hydrating of the React HTML string, and not hydrating the result if SVG is\n   * being rendered\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    res: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    // if we are rendering svg, we skip hydration\n    if (args.exportSVG) {\n      // only return the res if the renderer explicitly has\n      // this.supportsSVG support to avoid garbage being rendered in SVG\n      // document\n      return {\n        ...res,\n        html: this.supportsSVG\n          ? res.html\n          : '<text y=\"12\" fill=\"black\">SVG export not supported for this track</text>',\n      }\n    }\n\n    // get res using ServerSideRenderedContent\n    return {\n      ...res,\n      reactElement: (\n        <ServerSideRenderedContent\n          {...args}\n          {...res}\n          RenderingComponent={this.ReactComponent}\n        />\n      ),\n    }\n  }\n\n  /**\n   * modifies the passed arguments object to inflate arguments as necessary.\n   * called in the worker process.\n   *\n   * @param args - the converted arguments to modify\n   */\n  deserializeArgsInWorker(args: RenderArgsSerialized): RenderArgsDeserialized {\n    const deserialized = { ...args } as unknown as RenderArgsDeserialized\n    deserialized.config = this.configSchema.create(args.config || {}, {\n      pluginManager: this.pluginManager,\n    })\n    deserialized.filters = new SerializableFilterChain({\n      filters: args.filters,\n    })\n\n    return deserialized\n  }\n\n  /**\n   * Serialize results of the render to send them to the client. Includes\n   * rendering React to an HTML string.\n   *\n   * @param results - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const html = renderToString(\n      <ThemeProvider theme={createJBrowseTheme(args.theme)}>\n        {results.reactElement}\n      </ThemeProvider>,\n    )\n    delete results.reactElement\n    return { ...results, html }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then calls\n   * \"CoreRender\" with the RPC manager.\n   *\n   * @param rpcManager - RPC manager\n   * @param args - render args\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const results = (await rpcManager.call(\n      args.sessionId,\n      'CoreRender',\n      args,\n    )) as ResultsSerialized\n\n    if (isSvgExport(results)) {\n      results.html = await getSerializedSvg(results)\n      delete results.reactElement\n    }\n    return results\n  }\n\n  /**\n   * Render method called on the worker. `render` is called here in server-side\n   * rendering\n   *\n   * @param args - serialized render args\n   */\n  async renderInWorker(args: RenderArgsSerialized): Promise<ResultsSerialized> {\n    const { signal, statusCallback = () => {} } = args\n    const deserializedArgs = this.deserializeArgsInWorker(args)\n\n    const results = await updateStatus('Rendering plot', statusCallback, () =>\n      this.render(deserializedArgs),\n    )\n    checkAbortSignal(signal)\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    return updateStatus('Serializing results', statusCallback, () =>\n      this.serializeResultsInWorker(results, deserializedArgs),\n    )\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n\n    const freed = this.freeResources()\n    const freedRpc = (await rpcManager.call(\n      args.sessionId,\n      'CoreFreeResources',\n      serializedArgs,\n    )) as number\n    return freed + freedRpc\n  }\n}\n\nexport { type RenderResults } from './RendererType'\n","import { stringToJexlExpression } from '../../../util/jexlStrings'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype FilterExpression = (...args: Record<string, any>[] | any[]) => boolean\n\ninterface Filter {\n  string: string\n  expr: FilterExpression\n}\n\nexport type SerializedFilterChain = string[]\n\nexport default class SerializableFilterChain {\n  filterChain: Filter[]\n\n  constructor({ filters = [] }: { filters: SerializedFilterChain }) {\n    this.filterChain = filters\n      .map(f => f.trim())\n      .filter(f => !!f)\n      .map(inputFilter => {\n        if (typeof inputFilter === 'string') {\n          const expr = stringToJexlExpression(inputFilter) as FilterExpression\n          return { expr, string: inputFilter }\n        }\n        throw new Error(`invalid inputFilter string \"${inputFilter}\"`)\n      })\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  passes(...args: any[]) {\n    for (const entry of this.filterChain) {\n      if (\n        // @ts-expect-error\n        !entry.expr.evalSync({ feature: args[0] })\n      ) {\n        return false\n      }\n    }\n    return true\n  }\n\n  toJSON() {\n    return { filters: this.filterChain.map(f => f.string) }\n  }\n\n  static fromJSON(json: { filters: SerializedFilterChain }) {\n    return new SerializableFilterChain(json)\n  }\n}\n","import React, { useEffect } from 'react'\nimport CascadingMenu from '@jbrowse/core/ui/CascadingMenu'\nimport { IconButton } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport {\n  bindTrigger,\n  bindPopover,\n  usePopupState,\n} from 'material-ui-popup-state/hooks'\nimport { MenuItem } from '@jbrowse/core/ui'\n\nconst CascadingMenuButton = observer(function CascadingMenuButton({\n  children,\n  menuItems,\n  closeAfterItemClick = true,\n  stopPropagation,\n  setOpen,\n  onClick: onClickExtra,\n  ...rest\n}: {\n  children?: React.ReactElement\n  menuItems: MenuItem[]\n  closeAfterItemClick?: boolean\n  stopPropagation?: boolean\n  onClick?: () => void\n  setOpen?: (arg: boolean) => void\n  [key: string]: unknown\n}) {\n  const popupState = usePopupState({\n    popupId: 'viewMenu',\n    variant: 'popover',\n  })\n  const { onClick, onTouchStart, ...rest2 } = bindTrigger(popupState)\n  const { isOpen } = popupState\n  useEffect(() => {\n    setOpen?.(isOpen)\n  }, [isOpen, setOpen])\n\n  return (\n    <>\n      <IconButton\n        onClick={event => {\n          if (stopPropagation) {\n            event.stopPropagation()\n          }\n          onClick(event)\n          onClickExtra?.()\n        }}\n        onTouchStart={event => {\n          if (stopPropagation) {\n            event.stopPropagation()\n          }\n          onTouchStart(event)\n          onClickExtra?.()\n        }}\n        {...rest2}\n        {...rest}\n        disabled={menuItems.length === 0}\n      >\n        {children}\n      </IconButton>\n      <CascadingMenu\n        {...bindPopover(popupState)}\n        onMenuItemClick={(_: unknown, callback: () => void) => callback()}\n        menuItems={menuItems}\n        closeAfterItemClick={closeAfterItemClick}\n        popupState={popupState}\n      />\n    </>\n  )\n})\n\nexport default CascadingMenuButton\n","import React, { useState } from 'react'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n} from '@mui/material'\nimport FactoryResetDialog from './FactoryResetDialog'\nimport ErrorMessage from './ErrorMessage'\n\nconst ResetComponent = ({\n  onFactoryReset,\n  resetButtonText,\n}: {\n  onFactoryReset: () => void\n  resetButtonText: string\n}) => {\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  return (\n    <>\n      <Button\n        data-testid=\"fatal-error\"\n        color=\"primary\"\n        variant=\"contained\"\n        onClick={() => setDialogOpen(true)}\n      >\n        {resetButtonText}\n      </Button>\n      <FactoryResetDialog\n        onClose={() => setDialogOpen(false)}\n        open={dialogOpen}\n        onFactoryReset={onFactoryReset}\n      />\n    </>\n  )\n}\n\nexport default function FatalErrorDialog({\n  componentStack,\n  error = 'No error message provided',\n  onFactoryReset,\n  resetButtonText = 'Factory Reset',\n}: {\n  componentStack?: string\n  error?: unknown\n  onFactoryReset: () => void\n  resetButtonText?: string\n}) {\n  return (\n    <Dialog maxWidth=\"xl\" open>\n      <DialogTitle>Fatal error</DialogTitle>\n      <DialogContent>\n        <ErrorMessage error={error} />\n        <pre>{componentStack}</pre>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => window.location.reload()}\n        >\n          Refresh\n        </Button>\n        <ResetComponent\n          onFactoryReset={onFactoryReset}\n          resetButtonText={resetButtonText}\n        />\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import React from 'react'\nimport { Box, Button, Typography, FormControl } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { isElectron } from '../../util'\nimport { LocalPathLocation, FileLocation, BlobLocation } from '../../util/types'\nimport { getBlob, storeBlobLocation } from '../../util/tracks'\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\nconst useStyles = makeStyles()(theme => ({\n  filename: {\n    marginLeft: theme.spacing(1),\n  },\n}))\n\nfunction LocalFileChooser({\n  location,\n  setLocation,\n}: {\n  location?: FileLocation\n  setLocation: (arg: FileLocation) => void\n}) {\n  const { classes } = useStyles()\n  const filename =\n    location &&\n    ((isBlobLocation(location) && location.name) ||\n      (isLocalPathLocation(location) && location.localPath))\n\n  const needToReload =\n    location && isBlobLocation(location) && !getBlob(location.blobId)\n\n  return (\n    <Box display=\"flex\" flexDirection=\"row\" alignItems=\"center\">\n      <Box>\n        <FormControl fullWidth>\n          <Button variant=\"outlined\" component=\"label\">\n            Choose File\n            <input\n              type=\"file\"\n              hidden\n              onChange={({ target }) => {\n                const file = target?.files?.[0]\n                if (file) {\n                  if (isElectron) {\n                    setLocation({\n                      localPath: (file as File & { path: string }).path,\n                      locationType: 'LocalPathLocation',\n                    })\n                  } else {\n                    // @ts-expect-error\n                    setLocation(storeBlobLocation({ blob: file }))\n                  }\n                }\n              }}\n            />\n          </Button>\n        </FormControl>\n      </Box>\n      <Box>\n        <Typography\n          component=\"span\"\n          className={classes.filename}\n          color={filename ? 'initial' : 'textSecondary'}\n        >\n          {filename || 'No file chosen'}\n        </Typography>\n        {needToReload ? (\n          <Typography color=\"error\">(need to reload)</Typography>\n        ) : null}\n      </Box>\n    </Box>\n  )\n}\n\nexport default LocalFileChooser\n","import React from 'react'\nimport { TextField } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { FileLocation, isUriLocation } from '../../util/types'\n\nconst UrlChooser = observer(function ({\n  location,\n  setLocation,\n  label,\n}: {\n  location?: FileLocation\n  setLocation: (arg: FileLocation) => void\n  label?: string\n}) {\n  return (\n    <TextField\n      fullWidth\n      variant=\"outlined\"\n      inputProps={{ 'data-testid': 'urlInput' }}\n      defaultValue={location && isUriLocation(location) ? location.uri : ''}\n      label={label || 'Enter URL'}\n      onChange={event => {\n        setLocation({\n          uri: event.target.value.trim(),\n          locationType: 'UriLocation',\n        })\n      }}\n    />\n  )\n})\n\nexport default UrlChooser\n","import React from 'react'\nimport { Typography, TypographyProps } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { keyframes } from 'tss-react'\n\nconst useStyles = makeStyles()({\n  dots: {\n    '&::after': {\n      display: 'inline-block',\n      content: '\"\"',\n      width: '1em',\n      textAlign: 'left',\n      animation: `${keyframes`\n      0% {\n        content: '';\n      }\n      25% {\n          content: '.';\n      }\n      50% {\n        content: '..';\n      }\n      75% {\n        content: '...';\n      }\n      `} 1.2s infinite ease-in-out`,\n    },\n  },\n})\n\ninterface Props extends TypographyProps {\n  message?: string\n}\n\nexport default function LoadingEllipses({\n  message,\n  variant = 'body2',\n  ...rest\n}: Props) {\n  const { classes } = useStyles()\n  return (\n    <Typography className={classes.dots} {...rest} variant={variant}>\n      {`${message || 'Loading'}`}\n    </Typography>\n  )\n}\n","import React from 'react'\n\nexport default function RedErrorMessageBox({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <div\n      style={{\n        padding: 4,\n        margin: 4,\n        overflow: 'auto',\n        maxHeight: 200,\n        background: '#f88',\n        border: '1px solid black',\n      }}\n    >\n      {children}\n    </div>\n  )\n}\n","const category10 = [\n  '#1f77b4',\n  '#ff7f0e',\n  '#2ca02c',\n  '#d62728',\n  '#9467bd',\n  '#8c564b',\n  '#e377c2',\n  '#7f7f7f',\n  '#bcbd22',\n  '#17becf',\n]\nconst dark2 = [\n  '#1b9e77',\n  '#d95f02',\n  '#7570b3',\n  '#e7298a',\n  '#66a61e',\n  '#e6ab02',\n  '#a6761d',\n  '#666666',\n]\nconst set1 = [\n  '#e41a1c',\n  '#377eb8',\n  '#4daf4a',\n  '#984ea3',\n  '#ff7f00',\n  '#ffff33',\n  '#a65628',\n  '#f781bf',\n  '#999999',\n]\nconst set2 = [\n  '#66c2a5',\n  '#fc8d62',\n  '#8da0cb',\n  '#e78ac3',\n  '#a6d854',\n  '#ffd92f',\n  '#e5c494',\n  '#b3b3b3',\n]\nconst tableau10 = [\n  '#4e79a7',\n  '#f28e2c',\n  '#e15759',\n  '#76b7b2',\n  '#59a14f',\n  '#edc949',\n  '#af7aa1',\n  '#ff9da7',\n  '#9c755f',\n  '#bab0ab',\n]\n\nconst ggplot2Colors6 = [\n  '#F8766D',\n  '#B79F00',\n  '#00BA38',\n  '#00BFC4',\n  '#619CFF',\n  '#F564E3',\n]\n\nconst ggplot2Colors5 = ['#F8766D', '#A3A500', '#00BF7D', '#00B0F6', '#E76BF3']\nconst ggplot2Colors4 = ['#F8766D', '#7CAE00', '#00BFC4', '#C77CFF']\nconst ggplot2Colors3 = ['#F8766D', '#00BA38', '#619CFF']\n\nexport {\n  set1,\n  set2,\n  tableau10,\n  dark2,\n  category10,\n  ggplot2Colors6,\n  ggplot2Colors5,\n  ggplot2Colors4,\n  ggplot2Colors3,\n}\n","import { getSnapshot } from 'mobx-state-tree'\nimport { Region, ViewSnap } from './index'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n}\n\nfunction lengthBetween(self: ViewSnap, start: BpOffset, end: BpOffset) {\n  let bpSoFar = 0\n  const { displayedRegions } = self\n  if (start.index === end.index) {\n    bpSoFar += end.offset - start.offset\n  } else {\n    const s = displayedRegions[start.index]\n    bpSoFar += s.end - s.start - start.offset\n    if (end.index - start.index >= 2) {\n      for (let i = start.index + 1; i < end.index; i++) {\n        const region = displayedRegions[i]\n        const len = region.end - region.start\n        bpSoFar += len\n      }\n    }\n    bpSoFar += end.offset\n  }\n  return bpSoFar\n}\n\nexport function moveTo(\n  self: ViewSnap & {\n    zoomTo: (arg: number) => number\n    scrollTo: (arg: number) => void\n  },\n  start?: BpOffset,\n  end?: BpOffset,\n) {\n  if (!start || !end) {\n    return\n  }\n  const {\n    width,\n    interRegionPaddingWidth,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n  } = self\n\n  const len = lengthBetween(self, start, end)\n  let numBlocksWideEnough = 0\n  for (let i = start.index; i < end.index; i++) {\n    const r = displayedRegions[i]\n    if ((r.end - r.start) / bpPerPx > minimumBlockWidth) {\n      numBlocksWideEnough++\n    }\n  }\n\n  const targetBpPerPx =\n    len / (width - interRegionPaddingWidth * numBlocksWideEnough)\n  const newBpPerPx = self.zoomTo(targetBpPerPx)\n\n  // If our target bpPerPx was smaller than the allowed minBpPerPx, adjust\n  // the scroll so the requested range is in the middle of the screen\n  let extraBp = 0\n  if (targetBpPerPx < newBpPerPx) {\n    extraBp = ((newBpPerPx - targetBpPerPx) * self.width) / 2\n  }\n\n  let bpToStart = -extraBp\n\n  for (let i = 0; i < self.displayedRegions.length; i += 1) {\n    const region = self.displayedRegions[i]\n    if (start.index === i) {\n      bpToStart += start.offset\n      break\n    } else {\n      bpToStart += region.end - region.start\n    }\n  }\n\n  self.scrollTo(Math.round(bpToStart / self.bpPerPx))\n}\n\nfunction coord(r: Region, bp: number) {\n  return Math.floor(r.reversed ? r.end - bp : r.start + bp) + 1\n}\n\n// manual return type since getSnapshot hard to infer here\nexport function pxToBp(\n  self: ViewSnap,\n  px: number,\n): {\n  coord: number\n  index: number\n  refName: string\n  oob: boolean\n  assemblyName: string\n  offset: number\n  start: number\n  end: number\n  reversed: boolean\n} {\n  let bpSoFar = 0\n  const {\n    bpPerPx,\n    offsetPx,\n    displayedRegions,\n    interRegionPaddingWidth,\n    staticBlocks,\n  } = self\n  const blocks = staticBlocks.contentBlocks\n  const bp = (offsetPx + px) * bpPerPx\n  if (bp < 0) {\n    const r = displayedRegions[0]\n    const snap = getSnapshot(r)\n    // @ts-expect-error\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(snap as Omit<typeof snap, symbol>),\n      oob: true,\n      coord: coord(r, bp),\n      offset: bp,\n      index: 0,\n    }\n  }\n\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  let currBlock = 0\n  for (let i = 0; i < displayedRegions.length; i++) {\n    const r = displayedRegions[i]\n    const len = r.end - r.start\n    const offset = bp - bpSoFar\n    if (len + bpSoFar > bp && bpSoFar <= bp) {\n      const snap = getSnapshot(r)\n      // @ts-expect-error\n      return {\n        // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n        ...(snap as Omit<typeof snap, symbol>),\n        oob: false,\n        offset,\n        coord: coord(r, offset),\n        index: i,\n      }\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n\n  if (bp >= bpSoFar && displayedRegions.length > 0) {\n    const r = displayedRegions.at(-1)!\n    const len = r.end - r.start\n    const offset = bp - bpSoFar + len\n\n    const snap = getSnapshot(r)\n    // @ts-expect-error\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(snap as Omit<typeof snap, symbol>),\n      oob: true,\n      offset,\n      coord: coord(r, offset),\n      index: displayedRegions.length - 1,\n    }\n  }\n  return {\n    coord: 0,\n    index: 0,\n    refName: '',\n    oob: true,\n    assemblyName: '',\n    offset: 0,\n    start: 0,\n    end: 0,\n    reversed: false,\n  }\n}\n\nexport function bpToPx({\n  refName,\n  coord,\n  regionNumber,\n  self,\n}: {\n  refName: string\n  coord: number\n  regionNumber?: number\n  self: ViewSnap\n}) {\n  let bpSoFar = 0\n\n  const { interRegionPaddingWidth, bpPerPx, displayedRegions, staticBlocks } =\n    self\n  const blocks = staticBlocks.contentBlocks\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  let currBlock = 0\n\n  let i = 0\n  for (; i < displayedRegions.length; i++) {\n    const r = displayedRegions[i]\n    const len = r.end - r.start\n    if (\n      refName === r.refName &&\n      coord >= r.start &&\n      coord <= r.end &&\n      (regionNumber ? regionNumber === i : true)\n    ) {\n      bpSoFar += r.reversed ? r.end - coord : coord - r.start\n      break\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n  const found = displayedRegions[i]\n  if (found) {\n    return {\n      index: i,\n      offsetPx: Math.round(bpSoFar / bpPerPx),\n    }\n  }\n\n  return undefined\n}\n\nexport function bpToPxMap({\n  refName,\n  coord,\n  regionNumber,\n  self,\n}: {\n  refName: string\n  coord: number\n  regionNumber?: number\n  self: ViewSnap\n}) {\n  let bpSoFar = 0\n\n  const { interRegionPaddingWidth, bpPerPx, displayedRegions, staticBlocks } =\n    self\n  const blocks = staticBlocks.contentBlocks\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  const map = {}\n  let currBlock = 0\n\n  let i = 0\n  for (; i < displayedRegions.length; i++) {\n    const r = displayedRegions[i]\n    const len = r.end - r.start\n    if (\n      refName === r.refName &&\n      coord >= r.start &&\n      coord <= r.end &&\n      (regionNumber === undefined ? true : regionNumber === i)\n    ) {\n      bpSoFar += r.reversed ? r.end - coord : coord - r.start\n      break\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n  const found = displayedRegions[i]\n  if (found) {\n    return {\n      index: i,\n      offsetPx: Math.round(bpSoFar / bpPerPx),\n    }\n  }\n\n  return map\n}\n","import { types, cast, Instance } from 'mobx-state-tree'\nimport { clamp } from './index'\nimport { Feature } from './simpleFeature'\nimport { Region, ElementId } from './types/mst'\nimport { Region as IRegion } from './types'\nimport calculateDynamicBlocks from './calculateDynamicBlocks'\nimport calculateStaticBlocks from './calculateStaticBlocks'\nimport { moveTo, pxToBp, bpToPx, BpOffset } from './Base1DUtils'\n\n/**\n * #stateModel Base1DView\n * used in non-lgv view representations of a 1d view e.g. the two axes of the\n * dotplot use this\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Base1DView = types\n  .model('Base1DView', {\n    /**\n     * #property\n     */\n    id: ElementId,\n    /**\n     * #property\n     */\n    displayedRegions: types.array(Region),\n    /**\n     * #property\n     */\n    bpPerPx: 0,\n    /**\n     * #property\n     */\n    offsetPx: 0,\n    /**\n     * #property\n     */\n    interRegionPaddingWidth: types.optional(types.number, 0),\n    /**\n     * #property\n     */\n    minimumBlockWidth: types.optional(types.number, 0),\n  })\n  .volatile(() => ({\n    features: undefined as undefined | Feature[],\n    volatileWidth: 0,\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setDisplayedRegions(regions: IRegion[]) {\n      self.displayedRegions = cast(regions)\n    },\n    /**\n     * #action\n     */\n    setBpPerPx(val: number) {\n      self.bpPerPx = val\n    },\n    /**\n     * #action\n     */\n    setVolatileWidth(width: number) {\n      self.volatileWidth = width\n    },\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get width() {\n      return self.volatileWidth\n    },\n    /**\n     * #getter\n     */\n    get assemblyNames() {\n      return [\n        ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n      ]\n    },\n    /**\n     * #getter\n     */\n    get displayedRegionsTotalPx() {\n      return this.totalBp / self.bpPerPx\n    },\n\n    /**\n     * #getter\n     */\n    get maxOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const leftPadding = 10\n      return this.displayedRegionsTotalPx - leftPadding\n    },\n\n    /**\n     * #getter\n     */\n    get minOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const rightPadding = 30\n      return -this.width + rightPadding\n    },\n\n    /**\n     * #getter\n     */\n    get totalBp() {\n      return self.displayedRegions\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get dynamicBlocks() {\n      return calculateDynamicBlocks(self)\n    },\n\n    /**\n     * #getter\n     */\n    get staticBlocks() {\n      return calculateStaticBlocks(self)\n    },\n\n    /**\n     * #getter\n     */\n    get currBp() {\n      return this.dynamicBlocks\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     */\n    pxToBp(px: number) {\n      return pxToBp(self, px)\n    },\n\n    /**\n     * #method\n     */\n    bpToPx({\n      refName,\n      coord,\n      regionNumber,\n    }: {\n      refName: string\n      coord: number\n      regionNumber?: number\n    }) {\n      return bpToPx({ refName, coord, regionNumber, self })?.offsetPx\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setFeatures(features: Feature[]) {\n      self.features = features\n    },\n\n    /**\n     * #action\n     * this makes a zoomed out view that shows all displayedRegions that makes\n     * the overview bar square with the scale bar\n     */\n    showAllRegions() {\n      self.bpPerPx = self.totalBp / self.width\n      self.offsetPx = 0\n    },\n\n    /**\n     * #action\n     */\n    zoomOut() {\n      this.zoomTo(self.bpPerPx * 2)\n    },\n\n    /**\n     * #action\n     */\n    zoomIn() {\n      this.zoomTo(self.bpPerPx / 2)\n    },\n\n    /**\n     * #action\n     */\n    zoomTo(bpPerPx: number, offset = self.width / 2) {\n      const newBpPerPx = clamp(\n        bpPerPx,\n        'minBpPerPx' in self ? (self.minBpPerPx as number) : 0,\n        'maxBpPerPx' in self ? (self.maxBpPerPx as number) : Infinity,\n      )\n\n      const oldBpPerPx = self.bpPerPx\n      if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n        return oldBpPerPx\n      }\n\n      self.bpPerPx = newBpPerPx\n\n      // tweak the offset so that the center of the view remains at the same\n      // coordinate\n      self.offsetPx = clamp(\n        Math.round(\n          ((self.offsetPx + offset) * oldBpPerPx) / newBpPerPx - offset,\n        ),\n        self.minOffset,\n        self.maxOffset,\n      )\n      return self.bpPerPx\n    },\n\n    /**\n     * #action\n     */\n    scrollTo(offsetPx: number) {\n      const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n      self.offsetPx = newOffsetPx\n      return newOffsetPx\n    },\n    /**\n     * #action\n     */\n    centerAt(coord: number, refName: string | undefined, regionNumber: number) {\n      if (!refName) {\n        return\n      }\n      const centerPx = self.bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      })\n      if (centerPx) {\n        this.scrollTo(Math.round(centerPx - self.width / 2))\n      }\n    },\n\n    /**\n     * #action\n     * note: the scroll is clamped to keep the view on the main screen\n     */\n    scroll(distance: number) {\n      const oldOffsetPx = self.offsetPx\n      const newOffsetPx = clamp(\n        self.offsetPx + distance,\n        self.minOffset,\n        self.maxOffset,\n      )\n      self.offsetPx = newOffsetPx\n      return newOffsetPx - oldOffsetPx\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * offset is the base-pair-offset in the displayed region, index is the index of the\n     * displayed region in the linear genome view\n     *\n     * @param start - object as `{start, end, offset, index}`\n     * @param end - object as `{start, end, offset, index}`\n     */\n    moveTo(start?: BpOffset, end?: BpOffset) {\n      moveTo(self, start, end)\n    },\n  }))\n\nexport type Base1DViewStateModel = typeof Base1DView\nexport type Base1DViewModel = Instance<Base1DViewStateModel>\n\nexport default Base1DView\n","import { Observable, fromEvent } from 'rxjs'\n\nclass AbortError extends Error {\n  public code: string | undefined\n}\n\n/**\n * properly check if the given AbortSignal is aborted.\n * per the standard, if the signal reads as aborted,\n * this function throws either a DOMException AbortError, or a regular error\n * with a `code` attribute set to `ERR_ABORTED`.\n *\n * for convenience, passing `undefined` is a no-op\n *\n * @param signal -\n * @returns nothing\n */\nexport function checkAbortSignal(signal?: AbortSignal): void {\n  if (!signal) {\n    return\n  }\n\n  if (!(signal instanceof AbortSignal)) {\n    throw new TypeError('must pass an AbortSignal')\n  }\n\n  if (signal.aborted) {\n    throw makeAbortError()\n  }\n}\n\nfunction timeout(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n/**\n * Skips to the next tick, then runs `checkAbortSignal`.\n * Await this to inside an otherwise synchronous loop to\n * provide a place to break when an abort signal is received.\n */\nexport async function abortBreakPoint(signal?: AbortSignal) {\n  // it was observed that an actual timeout is needed to get the aborting (wrap\n  // hicrenderer in a try catch, console.error the error, and rethrow the error\n  // to see). using await Promise.resolve() did not appear to allow aborting to\n  // occur\n  await timeout(1)\n  checkAbortSignal(signal)\n}\n\nexport function makeAbortError() {\n  if (typeof DOMException !== 'undefined') {\n    return new DOMException('aborted', 'AbortError')\n  }\n  const e = new AbortError('aborted')\n  e.code = 'ERR_ABORTED'\n  return e\n}\n\nexport function observeAbortSignal(signal?: AbortSignal): Observable<Event> {\n  if (!signal) {\n    return Observable.create()\n  }\n  return fromEvent(signal, 'abort')\n}\n\n/**\n * check if the given exception was caused by an operation being intentionally aborted\n * @param exception -\n */\nexport function isAbortException(exception: unknown): boolean {\n  return (\n    exception instanceof Error &&\n    // DOMException\n    (exception.name === 'AbortError' ||\n      // standard-ish non-DOM abort exception\n      (exception as AbortError).code === 'ERR_ABORTED' ||\n      // message contains aborted for bubbling through RPC\n      // things we have seen that we want to catch here\n      // Error: aborted\n      // AbortError: aborted\n      // AbortError: The user aborted a request.\n      !!/\\b(aborted|aborterror)\\b/i.test(exception.message))\n  )\n}\n","export function blobToDataURL(blob: Blob): Promise<string> {\n  const a = new FileReader()\n  return new Promise((resolve, reject) => {\n    a.onload = e => {\n      if (e.target) {\n        resolve(e.target.result as string)\n      } else {\n        reject(new Error('unknown result reading blob from canvas'))\n      }\n    }\n    a.readAsDataURL(blob)\n  })\n}\n","import { sum } from '.'\n\ntype Func<T> = (value: BaseBlock, index: number, array: BaseBlock[]) => T\n\nexport class BlockSet {\n  constructor(public blocks: BaseBlock[] = []) {}\n\n  push(block: BaseBlock) {\n    if (block.type === 'ElidedBlock' && this.blocks.length > 0) {\n      const lastBlock = this.blocks.at(-1)\n      if (lastBlock?.type === 'ElidedBlock') {\n        ;(lastBlock as ElidedBlock).push(block as ElidedBlock)\n        return\n      }\n    }\n\n    this.blocks.push(block)\n  }\n\n  getBlocks() {\n    return this.blocks\n  }\n\n  getRegions() {\n    return this.blocks.map(block => block.toRegion())\n  }\n\n  map<T, U = this>(func: Func<T>, thisarg?: U) {\n    // eslint-disable-next-line unicorn/no-array-method-this-argument\n    return this.blocks.map(func, thisarg)\n  }\n\n  forEach<T, U = this>(func: Func<T>, thisarg?: U) {\n    // eslint-disable-next-line unicorn/no-array-method-this-argument\n    return this.blocks.forEach(func, thisarg)\n  }\n\n  get length() {\n    return this.blocks.length\n  }\n\n  get totalWidthPx() {\n    return this.blocks.length > 0\n      ? sum(this.blocks.map(blocks => blocks.widthPx))\n      : 0\n  }\n\n  get totalWidthPxWithoutBorders() {\n    return this.blocks.length > 0\n      ? sum(\n          this.blocks\n            .filter(block => block.variant !== 'boundary')\n            .map(blocks => blocks.widthPx),\n        )\n      : 0\n  }\n\n  get offsetPx() {\n    return this.blocks.length > 0 ? this.blocks[0].offsetPx : 0\n  }\n\n  get contentBlocks() {\n    return this.blocks.filter(block => block.type === 'ContentBlock')\n  }\n\n  get totalBp() {\n    return sum(this.contentBlocks.map(block => block.end - block.start))\n  }\n}\n\nexport class BaseBlock {\n  type = 'BaseBlock'\n\n  public regionNumber?: number\n\n  public reversed?: boolean\n\n  public refName: string\n\n  public start: number\n\n  public end: number\n\n  public assemblyName: string\n\n  public key: string\n\n  public offsetPx: number\n\n  public widthPx = 0\n\n  public variant?: string\n\n  public isLeftEndOfDisplayedRegion?: boolean\n\n  /**\n   * a block that should be shown as filled with data\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: Record<string, any>) {\n    Object.assign(this, data)\n    this.assemblyName = data.assemblyName\n    this.refName = data.refName\n    this.start = data.start\n    this.end = data.end\n    this.key = data.key\n    this.offsetPx = data.offsetPx\n  }\n\n  toRegion() {\n    return {\n      refName: this.refName,\n      start: this.start,\n      end: this.end,\n      assemblyName: this.assemblyName,\n      reversed: this.reversed,\n    }\n  }\n}\n\nexport class ContentBlock extends BaseBlock {\n  type = 'ContentBlock'\n}\n\n/**\n * marker block representing one or more blocks that are\n * too small to be shown at the current zoom level\n */\nexport class ElidedBlock extends BaseBlock {\n  type = 'ElidedBlock'\n\n  public widthPx: number\n\n  public elidedBlockCount = 0\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: Record<string, any>) {\n    super(data)\n    this.widthPx = data.widthPx\n  }\n\n  push(otherBlock: ElidedBlock) {\n    this.elidedBlockCount += 1\n\n    if (otherBlock) {\n      this.refName = ''\n      this.start = 0\n      this.end = 0\n      this.widthPx += otherBlock.widthPx\n    }\n  }\n}\n\n/**\n * marker block that sits between two different displayed regions\n * and provides a thick border between them\n */\nexport class InterRegionPaddingBlock extends BaseBlock {\n  type = 'InterRegionPaddingBlock'\n}\n","import { isStateTreeNode, getSnapshot } from 'mobx-state-tree'\nimport { intersection2 } from './range'\nimport { assembleLocStringFast } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Base1DViewModel } from './calculateStaticBlocks'\n\n/**\n * returns a BlockSet of which the `blocks` attribute is an array of 'dynamic\n * blocks', which are blocks representing only the regions that are visible in\n * the view right now. these are mostly used by tracks for which static blocks\n * are not feasible.\n *\n * each block is a plain JS object like:\n *   `{ refName, start, end, offsetPx, reversed? }`\n *\n * start and end are in bp, and start is always less than end, but if reversed\n * is true, startBp will be on the right side of the visible region.\n *\n * offsetPx is the number of pixels from the left edge of the view to the left\n * edge of the region\n *\n * NOTE: start, end, and offsetPx may all be fractional!\n *\n * @returns BlockSet of `{ refName, startBp, end, offset, reversed? }`\n */\nexport default function calculateDynamicBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    width,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  if (!width) {\n    throw new Error('view has no width, cannot calculate displayed blocks')\n  }\n  const blocks = new BlockSet()\n  let displayedRegionLeftPx = 0\n  const windowLeftPx = offsetPx\n  const windowRightPx = windowLeftPx + width\n  for (\n    let regionNumber = 0;\n    regionNumber < displayedRegions.length;\n    regionNumber++\n  ) {\n    const region = displayedRegions[regionNumber]\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const displayedRegionRightPx =\n      displayedRegionLeftPx + (regionEnd - regionStart) / bpPerPx\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n    const parentRegion = isStateTreeNode(region) ? getSnapshot(region) : region\n\n    const [leftPx, rightPx] = intersection2(\n      windowLeftPx,\n      windowRightPx,\n      displayedRegionLeftPx,\n      displayedRegionRightPx,\n    )\n    if (leftPx !== undefined && rightPx !== undefined) {\n      // this displayed region overlaps the view, so make a record for it\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      let blockOffsetPx: number\n      if (reversed) {\n        start = Math.max(\n          regionStart,\n          regionEnd - (rightPx - displayedRegionLeftPx) * bpPerPx,\n        )\n        end = regionEnd - (leftPx - displayedRegionLeftPx) * bpPerPx\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n        blockOffsetPx = displayedRegionLeftPx + (regionEnd - end) / bpPerPx\n      } else {\n        start = (leftPx - displayedRegionLeftPx) * bpPerPx + regionStart\n        end = Math.min(\n          regionEnd,\n          (rightPx - displayedRegionLeftPx) * bpPerPx + regionStart,\n        )\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n        blockOffsetPx = displayedRegionLeftPx + (start - regionStart) / bpPerPx\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: blockOffsetPx,\n        parentRegion,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocStringFast(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && blocks.length === 0 && isLeftEndOfDisplayedRegion) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: -offsetPx,\n            offsetPx: blockData.offsetPx + offsetPx,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n          displayedRegionLeftPx += interRegionPaddingWidth\n        }\n\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          blockOffsetPx = blockData.offsetPx + blockData.widthPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width - blockOffsetPx + offsetPx,\n              offsetPx: blockOffsetPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    displayedRegionLeftPx += (regionEnd - regionStart) / bpPerPx\n  }\n  return blocks\n}\n","import { isStateTreeNode, getSnapshot, Instance } from 'mobx-state-tree'\nimport { assembleLocStringFast } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Region } from './types'\nimport { Region as RegionModel } from './types/mst'\n\nexport interface Base1DViewModel {\n  offsetPx: number\n  width: number\n  displayedRegions: (Region | Instance<typeof RegionModel>)[]\n  bpPerPx: number\n  minimumBlockWidth: number\n  interRegionPaddingWidth: number\n}\n\nexport default function calculateStaticBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n  extra = 0,\n  width = 800,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n    width: modelWidth,\n  } = model\n\n  const windowLeftBp = offsetPx * bpPerPx\n  const windowRightBp = (offsetPx + modelWidth) * bpPerPx\n  const blockSizePx = width\n  const blockSizeBp = Math.ceil(blockSizePx * bpPerPx)\n  // for each displayed region\n  let regionBpOffset = 0\n  const blocks = new BlockSet()\n  for (\n    let regionNumber = 0;\n    regionNumber < displayedRegions.length;\n    regionNumber++\n  ) {\n    const region = displayedRegions[regionNumber]\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n\n    const regionBlockCount = Math.ceil((regionEnd - regionStart) / blockSizeBp)\n    const parentRegion = isStateTreeNode(region) ? getSnapshot(region) : region\n\n    let windowRightBlockNum =\n      Math.floor((windowRightBp - regionBpOffset) / blockSizeBp) + extra\n    if (windowRightBlockNum >= regionBlockCount) {\n      windowRightBlockNum = regionBlockCount - 1\n    }\n\n    let windowLeftBlockNum =\n      Math.floor((windowLeftBp - regionBpOffset) / blockSizeBp) - extra\n    if (windowLeftBlockNum < 0) {\n      windowLeftBlockNum = 0\n    }\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    for (\n      let blockNum = windowLeftBlockNum;\n      blockNum <= windowRightBlockNum;\n      blockNum += 1\n    ) {\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      if (reversed) {\n        start = Math.max(regionStart, regionEnd - (blockNum + 1) * blockSizeBp)\n        end = regionEnd - blockNum * blockSizeBp\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n      } else {\n        start = regionStart + blockNum * blockSizeBp\n        end = Math.min(regionEnd, regionStart + (blockNum + 1) * blockSizeBp)\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: (regionBpOffset + blockNum * blockSizeBp) / bpPerPx,\n        parentRegion,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocStringFast(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && regionNumber === 0 && blockNum === 0) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: width,\n            offsetPx: blockData.offsetPx - width,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n        }\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    regionBpOffset += regionEnd - regionStart\n  }\n  return blocks\n}\n","// from https://www.w3.org/TR/css-color-4/#named-colors\n\nconst colors: Record<string, string> = {\n  aliceblue: '#F0F8FF',\n  antiquewhite: '#FAEBD7',\n  aqua: '#00FFFF',\n  aquamarine: '#7FFFD4',\n  azure: '#F0FFFF',\n  beige: '#F5F5DC',\n  bisque: '#FFE4C4',\n  black: '#000000',\n  blanchedalmond: '#FFEBCD',\n  blue: '#0000FF',\n  blueviolet: '#8A2BE2',\n  brown: '#A52A2A',\n  burlywood: '#DEB887',\n  cadetblue: '#5F9EA0',\n  chartreuse: '#7FFF00',\n  chocolate: '#D2691E',\n  coral: '#FF7F50',\n  cornflowerblue: '#6495ED',\n  cornsilk: '#FFF8DC',\n  crimson: '#DC143C',\n  cyan: '#00FFFF',\n  darkblue: '#00008B',\n  darkcyan: '#008B8B',\n  darkgoldenrod: '#B8860B',\n  darkgray: '#A9A9A9',\n  darkgreen: '#006400',\n  darkgrey: '#A9A9A9',\n  darkkhaki: '#BDB76B',\n  darkmagenta: '#8B008B',\n  darkolivegreen: '#556B2F',\n  darkorange: '#FF8C00',\n  darkorchid: '#9932CC',\n  darkred: '#8B0000',\n  darksalmon: '#E9967A',\n  darkseagreen: '#8FBC8F',\n  darkslateblue: '#483D8B',\n  darkslategray: '#2F4F4F',\n  darkslategrey: '#2F4F4F',\n  darkturquoise: '#00CED1',\n  darkviolet: '#9400D3',\n  deeppink: '#FF1493',\n  deepskyblue: '#00BFFF',\n  dimgray: '#696969',\n  dimgrey: '#696969',\n  dodgerblue: '#1E90FF',\n  firebrick: '#B22222',\n  floralwhite: '#FFFAF0',\n  forestgreen: '#228B22',\n  fuchsia: '#FF00FF',\n  gainsboro: '#DCDCDC',\n  ghostwhite: '#F8F8FF',\n  gold: '#FFD700',\n  goldenrod: '#DAA520',\n  gray: '#808080',\n  green: '#008000',\n  greenyellow: '#ADFF2F',\n  grey: '#808080',\n  honeydew: '#F0FFF0',\n  hotpink: '#FF69B4',\n  indianred: '#CD5C5C',\n  indigo: '#4B0082',\n  ivory: '#FFFFF0',\n  khaki: '#F0E68C',\n  lavender: '#E6E6FA',\n  lavenderblush: '#FFF0F5',\n  lawngreen: '#7CFC00',\n  lemonchiffon: '#FFFACD',\n  lightblue: '#ADD8E6',\n  lightcoral: '#F08080',\n  lightcyan: '#E0FFFF',\n  lightgoldenrodyellow: '#FAFAD2',\n  lightgray: '#D3D3D3',\n  lightgreen: '#90EE90',\n  lightgrey: '#D3D3D3',\n  lightpink: '#FFB6C1',\n  lightsalmon: '#FFA07A',\n  lightseagreen: '#20B2AA',\n  lightskyblue: '#87CEFA',\n  lightslategray: '#778899',\n  lightslategrey: '#778899',\n  lightsteelblue: '#B0C4DE',\n  lightyellow: '#FFFFE0',\n  lime: '#00FF00',\n  limegreen: '#32CD32',\n  linen: '#FAF0E6',\n  magenta: '#FF00FF',\n  maroon: '#800000',\n  mediumaquamarine: '#66CDAA',\n  mediumblue: '#0000CD',\n  mediumorchid: '#BA55D3',\n  mediumpurple: '#9370DB',\n  mediumseagreen: '#3CB371',\n  mediumslateblue: '#7B68EE',\n  mediumspringgreen: '#00FA9A',\n  mediumturquoise: '#48D1CC',\n  mediumvioletred: '#C71585',\n  midnightblue: '#191970',\n  mintcream: '#F5FFFA',\n  mistyrose: '#FFE4E1',\n  moccasin: '#FFE4B5',\n  navajowhite: '#FFDEAD',\n  navy: '#000080',\n  oldlace: '#FDF5E6',\n  olive: '#808000',\n  olivedrab: '#6B8E23',\n  orange: '#FFA500',\n  orangered: '#FF4500',\n  orchid: '#DA70D6',\n  palegoldenrod: '#EEE8AA',\n  palegreen: '#98FB98',\n  paleturquoise: '#AFEEEE',\n  palevioletred: '#DB7093',\n  papayawhip: '#FFEFD5',\n  peachpuff: '#FFDAB9',\n  peru: '#CD853F',\n  pink: '#FFC0CB',\n  plum: '#DDA0DD',\n  powderblue: '#B0E0E6',\n  purple: '#800080',\n  rebeccapurple: '#663399',\n  red: '#FF0000',\n  rosybrown: '#BC8F8F',\n  royalblue: '#4169E1',\n  saddlebrown: '#8B4513',\n  salmon: '#FA8072',\n  sandybrown: '#F4A460',\n  seagreen: '#2E8B57',\n  seashell: '#FFF5EE',\n  sienna: '#A0522D',\n  silver: '#C0C0C0',\n  skyblue: '#87CEEB',\n  slateblue: '#6A5ACD',\n  slategray: '#708090',\n  slategrey: '#708090',\n  snow: '#FFFAFA',\n  springgreen: '#00FF7F',\n  steelblue: '#4682B4',\n  tan: '#D2B48C',\n  teal: '#008080',\n  thistle: '#D8BFD8',\n  tomato: '#FF6347',\n  turquoise: '#40E0D0',\n  violet: '#EE82EE',\n  wheat: '#F5DEB3',\n  white: '#FFFFFF',\n  whitesmoke: '#F5F5F5',\n  yellow: '#FFFF00',\n  yellowgreen: '#9ACD32',\n}\n\nexport function namedColorToHex(name: string): string | undefined {\n  return colors[name]\n}\n\nexport function isNamedColor(name: string): boolean {\n  return !!colors[name]\n}\n","import {\n  darken,\n  emphasize as muiEmphasize,\n  getContrastRatio,\n  getLuminance as muiGetLuminance,\n  lighten,\n} from '@mui/material/styles'\nimport { namedColorToHex } from './cssColorsLevel4'\n\n/**\n * Algorithmically pick a contrasting text color that will\n * be visible on top of the given background color. Either\n * black or white.\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns 'black' or 'white'\n */\nexport function contrastingTextColor(color: string): string {\n  const luminance = getLuminance(color)\n  return luminance > 0.5 ? 'black' : 'white'\n}\n\n/**\n * The relative brightness of any point in a color space,\n * normalized to 0 for darkest black and 1 for lightest white.\n * Uses MUI's `getLuminance`, but adds support for named colors\n *\n * Formula: https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns The relative brightness of the color in the range 0 - 1\n */\nfunction getLuminance(color: string): number {\n  const convertedColor = namedColorToHex(color)\n  return muiGetLuminance(convertedColor || color)\n}\n\n/**\n * Darken or lighten a color, depending on its luminance.\n * Light colors are darkened, dark colors are lightened.\n * Uses MUI's `emphasize`, but adds support for named colors\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n * hsl(), hsla(), or named color\n * @param coefficient - multiplier in the range 0 - 1, defaults to 0.15\n * @returns A CSS color string. Hex input values are returned as rgb\n */\nexport function emphasize(color: string, coefficient = 0.15): string {\n  const convertedColor = namedColorToHex(color)\n  return muiEmphasize(convertedColor || color, coefficient)\n}\n\nexport function makeContrasting(\n  foreground: string,\n  background = 'white',\n  minContrastRatio = 3,\n) {\n  let convertedForeground = namedColorToHex(foreground) || foreground\n  const convertedBackground = namedColorToHex(background) || background\n  const backgroundLuminance = getLuminance(convertedBackground)\n  let contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  const originalColor = convertedForeground\n  let coefficient = 0.05\n  while (contrastRatio < minContrastRatio) {\n    convertedForeground =\n      backgroundLuminance > 0.5\n        ? darken(originalColor, coefficient)\n        : lighten(originalColor, coefficient)\n    coefficient += 0.05\n    contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  }\n  return convertedForeground\n}\n\nexport { isNamedColor, namedColorToHex } from './cssColorsLevel4'\n","import { extend } from 'colord'\nimport mix from 'colord/plugins/mix'\nimport names from 'colord/plugins/names'\nextend([mix, names])\n\nexport { Colord, colord } from 'colord'\n","type Hasher<T> = (input: T) => string\n\n// from https://github.com/seriousManual/dedupe/blob/master/LICENSE\nexport function dedupe<T>(list: T[], hasher: Hasher<T> = JSON.stringify) {\n  const clone: T[] = []\n  const lookup = new Set<string>()\n\n  for (const entry of list) {\n    const hashed = hasher(entry)\n\n    if (!lookup.has(hashed)) {\n      clone.push(entry)\n      lookup.add(hashed)\n    }\n  }\n\n  return clone\n}\n","import { hashCode } from './'\n\n// generates a short \"id fingerprint\" from the config passed to the base\n// feature adapter by recursively enumerating props, but if config is too big\n// does not process entire config (FromConfigAdapter for example can be large)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default function idMaker(args: any, id = '') {\n  const keys = Object.keys(args)\n  for (const key of keys) {\n    if (id.length > 5000) {\n      break\n    }\n    id +=\n      typeof args[key] === 'object' && args[key]\n        ? idMaker(args[key], id)\n        : `${key}-${args[key]};`\n  }\n  return hashCode(id)\n}\n","import { HttpRangeFetcher } from 'http-range-fetcher'\nimport { Buffer } from 'buffer'\nimport { RemoteFile, PolyfilledResponse } from 'generic-filehandle'\n\ntype BinaryRangeFetch = (\n  url: string,\n  start: number,\n  end: number,\n  options?: { headers?: HeadersInit; signal?: AbortSignal },\n) => Promise<BinaryRangeResponse>\n\nexport interface BinaryRangeResponse {\n  headers: Record<string, string>\n  requestDate: Date\n  responseDate: Date\n  buffer: Buffer\n}\n\nconst fetchers: Record<string, BinaryRangeFetch> = {}\n\nfunction binaryRangeFetch(\n  url: string,\n  start: number,\n  end: number,\n  options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n): Promise<BinaryRangeResponse> {\n  const fetcher = fetchers[url]\n  if (!fetcher) {\n    throw new Error(`fetch not registered for ${url}`)\n  }\n  return fetcher(url, start, end, options)\n}\n\nconst globalRangeCache = new HttpRangeFetcher({\n  fetch: binaryRangeFetch,\n  size: 500 * 1024 ** 2, // 500MiB\n  chunkSize: 128 * 1024, // 128KiB\n  maxFetchSize: 100 * 1024 ** 2, // 100MiB\n  minimumTTL: 24 * 60 * 60 * 1000, // 1 day\n})\n\nexport function clearCache() {\n  globalRangeCache.reset()\n}\n\nexport class RemoteFileWithRangeCache extends RemoteFile {\n  public async fetch(\n    url: RequestInfo,\n    init?: RequestInit,\n  ): Promise<PolyfilledResponse> {\n    const str = String(url)\n    if (!fetchers[str]) {\n      fetchers[str] = this.fetchBinaryRange.bind(this)\n    }\n    // if it is a range request, route it through the range cache\n    const range = new Headers(init?.headers)?.get('range')\n    if (range) {\n      const rangeParse = /bytes=(\\d+)-(\\d+)/.exec(range)\n      if (rangeParse) {\n        const [, start, end] = rangeParse\n        const s = Number.parseInt(start, 10)\n        const e = Number.parseInt(end, 10)\n        const len = e - s\n        const { buffer, headers } = (await globalRangeCache.getRange(\n          url,\n          s,\n          len + 1,\n          { signal: init?.signal },\n        )) as BinaryRangeResponse\n        return new Response(buffer, { status: 206, headers })\n      }\n    }\n    return super.fetch(url, init)\n  }\n\n  public async fetchBinaryRange(\n    url: string,\n    start: number,\n    end: number,\n    options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n  ): Promise<BinaryRangeResponse> {\n    const requestDate = new Date()\n    const res = await super.fetch(url, {\n      ...options,\n      headers: {\n        ...options.headers,\n        range: `bytes=${start}-${end}`,\n      },\n    })\n    const responseDate = new Date()\n    if (!res.ok) {\n      const errorMessage = `HTTP ${res.status} fetching ${url} bytes ${start}-${end}`\n      const hint = ' (should be 206 for range requests)'\n      throw new Error(`${errorMessage}${res.status === 200 ? hint : ''}`)\n    }\n\n    // translate the Headers object into a regular key -> value object.\n    // will miss duplicate headers of course\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const headers: Record<string, any> = {}\n    for (const [k, v] of res.headers.entries()) {\n      headers[k] = v\n    }\n\n    // return the response headers, and the data buffer\n    const arrayBuffer = await res.arrayBuffer()\n    return {\n      headers,\n      requestDate,\n      responseDate,\n      buffer: Buffer.from(arrayBuffer),\n    }\n  }\n}\n","import {\n  BlobFile,\n  GenericFilehandle,\n  LocalFile,\n  Fetcher,\n} from 'generic-filehandle'\nimport isNode from 'detect-node'\n\n// locals\nimport { RemoteFileWithRangeCache } from './RemoteFileWithRangeCache'\nimport {\n  FileLocation,\n  LocalPathLocation,\n  BlobLocation,\n  isRootModelWithInternetAccounts,\n  isUriLocation,\n  AuthNeededError,\n  UriLocation,\n} from '../types'\nimport { BaseInternetAccountModel } from '../../pluggableElementTypes/models'\nimport { getBlob } from '../tracks'\nimport PluginManager from '../../PluginManager'\nimport { isElectron } from '../'\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\n/** if a UriLocation has a baseUri, resolves its uri with respect to that base */\nexport function resolveUriLocation(location: UriLocation) {\n  return location.baseUri\n    ? { ...location, uri: new URL(location.uri, location.baseUri).href }\n    : location\n}\n\nexport function openLocation(\n  location: FileLocation,\n  pluginManager?: PluginManager,\n): GenericFilehandle {\n  if (!location) {\n    throw new Error('must provide a location to openLocation')\n  }\n  if (isLocalPathLocation(location)) {\n    if (!location.localPath) {\n      throw new Error('No local path provided')\n    }\n\n    if (isNode || isElectron) {\n      return new LocalFile(location.localPath)\n    } else {\n      throw new Error(\"can't use local files in the browser\")\n    }\n  }\n  if (isBlobLocation(location)) {\n    // special case where blob is not directly stored on the model, use a getter\n    const blob = getBlob(location.blobId)\n    if (!blob) {\n      throw new Error(\n        `file (\"${location.name}\") was opened locally from a previous session. To restore it, go to track settings and reopen the file`,\n      )\n    }\n    return new BlobFile(blob)\n  }\n  if (isUriLocation(location)) {\n    // Check for empty string\n    if (!location.uri) {\n      throw new Error('No URI provided')\n    }\n\n    // Resolve any relative URLs to absolute URLs\n    const absoluteLocation = resolveUriLocation(location)\n\n    // If there is a plugin manager, we can try internet accounts\n    if (pluginManager) {\n      const internetAccount = getInternetAccount(location, pluginManager)\n      // If an internetAccount was found, use it to open the location\n      if (internetAccount) {\n        return internetAccount.openLocation(absoluteLocation)\n      }\n    }\n    // Otherwise fall back on usual open\n    return new RemoteFileWithRangeCache(absoluteLocation.uri, {\n      fetch: checkAuthNeededFetch,\n    })\n  }\n  throw new Error('invalid fileLocation')\n}\n\nexport function getFetcher(\n  location: FileLocation,\n  pluginManager?: PluginManager,\n): Fetcher {\n  if (!isUriLocation(location)) {\n    throw new Error(`Not a valid UriLocation: ${JSON.stringify(location)}`)\n  }\n  if (pluginManager) {\n    const internetAccount = getInternetAccount(location, pluginManager)\n    if (internetAccount) {\n      return internetAccount.getFetcher(location)\n    }\n  }\n  return checkAuthNeededFetch\n}\n\nfunction getInternetAccount(\n  location: UriLocation,\n  pluginManager: PluginManager,\n): BaseInternetAccountModel | undefined {\n  const { rootModel } = pluginManager\n  // If there is an appRootModel, use it to find the internetAccount\n  if (rootModel && isRootModelWithInternetAccounts(rootModel)) {\n    return rootModel.findAppropriateInternetAccount(location)\n  }\n  // If there is no appRootModel, but there is pre-auth, create a temporary\n  // internetAccount. This is typical in a worker.\n  if (location.internetAccountPreAuthorization) {\n    if (!location.internetAccountPreAuthorization.authInfo.token) {\n      throw new Error(\n        'Failed to obtain token from internet account. Try reloading the page',\n      )\n    }\n    const internetAccountType = pluginManager.getInternetAccountType(\n      location.internetAccountPreAuthorization.internetAccountType,\n    )\n    return internetAccountType.stateModel.create({\n      type: location.internetAccountPreAuthorization.internetAccountType,\n      configuration:\n        location.internetAccountPreAuthorization.authInfo.configuration,\n    })\n  }\n  return undefined\n}\n\n// This fetch throws a special error if the response is \"401\" and includes a\n// \"WWW-Authenticate: Basic\" header. This is so downstream code can retry if\n// needed with HTTP Basic authentication included\nasync function checkAuthNeededFetch(url: RequestInfo, opts?: RequestInit) {\n  const response = await fetch(url, opts)\n  if (\n    response.status === 401 &&\n    response.headers.get('WWW-Authenticate')?.includes('Basic')\n  ) {\n    throw new AuthNeededError(\n      'Accessing HTTPBasic resource without authentication',\n      url.toString(),\n    )\n  }\n  return response\n}\n\nexport { RemoteFileWithRangeCache } from './RemoteFileWithRangeCache'\n","import jexl from 'jexl'\nimport { Feature } from './simpleFeature'\n\ntype JexlWithAddFunction = typeof jexl & {\n  addFunction(name: string, func: Function): void\n}\ntype JexlNonBuildable = Omit<typeof jexl, 'Jexl'>\n\nexport default function JexlF(/* config?: any*/): JexlNonBuildable {\n  const j = new jexl.Jexl() as JexlWithAddFunction\n  // someday will make sure all of configs callbacks are added in, including\n  // ones passed in\n\n  // below are core functions\n  j.addFunction('get', (feature: Feature, data: string) => feature.get(data))\n  j.addFunction('parent', (feature: Feature) => feature.parent())\n\n  j.addFunction('id', (feature: Feature) => feature.id())\n\n  // let user cast a jexl type into a javascript type\n  j.addFunction('cast', (arg: unknown) => arg)\n\n  // logging\n  j.addFunction('log', (thing: unknown) => {\n    console.log(thing) // eslint-disable-line no-console\n    return thing\n  })\n\n  // math\n  // addfunction added in jexl 2.3 but types/jexl still on 2.2\n  j.addFunction('max', Math.max)\n  j.addFunction('min', Math.min)\n  j.addFunction('sqrt', Math.sqrt)\n  j.addFunction('ceil', Math.ceil)\n  j.addFunction('floor', Math.floor)\n  j.addFunction('round', Math.round)\n  j.addFunction('abs', Math.abs)\n  j.addFunction('log10', Math.log10)\n  j.addFunction('parseInt', Number.parseInt)\n  j.addFunction('parseFloat', Number.parseFloat)\n\n  // string\n  j.addFunction('split', (s: string, char: string) => s.split(char))\n  j.addFunction('charAt', (s: string, index: number) => s.charAt(index))\n  j.addFunction('charCodeAt', (s: string, index: number) => s.charCodeAt(index))\n  j.addFunction('codePointAt', (s: string, pos: number) => s.codePointAt(pos))\n  j.addFunction('startsWith', (s: string, search: string, len?: number) =>\n    s.startsWith(search, len),\n  )\n  j.addFunction('endsWith', (s: string, search: string, len?: number) =>\n    s.endsWith(search, len),\n  )\n  j.addFunction('padEnd', (s: string, len: number, pad?: string) =>\n    s.padEnd(len, pad),\n  )\n  j.addFunction('padStart', (s: string, len: number, fill?: string) =>\n    s.padStart(len, fill),\n  )\n  j.addFunction('repeat', (s: string, count: number) => s.repeat(count))\n  j.addFunction('replace', (s: string, match: string, sub: string) =>\n    s.replace(match, sub),\n  )\n  j.addFunction('replaceAll', (s: string, match: string, sub: string) =>\n    s.replaceAll(match, sub),\n  )\n  j.addFunction('slice', (s: string, start: number, end?: number) =>\n    s.slice(start, end),\n  )\n  j.addFunction('startsWith', (s: string, search: string, pos?: number) =>\n    s.startsWith(search, pos),\n  )\n  j.addFunction('substring', (s: string, start: number, end?: number) =>\n    // eslint-disable-next-line unicorn/prefer-string-slice\n    s.substring(start, end),\n  )\n  j.addFunction('toLowerCase', (s: string) => s.toLowerCase())\n  j.addFunction('toUpperCase', (s: string) => s.toUpperCase())\n  j.addFunction('jsonParse', (s: string) => JSON.parse(s))\n  j.addFunction('trim', (s: string) => s.trim())\n  j.addFunction('trimEnd', (s: string) => s.trimEnd())\n  j.addFunction('trimStart', (s: string) => s.trimStart())\n\n  j.addFunction('getTag', (feature: Feature, s: string) => {\n    const tags = feature.get('tags')\n    return tags ? tags[s] : feature.get(s)\n  })\n\n  j.addBinaryOp('&', 15, (a: number, b: number) => a & b)\n\n  return j\n}\n","import createJexlInstance from './jexl'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst compilationCache: Record<string, any> = {}\n\n// revert function strings back to main, create a different file for jexlStrings.ts\n// pass the jexl property of the pluginManager as a param\n\n/**\n * compile a jexlExpression to a string\n *\n * @param str - string of code like `jexl:...`\n * @param options -\n */\nexport function stringToJexlExpression(\n  str: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  jexl?: any,\n) {\n  const cacheKey = `nosig|${str}`\n  if (!compilationCache[cacheKey]) {\n    const match = str.startsWith('jexl:')\n    if (!match) {\n      throw new Error('string does not appear to be in jexl format')\n    }\n    const code = str.split('jexl:')[1]\n    const compiled = jexl\n      ? jexl.compile(`${code}`)\n      : createJexlInstance().compile(`${code}`)\n    compilationCache[cacheKey] = compiled\n  }\n\n  return compilationCache[cacheKey]\n}\n","import {\n  RectTuple,\n  SerializedLayout,\n  Rectangle,\n  BaseLayout,\n} from './BaseLayout'\n\n/**\n * Rectangle-layout manager that lays out rectangles using bitmaps at\n * resolution that, for efficiency, may be somewhat lower than that of\n * the coordinate system for the rectangles being laid out.  `pitchX`\n * and `pitchY` are the ratios of input scale resolution to internal\n * bitmap resolution.\n */\n\n// minimum excess size of the array at which we garbage collect\nconst minSizeToBotherWith = 10000\nconst maxFeaturePitchWidth = 20000\n\nfunction segmentsIntersect(\n  x1: number,\n  x2: number,\n  y1: number,\n  y2: number,\n): boolean {\n  return x2 >= y1 && y2 >= x1\n}\n\ntype Bit<T> = Record<string, T> | string | undefined\n\ninterface RowState<T> {\n  min: number\n  max: number\n  offset: number\n  bits: Bit<T>[]\n}\n// a single row in the layout\nclass LayoutRow<T> {\n  private padding = 1\n\n  private allFilled?: Record<string, T> | string\n\n  private widthLimit = 1_000_000\n\n  private rowState?: RowState<T>\n\n  // this.rowState.bits is the array of items in the layout row, indexed by (x - this.offset)\n  // this.rowState.min is the leftmost edge of all the rectangles we have in the layout\n  // this.rowState.max is the rightmost edge of all the rectangles we have in the layout\n  // this.rowState.offset is the offset of the bits array relative to the genomic coordinates\n  //      (modified by pitchX, but we don't know that in this class)\n\n  setAllFilled(data: Record<string, T> | string): void {\n    this.allFilled = data\n  }\n\n  getItemAt(x: number): Record<string, T> | string | undefined {\n    if (this.allFilled) {\n      return this.allFilled\n    }\n    if (\n      this.rowState?.min === undefined ||\n      x < this.rowState.min ||\n      x >= this.rowState.max\n    ) {\n      return undefined\n    }\n    return this.rowState.bits[x - this.rowState.offset]\n  }\n\n  isRangeClear(left: number, right: number) {\n    if (this.allFilled) {\n      return false\n    }\n\n    if (\n      this.rowState === undefined ||\n      right <= this.rowState.min ||\n      left >= this.rowState.max\n    ) {\n      return true\n    }\n    const { min, max, offset, bits } = this.rowState\n\n    const maxX = Math.min(max, right) - offset\n    let flag = true\n    for (let x = Math.max(min, left) - offset; x < maxX && flag; x++) {\n      flag = bits[x] === undefined\n    }\n\n    return flag\n  }\n\n  // NOTE: this.rowState.min, this.rowState.max, and this.rowState.offset are\n  // interbase coordinates\n  initialize(left: number, right: number): RowState<T> {\n    const rectWidth = right - left\n    return {\n      offset: left - rectWidth,\n      min: left,\n      max: right,\n      bits: Array.from({ length: 3 * rectWidth }),\n    }\n  }\n\n  addRect(rect: Rectangle<T>, data: Record<string, T> | string): void {\n    const left = rect.l\n    const right = rect.r + this.padding // only padding on the right\n    if (!this.rowState) {\n      this.rowState = this.initialize(left, right)\n    }\n\n    // or check if we need to expand to the left and/or to the right\n    let oLeft = left - this.rowState.offset\n    let oRight = right - this.rowState.offset\n    const currLength = this.rowState.bits.length\n\n    // expand rightward if necessary\n    if (oRight >= this.rowState.bits.length) {\n      const additionalLength = oRight + 1\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n        this.rowState = this.initialize(left, right)\n      } else if (additionalLength > 0) {\n        this.rowState.bits = [\n          ...this.rowState.bits,\n          ...Array.from<Bit<T>>({ length: additionalLength }),\n        ]\n      }\n    }\n\n    // expand leftward if necessary\n    if (left < this.rowState.offset) {\n      // use math.min to avoid negative lengths\n      const additionalLength = Math.min(\n        currLength - oLeft,\n        this.rowState.offset,\n      )\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n\n        this.rowState = this.initialize(left, right)\n      } else {\n        this.rowState.bits = [\n          ...Array.from<Bit<T>>({ length: additionalLength }),\n          ...this.rowState.bits,\n        ]\n        this.rowState.offset -= additionalLength\n      }\n    }\n    oRight = right - this.rowState.offset\n    oLeft = left - this.rowState.offset\n    const w = oRight - oLeft\n\n    if (w > maxFeaturePitchWidth) {\n      console.warn(\n        `Layout X pitch set too low, feature spans ${w} bits in a single row.`,\n        rect,\n        data,\n      )\n    }\n\n    for (let x = oLeft; x < oRight; x += 1) {\n      this.rowState.bits[x] = data\n    }\n\n    if (left < this.rowState.min) {\n      this.rowState.min = left\n    }\n    if (right > this.rowState.max) {\n      this.rowState.max = right\n    }\n  }\n\n  /**\n   *  Given a range of interbase coordinates, deletes all data dealing with that range\n   */\n  discardRange(left: number, right: number): void {\n    if (this.allFilled) {\n      return\n    } // allFilled is irrevocable currently\n\n    // if we have no data, do nothing\n    if (!this.rowState) {\n      return\n    }\n\n    // if doesn't overlap at all, do nothing\n    if (right <= this.rowState.min || left >= this.rowState.max) {\n      return\n    }\n\n    // if completely encloses range, discard everything\n    if (left <= this.rowState.min && right >= this.rowState.max) {\n      this.rowState = undefined\n      return\n    }\n\n    // if overlaps left edge, adjust the min\n    if (right > this.rowState.min && left <= this.rowState.min) {\n      this.rowState.min = right\n    }\n\n    // if overlaps right edge, adjust the max\n    if (left < this.rowState.max && right >= this.rowState.max) {\n      this.rowState.max = left\n    }\n\n    // now trim the left, right, or both sides of the array\n    if (\n      this.rowState.offset < this.rowState.min - minSizeToBotherWith &&\n      this.rowState.bits.length >\n        this.rowState.max + minSizeToBotherWith - this.rowState.offset\n    ) {\n      // trim both sides\n      const leftTrimAmount = this.rowState.min - this.rowState.offset\n      const rightTrimAmount =\n        this.rowState.bits.length -\n        1 -\n        (this.rowState.max - this.rowState.offset)\n      // if (rightTrimAmount <= 0) debugger\n      // if (leftTrimAmount <= 0) debugger\n      // this.log(`trim both sides, ${leftTrimAmount} from left, ${rightTrimAmount} from right`)\n      this.rowState.bits = this.rowState.bits.slice(\n        leftTrimAmount,\n        this.rowState.bits.length - rightTrimAmount,\n      )\n      this.rowState.offset += leftTrimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (this.rowState.offset < this.rowState.min - minSizeToBotherWith) {\n      // trim left side\n      const desiredOffset =\n        this.rowState.min - Math.floor(minSizeToBotherWith / 2)\n      const trimAmount = desiredOffset - this.rowState.offset\n      // this.log(`trim left side by ${trimAmount}`)\n      this.rowState.bits.splice(0, trimAmount)\n      this.rowState.offset += trimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (\n      this.rowState.bits.length >\n      this.rowState.max - this.rowState.offset + minSizeToBotherWith\n    ) {\n      // trim right side\n      const desiredLength =\n        this.rowState.max -\n        this.rowState.offset +\n        1 +\n        Math.floor(minSizeToBotherWith / 2)\n      // this.log(`trim right side by ${this.rowState.bits.length-desiredLength}`)\n      // if (desiredLength > this.rowState.bits.length) debugger\n      this.rowState.bits.length = desiredLength\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    }\n\n    // if (this.rowState.offset > this.rowState.min) debugger\n    // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n\n    // if range now enclosed in the new bounds, loop through and clear the bits\n    const oLeft = Math.max(this.rowState.min, left) - this.rowState.offset\n    // if (oLeft < 0) debugger\n    // if (oLeft >= this.rowState.bits.length) debugger\n    // if (oRight < 0) debugger\n    // if (oRight >= this.rowState.bits.length) debugger\n\n    const oRight = Math.min(right, this.rowState.max) - this.rowState.offset\n    for (let x = oLeft; x >= 0 && x < oRight; x += 1) {\n      this.rowState.bits[x] = undefined\n    }\n  }\n}\n\nexport default class GranularRectLayout<T> implements BaseLayout<T> {\n  private pitchX: number\n\n  private pitchY: number\n\n  private hardRowLimit: number\n\n  private bitmap: LayoutRow<T>[]\n\n  private rectangles: Map<string, Rectangle<T>>\n\n  public maxHeightReached: boolean\n\n  private maxHeight: number\n\n  private displayMode: string\n\n  private pTotalHeight: number\n\n  /**\n   * pitchX - layout grid pitch in the X direction\n   * pitchY - layout grid pitch in the Y direction\n   * maxHeight - maximum layout height, default Infinity (no max)\n   */\n  constructor({\n    pitchX = 10,\n    pitchY = 10,\n    maxHeight = 10000,\n    hardRowLimit = 10000,\n    displayMode = 'normal',\n  }: {\n    pitchX?: number\n    pitchY?: number\n    maxHeight?: number\n    displayMode?: string\n    hardRowLimit?: number\n  } = {}) {\n    this.pitchX = pitchX\n    this.pitchY = pitchY\n    this.hardRowLimit = hardRowLimit\n    this.maxHeightReached = false\n    this.displayMode = displayMode\n\n    // reduce the pitchY to try and pack the features tighter\n    if (this.displayMode === 'compact') {\n      this.pitchY = Math.round(this.pitchY / 4) || 1\n      this.pitchX = Math.round(this.pitchX / 4) || 1\n    }\n\n    this.bitmap = []\n    this.rectangles = new Map()\n    this.maxHeight = Math.ceil(maxHeight / this.pitchY)\n    this.pTotalHeight = 0 // total height, in units of bitmap squares (px/pitchY)\n  }\n\n  /**\n   * @returns top position for the rect, or Null if laying\n   *  out the rect would exceed maxHeight\n   */\n  addRect(\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data?: T,\n  ): number | null {\n    // if we have already laid it out, return its layout\n    const storedRec = this.rectangles.get(id)\n    if (storedRec) {\n      if (storedRec.top === null) {\n        return null\n      }\n\n      // add it to the bitmap again, since that bitmap range may have been\n      // discarded\n      this.addRectToBitmap(storedRec)\n      return storedRec.top * this.pitchY\n    }\n\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const pHeight = Math.ceil(height / this.pitchY)\n\n    const rectangle: Rectangle<T> = {\n      id,\n      l: pLeft,\n      r: pRight,\n      top: null,\n      h: pHeight,\n      originalHeight: height,\n      data,\n    }\n\n    const maxTop = this.maxHeight - pHeight\n    let top = 0\n    if (this.displayMode !== 'collapse') {\n      for (; top <= maxTop; top += 1) {\n        if (!this.collides(rectangle, top)) {\n          break\n        }\n      }\n\n      if (top > maxTop) {\n        rectangle.top = null\n        this.rectangles.set(id, rectangle)\n        this.maxHeightReached = true\n        return null\n      }\n    }\n    rectangle.top = top\n    this.addRectToBitmap(rectangle)\n    this.rectangles.set(id, rectangle)\n    this.pTotalHeight = Math.max(this.pTotalHeight || 0, top + pHeight)\n    return top * this.pitchY\n  }\n\n  collides(rect: Rectangle<T>, top: number) {\n    const { bitmap } = this\n\n    const maxY = top + rect.h\n    for (let y = top; y < maxY; y += 1) {\n      const row = bitmap[y]\n      if (row !== undefined && !row.isRangeClear(rect.l, rect.r)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * make a subarray if it does not exist\n   */\n  private autovivifyRow(bitmap: LayoutRow<T>[], y: number) {\n    let row = bitmap[y]\n    if (!row) {\n      if (y > this.hardRowLimit) {\n        throw new Error(\n          `layout hard limit (${\n            this.hardRowLimit * this.pitchY\n          }px) exceeded, aborting layout`,\n        )\n      }\n      row = new LayoutRow()\n      bitmap[y] = row\n    }\n    return row\n  }\n\n  addRectToBitmap(rect: Rectangle<T>) {\n    if (rect.top === null) {\n      return\n    }\n\n    const data = rect.id\n    const yEnd = rect.top + rect.h\n    if (rect.r - rect.l > maxFeaturePitchWidth) {\n      // the rect is very big in relation to the view size, just pretend, for\n      // the purposes of layout, that it extends infinitely.  this will cause\n      // weird layout if a user scrolls manually for a very, very long time\n      // along the genome at the same zoom level.  but most users will not do\n      // that.  hopefully.\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).setAllFilled(data)\n      }\n    } else {\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).addRect(rect, data)\n      }\n    }\n  }\n\n  /**\n   *  Given a range of X coordinates, deletes all data dealing with\n   *  the features.\n   */\n  discardRange(left: number, right: number) {\n    // console.log( 'discard', left, right );\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const { bitmap } = this\n    for (const row of bitmap) {\n      if (row) {\n        row.discardRange(pLeft, pRight)\n      }\n    }\n  }\n\n  hasSeen(id: string) {\n    return this.rectangles.has(id)\n  }\n\n  getByCoord(x: number, y: number) {\n    const pY = Math.floor(y / this.pitchY)\n    const row = this.bitmap[pY]\n    if (!row) {\n      return undefined\n    }\n    const pX = Math.floor(x / this.pitchX)\n    return row.getItemAt(pX)\n  }\n\n  getByID(id: string) {\n    const r = this.rectangles.get(id)\n    if (r) {\n      const t = r.top! * this.pitchY\n      return [\n        r.l * this.pitchX,\n        t,\n        r.r * this.pitchX,\n        t + r.originalHeight,\n      ] as RectTuple\n    }\n\n    return undefined\n  }\n\n  getDataByID(id: string) {\n    return this.rectangles.get(id)?.data\n  }\n\n  cleanup() {}\n\n  getTotalHeight() {\n    return this.pTotalHeight * this.pitchY\n  }\n\n  get totalHeight() {\n    return this.getTotalHeight()\n  }\n\n  getRectangles(): Map<string, RectTuple> {\n    return new Map(\n      [...this.rectangles.entries()].map(([id, rect]) => {\n        const { l, r, originalHeight, top } = rect\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        return [id, [l * this.pitchX, t, r * this.pitchX, b]] // left, top, right, bottom\n      }),\n    )\n  }\n\n  serializeRegion(region: { start: number; end: number }): SerializedLayout {\n    const regionRectangles: Record<string, RectTuple> = {}\n    let maxHeightReached = false\n    for (const [id, rect] of this.rectangles.entries()) {\n      const { l, r, originalHeight, top } = rect\n      if (rect.top === null) {\n        maxHeightReached = true\n      } else {\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        const y1 = l * this.pitchX\n        const y2 = r * this.pitchX\n        const x1 = region.start\n        const x2 = region.end\n        // add +/- pitchX to avoid resolution causing errors\n        if (segmentsIntersect(x1, x2, y1 - this.pitchX, y2 + this.pitchX)) {\n          regionRectangles[id] = [y1, t, y2, b]\n        }\n      }\n    }\n    return {\n      rectangles: regionRectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached,\n    }\n  }\n\n  toJSON(): SerializedLayout {\n    const rectangles = Object.fromEntries(this.getRectangles())\n    return {\n      rectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached: this.maxHeightReached,\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BaseLayout, SerializedLayout } from './BaseLayout'\n\nexport default class MultiLayout<SUB_LAYOUT_CLASS extends BaseLayout<T>, T> {\n  subLayouts = new Map<string, SUB_LAYOUT_CLASS>()\n\n  /**\n   * layout class that just keeps a number of named sub-layouts.\n   * basically just a fancier\n   * `{ layout1: new GranularRectLayout(), layout2: new GranularRectLayout() ...}`\n   */\n  constructor(\n    public SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS,\n    public subLayoutConstructorArgs: Record<string, any> = {},\n  ) {}\n\n  getDataByID(id: string): unknown {\n    for (const layout of this.subLayouts.values()) {\n      // @ts-expect-error\n      const r = layout.getDataByID(id)\n      if (r) {\n        return r\n      }\n    }\n    return undefined\n  }\n\n  getSublayout(layoutName: string): SUB_LAYOUT_CLASS {\n    let subLayout = this.subLayouts.get(layoutName)\n    if (subLayout === undefined) {\n      subLayout = new this.SubLayoutClass(this.subLayoutConstructorArgs)\n      this.subLayouts.set(layoutName, subLayout)\n      return subLayout\n    }\n\n    return subLayout\n  }\n\n  addRect(\n    layoutName: string,\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data: Record<string, T> = {},\n  ) {\n    return this.getSublayout(layoutName).addRect(id, left, right, height, data)\n  }\n\n  discardRange(layoutName: string, left: number, right: number) {\n    return this.subLayouts.get(layoutName)?.discardRange(left, right)\n  }\n\n  toJSON() {\n    const data: Record<string, SerializedLayout> = {}\n    for (const [layoutName, sublayout] of this.subLayouts.entries()) {\n      data[layoutName] = sublayout.toJSON()\n    }\n    return data\n  }\n}\n","import {\n  RectTuple,\n  SerializedLayout,\n  BaseLayout,\n  Rectangle,\n} from './BaseLayout'\nimport RBush from 'rbush'\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\nexport default class PrecomputedLayout<T> implements BaseLayout<T> {\n  private rectangles: Map<string, RectTuple>\n\n  private totalHeight: number\n\n  public maxHeightReached: boolean\n\n  private rbush: RBush<Layout>\n\n  constructor({ rectangles, totalHeight, maxHeightReached }: SerializedLayout) {\n    this.rectangles = new Map(Object.entries(rectangles))\n    // rectangles is of the form \"featureId\": [leftPx, topPx, rightPx, bottomPx]\n    this.totalHeight = totalHeight\n    this.maxHeightReached = maxHeightReached\n    this.rbush = new RBush()\n    for (const [key, layout] of Object.entries(rectangles)) {\n      this.rbush.insert({\n        minX: layout[0],\n        minY: layout[1],\n        maxX: layout[2],\n        maxY: layout[3],\n        name: key,\n      })\n    }\n  }\n\n  addRect(id: string) {\n    const rect = this.rectangles.get(id)\n    if (!rect) {\n      throw new Error(`id ${id} not found in precomputed feature layout`)\n    }\n    // left, top, right, bottom\n    return rect[1]\n  }\n\n  /**\n   * returns a Map of `feature id -> rectangle`\n   */\n  getRectangles(): Map<string, RectTuple> {\n    return this.rectangles\n  }\n\n  getTotalHeight(): number {\n    return this.totalHeight\n  }\n\n  collides(_rect: Rectangle<T>, _top: number): boolean {\n    throw new Error('Method not implemented.')\n  }\n\n  getByCoord(x: number, y: number) {\n    const rect = { minX: x, minY: y, maxX: x + 1, maxY: y + 1 }\n    return this.rbush.collides(rect)\n      ? this.rbush.search(rect)[0].name\n      : undefined\n  }\n\n  getByID(id: string) {\n    return this.rectangles.get(id)\n  }\n\n  addRectToBitmap(_rect: Rectangle<T>, _data: Record<string, T>): void {\n    throw new Error('Method not implemented.')\n  }\n\n  discardRange(_left: number, _right: number): void {\n    throw new Error('Method not implemented.')\n  }\n\n  serializeRegion(_region: { start: number; end: number }): SerializedLayout {\n    throw new Error('Method not implemented.')\n  }\n\n  toJSON(): SerializedLayout {\n    return {\n      rectangles: Object.fromEntries(this.rectangles),\n      totalHeight: this.totalHeight,\n      maxHeightReached: false,\n      containsNoTransferables: true,\n    }\n  }\n}\n","import MultiLayout from './MultiLayout'\nimport PrecomputedLayout from './PrecomputedLayout'\n\nclass ThrowingLayout {\n  constructor() {\n    throw new Error('invalid layout name')\n  }\n}\n\nexport default class PrecomputedMultiLayout extends MultiLayout {\n  constructor(json) {\n    // use ThrowingLayout because there is not supposed to be any creation\n    // of new layouts in a precomputed layout\n    super(ThrowingLayout)\n    Object.entries(json).forEach(([layoutName, sublayoutJson]) => {\n      this.subLayouts.set(layoutName, new PrecomputedLayout(sublayoutJson))\n    })\n  }\n}\n","interface AbsoluteCache {\n  dirty: boolean\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n  width?: number\n  height?: number\n}\n\nexport default class SceneGraph {\n  private children: Map<string, SceneGraph>\n\n  private absoluteCache: AbsoluteCache\n\n  public parent?: SceneGraph\n\n  /**\n   * note: all coordinates are inter-base or inter-pixel coordinates\n   */\n  constructor(\n    public name: string,\n    public left: number,\n    public top: number,\n    public width: number,\n    public height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public data?: Record<string, any>,\n  ) {\n    this.children = new Map()\n    this.absoluteCache = { dirty: true }\n  }\n\n  addChild(\n    nameOrSceneGraph: string | SceneGraph,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data?: Record<string, any>,\n  ): SceneGraph {\n    const child =\n      nameOrSceneGraph instanceof SceneGraph\n        ? nameOrSceneGraph\n        : new SceneGraph(nameOrSceneGraph, left, top, width, height, data)\n\n    if (!(child instanceof SceneGraph)) {\n      throw new TypeError(\n        'argument to addChild must be an array or a SceneGraph',\n      )\n    }\n\n    if (this.children.has(child.name)) {\n      throw new Error(`child named \"${child.name}\" already exists`)\n    }\n\n    // update the bounds to match the child\n    child.parent = this\n    const {\n      left: childLeft,\n      right: childRight,\n      top: childTop,\n      bottom: childBottom,\n    } = child.absolute\n    if (\n      childLeft !== undefined &&\n      childRight !== undefined &&\n      childTop !== undefined &&\n      childBottom !== undefined\n    ) {\n      this.expand(childLeft, childRight, childTop, childBottom)\n      this.children.set(child.name, child)\n    }\n    return child\n  }\n\n  getSubRecord(name: string): SceneGraph | undefined {\n    return this.children.get(name)\n  }\n\n  /**\n   * if the record does not already cover the given\n   * absolute extents, extend it to cover them\n   *\n   * @param left -\n   * @param right -\n   * @param top -\n   * @param bottom -\n   */\n  expand(\n    newLeft: number,\n    newRight: number,\n    newTop: number,\n    newBottom: number,\n  ): void {\n    const { left, right, top, bottom } = this.absolute\n    if (left !== undefined && newLeft < left) {\n      const diff = left - newLeft\n      this.width += diff\n      this.left -= diff\n    }\n    if (right !== undefined && newRight > right) {\n      this.width += newRight - right\n    }\n    if (top !== undefined && newTop < top) {\n      const diff = top - newTop\n      this.height += diff\n      this.top -= diff\n    }\n    if (bottom !== undefined && newBottom > bottom) {\n      this.height += newBottom - bottom\n    }\n    if (this.parent) {\n      this.parent.expand(newLeft, newRight, newTop, newBottom)\n    }\n    this.absoluteCache.dirty = true\n  }\n\n  get bottom(): number {\n    return this.top + this.height\n  }\n\n  get right(): number {\n    return this.left + this.width\n  }\n\n  walkParents(callback: Function): void {\n    if (this.parent) {\n      callback(this.parent)\n      this.parent.walkParents(callback)\n    }\n  }\n\n  walkChildren(callback: Function): void {\n    for (const sub of this.children.values()) {\n      callback(sub)\n      sub.walkChildren(callback)\n    }\n  }\n\n  get absolute(): AbsoluteCache {\n    if (this.absoluteCache.dirty) {\n      let xOffset = 0\n      let yOffset = 0\n      this.walkParents((node: SceneGraph) => {\n        xOffset += node.left\n        yOffset += node.top\n      })\n      this.absoluteCache = {\n        dirty: false,\n        left: this.left + xOffset,\n        right: this.right + xOffset,\n        top: this.top + yOffset,\n        bottom: this.bottom + yOffset,\n        width: this.width,\n        height: this.height,\n      }\n    }\n    return this.absoluteCache\n  }\n\n  move(x: number, y: number): void {\n    this.left += x\n    this.top += y\n\n    this.absoluteCache.dirty = true\n    this.walkChildren((c: SceneGraph) => {\n      c.absoluteCache.dirty = true\n    })\n    const { left, right, top, bottom } = this.absolute\n    if (\n      left !== undefined &&\n      right !== undefined &&\n      top !== undefined &&\n      bottom !== undefined\n    ) {\n      this.expand(left, right, top, bottom)\n    }\n  }\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  isOptionalType,\n  isUnionType,\n  isArrayType,\n  isMapType,\n  isLateType,\n  IAnyType,\n  IModelReflectionPropertiesData,\n  IAnyComplexType,\n  ISimpleType,\n  UnionStringArray,\n} from 'mobx-state-tree'\n\nexport interface ILiteralType<T> extends ISimpleType<T> {\n  value: T\n}\n\n/**\n * get the inner type of an MST optional, array, or late type object\n */\nexport function getSubType(type: IAnyType): IAnyType {\n  let t\n  if (isOptionalType(type)) {\n    // @ts-expect-error\n    t = type._subtype || type.type\n  } else if (isArrayType(type) || isMapType(type)) {\n    // @ts-expect-error\n    t = type._subtype || type._subType || type.subType\n    // @ts-expect-error\n  } else if (typeof type.getSubType === 'function') {\n    // @ts-expect-error\n    return type.getSubType()\n  } else {\n    throw new TypeError('unsupported mst type')\n  }\n  if (!t) {\n    // debugger\n    throw new Error('failed to get subtype')\n  }\n  return t\n}\n\n/**\n * get the array of the subtypes in a union\n */\nexport function getUnionSubTypes(unionType: IAnyType): IAnyType[] {\n  if (!isUnionType(unionType)) {\n    throw new TypeError('not an MST union type')\n  }\n  const t =\n    // @ts-expect-error\n    unionType._types ||\n    // @ts-expect-error\n    unionType.types ||\n    // @ts-expect-error\n    getSubType(unionType)._types ||\n    // @ts-expect-error\n    getSubType(unionType).types\n  if (!t) {\n    // debugger\n    throw new Error('failed to extract subtypes from mst union')\n  }\n  return t\n}\n\n/**\n * get the type of one of the properties of the given MST model type\n */\nexport function getPropertyType(\n  type: IModelReflectionPropertiesData,\n  propertyName: string,\n) {\n  return type.properties[propertyName]\n}\n\n/**\n * get the base type from inside an MST optional type\n */\nexport function getDefaultValue(type: IAnyType) {\n  if (!isOptionalType(type)) {\n    throw new TypeError('type must be an optional type')\n  }\n  // @ts-expect-error\n  return type._defaultValue || type.defaultValue\n}\n\nexport type IEnumerationType<T extends string> = ISimpleType<\n  UnionStringArray<T[]>\n>\n\n/** get the string values of an MST enumeration type */\nexport function getEnumerationValues(type: IAnyComplexType) {\n  const subtypes = getUnionSubTypes(type) as ILiteralType<string>[]\n  // the subtypes should all be literals with a value member\n  return subtypes.map(t => t.value)\n}\n\nexport function resolveLateType(maybeLate: IAnyType) {\n  if (\n    !isUnionType(maybeLate) &&\n    !isArrayType(maybeLate) &&\n    isLateType(maybeLate)\n  ) {\n    // @ts-expect-error\n    return maybeLate.getSubType()\n  }\n  return maybeLate\n}\n","// This file replaces `index.js` in bundlers like webpack or Rollup,\n// according to `browser` config in `package.json`.\n\n// This alphabet uses `A-Za-z0-9_-` symbols.\n// The order of characters is optimized for better gzip and brotli compression.\n// Same as in non-secure/index.js\nexport const urlAlphabet =\n  'useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict'\n\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\n\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  // First, a bitmask is necessary to generate the ID. The bitmask makes bytes\n  // values closer to the alphabet size. The bitmask calculates the closest\n  // `2^31 - 1` number, which exceeds the alphabet size.\n  // For example, the bitmask for the alphabet size 30 is 31 (00011111).\n  // `Math.clz32` is not used, because it is not available in browsers.\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  // Though, the bitmask solution is not perfect since the bytes exceeding\n  // the alphabet size are refused. Therefore, to reliably generate the ID,\n  // the random bytes redundancy has to be satisfied.\n\n  // Note: every hardware random generator call is performance expensive,\n  // because the system call for entropy collection takes a lot of time.\n  // So, to avoid additional system calls, extra bytes are requested in advance.\n\n  // Next, a step determines how many random bytes to generate.\n  // The number of random bytes gets decided upon the ID size, mask,\n  // alphabet size, and magic number 1.6 (using 1.6 peaks at performance\n  // according to benchmarks).\n\n  // `-~f => Math.ceil(f)` if f is a float\n  // `-~i => i + 1` if i is an integer\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      // A compact alternative for `for (var i = 0; i < step; i++)`.\n      let j = step\n      while (j--) {\n        // Adding `|| ''` refuses a random byte that exceeds the alphabet size.\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\n\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\n\nexport let nanoid = (size = 21) =>\n  crypto.getRandomValues(new Uint8Array(size)).reduce((id, byte) => {\n    // It is incorrect to use bytes exceeding the alphabet size.\n    // The following mask reduces the random byte in the 0-255 value\n    // range to the 0-63 value range. Therefore, adding hacks, such\n    // as empty string fallback or magic numbers, is unnecessary because\n    // the bitmask trims bytes down to the alphabet size.\n    byte &= 63\n    if (byte < 36) {\n      // `0-9a-z`\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      // `A-Z`\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte > 62) {\n      id += '-'\n    } else {\n      id += '_'\n    }\n    return id\n  }, '')\n","/* eslint-disable react-refresh/only-export-components */\n// This file is a ponyfill for the HTML5 OffscreenCanvas API.\n\nimport isNode from 'detect-node'\n\nimport { CanvasSequence } from 'canvas-sequencer'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AbstractCanvas = any\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AbstractImageBitmap = any\n\nexport let createCanvas: (width: number, height: number) => AbstractCanvas\nexport let createImageBitmap: (\n  canvas: AbstractCanvas,\n) => Promise<AbstractImageBitmap>\n\n/** the JS class (constructor) for offscreen-generated image bitmap data */\nexport let ImageBitmapType: Function\n\nexport function drawImageOntoCanvasContext(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  imageData: any,\n  context: CanvasRenderingContext2D,\n) {\n  if (imageData.serializedCommands) {\n    const seq = new CanvasSequence(imageData.serializedCommands)\n    seq.execute(context)\n  } else {\n    context.drawImage(imageData as CanvasImageSource, 0, 0)\n  }\n}\n\nconst weHave = {\n  realOffscreenCanvas: typeof OffscreenCanvas === 'function',\n  node: isNode,\n}\n\nif (weHave.realOffscreenCanvas) {\n  createCanvas = (width, height) => new OffscreenCanvas(width, height)\n\n  createImageBitmap = window.createImageBitmap || self.createImageBitmap\n\n  ImageBitmapType = window.ImageBitmap || self.ImageBitmap\n} else if (weHave.node) {\n  // use node-canvas if we are running in node (i.e. automated tests)\n  createCanvas = (...args) => {\n    // @ts-expect-error\n    // eslint-disable-next-line no-undef\n    return nodeCreateCanvas(...args)\n  }\n  createImageBitmap = async (canvas, ...otherargs) => {\n    if (otherargs.length > 0) {\n      throw new Error(\n        'only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill',\n      )\n    }\n    const dataUri = canvas.toDataURL()\n    // @ts-expect-error\n    // eslint-disable-next-line no-undef\n    const img = new nodeImage()\n    return new Promise((resolve, reject) => {\n      // need onload for jest\n      img.onload = () => resolve(img)\n      img.onerror = reject\n      img.src = dataUri\n    })\n  }\n} else {\n  createCanvas = (width: number, height: number) => {\n    const context = new CanvasSequence()\n    return {\n      width,\n      height,\n      getContext() {\n        return context\n      },\n    }\n  }\n  createImageBitmap = async canvas => {\n    const ctx = canvas.getContext('2d')\n    return {\n      height: canvas.height,\n      width: canvas.width,\n      serializedCommands: ctx.toJSON(),\n      containsNoTransferables: true,\n    }\n  }\n  ImageBitmapType = String\n}\n","/* eslint-disable react-refresh/only-export-components */\nimport React from 'react'\nimport { CanvasSequence } from 'canvas-sequencer'\n\n// locals\nimport { createCanvas, createImageBitmap } from './offscreenCanvasPonyfill'\nimport { blobToDataURL } from './blobToDataURL'\n\nexport type RenderReturn = Record<string, unknown> | void\n\ntype RendererRet = Promise<RenderReturn> | RenderReturn\n\nexport async function renderToAbstractCanvas(\n  width: number,\n  height: number,\n  opts: {\n    exportSVG?: { rasterizeLayers?: boolean; scale?: number }\n    highResolutionScaling?: number\n  },\n  cb: (ctx: CanvasRenderingContext2D) => RendererRet,\n) {\n  const { exportSVG, highResolutionScaling = 1 } = opts\n\n  if (exportSVG) {\n    if (!exportSVG.rasterizeLayers) {\n      const fakeCtx = new CanvasSequence()\n      const result = await cb(fakeCtx)\n      return {\n        ...result,\n        canvasRecordedData: fakeCtx.toJSON(),\n      }\n    } else {\n      const s = exportSVG.scale || highResolutionScaling\n      const canvas = createCanvas(Math.ceil(width * s), height * s)\n      const ctx = canvas.getContext('2d')\n      if (!ctx) {\n        throw new Error('2d canvas rendering not supported on this platform')\n      }\n      ctx.scale(s, s)\n      const result = await cb(ctx)\n\n      // two methods needed for converting canvas to PNG, one for webworker\n      // offscreen canvas, one for main thread\n      return {\n        ...result,\n        reactElement: (\n          <image\n            width={width}\n            height={height}\n            xlinkHref={\n              'convertToBlob' in canvas\n                ? await blobToDataURL(\n                    await canvas.convertToBlob({\n                      type: 'image/png',\n                    }),\n                  )\n                : canvas.toDataURL('image/png')\n            }\n          />\n        ),\n      }\n    }\n  } else {\n    const s = highResolutionScaling\n    const canvas = createCanvas(Math.ceil(width * s), height * s)\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      throw new Error('2d canvas rendering not supported on this platform')\n    }\n    ctx.scale(s, s)\n    const result = await cb(ctx)\n    return { ...result, imageData: await createImageBitmap(canvas) }\n  }\n}\n\nexport async function getSerializedSvg(results: {\n  width: number\n  height: number\n  canvasRecordedData: unknown\n}) {\n  const { width, height, canvasRecordedData } = results\n\n  // @ts-ignore needs to be ignore not expect error, produces error in build step\n  const C2S = await import('canvas2svg')\n  const ctx = new C2S.default(width, height)\n  const seq = new CanvasSequence(canvasRecordedData)\n  seq.execute(ctx)\n\n  // innerHTML strips the outer <svg> element from returned data, we add\n  // our own <svg> element in the view's SVG export\n  return ctx.getSvg().innerHTML as string\n}\n\nexport function ReactRendering({\n  rendering,\n}: {\n  rendering: {\n    reactElement?: React.ReactNode\n    html?: string\n  }\n}) {\n  return React.isValidElement(rendering.reactElement) ? (\n    rendering.reactElement\n  ) : (\n    <g\n      /* eslint-disable-next-line react/no-danger */\n      dangerouslySetInnerHTML={{ __html: rendering.html || '' }}\n    />\n  )\n}\n","/**\n * fast low-level intersection of 2 coordinate ranges. assumes interbase coordinates.\n *\n * assumes `left <= right` for both ranges\n *\n * @returns array of [left, right], or [] if the ranges do not intersect. the choice of [] is because it allows destructuring array assignment without check for undefined return\n */\nexport function intersection2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n): [number, number] | [] {\n  // this code is verbose because \"if\" statements are faster than Math.min and Math.max\n  if (right1 > left2 && left1 < right2 && right2 - left2 && right1 - left1) {\n    if (left1 > left2) {\n      if (right1 < right2) {\n        // 1     |-------|\n        //     |------------|\n        return [left1, right1]\n      }\n      // 2         |----|\n      //      |------|\n      return [left1, right2]\n    }\n    if (right1 < right2) {\n      // 3  |-----|\n      //       |------|\n      return [left2, right1]\n    }\n    // 4     |------------|\n    //         |-------|\n    return [left2, right2]\n  }\n  return []\n}\n\n/**\n * Return whether 2 interbase coordinate ranges intersect.\n *\n * @param left1 -\n * @param right1 -\n * @param left2 -\n * @param right2 -\n *\n * @returns true if the two ranges intersect\n */\nexport function doesIntersect2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return right1 > left2 && left1 < right2\n}\n\n/**\n * Return whether the first region is completely contained within the second region\n *\n * @param left1 - candidate inner region left\n * @param right1 - candidate inner region right\n * @param left2 - candidate outer region left\n * @param right2 - candidate outer region right\n */\nexport function isContainedWithin(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return left2 <= left1 && right2 >= right1\n}\n","import { Observable, Observer } from 'rxjs'\nimport { takeUntil } from 'rxjs/operators'\nimport { observeAbortSignal } from '.'\n\n/**\n * Wrapper for rxjs Observable.create with improved error handling and\n * aborting support\n * @param func - observer function, could be async\n */\nexport function ObservableCreate<T>(\n  func: (arg: Observer<T>) => void | Promise<void>,\n  signal?: AbortSignal,\n): Observable<T> {\n  return Observable.create((observer: Observer<T>) => {\n    try {\n      const ret = func(observer)\n      // catch async errors\n      if (ret && ret.catch) {\n        ret.catch(error => observer.error(error))\n      }\n    } catch (error) {\n      // catch sync errors\n      observer.error(error)\n    }\n  }).pipe(takeUntil(observeAbortSignal(signal)))\n}\n","/**\n * Abstract feature object\n */\nexport interface Feature {\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  get(name: 'refName'): string\n  get(name: 'start'): number\n  get(name: 'end'): number\n  get(name: 'subfeatures'): Feature[] | undefined\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(name: string): any\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  set(name: string, val: any): void\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  tags(): string[]\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined\n\n  /**\n   * Convert to JSON\n   */\n  toJSON(): SimpleFeatureSerialized\n}\n\nexport function isFeature(thing: unknown): thing is Feature {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    typeof (thing as Feature).get === 'function' &&\n    typeof (thing as Feature).id === 'function'\n  )\n}\n\nexport interface SimpleFeatureArgs {\n  /** key-value data, must include 'start' and 'end' */\n  data: {}\n  /** optional parent feature */\n  parent?: Feature\n  /** unique identifier. can also be in data.uniqueId */\n  id: string | number // thing that can be stringified easily\n}\n\n// subfeatures do not have to have uniqueId\nexport interface SimpleFeatureSerializedNoId {\n  [key: string]: unknown\n  parentId?: string\n  start: number\n  end: number\n  refName: string\n  type?: string\n  subfeatures?: SimpleFeatureSerializedNoId[]\n}\n\n// base serialized feature has to have a uniqueId\nexport interface SimpleFeatureSerialized extends SimpleFeatureSerializedNoId {\n  subfeatures?: SimpleFeatureSerializedNoId[]\n  uniqueId: string\n}\n\nfunction isSimpleFeatureSerialized(\n  args: SimpleFeatureSerialized | SimpleFeatureArgs,\n): args is SimpleFeatureSerialized {\n  return 'uniqueId' in args && typeof args.data !== 'object'\n}\n\n/**\n * Simple implementation of a feature object.\n */\nexport default class SimpleFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private data: Record<string, any>\n\n  private subfeatures?: SimpleFeature[]\n\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  /**\n   * @param args - SimpleFeature args\n   *\n   * Note: args.data.subfeatures can be an array of these same args,\n   * which will be inflated to more instances of this class.\n   */\n  public constructor(args: SimpleFeatureArgs | SimpleFeatureSerialized) {\n    if (isSimpleFeatureSerialized(args)) {\n      this.data = args\n    } else {\n      this.data = args.data || {}\n      // load handle from args.parent (not args.data.parent)\n      // this reason is because if args is an object, it likely isn't properly loaded with\n      // parent as a Feature reference (probably a raw parent ID or something instead)\n      this.parentHandle = args.parent\n    }\n\n    // the feature id comes from\n    // args.id, args.data.uniqueId, or args.uniqueId due to this initialization\n    const id = isSimpleFeatureSerialized(args) ? args.uniqueId : args.id\n    if (id === undefined || id === null) {\n      throw new Error(\n        'SimpleFeature requires a unique `id` or `data.uniqueId` attribute',\n      )\n    }\n    this.uniqueId = String(id)\n\n    if (!(this.data.aliases || this.data.end - this.data.start >= 0)) {\n      throw new Error(\n        `invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`,\n      )\n    }\n\n    if (this.data.subfeatures) {\n      this.subfeatures = this.data.subfeatures?.map(\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (f: any, i: number) =>\n          typeof f.get !== 'function'\n            ? new SimpleFeature({\n                id: f.uniqueId || `${id}-${i}`,\n                data: {\n                  strand: this.data.strand,\n                  ...f,\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                } as Record<string, any>,\n                parent: this,\n              })\n            : f,\n      )\n    }\n  }\n\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public get(name: string): any {\n    return name === 'subfeatures'\n      ? this.subfeatures\n      : name === 'parent'\n        ? this.parent()\n        : this.data[name]\n  }\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public set(name: string, val: any): void {\n    this.data[name] = val\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  public tags(): string[] {\n    return Object.keys(this.data)\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  public id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  public parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  public children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  public toJSON(): SimpleFeatureSerialized {\n    const d = { ...this.data, uniqueId: this.id() } as SimpleFeatureSerialized\n    const p = this.parent()\n    if (p) {\n      d.parentId = p.id()\n    }\n    const c = this.children()\n    if (c) {\n      d.subfeatures = c.map(child => child.toJSON())\n    }\n    return d\n  }\n\n  public static fromJSON(json: SimpleFeatureSerialized) {\n    return new SimpleFeature({ ...json })\n  }\n}\n","import { firstValueFrom, Observable } from 'rxjs'\nimport { reduce } from 'rxjs/operators'\n\n// locals\nimport { NoAssemblyRegion } from './types'\nimport { Feature } from './simpleFeature'\n\nexport interface UnrectifiedQuantitativeStats {\n  scoreMin: number\n  scoreMax: number\n  scoreSum: number\n  scoreSumSquares: number\n  featureCount: number\n  basesCovered: number\n}\nexport interface QuantitativeStats extends UnrectifiedQuantitativeStats {\n  featureDensity: number\n  scoreMean: number\n  scoreStdDev: number\n}\n\n/**\n * calculate standard deviation using the 'shortcut method' that accepts\n * the sum and the sum squares of the elements\n *\n * @param sum - sum(i, 1..n)\n * @param sumSquares - sum(i^2, 1..n)\n * @param n - number of elements\n * @param population - boolean: use population instead of sample correction\n * @returns - the estimated std deviation\n */\nexport function calcStdFromSums(\n  sum: number,\n  sumSquares: number,\n  n: number,\n  population = false,\n): number {\n  if (n === 0) {\n    return 0\n  }\n  let variance\n  if (population) {\n    variance = sumSquares / n - (sum * sum) / (n * n)\n  } else {\n    // sample correction is n-1\n    variance = sumSquares - (sum * sum) / n\n    if (n > 1) {\n      variance /= n - 1\n    }\n  }\n\n  return variance < 0 ? 0 : Math.sqrt(variance)\n}\n\n/**\n * @param stats - a summary stats object with scoreSum, featureCount,\n * scoreSumSquares, and basesCovered\n * @returns - a summary stats object with\n * scoreMean, scoreStdDev, and featureDensity added\n */\nexport function rectifyStats(s: UnrectifiedQuantitativeStats) {\n  return {\n    ...s,\n    scoreMean: (s.scoreSum || 0) / (s.featureCount || s.basesCovered || 1),\n    scoreStdDev: calcStdFromSums(\n      s.scoreSum,\n      s.scoreSumSquares,\n      s.featureCount || s.basesCovered,\n    ),\n    featureDensity: (s.featureCount || 1) / s.basesCovered,\n  } as QuantitativeStats\n}\n\n/**\n * calculates per-base scores for variable width features over a region\n *\n * @param region - object contains start, end\n * @param features - list of features with start, end, score\n * @returns array of numeric scores\n */\nexport function calcPerBaseStats(\n  region: NoAssemblyRegion,\n  features: Feature[],\n): number[] {\n  const { start, end } = region\n  const scores = []\n  const feats = features.sort((a, b) => a.get('start') - b.get('start'))\n  let pos = start\n  let currentFeat = 0\n  let i = 0\n\n  while (pos < end) {\n    while (currentFeat < feats.length && pos >= feats[currentFeat].get('end')) {\n      currentFeat += 1\n    }\n    const f = feats[currentFeat]\n    if (!f) {\n      scores[i] = 0\n    } else if (pos >= f.get('start') && pos < f.get('end')) {\n      scores[i] = f.get('score')\n    } else {\n      scores[i] = 0\n    }\n    i += 1\n    pos += 1\n  }\n  return scores\n}\n\n/**\n * transform a list of scores to summary statistics\n *\n * @param region - object with start, end\n * @param features - array of features which are possibly summary features\n * @returns - object with scoreMax, scoreMin, scoreSum, scoreSumSquares, etc\n */\nexport async function scoresToStats(\n  region: NoAssemblyRegion,\n  feats: Observable<Feature>,\n) {\n  const { start, end } = region\n  const seed = {\n    scoreMin: Number.MAX_VALUE,\n    scoreMax: Number.MIN_VALUE,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n  }\n  let found = false\n\n  const { scoreMin, scoreMax, scoreSum, scoreSumSquares, featureCount } =\n    await firstValueFrom(\n      feats.pipe(\n        reduce((acc, f) => {\n          const s = f.get('score')\n          const summary = f.get('summary')\n          const { scoreMax, scoreMin } = acc\n          acc.scoreMax = Math.max(scoreMax, summary ? f.get('maxScore') : s)\n          acc.scoreMin = Math.min(scoreMin, summary ? f.get('minScore') : s)\n          acc.scoreSum += s\n          acc.scoreSumSquares += s * s\n          acc.featureCount += 1\n          found = true\n\n          return acc\n        }, seed),\n      ),\n    )\n\n  return found\n    ? rectifyStats({\n        scoreMax,\n        scoreMin,\n        scoreSum,\n        scoreSumSquares,\n        featureCount,\n        basesCovered: end - start + 1,\n      })\n    : blankStats()\n}\n\nexport function blankStats() {\n  return {\n    scoreMin: 0,\n    scoreMax: 0,\n    scoreMean: 0,\n    scoreStdDev: 0,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n    featureDensity: 0,\n    basesCovered: 0,\n  } as QuantitativeStats\n}\n","import React from 'react'\nimport {\n  isStateTreeNode,\n  Instance,\n  SnapshotIn,\n  IAnyStateTreeNode,\n  IStateTreeNode,\n  IType,\n} from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '../../configuration'\n\nimport assemblyManager from '../../assemblyManager'\nimport TextSearchManager from '../../TextSearch/TextSearchManager'\nimport { MenuItem } from '../../ui'\nimport {\n  NoAssemblyRegion as MUNoAssemblyRegion,\n  Region as MUIRegion,\n  LocalPathLocation as MULocalPathLocation,\n  UriLocation as MUUriLocation,\n  BlobLocation as MUBlobLocation,\n} from './mst'\nimport RpcManager from '../../rpc/RpcManager'\nimport { Feature } from '../simpleFeature'\nimport { BaseInternetAccountModel } from '../../pluggableElementTypes/models'\nimport { ThemeOptions } from '@mui/material'\n\nexport * from './util'\n\n/** abstract type for a model that contains multiple views */\nexport interface AbstractViewContainer\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  extends IStateTreeNode<IType<any, unknown, any>> {\n  views: AbstractViewModel[]\n  removeView(view: AbstractViewModel): void\n  addView(\n    typeName: string,\n    initialState?: Record<string, unknown>,\n  ): AbstractViewModel\n}\nexport function isViewContainer(\n  thing: unknown,\n): thing is AbstractViewContainer {\n  return (\n    isStateTreeNode(thing) &&\n    'removeView' in thing &&\n    'addView' in thing &&\n    'views' in thing\n  )\n}\n\nexport type NotificationLevel = 'error' | 'info' | 'warning' | 'success'\nexport interface SnackAction {\n  name: React.ReactElement\n  onClick: () => void\n}\n\nexport type AssemblyManager = Instance<ReturnType<typeof assemblyManager>>\n\nexport interface BasePlugin {\n  version?: string\n  name: string\n  url?: string\n}\n\nexport interface JBrowsePlugin {\n  name: string\n  authors: string[]\n  description: string\n  location: string\n  url?: string\n  umdUrl?: string\n  esmUrl?: string\n  cjsUrl?: string\n  license: string\n  image?: string\n}\n\nexport type DialogComponentType =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  | React.LazyExoticComponent<React.FC<any>>\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  | React.FC<any>\n\n/** minimum interface that all session state models must implement */\nexport interface AbstractSessionModel extends AbstractViewContainer {\n  jbrowse: IAnyStateTreeNode\n  drawerPosition?: string\n  configuration: AnyConfigurationModel\n  rpcManager: RpcManager\n  assemblyNames: string[]\n  assemblies: AnyConfigurationModel[]\n  selection?: unknown\n  focusedViewId?: string\n  themeName?: string\n  hovered: unknown\n  setHovered: (arg: unknown) => void\n  setFocusedViewId?: (id: string) => void\n  allThemes?: () => Record<string, ThemeOptions | undefined>\n  setSelection: (feature: Feature) => void\n  setSession?: (arg: { name: string; [key: string]: unknown }) => void\n  clearSelection: () => void\n  duplicateCurrentSession?: () => void\n  notify: (\n    message: string,\n    level?: NotificationLevel,\n    action?: SnackAction,\n  ) => void\n  notifyError: (message: string, error?: unknown, extra?: unknown) => void\n  assemblyManager: AssemblyManager\n  version: string\n  getTrackActionMenuItems?: Function\n  addAssembly?: Function\n  removeAssembly?: Function\n  textSearchManager?: TextSearchManager\n  connections: AnyConfigurationModel[]\n  deleteConnection?: Function\n  temporaryAssemblies?: unknown[]\n  addTemporaryAssembly?: (arg: Record<string, unknown>) => void\n  removeTemporaryAssembly?: (arg: string) => void\n  sessionConnections?: AnyConfigurationModel[]\n  sessionTracks?: AnyConfigurationModel[]\n  connectionInstances?: {\n    name: string\n    tracks: AnyConfigurationModel[]\n    configuration: AnyConfigurationModel\n  }[]\n  makeConnection?: Function\n  breakConnection?: Function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  prepareToBreakConnection?: (arg: AnyConfigurationModel) => any\n  adminMode?: boolean\n  showWidget?: Function\n  addWidget?: Function\n\n  DialogComponent?: DialogComponentType\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  DialogProps: any\n  queueDialog<T extends DialogComponentType>(\n    callback: (doneCallback: () => void) => [T, React.ComponentProps<T>],\n  ): void\n  name: string\n  id?: string\n  tracks: AnyConfigurationModel[]\n}\nexport function isSessionModel(thing: unknown): thing is AbstractSessionModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'rpcManager' in thing &&\n    'configuration' in thing\n  )\n}\n\n/** abstract interface for a session allows editing configurations */\nexport interface SessionWithConfigEditing extends AbstractSessionModel {\n  editConfiguration(configuration: AnyConfigurationModel): void\n}\nexport function isSessionModelWithConfigEditing(\n  thing: unknown,\n): thing is SessionWithConfigEditing {\n  return isSessionModel(thing) && 'editConfiguration' in thing\n}\n\n/** abstract interface for a session allows adding tracks */\nexport interface SessionWithConfigEditing extends AbstractSessionModel {\n  addTrackConf(\n    configuration: AnyConfigurationModel | SnapshotIn<AnyConfigurationModel>,\n  ): void\n}\nexport function isSessionWithAddTracks(\n  thing: unknown,\n): thing is SessionWithConfigEditing {\n  return (\n    // @ts-expect-error\n    isSessionModel(thing) && 'addTrackConf' in thing && !thing.disableAddTracks\n  )\n}\n\n/** abstract interface for a session allows adding tracks */\nexport interface SessionWithShareURL extends AbstractSessionModel {\n  shareURL: string\n}\nexport function isSessionWithShareURL(\n  thing: unknown,\n): thing is SessionWithShareURL {\n  return isSessionModel(thing) && 'shareURL' in thing && !!thing.shareURL\n}\n\nexport interface Widget {\n  type: string\n  id: string\n}\n\n/** abstract interface for a session that manages widgets */\nexport interface SessionWithWidgets extends AbstractSessionModel {\n  minimized: boolean\n  visibleWidget?: Widget\n  widgets: Map<string | number, Widget>\n  hideAllWidgets: () => void\n  activeWidgets: Map<string | number, Widget>\n  addWidget(\n    typeName: string,\n    id: string,\n    initialState?: Record<string, unknown>,\n    configuration?: { type: string },\n  ): Widget\n  showWidget(widget: unknown): void\n  hideWidget(widget: unknown): void\n}\n\n/* only some sessions with widgets use a drawer widget */\nexport interface SessionWithDrawerWidgets extends SessionWithWidgets {\n  drawerWidth: number\n  resizeDrawer(arg: number): number\n  minimizeWidgetDrawer(): void\n  showWidgetDrawer: () => void\n  drawerPosition: string\n  setDrawerPosition(arg: string): void\n}\n\nexport function isSessionModelWithWidgets(\n  thing: unknown,\n): thing is SessionWithWidgets {\n  return isSessionModel(thing) && 'widgets' in thing\n}\ninterface SessionWithConnections {\n  makeConnection: (arg: AnyConfigurationModel) => void\n}\nexport function isSessionModelWithConnections(\n  thing: unknown,\n): thing is SessionWithConnections {\n  return isSessionModel(thing) && 'makeConnection' in thing\n}\n\ninterface SessionWithConnectionEditing {\n  addConnectionConf: (arg: AnyConfigurationModel) => void\n}\n\nexport function isSessionModelWithConnectionEditing(\n  thing: unknown,\n): thing is SessionWithConnectionEditing {\n  return isSessionModel(thing) && 'addConnectionConf' in thing\n}\n\nexport interface SessionWithSessionPlugins extends AbstractSessionModel {\n  sessionPlugins: JBrowsePlugin[]\n  addSessionPlugin: Function\n  removeSessionPlugin: Function\n}\nexport function isSessionWithSessionPlugins(\n  thing: unknown,\n): thing is SessionWithSessionPlugins {\n  return isSessionModel(thing) && 'sessionPlugins' in thing\n}\n\n/** abstract interface for a session that manages a global selection */\nexport interface SelectionContainer extends AbstractSessionModel {\n  selection?: unknown\n  setSelection(thing: unknown): void\n}\nexport function isSelectionContainer(\n  thing: unknown,\n): thing is SelectionContainer {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'selection' in thing &&\n    'setSelection' in thing\n  )\n}\n\n/** abstract interface for a session allows applying focus to views and widgets */\nexport interface SessionWithFocusedViewAndDrawerWidgets\n  extends SessionWithDrawerWidgets {\n  focusedViewId: string | undefined\n  setFocusedViewId(id: string): void\n}\n\n/** minimum interface that all view state models must implement */\nexport interface AbstractViewModel {\n  id: string\n  type: string\n  width: number\n  minimized: boolean\n  setWidth(width: number): void\n  setMinimized(flag: boolean): void\n  displayName: string | undefined\n  setDisplayName: (arg: string) => void\n  menuItems: () => MenuItem[]\n}\nexport function isViewModel(thing: unknown): thing is AbstractViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'width' in thing &&\n    'setWidth' in thing\n  )\n}\n\nexport interface AbstractTrackModel {\n  displays: AbstractDisplayModel[]\n  configuration: AnyConfigurationModel\n}\n\nexport function isTrackModel(thing: unknown): thing is AbstractTrackModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-expect-error\n    thing.configuration.trackId\n  )\n}\n\nexport interface AbstractDisplayModel {\n  id: string\n  parentTrack: AbstractTrackModel\n  renderDelay: number\n  rendererType: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  cannotBeRenderedReason?: string\n}\nexport function isDisplayModel(thing: unknown): thing is AbstractDisplayModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-expect-error\n    thing.configuration.displayId\n  )\n}\n\nexport interface TrackViewModel extends AbstractViewModel {\n  showTrack(trackId: string): void\n  hideTrack(trackId: string): void\n}\nexport function isTrackViewModel(thing: unknown): thing is TrackViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'showTrack' in thing &&\n    'hideTrack' in thing\n  )\n}\n\n/** minimum interface for the root MST model of a JBrowse app */\nexport interface AbstractRootModel {\n  jbrowse: IAnyStateTreeNode\n  session?: AbstractSessionModel\n  setDefaultSession?(): void\n  adminMode?: boolean\n  error?: unknown\n}\n\n/** root model with more included for the heavier JBrowse web and desktop app */\nexport interface AppRootModel extends AbstractRootModel {\n  internetAccounts: BaseInternetAccountModel[]\n  findAppropriateInternetAccount(\n    location: UriLocation,\n  ): BaseInternetAccountModel | undefined\n}\n\nexport function isAppRootModel(thing: unknown): thing is AppRootModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'findAppropriateInternetAccount' in thing\n  )\n}\n\nexport interface RootModelWithInternetAccounts extends AbstractRootModel {\n  internetAccounts: BaseInternetAccountModel[]\n  findAppropriateInternetAccount(\n    location: UriLocation,\n  ): BaseInternetAccountModel | undefined\n}\n\nexport function isRootModelWithInternetAccounts(\n  thing: unknown,\n): thing is RootModelWithInternetAccounts {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'internetAccounts' in thing &&\n    'findAppropriateInternetAccount' in thing\n  )\n}\n\n/** a root model that manages global menus */\nexport interface AbstractMenuManager {\n  appendMenu(menuName: string): void\n  insertMenu(menuName: string, position: number): number\n  insertInMenu(menuName: string, menuItem: MenuItem, position: number): number\n  appendToMenu(menuName: string, menuItem: MenuItem): number\n  appendToSubMenu(menuPath: string[], menuItem: MenuItem): number\n  insertInSubMenu(\n    menuPath: string[],\n    menuItem: MenuItem,\n    position: number,\n  ): number\n}\nexport function isAbstractMenuManager(\n  thing: unknown,\n): thing is AbstractMenuManager {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'appendMenu' in thing &&\n    'appendToSubMenu' in thing\n  )\n}\n\n// Empty interfaces required by mobx-state-tree\n// See https://mobx-state-tree.js.org/tips/typescript#using-a-mst-type-at-design-time\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nexport interface NoAssemblyRegion\n  extends SnapshotIn<typeof MUNoAssemblyRegion> {}\n\n/** a description of a specific genomic region. assemblyName, refName, start, end, and reversed */\nexport interface Region extends SnapshotIn<typeof MUIRegion> {}\n\nexport interface AugmentedRegion extends Region {\n  originalRefName?: string\n}\n\nexport interface LocalPathLocation\n  extends SnapshotIn<typeof MULocalPathLocation> {}\n\nexport interface UriLocation extends SnapshotIn<typeof MUUriLocation> {}\n\nexport function isUriLocation(location: unknown): location is UriLocation {\n  return (\n    typeof location === 'object' &&\n    location !== null &&\n    'uri' in location &&\n    !!location.uri\n  )\n}\nexport function isLocalPathLocation(\n  location: unknown,\n): location is LocalPathLocation {\n  return (\n    typeof location === 'object' &&\n    location !== null &&\n    'localPath' in location &&\n    !!location.localPath\n  )\n}\n\nexport function isBlobLocation(location: unknown): location is BlobLocation {\n  return (\n    typeof location === 'object' &&\n    location !== null &&\n    'blobId' in location &&\n    !!location.blobId\n  )\n}\nexport class AuthNeededError extends Error {\n  constructor(\n    public message: string,\n    public url: string,\n  ) {\n    super(message)\n    this.name = 'AuthNeededError'\n\n    Object.setPrototypeOf(this, AuthNeededError.prototype)\n  }\n}\n\nexport class RetryError extends Error {\n  constructor(\n    public message: string,\n    public internetAccountId: string,\n  ) {\n    super(message)\n    this.name = 'RetryError'\n  }\n}\n\nexport function isAuthNeededException(\n  exception: unknown,\n): exception is AuthNeededError {\n  return (\n    exception instanceof Error &&\n    // DOMException\n    (exception.name === 'AuthNeededError' ||\n      (exception as AuthNeededError).url !== undefined)\n  )\n}\n\nexport function isRetryException(exception: Error): boolean {\n  return (\n    // DOMException\n    exception.name === 'RetryError' ||\n    (exception as RetryError).internetAccountId !== undefined\n  )\n}\n\nexport interface BlobLocation extends SnapshotIn<typeof MUBlobLocation> {}\n\nexport type FileLocation = LocalPathLocation | UriLocation | BlobLocation\n\n// These types are slightly different than the MST models representing a\n// location because a blob cannot be stored in a MST, so this is the\n// pre-processed file location\nexport interface PreUriLocation {\n  uri: string\n}\nexport interface PreLocalPathLocation {\n  localPath: string\n}\nexport interface PreBlobLocation {\n  blob: File\n}\nexport type PreFileLocation =\n  | PreUriLocation\n  | PreLocalPathLocation\n  | PreBlobLocation\n\nexport { type default as TextSearchManager } from '../../TextSearch/TextSearchManager'\n","import { useState, useEffect, useRef } from 'react'\n\nexport default function useMeasure() {\n  const ref = useRef<HTMLDivElement>(null)\n  const [dims, setDims] = useState<{ width?: number; height?: number }>({\n    width: undefined,\n    height: undefined,\n  })\n  useEffect(() => {\n    if (!ref.current) {\n      return\n    }\n    const RS =\n      typeof window !== 'undefined' && 'ResizeObserver' in window\n        ? window.ResizeObserver\n        : undefined\n\n    if (!RS) {\n      return\n    }\n    const observer = new RS(entries => {\n      setDims({\n        width: entries[0].contentRect.width,\n        height: entries[0].contentRect.height,\n      })\n    })\n    observer.observe(ref.current)\n\n    // Callback fired when component is unmounted\n    return () => {\n      observer.disconnect()\n    }\n  }, [])\n\n  return [ref, dims] as const\n}\n","import { when as mobxWhen, IWhenOptions } from 'mobx'\nimport { makeAbortError } from './aborting'\n\ninterface WhenOpts extends IWhenOptions {\n  signal?: AbortSignal\n}\n\n/**\n * Wrapper for mobx `when` that adds timeout and aborting support.\n */\nexport function when(\n  getter: () => boolean,\n  { timeout, signal, name }: WhenOpts = {},\n) {\n  return new Promise((resolve, reject) => {\n    let finished = false\n\n    const whenPromise = mobxWhen(getter)\n\n    // set up timeout\n    let timeoutId: ReturnType<typeof setTimeout> | undefined\n    let finishTimeout = () => {}\n    if (timeout) {\n      timeoutId = setTimeout(() => {\n        if (!finished) {\n          finished = true\n          whenPromise.cancel()\n          reject(new Error(`timed out waiting for ${name || 'whenPresent'}`))\n        }\n      }, timeout)\n      finishTimeout = () => timeoutId && clearTimeout(timeoutId)\n    }\n\n    // set up aborting\n    if (signal) {\n      signal.addEventListener('abort', () => {\n        if (!finished) {\n          finished = true\n\n          // mobx when supports a cancel method\n          whenPromise.cancel()\n          finishTimeout()\n\n          reject(makeAbortError())\n        }\n      })\n    }\n\n    whenPromise\n      .then(() => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          resolve(true)\n        }\n      })\n      .catch(err => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          reject(err)\n        }\n      })\n  })\n}\n\n/**\n * Wrapper for mobx `when` that makes a promise for the return value\n * of the given function at the point in time when it becomes not\n * undefined and not null.\n */\nexport async function whenPresent<FUNCTION extends () => unknown>(\n  getter: FUNCTION,\n  opts: WhenOpts = {},\n): Promise<NonNullable<ReturnType<FUNCTION>>> {\n  await when(() => {\n    const val = getter()\n    return val !== undefined && val !== null\n  }, opts)\n\n  return getter() as NonNullable<ReturnType<FUNCTION>>\n}\n","import { revcom, Feature } from '@jbrowse/core/util'\nimport { getTagAlt } from '../util'\n\nexport interface Mismatch {\n  qual?: number\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\nconst mdRegex = new RegExp(/(\\d+|\\^[a-z]+|[a-z])/gi)\nconst modificationRegex = new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/)\nconst cigarRegex = new RegExp(/([MIDNSHPX=])/)\nconst startClip = new RegExp(/(\\d+)[SH]$/)\nconst endClip = new RegExp(/^(\\d+)([SH])/)\n\nexport function parseCigar(cigar = '') {\n  return cigar.split(cigarRegex).slice(0, -1)\n}\n\nexport function cigarToMismatches(\n  ops: string[],\n  seq?: string,\n  ref?: string,\n  qual?: Buffer,\n) {\n  let roffset = 0 // reference offset\n  let soffset = 0 // seq offset\n  const mismatches: Mismatch[] = []\n  const hasRefAndSeq = ref && seq\n  for (let i = 0; i < ops.length; i += 2) {\n    const len = +ops[i]\n    const op = ops[i + 1]\n\n    if (op === 'M' || op === '=' || op === 'E') {\n      if (hasRefAndSeq) {\n        for (let j = 0; j < len; j++) {\n          if (\n            // @ts-ignore in the full yarn build of the repo, this says that object is possibly undefined for some reason, ignored\n            seq[soffset + j].toUpperCase() !== ref[roffset + j].toUpperCase()\n          ) {\n            mismatches.push({\n              start: roffset + j,\n              type: 'mismatch',\n              base: seq[soffset + j],\n              altbase: ref[roffset + j],\n              length: 1,\n            })\n          }\n        }\n      }\n      soffset += len\n    }\n    if (op === 'I') {\n      mismatches.push({\n        start: roffset,\n        type: 'insertion',\n        base: `${len}`,\n        length: 0,\n      })\n      soffset += len\n    } else if (op === 'D') {\n      mismatches.push({\n        start: roffset,\n        type: 'deletion',\n        base: '*',\n        length: len,\n      })\n    } else if (op === 'N') {\n      mismatches.push({\n        start: roffset,\n        type: 'skip',\n        base: 'N',\n        length: len,\n      })\n    } else if (op === 'X') {\n      const r = seq?.slice(soffset, soffset + len) || []\n      const q = qual?.slice(soffset, soffset + len) || []\n\n      for (let j = 0; j < len; j++) {\n        mismatches.push({\n          start: roffset + j,\n          type: 'mismatch',\n          base: r[j],\n          qual: q[j],\n          length: 1,\n        })\n      }\n      soffset += len\n    } else if (op === 'H') {\n      mismatches.push({\n        start: roffset,\n        type: 'hardclip',\n        base: `H${len}`,\n        cliplen: len,\n        length: 1,\n      })\n    } else if (op === 'S') {\n      mismatches.push({\n        start: roffset,\n        type: 'softclip',\n        base: `S${len}`,\n        cliplen: len,\n        length: 1,\n      })\n      soffset += len\n    }\n\n    if (op !== 'I' && op !== 'S' && op !== 'H') {\n      roffset += len\n    }\n  }\n  return mismatches\n}\n\n/**\n * parse a SAM MD tag to find mismatching bases of the template versus the\n * reference @returns array of mismatches and their positions\n */\nexport function mdToMismatches(\n  mdstring: string,\n  ops: string[],\n  cigarMismatches: Mismatch[],\n  seq: string,\n  qual?: Buffer,\n) {\n  let curr: Mismatch = { start: 0, base: '', length: 0, type: 'mismatch' }\n  let lastCigar = 0\n  let lastTemplateOffset = 0\n  let lastRefOffset = 0\n  let lastSkipPos = 0\n  const mismatchRecords: Mismatch[] = []\n  const skips = cigarMismatches.filter(cigar => cigar.type === 'skip')\n\n  // convert a position on the reference sequence to a position\n  // on the template sequence, taking into account hard and soft\n  // clipping of reads\n\n  function nextRecord(): void {\n    mismatchRecords.push(curr)\n\n    // get a new mismatch record ready\n    curr = {\n      start: curr.start + curr.length,\n      length: 0,\n      base: '',\n      type: 'mismatch',\n    }\n  }\n\n  function getTemplateCoordLocal(refCoord: number): number {\n    let templateOffset = lastTemplateOffset\n    let refOffset = lastRefOffset\n    for (\n      let i = lastCigar;\n      i < ops.length && refOffset <= refCoord;\n      i += 2, lastCigar = i\n    ) {\n      const len = +ops[i]\n      const op = ops[i + 1]\n\n      if (op === 'S' || op === 'I') {\n        templateOffset += len\n      } else if (op === 'D' || op === 'P' || op === 'N') {\n        refOffset += len\n      } else if (op !== 'H') {\n        templateOffset += len\n        refOffset += len\n      }\n    }\n    lastTemplateOffset = templateOffset\n    lastRefOffset = refOffset\n\n    return templateOffset - (refOffset - refCoord)\n  }\n\n  // now actually parse the MD string\n  const md = mdstring.match(mdRegex) || []\n  for (const token of md) {\n    const num = +token\n    if (!Number.isNaN(num)) {\n      curr.start += num\n    } else if (token.startsWith('^')) {\n      curr.start += token.length - 1\n    } else {\n      // mismatch\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (let j = 0; j < token.length; j += 1) {\n        curr.length = 1\n\n        while (lastSkipPos < skips.length) {\n          const mismatch = skips[lastSkipPos]\n          if (curr.start >= mismatch.start) {\n            curr.start += mismatch.length\n            lastSkipPos++\n          } else {\n            break\n          }\n        }\n        const s = getTemplateCoordLocal(curr.start)\n        curr.base = seq[s] || 'X'\n        curr.qual = qual?.[s]\n        curr.altbase = token\n        nextRecord()\n      }\n    }\n  }\n  return mismatchRecords\n}\n\nexport function getMismatches(\n  cigar: string,\n  md?: string,\n  seq?: string,\n  ref?: string,\n  qual?: Buffer,\n) {\n  let mismatches: Mismatch[] = []\n  const ops = parseCigar(cigar)\n\n  // parse the CIGAR tag if it has one\n  if (cigar) {\n    mismatches = mismatches.concat(cigarToMismatches(ops, seq, ref, qual))\n  }\n\n  // now let's look for CRAM or MD mismatches\n  if (md && seq) {\n    mismatches = mismatches.concat(\n      mdToMismatches(md, ops, mismatches, seq, qual),\n    )\n  }\n\n  return mismatches\n}\n// get relative reference sequence positions for positions given relative to\n// the read sequence\nexport function* getNextRefPos(cigarOps: string[], positions: number[]) {\n  let readPos = 0\n  let refPos = 0\n  let currPos = 0\n\n  for (let i = 0; i < cigarOps.length && currPos < positions.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'S' || op === 'I') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          currPos++\n        }\n      }\n      readPos += len\n    } else if (op === 'D' || op === 'N') {\n      refPos += len\n    } else if (op === 'M' || op === 'X' || op === '=') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          yield refPos + i\n          currPos++\n        }\n      }\n      readPos += len\n      refPos += len\n    }\n  }\n}\n\nexport function getModificationProbabilities(feature: Feature) {\n  const m = (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n  return m\n    ? (typeof m === 'string' ? m.split(',').map(e => +e) : m).map(e => e / 255)\n    : (getTagAlt(feature, 'MP', 'Mp') as string | undefined)\n        ?.split('')\n        .map(s => s.charCodeAt(0) - 33)\n        .map(elt => Math.min(1, elt / 50))\n}\n\nexport function getMethBins(feature: Feature) {\n  const fstart = feature.get('start')\n  const fend = feature.get('end')\n  const fstrand = feature.get('strand') as -1 | 0 | 1\n  const flen = fend - fstart\n  const mm = (getTagAlt(feature, 'MM', 'Mm') as string | undefined) || ''\n  const methBins = new Array<number>(flen)\n  const methProbs = new Array<number>(flen)\n  const seq = feature.get('seq') as string | undefined\n  if (seq) {\n    const ops = parseCigar(feature.get('CIGAR'))\n    const probabilities = getModificationProbabilities(feature)\n    const modifications = getModificationPositions(mm, seq, fstrand)\n    let probIndex = 0\n    for (const { type, positions } of modifications) {\n      if (type === 'm') {\n        for (const ref of getNextRefPos(ops, positions)) {\n          const prob = probabilities?.[probIndex] || 0\n          probIndex++\n          if (ref >= 0 && ref < flen) {\n            methBins[ref] = 1\n            methProbs[ref] = prob\n          }\n        }\n      }\n    }\n  }\n  return { methBins, methProbs }\n}\n\nexport function getModificationPositions(\n  mm: string,\n  fseq: string,\n  fstrand: number,\n) {\n  const seq = fstrand === -1 ? revcom(fseq) : fseq\n  const mods = mm.split(';').filter(mod => !!mod)\n  const result = []\n  for (const mod of mods) {\n    const [basemod, ...skips] = mod.split(',')\n\n    // regexes based on parse_mm.pl from hts-specs\n    const matches = basemod.match(modificationRegex)\n    if (!matches) {\n      throw new Error('bad format for MM tag')\n    }\n    const [, base, strand, typestr] = matches\n\n    // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n    // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n    const types = typestr.split(/(\\d+|.)/).filter(f => !!f)\n\n    if (strand === '-') {\n      console.warn('unsupported negative strand modifications')\n      // make sure to return a somewhat matching type even in this case\n      result.push({ type: 'unsupported', positions: [] as number[] })\n    }\n\n    // this logic also based on parse_mm.pl from hts-specs is that in the\n    // sequence of the read, if we have a modification type e.g. C+m;2 and a\n    // sequence ACGTACGTAC we skip the two instances of C and go to the last\n    // C\n    for (const type of types) {\n      let i = 0\n      const positions = []\n      for (const d of skips) {\n        let delta = +d\n        do {\n          if (base === 'N' || base === seq[i]) {\n            delta--\n          }\n          i++\n        } while (delta >= 0 && i < seq.length)\n\n        const temp = i - 1\n        positions.push(fstrand === -1 ? seq.length - 1 - temp : temp)\n      }\n      if (fstrand === -1) {\n        positions.sort((a, b) => a - b)\n      }\n      result.push({\n        type,\n        positions,\n      })\n    }\n  }\n  return result\n}\n\nexport function getModificationTypes(mm: string) {\n  return mm\n    .split(';')\n    .filter(mod => !!mod)\n    .flatMap(mod => {\n      const [basemod] = mod.split(',')\n\n      const matches = basemod.match(modificationRegex)\n      if (!matches) {\n        throw new Error(`bad format for MM tag: ${mm}`)\n      }\n      const typestr = matches[3]\n\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      return typestr.split(/(\\d+|.)/).filter(f => !!f)\n    })\n}\n\nexport function getOrientedCigar(flip: boolean, cigar: string[]) {\n  if (flip) {\n    const ret = []\n    for (let i = 0; i < cigar.length; i += 2) {\n      const len = cigar[i]\n      let op = cigar[i + 1]\n      if (op === 'D') {\n        op = 'I'\n      } else if (op === 'I') {\n        op = 'D'\n      }\n      ret.push(len, op)\n    }\n    return ret\n  } else {\n    return cigar\n  }\n}\n\nexport function getOrientedMismatches(flip: boolean, cigar: string) {\n  const p = parseCigar(cigar)\n  return cigarToMismatches(flip ? getOrientedCigar(flip, p) : p)\n}\n\nexport function getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nexport function getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(startClip) || [])[1] || 0\n    : +(cigar.match(endClip) || [])[1] || 0\n}\n\nexport function getTag(f: Feature, tag: string) {\n  const tags = f.get('tags')\n  return tags ? tags[tag] : f.get(tag)\n}\n\n// produces a list of \"feature-like\" object from parsing supplementary\n// alignments in the SA tag\n//\n// @param normalize - used specifically in the linear-read-vs-ref context, it\n// flips features around relative to the original feature. other contexts of\n// usage can keep this false\nexport function featurizeSA(\n  SA: string | undefined,\n  id: string,\n  strand: number,\n  readName: string,\n  normalize?: boolean,\n) {\n  return (\n    SA?.split(';')\n      .filter(aln => !!aln)\n      .map((aln, index) => {\n        const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n        const saLengthOnRef = getLengthOnRef(saCigar)\n        const saLength = getLength(saCigar)\n        const saLengthSansClipping = getLengthSansClipping(saCigar)\n        const saStrandNormalized = saStrand === '-' ? -1 : 1\n        const saClipPos = getClip(\n          saCigar,\n          (normalize ? strand : 1) * saStrandNormalized,\n        )\n        const saRealStart = +saStart - 1\n        return {\n          refName: saRef,\n          start: saRealStart,\n          end: saRealStart + saLengthOnRef,\n          seqLength: saLength,\n          clipPos: saClipPos,\n          CIGAR: saCigar,\n          strand: (normalize ? strand : 1) * saStrandNormalized,\n          uniqueId: `${id}_SA${index}`,\n          mate: {\n            start: saClipPos,\n            end: saClipPos + saLengthSansClipping,\n            refName: readName,\n          },\n        }\n      }) || []\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config CramAdapter\n * used to configure CRAM adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'CramAdapter',\n  {\n    /**\n     * #slot fetchSizeLimit\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      description:\n        'size in bytes over which to display a warning to the user that too much data will be fetched',\n      defaultValue: 3_000_000,\n    },\n\n    /**\n     * #slot cramLocation\n     */\n    cramLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.cram',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot craiLocation\n     */\n    craiLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.cram.crai',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot sequenceAdapter\n     * generally refers to the reference genome assembly's sequence adapter\n     * currently needs to be manually added\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description: 'sequence data adapter',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\n// locals\nimport configSchema from './configSchema'\n\nexport default function CramAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'CramAdapter',\n      displayName: 'CRAM adapter',\n      configSchema,\n      getAdapterClass: () => import('./CramAdapter').then(r => r.default),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config BamAdapter\n * used to configure BAM adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'BamAdapter',\n  {\n    /**\n     * #slot\n     */\n    bamLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bam', locationType: 'UriLocation' },\n    },\n\n    index: ConfigurationSchema('BamIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['BAI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'BAI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.bam.bai',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      description:\n        'size to fetch in bytes over which to display a warning to the user that too much data will be fetched',\n      defaultValue: 5_000_000,\n    },\n    /**\n     * #slot\n     * generally refers to the reference genome assembly's sequence adapter\n     * currently needs to be manually added\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description:\n        'sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function BamAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'BamAdapter',\n      displayName: 'BAM adapter',\n      configSchema,\n      getAdapterClass: () => import('./BamAdapter').then(r => r.default),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config HtsgetBamAdapter\n * Used to fetch data from Htsget endpoints in BAM format, using the gmod/bam library\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HtsgetBamAdapter = ConfigurationSchema(\n  'HtsgetBamAdapter',\n  {\n    /**\n     * #slot\n     */\n    htsgetBase: {\n      type: 'string',\n      description: 'the base URL to fetch from',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    htsgetTrackId: {\n      type: 'string',\n      description: 'the trackId, which is appended to the base URL',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description:\n        'sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HtsgetBamAdapter\n","import configSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nexport default function HtsgetBamAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'HtsgetBamAdapter',\n      displayName: 'Htsget BAM adapter',\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n      configSchema,\n      getAdapterClass: () => import('./HtsgetBamAdapter').then(r => r.default),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SNPCoverageAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'SNPCoverageAdapter',\n  {\n    /**\n     * #slot\n     * normally refers to a BAM or CRAM adapter\n     */\n    subadapter: {\n      type: 'frozen',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function SNPCoverageAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'SNPCoverageAdapter',\n      displayName: 'SNPCoverage adapter',\n      adapterMetadata: {\n        hiddenFromGUI: true,\n      },\n      getAdapterClass: () =>\n        import('./SNPCoverageAdapter').then(r => r.default),\n      configSchema,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SNPCoverageRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst SNPCoverageRenderer = ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {\n    /**\n     * #slot\n     */\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    indicatorThreshold: {\n      type: 'number',\n      description:\n        'the proportion of reads containing a insertion/clip indicator',\n      defaultValue: 0.4,\n    },\n    /**\n     * #slot\n     */\n    drawArcs: {\n      type: 'boolean',\n      description: 'Draw sashimi-style arcs for intron features',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    drawInterbaseCounts: {\n      type: 'boolean',\n      description:\n        'draw count \"upsidedown histogram\" of the interbase events that don\\'t contribute to the coverage count so are not drawn in the normal histogram',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    drawIndicators: {\n      type: 'boolean',\n      description:\n        'draw a triangular indicator where an event has been detected',\n      defaultValue: true,\n    },\n\n    color: {\n      type: 'color',\n      description: 'Background color for the SNPCoverage renderer',\n      defaultValue: '#d3d3d3',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default SNPCoverageRenderer\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { featureSpanPx, bpSpanPx, Feature } from '@jbrowse/core/util'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { RenderArgsDeserialized as FeatureRenderArgsDeserialized } from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport {\n  getOrigin,\n  getScale,\n  ScaleOpts,\n  WiggleBaseRenderer,\n  YSCALEBAR_LABEL_OFFSET,\n} from '@jbrowse/plugin-wiggle'\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  ticks: { values: number[] }\n  displayCrossHatches: boolean\n  modificationTagMap?: Record<string, string | undefined>\n}\n\ntype Counts = Record<string, { total: number; strands: Record<string, number> }>\n\ninterface SNPInfo {\n  cov: Counts\n  noncov: Counts\n  total: number\n}\n\nconst fudgeFactor = 0.6\n\nexport default class SNPCoverageRenderer extends WiggleBaseRenderer {\n  // note: the snps are drawn on linear scale even if the data is drawn in log\n  // scape hence the two different scales being used\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      displayCrossHatches,\n      modificationTagMap = {},\n      scaleOpts,\n      height: unadjustedHeight,\n      theme: configTheme,\n      config: cfg,\n      ticks,\n    } = props\n    const theme = createJBrowseTheme(configTheme)\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const offset = YSCALEBAR_LABEL_OFFSET\n    const height = unadjustedHeight - offset * 2\n\n    const { domain } = scaleOpts\n    if (!domain) {\n      return\n    }\n    const opts = { ...scaleOpts, range: [0, height] }\n    const viewScale = getScale(opts)\n\n    // clipping and insertion indicators, uses a smaller height/2 scale\n    const indicatorViewScale = getScale({\n      ...opts,\n      range: [0, height / 2],\n      scaleType: 'linear',\n    })\n    const originY = getOrigin(scaleOpts.scaleType)\n    const originLinear = getOrigin('linear')\n\n    const indicatorThreshold = readConfObject(cfg, 'indicatorThreshold')\n    const drawInterbaseCounts = readConfObject(cfg, 'drawInterbaseCounts')\n    const drawArcs = readConfObject(cfg, 'drawArcs')\n    const drawIndicators = readConfObject(cfg, 'drawIndicators')\n\n    // get the y coordinate that we are plotting at, this can be log scale\n    const toY = (n: number) => height - (viewScale(n) || 0) + offset\n    const toHeight = (n: number) => toY(originY) - toY(n)\n    // used specifically for indicator\n    const toY2 = (n: number) => height - (indicatorViewScale(n) || 0) + offset\n    const toHeight2 = (n: number) => toY2(originLinear) - toY2(n)\n\n    const { bases } = theme.palette\n    const colorForBase: Record<string, string> = {\n      A: bases.A.main,\n      C: bases.C.main,\n      G: bases.G.main,\n      T: bases.T.main,\n      insertion: 'purple',\n      softclip: 'blue',\n      hardclip: 'red',\n      total: readConfObject(cfg, 'color'),\n      meth: 'red',\n      unmeth: 'blue',\n    }\n\n    const feats = [...features.values()]\n    const coverage = feats.filter(f => f.get('type') !== 'skip')\n    const skips = feats.filter(f => f.get('type') === 'skip')\n\n    // Use two pass rendering, which helps in visualizing the SNPs at higher\n    // bpPerPx First pass: draw the gray background\n    ctx.fillStyle = colorForBase.total\n    for (const feature of coverage) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + fudgeFactor\n      const score = feature.get('score') as number\n      ctx.fillRect(leftPx, toY(score), w, toHeight(score))\n    }\n\n    // Keep track of previous total which we will use it to draw the interbase\n    // indicator (if there is a sudden clip, there will be no read coverage but\n    // there will be \"clip\" coverage) at that position beyond the read. if the\n    // clip is right at a block boundary then prevTotal will not be available,\n    // so this is a best attempt to plot interbase indicator at the \"cliffs\"\n    let prevTotal = 0\n\n    // extraHorizontallyFlippedOffset is used to draw interbase items, which\n    // are located to the left when forward and right when reversed\n    const extraHorizontallyFlippedOffset = region.reversed ? 1 / bpPerPx : 0\n\n    // Second pass: draw the SNP data, and add a minimum feature width of 1px\n    // which can be wider than the actual bpPerPx This reduces overdrawing of\n    // the grey background over the SNPs\n\n    for (const feature of coverage) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n      const score = feature.get('score') as number\n      const snpinfo = feature.get('snpinfo') as SNPInfo\n      const w = Math.max(rightPx - leftPx, 1)\n      const totalScore = snpinfo.total\n      const keys = Object.keys(snpinfo.cov).sort()\n\n      let curr = 0\n      for (const base of keys) {\n        const { total } = snpinfo.cov[base]\n        ctx.fillStyle =\n          colorForBase[base] ||\n          modificationTagMap[base.replace('mod_', '')] ||\n          'black'\n\n        const height = toHeight(score)\n        const bottom = toY(score) + height\n        ctx.fillRect(\n          Math.round(leftPx),\n          bottom - ((total + curr) / score) * height,\n          w,\n          (total / score) * height,\n        )\n        curr += total\n      }\n\n      const interbaseEvents = Object.keys(snpinfo.noncov)\n      const indicatorHeight = 4.5\n      if (drawInterbaseCounts) {\n        let curr = 0\n        for (const base of interbaseEvents) {\n          const { total } = snpinfo.noncov[base]\n          const r = 0.6\n          ctx.fillStyle = colorForBase[base]\n          ctx.fillRect(\n            leftPx - r + extraHorizontallyFlippedOffset,\n            indicatorHeight + toHeight2(curr),\n            r * 2,\n            toHeight2(total),\n          )\n          curr += total\n        }\n      }\n\n      if (drawIndicators) {\n        let accum = 0\n        let max = 0\n        let maxBase = ''\n        for (const base of interbaseEvents) {\n          const { total } = snpinfo.noncov[base]\n          accum += total\n          if (total > max) {\n            max = total\n            maxBase = base\n          }\n        }\n\n        // avoid drawing a bunch of indicators if coverage is very low e.g.\n        // less than 7, uses the prev total in the case of the \"cliff\"\n        const indicatorComparatorScore = Math.max(totalScore, prevTotal)\n        if (\n          accum > indicatorComparatorScore * indicatorThreshold &&\n          indicatorComparatorScore > 7\n        ) {\n          ctx.fillStyle = colorForBase[maxBase]\n          ctx.beginPath()\n          const l = leftPx + extraHorizontallyFlippedOffset\n          ctx.moveTo(l - 3.5, 0)\n          ctx.lineTo(l + 3.5, 0)\n          ctx.lineTo(l, indicatorHeight)\n          ctx.fill()\n        }\n      }\n      prevTotal = totalScore\n    }\n\n    if (drawArcs) {\n      for (const f of skips) {\n        const [left, right] = bpSpanPx(\n          f.get('start'),\n          f.get('end'),\n          region,\n          bpPerPx,\n        )\n\n        ctx.beginPath()\n        const str = f.get('strand') as number\n        const xs = f.get('xs') as string\n        const pos = 'rgba(255,200,200,0.7)'\n        const neg = 'rgba(200,200,255,0.7)'\n        const neutral = 'rgba(200,200,200,0.7)'\n\n        if (xs === '+') {\n          ctx.strokeStyle = pos\n        } else if (xs === '-') {\n          ctx.strokeStyle = neg\n        } else if (str === 1) {\n          ctx.strokeStyle = pos\n        } else if (str === -1) {\n          ctx.strokeStyle = neg\n        } else {\n          ctx.strokeStyle = neutral\n        }\n\n        ctx.lineWidth = Math.log(f.get('score') + 1)\n        ctx.moveTo(left, height - offset * 2)\n        ctx.bezierCurveTo(left, 0, right, 0, right, height - offset * 2)\n        ctx.stroke()\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(140,140,140,0.8)'\n      ticks.values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import configSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport SNPCoverageRenderer from './SNPCoverageRenderer'\n\nimport { WiggleRendering } from '@jbrowse/plugin-wiggle'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new SNPCoverageRenderer({\n        name: 'SNPCoverageRenderer',\n        ReactComponent: WiggleRendering,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import deepEqual from 'fast-deep-equal'\nimport { LayoutSession } from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nexport interface PileupLayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n  filterBy: unknown\n  sortedBy: unknown\n  showSoftClip: unknown\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedPileupLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n  filterBy: unknown\n  sortedBy: unknown\n  showSoftClip: boolean\n}\n// Sorting and revealing soft clip changes the layout of Pileup renderer\n// Adds extra conditions to see if cached layout is valid\nexport class PileupLayoutSession extends LayoutSession {\n  sortedBy: unknown\n  filterBy: unknown\n\n  showSoftClip = false\n\n  constructor(args: PileupLayoutSessionProps) {\n    super(args)\n    this.config = args.config\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedPileupLayout) {\n    return (\n      super.cachedLayoutIsValid(cachedLayout) &&\n      this.showSoftClip === cachedLayout.showSoftClip &&\n      deepEqual(this.sortedBy, cachedLayout.sortedBy) &&\n      deepEqual(this.filterBy, cachedLayout.filterBy)\n    )\n  }\n\n  cachedLayout: CachedPileupLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n        filterBy: this.filterBy,\n        sortedBy: this.sortedBy,\n        showSoftClip: this.showSoftClip,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n","import BoxRendererType, {\n  RenderArgsDeserialized as BoxRenderArgsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport {\n  Feature,\n  Region,\n  notEmpty,\n  renderToAbstractCanvas,\n} from '@jbrowse/core/util'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseLayout } from '@jbrowse/core/util/layouts/BaseLayout'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport {\n  PileupLayoutSession,\n  PileupLayoutSessionProps,\n} from './PileupLayoutSession'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\n// locals\nimport { fetchSequence, shouldFetchReferenceSequence } from '../util'\nimport { layoutFeats } from './layoutFeatures'\n\nexport interface RenderArgsDeserialized extends BoxRenderArgsDeserialized {\n  colorBy?: { type: string; tag?: string }\n  colorTagMap?: Record<string, string>\n  modificationTagMap?: Record<string, string | undefined>\n  sortedBy?: {\n    type: string\n    pos: number\n    refName: string\n    assemblyName: string\n    tag?: string\n  }\n  showSoftClip: boolean\n  highResolutionScaling: number\n}\n\nexport interface RenderArgsDeserializedWithFeaturesAndLayout\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n  regionSequence?: string\n}\n\nexport default class PileupRenderer extends BoxRendererType {\n  supportsSVG = true\n\n  async fetchSequence(renderProps: RenderArgsDeserialized) {\n    const { sessionId, regions, adapterConfig } = renderProps\n    const { sequenceAdapter } = adapterConfig\n    if (!sequenceAdapter) {\n      return undefined\n    }\n    const pm = this.pluginManager\n    const { dataAdapter } = await getAdapter(pm, sessionId, sequenceAdapter)\n    const [region] = regions\n    return fetchSequence(region, dataAdapter as BaseFeatureDataAdapter)\n  }\n\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    const { config, showSoftClip } = renderArgs\n    const { start, end } = region\n    const maxClippingSize = readConfObject(config, 'maxClippingSize')\n    const bpExpansion = showSoftClip ? Math.round(maxClippingSize) : 0\n\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(region as Omit<typeof region, symbol>),\n      start: Math.floor(Math.max(start - bpExpansion, 0)),\n      end: Math.ceil(end + bpExpansion),\n    }\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const layout = this.createLayoutInWorker(renderProps)\n    const { regions, bpPerPx } = renderProps\n    const [region] = regions\n\n    const layoutRecords = layoutFeats({\n      ...renderProps,\n      features,\n      layout,\n    })\n\n    // only need reference sequence if there are features and only for some\n    // cases\n    const regionSequence =\n      features.size && shouldFetchReferenceSequence(renderProps.colorBy?.type)\n        ? await this.fetchSequence(renderProps)\n        : undefined\n    const width = (region.end - region.start) / bpPerPx\n    const height = Math.max(layout.getTotalHeight(), 1)\n\n    const { makeImageData } = await import('./makeImageData')\n    const res = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      makeImageData({\n        ctx,\n        layoutRecords: layoutRecords.filter(notEmpty),\n        canvasWidth: width,\n        renderArgs: {\n          ...renderProps,\n          layout,\n          features,\n          regionSequence,\n        },\n      }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features: new Map(),\n      layout,\n      height,\n      width,\n      maxHeightReached: layout.maxHeightReached,\n    }\n  }\n\n  createSession(args: PileupLayoutSessionProps) {\n    return new PileupLayoutSession(args)\n  }\n}\n\nexport {\n  type RenderArgs,\n  type RenderResults,\n  type RenderArgsSerialized,\n  type ResultsSerialized,\n  type ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { iterMap } from '@jbrowse/core/util'\n\n// locals\nimport { layoutFeature } from './layoutFeature'\nimport { RenderArgsDeserializedWithFeaturesAndLayout } from './PileupRenderer'\nimport { sortFeature } from './sortUtil'\n\n// layout determines the height of the canvas that we use to render\nexport function layoutFeats(\n  props: RenderArgsDeserializedWithFeaturesAndLayout,\n) {\n  const { layout, features, sortedBy, config, bpPerPx, showSoftClip, regions } =\n    props\n  const [region] = regions\n  if (!layout) {\n    throw new Error(`layout required`)\n  }\n  if (!layout.addRect) {\n    throw new Error('invalid layout object')\n  }\n\n  const featureMap =\n    sortedBy?.type && region.start === sortedBy.pos\n      ? sortFeature(features, sortedBy)\n      : features\n\n  const heightPx = readConfObject(config, 'height')\n  const displayMode = readConfObject(config, 'displayMode')\n  return iterMap(\n    featureMap.values(),\n    feature =>\n      layoutFeature({\n        feature,\n        layout,\n        bpPerPx,\n        region,\n        showSoftClip,\n        heightPx,\n        displayMode,\n      }),\n    featureMap.size,\n  )\n}\n","import { doesIntersect2, Feature } from '@jbrowse/core/util'\nimport { Mismatch } from '../MismatchParser'\n\ninterface SortObject {\n  pos: number\n  type: string\n  tag?: string\n}\nexport const sortFeature = (\n  features: Map<string, Feature>,\n  sortedBy: SortObject,\n) => {\n  const featureArray = Array.from(features.values())\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // only sort on features that intersect center line, append those outside post-sort\n  featureArray.forEach(innerArray => {\n    const feature = innerArray\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(innerArray)\n    } else {\n      featuresOutsideCenter.push(innerArray)\n    }\n  })\n\n  const isCram = featureArray.length ? featureArray[0].get('tags') : false\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    case 'tag': {\n      const tag = sortedBy.tag!\n      const getTag = (f: Feature, t: string) => {\n        return isCram ? f.get('tags')[t] : f.get(t)\n      }\n      const isString =\n        featuresInCenterLine[0] &&\n        typeof getTag(featuresInCenterLine[0], tag) === 'string'\n      if (isString) {\n        featuresInCenterLine.sort((a, b) =>\n          getTag(b, tag).localeCompare(getTag(a, tag)),\n        )\n      } else {\n        featuresInCenterLine.sort(\n          (a, b) => (getTag(b, tag) || 0) - (getTag(a, tag) || 0),\n        )\n      }\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseSortArray: [string, Mismatch][] = []\n      featuresInCenterLine.forEach(feature => {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        mismatches.forEach(mismatch => {\n          const start = feature.get('start')\n          const offset = start + mismatch.start + 1\n          const consuming =\n            mismatch.type === 'insertion' || mismatch.type === 'softclip'\n          const len = consuming ? 0 : mismatch.length\n          if (pos >= offset && pos < offset + len) {\n            baseSortArray.push([feature.id(), mismatch])\n          }\n        })\n      })\n\n      const baseMap = new Map(baseSortArray)\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode = bMismatch?.base.toUpperCase()\n        const bcode = aMismatch?.base.toUpperCase()\n        if (acode === bcode && acode === '*') {\n          // @ts-expect-error\n          return aMismatch.length - bMismatch.length\n        }\n        return (\n          (acode ? acode.charCodeAt(0) : 0) - (bcode ? bcode.charCodeAt(0) : 0)\n        )\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  return new Map(\n    [...featuresInCenterLine, ...featuresOutsideCenter].map(feature => [\n      feature.id(),\n      feature,\n    ]),\n  )\n}\n","import { bpSpanPx, Feature, Region } from '@jbrowse/core/util'\nimport { BaseLayout } from '@jbrowse/core/util/layouts'\n// locals\nimport { Mismatch } from '../MismatchParser'\n\nexport interface LayoutRecord {\n  feature: Feature\n  leftPx: number\n  rightPx: number\n  topPx: number\n  heightPx: number\n}\n\nexport function layoutFeature({\n  feature,\n  layout,\n  bpPerPx,\n  region,\n  showSoftClip,\n  heightPx,\n  displayMode,\n}: {\n  feature: Feature\n  layout: BaseLayout<Feature>\n  bpPerPx: number\n  region: Region\n  showSoftClip?: boolean\n  heightPx: number\n  displayMode: string\n}): LayoutRecord | null {\n  let expansionBefore = 0\n  let expansionAfter = 0\n\n  // Expand the start and end of feature when softclipping enabled\n  if (showSoftClip) {\n    const mismatches = feature.get('mismatches') as Mismatch[]\n    const seq = feature.get('seq') as string\n    if (seq) {\n      for (const { type, start, cliplen = 0 } of mismatches) {\n        if (type === 'softclip') {\n          start === 0 ? (expansionBefore = cliplen) : (expansionAfter = cliplen)\n        }\n      }\n    }\n  }\n\n  const [leftPx, rightPx] = bpSpanPx(\n    feature.get('start') - expansionBefore,\n    feature.get('end') + expansionAfter,\n    region,\n    bpPerPx,\n  )\n\n  if (displayMode === 'compact') {\n    heightPx /= 3\n  }\n  if (feature.get('refName') !== region.refName) {\n    throw new Error(\n      `feature ${feature.id()} is not on the current region's reference sequence ${\n        region.refName\n      }`,\n    )\n  }\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start') - expansionBefore,\n    feature.get('end') + expansionAfter,\n    heightPx,\n    feature,\n  )\n  if (topPx === null) {\n    return null\n  }\n\n  return {\n    feature,\n    leftPx,\n    rightPx,\n    topPx: displayMode === 'collapse' ? 0 : topPx,\n    heightPx,\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config PileupRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PileupRenderer = ConfigurationSchema(\n  'PileupRenderer',\n  {\n    /**\n     * #slot\n     * default magenta here is used to detect the user has not customized this\n     */\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a pileup alignment',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    orientationType: {\n      type: 'stringEnum',\n      model: types.enumeration('orientationType', ['fr', 'rf', 'ff']),\n      defaultValue: 'fr',\n      description:\n        'read sequencer orientation. fr is normal \"reads pointing at each other ---> <--- while some other sequencers can use other options',\n    },\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    /**\n     * #slot\n     */\n    minSubfeatureWidth: {\n      type: 'number',\n      description:\n        'the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1',\n      defaultValue: 1,\n    },\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a pileup rendering',\n      defaultValue: 1200,\n    },\n    /**\n     * #slot\n     */\n    maxClippingSize: {\n      type: 'integer',\n      description: 'the max clip size to be used in a pileup rendering',\n      defaultValue: 10000,\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'the height of each feature in a pileup alignment',\n      defaultValue: 7,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    noSpacing: {\n      type: 'boolean',\n      description: 'remove spacing between features',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    largeInsertionIndicatorScale: {\n      type: 'number',\n      description:\n        'scale at which to draw the large insertion indicators (bp/pixel)',\n      defaultValue: 10,\n    },\n    /**\n     * #slot\n     */\n    mismatchAlpha: {\n      type: 'boolean',\n      defaultValue: false,\n      description: 'Fade low quality mismatches',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default PileupRenderer\n","import React, { useRef, useState, useEffect } from 'react'\nimport { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\n// used so that user can click-away-from-feature below the laid out features\n// (issue #1248)\nconst canvasPadding = 100\n\nconst PileupRendering = observer(function (props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: { type: string; pos: number; refName: string }\n  colorBy?: { type: string; tag?: string }\n  filterBy?: { tagFilter?: { tag: string } }\n  onMouseMove?: (event: React.MouseEvent, featureId?: string) => void\n}) {\n  const {\n    onMouseMove,\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n    colorBy,\n    filterBy,\n  } = props\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const [region] = regions\n  const highlightOverlayCanvas = useRef<HTMLCanvasElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n  useEffect(() => {\n    const canvas = highlightOverlayCanvas.current\n    if (!canvas) {\n      return\n    }\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    const selectedRect = selectedFeatureId\n      ? displayModel.getFeatureByID?.(blockKey, selectedFeatureId)\n      : undefined\n    if (selectedRect) {\n      const [leftBp, topPx, rightBp, bottomPx] = selectedRect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.shadowColor = '#222266'\n      ctx.shadowBlur = 10\n      ctx.lineJoin = 'bevel'\n      ctx.lineWidth = 2\n      ctx.strokeStyle = '#00b8ff'\n      ctx.strokeRect(\n        leftPx - 2,\n        rectTop - 2,\n        rightPx - leftPx + 4,\n        rectHeight + 4,\n      )\n      ctx.clearRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n    const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n    const highlightedRect = highlightedFeature\n      ? displayModel.getFeatureByID?.(blockKey, highlightedFeature)\n      : undefined\n    if (highlightedRect) {\n      const [leftBp, topPx, rightBp, bottomPx] = highlightedRect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.fillStyle = '#0003'\n      ctx.fillRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n  }, [\n    bpPerPx,\n    region,\n    blockKey,\n    selectedFeatureId,\n    displayModel,\n    featureIdUnderMouse,\n    contextMenuFeature,\n  ])\n\n  function onMouseDown(event: React.MouseEvent) {\n    setMouseIsDown(true)\n    setMovedDuringLastMouseDown(false)\n    callMouseHandler('MouseDown', event)\n  }\n\n  function onMouseEnter(event: React.MouseEvent) {\n    callMouseHandler('MouseEnter', event)\n  }\n\n  function onMouseOut(event: React.MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onMouseOver(event: React.MouseEvent) {\n    callMouseHandler('MouseOver', event)\n  }\n\n  function onMouseUp(event: React.MouseEvent) {\n    setMouseIsDown(false)\n    callMouseHandler('MouseUp', event)\n  }\n\n  function onClick(event: React.MouseEvent) {\n    if (!movedDuringLastMouseDown) {\n      callMouseHandler('Click', event)\n    }\n  }\n\n  function onMouseLeave(event: React.MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onContextMenu(event: React.MouseEvent) {\n    callMouseHandler('ContextMenu', event)\n  }\n\n  function mouseMove(event: React.MouseEvent) {\n    if (!highlightOverlayCanvas.current) {\n      return\n    }\n    if (mouseIsDown) {\n      setMovedDuringLastMouseDown(true)\n    }\n    const rect = highlightOverlayCanvas.current.getBoundingClientRect()\n    const offsetX = event.clientX - rect.left\n    const offsetY = event.clientY - rect.top\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n\n    onMouseMove?.(\n      event,\n      displayModel.getFeatureOverlapping(blockKey, clientBp, offsetY),\n    )\n  }\n\n  function callMouseHandler(handlerName: string, event: React.MouseEvent) {\n    // @ts-expect-error\n    const featureHandler = props[`onFeature${handlerName}`]\n    // @ts-expect-error\n    const canvasHandler = props[`on${handlerName}`]\n    if (featureHandler && featureIdUnderMouse) {\n      featureHandler(event, featureIdUnderMouse)\n    } else if (canvasHandler) {\n      canvasHandler(event, featureIdUnderMouse)\n    }\n  }\n\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      data-testid={`pileup-${[\n        sortedBy?.type,\n        colorBy?.type,\n        colorBy?.tag,\n        filterBy?.tagFilter?.tag,\n      ]\n        .filter(f => !!f)\n        .join('-')}`}\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n      <canvas\n        data-testid=\"pileup_overlay_canvas\"\n        width={canvasWidth}\n        height={height + canvasPadding}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n        className=\"highlightOverlayCanvas\"\n        ref={highlightOverlayCanvas}\n        onMouseDown={event => onMouseDown(event)}\n        onMouseEnter={event => onMouseEnter(event)}\n        onMouseOut={event => onMouseOut(event)}\n        onMouseOver={event => onMouseOver(event)}\n        onMouseUp={event => onMouseUp(event)}\n        onMouseLeave={event => onMouseLeave(event)}\n        onMouseMove={event => mouseMove(event)}\n        onClick={event => onClick(event)}\n        onContextMenu={event => onContextMenu(event)}\n        onFocus={() => {}}\n        onBlur={() => {}}\n      />\n    </div>\n  )\n})\n\nexport default PileupRendering\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport PileupRenderer from './PileupRenderer'\nimport configSchema from './configSchema'\nimport ReactComponent from './components/PileupRendering'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(() => {\n    return new PileupRenderer({\n      name: 'PileupRenderer',\n      displayName: 'Pileup renderer',\n      ReactComponent,\n      configSchema,\n      pluginManager,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nexport function getLowerPanelDisplays(pluginManager: PluginManager) {\n  return (\n    pluginManager\n      .getDisplayElements()\n      // @ts-expect-error\n      .filter(f => f.subDisplay?.type === 'LinearAlignmentsDisplay')\n      // @ts-expect-error\n      .filter(f => f.subDisplay?.lowerPanel)\n  )\n}\n","import React from 'react'\nimport { autorun, when } from 'mobx'\nimport {\n  addDisposer,\n  getSnapshot,\n  isAlive,\n  types,\n  Instance,\n  IStateTreeNode,\n} from 'mobx-state-tree'\nimport deepEqual from 'fast-deep-equal'\n\n// jbrowse\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\n\n// locals\nimport { LinearAlignmentsDisplayMixin } from './alignmentsModel'\nimport { getLowerPanelDisplays } from './util'\n\nconst minDisplayHeight = 20\n\nfunction deepSnap<T extends IStateTreeNode, U extends IStateTreeNode>(\n  x1: T,\n  x2: U,\n) {\n  return deepEqual(\n    x1 ? getSnapshot(x1) : undefined,\n    x2 ? getSnapshot(x2) : undefined,\n  )\n}\n\nfunction preCheck(self: AlignmentsDisplayModel) {\n  const { PileupDisplay, SNPCoverageDisplay } = self\n  return (\n    PileupDisplay ||\n    isAlive(PileupDisplay) ||\n    SNPCoverageDisplay ||\n    isAlive(SNPCoverageDisplay)\n  )\n}\n\nfunction propagateColorBy(self: AlignmentsDisplayModel) {\n  const { PileupDisplay, SNPCoverageDisplay } = self\n  if (!preCheck(self) || !PileupDisplay.colorBy) {\n    return\n  }\n  if (!deepSnap(PileupDisplay.colorBy, SNPCoverageDisplay.colorBy)) {\n    SNPCoverageDisplay.setColorBy(getSnapshot(PileupDisplay.colorBy))\n  }\n}\n\nfunction propagateFilterBy(self: AlignmentsDisplayModel) {\n  const { PileupDisplay, SNPCoverageDisplay } = self\n  if (!preCheck(self) || !PileupDisplay.filterBy) {\n    return\n  }\n  if (!deepSnap(PileupDisplay.filterBy, SNPCoverageDisplay.filterBy)) {\n    SNPCoverageDisplay.setFilterBy(getSnapshot(PileupDisplay.filterBy))\n  }\n}\n\n/**\n * #stateModel LinearAlignmentsDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [LinearAlignmentsDisplayMixin](../linearalignmentsdisplaymixin)\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearAlignmentsDisplay',\n      BaseDisplay,\n      LinearAlignmentsDisplayMixin(pluginManager, configSchema),\n    )\n    .volatile(() => ({\n      scrollTop: 0,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n\n      /**\n       * #action\n       */\n      setSNPCoverageHeight(n: number) {\n        self.snpCovHeight = n\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get height() {\n        return self.heightPreConfig ?? getConf(self, 'height')\n      },\n\n      /**\n       * #getter\n       */\n      get featureIdUnderMouse() {\n        return (\n          self.PileupDisplay.featureIdUnderMouse ||\n          self.SNPCoverageDisplay.featureIdUnderMouse\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get pileupConf() {\n        const conf = getConf(self, 'pileupDisplay')\n        return {\n          ...conf,\n          type: self.lowerPanelType,\n          displayId: `${self.configuration.displayId}_${self.lowerPanelType}_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n        }\n      },\n\n      /**\n       * #method\n       */\n      getFeatureByID(blockKey: string, id: string) {\n        return self.PileupDisplay.getFeatureByID(blockKey, id)\n      },\n      /**\n       * #method\n       */\n      searchFeatureByID(id: string) {\n        return self.PileupDisplay.searchFeatureByID?.(id)\n      },\n\n      /**\n       * #getter\n       */\n      get features() {\n        return self.PileupDisplay.features\n      },\n\n      /**\n       * #getter\n       */\n      get DisplayBlurb() {\n        return self.PileupDisplay?.DisplayBlurb\n      },\n\n      /**\n       * #getter\n       */\n      get sortedBy() {\n        return self.PileupDisplay.sortedBy\n      },\n\n      /**\n       * #getter\n       */\n      get coverageConf() {\n        const conf = getConf(self, 'snpCoverageDisplay')\n        return {\n          ...conf,\n          displayId: `${self.configuration.displayId}_snpcoverage_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSNPCoverageDisplay(configuration: AnyConfigurationModel) {\n        self.SNPCoverageDisplay = {\n          type: 'LinearSNPCoverageDisplay',\n          configuration,\n          height: self.snpCovHeight,\n        }\n      },\n      /**\n       * #action\n       */\n      setFeatureDensityStatsLimit(stats?: FeatureDensityStats) {\n        self.PileupDisplay.setFeatureDensityStatsLimit(stats)\n        self.SNPCoverageDisplay.setFeatureDensityStatsLimit(stats)\n      },\n\n      /**\n       * #action\n       */\n      setPileupDisplay(configuration: AnyConfigurationModel) {\n        self.PileupDisplay = {\n          type: configuration.type || 'LinearPileupDisplay',\n          configuration,\n        }\n      },\n      /**\n       * #action\n       */\n      setHeight(n: number) {\n        self.heightPreConfig = Math.max(n, minDisplayHeight)\n        return self.heightPreConfig\n      },\n      /**\n       * #action\n       */\n      setLowerPanelType(type: string) {\n        self.lowerPanelType = type\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const {\n              SNPCoverageDisplay,\n              PileupDisplay,\n              coverageConf,\n              pileupConf,\n            } = self\n\n            if (!SNPCoverageDisplay) {\n              self.setSNPCoverageDisplay(coverageConf)\n            } else if (\n              !deepEqual(\n                coverageConf,\n                getSnapshot(SNPCoverageDisplay.configuration),\n              )\n            ) {\n              SNPCoverageDisplay.setHeight(self.snpCovHeight)\n              SNPCoverageDisplay.setConfig(self.coverageConf)\n            }\n\n            if (!PileupDisplay || self.lowerPanelType !== PileupDisplay.type) {\n              self.setPileupDisplay(pileupConf)\n            } else if (\n              !deepEqual(pileupConf, getSnapshot(PileupDisplay.configuration))\n            ) {\n              PileupDisplay.setConfig(self.pileupConf)\n            }\n\n            propagateColorBy(self as AlignmentsDisplayModel)\n            propagateFilterBy(self as AlignmentsDisplayModel)\n          }),\n        )\n\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setSNPCoverageHeight(self.SNPCoverageDisplay.height)\n          }),\n        )\n\n        addDisposer(\n          self,\n          autorun(() => {\n            self.PileupDisplay.setHeight(\n              self.height - self.SNPCoverageDisplay.height,\n            )\n          }),\n        )\n      },\n      /**\n       * #action\n       */\n      async renderSvg(opts: { rasterizeLayers?: boolean }) {\n        const pileupHeight = self.height - self.SNPCoverageDisplay.height\n        await when(\n          () =>\n            !self.PileupDisplay.renderProps().notReady &&\n            !self.SNPCoverageDisplay.renderProps().notReady,\n        )\n        return (\n          <>\n            <g>{await self.SNPCoverageDisplay.renderSvg(opts)}</g>\n            <g transform={`translate(0 ${self.SNPCoverageDisplay.height})`}>\n              {await self.PileupDisplay.renderSvg({\n                ...opts,\n                overrideHeight: pileupHeight,\n              })}\n            </g>\n          </>\n        )\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems(): MenuItem[] {\n          if (!self.PileupDisplay) {\n            return []\n          }\n          const extra = getLowerPanelDisplays(pluginManager).map(d => ({\n            type: 'radio',\n            label: d.displayName,\n            checked: d.name === self.PileupDisplay.type,\n            onClick: () => self.setLowerPanelType(d.name),\n          }))\n          return [\n            ...superTrackMenuItems(),\n            {\n              type: 'subMenu',\n              label: 'Pileup settings',\n              subMenu: self.PileupDisplay.trackMenuItems(),\n            },\n            {\n              type: 'subMenu',\n              label: 'SNPCoverage settings',\n              subMenu: self.SNPCoverageDisplay.trackMenuItems(),\n            },\n            {\n              type: 'subMenu',\n              label: `Replace lower panel with...`,\n              subMenu: extra,\n            },\n          ]\n        },\n      }\n    })\n    .preProcessSnapshot(snap => {\n      if (!snap) {\n        return snap\n      }\n      // @ts-expect-error\n      const { height, ...rest } = snap\n      return { heightPreConfig: height, ...rest }\n    })\n}\n\nexport default stateModelFactory\nexport type AlignmentsDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type AlignmentsDisplayModel = Instance<AlignmentsDisplayStateModel>\n","import { types } from 'mobx-state-tree'\n\n// jbrowse\nimport {\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getLowerPanelDisplays } from './util'\n\n/**\n * #stateModel LinearAlignmentsDisplayMixin\n */\nexport function LinearAlignmentsDisplayMixin(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  const lowerPanelDisplays = getLowerPanelDisplays(pluginManager).map(\n    f => f.stateModel,\n  )\n\n  return types.model({\n    /**\n     * #property\n     * refers to LinearPileupDisplay sub-display model\n     */\n    PileupDisplay: types.maybe(types.union(...lowerPanelDisplays)),\n    /**\n     * #property\n     * refers to LinearSNPCoverageDisplay sub-display model\n     */\n    SNPCoverageDisplay: types.maybe(\n      pluginManager.getDisplayType('LinearSNPCoverageDisplay').stateModel,\n    ),\n    /**\n     * #property\n     */\n    snpCovHeight: 45,\n    /**\n     * #property\n     */\n    type: types.literal('LinearAlignmentsDisplay'),\n    /**\n     * #property\n     */\n    configuration: ConfigurationReference(configSchema),\n    /**\n     * #property\n     */\n    heightPreConfig: types.maybe(types.number),\n    /**\n     * #property\n     */\n    userFeatureScreenDensity: types.maybe(types.number),\n    /**\n     * #property\n     */\n    lowerPanelType: 'LinearPileupDisplay',\n  })\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\n\n// locals\nimport { AlignmentsDisplayModel } from '../models/model'\n\nconst useStyles = makeStyles()({\n  resizeHandle: {\n    height: 5,\n    position: 'absolute',\n    zIndex: 2,\n  },\n})\n\nconst AlignmentsDisplay = observer(function AlignmentsDisplay({\n  model,\n}: {\n  model: AlignmentsDisplayModel\n}) {\n  const { PileupDisplay, SNPCoverageDisplay } = model\n  const { classes } = useStyles()\n  if (!SNPCoverageDisplay) {\n    return null\n  }\n  const top = SNPCoverageDisplay.height ?? 100\n  return (\n    <div\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      style={{ position: 'relative' }}\n    >\n      <div data-testid=\"Blockset-snpcoverage\">\n        <SNPCoverageDisplay.RenderingComponent model={SNPCoverageDisplay} />\n      </div>\n      <ResizeHandle\n        onDrag={delta => {\n          SNPCoverageDisplay.setHeight(SNPCoverageDisplay.height + delta)\n          return delta\n        }}\n        className={classes.resizeHandle}\n        style={{ top: top - 4 }}\n      />\n\n      <div\n        data-testid=\"Blockset-pileup\"\n        style={{\n          position: 'absolute',\n          top,\n        }}\n      >\n        <PileupDisplay.RenderingComponent model={PileupDisplay} />\n      </div>\n    </div>\n  )\n})\n\nexport default AlignmentsDisplay\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n// locals\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport ReactComponent from './components/AlignmentsDisplay'\n\nexport default function LinearAlignmentsDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearAlignmentsDisplay',\n      displayName: 'Alignments display (combination)',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearAlignmentsDisplay\n * has a \"pileup\" sub-display, where you can see individual reads and a\n * quantitative \"snpcoverage\" sub-display track showing SNP frequencies\n */\nexport default function configModelFactory(pm: PluginManager) {\n  return ConfigurationSchema(\n    'LinearAlignmentsDisplay',\n    {\n      /**\n       * #slot\n       */\n      pileupDisplay: pm.getDisplayType('LinearPileupDisplay').configSchema,\n\n      /**\n       * #slot\n       */\n      snpCoverageDisplay: pm.getDisplayType('LinearSNPCoverageDisplay')\n        .configSchema,\n\n      /**\n       * #slot\n       */\n      height: {\n        type: 'number',\n        defaultValue: 250,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature, toLocale } from '@jbrowse/core/util'\nimport { Tooltip } from '@jbrowse/plugin-wiggle'\n\ntype Count = Record<\n  string,\n  {\n    total: number\n    '-1': number\n    '0': number\n    '1': number\n  }\n>\n\ninterface SNPInfo {\n  cov: Count\n  lowqual: Count\n  noncov: Count\n  delskips: Count\n  refbase: string\n  total: number\n  ref: number\n  all: number\n  '-1': number\n  '0': number\n  '1': number\n}\n\nconst toP = (s = 0) => +(+s).toFixed(1)\n\nconst pct = (n: number, total: number) => `${toP((n / (total || 1)) * 100)}%`\n\ninterface Props {\n  feature: Feature\n}\n\nconst TooltipContents = React.forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ feature }, reactRef) {\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const name = feature.get('refName')\n    const {\n      refbase,\n      all,\n      total,\n      ref,\n      '-1': rn1,\n      '1': r1,\n      '0': r0,\n      ...info\n    } = feature.get('snpinfo') as SNPInfo\n    const loc = [\n      name,\n      start === end ? toLocale(start) : `${toLocale(start)}..${toLocale(end)}`,\n    ]\n      .filter(f => !!f)\n      .join(':')\n\n    return (\n      <div ref={reactRef}>\n        <table>\n          <caption>{loc}</caption>\n          <thead>\n            <tr>\n              <th>Base</th>\n              <th>Count</th>\n              <th>% of Total</th>\n              <th>Strands</th>\n              <th>Source</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td>Total</td>\n              <td>{all}</td>\n            </tr>\n            <tr>\n              <td>REF {refbase ? `(${refbase.toUpperCase()})` : ''}</td>\n              <td>{ref}</td>\n              <td>{pct(ref, all)}</td>\n              <td>\n                {rn1 ? `${rn1}(-)` : ''}\n                {r1 ? `${r1}(+)` : ''}\n              </td>\n              <td />\n            </tr>\n\n            {Object.entries(info).map(([key, entry]) =>\n              Object.entries(entry).map(([base, score]) => (\n                <tr key={base}>\n                  <td>{base.toUpperCase()}</td>\n                  <td>{score.total}</td>\n                  <td>\n                    {base === 'total' || base === 'skip'\n                      ? '---'\n                      : pct(score.total, all)}\n                  </td>\n                  <td>\n                    {score['-1'] ? `${score['-1']}(-)` : ''}\n                    {score['1'] ? `${score['1']}(+)` : ''}\n                  </td>\n                  <td>{key}</td>\n                </tr>\n              )),\n            )}\n          </tbody>\n        </table>\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst SNPCoverageTooltip = observer(\n  (props: {\n    model: { featureUnderMouse: Feature }\n    height: number\n    offsetMouseCoord: Coord\n    clientMouseCoord: Coord\n    clientRect?: DOMRect\n  }) => {\n    const { model } = props\n    const { featureUnderMouse: feat } = model\n    return feat && feat.get('type') === 'skip' ? null : (\n      <Tooltip TooltipContents={TooltipContents} {...props} />\n    )\n  },\n)\n\nexport default SNPCoverageTooltip\n","import { types, IAnyStateTreeNode } from 'mobx-state-tree'\nimport { BlockSet } from '@jbrowse/core/util/blockTypes'\nimport { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\nexport async function getUniqueTagValues(\n  self: IAnyStateTreeNode & { adapterConfig: AnyConfigurationModel },\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n\ntype Track = IAnyStateTreeNode & { configuration: AnyConfigurationModel }\n\nexport async function getUniqueModificationValues(\n  self: IAnyStateTreeNode & {\n    parentTrack: Track\n  },\n  adapterConfig: AnyConfigurationModel,\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    sessionId,\n    'PileupGetVisibleModifications',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n\nexport const FilterModel = types.model({\n  flagInclude: types.optional(types.number, 0),\n  flagExclude: types.optional(types.number, 1540),\n  readName: types.maybe(types.string),\n  tagFilter: types.maybe(\n    types.model({\n      tag: types.string,\n      value: types.string,\n    }),\n  ),\n})\n\nexport interface IFilter {\n  flagExclude: number\n  flagInclude: number\n  readName?: string\n  tagFilter?: { tag: string; value: string }\n}\n","import { types, cast, getEnv, getSnapshot, isAlive } from 'mobx-state-tree'\nimport { observable } from 'mobx'\n\n// jbrowse\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  getConf,\n  readConfObject,\n  AnyConfigurationSchemaType,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\n\n// locals\nimport Tooltip from '../components/Tooltip'\nimport { FilterModel, IFilter, getUniqueModificationValues } from '../../shared'\nimport { createAutorun, modificationColors } from '../../util'\nimport { randomColor } from '../../util'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([['snpcoverage', 'SNPCoverageRenderer']])\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearSNPCoverageDisplay\n * extends\n * - [LinearWiggleDisplay](../linearwiggledisplay)\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearSNPCoverageDisplay',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSNPCoverageDisplay'),\n        /**\n         * #property\n         */\n        drawInterbaseCounts: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        drawIndicators: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        drawArcs: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        filterBy: types.optional(FilterModel, {}),\n        /**\n         * #property\n         */\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n          }),\n        ),\n        /**\n         * #property\n         */\n        jexlFilters: types.optional(types.array(types.string), []),\n      }),\n    )\n    .volatile(() => ({\n      modificationTagMap: observable.map<string, string>({}),\n      modificationsReady: false,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n      /**\n       * #action\n       */\n      setFilterBy(filter: IFilter) {\n        self.filterBy = cast(filter)\n      },\n      /**\n       * #action\n       */\n      setColorBy(colorBy?: { type: string; tag?: string }) {\n        self.colorBy = cast(colorBy)\n      },\n      /**\n       * #action\n       */\n      setJexlFilters(filters: string[]) {\n        self.jexlFilters = cast(filters)\n      },\n\n      /**\n       * #action\n       */\n      updateModificationColorMap(uniqueModifications: string[]) {\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            self.modificationTagMap.set(\n              value,\n              modificationColors[value] || randomColor(),\n            )\n          }\n        })\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #getter\n         */\n        get rendererConfig() {\n          const configBlob =\n            getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n          return self.rendererType.configSchema.create(\n            {\n              ...configBlob,\n              drawInterbaseCounts:\n                self.drawInterbaseCounts ?? configBlob.drawInterbaseCounts,\n              drawIndicators: self.drawIndicators ?? configBlob.drawIndicators,\n              drawArcs: self.drawArcs ?? configBlob.drawArcs,\n            },\n            getEnv(self),\n          )\n        },\n        /**\n         * #getter\n         */\n        get drawArcsSetting() {\n          return (\n            self.drawArcs ?? readConfObject(this.rendererConfig, 'drawArcs')\n          )\n        },\n        /**\n         * #getter\n         */\n        get drawInterbaseCountsSetting() {\n          return (\n            self.drawInterbaseCounts ??\n            readConfObject(this.rendererConfig, 'drawInterbaseCounts')\n          )\n        },\n        /**\n         * #getter\n         */\n        get drawIndicatorsSetting() {\n          return (\n            self.drawIndicators ??\n            readConfObject(this.rendererConfig, 'drawIndicators')\n          )\n        },\n\n        /**\n         * #getter\n         */\n        get autorunReady() {\n          const view = getContainingView(self) as LGV\n          return (\n            view.initialized &&\n            self.featureDensityStatsReady &&\n            !self.regionTooLarge &&\n            !self.error\n          )\n        },\n\n        get renderReady() {\n          const superProps = superRenderProps()\n          return !superProps.notReady && self.modificationsReady\n        },\n\n        get ready() {\n          return this.renderReady\n        },\n\n        /**\n         * #method\n         */\n        renderProps() {\n          const superProps = superRenderProps()\n          const { colorBy, filterBy, modificationTagMap } = self\n          return {\n            ...superProps,\n            notReady: !this.ready,\n            filters: self.filters,\n            modificationTagMap: Object.fromEntries(modificationTagMap.toJSON()),\n\n            // must use getSnapshot because otherwise changes to e.g. just the\n            // colorBy.type are not read\n            colorBy: colorBy ? getSnapshot(colorBy) : undefined,\n            filterBy: filterBy ? getSnapshot(filterBy) : undefined,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setModificationsReady(flag: boolean) {\n        self.modificationsReady = flag\n      },\n      /**\n       * #action\n       */\n      toggleDrawIndicators() {\n        self.drawIndicators = !self.drawIndicatorsSetting\n      },\n      /**\n       * #action\n       */\n      toggleDrawInterbaseCounts() {\n        self.drawInterbaseCounts = !self.drawInterbaseCountsSetting\n      },\n      /**\n       * #action\n       */\n      toggleDrawArcs() {\n        self.drawArcs = !self.drawArcsSetting\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        createAutorun(\n          self,\n          async () => {\n            self.setModificationsReady(false)\n            if (!self.autorunReady) {\n              return\n            }\n            const view = getContainingView(self) as LGV\n            const { staticBlocks } = view\n            const { colorBy } = self\n            if (colorBy?.type === 'modifications') {\n              const adapter = getConf(self.parentTrack, 'adapter')\n              const vals = await getUniqueModificationValues(\n                self,\n                adapter,\n                colorBy,\n                staticBlocks,\n              )\n              if (isAlive(self)) {\n                self.updateModificationColorMap(vals)\n                self.setModificationsReady(true)\n              }\n            } else {\n              self.setModificationsReady(true)\n            }\n          },\n          { delay: 1000 },\n        )\n      },\n    }))\n\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        /**\n         * #getter\n         */\n        get TooltipComponent() {\n          return Tooltip\n        },\n\n        /**\n         * #getter\n         */\n        get adapterConfig() {\n          const subadapter = getConf(self.parentTrack, 'adapter')\n          return {\n            type: 'SNPCoverageAdapter',\n            subadapter,\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return rendererTypes.get('snpcoverage')\n        },\n\n        /**\n         * #getter\n         */\n        get needsScalebar() {\n          return true\n        },\n\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          return []\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Draw insertion/clipping indicators',\n              type: 'checkbox',\n              checked: self.drawIndicatorsSetting,\n              onClick: () => self.toggleDrawIndicators(),\n            },\n            {\n              label: 'Draw insertion/clipping counts',\n              type: 'checkbox',\n              checked: self.drawInterbaseCountsSetting,\n              onClick: () => self.toggleDrawInterbaseCounts(),\n            },\n            {\n              label: 'Draw arcs',\n              type: 'checkbox',\n              checked: self.drawArcsSetting,\n              onClick: () => self.toggleDrawArcs(),\n            },\n          ]\n        },\n\n        /**\n         * #getter\n         */\n        get filters() {\n          return new SerializableFilterChain({ filters: self.jexlFilters })\n        },\n      }\n    })\n}\n\nexport type SNPCoverageDisplayModel = ReturnType<typeof stateModelFactory>\n\nexport default stateModelFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearSNPCoverageDisplay',\n      displayName: 'SNPCoverage display',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearSNPCoverageDisplay\n *\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function SNPCoverageConfigFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSNPCoverageDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description:\n          'performs local autoscaling (no other options for SNP Coverage available)',\n      },\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      /**\n       * #slot\n       */ inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n      /**\n       * #slot\n       */\n      multiTicks: {\n        type: 'boolean',\n        description: 'Display multiple values for the ticks',\n        defaultValue: false,\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        SNPCoverageRenderer: pluginManager.getRendererType(\n          'SNPCoverageRenderer',\n        ).configSchema,\n      }),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import React from 'react'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport {\n  BlockMsg,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { Button, Tooltip } from '@mui/material'\n\n// local\nimport { LinearReadCloudDisplayModel } from '../LinearReadCloudDisplay/model'\nimport { LinearReadArcsDisplayModel } from '../LinearReadArcsDisplay/model'\n\nconst useStyles = makeStyles()(theme => ({\n  loading: {\n    backgroundColor: theme.palette.background.default,\n    backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 5px, ${theme.palette.action.disabledBackground} 5px, ${theme.palette.action.disabledBackground} 10px)`,\n    position: 'absolute',\n    bottom: 0,\n    height: 50,\n    width: 300,\n    right: 0,\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n}))\n\nconst BaseDisplayComponent = observer(function ({\n  model,\n  children,\n}: {\n  model: LinearReadArcsDisplayModel | LinearReadCloudDisplayModel\n  children?: React.ReactNode\n}) {\n  const { error, regionTooLarge } = model\n  return error ? (\n    <BlockMsg\n      message={`${error}`}\n      severity=\"error\"\n      action={\n        <Tooltip title=\"Reload\">\n          <Button data-testid=\"reload_button\" onClick={() => model.reload()}>\n            Reload\n          </Button>\n        </Tooltip>\n      }\n    />\n  ) : regionTooLarge ? (\n    model.regionCannotBeRendered()\n  ) : (\n    <DataDisplay model={model}>{children}</DataDisplay>\n  )\n})\n\nconst DataDisplay = observer(function ({\n  model,\n  children,\n}: {\n  model: LinearReadArcsDisplayModel | LinearReadCloudDisplayModel\n  children?: React.ReactNode\n}) {\n  const { drawn, loading } = model\n  const view = getContainingView(model) as LinearGenomeViewModel\n  const left = (model.lastDrawnOffsetPx || 0) - view.offsetPx\n  return (\n    // this data-testid is located here because changing props on the canvas\n    // itself is very sensitive to triggering ref invalidation\n    <div data-testid={`drawn-${drawn}`}>\n      <div style={{ position: 'absolute', left }}>{children}</div>\n      {left !== 0 || loading ? <LoadingBar model={model} /> : null}\n    </div>\n  )\n})\n\nconst LoadingBar = observer(function ({\n  model,\n}: {\n  model: LinearReadArcsDisplayModel | LinearReadCloudDisplayModel\n}) {\n  const { classes } = useStyles()\n  const { message } = model\n  return (\n    <div className={classes.loading}>\n      <LoadingEllipses message={message} />\n    </div>\n  )\n})\n\nexport default BaseDisplayComponent\n","import React, { useCallback } from 'react'\nimport { observer } from 'mobx-react'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// local\nimport { LinearReadArcsDisplayModel } from '../model'\nimport BaseDisplayComponent from '../../shared/BaseDisplayComponent'\n\ntype LGV = LinearGenomeViewModel\n\nconst Arcs = observer(function ({\n  model,\n}: {\n  model: LinearReadArcsDisplayModel\n}) {\n  const view = getContainingView(model) as LGV\n  const width = Math.round(view.dynamicBlocks.totalWidthPx)\n  const height = model.height\n  const cb = useCallback(\n    (ref: HTMLCanvasElement) => {\n      model.setRef(ref)\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [model, width, height],\n  )\n\n  // note: the position absolute below avoids scrollbar from appearing on track\n  return (\n    <canvas\n      data-testid=\"arc-canvas\"\n      ref={cb}\n      style={{ width, height, position: 'absolute' }}\n      width={width * 2}\n      height={height * 2}\n    />\n  )\n})\n\nconst LinearReadArcsReactComponent = observer(function ({\n  model,\n}: {\n  model: LinearReadArcsDisplayModel\n}) {\n  return (\n    <BaseDisplayComponent model={model}>\n      <Arcs model={model} />\n    </BaseDisplayComponent>\n  )\n})\n\nexport default LinearReadArcsReactComponent\n","import React, { lazy } from 'react'\nimport { cast, types, Instance } from 'mobx-state-tree'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes'\nimport {\n  FeatureDensityMixin,\n  TrackHeightMixin,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport FilterListIcon from '@mui/icons-material/ClearAll'\n\n// locals\nimport { FilterModel, IFilter } from '../shared'\nimport { ChainData } from '../shared/fetchChains'\n\n// async\nconst FilterByTagDialog = lazy(() => import('../shared/FilterByTag'))\n\n/**\n * #stateModel LinearReadArcsDisplay\n * the arc display is a non-block-based track, so draws to a single canvas and\n * can connect multiple regions\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReadArcsDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearReadArcsDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n\n        /**\n         * #property\n         */\n        filterBy: types.optional(FilterModel, {}),\n\n        /**\n         * #property\n         */\n        lineWidth: types.maybe(types.number),\n\n        /**\n         * #property\n         */\n        jitter: types.maybe(types.number),\n\n        /**\n         * #property\n         */\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n            extra: types.frozen(),\n          }),\n        ),\n\n        /**\n         * #property\n         */\n        drawInter: true,\n\n        /**\n         * #property\n         */\n        drawLongRange: true,\n      }),\n    )\n    .volatile(() => ({\n      loading: false,\n      chainData: undefined as ChainData | undefined,\n      lastDrawnOffsetPx: undefined as number | undefined,\n      lastDrawnBpPerPx: 0,\n      ref: null as HTMLCanvasElement | null,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setLastDrawnOffsetPx(n: number) {\n        self.lastDrawnOffsetPx = n\n      },\n      /**\n       * #action\n       */\n      setLastDrawnBpPerPx(n: number) {\n        self.lastDrawnBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      setLoading(f: boolean) {\n        self.loading = f\n      },\n\n      /**\n       * #action\n       */\n      reload() {\n        self.error = undefined\n      },\n      /**\n       * #action\n       * internal, a reference to a HTMLCanvas because we use a autorun to draw\n       * the canvas\n       */\n      setRef(ref: HTMLCanvasElement | null) {\n        self.ref = ref\n      },\n\n      /**\n       * #action\n       */\n      setColorScheme(s: { type: string }) {\n        self.colorBy = cast(s)\n      },\n\n      /**\n       * #action\n       */\n      setChainData(args: ChainData) {\n        self.chainData = args\n      },\n\n      /**\n       * #action\n       */\n      setDrawInter(f: boolean) {\n        self.drawInter = f\n      },\n\n      /**\n       * #action\n       */\n      setDrawLongRange(f: boolean) {\n        self.drawLongRange = f\n      },\n\n      /**\n       * #action\n       */\n      setFilterBy(filter: IFilter) {\n        self.filterBy = cast(filter)\n      },\n\n      /**\n       * #action\n       * thin, bold, extrabold, etc\n       */\n      setLineWidth(n: number) {\n        self.lineWidth = n\n      },\n\n      /**\n       * #action\n       * jitter val, helpful to jitter the x direction so you see better\n       * evidence when e.g. 100 long reads map to same x position\n       */\n      setJitter(n: number) {\n        self.jitter = n\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get drawn() {\n        return self.lastDrawnOffsetPx !== undefined\n      },\n      /**\n       * #getter\n       */\n      get lineWidthSetting() {\n        return self.lineWidth ?? getConf(self, 'lineWidth')\n      },\n\n      /**\n       * #getter\n       */\n      get jitterVal(): number {\n        return self.jitter ?? getConf(self, 'jitter')\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n      return {\n        /**\n         * #method\n         * only used to tell system it's ready for export\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            notReady: !self.chainData,\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  FilterByTagDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n            {\n              label: 'Line width',\n              subMenu: [\n                {\n                  label: 'Thin',\n                  onClick: () => self.setLineWidth(1),\n                },\n                {\n                  label: 'Bold',\n                  onClick: () => self.setLineWidth(2),\n                },\n                {\n                  label: 'Extra bold',\n                  onClick: () => self.setLineWidth(5),\n                },\n              ],\n            },\n            {\n              label: 'Jitter x-positions',\n              subMenu: [\n                {\n                  type: 'checkbox',\n                  checked: self.jitterVal === 0,\n                  label: 'None',\n                  onClick: () => self.setJitter(0),\n                },\n                {\n                  type: 'checkbox',\n                  checked: self.jitterVal === 2,\n                  label: 'Small',\n                  onClick: () => self.setJitter(2),\n                },\n                {\n                  type: 'checkbox',\n                  checked: self.jitterVal === 10,\n                  label: 'Large',\n                  onClick: () => self.setJitter(10),\n                },\n              ],\n            },\n            {\n              label: 'Draw inter-region vertical lines',\n              type: 'checkbox',\n              checked: self.drawInter,\n              onClick: () => self.setDrawInter(!self.drawInter),\n            },\n            {\n              label: 'Draw long range connections',\n              type: 'checkbox',\n              checked: self.drawLongRange,\n              onClick: () => self.setDrawLongRange(!self.drawLongRange),\n            },\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Insert size ± 3σ and orientation',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'insertSizeAndOrientation' }),\n                },\n                {\n                  label: 'Insert size ± 3σ',\n                  onClick: () => self.setColorScheme({ type: 'insertSize' }),\n                },\n                {\n                  label: 'Orientation',\n                  onClick: () => self.setColorScheme({ type: 'orientation' }),\n                },\n                {\n                  label: 'Insert size gradient',\n                  onClick: () => self.setColorScheme({ type: 'gradient' }),\n                },\n              ],\n            },\n          ]\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #method\n       */\n      async renderSvg(opts: {\n        rasterizeLayers?: boolean\n      }): Promise<React.ReactNode> {\n        const { renderSvg } = await import('../shared/renderSvg')\n        const { drawFeats } = await import('./drawFeats')\n        return renderSvg(self as LinearReadArcsDisplayModel, opts, drawFeats)\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('../shared/afterAttach')\n            const { drawFeats } = await import('./drawFeats')\n            doAfterAttach(self, drawFeats)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n    }))\n}\n\nexport type LinearReadArcsDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearReadArcsDisplayModel =\n  Instance<LinearReadArcsDisplayStateModel>\n\nexport default stateModelFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\n// locals\nimport ReactComponent from './components/ReactComponent'\nimport configSchemaF from './configSchema'\nimport stateModelF from './model'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearReadArcsDisplay',\n      displayName: 'Arc display',\n      configSchema,\n      stateModel: stateModelF(configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      subDisplay: { type: 'LinearAlignmentsDisplay', lowerPanel: true },\n      ReactComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config LinearReadArcsDisplay\n */\nfunction configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearReadArcsDisplay',\n    {\n      /**\n       * #slot\n       */\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n\n      /**\n       * #slot\n       */\n      lineWidth: {\n        type: 'number',\n        description: 'set arc line width',\n        defaultValue: 1,\n      },\n\n      /**\n       * #slot\n       */\n      jitter: {\n        type: 'number',\n        description:\n          'jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them',\n        defaultValue: 0,\n      },\n\n      /**\n       * #slot\n       */\n      colorScheme: {\n        type: 'stringEnum',\n        model: types.enumeration('colorScheme', [\n          'strand',\n          'normal',\n          'insertSize',\n          'insertSizeAndOrientation',\n          'mappingQuality',\n          'tag',\n        ]),\n        description: 'color scheme to use',\n        defaultValue: 'normal',\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import React, { useCallback } from 'react'\nimport { observer } from 'mobx-react'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// local\nimport { LinearReadCloudDisplayModel } from '../model'\nimport BaseDisplayComponent from '../../shared/BaseDisplayComponent'\n\ntype LGV = LinearGenomeViewModel\n\nconst Cloud = observer(function ({\n  model,\n}: {\n  model: LinearReadCloudDisplayModel\n}) {\n  const view = getContainingView(model) as LGV\n  const width = Math.round(view.dynamicBlocks.totalWidthPx)\n  const height = model.height\n  const cb = useCallback(\n    (ref: HTMLCanvasElement) => model.setRef(ref),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [model, width, height],\n  )\n\n  // note: the position absolute below avoids scrollbar from appearing on track\n  return (\n    <canvas\n      data-testid=\"cloud-canvas\"\n      ref={cb}\n      style={{ width, height, position: 'absolute' }}\n      width={width * 2}\n      height={height * 2}\n    />\n  )\n})\n\nconst LinearReadCloudReactComponent = observer(function ({\n  model,\n}: {\n  model: LinearReadCloudDisplayModel\n}) {\n  return (\n    <BaseDisplayComponent model={model}>\n      <Cloud model={model} />\n    </BaseDisplayComponent>\n  )\n})\nexport default LinearReadCloudReactComponent\n","import React, { lazy } from 'react'\nimport { cast, types, Instance } from 'mobx-state-tree'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  FeatureDensityMixin,\n  TrackHeightMixin,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport FilterListIcon from '@mui/icons-material/ClearAll'\n\n// locals\nimport { FilterModel, IFilter } from '../shared'\nimport { ChainData } from '../shared/fetchChains'\n\n// async\nconst FilterByTagDialog = lazy(() => import('../shared/FilterByTag'))\n\n/**\n * #stateModel LinearReadCloudDisplay\n * it is not a block based track, hence not BaseLinearDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReadCloudDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearReadCloudDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n\n        /**\n         * #property\n         */\n        filterBy: types.optional(FilterModel, {}),\n\n        /**\n         * #property\n         */\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n            extra: types.frozen(),\n          }),\n        ),\n\n        /**\n         * #property\n         */\n        drawSingletons: true,\n      }),\n    )\n    .volatile(() => ({\n      loading: false,\n      chainData: undefined as ChainData | undefined,\n      lastDrawnOffsetPx: undefined as number | undefined,\n      lastDrawnBpPerPx: 0,\n      ref: null as HTMLCanvasElement | null,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setDrawSingletons(f: boolean) {\n        self.drawSingletons = f\n      },\n      /**\n       * #action\n       */\n      setLastDrawnOffsetPx(n: number) {\n        self.lastDrawnOffsetPx = n\n      },\n      /**\n       * #action\n       */\n      setLastDrawnBpPerPx(n: number) {\n        self.lastDrawnBpPerPx = n\n      },\n\n      /**\n       * #action\n       */\n      setLoading(f: boolean) {\n        self.loading = f\n      },\n      /**\n       * #action\n       */\n      reload() {\n        self.error = undefined\n      },\n      /**\n       * #action\n       * internal, a reference to a HTMLCanvas because we use a autorun to draw\n       * the canvas\n       */\n      setRef(ref: HTMLCanvasElement | null) {\n        self.ref = ref\n      },\n\n      setColorScheme(s: { type: string }) {\n        self.colorBy = cast(s)\n      },\n\n      /**\n       * #action\n       */\n      setChainData(args: ChainData) {\n        self.chainData = args\n      },\n\n      /**\n       * #action\n       */\n      setFilterBy(filter: IFilter) {\n        self.filterBy = cast(filter)\n      },\n    }))\n    .views(self => ({\n      get drawn() {\n        return self.lastDrawnOffsetPx !== undefined\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n\n      return {\n        // we don't use a server side renderer, so this fills in minimal\n        // info so as not to crash\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            notReady: !self.chainData,\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Draw singletons',\n              type: 'checkbox',\n              checked: self.drawSingletons,\n              onClick: () => self.setDrawSingletons(!self.drawSingletons),\n            },\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  FilterByTagDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Insert size ± 3σ and orientation',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'insertSizeAndOrientation' }),\n                },\n                {\n                  label: 'Insert size ± 3σ',\n                  onClick: () => self.setColorScheme({ type: 'insertSize' }),\n                },\n                {\n                  label: 'Orientation',\n                  onClick: () => self.setColorScheme({ type: 'orientation' }),\n                },\n                {\n                  label: 'Insert size gradient',\n                  onClick: () => self.setColorScheme({ type: 'gradient' }),\n                },\n              ],\n            },\n          ]\n        },\n\n        /**\n         * #method\n         */\n        async renderSvg(opts: {\n          rasterizeLayers?: boolean\n        }): Promise<React.ReactNode> {\n          const { renderSvg } = await import('../shared/renderSvg')\n          const { drawFeats } = await import('./drawFeats')\n          return renderSvg(self as LinearReadCloudDisplayModel, opts, drawFeats)\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('../shared/afterAttach')\n            const { drawFeats } = await import('./drawFeats')\n            doAfterAttach(self, drawFeats)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n    }))\n}\n\nexport type LinearReadCloudDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearReadCloudDisplayModel =\n  Instance<LinearReadCloudDisplayStateModel>\n\nexport default stateModelFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\n// locals\nimport ReactComponent from './components/ReactComponent'\nimport configSchemaF from './configSchema'\nimport stateModelF from './model'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearReadCloudDisplay',\n      displayName: 'Read cloud display',\n      configSchema,\n      stateModel: stateModelF(configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      subDisplay: { type: 'LinearAlignmentsDisplay', lowerPanel: true },\n      ReactComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config LinearReadCloudDisplay\n */\nfunction configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearReadCloudDisplay',\n    {\n      /**\n       * #slot\n       */\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n\n      /**\n       * #slot\n       */\n      featureHeight: {\n        type: 'number',\n        defaultValue: 7,\n      },\n\n      /**\n       * #slot\n       */\n      colorScheme: {\n        type: 'stringEnum',\n        model: types.enumeration('colorScheme', [\n          'strand',\n          'normal',\n          'insertSize',\n          'insertSizeAndOrientation',\n          'mappingQuality',\n          'tag',\n        ]),\n        description: 'color scheme to use',\n        defaultValue: 'normal',\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport configSchemaF from './configSchemaF'\n\nexport default function register(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    const track = new TrackType({\n      name: 'AlignmentsTrack',\n      displayName: 'Alignments track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'AlignmentsTrack', configSchema),\n    })\n    const linearAlignmentsDisplay = pm.getDisplayType('LinearAlignmentsDisplay')\n    // Add LinearAlignmentsDisplay here so that it has priority over the other\n    // linear displays (defaults to order the displays are added, but we have\n    // to add the Pileup and SNPCoverage displays first).\n    track.addDisplayType(linearAlignmentsDisplay)\n    return track\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config AlignmentsTrack\n * has very little config; most config and state logic is on the display\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'AlignmentsTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const configSchema = ConfigurationSchema('AlignmentsFeatureWidget', {})\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { Instance, types } from 'mobx-state-tree'\nimport { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const baseModel = baseModelFactory(pluginManager)\n  return types.compose(\n    baseModel,\n    types.model('AlignmentsFeatureWidget', {\n      type: types.literal('AlignmentsFeatureWidget'),\n    }),\n  )\n}\n\nexport type AlignmentFeatureWidgetStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type AlignmentFeatureWidgetModel =\n  Instance<AlignmentFeatureWidgetStateModel>\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport { configSchema } from './configSchema'\nimport { stateModelFactory } from './stateModelFactory'\n\nexport default function AlignmentFeatureDetailsF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'AlignmentsFeatureWidget',\n        heading: 'Feature details',\n        configSchema: configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(() => import('./AlignmentsFeatureDetail')),\n      }),\n  )\n}\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\n\n// specialized get features to return limited data about alignments\nexport default abstract class PileupBaseRPC extends RpcMethodType {\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriver: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    return super.serializeArguments(renamedArgs, rpcDriver)\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { Region, dedupe, groupBy } from '@jbrowse/core/util'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { toArray } from 'rxjs/operators'\nimport { firstValueFrom } from 'rxjs'\n// locals\nimport { filterForPairs, getInsertSizeStats } from '../util'\nimport PileupBaseRPC from '../base'\nimport { getTag } from '../../util'\n\n// specialized get features to return limited data about alignments\nexport default class PileupGetReducedFeatures extends PileupBaseRPC {\n  name = 'PileupGetReducedFeatures'\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriver: string,\n  ) {\n    const des = await this.deserializeArguments(args, rpcDriver)\n    const { adapterConfig, sessionId, regions } = des\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const featuresArray = await firstValueFrom(\n      dataAdapter.getFeaturesInMultipleRegions(regions, des).pipe(toArray()),\n    )\n\n    const reduced = dedupe(\n      featuresArray.map(f => ({\n        id: f.id(),\n        refName: f.get('refName'),\n        name: f.get('name'),\n        start: f.get('start'),\n        strand: f.get('strand'),\n        end: f.get('end'),\n        flags: f.get('flags'),\n        tlen: f.get('template_length'),\n        pair_orientation: f.get('pair_orientation'),\n        next_ref: f.get('next_ref'),\n        next_pos: f.get('next_pos'),\n        clipPos: f.get('clipPos'),\n        SA: getTag(f, 'SA'),\n      })),\n      f => f.id,\n    )\n\n    const filtered = filterForPairs(reduced)\n    const stats = filtered.length ? getInsertSizeStats(filtered) : undefined\n    const chains = groupBy(reduced, f => f.name)\n\n    return {\n      chains: Object.values(chains),\n      stats,\n      hasPaired: !!stats,\n      containsNoTransferables: true,\n    }\n  }\n}\n","import { ReducedFeature } from '../shared/fetchChains'\n\nexport function getInsertSizeStats(features: ReducedFeature[]) {\n  const filtered = features.map(f => Math.abs(f.tlen))\n  const sum = filtered.reduce((a, b) => a + b, 0)\n  const sum2 = filtered.map(a => a * a).reduce((a, b) => a + b, 0)\n  const total = filtered.length\n  const avg = sum / total\n  const sd = Math.sqrt((total * sum2 - sum * sum) / (total * total))\n  const upper = avg + 4 * sd\n  const lower = avg - 3 * sd\n  return { upper, lower, avg, sd }\n}\n\nexport function filterForPairs(features: ReducedFeature[]) {\n  return features.filter(\n    f => f.flags & 2 && !(f.flags & 256) && !(f.flags & 2048),\n  )\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\nimport { firstValueFrom } from 'rxjs'\n\n// locals\nimport { getModificationTypes } from '../../MismatchParser'\nimport PileupBaseRPC from '../base'\nimport { getTagAlt } from '../../util'\n\nexport default class PileupGetVisibleModifications extends PileupBaseRPC {\n  name = 'PileupGetVisibleModifications'\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriver: string,\n  ) {\n    const { adapterConfig, sessionId, regions } =\n      await this.deserializeArguments(args, rpcDriver)\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const featuresArray = await firstValueFrom(\n      dataAdapter.getFeaturesInMultipleRegions(regions).pipe(toArray()),\n    )\n\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(f => {\n      getModificationTypes(getTagAlt(f, 'MM', 'Mm') || '').forEach(t =>\n        uniqueValues.add(t),\n      )\n    })\n    return [...uniqueValues]\n  }\n}\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { Region } from '@jbrowse/core/util'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { toArray } from 'rxjs/operators'\nimport { firstValueFrom } from 'rxjs'\n\n// locals\nimport PileupBaseRPC from '../base'\nimport { getTag } from '../../util'\n\nexport default class PileupGetGlobalValueForTag extends PileupBaseRPC {\n  name = 'PileupGetGlobalValueForTag'\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriver: string,\n  ) {\n    const { adapterConfig, sessionId, regions, tag } =\n      await this.deserializeArguments(args, rpcDriver)\n\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await firstValueFrom(features.pipe(toArray()))\n    return [\n      ...new Set(\n        featuresArray\n          .map(feature => getTag(feature, tag))\n          .filter(f => f !== undefined)\n          .map(f => `${f}`),\n      ),\n    ]\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  PileupGetGlobalValueForTag,\n  PileupGetVisibleModifications,\n  PileupGetReducedFeatures,\n} from './rpcMethods'\n\nexport default function PileupRPCMethodsF(pm: PluginManager) {\n  pm.addRpcMethod(() => new PileupGetGlobalValueForTag(pm))\n  pm.addRpcMethod(() => new PileupGetVisibleModifications(pm))\n  pm.addRpcMethod(() => new PileupGetReducedFeatures(pm))\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  makeIndexType,\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default function GuessAlignmentsTypesF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.cram$/i\n        const adapterName = 'CramAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          cramLocation: file,\n          craiLocation: index || makeIndex(file, '.crai'),\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.bam$/i\n        const adapterName = 'BamAdapter'\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n\n        const obj = {\n          type: adapterName,\n          bamLocation: file,\n          index: {\n            location: index || makeIndex(file, '.bai'),\n            indexType: makeIndexType(indexName, 'CSI', 'BAI'),\n          },\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'BamAdapter' || adapterName === 'CramAdapter') {\n          return 'AlignmentsTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearPileupDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction configSchemaF(pluginManager: PluginManager) {\n  // modify config schema to take in a sub coverage display\n  return ConfigurationSchema(\n    'LinearPileupDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup']),\n        defaultValue: 'pileup',\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer:\n          pluginManager.getRendererType('PileupRenderer').configSchema,\n      }),\n      /**\n       * #slot\n       */\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n\n      /**\n       * #slot\n       */\n      colorScheme: {\n        type: 'stringEnum',\n        model: types.enumeration('colorScheme', [\n          'strand',\n          'normal',\n          'insertSize',\n          'insertSizeAndOrientation',\n          'mappingQuality',\n          'tag',\n        ]),\n        description: 'color scheme to use',\n        defaultValue: 'normal',\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Typography } from '@mui/material'\n\nconst LinearPileupDisplayBlurb = observer(function ({\n  model,\n}: {\n  model: {\n    sortedBy?: {\n      pos: number\n      refName: number\n      type: string\n      tag?: string\n    }\n  }\n}) {\n  const { sortedBy } = model\n  return sortedBy ? (\n    <div data-testid={`blurb-${sortedBy}`}>\n      <Typography color=\"secondary\" variant=\"caption\">\n        {sortedBy\n          ? `Sorted by ${sortedBy.tag ?? sortedBy.type} at ${\n              sortedBy.refName\n            }:${sortedBy.pos}`\n          : null}\n      </Typography>\n    </div>\n  ) : null\n})\n\nexport default LinearPileupDisplayBlurb\n","import { lazy } from 'react'\nimport { autorun, observable } from 'mobx'\nimport { cast, types, addDisposer, getSnapshot } from 'mobx-state-tree'\nimport copy from 'copy-to-clipboard'\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  getEnv,\n  getSession,\n  isSessionModelWithWidgets,\n  getContainingView,\n  SimpleFeature,\n  Feature,\n} from '@jbrowse/core/util'\n\nimport {\n  LinearGenomeViewModel,\n  BaseLinearDisplay,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\nimport FilterListIcon from '@mui/icons-material/ClearAll'\n\n// locals\nimport LinearPileupDisplayBlurb from './components/LinearPileupDisplayBlurb'\nimport { getUniqueTagValues, FilterModel, IFilter } from '../shared'\nimport { SimpleFeatureSerialized } from '@jbrowse/core/util/simpleFeature'\nimport { createAutorun } from '../util'\nimport { ColorByModel, ExtraColorBy } from '../shared/color'\n\n// async\nconst FilterByTagDialog = lazy(() => import('../shared/FilterByTag'))\nconst ColorByTagDialog = lazy(() => import('./components/ColorByTag'))\nconst SetFeatureHeightDialog = lazy(\n  () => import('./components/SetFeatureHeight'),\n)\nconst SetMaxHeightDialog = lazy(() => import('./components/SetMaxHeight'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel SharedLinearPileupDisplayMixin\n * #category display\n * extends `BaseLinearDisplay`\n */\nexport function SharedLinearPileupDisplayMixin(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        featureHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        noSpacing: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        fadeLikelihood: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackMaxHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        colorBy: ColorByModel,\n        /**\n         * #property\n         */\n        filterBy: types.optional(FilterModel, {}),\n        /**\n         * #property\n         */\n        jexlFilters: types.optional(types.array(types.string), []),\n      }),\n    )\n    .volatile(() => ({\n      colorTagMap: observable.map<string, string>({}),\n      featureUnderMouseVolatile: undefined as undefined | Feature,\n      tagsReady: false,\n    }))\n    .views(self => ({\n      get autorunReady() {\n        const view = getContainingView(self) as LGV\n        return (\n          view.initialized &&\n          self.featureDensityStatsReady &&\n          !self.regionTooLarge\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setTagsReady(flag: boolean) {\n        self.tagsReady = flag\n      },\n\n      /**\n       * #action\n       */\n      setMaxHeight(n: number) {\n        self.trackMaxHeight = n\n      },\n\n      /**\n       * #action\n       */\n      setFeatureHeight(n?: number) {\n        self.featureHeight = n\n      },\n\n      /**\n       * #action\n       */\n      setNoSpacing(flag?: boolean) {\n        self.noSpacing = flag\n      },\n\n      /**\n       * #action\n       */\n      setColorScheme(colorScheme: {\n        type: string\n        tag?: string\n        extra?: ExtraColorBy\n      }) {\n        self.colorTagMap = observable.map({}) // clear existing mapping\n        self.colorBy = cast(colorScheme)\n        if (colorScheme.tag) {\n          self.tagsReady = false\n        }\n      },\n\n      /**\n       * #action\n       */\n      updateColorTagMap(uniqueTag: string[]) {\n        // pale color scheme\n        // https://cran.r-project.org/web/packages/khroma/vignettes/tol.html\n        // e.g. \"tol_light\"\n        const colorPalette = [\n          '#BBCCEE',\n          'pink',\n          '#CCDDAA',\n          '#EEEEBB',\n          '#FFCCCC',\n          'lightblue',\n          'lightgreen',\n          'tan',\n          '#CCEEFF',\n          'lightsalmon',\n        ]\n\n        uniqueTag.forEach(value => {\n          if (!self.colorTagMap.has(value)) {\n            const totalKeys = [...self.colorTagMap.keys()].length\n            self.colorTagMap.set(value, colorPalette[totalKeys])\n          }\n        })\n      },\n\n      /**\n       * #action\n       */\n      setFeatureUnderMouse(feat?: Feature) {\n        self.featureUnderMouseVolatile = feat\n      },\n\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'AlignmentsFeatureWidget',\n            'alignmentFeature',\n            { featureData: feature.toJSON(), view: getContainingView(self) },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n\n      /**\n       * #action\n       * uses copy-to-clipboard and generates notification\n       */\n      copyFeatureToClipboard(feature: Feature) {\n        const { uniqueId, ...rest } = feature.toJSON()\n        const session = getSession(self)\n        copy(JSON.stringify(rest, null, 4))\n        session.notify('Copied to clipboard', 'success')\n      },\n\n      /**\n       * #action\n       */\n      setConfig(conf: AnyConfigurationModel) {\n        self.configuration = conf\n      },\n\n      /**\n       * #action\n       */\n      setFilterBy(filter: IFilter) {\n        self.filterBy = cast(filter)\n      },\n\n      /**\n       * #action\n       */\n      setJexlFilters(filters: string[]) {\n        self.jexlFilters = cast(filters)\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const { featureHeight, noSpacing, trackMaxHeight, rendererTypeName } =\n          self\n        const configBlob = getConf(self, ['renderers', rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(featureHeight !== undefined ? { height: featureHeight } : {}),\n            ...(noSpacing !== undefined ? { noSpacing } : {}),\n            ...(trackMaxHeight !== undefined\n              ? { maxHeight: trackMaxHeight }\n              : {}),\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get maxHeight() {\n        return readConfObject(self.rendererConfig, 'maxHeight')\n      },\n\n      /**\n       * #getter\n       */\n      get featureHeightSetting() {\n        return readConfObject(self.rendererConfig, 'height')\n      },\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        return self.featureUnderMouseVolatile\n      },\n      /**\n       * #getter\n       */\n      renderReady() {\n        return self.tagsReady\n      },\n      /**\n       * #getter\n       */\n      get filters() {\n        return new SerializableFilterChain({ filters: self.jexlFilters })\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n\n      return {\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType) {\n            throw new Error(`unknown alignments view name ${viewName}`)\n          }\n          return rendererType\n        },\n\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          const feat = self.contextMenuFeature\n          return feat\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: (): void => {\n                    self.clearFeatureSelection()\n                    if (feat) {\n                      self.selectFeature(feat)\n                    }\n                  },\n                },\n                {\n                  label: 'Copy info to clipboard',\n                  icon: ContentCopyIcon,\n                  onClick: (): void => {\n                    if (feat) {\n                      self.copyFeatureToClipboard(feat)\n                    }\n                  },\n                },\n              ]\n            : []\n        },\n\n        /**\n         * #getter\n         */\n        get DisplayBlurb() {\n          return LinearPileupDisplayBlurb\n        },\n        /**\n         * #method\n         */\n        renderPropsPre() {\n          const { colorTagMap, colorBy, filterBy, rpcDriverName } = self\n\n          const superProps = superRenderProps()\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !self.renderReady(),\n            rpcDriverName,\n            displayModel: self,\n            colorBy: colorBy ? getSnapshot(colorBy) : undefined,\n            filterBy: JSON.parse(JSON.stringify(filterBy)),\n            filters: self.filters,\n            colorTagMap: Object.fromEntries(colorTagMap.toJSON()),\n            config: self.rendererConfig,\n            async onFeatureClick(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingView(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: SimpleFeatureSerialized | undefined }\n\n                  if (feature) {\n                    self.selectFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notify(`${e}`)\n              }\n            },\n\n            onClick() {\n              self.clearFeatureSelection()\n            },\n            // similar to click but opens a menu with further options\n            async onFeatureContextMenu(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingView(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: SimpleFeatureSerialized }\n\n                  if (feature) {\n                    self.setContextMenuFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notify(`${e}`)\n              }\n            },\n          }\n        },\n\n        /**\n         * #method\n         */\n        colorSchemeSubMenuItems() {\n          return [\n            {\n              label: 'Normal',\n              onClick: () => self.setColorScheme({ type: 'normal' }),\n            },\n            {\n              label: 'Mapping quality',\n              onClick: () => self.setColorScheme({ type: 'mappingQuality' }),\n            },\n            {\n              label: 'Strand',\n              onClick: () => self.setColorScheme({ type: 'strand' }),\n            },\n            {\n              label: 'Per-base quality',\n              onClick: () => self.setColorScheme({ type: 'perBaseQuality' }),\n            },\n            {\n              label: 'Per-base lettering',\n              onClick: () => self.setColorScheme({ type: 'perBaseLettering' }),\n            },\n            {\n              label: 'First-of-pair strand',\n              onClick: () => self.setColorScheme({ type: 'stranded' }),\n            },\n            {\n              label: 'Color by tag...',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  ColorByTagDialog,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n          ]\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  FilterByTagDialog,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Set feature height',\n              subMenu: [\n                {\n                  label: 'Normal',\n                  onClick: () => {\n                    self.setFeatureHeight(7)\n                    self.setNoSpacing(false)\n                  },\n                },\n                {\n                  label: 'Compact',\n                  onClick: () => {\n                    self.setFeatureHeight(2)\n                    self.setNoSpacing(true)\n                  },\n                },\n                {\n                  label: 'Manually set height',\n                  onClick: () => {\n                    getSession(self).queueDialog(doneCallback => [\n                      SetFeatureHeightDialog,\n                      { model: self, handleClose: doneCallback },\n                    ])\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Set max height...',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetMaxHeightDialog,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .views(self => ({\n      renderProps() {\n        return self.renderPropsPre()\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        createAutorun(\n          self,\n          async () => {\n            const view = getContainingView(self) as LGV\n            if (!self.autorunReady) {\n              return\n            }\n\n            const { colorBy, tagsReady } = self\n            const { staticBlocks } = view\n            if (colorBy?.tag && !tagsReady) {\n              const vals = await getUniqueTagValues(self, colorBy, staticBlocks)\n              self.updateColorTagMap(vals)\n            }\n            self.setTagsReady(true)\n          },\n          { delay: 1000 },\n        )\n\n        // autorun synchronizes featureUnderMouse with featureIdUnderMouse\n        // asynchronously. this is needed due to how we do not serialize all\n        // features from the BAM/CRAM over the rpc\n        addDisposer(\n          self,\n          autorun(async () => {\n            const session = getSession(self)\n            try {\n              const featureId = self.featureIdUnderMouse\n              if (self.featureUnderMouse?.id() !== featureId) {\n                if (!featureId) {\n                  self.setFeatureUnderMouse(undefined)\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const view = getContainingView(self)\n                  const { feature } = (await session.rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId,\n                      sessionId,\n                      layoutId: view.id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: SimpleFeatureSerialized }\n\n                  // check featureIdUnderMouse is still the same as the\n                  // feature.id that was returned e.g. that the user hasn't\n                  // moused over to a new position during the async operation\n                  // above\n                  if (self.featureIdUnderMouse === feature?.uniqueId) {\n                    self.setFeatureUnderMouse(new SimpleFeature(feature))\n                  }\n                }\n              }\n            } catch (e) {\n              console.error(e)\n              session.notifyError(`${e}`, e)\n            }\n          }),\n        )\n      },\n    }))\n}\n","import { lazy } from 'react'\nimport { types, Instance } from 'mobx-state-tree'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getEnv, getSession, getContainingView } from '@jbrowse/core/util'\nimport { getUniqueModificationValues } from '../shared'\n\nimport { createAutorun, randomColor, modificationColors } from '../util'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport SortIcon from '@mui/icons-material/Sort'\n\n// locals\nimport { SharedLinearPileupDisplayMixin } from './SharedLinearPileupDisplayMixin'\nimport { observable } from 'mobx'\n\n// lzies\nconst SortByTagDialog = lazy(() => import('./components/SortByTag'))\nconst ModificationsDialog = lazy(\n  () => import('./components/ColorByModifications'),\n)\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearPileupDisplay\n * #category display\n * extends\n * - [SharedLinearPileupDisplayMixin](../sharedlinearpileupdisplaymixin)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearPileupDisplay',\n      SharedLinearPileupDisplayMixin(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearPileupDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        showSoftClipping: false,\n        /**\n         * #property\n         */\n        mismatchAlpha: types.maybe(types.boolean),\n\n        /**\n         * #property\n         */\n        sortedBy: types.maybe(\n          types.model({\n            type: types.string,\n            pos: types.number,\n            tag: types.maybe(types.string),\n            refName: types.string,\n            assemblyName: types.string,\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      sortReady: false,\n      currSortBpPerPx: 0,\n      modificationTagMap: observable.map<string, string>({}),\n      modificationsReady: false,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCurrSortBpPerPx(n: number) {\n        self.currSortBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      updateModificationColorMap(uniqueModifications: string[]) {\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            self.modificationTagMap.set(\n              value,\n              modificationColors[value] || randomColor(),\n            )\n          }\n        })\n      },\n      /**\n       * #action\n       */\n      setModificationsReady(flag: boolean) {\n        self.modificationsReady = flag\n      },\n      /**\n       * #action\n       */\n      setSortReady(flag: boolean) {\n        self.sortReady = flag\n      },\n      /**\n       * #action\n       */\n      clearSelected() {\n        self.sortedBy = undefined\n      },\n      /**\n       * #action\n       */\n      toggleSoftClipping() {\n        self.showSoftClipping = !self.showSoftClipping\n      },\n      /**\n       * #action\n       */\n      toggleMismatchAlpha() {\n        self.mismatchAlpha = !self.mismatchAlpha\n      },\n      /**\n       * #action\n       */\n      setSortedBy(type: string, tag?: string) {\n        const { centerLineInfo } = getContainingView(self) as LGV\n        if (!centerLineInfo) {\n          return\n        }\n        const { refName, assemblyName, offset } = centerLineInfo\n        const centerBp = Math.round(offset) + 1\n\n        if (centerBp < 0 || !refName) {\n          return\n        }\n\n        self.sortReady = false\n        self.sortedBy = {\n          type,\n          pos: centerBp,\n          refName,\n          assemblyName,\n          tag,\n        }\n      },\n      /**\n       * #action\n       * overrides base from SharedLinearPileupDisplay to make sortReady false\n       * since changing feature height destroys the sort-induced layout\n       */\n      setFeatureHeight(n?: number) {\n        self.sortReady = false\n        self.featureHeight = n\n      },\n    }))\n    .actions(self => {\n      // resets the sort object and refresh whole display on reload\n      const superReload = self.reload\n\n      return {\n        /**\n         * #action\n         */\n        reload() {\n          self.clearSelected()\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const {\n          featureHeight,\n          noSpacing,\n          trackMaxHeight,\n          mismatchAlpha,\n          rendererTypeName,\n        } = self\n        const configBlob = getConf(self, ['renderers', rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(featureHeight !== undefined ? { height: featureHeight } : {}),\n            ...(noSpacing !== undefined ? { noSpacing } : {}),\n            ...(mismatchAlpha !== undefined ? { mismatchAlpha } : {}),\n            ...(trackMaxHeight !== undefined\n              ? { maxHeight: trackMaxHeight }\n              : {}),\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => {\n      const { renderReady: superRenderReady } = self\n      return {\n        /**\n         * #getter\n         */\n        get mismatchAlphaSetting() {\n          return readConfObject(self.rendererConfig, 'mismatchAlpha')\n        },\n        /**\n         * #method\n         */\n        renderReady() {\n          const view = getContainingView(self) as LGV\n          return (\n            self.modificationsReady &&\n            self.currSortBpPerPx === view.bpPerPx &&\n            superRenderReady()\n          )\n        },\n      }\n    })\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderPropsPre: superRenderPropsPre,\n        renderProps: superRenderProps,\n        colorSchemeSubMenuItems: superColorSchemeSubMenuItems,\n      } = self\n\n      return {\n        /**\n         * #method\n         */\n        renderPropsPre() {\n          const { sortedBy, showSoftClipping, modificationTagMap } = self\n          const superProps = superRenderPropsPre()\n          return {\n            ...superProps,\n            showSoftClip: showSoftClipping,\n            sortedBy,\n            modificationTagMap: Object.fromEntries(modificationTagMap.toJSON()),\n          }\n        },\n        /**\n         * #method\n         */\n        renderProps() {\n          const { sortReady } = self\n          const result = superRenderProps()\n          return {\n            ...result,\n            notReady: result.notReady || !sortReady,\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show soft clipping',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSoftClipping,\n              onClick: () => {\n                self.toggleSoftClipping()\n                // if toggling from off to on, will break sort for this track\n                // so clear it\n                if (self.showSoftClipping) {\n                  self.clearSelected()\n                }\n              },\n            },\n            {\n              label: 'Sort by',\n              icon: SortIcon,\n              disabled: self.showSoftClipping,\n              subMenu: [\n                ...['Start location', 'Read strand', 'Base pair'].map(\n                  option => ({\n                    label: option,\n                    onClick: () => self.setSortedBy(option),\n                  }),\n                ),\n                {\n                  label: 'Sort by tag...',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SortByTagDialog,\n                      { model: self, handleClose },\n                    ])\n                  },\n                },\n                {\n                  label: 'Clear sort',\n                  onClick: () => self.clearSelected(),\n                },\n              ],\n            },\n            {\n              label: 'Color scheme',\n              subMenu: [\n                {\n                  label: 'Pair orientation',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'pairOrientation' }),\n                },\n                {\n                  label: 'Modifications or methylation',\n                  onClick: () => {\n                    getSession(self).queueDialog(doneCallback => [\n                      ModificationsDialog,\n                      { model: self, handleClose: doneCallback },\n                    ])\n                  },\n                },\n                {\n                  label: 'Insert size',\n                  onClick: () => self.setColorScheme({ type: 'insertSize' }),\n                },\n                ...superColorSchemeSubMenuItems(),\n              ],\n            },\n            {\n              label: 'Fade mismatches by quality',\n              type: 'checkbox',\n              checked: self.mismatchAlphaSetting,\n              onClick: () => self.toggleMismatchAlpha(),\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        createAutorun(\n          self,\n          async () => {\n            const view = getContainingView(self) as LGV\n            if (!self.autorunReady) {\n              return\n            }\n\n            const { bpPerPx } = view\n\n            self.setCurrSortBpPerPx(bpPerPx)\n          },\n          { delay: 1000 },\n        )\n        createAutorun(\n          self,\n          async () => {\n            const { rpcManager } = getSession(self)\n            const view = getContainingView(self) as LGV\n            if (!self.autorunReady) {\n              return\n            }\n\n            const { sortedBy, adapterConfig, rendererType, sortReady } = self\n            const { bpPerPx } = view\n\n            if (\n              sortedBy &&\n              (!sortReady || self.currSortBpPerPx === view.bpPerPx)\n            ) {\n              const { pos, refName, assemblyName } = sortedBy\n              // render just the sorted region first\n              // @ts-expect-error\n              await self.rendererType.renderInClient(rpcManager, {\n                assemblyName,\n                regions: [\n                  {\n                    start: pos,\n                    end: pos + 1,\n                    refName,\n                    assemblyName,\n                  },\n                ],\n                adapterConfig,\n                rendererType: rendererType.name,\n                sessionId: getRpcSessionId(self),\n                layoutId: view.id,\n                timeout: 1_000_000,\n                ...self.renderPropsPre(),\n              })\n            }\n            self.setCurrSortBpPerPx(bpPerPx)\n            self.setSortReady(true)\n          },\n          { delay: 1000 },\n        )\n\n        createAutorun(self, async () => {\n          if (!self.autorunReady) {\n            return\n          }\n          const { parentTrack, colorBy } = self\n          const { staticBlocks } = getContainingView(self) as LGV\n          if (colorBy?.type === 'modifications') {\n            const adapter = getConf(parentTrack, ['adapter'])\n            const vals = await getUniqueModificationValues(\n              self,\n              adapter,\n              colorBy,\n              staticBlocks,\n            )\n            self.updateModificationColorMap(vals)\n          }\n          self.setModificationsReady(true)\n        })\n      },\n    }))\n}\n\nexport type LinearPileupDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearPileupDisplayModel = Instance<LinearPileupDisplayStateModel>\nexport default stateModelFactory\n","import configSchemaFactory from './configSchema'\nimport modelFactory from './model'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearPileupDisplay',\n      displayName: 'Pileup display',\n      configSchema,\n      stateModel: modelFactory(configSchema),\n      subDisplay: { type: 'LinearAlignmentsDisplay', lowerPanel: true },\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n\nexport { default as linearPileupDisplayStateModelFactory } from './model'\nexport { default as linearPileupDisplayConfigSchemaFactory } from './configSchema'\nexport { SharedLinearPileupDisplayMixin } from './SharedLinearPileupDisplayMixin'\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport BamAdapterF from './CramAdapter'\nimport CramAdapterF from './BamAdapter'\nimport HtsgetBamAdapterF from './HtsgetBamAdapter'\nimport SNPCoverageAdapterF from './SNPCoverageAdapter'\nimport SNPCoverageRendererF from './SNPCoverageRenderer'\nimport PileupRendererF from './PileupRenderer'\nimport LinearAlignmentsDisplayF from './LinearAlignmentsDisplay'\nimport LinearSNPCoverageDisplayF from './LinearSNPCoverageDisplay'\nimport LinearReadArcsDisplayF from './LinearReadArcsDisplay'\nimport LinearReadCloudDisplayF from './LinearReadCloudDisplay'\nimport AlignmentsTrackF from './AlignmentsTrack'\nimport AlignmentsFeatureWidgetF from './AlignmentsFeatureDetail'\nimport PileupRPCMethodsF from './PileupRPC'\nimport GuessAlignmentsTypesF from './GuessAlignmentsTypes'\nimport LinearPileupDisplayF from './LinearPileupDisplay'\n\nexport default class AlignmentsPlugin extends Plugin {\n  name = 'AlignmentsPlugin'\n\n  install(pluginManager: PluginManager) {\n    ;[\n      CramAdapterF,\n      BamAdapterF,\n      LinearPileupDisplayF,\n      LinearSNPCoverageDisplayF,\n      AlignmentsTrackF,\n      SNPCoverageAdapterF,\n      HtsgetBamAdapterF,\n      PileupRendererF,\n      PileupRPCMethodsF,\n      SNPCoverageRendererF,\n      LinearReadArcsDisplayF,\n      LinearReadCloudDisplayF,\n      LinearAlignmentsDisplayF,\n      AlignmentsFeatureWidgetF,\n      GuessAlignmentsTypesF,\n    ].map(f => f(pluginManager))\n  }\n}\n\nexport {\n  linearPileupDisplayStateModelFactory,\n  linearPileupDisplayConfigSchemaFactory,\n  SharedLinearPileupDisplayMixin,\n} from './LinearPileupDisplay'\nexport { type LinearPileupDisplayModel } from './LinearPileupDisplay/model'\nexport * as MismatchParser from './MismatchParser'\n","import { types, Instance } from 'mobx-state-tree'\n\nimport { orientationTypes, pairMap } from '../util'\nimport { ChainStats } from './fetchChains'\n\nexport const fillColor = {\n  color_fwd_strand_not_proper: '#ECC8C8',\n  color_rev_strand_not_proper: '#BEBED8',\n  color_fwd_strand: '#EC8B8B',\n  color_rev_strand: '#8F8FD8',\n  color_fwd_missing_mate: '#D11919',\n  color_rev_missing_mate: '#1919D1',\n  color_fwd_diff_chr: '#000',\n  color_rev_diff_chr: '#969696',\n  color_pair_lr: '#c8c8c8',\n  color_pair_rr: 'navy',\n  color_pair_rl: 'teal',\n  color_pair_ll: 'green',\n  color_nostrand: '#c8c8c8',\n  color_interchrom: 'purple',\n  color_longinsert: 'red',\n  color_shortinsert: 'pink',\n  color_unknown: 'grey',\n}\n\n// manually calculated by running\n// const color = require('color')\n// Object.fromEntries(Object.entries(fillColor).map(([key,val])=>{\n//   return [key, color(val).darken('0.3').hex()]\n// }))\n// this avoids (expensive) use of Color module at runtime\nexport const strokeColor = {\n  color_fwd_strand_not_proper: '#CA6767',\n  color_rev_strand_not_proper: '#7272AA',\n  color_fwd_strand: '#DC2A2A',\n  color_rev_strand: '#4141BA',\n  color_fwd_missing_mate: '#921111',\n  color_rev_missing_mate: '#111192',\n  color_fwd_diff_chr: '#000000',\n  color_rev_diff_chr: '#696969',\n  color_pair_lr: '#8C8C8C',\n  color_pair_rr: '#00005A',\n  color_pair_rl: '#005A5A',\n  color_pair_ll: '#005A00',\n  color_nostrand: '#8C8C8C',\n  color_interchrom: '#5A005A',\n  color_longinsert: '#B30000',\n  color_shortinsert: '#FF3A5C',\n  color_unknown: 'grey',\n}\n\nexport function getPairedInsertSizeColor(\n  f1: { refName: string; tlen?: number },\n  f2: { refName: string },\n  stats?: ChainStats,\n) {\n  const sameRef = f1.refName === f2.refName\n  const tlen = Math.abs(f1.tlen || 0)\n  if (sameRef && tlen > (stats?.upper || 0)) {\n    return [fillColor.color_longinsert, strokeColor.color_longinsert] as const\n  } else if (sameRef && tlen < (stats?.lower || 0)) {\n    return [fillColor.color_shortinsert, strokeColor.color_shortinsert] as const\n  } else if (!sameRef) {\n    return [fillColor.color_interchrom, strokeColor.color_interchrom] as const\n  }\n  return undefined\n}\n\nexport function getPairedInsertSizeAndOrientationColor(\n  f1: { refName: string; pair_orientation?: string; tlen?: number },\n  f2: { refName: string },\n  stats?: ChainStats,\n) {\n  return (\n    getPairedInsertSizeColor(f1, f2, stats) || getPairedOrientationColor(f1)\n  )\n}\n\nexport function getPairedOrientationColor(f: { pair_orientation?: string }) {\n  const type = orientationTypes.fr\n  const type2 = pairMap[\n    type[f.pair_orientation || ''] as keyof typeof pairMap\n  ] as keyof typeof fillColor\n  return [\n    fillColor[type2] || fillColor.color_unknown,\n    strokeColor[type2] || strokeColor.color_unknown,\n  ] as const\n}\n\nexport interface ExtraColorBy {\n  custom?: Record<string, string>\n}\n\nexport const ColorByModel = types.maybe(\n  types.model({\n    type: types.string,\n    tag: types.maybe(types.string),\n    extra: types.frozen(),\n  }),\n)\n\nexport type IColorByModel = Instance<typeof ColorByModel>\n","import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Feature, AugmentedRegion } from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\nimport { firstValueFrom } from 'rxjs'\nimport { IAnyStateTreeNode, addDisposer, isAlive } from 'mobx-state-tree'\nimport { IAutorunOptions, autorun } from 'mobx'\n\n// get tag from BAM or CRAM feature, where CRAM uses feature.get('tags') and\n// BAM does not\nexport function getTag(feature: Feature, tag: string) {\n  const tags = feature.get('tags')\n  return tags !== undefined ? tags[tag] : feature.get(tag)\n}\n\n// use fallback alt tag, used in situations where upper case/lower case tags\n// exist e.g. Mm/MM for base modifications\nexport function getTagAlt(feature: Feature, tag: string, alt: string) {\n  return getTag(feature, tag) ?? getTag(feature, alt)\n}\n\n// orientation definitions from igv.js, see also\n// https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\nexport const orientationTypes = {\n  fr: {\n    F1R2: 'LR',\n    F2R1: 'LR',\n\n    F1F2: 'LL',\n    F2F1: 'LL',\n\n    R1R2: 'RR',\n    R2R1: 'RR',\n\n    R1F2: 'RL',\n    R2F1: 'RL',\n  } as Record<string, string>,\n\n  rf: {\n    R1F2: 'LR',\n    R2F1: 'LR',\n\n    R1R2: 'LL',\n    R2R1: 'LL',\n\n    F1F2: 'RR',\n    F2F1: 'RR',\n\n    F1R2: 'RL',\n    F2R1: 'RL',\n  } as Record<string, string>,\n\n  ff: {\n    F2F1: 'LR',\n    R1R2: 'LR',\n\n    F2R1: 'LL',\n    R1F2: 'LL',\n\n    R2F1: 'RR',\n    F1R2: 'RR',\n\n    R2R1: 'RL',\n    F1F2: 'RL',\n  } as Record<string, string>,\n}\n\nexport const pairMap = {\n  LR: 'color_pair_lr',\n  LL: 'color_pair_ll',\n  RR: 'color_pair_rr',\n  RL: 'color_pair_rl',\n} as const\n\nexport function getColorWGBS(strand: number, base: string) {\n  if (strand === 1) {\n    if (base === 'C') {\n      return '#f00'\n    }\n    if (base === 'T') {\n      return '#00f'\n    }\n  } else if (strand === -1) {\n    if (base === 'G') {\n      return '#f00'\n    }\n    if (base === 'A') {\n      return '#00f'\n    }\n  }\n  return '#888'\n}\n\n// fetches region sequence augmenting by +/- 1bp for CpG on either side of\n// requested region\nexport async function fetchSequence(\n  region: AugmentedRegion,\n  adapter: BaseFeatureDataAdapter,\n) {\n  const { start, end, originalRefName, refName } = region\n\n  const feats = await firstValueFrom(\n    adapter\n      .getFeatures({\n        ...region,\n        refName: originalRefName || refName,\n        end: end + 1,\n        start: Math.max(0, start - 1),\n      })\n      .pipe(toArray()),\n  )\n  return feats[0]?.get('seq')\n}\n\n// has to check underlying C-G (aka CpG) on the reference sequence\nexport function shouldFetchReferenceSequence(type?: string) {\n  return type === 'methylation'\n}\n\n// adapted from IGV\n// https://github.com/igvteam/igv/blob/e803e3af2d8c9ea049961dfd4628146bdde9a574/src/main/java/org/broad/igv/sam/mods/BaseModificationColors.java#L27\nexport const modificationColors = {\n  m: 'rgb(255,0,0)',\n  h: 'rgb(11, 132, 165)',\n  o: 'rgb(111, 78, 129)',\n  f: 'rgb(246, 200, 95)',\n  c: 'rgb(157, 216, 102)',\n  g: 'rgb(255, 160, 86)',\n  e: 'rgb(141, 221, 208)',\n  b: 'rgb(202, 71, 47)',\n} as Record<string, string | undefined>\n\ntype DisplayModel = IAnyStateTreeNode & { setError: (arg: unknown) => void }\n\nexport function createAutorun(\n  self: DisplayModel,\n  cb: () => Promise<void>,\n  opts?: IAutorunOptions,\n) {\n  addDisposer(\n    self,\n    autorun(async () => {\n      try {\n        await cb()\n      } catch (e) {\n        if (isAlive(self)) {\n          self.setError(e)\n        }\n      }\n    }, opts),\n  )\n}\nexport function randomColor() {\n  return `hsl(${Math.random() * 200}, 50%, 50%)`\n}\n","import React from 'react'\nimport { SanitizedHTML } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport { Portal, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport {\n  useClientPoint,\n  useFloating,\n  useInteractions,\n} from '@floating-ui/react'\n\nfunction round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\nconst useStyles = makeStyles()(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n}))\n\ninterface Props {\n  message: React.ReactNode | string\n}\nconst TooltipContents = React.forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ message }, ref) {\n    return (\n      <div ref={ref}>\n        {React.isValidElement(message) ? (\n          message\n        ) : message ? (\n          <SanitizedHTML html={String(message)} />\n        ) : null}\n      </div>\n    )\n  },\n)\n\nconst ArcTooltip = observer(function ({ contents }: { contents?: string }) {\n  const { theme, classes } = useStyles()\n\n  const { refs, floatingStyles, context } = useFloating({\n    placement: 'right',\n    strategy: 'fixed',\n  })\n\n  const clientPoint = useClientPoint(context)\n  const { getFloatingProps } = useInteractions([clientPoint])\n\n  const popperTheme = theme?.components?.MuiPopper\n  return contents ? (\n    <Portal container={popperTheme?.defaultProps?.container}>\n      <div\n        className={classes.tooltip}\n        ref={refs.setFloating}\n        style={{\n          ...floatingStyles,\n          zIndex: 100000,\n          pointerEvents: 'none',\n        }}\n        {...getFloatingProps()}\n      >\n        <TooltipContents message={contents} />\n      </div>\n    </Portal>\n  ) : null\n})\n\nexport default ArcTooltip\n","import { useState, useEffect } from 'react'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { clamp } from '@jbrowse/core/util'\n\n// locals\nimport { LayoutRecord } from './model'\n\ntype LGV = LinearGenomeViewModel\n\ninterface Display {\n  height: number\n  scrollTop: number\n  SNPCoverageDisplay?: { height: number }\n}\n\ninterface Track {\n  displays: Display[]\n}\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nfunction cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\n\nfunction heightFromSpecificLevel(\n  views: LGV[],\n  trackId: string,\n  level: number,\n  getYPosOverride?: (trackId: string, level: number) => number,\n) {\n  return getYPosOverride\n    ? getYPosOverride(trackId, level)\n    : views[level].trackRefs[trackId]?.getBoundingClientRect().top || 0\n}\n\nexport function getPxFromCoordinate(view: LGV, refName: string, coord: number) {\n  return (view.bpToPx({ refName, coord })?.offsetPx || 0) - view.offsetPx\n}\n\n// get's the yposition of a layout record in a track\nexport function yPos(\n  trackId: string,\n  level: number,\n  views: LGV[],\n  tracks: Track[],\n  c: LayoutRecord,\n  getYPosOverride?: (trackId: string, level: number) => number,\n) {\n  const display = tracks[level].displays[0]\n  const min = 0\n  const max = display.height\n  let offset = 0\n  const { SNPCoverageDisplay } = display\n  if (SNPCoverageDisplay) {\n    offset = SNPCoverageDisplay.height\n  }\n  const yPos = getYPosOverride ? 0 : display.scrollTop\n  return (\n    clamp(c[TOP] - yPos + cheight(c) / 2 + offset, min, max) +\n    heightFromSpecificLevel(views, trackId, level, getYPosOverride) +\n    display.scrollTop\n  )\n}\n\n// we combo a useEffect and useState combo to force rerender on snap changing.\n// the setup of this being a useEffect+useState makes it re-render once the\n// useEffect is called, which is generally the \"next frame\". If we removed the\n// below use\nexport const useNextFrame = (variable: unknown) => {\n  const [, setNextFrameState] = useState<unknown>()\n  useEffect(() => {\n    setNextFrameState(variable)\n  }, [variable])\n}\n\n// https://stackoverflow.com/a/49186706/2129219 the array-intersection package\n// on npm has a large kb size, and we are just intersecting open track ids so\n// simple is better\nexport function intersect<T>(\n  cb: (l: T) => string,\n  a1: T[] = [],\n  a2: T[] = [],\n  ...rest: T[][]\n): T[] {\n  const ids = new Set(a2.map(elt => cb(elt)))\n  const a12 = a1.filter(value => ids.has(cb(value)))\n  return rest.length === 0 ? a12 : intersect(cb, a12, ...rest)\n}\n","function findCircleIntersectionX(\n  y: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(y - cy)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([cx, y])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([cx - solution, y], [cx + solution, y])\n}\n\nfunction findCircleIntersectionY(\n  x: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(x - cx)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([x, cy])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([x, cy - solution], [x, cy + solution])\n}\n\nfunction cartesianToTheta(x: number, y: number) {\n  let theta = (Math.atan(y / x) + 2 * Math.PI) % (2 * Math.PI)\n  if (x < 0) {\n    if (y <= 0) {\n      theta += Math.PI\n    } else {\n      theta -= Math.PI\n    }\n  }\n  return theta\n}\n\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  if (rho === 0) {\n    return [0, 0]\n  }\n  const theta = cartesianToTheta(x, y)\n  return [rho, theta]\n}\n\nconst twoPi = 2 * Math.PI\nexport function thetaRangesOverlap(\n  r1start: number,\n  r1length: number,\n  r2start: number,\n  r2length: number,\n) {\n  if (r1length <= 0 || r2length <= 0) {\n    return false\n  }\n  if (r1length + 0.0001 >= twoPi || r2length + 0.0001 >= twoPi) {\n    return true\n  }\n\n  // put both range starts between 2π and 4π\n  r1start = (((r1start % twoPi) + twoPi) % twoPi) + twoPi\n  r2start = (((r2start % twoPi) + twoPi) % twoPi) + twoPi\n\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move r2 2π to the left and check\n  r2start -= twoPi\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move it 2π to the right and check\n  r2start += twoPi + twoPi\n  return r1start < r2start + r2length && r1start + r1length > r2start\n}\n\n// return which arc range has any part of the circle visible in the viewport\nexport function viewportVisibleSection(\n  viewSides: [number, number, number, number],\n  circleCenter: [number, number],\n  circleRadius: number,\n) {\n  let [viewL, viewR, viewT, viewB] = viewSides\n  const [cx, cy] = circleCenter\n\n  // transform coordinate system to center of circle\n  viewL -= cx\n  viewR -= cx\n  viewT -= cy\n  viewB -= cy\n\n  const centerIsInsideViewport =\n    viewL < 0 && viewR > 0 && viewT < 0 && viewB > 0\n\n  if (centerIsInsideViewport) {\n    const vertices = [\n      [viewL, viewT],\n      [viewR, viewT],\n      [viewL, viewB],\n      [viewR, viewB],\n    ]\n    let maxRho = -Infinity\n    for (const [x, y] of vertices) {\n      const rho = Math.sqrt(x * x + y * y)\n      if (rho > maxRho) {\n        maxRho = rho\n      }\n    }\n    return {\n      rho: [0, Math.min(circleRadius, maxRho)] as [number, number],\n      theta: [0, 2 * Math.PI] as [number, number],\n    }\n  }\n  // const viewportCompletelyContainsCircle =\n  //   circleCenter[0] - viewL >= circleRadius &&\n  //   viewR - circleCenter[0] >= circleRadius &&\n  //   circleCenter[1] - viewT >= circleRadius &&\n  //   viewB - circleCenter[1] >= circleRadius\n\n  // if (viewportCompletelyContainsCircle) {\n  //   return [0, 2 * Math.PI]\n  // }\n\n  // const distToCenterSquared = ([x, y]) => {\n  //   const [cx, cy] = circleCenter\n  //   const sq = n => n * n\n  //   return sq(x - cx) + sq(y - cy)\n  // }\n  // const circleRadiusSquared = circleRadius * circleRadius\n\n  // const tlInside = distToCenterSquared([viewL, viewT]) <= circleRadiusSquared\n  // const trInside = distToCenterSquared([viewR, viewT]) <= circleRadiusSquared\n  // const blInside = distToCenterSquared([viewL, viewB]) <= circleRadiusSquared\n  // const brInside = distToCenterSquared([viewR, viewB]) <= circleRadiusSquared\n\n  // const noIntersection = !tlInside && !trInside && !blInside && !brInside\n  // if (noIntersection) return undefined\n\n  // const circleCompletelyContainsViewport =\n  //   tlInside && trInside && blInside && brInside\n  // if (circleCompletelyContainsViewport) {\n  //   // viewport is in the circle, but the center is not in it, so take max\n  //   // and min of thetas to the center\n  //   const thetas = [\n  //     Math.atan(viewT / viewL),\n  //     Math.atan(viewT / viewR),\n  //     Math.atan(viewB / viewL),\n  //     Math.atan(viewB / viewR),\n  //   ]\n\n  //   return [Math.min(...thetas), Math.max(...thetas)]\n  // }\n\n  // if we get here, the viewport is partly in, partly out of the circle\n\n  // const viewLIntersects = Math.abs(viewL - circleCenter[0]) <= circleRadius\n  // const viewRIntersects = Math.abs(viewR - circleCenter[0]) <= circleRadius\n  // const viewTIntersects = Math.abs(viewT - circleCenter[1]) <= circleRadius\n  // const viewBIntersects = Math.abs(viewB - circleCenter[1]) <= circleRadius\n\n  // const numIntersectingSides =\n  //   Number(viewLIntersects) +\n  //   Number(viewRIntersects) +\n  //   Number(viewTIntersects) +\n  //   Number(viewBIntersects)\n\n  // if (numIntersectingSides === 4) return [0, 2 * Math.PI]\n  // if (numIntersectingSides === 3) {\n  //   // TODO calculate the thetas of the\n  // } else if (numIntersectingSides === 2) {\n  //   // TODO calculate the thetas of the 2 intersection points\n  // } else if (numIntersectingSides === 1) {\n  //   // TODO calculate the thetas of the 1-2 intersection points of the line, and the angle between\n  // }\n\n  // make a list of vertices-of-interest that lie inside both shapes to examine\n  // to determine the range covered by their intersection\n\n  // transform coordinates to have the circle as the origin and find the intersections\n  // of the circle and the view rectangle\n  const vertices: [number, number][] = [\n    [viewL, viewT],\n    [viewR, viewT],\n    [viewL, viewB],\n    [viewR, viewB],\n  ]\n  findCircleIntersectionY(viewL, 0, 0, circleRadius, vertices)\n  findCircleIntersectionY(viewR, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewT, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewB, 0, 0, circleRadius, vertices)\n\n  // for each edge, also look at the closest point to center if it is inside the circle\n  if (-viewL < circleRadius) {\n    vertices.push([viewL, 0])\n  }\n  if (viewR < circleRadius) {\n    vertices.push([viewR, 0])\n  }\n  if (-viewT < circleRadius) {\n    vertices.push([0, viewT])\n  }\n  if (viewB < circleRadius) {\n    vertices.push([0, viewB])\n  }\n\n  // const verticesOriginal = vertices.map(([x, y]) => [x + cx, y + cy])\n\n  // now convert them all to polar and take the max and min of rho and theta\n\n  // const viewportCenterTheta = cartesianToTheta(viewR + viewL, viewT + viewB)\n  const reflect = viewL >= 0 ? -1 : 1\n  // viewportCenterTheta < Math.PI / 2 || viewportCenterTheta > 1.5 * Math.PI\n  //   ? -1\n  //   : 1\n  let rhoMin = Infinity\n  let rhoMax = -Infinity\n  let thetaMin = Infinity\n  let thetaMax = -Infinity\n  for (const [vx, vy] of vertices) {\n    // ignore vertex if outside the viewport\n    if (vx >= viewL && vx <= viewR && vy >= viewT && vy <= viewB) {\n      const [rho, theta] = cartesianToPolar(vx * reflect, vy * reflect)\n      // ignore vertex if outside the circle\n      if (rho <= circleRadius + 0.001) {\n        // ignore theta if rho is 0\n        if (theta < thetaMin && rho > 0.0001) {\n          thetaMin = theta\n        }\n        if (theta > thetaMax && rho > 0.0001) {\n          thetaMax = theta\n        }\n        if (rho < rhoMin) {\n          rhoMin = rho\n        }\n        if (rho > rhoMax) {\n          rhoMax = rho\n        }\n      }\n    }\n  }\n\n  if (reflect === -1) {\n    thetaMin += Math.PI\n    thetaMax += Math.PI\n  }\n\n  if (thetaMin > 2 * Math.PI && thetaMax > 2 * Math.PI) {\n    thetaMin -= 2 * Math.PI\n    thetaMax -= 2 * Math.PI\n  }\n\n  return {\n    rho: [rhoMin, Math.min(circleRadius, rhoMax)] as [number, number],\n    theta: [thetaMin, thetaMax] as [number, number],\n  }\n}\n","import { polarToCartesian, assembleLocString, Region } from '@jbrowse/core/util'\nimport { thetaRangesOverlap } from './viewportVisibleRegion'\n\nexport interface SliceElidedRegion {\n  elided: true\n  widthBp: number\n  regions: Region[]\n}\n\nexport interface SliceNonElidedRegion {\n  elided: false\n  widthBp: number\n  start: number\n  end: number\n  refName: string\n  assemblyName: string\n}\nexport type SliceRegion = SliceNonElidedRegion | SliceElidedRegion\n\nexport class Slice {\n  key: string\n\n  startRadians: number\n\n  endRadians: number\n\n  bpPerRadian: number\n\n  flipped: boolean\n\n  constructor(\n    view: { bpPerRadian: number },\n    public region: SliceRegion,\n    public offsetRadians: number,\n    public radianWidth: number,\n  ) {\n    const { bpPerRadian } = view\n    this.key =\n      'regions' in region\n        ? JSON.stringify(region.regions)\n        : assembleLocString(region)\n    this.bpPerRadian = bpPerRadian\n    this.flipped = false\n\n    this.startRadians = offsetRadians\n    this.endRadians = region.widthBp / this.bpPerRadian + offsetRadians\n    Object.freeze(this)\n  }\n\n  bpToXY(bp: number, radiusPx: number) {\n    let offsetBp\n    if (this.region.elided) {\n      offsetBp = this.region.widthBp / 2\n    } else if (this.flipped) {\n      offsetBp = this.region.end - bp\n    } else {\n      offsetBp = bp - this.region.start\n    }\n    const totalRadians = offsetBp / this.bpPerRadian + this.offsetRadians\n    return polarToCartesian(radiusPx, totalRadians)\n  }\n\n  toJSON() {\n    return Object.fromEntries(Object.entries(this))\n  }\n}\n\nfunction calculateStaticSlices(self: {\n  elidedRegions: SliceRegion[]\n  bpPerRadian: number\n  spacingPx: number\n  pxPerRadian: number\n}) {\n  const slices = []\n  let currentRadianOffset = 0\n  const { bpPerRadian, spacingPx, pxPerRadian } = self\n  for (const region of self.elidedRegions) {\n    const radianWidth = region.widthBp / bpPerRadian + spacingPx / pxPerRadian\n    slices.push(new Slice(self, region, currentRadianOffset, radianWidth))\n    currentRadianOffset += radianWidth\n  }\n  return slices\n}\n\nfunction sliceIsVisible(\n  self: { offsetRadians: number; visibleSection: { theta: [number, number] } },\n  slice: Slice,\n) {\n  const {\n    theta: [visibleThetaMin, visibleThetaMax],\n  } = self.visibleSection\n\n  return thetaRangesOverlap(\n    slice.offsetRadians + self.offsetRadians,\n    slice.radianWidth,\n    visibleThetaMin,\n    visibleThetaMax - visibleThetaMin,\n  )\n}\n\nexport { calculateStaticSlices, sliceIsVisible }\n","import React, { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  cast,\n  getParent,\n  getRoot,\n  resolveIdentifier,\n  types,\n  SnapshotOrInstance,\n  Instance,\n} from 'mobx-state-tree'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport { transaction } from 'mobx'\nimport { saveAs } from 'file-saver'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  getSession,\n  clamp,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\n\n// locals\nimport { calculateStaticSlices, sliceIsVisible, SliceRegion } from './slices'\nimport { viewportVisibleSection } from './viewportVisibleRegion'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('../components/ExportSvgDialog'))\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n  Wrapper?: React.FC<{ children: React.ReactNode }>\n  themeName?: string\n}\n\n/**\n * #stateModel CircularView\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  const minHeight = 40\n  const minWidth = 100\n  const defaultHeight = 400\n  return types\n    .compose(\n      'CircularView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('CircularView'),\n        /**\n         * #property\n         * similar to offsetPx in linear genome view\n         */\n        offsetRadians: -Math.PI / 2,\n        /**\n         * #property\n         */\n        bpPerPx: 200,\n        /**\n         * #property\n         */\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        /**\n         * #property\n         */\n        hideVerticalResizeHandle: false,\n        /**\n         * #property\n         */\n        hideTrackSelectorButton: false,\n        /**\n         * #property\n         */\n        lockedFitToWindow: true,\n        /**\n         * #property\n         */\n        disableImportForm: false,\n\n        /**\n         * #property\n         */\n        height: types.optional(\n          types.refinement('trackHeight', types.number, n => n >= minHeight),\n          defaultHeight,\n        ),\n        /**\n         * #property\n         */\n        displayedRegions: types.array(Region),\n        /**\n         * #property\n         */\n        scrollX: 0,\n        /**\n         * #property\n         */\n        scrollY: 0,\n\n        /**\n         * #property\n         */\n        minimumRadiusPx: 25,\n        /**\n         * #property\n         */\n        spacingPx: 10,\n        /**\n         * #property\n         */\n        paddingPx: 80,\n        /**\n         * #property\n         */\n        lockedPaddingPx: 100,\n        /**\n         * #property\n         */\n        minVisibleWidth: 6,\n        /**\n         * #property\n         */\n        minimumBlockWidth: 20,\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      error: undefined as unknown,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get width() {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'wait for view to be initialized first before accessing width',\n          )\n        }\n        return self.volatileWidth\n      },\n\n      /**\n       * #getter\n       */\n      get visibleSection() {\n        const { scrollX, scrollY, width, height } = self\n        return viewportVisibleSection(\n          [scrollX, scrollX + width, scrollY, scrollY + height],\n          this.centerXY,\n          this.radiusPx,\n        )\n      },\n      /**\n       * #getter\n       */\n      get circumferencePx() {\n        let elidedBp = 0\n\n        for (const r of this.elidedRegions) {\n          elidedBp += r.widthBp\n        }\n        return (\n          elidedBp / self.bpPerPx + self.spacingPx * this.elidedRegions.length\n        )\n      },\n      /**\n       * #getter\n       */\n      get radiusPx() {\n        return this.circumferencePx / (2 * Math.PI)\n      },\n      /**\n       * #getter\n       */\n      get bpPerRadian() {\n        return self.bpPerPx * this.radiusPx\n      },\n      /**\n       * #getter\n       */\n      get pxPerRadian() {\n        return this.radiusPx\n      },\n      /**\n       * #getter\n       */\n      get centerXY(): [number, number] {\n        return [this.radiusPx + self.paddingPx, this.radiusPx + self.paddingPx]\n      },\n      /**\n       * #getter\n       */\n      get totalBp() {\n        let total = 0\n        for (const region of self.displayedRegions) {\n          total += region.end - region.start\n        }\n        return total\n      },\n      /**\n       * #getter\n       */\n      get maximumRadiusPx() {\n        return self.lockedFitToWindow\n          ? Math.min(self.width, self.height) / 2 - self.lockedPaddingPx\n          : 1000000\n      },\n      /**\n       * #getter\n       */\n      get maxBpPerPx() {\n        const minCircumferencePx = 2 * Math.PI * self.minimumRadiusPx\n        return this.totalBp / minCircumferencePx\n      },\n      /**\n       * #getter\n       */\n      get minBpPerPx() {\n        // min depends on window dimensions, clamp between old min(0.01) and max\n        const maxCircumferencePx = 2 * Math.PI * this.maximumRadiusPx\n        return clamp(\n          this.totalBp / maxCircumferencePx,\n          0.0000000001,\n          this.maxBpPerPx,\n        )\n      },\n      /**\n       * #getter\n       */\n      get atMaxBpPerPx() {\n        return self.bpPerPx >= this.maxBpPerPx\n      },\n      /**\n       * #getter\n       */\n      get atMinBpPerPx() {\n        return self.bpPerPx <= this.minBpPerPx\n      },\n      /**\n       * #getter\n       */\n      get tooSmallToLock() {\n        return this.minBpPerPx <= 0.0000000001\n      },\n      /**\n       * #getter\n       */\n      get figureDimensions(): [number, number] {\n        return [\n          this.radiusPx * 2 + 2 * self.paddingPx,\n          this.radiusPx * 2 + 2 * self.paddingPx,\n        ]\n      },\n      /**\n       * #getter\n       */\n      get figureWidth() {\n        return this.figureDimensions[0]\n      },\n      /**\n       * #getter\n       */\n      get figureHeight() {\n        return this.figureDimensions[1]\n      },\n      /**\n       * #getter\n       * this is displayedRegions, post-processed to\n       * elide regions that are too small to see reasonably\n       */\n      get elidedRegions() {\n        const visible: SliceRegion[] = []\n        self.displayedRegions.forEach(region => {\n          const widthBp = region.end - region.start\n          const widthPx = widthBp / self.bpPerPx\n          if (widthPx < self.minVisibleWidth) {\n            // too small to see, collapse into a single elision region\n            const lastVisible = visible.at(-1)\n            if (lastVisible?.elided) {\n              lastVisible.regions.push({ ...region })\n              lastVisible.widthBp += widthBp\n            } else {\n              visible.push({\n                elided: true,\n                widthBp,\n                regions: [{ ...region }],\n              })\n            }\n          } else {\n            // big enough to see, display it\n            visible.push({ ...region, widthBp, elided: false })\n          }\n        })\n\n        // remove any single-region elisions\n        for (let i = 0; i < visible.length; i += 1) {\n          const v = visible[i]\n          if (v.elided && v.regions.length === 1) {\n            visible[i] = { ...v, ...v.regions[0], elided: false }\n          }\n        }\n        return visible\n      },\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        const assemblyNames: string[] = []\n        self.displayedRegions.forEach(displayedRegion => {\n          if (!assemblyNames.includes(displayedRegion.assemblyName)) {\n            assemblyNames.push(displayedRegion.assemblyName)\n          }\n        })\n        return assemblyNames\n      },\n      /**\n       * #getter\n       */\n      get initialized() {\n        const { assemblyManager } = getSession(self)\n        return (\n          self.volatileWidth !== undefined &&\n          this.assemblyNames.every(a => assemblyManager.get(a)?.initialized)\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get staticSlices() {\n        return calculateStaticSlices(self)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get visibleStaticSlices() {\n        return self.staticSlices.filter(s => sliceIsVisible(self, s))\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = Math.max(newWidth, minWidth)\n        return self.volatileWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = Math.max(newHeight, minHeight)\n        return self.height\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        this.setModelViewWhenAdjust(!self.tooSmallToLock)\n        return newHeight - oldHeight\n      },\n      /**\n       * #action\n       */\n      resizeWidth(distance: number) {\n        const oldWidth = self.width\n        const newWidth = this.setWidth(self.width + distance)\n        this.setModelViewWhenAdjust(!self.tooSmallToLock)\n        return newWidth - oldWidth\n      },\n      /**\n       * #action\n       */\n      rotateClockwiseButton() {\n        this.rotateClockwise(Math.PI / 6)\n      },\n\n      /**\n       * #action\n       */\n      rotateCounterClockwiseButton() {\n        this.rotateCounterClockwise(Math.PI / 6)\n      },\n\n      /**\n       * #action\n       */\n      rotateClockwise(distance = 0.17) {\n        self.offsetRadians += distance\n      },\n\n      /**\n       * #action\n       */\n      rotateCounterClockwise(distance = 0.17) {\n        self.offsetRadians -= distance\n      },\n\n      /**\n       * #action\n       */\n      zoomInButton() {\n        this.setBpPerPx(self.bpPerPx / 1.4)\n      },\n\n      /**\n       * #action\n       */\n      zoomOutButton() {\n        this.setBpPerPx(self.bpPerPx * 1.4)\n      },\n\n      /**\n       * #action\n       */\n      setBpPerPx(newVal: number) {\n        self.bpPerPx = clamp(newVal, self.minBpPerPx, self.maxBpPerPx)\n      },\n\n      /**\n       * #action\n       */\n      setModelViewWhenAdjust(secondCondition: boolean) {\n        if (self.lockedFitToWindow && secondCondition) {\n          this.setBpPerPx(self.minBpPerPx)\n        }\n      },\n\n      /**\n       * #action\n       */\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      /**\n       * #action\n       */\n      setDisplayedRegions(regions: SnapshotOrInstance<typeof Region>[]) {\n        const previouslyEmpty = self.displayedRegions.length === 0\n        self.displayedRegions = cast(regions)\n\n        if (previouslyEmpty) {\n          this.setBpPerPx(self.minBpPerPx)\n        } else {\n          this.setBpPerPx(self.bpPerPx)\n        }\n      },\n\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        const hiddenCount = this.hideTrack(trackId)\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n          return true\n        }\n        return false\n      },\n\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        self.error = error\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const trackType = pluginManager.getTrackType(conf.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${conf.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          supportedDisplays.has(d.type),\n        )\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      /**\n       * #action\n       */\n      addTrackConf(configuration: AnyConfigurationModel, initialSnapshot = {}) {\n        const { type } = configuration\n        const name = readConfObject(configuration, 'name')\n        const trackType = pluginManager.getTrackType(type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.has(d.type),\n        )\n        self.tracks.push(\n          trackType.stateModel.create({\n            ...initialSnapshot,\n            name,\n            type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const t = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => t.forEach(t => self.tracks.remove(t)))\n        return t.length\n      },\n\n      /**\n       * #action\n       */\n      toggleFitToWindowLock() {\n        // when going unlocked -> locked and circle is cut off, set to the\n        // locked minBpPerPx\n        self.lockedFitToWindow = !self.lockedFitToWindow\n        this.setModelViewWhenAdjust(self.atMinBpPerPx)\n        return self.lockedFitToWindow\n      },\n      /**\n       * #action\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import('../svgcomponents/SVGCircularView')\n        const html = await renderToSvg(self as CircularViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * return the view menu items\n       */\n      menuItems(): MenuItem[] {\n        return [\n          {\n            label: 'Return to import form',\n            onClick: () => self.setDisplayedRegions([]),\n            icon: FolderOpenIcon,\n          },\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                { model: self, handleClose },\n              ])\n            },\n          },\n          {\n            label: 'Open track selector',\n            onClick: self.activateTrackSelector,\n            icon: TrackSelectorIcon,\n          },\n        ]\n      },\n    }))\n}\n\nexport type CircularViewStateModel = ReturnType<typeof stateModelFactory>\nexport type CircularViewModel = Instance<CircularViewStateModel>\n\nexport default stateModelFactory\n","import React, { useState, useEffect } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles()(theme => {\n  const offset = 2\n  const duration = 1.4\n\n  const { primary, secondary, tertiary, quaternary } = theme.palette\n  return {\n    path: {\n      strokeDasharray: 187,\n      strokeDashoffset: 50,\n      animation: `$dash ${duration}s ease-in-out infinite, $colors ${\n        duration * 4\n      }s ease-in-out infinite`,\n    },\n    '@keyframes colors': {\n      '0%': {\n        stroke: primary.light,\n      },\n      '25%': {\n        stroke: secondary.light,\n      },\n      '50%': {\n        stroke: tertiary.light,\n      },\n      '75%': {\n        stroke: quaternary.light,\n      },\n      '100%': {\n        stroke: primary.light,\n      },\n    },\n\n    '@keyframes dash': {\n      '0%': {\n        strokeDashoffset: offset,\n      },\n      '50%': {\n        strokeDashoffset: offset / 4,\n        transform: 'rotate(135deg)',\n      },\n      '100%': {\n        strokeDashoffset: offset,\n        transform: 'rotate(720deg)',\n      },\n    },\n  }\n})\n\nconst Loading = observer(function ({\n  model: {\n    renderProps: { radius },\n  },\n}: {\n  model: { renderProps: { radius: number } }\n}) {\n  const { classes } = useStyles()\n\n  // only show the loading message after 400ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 400)\n    return () => clearTimeout(timeout)\n  })\n\n  return !shown ? null : (\n    <g>\n      <defs>\n        <pattern\n          id=\"diagonalHatch\"\n          width=\"10\"\n          height=\"10\"\n          patternTransform=\"rotate(45 0 0)\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <line\n            x1=\"0\"\n            y1=\"0\"\n            x2=\"0\"\n            y2=\"10\"\n            style={{ stroke: 'rgba(255,255,255,0.5)', strokeWidth: 10 }}\n          />\n        </pattern>\n      </defs>\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#f1f1f1\" />\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n      <text\n        x=\"0\"\n        y=\"0\"\n        transform=\"rotate(90 0 0)\"\n        dominantBaseline=\"middle\"\n        textAnchor=\"middle\"\n      >\n        Loading&hellip;\n      </text>\n      <circle\n        className={classes.path}\n        fill=\"none\"\n        strokeWidth=\"4\"\n        strokeLinecap=\"round\"\n        cx=\"0\"\n        cy=\"0\"\n        r=\"60\"\n      />\n    </g>\n  )\n})\n\nexport default Loading\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nconst DisplayError = observer(function ({\n  model,\n}: {\n  model: { renderProps: { radius: number }; error: unknown }\n}) {\n  const {\n    renderProps: { radius },\n    error,\n  } = model\n  return (\n    <g>\n      <defs>\n        <pattern\n          id=\"diagonalHatch\"\n          width=\"10\"\n          height=\"10\"\n          patternTransform=\"rotate(45 0 0)\"\n          patternUnits=\"userSpaceOnUse\"\n        >\n          <line\n            x1=\"0\"\n            y1=\"0\"\n            x2=\"0\"\n            y2=\"10\"\n            style={{ stroke: 'rgba(255,0,0,0.5)', strokeWidth: 10 }}\n          />\n        </pattern>\n      </defs>\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#ffb4b4\" />\n      <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n      <text\n        x=\"0\"\n        y=\"0\"\n        transform=\"rotate(90 0 0)\"\n        dominantBaseline=\"middle\"\n        textAnchor=\"middle\"\n      >\n        {String(error)}\n      </text>\n    </g>\n  )\n})\n\nexport default DisplayError\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\n// locals\nimport Loading from './Loading'\nimport DisplayError from './DisplayError'\n\nconst BaseChordDisplay = observer(function ({\n  display,\n}: {\n  display: {\n    filled: boolean\n    error: unknown\n    reactElement: React.ReactElement\n    renderProps: { radius: number }\n  }\n}) {\n  if (display.error) {\n    return <DisplayError model={display} />\n  }\n  if (!display.filled) {\n    return <Loading model={display} />\n  }\n\n  return display.reactElement\n})\n\nexport default BaseChordDisplay\n","import clone from 'clone'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport { CircularViewModel } from '../../CircularView/models/model'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function renderReactionData(self: any) {\n  const view = getContainingView(self) as CircularViewModel\n  const { rendererType } = self\n  const { rpcManager } = getSession(view)\n\n  return {\n    rendererType,\n    rpcManager,\n    renderProps: self.renderProps(),\n    renderArgs: {\n      assemblyName: view.displayedRegions[0]?.assemblyName,\n      adapterConfig: clone(self.adapterConfig),\n      rendererType: rendererType.name,\n      regions: clone(view.displayedRegions),\n      blockDefinitions: self.blockDefinitions,\n      sessionId: getRpcSessionId(self),\n      timeout: 1000000,\n    },\n  }\n}\n\nexport async function renderReactionEffect(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  props: any,\n  signal: AbortSignal | undefined,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  self: any,\n) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const {\n    rendererType,\n    rpcManager,\n    cannotBeRenderedReason,\n    renderArgs,\n    renderProps,\n    exportSVG,\n  } = props\n\n  if (cannotBeRenderedReason) {\n    return { message: cannotBeRenderedReason }\n  }\n\n  // don't try to render 0 or NaN radius or no regions\n  if (!renderProps.radius || !renderArgs.regions?.length) {\n    return { message: 'Skipping render' }\n  }\n\n  // check renderertype compatibility\n  if (!self.isCompatibleWithRenderer(rendererType)) {\n    throw new Error(\n      `renderer ${rendererType.name} is not compatible with this display type`,\n    )\n  }\n\n  const { html, ...data } = await rendererType.renderInClient(rpcManager, {\n    ...renderArgs,\n    ...renderProps,\n    exportSVG,\n  })\n\n  return {\n    html,\n    data,\n    reactElement: data.reactElement,\n    renderingComponent: rendererType.ReactComponent,\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BaseChordDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst baseChordDisplayConfig = ConfigurationSchema(\n  'BaseChordDisplay',\n  {\n    /**\n     * #slot\n     */\n    onChordClick: {\n      type: 'boolean',\n      description:\n        'callback that should be run when a chord in the track is clicked',\n      defaultValue: false,\n      contextVariable: ['feature', 'track', 'pluginManager'],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'displayId',\n  },\n)\n\nexport { baseChordDisplayConfig }\n","import React from 'react'\nimport clone from 'clone'\nimport { getParent, isAlive, types } from 'mobx-state-tree'\n\n// jbrowse\nimport { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport CircularChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport RendererType from '@jbrowse/core/pluggableElementTypes/renderers/RendererType'\nimport {\n  getContainingView,\n  getSession,\n  getEnv,\n  isFeature,\n  makeAbortableReaction,\n  AnyReactComponentType,\n  Feature,\n  ReactRendering,\n} from '@jbrowse/core/util'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\n\n// locals\nimport { renderReactionData, renderReactionEffect } from './renderReaction'\nimport {\n  CircularViewModel,\n  ExportSvgOptions,\n} from '../../CircularView/models/model'\nimport { ThemeOptions } from '@mui/material'\nimport { baseChordDisplayConfig } from './configSchema'\n\n/**\n * #stateModel BaseChordDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const BaseChordDisplayModel = types\n  .compose(\n    'BaseChordDisplay',\n    BaseDisplay,\n    types.model({\n      /**\n       * #property\n       */\n      bezierRadiusRatio: 0.1,\n      /**\n       * #property\n       */\n      assemblyName: types.maybe(types.string),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(baseChordDisplayConfig),\n    }),\n  )\n  .volatile(() => ({\n    // NOTE: all this volatile stuff has to be filled in at once\n    // so that it stays consistent\n    filled: false,\n    reactElement: undefined as React.ReactElement | undefined,\n    data: undefined,\n    html: undefined as string | undefined,\n    message: '',\n    renderingComponent: undefined as undefined | AnyReactComponentType,\n    refNameMap: undefined as Record<string, string> | undefined,\n  }))\n  .actions(self => {\n    const { pluginManager } = getEnv(self)\n    const track = self\n    return {\n      /**\n       * #action\n       */\n      onChordClick(feature: Feature) {\n        getConf(self, 'onChordClick', { feature, track, pluginManager })\n      },\n    }\n  })\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get blockDefinitions() {\n      const view = getContainingView(self) as CircularViewModel\n      const origSlices = view.staticSlices\n      if (!self.refNameMap) {\n        return origSlices\n      }\n\n      const slices = clone(origSlices)\n\n      slices.forEach(slice => {\n        const regions = slice.region.elided\n          ? slice.region.regions\n          : [slice.region]\n        regions.forEach(region => {\n          const renamed = self.refNameMap?.[region.refName]\n          if (renamed && region.refName !== renamed) {\n            region.refName = renamed\n          }\n        })\n      })\n      return slices\n    },\n\n    /**\n     * #method\n     */\n    renderProps() {\n      const view = getContainingView(self) as CircularViewModel\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n        bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n        radius: view.radiusPx,\n        blockDefinitions: this.blockDefinitions,\n        onChordClick: self.onChordClick,\n      }\n    },\n\n    /**\n     * #getter\n     * the pluggable element type object for this display's\n     * renderer\n     */\n    get rendererType() {\n      const display = self\n      const { pluginManager } = getEnv(self)\n      const ThisRendererType = pluginManager.getRendererType(\n        self.rendererTypeName,\n      )\n      if (!ThisRendererType) {\n        throw new Error(`renderer \"${display.rendererTypeName}\" not found`)\n      }\n      if (!ThisRendererType.ReactComponent) {\n        throw new Error(\n          `renderer ${display.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n        )\n      }\n      return ThisRendererType\n    },\n\n    /**\n     * #method\n     */\n    isCompatibleWithRenderer(renderer: RendererType) {\n      return !!(renderer instanceof CircularChordRendererType)\n    },\n\n    /**\n     * #getter\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (!isAlive(self)) {\n        return undefined\n      }\n      const session = getSession(self)\n      if (!session) {\n        return undefined\n      }\n      const { selection } = session\n      // does it quack like a feature?\n      if (isFeature(selection)) {\n        return selection.id()\n      }\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    renderStarted() {\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.data = undefined\n      self.html = undefined\n      self.error = undefined\n      self.renderingComponent = undefined\n    },\n    /**\n     * #action\n     */\n    renderSuccess({\n      message,\n      data,\n      reactElement,\n      html,\n      renderingComponent,\n    }: {\n      message: string\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      data: any\n      html: string\n      reactElement: React.ReactElement\n      renderingComponent: AnyReactComponentType\n    }) {\n      if (message) {\n        self.filled = false\n        self.message = message\n        self.reactElement = undefined\n        self.data = undefined\n        self.html = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n      } else {\n        self.filled = true\n        self.message = ''\n        self.reactElement = reactElement\n        self.data = data\n        self.html = html\n        self.error = undefined\n        self.renderingComponent = renderingComponent\n      }\n    },\n    /**\n     * #action\n     */\n    renderError(error: unknown) {\n      console.error(error)\n      // the rendering failed for some reason\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.html = undefined\n      self.data = undefined\n      self.error = error\n      self.renderingComponent = undefined\n    },\n\n    /**\n     * #action\n     */\n    setRefNameMap(refNameMap: Record<string, string>) {\n      self.refNameMap = refNameMap\n    },\n  }))\n  .actions(self => ({\n    afterAttach() {\n      makeAbortableReaction(\n        self,\n        renderReactionData,\n\n        // @ts-expect-error\n        renderReactionEffect,\n        {\n          name: `${self.type} ${self.id} rendering`,\n          // delay: self.renderDelay || 300,\n          fireImmediately: true,\n        },\n        self.renderStarted,\n        self.renderSuccess,\n        self.renderError,\n      )\n\n      makeAbortableReaction(\n        self,\n        () => ({\n          assemblyNames: getTrackAssemblyNames(self.parentTrack),\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          adapter: getConf(getParent<any>(self, 2), 'adapter'),\n          assemblyManager: getSession(self).assemblyManager,\n        }),\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        async ({ assemblyNames, adapter, assemblyManager }: any, signal) => {\n          return assemblyManager.getRefNameMapForAdapter(\n            adapter,\n            assemblyNames[0],\n            { signal, sessionId: getRpcSessionId(self) },\n          )\n        },\n        {\n          name: `${self.type} ${self.id} getting refNames`,\n          fireImmediately: true,\n        },\n        () => {},\n        refNameMap => self.setRefNameMap(refNameMap),\n        error => {\n          console.error(error)\n          self.setError(error)\n        },\n      )\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     */\n    async renderSvg(\n      opts: ExportSvgOptions & {\n        theme: ThemeOptions\n      },\n    ) {\n      const data = renderReactionData(self)\n      const rendering = await renderReactionEffect(\n        {\n          ...data,\n          exportSVG: opts,\n          theme: opts.theme || data.renderProps.theme,\n        },\n        undefined,\n        self,\n      )\n      return <ReactRendering rendering={rendering} />\n    },\n  }))\n","import { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\n\n// locals\n\nimport CircularViewF from './CircularView'\nimport LaunchCircularViewF from './LaunchCircularView'\n\n// icons\nimport DataUsageIcon from '@mui/icons-material/DataUsage'\n\nexport default class CircularViewPlugin extends Plugin {\n  name = 'CircularViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    CircularViewF(pluginManager)\n    LaunchCircularViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Circular view',\n        icon: DataUsageIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('CircularView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  baseChordDisplayConfig,\n  BaseChordDisplayModel,\n  BaseChordDisplayComponent,\n} from './BaseChordDisplay'\n\nexport {\n  type CircularViewModel,\n  type CircularViewStateModel,\n} from './CircularView/models/model'\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport stateModelFactory from './models/model'\n\nexport default function CircularViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(\n    () =>\n      new ViewType({\n        ReactComponent: lazy(() => import('./components/CircularView')),\n        stateModel: stateModelFactory(pluginManager),\n        name: 'CircularView',\n        displayName: 'Circular view',\n      }),\n  )\n}\n","import { when } from 'mobx'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport { CircularViewModel } from '../CircularView/models/model'\n\ntype CGV = CircularViewModel\n\nexport default function LaunchCircularViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-CircularView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      assembly?: string\n      loc: string\n      tracks?: string[]\n    }) => {\n      const { assemblyManager } = session\n      const view = session.addView('CircularView', {}) as CGV\n\n      await when(() => view.initialized)\n\n      if (!assembly) {\n        throw new Error(\n          'No assembly provided when launching circular genome view',\n        )\n      }\n\n      const asm = await assemblyManager.waitForAssembly(assembly)\n      if (!asm) {\n        throw new Error(\n          `Assembly \"${assembly}\" not found when launching circular genome view`,\n        )\n      }\n\n      view.setDisplayedRegions(asm.regions || [])\n\n      tracks.forEach(track => view.showTrack(track))\n    },\n  )\n}\n","import React, { useEffect, useState } from 'react'\nimport { InputLabel, TextField } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\n// fontSize and fontFamily have to match between Editor and SyntaxHighlighter\nconst fontSize = '12px'\n// Optimize by using system default fonts: https://css-tricks.com/snippets/css/font-stacks/\nconst fontFamily =\n  'Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", Monaco, \"Courier New\", Courier, monospace'\n\nconst useStyles = makeStyles()(theme => ({\n  error: {\n    color: 'red',\n    fontSize: '0.8em',\n  },\n  callbackEditor: {\n    fontFamily,\n    fontSize,\n    background: theme.palette.background.default,\n    width: 800,\n    marginTop: '16px',\n    border: '1px solid rgba(0,0,0,0.42)',\n  },\n  callbackContainer: {\n    width: '100%',\n    overflowX: 'auto',\n  },\n  textAreaFont: {\n    fontFamily,\n  },\n}))\n\nconst JsonEditor = observer(function JsonEditor({\n  slot,\n}: {\n  slot: {\n    name: string\n    description: string\n    value: unknown\n    set: (arg: unknown) => void\n  }\n}) {\n  const { classes } = useStyles()\n  const [contents, setContents] = useState(JSON.stringify(slot.value, null, 2))\n  const [error, setError] = useState<unknown>()\n\n  useEffect(() => {\n    try {\n      setError(undefined)\n      slot.set(JSON.parse(contents))\n    } catch (e) {\n      console.error({ e })\n      setError(e)\n    }\n  }, [contents, slot])\n\n  return (\n    <>\n      {error ? <p className={classes.error}>{`${error}`}</p> : null}\n      <div className={classes.callbackContainer}>\n        <InputLabel shrink htmlFor=\"json-editor\">\n          {slot.name}\n        </InputLabel>\n        <TextField\n          id=\"json-editor\"\n          className={classes.callbackEditor}\n          value={contents}\n          helperText={slot.description}\n          multiline\n          onChange={event => setContents(event.target.value)}\n          style={{ background: error ? '#fdd' : undefined }}\n          InputProps={{\n            classes: {\n              input: classes.textAreaFont,\n            },\n          }}\n        />\n      </div>\n    </>\n  )\n})\n\nexport default JsonEditor\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config FromConfigAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'FromConfigAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FromConfigRegionsAdapter\n * used for specifying refNames+sizes of an assembly\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst regionsConfigSchema = ConfigurationSchema(\n  'FromConfigRegionsAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  {\n    explicitlyTyped: true,\n    implicitIdentifier: 'adapterId',\n  },\n)\nexport default regionsConfigSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FromConfigSequenceAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst sequenceConfigSchema = ConfigurationSchema(\n  'FromConfigSequenceAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n\nexport default sequenceConfigSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config RefNameAliasAdapter\n * can read \"chromAliases\" type files from UCSC or any tab separated file of\n * refName aliases\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst RefNameAliasAdapter = ConfigurationSchema(\n  'RefNameAliasAdapter',\n  {\n    /**\n     * #slot\n     */\n    location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/aliases.txt',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     * by default, the \"ref names that match the fasta\" are assumed to be in the\n     * first column (0), change this variable if needed\n     */\n    refNameColumn: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default RefNameAliasAdapter\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('ConfigurationEditorWidget', {\n      id: ElementId,\n      type: types.literal('ConfigurationEditorWidget'),\n      // If you add different types of targets, don't forget to account for that\n      // in the key of ./components/ConfigurationEditor.js\n      target: types.safeReference(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    .actions(self => ({\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      setTarget(newTarget: any) {\n        self.target = newTarget\n      },\n    }))\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { isStateTreeNode, getType } from 'mobx-state-tree'\n\nconst HeadingComponent = observer(function ({\n  model,\n}: {\n  model?: { target: { type: string } }\n}) {\n  if (model?.target) {\n    if (model.target.type) {\n      return `${model.target.type} settings`\n    }\n    if (isStateTreeNode(model.target)) {\n      const type = getType(model.target)\n      if (type?.name) {\n        return `${type.name.replace('ConfigurationSchema', '')} settings`\n      }\n    }\n  }\n  return <>Settings</>\n})\n\nexport default HeadingComponent\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport stateModelFactory from './model'\nimport HeadingComponent from './components/HeadingComponent'\n\nconst configSchema = ConfigurationSchema('ConfigurationEditorWidget', {})\n\nconst LazyConfigurationEditorComponent = lazy(\n  () => import('./components/ConfigurationEditor'),\n)\n\nexport default function registerConfigurationEditorWidget(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'ConfigurationEditorWidget',\n      HeadingComponent,\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: LazyConfigurationEditorComponent,\n    })\n  })\n}\n","import { lazy } from 'react'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport FromConfigAdapterF from './FromConfigAdapter'\nimport FromConfigRegionsAdapterF from './FromConfigRegionsAdapter'\nimport FromConfigSequenceAdapterF from './FromConfigSequenceAdapter'\nimport RefNameAliasAdapterF from './RefNameAliasAdapter'\nimport ConfigurationEditorWidgetF from './ConfigurationEditorWidget'\n\nconst LazyConfigurationEditorComponent = lazy(\n  () => import('./ConfigurationEditorWidget/components/ConfigurationEditor'),\n)\n\nexport default class ConfigurationPlugin extends Plugin {\n  name = 'ConfigurationPlugin'\n\n  install(pluginManager: PluginManager) {\n    FromConfigAdapterF(pluginManager)\n    FromConfigRegionsAdapterF(pluginManager)\n    FromConfigSequenceAdapterF(pluginManager)\n    RefNameAliasAdapterF(pluginManager)\n    ConfigurationEditorWidgetF(pluginManager)\n  }\n}\n\nexport { default as JsonEditor } from './ConfigurationEditorWidget/components/JsonEditor'\n\nexport { LazyConfigurationEditorComponent as ConfigurationEditor }\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\n\nexport default function FromConfigAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'FromConfigAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./FromConfigAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\n\nexport default function FromConfigRegionsAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'FromConfigRegionsAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./FromConfigRegionsAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport configSchema from './configSchema'\n\nexport default function FromConfigSequenceAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'FromConfigSequenceAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./FromConfigSequenceAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport configSchema from './configSchema'\n\nexport default function RefNameAliasAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'RefNameAliasAdapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./RefNameAliasAdapter').then(r => r.default),\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n      }),\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default types.model('AddConnectionModel', {\n  id: ElementId,\n  type: types.literal('AddConnectionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { lazy } from 'react'\n\nimport stateModel from './model'\nconst configSchema = ConfigurationSchema('AddConnectionWidget', {})\n\nexport default function AddConnectionWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'AddConnectionWidget',\n      heading: 'Add a connection',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./components/AddConnectionWidget')),\n    })\n  })\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  guessAdapter,\n  guessTrackType,\n  getFileName,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\n\nfunction isAbsoluteUrl(url = '') {\n  try {\n    new URL(url)\n    return true\n  } catch (error) {\n    return url.startsWith('/')\n  }\n}\ninterface IndexingAttr {\n  attributes: string[]\n  exclude: string[]\n}\n\n/**\n * #stateModel AddTrackModel\n */\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('AddTrackModel', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('AddTrackWidget'),\n      /**\n       * #property\n       */\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({\n      trackSource: 'fromFile',\n      trackData: undefined as FileLocation | undefined,\n      indexTrackData: undefined as FileLocation | undefined,\n\n      // alts\n      altAssemblyName: '',\n      altTrackName: '',\n      altTrackType: '',\n\n      adapterHint: '',\n      textIndexTrack: true,\n      textIndexingConf: undefined as IndexingAttr | undefined,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setAdapterHint(obj: string) {\n        self.adapterHint = obj\n      },\n      /**\n       * #action\n       */\n      setTrackSource(str: string) {\n        self.trackSource = str\n      },\n      /**\n       * #action\n       */\n      setTextIndexingConf(conf: IndexingAttr) {\n        self.textIndexingConf = conf\n      },\n      /**\n       * #action\n       */\n      setTextIndexTrack(flag: boolean) {\n        self.textIndexTrack = flag\n      },\n      /**\n       * #action\n       */\n      setTrackData(obj: FileLocation) {\n        self.trackData = obj\n      },\n      /**\n       * #action\n       */\n      setIndexTrackData(obj: FileLocation) {\n        self.indexTrackData = obj\n      },\n      /**\n       * #action\n       */\n      setAssembly(str: string) {\n        self.altAssemblyName = str\n      },\n      /**\n       * #action\n       */\n      setTrackName(str: string) {\n        self.altTrackName = str\n      },\n      /**\n       * #action\n       */\n      setTrackType(str: string) {\n        self.altTrackType = str\n      },\n      /**\n       * #action\n       */\n      clearData() {\n        self.trackSource = ''\n        self.altTrackName = ''\n        self.altTrackType = ''\n        self.altAssemblyName = ''\n        self.adapterHint = ''\n        self.indexTrackData = undefined\n        self.trackData = undefined\n        self.textIndexingConf = undefined\n        self.textIndexTrack = true\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get trackAdapter() {\n        const { trackData, indexTrackData, adapterHint } = self\n\n        return trackData\n          ? guessAdapter(trackData, indexTrackData, adapterHint, self)\n          : undefined\n      },\n\n      /**\n       * #getter\n       */\n      get trackName() {\n        return (\n          self.altTrackName ||\n          (self.trackData ? getFileName(self.trackData) : '')\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get isFtp() {\n        const { trackData: track, indexTrackData: index } = self\n        return !!(\n          // @ts-expect-error\n          (index?.uri?.startsWith('ftp://') || track?.uri?.startsWith('ftp://'))\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get isRelativeTrackUrl() {\n        // @ts-expect-error\n        const uri = self.trackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      /**\n       * #getter\n       */\n      get isRelativeIndexUrl() {\n        // @ts-expect-error\n        const uri = self.indexTrackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      /**\n       * #getter\n       */\n      get isRelativeUrl() {\n        return this.isRelativeIndexUrl || this.isRelativeTrackUrl\n      },\n\n      /**\n       * #getter\n       */\n      get trackHttp() {\n        // @ts-expect-error\n        return self.trackData?.uri?.startsWith('http://')\n      },\n      /**\n       * #getter\n       */\n      get indexHttp() {\n        // @ts-expect-error\n        return self.indexTrackData?.uri?.startsWith('http://')\n      },\n\n      /**\n       * #getter\n       */\n      get wrongProtocol() {\n        return (\n          window.location.protocol === 'https:' &&\n          (this.trackHttp || this.indexHttp)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get unsupported() {\n        return this.trackAdapter?.type === UNSUPPORTED\n      },\n\n      /**\n       * #getter\n       */\n      get assembly() {\n        return self.altAssemblyName || self.view.assemblyNames?.[0]\n      },\n\n      /**\n       * #getter\n       */\n      get trackType() {\n        return (\n          self.altTrackType ||\n          (this.trackAdapter\n            ? guessTrackType(this.trackAdapter.type, self)\n            : '')\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get warningMessage() {\n        if (self.isFtp) {\n          return `Warning: JBrowse cannot access files using the ftp protocol`\n        } else if (self.isRelativeUrl) {\n          return `Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.`\n        } else if (self.wrongProtocol) {\n          return `Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol`\n        }\n        return ''\n      },\n    }))\n}\n\nexport type AddTrackStateModel = ReturnType<typeof f>\nexport type AddTrackModel = Instance<AddTrackStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { lazy } from 'react'\n\nimport stateModelFactory from './model'\nconst configSchema = ConfigurationSchema('AddTrackWidget', {})\n\nexport default function AddTrackWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'AddTrackWidget',\n      heading: 'Add a track',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/AddTrackWidget')),\n    })\n  })\n}\n","export interface Row {\n  id: string\n  metadata?: Record<string, unknown>\n  [key: string]: unknown\n}\n\nexport function getRowStr(facet: string, row: Row) {\n  return `${\n    (facet.startsWith('metadata.')\n      ? row.metadata?.[facet.replace('metadata.', '')]\n      : row[facet]) || ''\n  }`\n}\n","import {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\n\nexport function hasAnyOverlap<T>(a1: T[] = [], a2: T[] = []) {\n  // shortcut case is that arrays are single entries, and are equal\n  // long case is that we use a set\n  if (a1[0] === a2[0]) {\n    return true\n  } else {\n    const s1 = new Set(a1)\n    return a2.some(a => s1.has(a))\n  }\n}\n\nexport function hasAllOverlap<T>(a1: T[] = [], a2: T[] = []) {\n  const s1 = new Set(a1)\n  return a2.every(a => s1.has(a))\n}\n\nexport function matches(\n  query: string,\n  conf: AnyConfigurationModel,\n  session: AbstractSessionModel,\n) {\n  const categories = (readConfObject(conf, 'category') || []) as string[]\n  const queryLower = query.toLowerCase()\n  return (\n    getTrackName(conf, session).toLowerCase().includes(queryLower) ||\n    !!categories.filter(c => c.toLowerCase().includes(queryLower)).length\n  )\n}\n\ninterface Node {\n  children: Node[]\n  id: string\n}\n\nexport function findSubCategories(obj: Node[], paths: string[], depth = 0) {\n  let hasSubs = false\n  for (const elt of obj) {\n    if (elt.children.length) {\n      const hasSubCategories = findSubCategories(elt.children, paths, depth + 1)\n      // avoid pushing the root \"Tracks\" node by checking depth>0\n      if (hasSubCategories && depth > 0) {\n        paths.push(elt.id)\n      }\n    } else {\n      hasSubs = true\n    }\n  }\n  return hasSubs\n}\n\nexport function findTopLevelCategories(obj: Node[], paths: string[]) {\n  for (const elt of obj) {\n    if (elt.children.length) {\n      paths.push(elt.id)\n    }\n  }\n}\n","import {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getEnv, getSession, notEmpty } from '@jbrowse/core/util'\nimport { hasAllOverlap, hasAnyOverlap } from './util'\n\nexport function filterTracks(\n  tracks: AnyConfigurationModel[],\n  self: {\n    view?: {\n      type: string\n      trackSelectorAnyOverlap?: boolean\n    }\n    assemblyNames: string[]\n  },\n) {\n  const { assemblyManager } = getSession(self)\n  const { pluginManager } = getEnv(self)\n  const { view } = self\n\n  if (!view) {\n    return []\n  }\n  const trackListAssemblies = self.assemblyNames\n    .map(a => assemblyManager.get(a))\n    .filter(notEmpty)\n  return tracks\n    .filter(c => {\n      const trackAssemblyNames = readConfObject(c, 'assemblyNames') as string[]\n      const trackAssemblies = trackAssemblyNames\n        ?.map(name => assemblyManager.get(name))\n        .filter(notEmpty)\n      return view.trackSelectorAnyOverlap\n        ? hasAnyOverlap(trackAssemblies, trackListAssemblies)\n        : hasAllOverlap(trackAssemblies, trackListAssemblies)\n    })\n    .filter(c => {\n      const { displayTypes } = pluginManager.getViewType(view.type)\n      const compatDisplays = displayTypes.map(d => d.name)\n      const trackDisplays = c.displays.map((d: { type: string }) => d.type)\n      return hasAnyOverlap(compatDisplays, trackDisplays)\n    })\n}\n","import {\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\n\n// locals\nimport { matches } from './util'\nimport { MenuItem } from '@jbrowse/core/ui'\n\nfunction sortConfs(\n  confs: AnyConfigurationModel[],\n  sortNames: boolean,\n  sortCategories: boolean,\n) {\n  // uses readConfObject instead of getTrackName so that the undefined\n  // reference sequence track is sorted to the top\n  const ret = confs.map(c => [\n    c,\n    readConfObject(c, 'name'),\n    readConfObject(c, 'category')?.[0] || '',\n    readConfObject(c, 'category')?.[1] || '',\n    readConfObject(c, 'category')?.[2] || '',\n  ])\n  if (sortNames) {\n    ret.sort((a, b) => a[1].localeCompare(b[1]))\n  }\n  if (sortCategories) {\n    // sort up to three sub-category levels, harder to code it to go deeper\n    // than this and likely rarely used\n    ret.sort((a, b) => {\n      if (a[2] !== b[2]) {\n        return a[2].localeCompare(b[2])\n      } else if (a[3] !== b[3]) {\n        return a[3].localeCompare(b[3])\n      } else if (a[4] !== b[4]) {\n        return a[4].localeCompare(b[4])\n      }\n      return 0\n    })\n  }\n  return ret.map(a => a[0])\n}\n\nexport interface TreeTrackNode {\n  name: string\n  id: string\n  trackId: string\n  conf: AnyConfigurationModel\n  checked: boolean\n  children: TreeNode[] // empty\n  type: 'track'\n}\n\nexport interface TreeCategoryNode {\n  name: string\n  id: string\n  isOpenByDefault: boolean\n  children: TreeNode[]\n  type: 'category'\n}\n\nexport type TreeNode = TreeTrackNode | TreeCategoryNode\n\nexport function generateHierarchy({\n  model,\n  trackConfs,\n  extra,\n  noCategories,\n  menuItems,\n}: {\n  model: {\n    filterText: string\n    activeSortTrackNames: boolean\n    activeSortCategories: boolean\n    collapsed: Map<string | number, boolean>\n    view?: {\n      tracks: { configuration: AnyConfigurationModel }[]\n    }\n  }\n  noCategories?: boolean\n  menuItems?: MenuItem[]\n  trackConfs: AnyConfigurationModel[]\n  extra?: string\n}): TreeNode[] {\n  const hierarchy = { children: [] as TreeNode[] } as TreeNode\n  const {\n    collapsed,\n    filterText,\n    activeSortTrackNames,\n    activeSortCategories,\n    view,\n  } = model\n  if (!view) {\n    return []\n  }\n  const session = getSession(model)\n  const viewTracks = view.tracks\n  const confs = trackConfs.filter(conf => matches(filterText, conf, session))\n\n  // uses getConf\n  for (const conf of sortConfs(\n    confs,\n    activeSortTrackNames,\n    activeSortCategories,\n  )) {\n    // copy the categories since this array can be mutated downstream\n    const categories = [...(readConfObject(conf, 'category') || [])]\n\n    // hack where if trackId ends with sessionTrack, then push it to a\n    // category that starts with a space to force sort to the top\n    if (conf.trackId.endsWith('sessionTrack')) {\n      categories.unshift(' Session tracks')\n    }\n\n    let currLevel = hierarchy\n\n    if (!noCategories) {\n      // find existing category to put track into or create it\n      for (let i = 0; i < categories.length; i++) {\n        const category = categories[i]\n        const ret = currLevel.children.find(c => c.name === category)\n        const id = [extra, categories.slice(0, i + 1).join(',')]\n          .filter(f => !!f)\n          .join('-')\n        if (!ret) {\n          const n = {\n            children: [],\n            name: category,\n            id,\n            isOpenByDefault: !collapsed.get(id),\n            menuItems,\n            type: 'category' as const,\n          }\n          currLevel.children.push(n)\n          currLevel = n\n        } else {\n          currLevel = ret\n        }\n      }\n    }\n\n    // uses splice to try to put all leaf nodes above \"category nodes\" if you\n    // change the splice to a simple push and open\n    // test_data/test_order/config.json you will see the weirdness\n    const r = currLevel.children.findIndex(elt => elt.children.length)\n    const idx = r === -1 ? currLevel.children.length : r\n    currLevel.children.splice(idx, 0, {\n      id: [extra, conf.trackId].filter(f => !!f).join(','),\n      trackId: conf.trackId,\n      name: getTrackName(conf, session),\n      conf,\n      checked: viewTracks.some(f => f.configuration === conf),\n      children: [],\n      type: 'track' as const,\n    })\n  }\n\n  return hierarchy.children\n}\n","export function findNonSparseKeys(\n  keys: readonly string[],\n  rows: Record<string, unknown>[],\n  cb: (row: Record<string, unknown>, f: string) => unknown,\n) {\n  return keys.filter(f => rows.map(r => cb(r, f)).filter(f => !!f).length > 5)\n}\n\nexport function getRootKeys(obj: Record<string, unknown>) {\n  return Object.entries(obj)\n    .map(([key, val]) => (typeof val === 'string' ? key : ''))\n    .filter(f => !!f)\n}\n","import { Instance, addDisposer, getParent, types } from 'mobx-state-tree'\nimport { matches } from './util'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { getSession, localStorageGetItem } from '@jbrowse/core/util'\nimport { autorun, observable } from 'mobx'\nimport { getRootKeys, findNonSparseKeys } from './facetedUtil'\nimport { getRowStr } from './components/faceted/util'\n\nconst nonMetadataKeys = ['category', 'adapter', 'description'] as const\n\n/**\n * #stateModel FacetedModel\n */\nexport function facetedStateTreeF() {\n  return types\n    .model('FacetedModel', {\n      /**\n       * #property\n       */\n      filterText: types.optional(types.string, ''),\n      /**\n       * #property\n       */\n      showSparse: types.optional(types.boolean, () =>\n        JSON.parse(localStorageGetItem('facet-showSparse') || 'false'),\n      ),\n      /**\n       * #property\n       */\n      showFilters: types.optional(types.boolean, () =>\n        JSON.parse(localStorageGetItem('facet-showFilters') || 'true'),\n      ),\n\n      /**\n       * #property\n       */\n      showOptions: types.optional(types.boolean, () =>\n        JSON.parse(localStorageGetItem('facet-showTableOptions') || 'false'),\n      ),\n\n      /**\n       * #property\n       */\n      panelWidth: types.optional(types.number, () =>\n        JSON.parse(localStorageGetItem('facet-panelWidth') || '400'),\n      ),\n    })\n    .volatile(() => ({\n      visible: {} as Record<string, boolean>,\n      useShoppingCart: false,\n      filters: observable.map<string, string[]>(),\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFilter(key: string, value: string[]) {\n        self.filters.set(key, value)\n      },\n      /**\n       * #action\n       */\n      setPanelWidth(width: number) {\n        self.panelWidth = width\n      },\n      /**\n       * #action\n       */\n      setUseShoppingCart(f: boolean) {\n        self.useShoppingCart = f\n      },\n      /**\n       * #action\n       */\n      setFilterText(str: string) {\n        self.filterText = str\n      },\n      /**\n       * #action\n       */\n      setShowSparse(f: boolean) {\n        self.showSparse = f\n      },\n      /**\n       * #action\n       */\n      setShowOptions(f: boolean) {\n        self.showOptions = f\n      },\n      /**\n       * #action\n       */\n      setShowFilters(f: boolean) {\n        self.showFilters = f\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get allTrackConfigurations() {\n        return getParent<{ allTrackConfigurations: AnyConfigurationModel[] }>(\n          self,\n        ).allTrackConfigurations\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rows() {\n        const session = getSession(self)\n        const { allTrackConfigurations, filterText } = self\n        return allTrackConfigurations\n          .filter(conf => matches(filterText, conf, session))\n          .map(track => {\n            return {\n              id: track.trackId as string,\n              conf: track,\n              name: getTrackName(track, session),\n              category: readConfObject(track, 'category')?.join(', ') as string,\n              adapter: readConfObject(track, 'adapter')?.type as string,\n              description: readConfObject(track, 'description') as string,\n              metadata: readConfObject(track, 'metadata') as Record<\n                string,\n                unknown\n              >,\n            } as const\n          })\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get filteredNonMetadataKeys() {\n        return self.showSparse\n          ? nonMetadataKeys\n          : findNonSparseKeys(nonMetadataKeys, self.rows, (r, f) => r[f])\n      },\n      /**\n       * #getter\n       */\n      get metadataKeys() {\n        return [...new Set(self.rows.flatMap(row => getRootKeys(row.metadata)))]\n      },\n      get filteredMetadataKeys() {\n        return self.showSparse\n          ? this.metadataKeys\n          : findNonSparseKeys(\n              this.metadataKeys,\n              self.rows,\n              // @ts-expect-error\n              (r, f) => r.metadata[f],\n            )\n      },\n      /**\n       * #getter\n       */\n      get fields() {\n        return [\n          'name',\n          ...this.filteredNonMetadataKeys,\n          ...this.filteredMetadataKeys.map(m => `metadata.${m}`),\n        ]\n      },\n      /**\n       * #getter\n       */\n      get filteredRows() {\n        const arrFilters = [...self.filters.entries()]\n          .filter(f => f[1].length > 0)\n          .map(([key, val]) => [key, new Set(val)] as const)\n        return self.rows.filter(row =>\n          arrFilters.every(([key, val]) => val.has(getRowStr(key, row))),\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setVisible(args: Record<string, boolean>) {\n        self.visible = args\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            this.setVisible(Object.fromEntries(self.fields.map(c => [c, true])))\n          }),\n        )\n      },\n    }))\n}\n\nexport type FacetedStateModel = ReturnType<typeof facetedStateTreeF>\nexport type FacetedModel = Instance<FacetedStateModel>\n","import { types, addDisposer, Instance } from 'mobx-state-tree'\nimport { autorun, observable } from 'mobx'\nimport {\n  getConf,\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport {\n  dedupe,\n  getSession,\n  localStorageGetItem,\n  localStorageSetItem,\n  notEmpty,\n} from '@jbrowse/core/util'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport { filterTracks } from './filterTracks'\nimport { generateHierarchy } from './generateHierarchy'\nimport { findSubCategories, findTopLevelCategories } from './util'\nimport { facetedStateTreeF } from './facetedModel'\n\ntype MaybeAnyConfigurationModel = AnyConfigurationModel | undefined\n\n// for settings that are not config dependent\nfunction keyNoConfigPostFix() {\n  return typeof window !== 'undefined'\n    ? [window.location.host, window.location.pathname].join('-')\n    : 'empty'\n}\n\n// for settings that are config dependent\nfunction keyConfigPostFix() {\n  return typeof window !== 'undefined'\n    ? [\n        keyNoConfigPostFix(),\n        new URLSearchParams(window.location.search).get('config'),\n      ].join('-')\n    : 'empty'\n}\n\nfunction recentlyUsedK(assemblyNames: string[]) {\n  return ['recentlyUsedTracks', keyConfigPostFix(), assemblyNames.join(',')]\n    .filter(f => !!f)\n    .join('-')\n}\n\n// this has a extra } at the end because that's how it was initially\n// released\nfunction favoritesK() {\n  return `favoriteTracks-${keyConfigPostFix()}}`\n}\n\nfunction collapsedK(assemblyNames: string[], viewType: string) {\n  return [\n    'collapsedCategories',\n    keyConfigPostFix(),\n    assemblyNames.join(','),\n    viewType,\n  ].join('-')\n}\n\nfunction sortTrackNamesK() {\n  return 'sortTrackNames'\n}\nfunction sortCategoriesK() {\n  return 'sortCategories'\n}\n\nfunction localStorageGetJSON<T>(key: string, defaultValue: string) {\n  return JSON.parse(localStorageGetItem(key) ?? defaultValue) as T\n}\nfunction localStorageSetJSON(key: string, val: unknown) {\n  localStorageSetItem(key, JSON.stringify(val))\n}\n\nconst MAX_RECENTLY_USED = 10\n\n/**\n * #stateModel HierarchicalTrackSelectorWidget\n */\nexport default function stateTreeFactory(pluginManager: PluginManager) {\n  return types\n    .model('HierarchicalTrackSelectorWidget', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('HierarchicalTrackSelectorWidget'),\n\n      /**\n       * #property\n       */\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      /**\n       * #property\n       */\n      faceted: types.optional(facetedStateTreeF(), {}),\n    })\n    .volatile(() => ({\n      favorites: localStorageGetJSON<string[]>(favoritesK(), '[]'),\n      recentlyUsed: [] as string[],\n      selection: [] as AnyConfigurationModel[],\n      sortTrackNames: !!localStorageGetJSON<Boolean>(\n        sortTrackNamesK(),\n        'false',\n      ),\n      sortCategories: !!localStorageGetJSON<Boolean>(\n        sortCategoriesK(),\n        'false',\n      ),\n      collapsed: observable.map<string, boolean>(),\n      filterText: '',\n      recentlyUsedCounter: 0,\n      favoritesCounter: 0,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get shownTrackIds() {\n        return new Set<string>(\n          self.view?.tracks?.map(\n            (t: { configuration: { trackId: string } }) =>\n              t.configuration.trackId,\n          ),\n        )\n      },\n      /**\n       * #getter\n       */\n      get selectionSet() {\n        return new Set(self.selection)\n      },\n      /**\n       * #getter\n       */\n      get favoritesSet() {\n        return new Set(self.favorites)\n      },\n      /**\n       * #getter\n       */\n      get recentlyUsedSet() {\n        return new Set(self.recentlyUsed)\n      },\n      /**\n       * #getter\n       */\n      get assemblyNames(): string[] {\n        return self.view?.assemblyNames || []\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSortTrackNames(val: boolean) {\n        self.sortTrackNames = val\n      },\n      /**\n       * #action\n       */\n      setSortCategories(val: boolean) {\n        self.sortCategories = val\n      },\n      /**\n       * #action\n       */\n      setSelection(elt: AnyConfigurationModel[]) {\n        self.selection = elt\n      },\n      /**\n       * #action\n       */\n      addToSelection(elt: AnyConfigurationModel[]) {\n        self.selection = dedupe([...self.selection, ...elt], e => e.trackId)\n      },\n      /**\n       * #action\n       */\n      removeFromSelection(elt: AnyConfigurationModel[]) {\n        const s = new Set(elt)\n        self.selection = self.selection.filter(f => !s.has(f))\n      },\n      /**\n       * #action\n       */\n      clearSelection() {\n        self.selection = []\n      },\n\n      /**\n       * #action\n       */\n      addToFavorites(trackId: string) {\n        self.favoritesCounter += 1\n        self.favorites = [...self.favorites, trackId]\n      },\n      /**\n       * #action\n       */\n      removeFromFavorites(trackId: string) {\n        self.favorites = self.favorites.filter(f => f !== trackId)\n      },\n      /**\n       * #action\n       */\n      clearFavorites() {\n        self.favorites = []\n      },\n\n      /**\n       * #action\n       */\n      setRecentlyUsedCounter(val: number) {\n        self.recentlyUsedCounter = val\n      },\n      /**\n       * #action\n       */\n      setRecentlyUsed(str: string[]) {\n        self.recentlyUsed = str\n      },\n      /**\n       * #action\n       */\n      setFavorites(str: string[]) {\n        self.favorites = str\n      },\n      /**\n       * #action\n       */\n      setFavoritesCounter(val: number) {\n        self.favoritesCounter = val\n      },\n      /**\n       * #action\n       */\n      addToRecentlyUsed(id: string) {\n        if (!self.recentlyUsed.includes(id)) {\n          self.recentlyUsedCounter = Math.min(\n            self.recentlyUsedCounter + 1,\n            MAX_RECENTLY_USED,\n          )\n          self.recentlyUsed =\n            self.recentlyUsed.length >= MAX_RECENTLY_USED\n              ? [...self.recentlyUsed.slice(1), id]\n              : [...self.recentlyUsed, id]\n        }\n      },\n      /**\n       * #action\n       */\n      clearRecentlyUsed() {\n        self.recentlyUsed = []\n      },\n      /**\n       * #action\n       */\n      setView(view: unknown) {\n        self.view = view\n      },\n      /**\n       * #action\n       */\n      toggleCategory(pathName: string) {\n        self.collapsed.set(pathName, !self.collapsed.get(pathName))\n      },\n      /**\n       * #action\n       */\n      setCategoryCollapsed(pathName: string, status: boolean) {\n        self.collapsed.set(pathName, status)\n      },\n      /**\n       * #action\n       */\n      expandAllCategories() {\n        self.collapsed.clear()\n      },\n      /**\n       * #action\n       */\n      setCollapsedCategories(str: [string, boolean][]) {\n        self.collapsed.replace(str)\n      },\n      /**\n       * #action\n       */\n      clearFilterText() {\n        self.filterText = ''\n      },\n      /**\n       * #action\n       */\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      isSelected(track: AnyConfigurationModel) {\n        return self.selectionSet.has(track)\n      },\n      /**\n       * #method\n       */\n      isFavorite(trackId: string) {\n        return self.favoritesSet.has(trackId)\n      },\n      /**\n       * #method\n       */\n      isRecentlyUsed(trackId: string) {\n        return self.recentlyUsedSet.has(trackId)\n      },\n      /**\n       * #method\n       */\n      getRefSeqTrackConf(assemblyName: string): MaybeAnyConfigurationModel {\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        const trackConf = assembly?.configuration.sequence\n        const viewType = pluginManager.getViewType(self.view.type)\n        if (trackConf) {\n          for (const display of trackConf.displays) {\n            if (viewType.displayTypes.some(d => d.name === display.type)) {\n              return trackConf\n            }\n          }\n        }\n        return undefined\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get activeSortTrackNames() {\n        return (\n          self.sortTrackNames ??\n          getConf(getSession(self), ['hierarchical', 'sort', 'trackNames'])\n        )\n      },\n      /**\n       * #getter\n       */\n      get activeSortCategories() {\n        return (\n          self.sortCategories ??\n          getConf(getSession(self), ['hierarchical', 'sort', 'categories'])\n        )\n      },\n\n      /**\n       * #getter\n       * filter out tracks that don't match the current assembly/display types\n       */\n      get configAndSessionTrackConfigurations() {\n        return [\n          ...self.assemblyNames.map(a => self.getRefSeqTrackConf(a)),\n          ...filterTracks(getSession(self).tracks, self),\n        ].filter(notEmpty)\n      },\n      /**\n       * #getter\n       */\n      get allTrackConfigurations() {\n        const { connectionInstances = [] } = getSession(self)\n        return [\n          ...this.configAndSessionTrackConfigurations,\n          ...(connectionInstances?.flatMap(c => c.tracks) || []),\n        ]\n      },\n\n      /**\n       * #getter\n       */\n      get allTrackConfigurationTrackIdSet() {\n        return new Map(this.allTrackConfigurations.map(t => [t.trackId, t]))\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * filters out tracks that are not in the favorites group\n       */\n      get favoriteTracks() {\n        return self.favorites\n          .filter(t => self.allTrackConfigurationTrackIdSet.has(t))\n          .map(t => self.allTrackConfigurationTrackIdSet.get(t)!)\n      },\n\n      /**\n       * #getter\n       * filters out tracks that are not in the recently used group\n       */\n      get recentlyUsedTracks() {\n        return self.recentlyUsed\n          .filter(t => self.allTrackConfigurationTrackIdSet.has(t))\n          .map(t => self.allTrackConfigurationTrackIdSet.get(t)!)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get allTracks() {\n        const { connectionInstances = [] } = getSession(self)\n        return [\n          {\n            group: 'Tracks',\n            tracks: self.configAndSessionTrackConfigurations,\n            noCategories: false,\n            menuItems: [],\n          },\n          ...connectionInstances.flatMap(c => ({\n            group: getConf(c, 'name'),\n            tracks: c.tracks,\n            noCategories: false,\n            menuItems: [],\n          })),\n        ]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get hierarchy() {\n        return {\n          name: 'Root',\n          id: 'Root',\n          isOpenByDefault: true,\n          type: 'category' as const,\n          children: self.allTracks.map(s => ({\n            name: s.group,\n            id: s.group,\n            type: 'category' as const,\n            isOpenByDefault: !self.collapsed.get(s.group),\n            menuItems: s.menuItems,\n            children: generateHierarchy({\n              model: self,\n              trackConfs: s.tracks,\n              extra: s.group,\n              noCategories: s.noCategories,\n            }),\n          })),\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      collapseSubCategories() {\n        const paths = [] as string[]\n        findSubCategories(self.hierarchy.children, paths)\n        for (const path of paths) {\n          self.setCategoryCollapsed(path, true)\n        }\n      },\n      /**\n       * #action\n       */\n      collapseTopLevelCategories() {\n        const paths = [] as string[]\n        for (const trackGroups of self.hierarchy.children) {\n          if (trackGroups.children.length) {\n            findTopLevelCategories(trackGroups.children, paths)\n          }\n        }\n        for (const path of paths) {\n          self.setCategoryCollapsed(path, true)\n        }\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get hasAnySubcategories() {\n        return self.allTracks.some(group =>\n          group.tracks.some(t => readConfObject(t, 'category')?.length > 1),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // this should be the first autorun to properly initialize\n        addDisposer(\n          self,\n          autorun(() => {\n            const { assemblyNames, view } = self\n\n            self.setRecentlyUsed(\n              localStorageGetJSON<string[]>(recentlyUsedK(assemblyNames), '[]'),\n            )\n            if (view) {\n              const val = localStorageGetItem(\n                collapsedK(assemblyNames, view.type),\n              )\n              if (!val) {\n                self.expandAllCategories()\n                const session = getSession(self)\n                if (\n                  getConf(session, [\n                    'hierarchical',\n                    'defaultCollapsed',\n                    'topLevelCategories',\n                  ])\n                ) {\n                  self.collapseTopLevelCategories()\n                }\n                if (\n                  getConf(session, [\n                    'hierarchical',\n                    'defaultCollapsed',\n                    'subCategories',\n                  ])\n                ) {\n                  self.collapseSubCategories()\n                }\n                for (const entry of getConf(session, [\n                  'hierarchical',\n                  'defaultCollapsed',\n                  'categoryNames',\n                ])) {\n                  self.setCategoryCollapsed(`Tracks-${entry}`, true)\n                }\n              } else {\n                self.setCollapsedCategories(JSON.parse(val))\n              }\n            }\n          }),\n        )\n        // this should be the second autorun\n        addDisposer(\n          self,\n          autorun(() => {\n            const { assemblyNames, collapsed, view } = self\n            localStorageSetJSON(recentlyUsedK(assemblyNames), self.recentlyUsed)\n            localStorageSetJSON(favoritesK(), self.favorites)\n            localStorageSetJSON(sortTrackNamesK(), self.sortTrackNames)\n            localStorageSetJSON(sortCategoriesK(), self.sortCategories)\n            if (view) {\n              localStorageSetJSON(\n                collapsedK(assemblyNames, view.type),\n                collapsed,\n              )\n            }\n          }),\n        )\n      },\n    }))\n}\n\nexport type HierarchicalTrackSelectorStateModel = ReturnType<\n  typeof stateTreeFactory\n>\nexport type HierarchicalTrackSelectorModel =\n  Instance<HierarchicalTrackSelectorStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nconst configSchema = ConfigurationSchema('HierarchicalTrackSelectorWidget', {})\nexport default configSchema\n","import stateModelFactory from './model'\nimport configSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport { lazy } from 'react'\n\nexport default function HierarchicalTrackSelectorWidgetF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'HierarchicalTrackSelectorWidget',\n      heading: 'Available tracks',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(\n        () => import('./components/HierarchicalTrackSelector'),\n      ),\n    })\n  })\n}\n\nexport {\n  type HierarchicalTrackSelectorModel,\n  default as stateModelFactory,\n} from './model'\nexport { default as configSchema } from './configSchema'\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('PluginStoreModel', {\n      id: ElementId,\n      type: types.literal('PluginStoreWidget'),\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n}\n\nexport type PluginStoreStateModel = ReturnType<typeof stateModelFactory>\nexport type PluginStoreModel = Instance<PluginStoreStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { lazy } from 'react'\n\nimport stateModelFactory from './model'\nconst configSchema = ConfigurationSchema('PluginStoreWidget', {})\n\nexport default function PluginStoreWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'PluginStoreWidget',\n      heading: 'Plugin store',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/PluginStoreWidget')),\n    })\n  })\n}\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config UCSCTrackHubConnection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst UCSCTrackHubConnection = ConfigurationSchema(\n  'UCSCTrackHubConnection',\n  {\n    /**\n     * #slot\n     */\n    hubTxtLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/path/to/hub.txt',\n        locationType: 'UriLocation',\n      },\n      description: 'location of the hub file (usually called hub.txt)',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'optional list of genomes to import from this track hub, if empty all genomes will be imported',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseConnectionConfig,\n  },\n)\n\nexport default UCSCTrackHubConnection\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n// locals\nimport configSchema from './configSchema'\n\n/**\n * #stateModel UCSCTrackHubConnection\n * extends BaseConnectionModel\n */\nexport default function UCSCTrackHubConnection(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'UCSCTrackHubConnection',\n      BaseConnectionModelFactory(pluginManager),\n      types.model({\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        type: types.literal('UCSCTrackHubConnection'),\n      }),\n    )\n    .actions(self => ({\n      /**\n       * #action\n       */\n      async connect() {\n        const { doConnect } = await import('./doConnect')\n\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        doConnect(self)\n      },\n    }))\n}\n","import { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport stateModelFactory from './model'\nimport configSchema from './configSchema'\n\nexport default function UCSCTrackHubConnectionF(pluginManager: PluginManager) {\n  pluginManager.addConnectionType(\n    () =>\n      new ConnectionType({\n        name: 'UCSCTrackHubConnection',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        displayName: 'UCSC Track Hub',\n        description: 'A track or assembly hub in the Track Hub format',\n        url: '//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro',\n      }),\n  )\n}\n","import { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { Dotplot1DViewModel } from '../model'\n\nexport function locstr(\n  px: number,\n  view: Dotplot1DViewModel,\n  includeAsm = true,\n) {\n  const { assemblyName, refName, start, offset, oob } = view.pxToBp(px)\n  const coord = Math.floor(start + offset)\n  return oob\n    ? 'out of bounds'\n    : `${\n        includeAsm ? '{' + assemblyName + '}' : ''\n      }${refName}:${coord.toLocaleString('en-US')}`\n}\n\nexport function getBlockLabelKeysToHide(\n  blocks: BaseBlock[],\n  length: number,\n  viewOffsetPx: number,\n) {\n  const blockLabelKeysToHide = new Set<string>()\n  const sortedBlocks = [...blocks].sort((a, b) => {\n    const alen = a.end - a.start\n    const blen = b.end - b.start\n    return blen - alen\n  })\n  const positions = Array.from({ length: Math.round(length) })\n  for (const { key, offsetPx } of sortedBlocks) {\n    const y = Math.round(length - offsetPx + viewOffsetPx)\n    const labelBounds = [Math.max(y - 12, 0), y]\n    if (y === 0 || positions.slice(...labelBounds).some(Boolean)) {\n      blockLabelKeysToHide.add(key)\n    } else {\n      positions.fill(true, ...labelBounds)\n    }\n  }\n  return blockLabelKeysToHide\n}\n/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = Number.parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  regions: BaseBlock[],\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const ticks = []\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  for (const { start, end, refName } of regions) {\n    let index = 0\n\n    const minBase = start\n    const maxBase = end\n\n    for (\n      let base = Math.floor(minBase / iterPitch) * iterPitch;\n      base < Math.ceil(maxBase / iterPitch) * iterPitch + 1;\n      base += iterPitch\n    ) {\n      if (emitMinor && base % gridPitch.majorPitch) {\n        ticks.push({ type: 'minor', base: base - 1, index, refName })\n        index += 1\n      } else if (emitMajor && Math.abs(base - start) > gridPitch.minorPitch) {\n        ticks.push({ type: 'major', base: base - 1, index, refName })\n        index += 1\n      }\n    }\n  }\n  return ticks\n}\n","import React from 'react'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles()(theme => ({\n  contentBlock: {\n    position: 'relative',\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n  },\n  elidedBlock: {\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    backgroundColor: '#999',\n    backgroundImage:\n      'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n  },\n  interRegionPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.text.disabled,\n  },\n  boundaryPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.action.disabledBackground,\n  },\n}))\n\nconst ContentBlock = observer(function ({\n  block,\n  children,\n}: {\n  block: BaseBlock\n  children: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  const { widthPx } = block\n  return (\n    <div style={{ width: widthPx }} className={classes.contentBlock}>\n      {children}\n    </div>\n  )\n})\n\nfunction ElidedBlock({ width }: { width: number }) {\n  const { classes } = useStyles()\n  return <div className={classes.elidedBlock} style={{ width }} />\n}\n\nfunction InterRegionPaddingBlock({\n  boundary,\n  width,\n  style = {},\n}: {\n  boundary: boolean\n  width: number\n  style?: React.CSSProperties\n}) {\n  const { classes } = useStyles()\n  return (\n    <div\n      style={{\n        ...style,\n        width,\n      }}\n      className={\n        boundary\n          ? classes.boundaryPaddingBlock\n          : classes.interRegionPaddingBlock\n      }\n    />\n  )\n}\n\nexport { ContentBlock, ElidedBlock, InterRegionPaddingBlock }\n","import React from 'react'\nimport { Tooltip, Alert, AlertColor } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()({\n  ellipses: {\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n  },\n})\n\nexport default function BlockMsg({\n  message,\n  severity,\n  action,\n}: {\n  message: string\n  severity?: AlertColor\n  action?: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  return (\n    <Alert\n      severity={severity}\n      action={action}\n      classes={{ message: classes.ellipses }}\n    >\n      <Tooltip title={message}>\n        <div>{message}</div>\n      </Tooltip>\n    </Alert>\n  )\n}\n","import React, { lazy } from 'react'\nimport { Tooltip, IconButton } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\n\n// icons\nimport RefreshIcon from '@mui/icons-material/Refresh'\nimport ReportIcon from '@mui/icons-material/Report'\n\n// locals\nimport BlockMsg from './BlockMsg'\n\nconst ErrorMessageStackTraceDialog = lazy(\n  () => import('@jbrowse/core/ui/ErrorMessageStackTraceDialog'),\n)\n\nconst useStyles = makeStyles()(theme => {\n  const bg = theme.palette.action.disabledBackground\n  return {\n    loading: {\n      paddingLeft: '0.6em',\n      backgroundColor: theme.palette.background.default,\n      backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 5px, ${bg} 5px, ${bg} 10px)`,\n      textAlign: 'center',\n    },\n  }\n})\n\nconst LoadingMessage = observer(({ model }: { model: { status?: string } }) => {\n  const { classes } = useStyles()\n  const { status: blockStatus } = model\n  const { message: displayStatus } = getParent<{ message?: string }>(model, 2)\n  const status = displayStatus || blockStatus\n  return (\n    <div className={classes.loading}>\n      <LoadingEllipses message={status} />\n    </div>\n  )\n})\n\nconst ServerSideRenderedBlockContent = observer(function ({\n  model,\n}: {\n  model: {\n    error?: unknown\n    reload: () => void\n    message: React.ReactNode\n    filled?: boolean\n    status?: string\n    reactElement?: React.ReactElement\n  }\n}) {\n  if (model.error) {\n    return (\n      <BlockMsg\n        message={`${model.error}`}\n        severity=\"error\"\n        action={\n          <>\n            <Tooltip title=\"Reload track\">\n              <IconButton\n                data-testid=\"reload_button\"\n                onClick={() => model.reload()}\n              >\n                <RefreshIcon />\n              </IconButton>\n            </Tooltip>\n            <Tooltip title=\"Show stack trace\">\n              <IconButton\n                onClick={() => {\n                  getSession(model).queueDialog(onClose => [\n                    ErrorMessageStackTraceDialog,\n                    { onClose, error: model.error as Error },\n                  ])\n                }}\n              >\n                <ReportIcon />\n              </IconButton>\n            </Tooltip>\n          </>\n        }\n      />\n    )\n  } else if (model.message) {\n    // the message can be a fully rendered react component, e.g. the region too large message\n    return React.isValidElement(model.message) ? (\n      model.message\n    ) : (\n      <BlockMsg message={`${model.message}`} severity=\"info\" />\n    )\n  } else if (!model.filled) {\n    return <LoadingMessage model={model} />\n  } else {\n    return model.reactElement\n  }\n})\n\nexport default ServerSideRenderedBlockContent\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport {\n  types,\n  getParent,\n  isAlive,\n  cast,\n  Instance,\n  getSnapshot,\n} from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  assembleLocString,\n  getSession,\n  getContainingDisplay,\n  getContainingView,\n  getViewParams,\n  makeAbortableReaction,\n  Feature,\n} from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport {\n  AbstractDisplayModel,\n  isRetryException,\n} from '@jbrowse/core/util/types'\n\nimport {\n  getTrackAssemblyNames,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\n\n// locals\nimport ServerSideRenderedBlockContent from '../components/ServerSideRenderedBlockContent'\n\n// the MST state of a single server-side-rendered block in a display\nconst blockState = types\n  .model('BlockState', {\n    key: types.string,\n    region: Region,\n    reloadFlag: 0,\n    isLeftEndOfDisplayedRegion: false,\n    isRightEndOfDisplayedRegion: false,\n  })\n  // NOTE: all this volatile stuff has to be filled in at once, so that it stays consistent\n  .volatile(() => ({\n    renderInProgress: undefined as AbortController | undefined,\n    filled: false,\n    reactElement: undefined as React.ReactElement | undefined,\n    features: undefined as Map<string, Feature> | undefined,\n    layout: undefined as any,\n    status: '',\n    error: undefined as unknown,\n    message: undefined as string | undefined,\n    maxHeightReached: false,\n    ReactComponent: ServerSideRenderedBlockContent,\n    renderProps: undefined as any,\n  }))\n  .actions(self => {\n    let renderInProgress: undefined | AbortController\n    return {\n      doReload() {\n        self.reloadFlag = self.reloadFlag + 1\n      },\n      afterAttach() {\n        const display = getContainingDisplay(self)\n        setTimeout(() => {\n          if (isAlive(self)) {\n            makeAbortableReaction(\n              self as any,\n              renderBlockData,\n              renderBlockEffect, // reaction doesn't expect async here\n              {\n                name: `${display.id}/${assembleLocString(\n                  self.region,\n                )} rendering`,\n                delay: display.renderDelay,\n                fireImmediately: true,\n              },\n              this.setLoading,\n              this.setRendered,\n              this.setError,\n            )\n          }\n        }, display.renderDelay)\n      },\n      setStatus(message: string) {\n        self.status = message\n      },\n      setLoading(abortController: AbortController) {\n        if (\n          renderInProgress !== undefined &&\n          !renderInProgress.signal.aborted\n        ) {\n          renderInProgress.abort()\n        }\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = abortController\n      },\n      setMessage(messageText: string) {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        self.filled = false\n        self.message = messageText\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      setRendered(\n        props:\n          | {\n              reactElement: React.ReactElement\n              features: Map<string, Feature>\n              layout: any\n              maxHeightReached: boolean\n              renderProps: any\n            }\n          | undefined,\n      ) {\n        if (!props) {\n          return\n        }\n        const {\n          reactElement,\n          features,\n          layout,\n          maxHeightReached,\n          renderProps,\n        } = props\n        self.filled = true\n        self.message = undefined\n        self.reactElement = reactElement\n        self.features = features\n        self.layout = layout\n        self.error = undefined\n        self.maxHeightReached = maxHeightReached\n        self.renderProps = renderProps\n        renderInProgress = undefined\n      },\n      setError(error: unknown) {\n        console.error(error)\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.maxHeightReached = false\n        self.error = error\n        self.renderProps = undefined\n        renderInProgress = undefined\n        if (isRetryException(error as Error)) {\n          this.reload()\n        }\n      },\n      reload() {\n        self.renderInProgress = undefined\n        self.filled = false\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.message = undefined\n        self.maxHeightReached = false\n        self.ReactComponent = ServerSideRenderedBlockContent\n        self.renderProps = undefined\n        getParent<any>(self, 2).reload()\n      },\n      beforeDestroy() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            if (renderInProgress && !renderInProgress.signal.aborted) {\n              renderInProgress.abort()\n            }\n            const display = getContainingDisplay(self)\n            const { rpcManager } = getSession(self)\n            const { rendererType } = display\n            const { renderArgs } = renderBlockData(cast(self))\n            // renderArgs can be undefined if an error occurred in this block\n            if (renderArgs) {\n              await rendererType.freeResourcesInClient(\n                rpcManager,\n                JSON.parse(JSON.stringify(renderArgs)),\n              )\n            }\n          } catch (e) {\n            console.error('Error while destroying block', e)\n          }\n        })()\n      },\n    }\n  })\n\nexport default blockState\nexport type BlockStateModel = typeof blockState\nexport type BlockModel = Instance<BlockStateModel>\n\n// calls the render worker to render the block content not using a flow for\n// this, because the flow doesn't work with autorun\nexport function renderBlockData(\n  self: BlockModel,\n  optDisplay?: AbstractDisplayModel,\n) {\n  try {\n    const display = optDisplay || (getContainingDisplay(self) as any)\n    const { assemblyManager, rpcManager } = getSession(display)\n    const { adapterConfig, rendererType, error, parentTrack } = display\n    const assemblyNames = getTrackAssemblyNames(parentTrack)\n    const regionAsm = self.region.assemblyName\n    if (\n      !assemblyNames.includes(regionAsm) &&\n      !assemblyNames.some(name => assemblyManager.get(name)?.hasName(regionAsm))\n    ) {\n      throw new Error(\n        `region assembly (${regionAsm}) does not match track assemblies (${assemblyNames})`,\n      )\n    }\n\n    const renderProps = display.renderProps()\n    const { config } = renderProps\n\n    // This line is to trigger the mobx reaction when the config changes\n    // It won't trigger the reaction if it doesn't think we're accessing it\n    readConfObject(config)\n\n    const sessionId = getRpcSessionId(display)\n    const layoutId = getContainingView(display).id\n    const cannotBeRenderedReason = display.regionCannotBeRendered(self.region)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps,\n      cannotBeRenderedReason,\n      displayError: error,\n      renderArgs: {\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            self.setStatus(message)\n          }\n        },\n        assemblyName: self.region.assemblyName,\n        regions: [getSnapshot(self.region)],\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId,\n        layoutId,\n        blockKey: self.key,\n        reloadFlag: self.reloadFlag,\n        timeout: 1000000, // 10000,\n      },\n    }\n  } catch (e) {\n    return { displayError: e }\n  }\n}\n\nasync function renderBlockEffect(\n  props: ReturnType<typeof renderBlockData> | undefined,\n  signal: AbortSignal,\n  self: BlockModel,\n) {\n  if (!props) {\n    return\n  }\n  const {\n    rendererType,\n    renderProps,\n    rpcManager,\n    renderArgs,\n    cannotBeRenderedReason,\n    displayError,\n  } = props\n  if (!isAlive(self)) {\n    return undefined\n  }\n\n  if (displayError) {\n    self.setError(displayError)\n    return undefined\n  }\n  if (cannotBeRenderedReason) {\n    self.setMessage(cannotBeRenderedReason)\n    return undefined\n  }\n\n  if (renderProps.notReady) {\n    return undefined\n  }\n\n  const { reactElement, features, layout, maxHeightReached } =\n    await rendererType.renderInClient(rpcManager, {\n      ...renderArgs,\n      ...renderProps,\n      viewParams: getViewParams(self),\n      signal,\n    })\n  return {\n    reactElement,\n    features,\n    layout,\n    maxHeightReached,\n    renderProps,\n  }\n}\n","import { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { IAnyStateTreeNode, isAlive } from 'mobx-state-tree'\nimport { LinearGenomeViewModel } from '../../LinearGenomeView'\n\nexport interface RenderProps {\n  rendererType: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  renderArgs: Record<string, any> // eslint-disable-line @typescript-eslint/no-explicit-any\n  renderProps: Record<string, any> // eslint-disable-line @typescript-eslint/no-explicit-any\n  displayError: unknown\n  rpcManager: { call: Function }\n  cannotBeRenderedReason: string\n}\n\nexport interface ErrorProps {\n  displayError: string\n}\n\nexport function getDisplayStr(totalBytes: number) {\n  let displayBp\n  if (Math.floor(totalBytes / 1000000) > 0) {\n    displayBp = `${Number.parseFloat((totalBytes / 1000000).toPrecision(3))} Mb`\n  } else if (Math.floor(totalBytes / 1000) > 0) {\n    displayBp = `${Number.parseFloat((totalBytes / 1000).toPrecision(3))} Kb`\n  } else {\n    displayBp = `${Math.floor(totalBytes)} bytes`\n  }\n  return displayBp\n}\n\n// stabilize clipid under test for snapshot\nexport function getId(id: string, index: number) {\n  const notJest = typeof jest === 'undefined'\n  return ['clip', notJest ? id : 'jest', index, notJest ? Math.random() : '']\n    .filter(f => !!f)\n    .join('-')\n}\n\nexport async function getFeatureDensityStatsPre(\n  self: IAnyStateTreeNode & {\n    adapterConfig?: AnyConfigurationModel\n    setMessage: (arg: string) => void\n  },\n) {\n  const view = getContainingView(self) as LinearGenomeViewModel\n  const regions = view.staticBlocks.contentBlocks\n\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  if (!adapterConfig) {\n    // A track extending the base track might not have an adapter config\n    // e.g. Apollo tracks don't use adapters\n    return {}\n  }\n  const sessionId = getRpcSessionId(self)\n\n  return rpcManager.call(sessionId, 'CoreGetFeatureDensityStats', {\n    sessionId,\n    regions,\n    adapterConfig,\n    statusCallback: (message: string) => {\n      if (isAlive(self)) {\n        self.setMessage(message)\n      }\n    },\n  }) as Promise<FeatureDensityStats>\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\n// core\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\n\n// locals\nimport { HEADER_OVERVIEW_HEIGHT } from '..'\nimport { getCytobands } from './util'\nimport { getFillProps } from '@jbrowse/core/util'\n\n// rounded rect from https://stackoverflow.com/a/45889603/2129219\n// prettier-ignore\nfunction rightRoundedRect(x: number, y: number, width: number, height: number, radius: number) {\n  return \"M\" + x + \",\" + y\n       + \"h\" + (width - radius)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + radius + \",\" + radius\n       + \"v\" + (height - 2 * radius)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + -radius + \",\" + radius\n       + \"h\" + (radius - width)\n       + \"z\";\n}\n\n// prettier-ignore\nfunction leftRoundedRect(x: number, y: number, width: number, height: number, radius: number ) {\n  return \"M\" + (x + radius) + \",\" + y\n       + \"h\" + (width - radius)\n       + \"v\" + height\n       + \"h\" + (radius - width)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + (-radius) + \",\" + (-radius)\n       + \"v\" + (2 * radius - height)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + radius + \",\" + (-radius)\n       + \"z\";\n}\n\nfunction leftTriangle(x: number, y: number, width: number, height: number) {\n  return [\n    [x, 0],\n    [x + width, height / 2],\n    [x, height],\n  ].toString()\n}\n\nfunction rightTriangle(x: number, y: number, width: number, height: number) {\n  return [\n    [x, height / 2],\n    [x + width, 0],\n    [x + width, height],\n  ].toString()\n}\n\nconst colorMap: Record<string, string | undefined> = {\n  gneg: 'rgb(227,227,227)',\n  gpos25: 'rgb(142,142,142)',\n  gpos50: 'rgb(85,85,85)',\n  gpos100: 'rgb(0,0,0)',\n  gpos75: 'rgb(57,57,57)',\n  gvar: 'rgb(0,0,0)',\n  stalk: 'rgb(127,127,127)',\n  acen: '#800',\n}\n\nconst Cytobands = observer(function ({\n  overview,\n  block,\n  assembly,\n}: {\n  overview: Base1DViewModel\n  assembly?: Assembly\n  block: ContentBlock\n}) {\n  const { offsetPx, reversed } = block\n  const cytobands = getCytobands(assembly, block.refName)\n  const lcap = reversed ? cytobands.length - 1 : 0\n  const rcap = reversed ? 0 : cytobands.length - 1\n\n  const h = HEADER_OVERVIEW_HEIGHT\n  let centromereSeen = false\n  return (\n    <g transform={`translate(-${offsetPx})`}>\n      {cytobands.map((args, index) => {\n        const k = JSON.stringify(args)\n        const { refName, type, start, end } = args\n        const s = overview.bpToPx({ refName, coord: start }) || 0\n        const e = overview.bpToPx({ refName, coord: end }) || 0\n        const l = Math.min(s, e)\n        const w = Math.abs(e - s)\n        const c = colorMap[type] || 'black'\n        if (type === 'acen' && !centromereSeen) {\n          centromereSeen = true // the next acen entry is drawn with different right triangle\n          return (\n            <polygon\n              key={k}\n              points={\n                reversed\n                  ? rightTriangle(s - w, 0, w, h)\n                  : leftTriangle(s, 0, w, h)\n              }\n              {...getFillProps(c)}\n            />\n          )\n        } else if (type === 'acen' && centromereSeen) {\n          return (\n            <polygon\n              key={k}\n              points={\n                reversed\n                  ? leftTriangle(s - w, 0, w, h)\n                  : rightTriangle(s, 0, w, h)\n              }\n              {...getFillProps(c)}\n            />\n          )\n        } else if (lcap === index) {\n          return (\n            <path\n              key={k}\n              d={leftRoundedRect(l, 0, w, h, 8)}\n              {...getFillProps(c)}\n            />\n          )\n        } else if (rcap === index) {\n          return (\n            <path\n              key={k}\n              d={rightRoundedRect(l, 0, w, h, 8)}\n              {...getFillProps(c)}\n            />\n          )\n        } else {\n          return (\n            <rect\n              key={k}\n              x={l}\n              y={0}\n              width={w}\n              height={h}\n              {...getFillProps(c)}\n            />\n          )\n        }\n      })}\n    </g>\n  )\n})\n\nexport default Cytobands\n","import React from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\n// icons\nimport DragIcon from '@mui/icons-material/DragIndicator'\n\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()({\n  dragHandle: {\n    cursor: 'grab',\n  },\n  dragHandleIcon: {\n    display: 'inline-block',\n    verticalAlign: 'middle',\n    pointerEvents: 'none',\n  },\n})\n\nfunction TrackLabelDragHandle({\n  trackId,\n  view,\n  track,\n}: {\n  trackId: string\n  track: BaseTrackModel\n  view: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  return (\n    <span\n      draggable\n      className={classes.dragHandle}\n      onDragStart={event => {\n        const target = event.currentTarget\n        if (target.parentNode) {\n          const parent = target.parentNode as HTMLElement\n          event.dataTransfer.setDragImage(parent, 20, 20)\n          view.setDraggingTrackId(track.id)\n        }\n      }}\n      onDragEnd={() => view.setDraggingTrackId(undefined)}\n      data-testid={`dragHandle-${view.id}-${trackId}`}\n    >\n      <DragIcon className={classes.dragHandleIcon} fontSize=\"small\" />\n    </span>\n  )\n}\n\nexport default TrackLabelDragHandle\n","import React from 'react'\nimport { IconButton, Paper, Typography, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { SanitizedHTML } from '@jbrowse/core/ui'\nimport CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\n\n// icons\nimport MoreVertIcon from '@mui/icons-material/MoreVert'\nimport CloseIcon from '@mui/icons-material/Close'\nimport MinimizeIcon from '@mui/icons-material/Minimize'\nimport AddIcon from '@mui/icons-material/Add'\nimport KeyboardDoubleArrowDownIcon from '@mui/icons-material/KeyboardDoubleArrowDown'\nimport KeyboardDoubleArrowUpIcon from '@mui/icons-material/KeyboardDoubleArrowUp'\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown'\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp'\n\nimport { LinearGenomeViewModel } from '..'\nimport TrackLabelDragHandle from './TrackLabelDragHandle'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    background: alpha(theme.palette.background.paper, 0.8),\n    '&:hover': {\n      background: theme.palette.background.paper,\n    },\n  },\n  trackName: {\n    margin: '0 auto',\n    width: '90%',\n    fontSize: '0.8rem',\n    pointerEvents: 'none',\n  },\n  iconButton: {\n    padding: theme.spacing(1),\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\ninterface Props {\n  track: BaseTrackModel\n  className?: string\n}\n\nconst TrackLabel = observer(\n  React.forwardRef<HTMLDivElement, Props>(function TrackLabel2(\n    { track, className },\n    ref,\n  ) {\n    const { classes, cx } = useStyles()\n    const view = getContainingView(track) as LGV\n    const session = getSession(track)\n    const trackConf = track.configuration\n    const minimized = track.minimized\n    const trackId = getConf(track, 'trackId')\n    const trackName = getTrackName(trackConf, session)\n    const items = [\n      {\n        label: 'Track order',\n        type: 'subMenu',\n        subMenu: [\n          {\n            label: minimized ? 'Restore track' : 'Minimize track',\n            icon: minimized ? AddIcon : MinimizeIcon,\n            onClick: () => track.setMinimized(!minimized),\n          },\n          {\n            label: 'Move track to top',\n            icon: KeyboardDoubleArrowUpIcon,\n            onClick: () => view.moveTrackToTop(track.id),\n          },\n\n          {\n            label: 'Move track up',\n            icon: KeyboardArrowUpIcon,\n            onClick: () => view.moveTrackUp(track.id),\n          },\n          {\n            label: 'Move track down',\n            icon: KeyboardArrowDownIcon,\n            onClick: () => view.moveTrackDown(track.id),\n          },\n          {\n            label: 'Move track to bottom',\n            icon: KeyboardDoubleArrowDownIcon,\n            onClick: () => view.moveTrackToBottom(track.id),\n          },\n        ],\n      },\n      ...(session.getTrackActionMenuItems?.(trackConf) || []),\n      ...track.trackMenuItems(),\n    ].sort((a, b) => (b?.priority || 0) - (a?.priority || 0))\n\n    return (\n      <Paper ref={ref} className={cx(className, classes.root)}>\n        <TrackLabelDragHandle track={track} trackId={trackId} view={view} />\n        <IconButton\n          onClick={() => view.hideTrack(trackId)}\n          className={classes.iconButton}\n          title=\"close this track\"\n        >\n          <CloseIcon fontSize=\"small\" />\n        </IconButton>\n\n        <Typography\n          variant=\"body1\"\n          component=\"span\"\n          className={classes.trackName}\n        >\n          <SanitizedHTML\n            html={[trackName, minimized ? '(minimized)' : '']\n              .filter(f => !!f)\n              .join(' ')}\n          />\n        </Typography>\n\n        <CascadingMenuButton menuItems={items} data-testid=\"track_menu_icon\">\n          <MoreVertIcon fontSize=\"small\" />\n        </CascadingMenuButton>\n      </Paper>\n    )\n  }),\n)\n\nexport default TrackLabel\n","import React from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\n// jbrowse core\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport TrackLabel from './TrackLabel'\n\nconst useStyles = makeStyles()({\n  trackLabel: {\n    zIndex: 3,\n  },\n\n  trackLabelOffset: {\n    position: 'relative',\n    display: 'inline-block',\n  },\n  trackLabelOverlap: {\n    position: 'absolute',\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackLabelContainer = observer(function ({\n  track,\n  view,\n}: {\n  track: BaseTrackModel\n  view: LGV\n}) {\n  const { classes, cx } = useStyles()\n  const display = track.displays[0]\n  const { trackLabel, trackLabelOverlap, trackLabelOffset } = classes\n  const labelStyle =\n    view.trackLabelsSetting !== 'overlapping' || display.prefersOffset\n      ? trackLabelOffset\n      : trackLabelOverlap\n\n  return view.trackLabelsSetting !== 'hidden' ? (\n    <TrackLabel track={track} className={cx(trackLabel, labelStyle)} />\n  ) : null\n})\n\nexport default TrackLabelContainer\n","import React, { Suspense, useEffect, useRef } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\n// jbrowse core\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()({\n  // aligns with block boundaries. check for example the breakpoint split view\n  // demo to see if features align if wanting to change things\n  renderingComponentContainer: {\n    position: 'absolute',\n    // -1 offset because of the 1px border of the Paper\n    left: -1,\n    height: '100%',\n    width: '100%',\n  },\n\n  trackRenderingContainer: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    position: 'relative',\n    background: 'none',\n    zIndex: 2,\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackRenderingContainer = observer(function ({\n  model,\n  track,\n  onDragEnter,\n}: {\n  model: LGV\n  track: BaseTrackModel\n  onDragEnter: () => void\n}) {\n  const { classes } = useStyles()\n  const display = track.displays[0]\n  const { height, RenderingComponent, DisplayBlurb } = display\n  const trackId = getConf(track, 'trackId')\n  const ref = useRef<HTMLDivElement>(null)\n  const minimized = track.minimized\n\n  useEffect(() => {\n    if (ref.current) {\n      model.trackRefs[trackId] = ref.current\n    }\n    return () => {\n      delete model.trackRefs[trackId]\n    }\n  }, [model.trackRefs, trackId])\n\n  return (\n    <div\n      className={classes.trackRenderingContainer}\n      style={{ height: minimized ? 20 : height }}\n      onScroll={evt => display.setScrollTop(evt.currentTarget.scrollTop)}\n      onDragEnter={onDragEnter}\n      data-testid={`trackRenderingContainer-${model.id}-${trackId}`}\n    >\n      {!minimized ? (\n        <>\n          <div\n            ref={ref}\n            className={classes.renderingComponentContainer}\n            style={{ transform: `scaleX(${model.scaleFactor})` }}\n          >\n            <Suspense fallback={<LoadingEllipses />}>\n              <RenderingComponent\n                model={display}\n                onHorizontalScroll={model.horizontalScroll}\n              />\n            </Suspense>\n          </div>\n\n          {DisplayBlurb ? (\n            <div\n              style={{\n                position: 'absolute',\n                left: 0,\n                top: display.height - 20,\n              }}\n            >\n              <DisplayBlurb model={display} />\n            </div>\n          ) : null}\n        </>\n      ) : null}\n    </div>\n  )\n})\n\nexport default TrackRenderingContainer\n","import React, { useRef } from 'react'\nimport { Paper } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport { ErrorBoundary } from 'react-error-boundary'\n\n// jbrowse core\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ResizeHandle, ErrorMessage } from '@jbrowse/core/ui'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport TrackLabelContainer from './TrackLabelContainer'\nimport TrackRenderingContainer from './TrackRenderingContainer'\n\nconst useStyles = makeStyles()({\n  root: {\n    marginTop: 2,\n  },\n  resizeHandle: {\n    height: 3,\n    boxSizing: 'border-box',\n    position: 'relative',\n    zIndex: 2,\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackContainer = observer(function ({\n  model,\n  track,\n}: {\n  model: LGV\n  track: BaseTrackModel\n}) {\n  const { classes } = useStyles()\n  const display = track.displays[0]\n  const { draggingTrackId } = model\n  const ref = useRef<HTMLDivElement>(null)\n\n  return (\n    <Paper\n      ref={ref}\n      className={classes.root}\n      variant=\"outlined\"\n      onClick={event => {\n        if (event.detail === 2 && !track.displays[0].featureIdUnderMouse) {\n          const left = ref.current?.getBoundingClientRect().left || 0\n          model.zoomTo(model.bpPerPx / 2, event.clientX - left, true)\n        }\n      }}\n    >\n      <TrackLabelContainer track={track} view={model} />\n      <ErrorBoundary FallbackComponent={e => <ErrorMessage error={e.error} />}>\n        <TrackRenderingContainer\n          model={model}\n          track={track}\n          onDragEnter={() => {\n            if (\n              isAlive(display) &&\n              draggingTrackId !== undefined &&\n              draggingTrackId !== display.id\n            ) {\n              model.moveTrack(draggingTrackId, track.id)\n            }\n          }}\n        />\n      </ErrorBoundary>\n      <ResizeHandle\n        onDrag={display.resizeHeight}\n        className={classes.resizeHandle}\n      />\n    </Paper>\n  )\n})\n\nexport default TrackContainer\n","import React, { useRef, useEffect, useState } from 'react'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport { getRelativeX } from './util'\n\ntype LGV = LinearGenomeViewModel\ntype Timer = ReturnType<typeof setTimeout>\n\nexport function useSideScroll(model: LGV) {\n  const [mouseDragging, setMouseDragging] = useState(false)\n  // refs are to store these variables to avoid repeated rerenders associated\n  // with useState/setState\n  const scheduled = useRef(false)\n\n  const prevX = useRef<number>(0)\n\n  useEffect(() => {\n    let cleanup = () => {}\n\n    function globalMouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const currX = event.clientX\n      const distance = currX - prevX.current\n      if (distance) {\n        // use rAF to make it so multiple event handlers aren't fired per-frame\n        // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n        if (!scheduled.current) {\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(-distance)\n            scheduled.current = false\n            prevX.current = event.clientX\n          })\n        }\n      }\n    }\n\n    function globalMouseUp() {\n      prevX.current = 0\n      if (mouseDragging) {\n        setMouseDragging(false)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      cleanup = () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n      }\n    }\n    return cleanup\n  }, [model, mouseDragging, prevX])\n\n  function mouseDown(event: React.MouseEvent) {\n    if (event.shiftKey) {\n      return\n    }\n    // check if clicking a draggable element or a resize handle\n    const target = event.target as HTMLElement\n    if (target.draggable || target.dataset.resizer) {\n      return\n    }\n\n    // otherwise do click and drag scroll\n    if (event.button === 0) {\n      prevX.current = event.clientX\n      setMouseDragging(true)\n    }\n  }\n\n  // this local mouseup is used in addition to the global because sometimes\n  // the global add/remove are not called in time, resulting in issue #533\n  function mouseUp(event: React.MouseEvent) {\n    event.preventDefault()\n    setMouseDragging(false)\n  }\n  return { mouseDown, mouseUp }\n}\n\ninterface AnchorPosition {\n  offsetX: number\n  clientX: number\n  clientY: number\n}\n\nexport function useRangeSelect(\n  ref: React.RefObject<HTMLDivElement>,\n  model: LGV,\n  shiftOnly?: boolean,\n) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n\n  // clientX and clientY used for anchorPosition for menu\n  // offsetX used for calculations about width of selection\n  const [anchorPosition, setAnchorPosition] = useState<AnchorPosition>()\n  const [guideX, setGuideX] = useState<number>()\n  const mouseDragging = startX !== undefined && anchorPosition === undefined\n\n  useEffect(() => {\n    function computeOffsets(offsetX: number) {\n      if (startX === undefined) {\n        return\n      }\n      const leftPx = Math.min(startX, offsetX)\n      const rightPx = Math.max(startX, offsetX)\n      return {\n        leftOffset: model.pxToBp(leftPx),\n        rightOffset: model.pxToBp(rightPx),\n      }\n    }\n\n    function globalMouseMove(event: MouseEvent) {\n      if (ref.current && mouseDragging) {\n        const relativeX = getRelativeX(event, ref.current)\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp(event: MouseEvent) {\n      if (startX !== undefined && ref.current) {\n        const { clientX, clientY } = event\n        const offsetX = getRelativeX(event, ref.current)\n        // as stated above, store both clientX/Y and offsetX for different\n        // purposes\n        setAnchorPosition({\n          offsetX,\n          clientX,\n          clientY,\n        })\n        const args = computeOffsets(offsetX)\n        if (args) {\n          model.setOffsets(args.leftOffset, args.rightOffset)\n        }\n        setGuideX(undefined)\n      }\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove)\n      window.addEventListener('mouseup', globalMouseUp)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove)\n        window.removeEventListener('mouseup', globalMouseUp)\n      }\n    }\n    return () => {}\n  }, [startX, mouseDragging, anchorPosition, model, ref])\n\n  useEffect(() => {\n    if (\n      !mouseDragging &&\n      currentX !== undefined &&\n      startX !== undefined &&\n      Math.abs(currentX - startX) <= 3\n    ) {\n      handleClose()\n    }\n  }, [mouseDragging, currentX, startX])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    if (shiftOnly && !event.shiftKey) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n    const relativeX = getRelativeX(event, ref.current)\n    setStartX(relativeX)\n    setCurrentX(relativeX)\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    if (shiftOnly) {\n      if (event.shiftKey) {\n        setGuideX(getRelativeX(event, ref.current))\n      } else {\n        setGuideX(undefined)\n      }\n    } else {\n      setGuideX(getRelativeX(event, ref.current))\n    }\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n    model.setOffsets(undefined, undefined)\n  }\n\n  function handleClose() {\n    setAnchorPosition(undefined)\n    setStartX(undefined)\n    setCurrentX(undefined)\n  }\n\n  function handleMenuItemClick(_: unknown, callback: Function) {\n    callback()\n    handleClose()\n  }\n\n  const open = Boolean(anchorPosition)\n  if (startX === undefined) {\n    return {\n      open,\n      guideX,\n      mouseDown,\n      mouseMove,\n      mouseOut,\n      handleMenuItemClick,\n    }\n  } else {\n    const right = anchorPosition ? anchorPosition.offsetX : currentX || 0\n    const left = right < startX ? right : startX\n    const width = Math.abs(right - startX)\n    const leftBpOffset = model.pxToBp(left)\n    const rightBpOffset = model.pxToBp(left + width)\n    const numOfBpSelected = Math.ceil(width * model.bpPerPx)\n\n    return {\n      open,\n      rubberbandOn: true,\n      mouseDown,\n      mouseMove,\n      mouseOut,\n      handleClose,\n      handleMenuItemClick,\n      leftBpOffset,\n      rightBpOffset,\n      anchorPosition,\n      numOfBpSelected,\n      width,\n      left,\n    }\n  }\n}\n\nexport function useWheelScroll(\n  ref: React.RefObject<HTMLDivElement>,\n  model: {\n    bpPerPx: number\n    zoomTo: (arg: number, arg2?: number) => void\n    setScaleFactor: (arg: number) => void\n    horizontalScroll: (arg: number) => void\n  },\n) {\n  const delta = useRef(0)\n  const timeout = useRef<Timer>()\n  const scheduled = useRef(false)\n  useEffect(() => {\n    const curr = ref.current\n\n    // if ctrl is held down, zoom in with y-scroll\n    // else scroll horizontally with x-scroll\n    function onWheel(event: WheelEvent) {\n      if (event.ctrlKey === true) {\n        event.preventDefault()\n        delta.current += event.deltaY / 500\n        model.setScaleFactor(\n          delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n        )\n        if (timeout.current) {\n          clearTimeout(timeout.current)\n        }\n        timeout.current = setTimeout(() => {\n          model.setScaleFactor(1)\n          model.zoomTo(\n            delta.current > 0\n              ? model.bpPerPx * (1 + delta.current)\n              : model.bpPerPx / (1 - delta.current),\n            event.clientX - (curr?.getBoundingClientRect().left || 0),\n          )\n          delta.current = 0\n        }, 300)\n      } else {\n        // this is needed to stop the event from triggering \"back button\n        // action\" on MacOSX etc.  but is a heuristic to avoid preventing the\n        // inner-track scroll behavior\n        if (Math.abs(event.deltaX) > Math.abs(2 * event.deltaY)) {\n          event.preventDefault()\n        }\n        delta.current += event.deltaX\n        if (!scheduled.current) {\n          // use rAF to make it so multiple event handlers aren't fired per-frame\n          // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(delta.current)\n            delta.current = 0\n            scheduled.current = false\n          })\n        }\n      }\n    }\n    if (curr) {\n      curr.addEventListener('wheel', onWheel)\n      return () => {\n        curr.removeEventListener('wheel', onWheel)\n      }\n    }\n    return () => {}\n  }, [model, ref])\n}\n","import React from 'react'\nimport { Tooltip } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { stringify } from '@jbrowse/core/util'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  guide: {\n    pointerEvents: 'none',\n    height: '100%',\n    width: 1,\n    position: 'absolute',\n    zIndex: 10,\n  },\n})\n\nconst VerticalGuide = observer(function VerticalGuide({\n  model,\n  coordX,\n}: {\n  model: LGV\n  coordX: number\n}) {\n  const { classes } = useStyles()\n  return (\n    <Tooltip open placement=\"top\" title={stringify(model.pxToBp(coordX))} arrow>\n      <div\n        className={classes.guide}\n        style={{\n          left: coordX,\n          background: 'red',\n        }}\n      />\n    </Tooltip>\n  )\n})\n\nexport default VerticalGuide\n","import React, { useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { Menu } from '@jbrowse/core/ui'\n\n// locals\nimport VerticalGuide from './VerticalGuide'\nimport RubberbandSpan from './RubberbandSpan'\nimport { useRangeSelect } from './hooks'\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  rubberbandControl: {\n    cursor: 'crosshair',\n    width: '100%',\n    minHeight: 8,\n  },\n})\n\nconst Rubberband = observer(function ({\n  model,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  ControlComponent?: React.ReactElement\n}) {\n  const ref = useRef<HTMLDivElement>(null)\n  const { classes } = useStyles()\n\n  const {\n    guideX,\n    rubberbandOn,\n    leftBpOffset,\n    rightBpOffset,\n    numOfBpSelected,\n    width,\n    left,\n    anchorPosition,\n    handleMenuItemClick,\n    open,\n    handleClose,\n    mouseMove,\n    mouseDown,\n    mouseOut,\n  } = useRangeSelect(ref, model)\n\n  return (\n    <>\n      {guideX !== undefined ? (\n        <VerticalGuide model={model} coordX={guideX} />\n      ) : rubberbandOn ? (\n        <RubberbandSpan\n          leftBpOffset={leftBpOffset}\n          rightBpOffset={rightBpOffset}\n          numOfBpSelected={numOfBpSelected}\n          width={width}\n          left={left}\n        />\n      ) : null}\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={model.rubberBandMenuItems()}\n        />\n      ) : null}\n      <div\n        data-testid=\"rubberband_controls\"\n        className={classes.rubberbandControl}\n        ref={ref}\n        onMouseDown={mouseDown}\n        onMouseMove={mouseMove}\n        onMouseOut={mouseOut}\n      >\n        {ControlComponent}\n      </div>\n    </>\n  )\n})\n\nexport default Rubberband\n","import { Paper, Typography } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { LinearGenomeViewModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\nimport { getTickDisplayStr } from '@jbrowse/core/util'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  scalebarContainer: {\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  scalebarZoomContainer: {\n    position: 'relative',\n    zIndex: 1,\n  },\n  scalebar: {\n    position: 'absolute',\n    display: 'flex',\n    pointerEvents: 'none',\n  },\n  majorTickLabel: {\n    fontSize: 11,\n    zIndex: 1,\n    background: theme.palette.background.paper,\n    lineHeight: 'normal',\n    pointerEvents: 'none',\n  },\n  tick: {\n    position: 'absolute',\n    width: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  refLabel: {\n    fontSize: 11,\n    position: 'absolute',\n    left: 2,\n    top: -1,\n    fontWeight: 'bold',\n    lineHeight: 'normal',\n    zIndex: 1,\n    pointerEvents: 'none',\n    background: theme.palette.background.paper,\n  },\n}))\n\nconst RenderedRefNameLabels = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n\n  // find the block that needs pinning to the left side for context\n  let lastLeftBlock = 0\n  model.staticBlocks.forEach((block, i) => {\n    if (block.offsetPx - model.offsetPx < 0) {\n      lastLeftBlock = i\n    }\n  })\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        return block.type === 'ContentBlock' &&\n          (block.isLeftEndOfDisplayedRegion || index === lastLeftBlock) ? (\n          <Typography\n            key={`refLabel-${block.key}-${index}`}\n            style={{\n              left:\n                index === lastLeftBlock\n                  ? Math.max(0, -model.offsetPx)\n                  : block.offsetPx - model.offsetPx - 1,\n              paddingLeft: index === lastLeftBlock ? 0 : 1,\n            }}\n            className={classes.refLabel}\n            data-testid={`refLabel-${block.refName}`}\n          >\n            {block.refName}\n          </Typography>\n        ) : null\n      })}\n    </>\n  )\n})\n\nconst RenderedBlockTicks = function ({\n  block,\n  bpPerPx,\n}: {\n  block: ContentBlock\n  bpPerPx: number\n}) {\n  const { classes } = useStyles()\n  const { reversed, start, end } = block\n  const ticks = makeTicks(start, end, bpPerPx, true, false)\n\n  return (\n    <ContentBlockComponent block={block}>\n      {ticks.map(({ type, base }) => {\n        if (type === 'major') {\n          const x = (reversed ? end - base : base - start) / bpPerPx\n          const baseNumber = base + 1\n          return (\n            <div key={base} className={classes.tick} style={{ left: x }}>\n              {baseNumber ? (\n                <Typography className={classes.majorTickLabel}>\n                  {getTickDisplayStr(baseNumber, bpPerPx)}\n                </Typography>\n              ) : null}\n            </div>\n          )\n        }\n        return null\n      })}\n    </ContentBlockComponent>\n  )\n}\n\nconst RenderedScalebarLabels = observer(({ model }: { model: LGV }) => {\n  const { staticBlocks, bpPerPx } = model\n\n  return (\n    <>\n      {staticBlocks.map((block, idx) => {\n        const { key, widthPx } = block\n        const k = `${key}-${idx}`\n        if (block.type === 'ContentBlock') {\n          return <RenderedBlockTicks key={k} block={block} bpPerPx={bpPerPx} />\n        } else if (block.type === 'ElidedBlock') {\n          return <ElidedBlockComponent key={k} width={widthPx} />\n        } else if (block.type === 'InterRegionPaddingBlock') {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={k}\n              width={widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\n\ninterface ScalebarProps {\n  model: LGV\n  style?: React.CSSProperties\n  className?: string\n}\n\nconst Scalebar = observer(\n  React.forwardRef<HTMLDivElement, ScalebarProps>(function Scalebar2(\n    { model, style, className, ...other },\n    ref,\n  ) {\n    const { classes, cx } = useStyles()\n\n    const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n    return (\n      <Paper\n        data-resizer=\"true\" // used to avoid click-and-drag scrolls on trackscontainer\n        className={cx(classes.scalebarContainer, className)}\n        variant=\"outlined\"\n        ref={ref}\n        style={style}\n        {...other}\n      >\n        <div\n          className={classes.scalebarZoomContainer}\n          style={{\n            transform:\n              model.scaleFactor !== 1\n                ? `scaleX(${model.scaleFactor})`\n                : undefined,\n          }}\n        >\n          <div\n            className={classes.scalebar}\n            style={{\n              left: offsetLeft - 1,\n              width: model.staticBlocks.totalWidthPx,\n              ...style,\n            }}\n          >\n            <RenderedScalebarLabels model={model} />\n          </div>\n        </div>\n        <RenderedRefNameLabels model={model} />\n      </Paper>\n    )\n  }),\n)\n\nexport default Scalebar\n","import React from 'react'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { LinearGenomeViewModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\n\nimport { makeTicks } from '../util'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  verticalGuidesZoomContainer: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n  },\n  verticalGuidesContainer: {\n    position: 'absolute',\n    height: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n    display: 'flex',\n  },\n  tick: {\n    position: 'absolute',\n    height: '100%',\n    width: 1,\n  },\n  majorTick: {\n    background: theme.palette.action.disabled,\n  },\n  minorTick: {\n    background: theme.palette.divider,\n  },\n}))\n\nfunction RenderedBlockLines({\n  block,\n  bpPerPx,\n}: {\n  block: ContentBlock\n  bpPerPx: number\n}) {\n  const { classes, cx } = useStyles()\n  const ticks = makeTicks(block.start, block.end, bpPerPx)\n  return (\n    <ContentBlockComponent block={block}>\n      {ticks.map(({ type, base }) => {\n        const x =\n          (block.reversed ? block.end - base : base - block.start) / bpPerPx\n        return (\n          <div\n            key={base}\n            className={cx(\n              classes.tick,\n              type === 'major' || type === 'labeledMajor'\n                ? classes.majorTick\n                : classes.minorTick,\n            )}\n            style={{ left: x }}\n          />\n        )\n      })}\n    </ContentBlockComponent>\n  )\n}\nconst RenderedVerticalGuides = observer(({ model }: { model: LGV }) => {\n  const { staticBlocks, bpPerPx } = model\n  return (\n    <>\n      {staticBlocks.map((block, index) => {\n        const k = `${block.key}-${index}`\n        if (block.type === 'ContentBlock') {\n          return <RenderedBlockLines key={k} block={block} bpPerPx={bpPerPx} />\n        } else if (block.type === 'ElidedBlock') {\n          return <ElidedBlockComponent key={k} width={block.widthPx} />\n        } else if (block.type === 'InterRegionPaddingBlock') {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={k}\n              width={block.widthPx}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\nconst Gridlines = observer(function ({ model }: { model: LGV }) {\n  const { classes } = useStyles()\n  // find the block that needs pinning to the left side for context\n  const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n  return (\n    <div\n      className={classes.verticalGuidesZoomContainer}\n      style={{\n        transform:\n          model.scaleFactor !== 1 ? `scaleX(${model.scaleFactor})` : undefined,\n      }}\n    >\n      <div\n        className={classes.verticalGuidesContainer}\n        style={{\n          left: offsetLeft,\n          width: model.staticBlocks.totalWidthPx,\n        }}\n      >\n        <RenderedVerticalGuides model={model} />\n      </div>\n    </div>\n  )\n})\n\nexport default Gridlines\n","import React, { useRef } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  centerLineContainer: {\n    background: 'transparent',\n    height: '100%',\n    zIndex: 5, // above the track but under menu\n    position: 'absolute',\n    border: `1px ${theme.palette.action.active} dashed`,\n    borderTop: 'none',\n    borderBottom: 'none',\n    pointerEvents: 'none',\n  },\n  centerLineText: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    whiteSpace: 'nowrap',\n    fontWeight: 'bold',\n  },\n}))\n\nconst CenterLine = observer(function ({ model }: { model: LGV }) {\n  const { bpPerPx, centerLineInfo, trackHeights, tracks, width } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const { classes } = useStyles()\n  const startingPosition = width / 2\n\n  return tracks.length ? (\n    <div\n      data-testid=\"centerline_container\"\n      className={classes.centerLineContainer}\n      role=\"presentation\"\n      ref={ref}\n      style={{\n        left: `${startingPosition}px`,\n        width: Math.max(1 / bpPerPx, 1),\n      }}\n    >\n      {centerLineInfo && (\n        <div\n          // text that indicates what bp is center, positioned\n          // at the bottom right of the center line\n          data-testid=\"centerline_text\"\n          className={classes.centerLineText}\n          role=\"presentation\"\n          style={{\n            left: Math.max(1 / bpPerPx, 1) + 5,\n            top: trackHeights,\n          }}\n        >\n          {/* change bp to refName */}\n          {centerLineInfo.refName}:{' '}\n          {Math.max(Math.round(centerLineInfo.offset) + 1, 0)}\n        </div>\n      )}\n    </div>\n  ) : null\n})\n\nexport default CenterLine\n","import React, { useRef, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { colord } from '@jbrowse/core/util/colord'\nimport {\n  ParsedLocString,\n  Region,\n  SessionWithWidgets,\n  getSession,\n} from '@jbrowse/core/util'\nimport { Menu } from '@jbrowse/core/ui'\nimport { IconButton, Tooltip, useTheme } from '@mui/material'\n\n// icons\nimport LinkIcon from '@mui/icons-material/Link'\nimport CloseIcon from '@mui/icons-material/Close'\nimport BookmarkIcon from '@mui/icons-material/Bookmark'\n\n// locals\nimport { LinearGenomeViewModel } from '../model'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  highlight: {\n    height: '100%',\n    position: 'absolute',\n    overflow: 'hidden',\n    background: `${colord(theme.palette.highlight?.main ?? 'goldenrod')\n      .alpha(0.35)\n      .toRgbString()}`,\n  },\n}))\n\nconst Highlight = observer(function Highlight({\n  model,\n  highlight,\n}: {\n  model: LGV\n  highlight: Required<ParsedLocString>\n}) {\n  const { classes } = useStyles()\n  const [open, setOpen] = useState(false)\n  const anchorEl = useRef(null)\n  const color = useTheme().palette.highlight?.main ?? 'goldenrod'\n  const session = getSession(model) as SessionWithWidgets\n  const { assemblyManager } = session\n\n  const dismissHighlight = () => {\n    model.removeHighlight(highlight)\n  }\n\n  function handleClose() {\n    setOpen(false)\n  }\n\n  // coords\n  const mapCoords = (r: Required<ParsedLocString>) => {\n    const s = model.bpToPx({\n      refName: r.refName,\n      coord: r.start,\n    })\n    const e = model.bpToPx({\n      refName: r.refName,\n      coord: r.end,\n    })\n    return s && e\n      ? {\n          width: Math.max(Math.abs(e.offsetPx - s.offsetPx), 3),\n          left: Math.min(s.offsetPx, e.offsetPx) - model.offsetPx,\n        }\n      : undefined\n  }\n\n  const asm = assemblyManager.get(highlight?.assemblyName)\n\n  const h = mapCoords({\n    ...highlight,\n    refName: asm?.getCanonicalRefName(highlight.refName) ?? highlight.refName,\n  })\n\n  return h ? (\n    <div\n      className={classes.highlight}\n      style={{\n        left: h.left,\n        width: h.width,\n      }}\n    >\n      <Tooltip title={'Highlighted from URL parameter'} arrow>\n        <IconButton\n          ref={anchorEl}\n          onClick={() => setOpen(true)}\n          style={{ zIndex: 3 }}\n        >\n          <LinkIcon\n            fontSize=\"small\"\n            sx={{\n              color: `${colord(color).darken(0.2).toRgbString()}`,\n            }}\n          />\n        </IconButton>\n      </Tooltip>\n      <Menu\n        anchorEl={anchorEl.current}\n        onMenuItemClick={(_event, callback) => {\n          callback(session)\n          handleClose()\n        }}\n        open={open}\n        onClose={handleClose}\n        menuItems={[\n          {\n            label: 'Dismiss highlight',\n            icon: CloseIcon,\n            onClick: () => dismissHighlight(),\n          },\n          {\n            label: 'Bookmark highlighted region',\n            icon: BookmarkIcon,\n            onClick: () => {\n              let bookmarkWidget = session.widgets.get('GridBookmark')\n              if (!bookmarkWidget) {\n                bookmarkWidget = session.addWidget(\n                  'GridBookmarkWidget',\n                  'GridBookmark',\n                )\n              }\n              // @ts-ignore\n              bookmarkWidget.addBookmark(highlight as Region)\n              dismissHighlight()\n            },\n          },\n        ]}\n      />\n    </div>\n  ) : null\n})\n\nconst HighlightGroup = observer(function HighlightGroup({\n  model,\n}: {\n  model: LGV\n}) {\n  return model.highlight.map((highlight, idx) => (\n    <Highlight\n      key={JSON.stringify(highlight) + '-' + idx}\n      model={model}\n      highlight={highlight}\n    />\n  ))\n})\n\nexport default HighlightGroup\n","import React, { useRef } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { Menu } from '@jbrowse/core/ui'\nimport { getEnv } from '@jbrowse/core/util'\n\n// local utils\nimport { LinearGenomeViewModel, SCALE_BAR_HEIGHT } from '..'\nimport { useSideScroll, useRangeSelect, useWheelScroll } from './hooks'\n\n// local components\nimport Rubberband from './Rubberband'\nimport Scalebar from './Scalebar'\nimport Gridlines from './Gridlines'\nimport CenterLine from './CenterLine'\nimport VerticalGuide from './VerticalGuide'\nimport RubberbandSpan from './RubberbandSpan'\nimport HighlightGroup from './Highlight'\n\nconst useStyles = makeStyles()({\n  tracksContainer: {\n    position: 'relative',\n    overflow: 'hidden',\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TracksContainer = observer(function TracksContainer({\n  children,\n  model,\n}: {\n  children: React.ReactNode\n  model: LGV\n}) {\n  const { classes } = useStyles()\n  const { pluginManager } = getEnv(model)\n  const { mouseDown: mouseDown1, mouseUp } = useSideScroll(model)\n  const ref = useRef<HTMLDivElement>(null)\n  const {\n    guideX,\n    rubberbandOn,\n    leftBpOffset,\n    rightBpOffset,\n    numOfBpSelected,\n    width,\n    left,\n    anchorPosition,\n    handleMenuItemClick,\n    open,\n    handleClose,\n    mouseMove,\n    mouseDown: mouseDown2,\n  } = useRangeSelect(ref, model, true)\n  useWheelScroll(ref, model)\n\n  const additional = pluginManager.evaluateExtensionPoint(\n    'LinearGenomeView-TracksContainerComponent',\n    undefined,\n    { model },\n  ) as React.ReactNode\n\n  return (\n    <div\n      ref={ref}\n      data-testid=\"trackContainer\"\n      className={classes.tracksContainer}\n      onMouseDown={event => {\n        mouseDown1(event)\n        mouseDown2(event)\n      }}\n      onMouseMove={mouseMove}\n      onMouseUp={mouseUp}\n    >\n      {model.showGridlines ? <Gridlines model={model} /> : null}\n      {model.showCenterLine ? <CenterLine model={model} /> : null}\n      {guideX !== undefined ? (\n        <VerticalGuide model={model} coordX={guideX} />\n      ) : rubberbandOn ? (\n        <RubberbandSpan\n          leftBpOffset={leftBpOffset}\n          rightBpOffset={rightBpOffset}\n          numOfBpSelected={numOfBpSelected}\n          width={width}\n          left={left}\n        />\n      ) : null}\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={model.rubberBandMenuItems()}\n        />\n      ) : null}\n\n      <Rubberband\n        model={model}\n        ControlComponent={\n          <Scalebar\n            model={model}\n            style={{ height: SCALE_BAR_HEIGHT, boxSizing: 'border-box' }}\n          />\n        }\n      />\n      <HighlightGroup model={model} />\n      {additional}\n      {children}\n    </div>\n  )\n})\n\nexport default TracksContainer\n","import React, { lazy, useEffect, useRef } from 'react'\nimport { Button, Paper, Typography } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport TrackContainer from './TrackContainer'\nimport TracksContainer from './TracksContainer'\n\nconst ImportForm = lazy(() => import('./ImportForm'))\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  note: {\n    textAlign: 'center',\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n  rel: {\n    position: 'relative',\n  },\n  top: {\n    zIndex: 1000,\n  },\n}))\n\nfunction NoTracksActive({ model }: { model: LinearGenomeViewModel }) {\n  const { classes } = useStyles()\n  const { hideNoTracksActive } = model\n  return (\n    <Paper className={classes.note}>\n      {!hideNoTracksActive ? (\n        <>\n          <Typography>No tracks active.</Typography>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => model.activateTrackSelector()}\n            className={classes.top}\n            startIcon={<TrackSelectorIcon />}\n          >\n            Open track selector\n          </Button>\n        </>\n      ) : (\n        <div style={{ height: '48px' }}></div>\n      )}\n    </Paper>\n  )\n}\n\nconst LinearGenomeView = observer(({ model }: { model: LGV }) => {\n  const { tracks, error, initialized, hasDisplayedRegions } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const session = getSession(model)\n  const { classes } = useStyles()\n  useEffect(() => {\n    // sets the focused view id based on a click within the LGV;\n    // necessary for subviews to be focused properly\n    function handleSelectView(e: Event) {\n      if (e.target instanceof Element && ref?.current?.contains(e.target)) {\n        session.setFocusedViewId?.(model.id)\n      }\n    }\n\n    document.addEventListener('mousedown', handleSelectView)\n    document.addEventListener('keydown', handleSelectView)\n    return () => {\n      document.removeEventListener('mousedown', handleSelectView)\n      document.removeEventListener('keydown', handleSelectView)\n    }\n  }, [session, model])\n\n  if (!initialized && !error) {\n    return <LoadingEllipses variant=\"h6\" />\n  }\n  if (!hasDisplayedRegions || error) {\n    return <ImportForm model={model} />\n  }\n\n  const MiniControlsComponent = model.MiniControlsComponent()\n  const HeaderComponent = model.HeaderComponent()\n\n  return (\n    <div\n      className={classes.rel}\n      ref={ref}\n      onMouseLeave={() => session.setHovered(undefined)}\n      onMouseMove={event => {\n        const c = ref.current\n        if (!c) {\n          return\n        }\n        const { tracks } = model\n        const leftPx = event.clientX - c.getBoundingClientRect().left\n        const hoverPosition = model.pxToBp(leftPx)\n        const hoverFeature = tracks.find(t => t.displays[0].featureUnderMouse)\n        session.setHovered({ hoverPosition, hoverFeature })\n      }}\n    >\n      <HeaderComponent model={model} />\n      <MiniControlsComponent model={model} />\n      <TracksContainer model={model}>\n        {!tracks.length ? (\n          <NoTracksActive model={model} />\n        ) : (\n          tracks.map(track => (\n            <TrackContainer key={track.id} model={model} track={track} />\n          ))\n        )}\n      </TracksContainer>\n    </div>\n  )\n})\n\nexport default LinearGenomeView\n","import React from 'react'\nimport { useTheme, alpha } from '@mui/material'\nimport { observer } from 'mobx-react'\n\n// core\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\n// locals\nimport { HEADER_BAR_HEIGHT, LinearGenomeViewModel } from '..'\nimport { getFillProps, getStrokeProps } from '@jbrowse/core/util'\n\nconst OverviewScalebarPolygon = observer(function ({\n  model,\n  overview,\n  useOffset = true,\n}: {\n  model: LinearGenomeViewModel\n  overview: Base1DViewModel\n  useOffset?: boolean\n}) {\n  const theme = useTheme()\n  const multiplier = Number(useOffset)\n  const { interRegionPaddingWidth, offsetPx, dynamicBlocks, cytobandOffset } =\n    model\n  const { contentBlocks, totalWidthPxWithoutBorders } = dynamicBlocks\n\n  const { tertiary, primary } = theme.palette\n  const polygonColor = tertiary ? tertiary.light : primary.light\n\n  // catches possible null from at's below\n  if (!contentBlocks.length) {\n    return null\n  }\n  const first = contentBlocks.at(0)!\n  const last = contentBlocks.at(-1)!\n  const topLeft =\n    (overview.bpToPx({\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0) +\n    cytobandOffset * multiplier\n  const topRight =\n    (overview.bpToPx({\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0) +\n    cytobandOffset * multiplier\n\n  const startPx = Math.max(0, -offsetPx)\n  const endPx =\n    startPx +\n    totalWidthPxWithoutBorders +\n    (contentBlocks.length * interRegionPaddingWidth) / 2\n\n  const points = [\n    [startPx, HEADER_BAR_HEIGHT],\n    [endPx, HEADER_BAR_HEIGHT],\n    [topRight, 0],\n    [topLeft, 0],\n  ]\n\n  return (\n    <polygon\n      points={points.toString()}\n      {...getFillProps(alpha(polygonColor, 0.3))}\n      {...getStrokeProps(alpha(polygonColor, 0.8))}\n    />\n  )\n})\n\nexport default OverviewScalebarPolygon\n","import React, { Suspense, lazy, useState } from 'react'\n\nimport { IconButton, InputAdornment } from '@mui/material'\n\n// icons\nimport SearchIcon from '@mui/icons-material/Search'\nimport HelpIcon from '@mui/icons-material/Help'\n\n// lazy\nconst HelpDialog = lazy(() => import('./HelpDialog'))\n\nfunction HelpAdornment() {\n  const [isHelpDialogDisplayed, setHelpDialogDisplayed] = useState(false)\n  return (\n    <>\n      <IconButton onClick={() => setHelpDialogDisplayed(true)} size=\"small\">\n        <HelpIcon fontSize=\"small\" />\n      </IconButton>\n      {isHelpDialogDisplayed ? (\n        <Suspense fallback={null}>\n          <HelpDialog handleClose={() => setHelpDialogDisplayed(false)} />\n        </Suspense>\n      ) : null}\n    </>\n  )\n}\n\nexport default function EndAdornment({\n  showHelp,\n  endAdornment,\n}: {\n  showHelp?: boolean\n  endAdornment: React.ReactNode\n}) {\n  return (\n    <>\n      <InputAdornment position=\"end\" style={{ marginRight: 7 }}>\n        <SearchIcon fontSize=\"small\" />\n        {showHelp ? <HelpAdornment /> : null}\n      </InputAdornment>\n      {endAdornment}\n    </>\n  )\n}\n","import React from 'react'\nimport {\n  AutocompleteRenderInputParams,\n  TextField,\n  TextFieldProps as TFP,\n} from '@mui/material'\n\n// locals\nimport EndAdornment from './EndAdornment'\n\nexport default function AutocompleteTextField({\n  TextFieldProps,\n  inputBoxVal,\n  params,\n  showHelp,\n  setInputValue,\n  setCurrentSearch,\n}: {\n  TextFieldProps: TFP\n  inputBoxVal: string\n  showHelp?: boolean\n  params: AutocompleteRenderInputParams\n  setInputValue: (arg: string) => void\n  setCurrentSearch: (arg: string) => void\n}) {\n  const { helperText, InputProps = {} } = TextFieldProps\n  return (\n    <TextField\n      onBlur={() =>\n        // this is used to restore a refName or the non-user-typed input\n        // to the box on blurring\n        setInputValue(inputBoxVal)\n      }\n      {...params}\n      {...TextFieldProps}\n      size=\"small\"\n      helperText={helperText}\n      InputProps={{\n        ...params.InputProps,\n        ...InputProps,\n\n        endAdornment: (\n          <EndAdornment\n            showHelp={showHelp}\n            endAdornment={params.InputProps.endAdornment}\n          />\n        ),\n      }}\n      placeholder=\"Search for location\"\n      onChange={e => setCurrentSearch(e.target.value)}\n    />\n  )\n}\n","import React, { useEffect, useMemo, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSession, useDebounce, measureText } from '@jbrowse/core/util'\nimport BaseResult, {\n  RefSequenceResult,\n} from '@jbrowse/core/TextSearch/BaseResults'\nimport { Autocomplete, TextFieldProps as TFP } from '@mui/material'\n\n// locals\nimport { LinearGenomeViewModel } from '../../model'\nimport { getDeduplicatedResult, getFiltered, Option } from './util'\nimport AutocompleteTextField from './AutocompleteTextField'\n\nconst RefNameAutocomplete = observer(function ({\n  model,\n  onSelect,\n  assemblyName,\n  style,\n  fetchResults,\n  onChange,\n  value,\n  showHelp = true,\n  minWidth = 200,\n  maxWidth = 550,\n  TextFieldProps = {},\n}: {\n  model: LinearGenomeViewModel\n  onSelect?: (region: BaseResult) => void\n  onChange?: (val: string) => void\n  assemblyName?: string\n  value?: string\n  fetchResults: (query: string) => Promise<BaseResult[]>\n  style?: React.CSSProperties\n  minWidth?: number\n  maxWidth?: number\n  showHelp?: boolean\n  TextFieldProps?: TFP\n}) {\n  const session = getSession(model)\n  const { assemblyManager } = session\n  const [open, setOpen] = useState(false)\n  const [loaded, setLoaded] = useState(true)\n  const [currentSearch, setCurrentSearch] = useState('')\n  const [inputValue, setInputValue] = useState('')\n  const [searchOptions, setSearchOptions] = useState<Option[]>()\n  const debouncedSearch = useDebounce(currentSearch, 300)\n  const assembly = assemblyName ? assemblyManager.get(assemblyName) : undefined\n  const { coarseVisibleLocStrings, hasDisplayedRegions } = model\n\n  useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        if (debouncedSearch === '' || !assemblyName) {\n          return\n        }\n\n        setLoaded(false)\n        const results = await fetchResults(debouncedSearch)\n        setLoaded(true)\n        setSearchOptions(getDeduplicatedResult(results))\n      } catch (e) {\n        console.error(e)\n        session.notifyError(`${e}`, e)\n      }\n    })()\n  }, [assemblyName, fetchResults, debouncedSearch, session, model])\n\n  const inputBoxVal = coarseVisibleLocStrings || value || ''\n\n  // heuristic, text width + 60 accommodates help icon and search icon\n  const width = Math.min(\n    Math.max(measureText(inputBoxVal, 14) + 100, minWidth),\n    maxWidth,\n  )\n\n  const regions = assembly?.regions\n  const regionOptions = useMemo(\n    () =>\n      regions?.map(option => ({\n        result: new RefSequenceResult({\n          refName: option.refName,\n          label: option.refName,\n          matchedAttribute: 'refName',\n        }),\n      })) || [],\n    [regions],\n  )\n\n  // notes on implementation:\n  // The selectOnFocus setting helps highlight the field when clicked\n  return (\n    <Autocomplete\n      data-testid=\"autocomplete\"\n      disableListWrap\n      disableClearable\n      disabled={!assemblyName}\n      freeSolo\n      includeInputInList\n      selectOnFocus\n      style={{ ...style, width }}\n      value={inputBoxVal}\n      loading={!loaded}\n      inputValue={inputValue}\n      onInputChange={(_event, newInputValue) => {\n        setInputValue(newInputValue)\n        onChange?.(newInputValue)\n      }}\n      loadingText=\"loading results\"\n      open={open}\n      onOpen={() => setOpen(true)}\n      onClose={() => {\n        setOpen(false)\n        setLoaded(true)\n        if (hasDisplayedRegions) {\n          setCurrentSearch('')\n          setSearchOptions(undefined)\n        }\n      }}\n      onChange={(_event, selectedOption) => {\n        if (!selectedOption || !assemblyName) {\n          return\n        }\n\n        if (typeof selectedOption === 'string') {\n          // handles string inputs on keyPress enter\n          onSelect?.(new BaseResult({ label: selectedOption }))\n        } else {\n          onSelect?.(selectedOption.result)\n        }\n        setInputValue(inputBoxVal)\n      }}\n      options={searchOptions?.length ? searchOptions : regionOptions}\n      getOptionDisabled={option => option.group === 'limitOption'}\n      filterOptions={(opts, { inputValue }) => getFiltered(opts, inputValue)}\n      renderInput={params => (\n        <AutocompleteTextField\n          showHelp={showHelp}\n          params={params}\n          inputBoxVal={inputBoxVal}\n          TextFieldProps={TextFieldProps}\n          setCurrentSearch={setCurrentSearch}\n          setInputValue={setInputValue}\n        />\n      )}\n      getOptionLabel={opt =>\n        typeof opt === 'string' ? opt : opt.result.getDisplayString()\n      }\n    />\n  )\n})\n\nexport default RefNameAutocomplete\n","import BaseResult from '@jbrowse/core/TextSearch/BaseResults'\n\nexport interface Option {\n  group?: string\n  result: BaseResult\n}\n\n// filter so don't need re-filtering\nfunction filterOptions(options: Option[], searchQuery: string) {\n  return options.filter(\n    ({ result }) =>\n      result.getLabel().toLowerCase().includes(searchQuery) ||\n      result.matchedObject,\n  )\n}\n\n// the logic of this method is to only apply a filter to RefSequenceResults\n// because they do not have a matchedObject. the trix search results already\nexport function getFiltered(opts: Option[], inputValue: string) {\n  const filtered = filterOptions(opts, inputValue.toLocaleLowerCase())\n  return [\n    ...filtered.slice(0, 100),\n    ...(filtered.length > 100\n      ? [\n          {\n            group: 'limitOption',\n            result: new BaseResult({\n              label: 'keep typing for more results',\n            }),\n          },\n        ]\n      : []),\n  ]\n}\n\nexport function aggregateResults(results: BaseResult[]) {\n  const m: Record<string, BaseResult[]> = {}\n\n  for (const result of results) {\n    const displayString = result.getDisplayString()\n    if (!m[displayString]) {\n      m[displayString] = []\n    }\n    m[displayString].push(result)\n  }\n  return m\n}\n\nexport function getDeduplicatedResult(results: BaseResult[]) {\n  return Object.entries(aggregateResults(results)).map(\n    ([displayString, results]) =>\n      results.length === 1\n        ? {\n            result: results[0],\n          }\n        : {\n            // deduplicate a \"multi-result\"\n            result: new BaseResult({\n              displayString,\n              results,\n              label: displayString,\n            }),\n          },\n  )\n}\n","import React, { useRef } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { Popover, Typography, alpha } from '@mui/material'\nimport { stringify, toLocale } from '@jbrowse/core/util'\n\nconst useStyles = makeStyles()(theme => {\n  const { primary, tertiary } = theme.palette\n  const background = tertiary\n    ? alpha(tertiary.light, 0.7)\n    : alpha(primary.light, 0.7)\n  return {\n    rubberband: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberbandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberbandText: {\n      color: tertiary ? tertiary.contrastText : primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n  }\n})\n\ninterface Offset {\n  coord: number\n  refName?: string\n  oob?: boolean\n}\n\nexport default function RubberbandSpan({\n  leftBpOffset,\n  rightBpOffset,\n  numOfBpSelected,\n  left,\n  width,\n}: {\n  leftBpOffset: Offset\n  rightBpOffset: Offset\n  numOfBpSelected?: number\n  left: number\n  width: number\n}) {\n  const ref = useRef(null)\n  const { classes } = useStyles()\n  return (\n    <>\n      {ref.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{ paper: classes.paper }}\n            open\n            anchorEl={ref.current}\n            anchorOrigin={{ vertical: 'top', horizontal: 'left' }}\n            transformOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(leftBpOffset)}</Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{ paper: classes.paper }}\n            open\n            anchorEl={ref.current}\n            anchorOrigin={{ vertical: 'top', horizontal: 'right' }}\n            transformOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(rightBpOffset)}</Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div ref={ref} className={classes.rubberband} style={{ left, width }}>\n        {numOfBpSelected ? (\n          <Typography variant=\"h6\" className={classes.rubberbandText}>\n            {toLocale(numOfBpSelected)} bp\n          </Typography>\n        ) : null}\n      </div>\n    </>\n  )\n}\n","import { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport { SearchType } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { SearchScope } from '@jbrowse/core/TextSearch/TextSearchManager'\nimport { dedupe, TextSearchManager } from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\n\nexport async function fetchResults({\n  queryString,\n  searchType,\n  searchScope,\n  rankSearchResults,\n  textSearchManager,\n  assembly,\n}: {\n  queryString: string\n  searchScope: SearchScope\n  rankSearchResults: (results: BaseResult[]) => BaseResult[]\n  searchType?: SearchType\n  textSearchManager?: TextSearchManager\n  assembly?: Assembly\n}) {\n  if (!textSearchManager) {\n    console.warn('No text search manager')\n  }\n\n  const textSearchResults = await textSearchManager?.search(\n    {\n      queryString,\n      searchType,\n    },\n    searchScope,\n    rankSearchResults,\n  )\n\n  const refNameResults = assembly?.allRefNames\n    ?.filter(ref => ref.toLowerCase().startsWith(queryString.toLowerCase()))\n    .slice(0, 10)\n    .map(r => new BaseResult({ label: r }))\n\n  return dedupe(\n    [...(refNameResults || []), ...(textSearchResults || [])],\n    elt => elt.getId(),\n  )\n}\n\n// splits on the last instance of a character\nexport function splitLast(str: string, split: string): [string, string] {\n  const lastIndex = str.lastIndexOf(split)\n  if (lastIndex === -1) {\n    return [str, '']\n  } else {\n    const before = str.slice(0, lastIndex)\n    const after = str.slice(lastIndex + 1)\n    return [before, after]\n  }\n}\n\nexport function getRelativeX<\n  T extends { clientX: number; target: EventTarget | null },\n>(event: T, element: HTMLElement | null) {\n  return event.clientX - (element?.getBoundingClientRect().left || 0)\n}\n\nexport function getCytobands(assembly: Assembly | undefined, refName: string) {\n  return (\n    assembly?.cytobands\n      ?.map(f => ({\n        refName:\n          assembly.getCanonicalRefName(f.get('refName')) || f.get('refName'),\n        start: f.get('start'),\n        end: f.get('end'),\n        type: f.get('type') as string,\n      }))\n      .filter(f => f.refName === refName) || []\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { IconButton, Paper, alpha } from '@mui/material'\nimport CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { makeStyles } from 'tss-react/mui'\nimport { getSession } from '@jbrowse/core/util'\n\n// icons\nimport ZoomIn from '@mui/icons-material/ZoomIn'\nimport ZoomOut from '@mui/icons-material/ZoomOut'\nimport ArrowDown from '@mui/icons-material/KeyboardArrowDown'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()(theme => ({\n  background: {\n    position: 'absolute',\n    right: 0,\n    zIndex: 1001,\n    background: theme.palette.background.paper,\n  },\n  focusedBackground: {\n    background: alpha(theme.palette.secondary.light, 0.2),\n  },\n}))\n\nconst MiniControls = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const { id, bpPerPx, maxBpPerPx, minBpPerPx, scaleFactor, hideHeader } = model\n  const { focusedViewId } = getSession(model)\n  return hideHeader ? (\n    <Paper className={classes.background}>\n      <Paper\n        className={focusedViewId === id ? classes.focusedBackground : undefined}\n      >\n        <CascadingMenuButton menuItems={model.menuItems()}>\n          <ArrowDown fontSize=\"small\" />\n        </CascadingMenuButton>\n        <IconButton\n          data-testid=\"zoom_out\"\n          onClick={() => model.zoom(bpPerPx * 2)}\n          disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n        >\n          <ZoomOut fontSize=\"small\" />\n        </IconButton>\n        <IconButton\n          data-testid=\"zoom_in\"\n          onClick={() => model.zoom(bpPerPx / 2)}\n          disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n        >\n          <ZoomIn fontSize=\"small\" />\n        </IconButton>\n      </Paper>\n    </Paper>\n  ) : null\n})\n\nexport default MiniControls\n","import React, { useRef, useEffect, useState } from 'react'\nimport { Tooltip } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getSession, stringify } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport RubberbandSpan from './RubberbandSpan'\nimport { getRelativeX } from './util'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  rubberbandControl: {\n    cursor: 'crosshair',\n    width: '100%',\n    minHeight: 8,\n  },\n  guide: {\n    pointerEvents: 'none',\n    height: '100%',\n    width: 1,\n    position: 'absolute',\n    zIndex: 10,\n  },\n  rel: {\n    position: 'relative',\n  },\n})\n\nconst HoverTooltip = observer(function ({\n  model,\n  open,\n  guideX,\n  overview,\n}: {\n  model: LGV\n  open: boolean\n  guideX: number\n  overview: Base1DViewModel\n}) {\n  const { classes } = useStyles()\n  const { cytobandOffset } = model\n  const { assemblyManager } = getSession(model)\n\n  const px = overview.pxToBp(guideX - cytobandOffset)\n  const assembly = assemblyManager.get(px.assemblyName)\n  const cytoband = assembly?.cytobands?.find(\n    f =>\n      px.coord > f.get('start') &&\n      px.coord < f.get('end') &&\n      px.refName === assembly.getCanonicalRefName(f.get('refName')),\n  )\n\n  return (\n    <Tooltip\n      open={open}\n      placement=\"top\"\n      title={[stringify(px), cytoband?.get('name')].join(' ')}\n      arrow\n    >\n      <div className={classes.guide} style={{ left: guideX }} />\n    </Tooltip>\n  )\n})\n\nconst OverviewRubberband = observer(function OverviewRubberband({\n  model,\n  overview,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  ControlComponent?: React.ReactElement\n}) {\n  const { cytobandOffset } = model\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [guideX, setGuideX] = useState<number>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const { classes } = useStyles()\n  const mouseDragging = startX !== undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      const ref = controlsRef.current\n      if (ref && mouseDragging) {\n        setCurrentX(getRelativeX(event, ref))\n      }\n    }\n\n    function globalMouseUp() {\n      // click and drag\n      if (startX !== undefined && currentX !== undefined) {\n        if (Math.abs(currentX - startX) > 3) {\n          const left = Math.min(startX, currentX)\n          const right = Math.max(startX, currentX)\n          model.moveTo(\n            overview.pxToBp(left - cytobandOffset),\n            overview.pxToBp(right - cytobandOffset),\n          )\n        }\n      }\n\n      // just a click\n      if (startX !== undefined && currentX === undefined) {\n        const click = overview.pxToBp(startX - cytobandOffset)\n        if (!click.refName) {\n          getSession(model).notify('unknown position clicked')\n          console.error('unknown position clicked', click)\n        } else {\n          model.centerAt(Math.round(click.coord), click.refName, click.index)\n        }\n      }\n      setStartX(undefined)\n      setCurrentX(undefined)\n\n      if (startX !== undefined) {\n        setGuideX(undefined)\n      }\n    }\n\n    function globalKeyDown(event: KeyboardEvent) {\n      if (event.key === 'Escape') {\n        setStartX(undefined)\n        setCurrentX(undefined)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      window.addEventListener('keydown', globalKeyDown, true)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n        window.removeEventListener('keydown', globalKeyDown, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, currentX, startX, model, overview, cytobandOffset])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    setStartX(getRelativeX(event, controlsRef.current))\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    setGuideX(getRelativeX(event, controlsRef.current))\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  if (startX === undefined) {\n    return (\n      <div className={classes.rel}>\n        {guideX !== undefined ? (\n          <HoverTooltip\n            model={model}\n            open={!mouseDragging}\n            overview={overview}\n            guideX={guideX}\n          />\n        ) : null}\n        <div\n          className={classes.rubberbandControl}\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </div>\n    )\n  }\n\n  let left = startX || 0\n  let width = 0\n  if (startX !== undefined && currentX !== undefined) {\n    left = currentX < startX ? currentX : startX\n    width = currentX - startX\n  }\n  // calculate the start and end bp of drag\n  let leftBpOffset\n  let rightBpOffset\n  if (startX) {\n    leftBpOffset = overview.pxToBp(startX - cytobandOffset)\n    rightBpOffset = overview.pxToBp(startX + width - cytobandOffset)\n    if (currentX !== undefined && currentX < startX) {\n      ;[leftBpOffset, rightBpOffset] = [rightBpOffset, leftBpOffset]\n    }\n  }\n\n  return (\n    <div className={classes.rel}>\n      {leftBpOffset && rightBpOffset ? (\n        <RubberbandSpan\n          leftBpOffset={leftBpOffset}\n          rightBpOffset={rightBpOffset}\n          width={Math.abs(width)}\n          left={left}\n        />\n      ) : null}\n      <div\n        data-testid=\"rubberband_controls\"\n        className={classes.rubberbandControl}\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n    </div>\n  )\n})\n\nexport default OverviewRubberband\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { colord } from '@jbrowse/core/util/colord'\nimport {\n  ParsedLocString,\n  SessionWithWidgets,\n  getSession,\n  notEmpty,\n} from '@jbrowse/core/util'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\n// locals\nimport { LinearGenomeViewModel } from '../model'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  highlight: {\n    height: '100%',\n    position: 'absolute',\n    background: `${colord(theme.palette.highlight?.main ?? 'goldenrod')\n      .alpha(0.35)\n      .toRgbString()}`,\n    borderLeft: `1px solid ${theme.palette.highlight?.main ?? 'goldenrod'}`,\n    borderRight: `1px solid ${theme.palette.highlight?.main ?? 'goldenrod'}`,\n  },\n}))\n\nconst OverviewHighlight = observer(function OverviewHighlight({\n  model,\n  overview,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n}) {\n  const { classes } = useStyles()\n  const { cytobandOffset } = model\n\n  const session = getSession(model) as SessionWithWidgets\n  const { assemblyManager } = session\n\n  // coords\n  const mapCoords = (r: Required<ParsedLocString>) => {\n    const s = overview.bpToPx({\n      ...r,\n      coord: r.reversed ? r.end : r.start,\n    })\n    const e = overview.bpToPx({\n      ...r,\n      coord: r.reversed ? r.start : r.end,\n    })\n    return s !== undefined && e != undefined\n      ? {\n          width: Math.abs(e - s),\n          left: s + cytobandOffset,\n        }\n      : undefined\n  }\n\n  return model.highlight\n    .map(h => {\n      const asm = assemblyManager.get(h?.assemblyName)\n      return mapCoords({\n        ...h,\n        refName: asm?.getCanonicalRefName(h.refName) ?? h.refName,\n      })\n    })\n    .filter(notEmpty)\n    .map(({ left, width }, idx) => (\n      <div\n        key={`${left}_${width}_${idx}`}\n        className={classes.highlight}\n        style={{\n          width: width,\n          left: left,\n        }}\n      />\n    ))\n})\n\nexport default OverviewHighlight\n","import React, { useMemo } from 'react'\nimport { Typography, useTheme, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\n// core\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { getEnv, getSession, getTickDisplayStr } from '@jbrowse/core/util'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\n\n// locals\nimport {\n  LinearGenomeViewModel,\n  HEADER_BAR_HEIGHT,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { chooseGridPitch } from '../util'\nimport { getCytobands } from './util'\nimport OverviewRubberband from './OverviewRubberband'\nimport Cytobands from './Cytobands'\nimport OverviewScalebarPolygon from './OverviewScalebarPolygon'\nimport OverviewHighlight from './OverviewHighlight'\n\nconst wholeSeqSpacer = 2\n\nconst useStyles = makeStyles()(theme => ({\n  scalebar: {\n    height: HEADER_OVERVIEW_HEIGHT,\n  },\n  scalebarBorder: {\n    border: '1px solid',\n  },\n  scalebarContig: {\n    backgroundColor: theme.palette.background.default,\n    position: 'absolute',\n    top: 0,\n    height: HEADER_OVERVIEW_HEIGHT,\n    overflow: 'hidden',\n  },\n  scalebarContigForward: {\n    backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='${theme.palette.divider}'/%3E%3C/svg%3E\")`,\n    backgroundRepeat: 'repeat',\n  },\n  scalebarContigReverse: {\n    backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='${theme.palette.divider}'/%3E%3C/svg%3E\")`,\n    backgroundRepeat: 'repeat',\n  },\n\n  scalebarRefName: {\n    position: 'absolute',\n    fontWeight: 'bold',\n    pointerEvents: 'none',\n    zIndex: 100,\n  },\n  scalebarLabel: {\n    height: HEADER_OVERVIEW_HEIGHT,\n    position: 'absolute',\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  scalebarVisibleRegion: {\n    position: 'absolute',\n    height: HEADER_OVERVIEW_HEIGHT,\n    pointerEvents: 'none',\n    zIndex: 100,\n    border: '1px solid',\n  },\n  overview: {\n    height: HEADER_BAR_HEIGHT,\n    position: 'relative',\n  },\n  overviewSvg: {\n    pointerEvents: 'none',\n    width: '100%',\n    position: 'absolute',\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nconst OverviewBox = observer(function ({\n  scale,\n  model,\n  block,\n  overview,\n}: {\n  scale: number\n  model: LGV\n  block: ContentBlock\n  overview: Base1DViewModel\n}) {\n  const { classes, cx } = useStyles()\n  const theme = useTheme()\n  const { cytobandOffset, showCytobands } = model\n  const { reversed, refName, assemblyName } = block\n  const { assemblyManager } = getSession(model)\n  const assembly = assemblyManager.get(assemblyName)\n  const refNameColor = assembly?.getRefNameColor(refName)\n\n  const canDisplayCytobands =\n    showCytobands && getCytobands(assembly, block.refName).length\n\n  return (\n    <div>\n      {/* name of sequence */}\n      <Typography\n        style={{\n          left: block.offsetPx + 3,\n          color: canDisplayCytobands\n            ? theme.palette.text.primary\n            : refNameColor,\n        }}\n        className={classes.scalebarRefName}\n      >\n        {refName}\n      </Typography>\n      <div\n        className={cx(\n          classes.scalebarContig,\n          canDisplayCytobands\n            ? undefined\n            : reversed\n              ? classes.scalebarContigReverse\n              : classes.scalebarContigForward,\n          !canDisplayCytobands ? classes.scalebarBorder : undefined,\n        )}\n        style={{\n          left: block.offsetPx + cytobandOffset,\n          width: block.widthPx,\n          borderColor: refNameColor,\n        }}\n      >\n        {!canDisplayCytobands ? (\n          <TickLabels\n            model={model}\n            overview={overview}\n            scale={scale}\n            block={block}\n          />\n        ) : null}\n\n        {canDisplayCytobands ? (\n          <svg style={{ width: '100%' }}>\n            <Cytobands overview={overview} assembly={assembly} block={block} />\n          </svg>\n        ) : null}\n      </div>\n    </div>\n  )\n})\n\nconst TickLabels = observer(function ({\n  block,\n  scale,\n  overview,\n  model,\n}: {\n  model: LGV\n  scale: number\n  block: ContentBlock\n  overview: Base1DViewModel\n}) {\n  const { classes } = useStyles()\n  const { start, end, reversed, refName, assemblyName } = block\n  const { majorPitch } = chooseGridPitch(scale, 120, 15)\n  const { assemblyManager } = getSession(model)\n  const assembly = assemblyManager.get(assemblyName)\n  const refNameColor = assembly?.getRefNameColor(refName)\n\n  const tickLabels = []\n  for (let i = 0; i < Math.floor((end - start) / majorPitch); i++) {\n    const offsetLabel = (i + 1) * majorPitch\n    tickLabels.push(reversed ? end - offsetLabel : start + offsetLabel)\n  }\n  return tickLabels.map((tickLabel, labelIdx) => (\n    <Typography\n      key={`${JSON.stringify(block)}-${tickLabel}-${labelIdx}`}\n      className={classes.scalebarLabel}\n      variant=\"body2\"\n      style={{\n        left: ((labelIdx + 1) * majorPitch) / scale,\n        pointerEvents: 'none',\n        color: refNameColor,\n      }}\n    >\n      {getTickDisplayStr(tickLabel, overview.bpPerPx)}\n    </Typography>\n  ))\n})\n\nconst Scalebar = observer(function ({\n  model,\n  scale,\n  overview,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  scale: number\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const { dynamicBlocks, showCytobands, cytobandOffset } = model\n  const { pluginManager } = getEnv(model)\n  const visibleRegions = dynamicBlocks.contentBlocks\n  const overviewVisibleRegions = overview.dynamicBlocks\n\n  const { tertiary, primary } = theme.palette\n  const scalebarColor = tertiary ? tertiary.light : primary.light\n  // catches possible null from at's below\n  if (!visibleRegions.length) {\n    return null\n  }\n\n  const first = visibleRegions.at(0)!\n  const last = visibleRegions.at(-1)!\n\n  const firstOverviewPx =\n    overview.bpToPx({\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0\n\n  const lastOverviewPx =\n    overview.bpToPx({\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0\n\n  const color = showCytobands ? '#f00' : scalebarColor\n  const transparency = showCytobands ? 0.1 : 0.3\n\n  const additional = pluginManager.evaluateExtensionPoint(\n    'LinearGenomeView-OverviewScalebarComponent',\n    undefined,\n    { model, overview },\n  ) as React.ReactNode\n\n  return (\n    <div className={classes.scalebar}>\n      <div\n        className={classes.scalebarVisibleRegion}\n        style={{\n          width: lastOverviewPx - firstOverviewPx,\n          left: firstOverviewPx + cytobandOffset,\n          background: alpha(color, transparency),\n          borderColor: color,\n        }}\n      />\n      {/* this is the entire scale bar */}\n      {overviewVisibleRegions.map((block, idx) => {\n        return !(block.type === 'ContentBlock') ? (\n          <div\n            key={`${JSON.stringify(block)}-${idx}`}\n            className={classes.scalebarContig}\n            style={{\n              width: block.widthPx,\n              left: block.offsetPx,\n              backgroundColor: '#999',\n              backgroundImage:\n                'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n            }}\n          />\n        ) : (\n          <OverviewBox\n            scale={scale}\n            block={block}\n            model={model}\n            overview={overview}\n            key={`${JSON.stringify(block)}-${idx}`}\n          />\n        )\n      })}\n      <OverviewHighlight model={model} overview={overview} />\n      {additional}\n    </div>\n  )\n})\n\nconst OverviewScalebar = observer(function ({\n  model,\n  children,\n}: {\n  model: LGV\n  children: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  const { totalBp, width, cytobandOffset, displayedRegions } = model\n\n  const modWidth = width - cytobandOffset\n  const overview = useMemo(() => {\n    const overview = Base1DView.create({\n      displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n      interRegionPaddingWidth: 0,\n      minimumBlockWidth: model.minimumBlockWidth,\n    })\n\n    overview.setVolatileWidth(modWidth)\n    overview.showAllRegions()\n    return overview\n  }, [\n    JSON.stringify(displayedRegions), // eslint-disable-line react-hooks/exhaustive-deps\n    model.minimumBlockWidth,\n    modWidth,\n    displayedRegions,\n  ])\n\n  const scale =\n    totalBp / (modWidth - (displayedRegions.length - 1) * wholeSeqSpacer)\n\n  return (\n    <div>\n      <OverviewRubberband\n        model={model}\n        overview={overview}\n        ControlComponent={\n          <Scalebar model={model} overview={overview} scale={scale} />\n        }\n      />\n      <div className={classes.overview}>\n        <svg height={HEADER_BAR_HEIGHT} className={classes.overviewSvg}>\n          <OverviewScalebarPolygon model={model} overview={overview} />\n        </svg>\n        {children}\n      </div>\n    </div>\n  )\n})\n\nexport default OverviewScalebar\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { Slider, IconButton } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport ZoomIn from '@mui/icons-material/ZoomIn'\nimport ZoomOut from '@mui/icons-material/ZoomOut'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()(theme => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  slider: {\n    width: 70,\n    color: theme.palette.text.secondary,\n  },\n}))\n\nconst ZoomControls = observer(function ({\n  model,\n}: {\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const { maxBpPerPx, minBpPerPx, bpPerPx } = model\n  const [value, setValue] = useState(-Math.log2(bpPerPx) * 100)\n  useEffect(() => {\n    setValue(-Math.log2(bpPerPx) * 100)\n  }, [setValue, bpPerPx])\n\n  return (\n    <div className={classes.container}>\n      <IconButton\n        data-testid=\"zoom_out\"\n        onClick={() => model.zoom(bpPerPx * 2)}\n        disabled={bpPerPx >= maxBpPerPx - 0.0001}\n        size=\"large\"\n      >\n        <ZoomOut />\n      </IconButton>\n\n      <Slider\n        size=\"small\"\n        className={classes.slider}\n        value={value}\n        min={-Math.log2(maxBpPerPx) * 100}\n        max={-Math.log2(minBpPerPx) * 100}\n        onChange={(_, val) => setValue(val as number)}\n        onChangeCommitted={() => model.zoomTo(2 ** (-value / 100))}\n      />\n      <IconButton\n        data-testid=\"zoom_in\"\n        onClick={() => model.zoom(model.bpPerPx / 2)}\n        disabled={bpPerPx <= minBpPerPx + 0.0001}\n        size=\"large\"\n      >\n        <ZoomIn />\n      </IconButton>\n    </div>\n  )\n})\n\nexport default ZoomControls\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { useTheme, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getSession } from '@jbrowse/core/util'\n\n// locals\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport { fetchResults } from './util'\nimport { LinearGenomeViewModel, SPACING, WIDGET_HEIGHT } from '..'\nimport { handleSelectedRegion, navToOption } from '../../searchUtils'\n\nconst useStyles = makeStyles()(() => ({\n  headerRefName: {\n    minWidth: 100,\n  },\n}))\n\nconst SearchBox = observer(function ({\n  model,\n  showHelp,\n}: {\n  showHelp?: boolean\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const session = getSession(model)\n\n  const { textSearchManager, assemblyManager } = session\n  const { assemblyNames, rankSearchResults } = model\n  const assemblyName = assemblyNames[0]\n  const assembly = assemblyManager.get(assemblyName)\n  const searchScope = model.searchScope(assemblyName)\n\n  return (\n    <RefNameAutocomplete\n      showHelp={showHelp}\n      onSelect={async option => {\n        try {\n          if (option.hasLocation()) {\n            await navToOption({ option, model, assemblyName })\n          } else if (option.results?.length) {\n            model.setSearchResults(option.results, option.getLabel())\n          } else if (assembly) {\n            await handleSelectedRegion({\n              input: option.getLabel(),\n              assembly,\n              model,\n            })\n          }\n        } catch (e) {\n          console.error(e)\n          getSession(model).notify(`${e}`, 'warning')\n        }\n      }}\n      assemblyName={assemblyName}\n      fetchResults={queryString =>\n        fetchResults({\n          queryString,\n          searchScope,\n          rankSearchResults,\n          textSearchManager,\n          assembly,\n        })\n      }\n      model={model}\n      minWidth={175}\n      TextFieldProps={{\n        variant: 'outlined',\n        className: classes.headerRefName,\n        style: { margin: SPACING },\n        InputProps: {\n          style: {\n            padding: 0,\n            height: WIDGET_HEIGHT,\n            background: alpha(theme.palette.background.paper, 0.8),\n          },\n        },\n      }}\n    />\n  )\n})\n\nexport default SearchBox\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Button, IconButton, FormGroup, Typography, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getBpDisplayStr } from '@jbrowse/core/util'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport ArrowForwardIcon from '@mui/icons-material/ArrowForward'\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack'\n\n// locals\nimport { LinearGenomeViewModel, SPACING } from '..'\nimport OverviewScalebar from './OverviewScalebar'\nimport ZoomControls from './ZoomControls'\nimport SearchBox from './SearchBox'\n\ntype LGV = LinearGenomeViewModel\nconst useStyles = makeStyles()(theme => ({\n  headerBar: {\n    display: 'flex',\n  },\n  headerForm: {\n    flexWrap: 'nowrap',\n    marginRight: 7,\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n\n  panButton: {\n    background: alpha(theme.palette.background.paper, 0.8),\n    color: theme.palette.text.primary,\n    margin: SPACING,\n  },\n  bp: {\n    display: 'flex',\n    alignItems: 'center',\n    marginLeft: 5,\n  },\n  toggleButton: {\n    height: 44,\n    border: 'none',\n    marginLeft: theme.spacing(4),\n  },\n  buttonSpacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst HeaderButtons = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  return (\n    <IconButton\n      onClick={model.activateTrackSelector}\n      className={classes.toggleButton}\n      title=\"Open track selector\"\n      value=\"track_select\"\n    >\n      <TrackSelectorIcon className={classes.buttonSpacer} />\n    </IconButton>\n  )\n})\n\nfunction PanControls({ model }: { model: LGV }) {\n  const { classes } = useStyles()\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(-0.9)}\n      >\n        <ArrowBackIcon />\n      </Button>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(0.9)}\n      >\n        <ArrowForwardIcon />\n      </Button>\n    </>\n  )\n}\n\nconst RegionWidth = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  const { coarseTotalBp } = model\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.bp}>\n      {getBpDisplayStr(coarseTotalBp)}\n    </Typography>\n  )\n})\n\nconst Controls = ({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.headerBar}>\n      <HeaderButtons model={model} />\n      <div className={classes.spacer} />\n      <FormGroup row className={classes.headerForm}>\n        <PanControls model={model} />\n        <SearchBox model={model} />\n      </FormGroup>\n      <RegionWidth model={model} />\n      <ZoomControls model={model} />\n      <div className={classes.spacer} />\n    </div>\n  )\n}\n\nconst LinearGenomeViewHeader = observer(({ model }: { model: LGV }) => {\n  return !model.hideHeader ? (\n    model.hideHeaderOverview ? (\n      <Controls model={model} />\n    ) : (\n      <OverviewScalebar model={model}>\n        <Controls model={model} />\n      </OverviewScalebar>\n    )\n  ) : null\n})\n\nexport default LinearGenomeViewHeader\n","import React, { lazy } from 'react'\nimport { getConf, AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { Region } from '@jbrowse/core/util/types'\nimport { ElementId, Region as MUIRegion } from '@jbrowse/core/util/types/mst'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  assembleLocString,\n  clamp,\n  findLast,\n  getContainingView,\n  getSession,\n  isViewContainer,\n  isSessionModelWithWidgets,\n  isSessionWithAddTracks,\n  localStorageGetItem,\n  localStorageSetItem,\n  measureText,\n  springAnimate,\n  sum,\n  ParsedLocString,\n} from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { BlockSet, BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport calculateStaticBlocks from '@jbrowse/core/util/calculateStaticBlocks'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { when, transaction, autorun } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getRoot,\n  resolveIdentifier,\n  types,\n  Instance,\n} from 'mobx-state-tree'\n\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport { moveTo, pxToBp, bpToPx } from '@jbrowse/core/util/Base1DUtils'\nimport { saveAs } from 'file-saver'\nimport clone from 'clone'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport SyncAltIcon from '@mui/icons-material/SyncAlt'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport LabelIcon from '@mui/icons-material/Label'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\nimport ZoomInIcon from '@mui/icons-material/ZoomIn'\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport SearchIcon from '@mui/icons-material/Search'\n\nimport MiniControls from './components/MiniControls'\nimport Header from './components/Header'\nimport { generateLocations, parseLocStrings } from './util'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport { handleSelectedRegion } from '../searchUtils'\n// lazies\nconst ReturnToImportFormDialog = lazy(\n  () => import('@jbrowse/core/ui/ReturnToImportFormDialog'),\n)\nconst SequenceSearchDialog = lazy(\n  () => import('./components/SequenceSearchDialog'),\n)\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\nconst GetSequenceDialog = lazy(() => import('./components/GetSequenceDialog'))\nconst SearchResultsDialog = lazy(\n  () => import('./components/SearchResultsDialog'),\n)\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n  coord?: number\n  reversed?: boolean\n  assemblyName?: string\n  oob?: boolean\n}\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n  Wrapper?: React.FC<{ children: React.ReactNode }>\n  fontSize?: number\n  rulerHeight?: number\n  textHeight?: number\n  paddingHeight?: number\n  headerHeight?: number\n  cytobandHeight?: number\n  trackLabels?: string\n  themeName?: string\n}\n\nfunction calculateVisibleLocStrings(contentBlocks: BaseBlock[]) {\n  if (!contentBlocks.length) {\n    return ''\n  }\n  const isSingleAssemblyName = contentBlocks.every(\n    b => b.assemblyName === contentBlocks[0].assemblyName,\n  )\n  const locs = contentBlocks.map(block =>\n    assembleLocString({\n      ...block,\n      start: Math.round(block.start),\n      end: Math.round(block.end),\n      assemblyName: isSingleAssemblyName ? undefined : block.assemblyName,\n    }),\n  )\n  return locs.join(' ')\n}\n\nexport interface NavLocation {\n  refName: string\n  start?: number\n  end?: number\n  assemblyName?: string\n}\n\nexport const HEADER_BAR_HEIGHT = 48\nexport const HEADER_OVERVIEW_HEIGHT = 20\nexport const SCALE_BAR_HEIGHT = 17\nexport const RESIZE_HANDLE_HEIGHT = 3\nexport const INTER_REGION_PADDING_WIDTH = 2\nexport const SPACING = 7\nexport const WIDGET_HEIGHT = 32\n\n/**\n * #stateModel LinearGenomeView\n * #category view\n *\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'LinearGenomeView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n\n        /**\n         * #property\n         * this is a string instead of the const literal 'LinearGenomeView' to\n         * reduce some typescripting strictness, but you should pass the string\n         * 'LinearGenomeView' to the model explicitly\n         */\n        type: types.literal('LinearGenomeView') as unknown as string,\n\n        /**\n         * #property\n         * corresponds roughly to the horizontal scroll of the LGV\n         */\n        offsetPx: 0,\n\n        /**\n         * #property\n         * corresponds roughly to the zoom level, base-pairs per pixel\n         */\n        bpPerPx: 1,\n\n        /**\n         * #property\n         * currently displayed regions, can be a single chromosome, arbitrary\n         * subsections, or the entire  set of chromosomes in the genome, but it not\n         * advised to use the entire set of chromosomes if your assembly is very\n         * fragmented\n         */\n        displayedRegions: types.array(MUIRegion),\n\n        /**\n         * #property\n         * array of currently displayed tracks state models instances\n         */\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        /**\n         * #property\n         */\n        hideHeader: false,\n\n        /**\n         * #property\n         */\n        hideHeaderOverview: false,\n\n        /**\n         * #property\n         */\n        hideNoTracksActive: false,\n\n        /**\n         * #property\n         */\n        trackSelectorType: types.optional(\n          types.enumeration(['hierarchical']),\n          'hierarchical',\n        ),\n        /**\n         * #property\n         * show the \"center line\"\n         */\n        showCenterLine: types.optional(types.boolean, () =>\n          Boolean(\n            JSON.parse(localStorageGetItem('lgv-showCenterLine') || 'false'),\n          ),\n        ),\n\n        /**\n         * #property\n         * show the \"cytobands\" in the overview scale bar\n         */\n        showCytobandsSetting: types.optional(types.boolean, () =>\n          Boolean(\n            JSON.parse(localStorageGetItem('lgv-showCytobands') || 'true'),\n          ),\n        ),\n\n        /**\n         * #property\n         * how to display the track labels, can be \"overlapping\", \"offset\", or\n         * \"hidden\", or empty string \"\" (which results in conf being used). see\n         * LinearGenomeViewPlugin\n         * https://jbrowse.org/jb2/docs/config/lineargenomeviewplugin/ docs for\n         * how conf is used\n         */\n        trackLabels: types.optional(\n          types.string,\n          () => localStorageGetItem('lgv-trackLabels') || '',\n        ),\n\n        /**\n         * #property\n         * show the \"gridlines\" in the track area\n         */\n        showGridlines: true,\n\n        /**\n         * #property\n         * highlights on the LGV from the URL parameters\n         */\n        highlight: types.optional(\n          types.array(types.frozen<Required<ParsedLocString>>()),\n          [],\n        ),\n\n        /**\n         * #property\n         * color by CDS\n         */\n        colorByCDS: types.optional(types.boolean, () =>\n          Boolean(JSON.parse(localStorageGetItem('lgv-colorByCDS') || 'false')),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      minimumBlockWidth: 3,\n      draggingTrackId: undefined as undefined | string,\n      volatileError: undefined as unknown,\n\n      // array of callbacks to run after the next set of the displayedRegions,\n      // which is basically like an onLoad\n      afterDisplayedRegionsSetCallbacks: [] as Function[],\n      scaleFactor: 1,\n      trackRefs: {} as Record<string, HTMLDivElement>,\n      coarseDynamicBlocks: [] as BaseBlock[],\n      coarseTotalBp: 0,\n      leftOffset: undefined as undefined | BpOffset,\n      rightOffset: undefined as undefined | BpOffset,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * this is the effective value of the track labels setting, incorporating\n       * both the config and view state. use this instead of view.trackLabels\n       */\n      get trackLabelsSetting() {\n        const sessionSetting = getConf(getSession(self), [\n          'LinearGenomeViewPlugin',\n          'trackLabels',\n        ])\n        return self.trackLabels || sessionSetting\n      },\n      /**\n       * #getter\n       */\n      get width(): number {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'width undefined, make sure to check for model.initialized',\n          )\n        }\n        return self.volatileWidth\n      },\n      /**\n       * #getter\n       */\n      get interRegionPaddingWidth() {\n        return INTER_REGION_PADDING_WIDTH\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        return [\n          ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n        ]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      MiniControlsComponent(): React.FC<any> {\n        return MiniControls\n      },\n\n      /**\n       * #method\n       */\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      HeaderComponent(): React.FC<any> {\n        return Header\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        const { assemblyNames } = self\n        return assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n\n      /**\n       * #getter\n       */\n      get assembliesInitialized() {\n        const { assemblyManager } = getSession(self)\n        const { assemblyNames } = self\n        return assemblyNames.every(a => assemblyManager.get(a)?.initialized)\n      },\n\n      /**\n       * #getter\n       */\n      get initialized() {\n        return self.volatileWidth !== undefined && this.assembliesInitialized\n      },\n\n      /**\n       * #getter\n       */\n      get hasDisplayedRegions() {\n        return self.displayedRegions.length > 0\n      },\n\n      /**\n       * #getter\n       */\n      get scaleBarHeight() {\n        return SCALE_BAR_HEIGHT + RESIZE_HANDLE_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get headerHeight() {\n        if (self.hideHeader) {\n          return 0\n        }\n        if (self.hideHeaderOverview) {\n          return HEADER_BAR_HEIGHT\n        }\n        return HEADER_BAR_HEIGHT + HEADER_OVERVIEW_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get trackHeights() {\n        return sum(self.tracks.map(t => t.displays[0].height))\n      },\n\n      /**\n       * #getter\n       */\n      get trackHeightsWithResizeHandles() {\n        return this.trackHeights + self.tracks.length * RESIZE_HANDLE_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get height() {\n        return (\n          this.trackHeightsWithResizeHandles +\n          this.headerHeight +\n          this.scaleBarHeight\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get totalBp() {\n        return self.displayedRegions.reduce((a, b) => a + b.end - b.start, 0)\n      },\n\n      /**\n       * #getter\n       */\n      get maxBpPerPx() {\n        return this.totalBp / (self.width * 0.9)\n      },\n\n      /**\n       * #getter\n       */\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      /**\n       * #getter\n       */\n      get error() {\n        return self.volatileError || this.assemblyErrors\n      },\n\n      /**\n       * #getter\n       */\n      get maxOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const leftPadding = 10\n        return this.displayedRegionsTotalPx - leftPadding\n      },\n\n      /**\n       * #getter\n       */\n      get minOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const rightPadding = 30\n        return -self.width + rightPadding\n      },\n\n      /**\n       * #getter\n       */\n      get displayedRegionsTotalPx() {\n        return this.totalBp / self.bpPerPx\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          bpPerPx: self.bpPerPx,\n          colorByCDS: self.colorByCDS,\n        }\n      },\n\n      /**\n       * #method\n       */\n      searchScope(assemblyName: string) {\n        return {\n          assemblyName,\n          includeAggregateIndexes: true,\n          tracks: self.tracks,\n        }\n      },\n\n      /**\n       * #method\n       */\n      getTrack(id: string) {\n        return self.tracks.find(t => t.configuration.trackId === id)\n      },\n\n      /**\n       * #method\n       */\n      rankSearchResults(results: BaseResult[]) {\n        // order of rank\n        const openTrackIds = new Set(\n          self.tracks.map(track => track.configuration.trackId),\n        )\n        for (const result of results) {\n          if (openTrackIds.has(result.trackId)) {\n            result.updateScore(result.getScore() + 1)\n          }\n        }\n        return results\n      },\n\n      /**\n       * #method\n       * modifies view menu action onClick to apply to all tracks of same type\n       */\n      rewriteOnClicks(trackType: string, viewMenuActions: MenuItem[]) {\n        viewMenuActions.forEach(action => {\n          // go to lowest level menu\n          if ('subMenu' in action) {\n            this.rewriteOnClicks(trackType, action.subMenu)\n          }\n          if ('onClick' in action) {\n            const holdOnClick = action.onClick\n            action.onClick = (...args: unknown[]) => {\n              self.tracks.forEach(track => {\n                if (track.type === trackType) {\n                  holdOnClick.apply(track, [track, ...args])\n                }\n              })\n            }\n          }\n        })\n      },\n      /**\n       * #getter\n       */\n      get trackTypeActions() {\n        const allActions = new Map<string, MenuItem[]>()\n        self.tracks.forEach(track => {\n          const trackInMap = allActions.get(track.type)\n          if (!trackInMap) {\n            const viewMenuActions = clone(track.viewMenuActions)\n            this.rewriteOnClicks(track.type, viewMenuActions)\n            allActions.set(track.type, viewMenuActions)\n          }\n        })\n\n        return allActions\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setColorByCDS(flag: boolean) {\n        self.colorByCDS = flag\n      },\n      /**\n       * #action\n       */\n      setShowCytobands(flag: boolean) {\n        self.showCytobandsSetting = flag\n      },\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n      },\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        self.volatileError = error\n      },\n      /**\n       * #action\n       */\n      setHideHeader(b: boolean) {\n        self.hideHeader = b\n      },\n      /**\n       * #action\n       */\n      setHideHeaderOverview(b: boolean) {\n        self.hideHeaderOverview = b\n      },\n      /**\n       * #action\n       */\n      setHideNoTracksActive(b: boolean) {\n        self.hideNoTracksActive = b\n      },\n      /**\n       * #action\n       */\n      setShowGridlines(b: boolean) {\n        self.showGridlines = b\n      },\n      /**\n       * #action\n       */\n      addToHighlights(highlight: Required<ParsedLocString>) {\n        self.highlight?.push(highlight)\n      },\n      /**\n       * #action\n       */\n      setHighlight(highlight: Required<ParsedLocString>[] | undefined) {\n        self.highlight = cast(highlight)\n      },\n      /**\n       * #action\n       */\n      removeHighlight(highlight: Required<ParsedLocString>) {\n        self.highlight.remove(highlight)\n      },\n      /**\n       * #action\n       */\n      scrollTo(offsetPx: number) {\n        const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n        self.offsetPx = newOffsetPx\n        return newOffsetPx\n      },\n\n      /**\n       * #action\n       */\n      zoomTo(bpPerPx: number, offset = self.width / 2, centerAtOffset = false) {\n        const newBpPerPx = clamp(bpPerPx, self.minBpPerPx, self.maxBpPerPx)\n        if (newBpPerPx === self.bpPerPx) {\n          return newBpPerPx\n        }\n        const oldBpPerPx = self.bpPerPx\n\n        if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n          console.warn('zoomTo bpPerPx rounding error')\n          return oldBpPerPx\n        }\n        self.bpPerPx = newBpPerPx\n\n        // tweak the offset so that the center of the view remains at the same\n        // coordinate\n        this.scrollTo(\n          Math.round(\n            ((self.offsetPx + offset) * oldBpPerPx) / newBpPerPx -\n              (centerAtOffset ? self.width / 2 : offset),\n          ),\n        )\n        return newBpPerPx\n      },\n\n      /**\n       * #action\n       * sets offsets of rubberband, used in the get sequence dialog can call\n       * view.getSelectedRegions(view.leftOffset,view.rightOffset) to compute\n       * the selected regions from the offsets\n       */\n      setOffsets(left?: BpOffset, right?: BpOffset) {\n        self.leftOffset = left\n        self.rightOffset = right\n      },\n\n      /**\n       * #action\n       */\n      setSearchResults(\n        searchResults: BaseResult[],\n        searchQuery: string,\n        assemblyName?: string,\n      ) {\n        getSession(self).queueDialog(handleClose => [\n          SearchResultsDialog,\n          {\n            model: self as LinearGenomeViewModel,\n            searchResults,\n            searchQuery,\n            handleClose,\n            assemblyName,\n          },\n        ])\n      },\n\n      /**\n       * #action\n       */\n      setNewView(bpPerPx: number, offsetPx: number) {\n        this.zoomTo(bpPerPx)\n        this.scrollTo(offsetPx)\n      },\n\n      /**\n       * #action\n       */\n      horizontallyFlip() {\n        self.displayedRegions = cast(\n          [...self.displayedRegions]\n            .reverse()\n            .map(region => ({ ...region, reversed: !region.reversed })),\n        )\n        this.scrollTo(self.totalBp / self.bpPerPx - self.offsetPx - self.width)\n      },\n\n      /**\n       * #action\n       */\n      showTrack(\n        trackId: string,\n        initialSnapshot = {},\n        displayInitialSnapshot = {},\n      ) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        if (!conf) {\n          throw new Error(`Could not resolve identifier \"${trackId}\"`)\n        }\n        const trackType = pluginManager.getTrackType(conf?.type)\n        if (!trackType) {\n          throw new Error(`Unknown track type ${conf.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          supportedDisplays.has(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `Could not find a compatible display for view type ${self.type}`,\n          )\n        }\n\n        const t = self.tracks.filter(t => t.configuration === conf)\n        if (t.length === 0) {\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: conf.type,\n            configuration: conf,\n            displays: [\n              {\n                type: displayConf.type,\n                configuration: displayConf,\n                ...displayInitialSnapshot,\n              },\n            ],\n          })\n          self.tracks.push(track)\n          return track\n        }\n        return t[0]\n      },\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const t = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => t.forEach(t => self.tracks.remove(t)))\n        return t.length\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      moveTrackDown(id: string) {\n        const idx = self.tracks.findIndex(v => v.id === id)\n        if (idx === -1) {\n          return\n        }\n\n        if (idx !== -1 && idx < self.tracks.length - 1) {\n          self.tracks.splice(idx, 2, self.tracks[idx + 1], self.tracks[idx])\n        }\n      },\n      /**\n       * #action\n       */\n      moveTrackUp(id: string) {\n        const idx = self.tracks.findIndex(track => track.id === id)\n        if (idx > 0) {\n          self.tracks.splice(idx - 1, 2, self.tracks[idx], self.tracks[idx - 1])\n        }\n      },\n      /**\n       * #action\n       */\n      moveTrackToTop(id: string) {\n        const idx = self.tracks.findIndex(track => track.id === id)\n        self.tracks = cast([\n          self.tracks[idx],\n          ...self.tracks.filter(track => track.id !== id),\n        ])\n      },\n      /**\n       * #action\n       */\n      moveTrackToBottom(id: string) {\n        const idx = self.tracks.findIndex(track => track.id === id)\n        self.tracks = cast([\n          ...self.tracks.filter(track => track.id !== id),\n          self.tracks[idx],\n        ])\n      },\n      /**\n       * #action\n       */\n      moveTrack(movingId: string, targetId: string) {\n        const oldIndex = self.tracks.findIndex(track => track.id === movingId)\n        if (oldIndex === -1) {\n          throw new Error(`Track ID ${movingId} not found`)\n        }\n        const newIndex = self.tracks.findIndex(track => track.id === targetId)\n        if (newIndex === -1) {\n          throw new Error(`Track ID ${targetId} not found`)\n        }\n\n        const tracks = self.tracks.filter((_, idx) => idx !== oldIndex)\n        tracks.splice(newIndex, 0, self.tracks[oldIndex])\n        self.tracks = cast(tracks)\n      },\n\n      /**\n       * #action\n       */\n      closeView() {\n        const parent = getContainingView(self)\n        if (parent) {\n          // I am embedded in a some other view\n          if (isViewContainer(parent)) {\n            parent.removeView(self)\n          }\n        } else {\n          // I am part of a session\n          getSession(self).removeView(self)\n        }\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = self.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          self.showTrack(trackId)\n          return true\n        }\n        return false\n      },\n\n      /**\n       * #action\n       */\n      setTrackLabels(setting: 'overlapping' | 'offset' | 'hidden') {\n        localStorage.setItem('lgv-trackLabels', setting)\n        self.trackLabels = setting\n      },\n\n      /**\n       * #action\n       */\n      setShowCenterLine(b: boolean) {\n        self.showCenterLine = b\n      },\n\n      /**\n       * #action\n       */\n      setDisplayedRegions(regions: Region[]) {\n        self.displayedRegions = cast(regions)\n        self.zoomTo(self.bpPerPx)\n      },\n\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #method\n       * Helper method for the fetchSequence.\n       * Retrieves the corresponding regions that were selected by the\n       * rubberband\n       *\n       * @param leftOffset - `object as {start, end, index, offset}`, offset = start\n       * of user drag\n       * @param rightOffset - `object as {start, end, index, offset}`,\n       * offset = end of user drag\n       * @returns array of Region[]\n       */\n      getSelectedRegions(leftOffset?: BpOffset, rightOffset?: BpOffset) {\n        const snap = getSnapshot(self)\n        const simView = Base1DView.create({\n          ...snap,\n          interRegionPaddingWidth: self.interRegionPaddingWidth,\n        })\n\n        simView.setVolatileWidth(self.width)\n        simView.moveTo(leftOffset, rightOffset)\n\n        return simView.dynamicBlocks.contentBlocks.map(region => ({\n          ...region,\n          start: Math.floor(region.start),\n          end: Math.ceil(region.end),\n        }))\n      },\n\n      /**\n       * #action\n       * schedule something to be run after the next time displayedRegions is\n       * set\n       */\n      afterDisplayedRegionsSet(cb: Function) {\n        self.afterDisplayedRegionsSetCallbacks.push(cb)\n      },\n\n      /**\n       * #action\n       */\n      horizontalScroll(distance: number) {\n        const oldOffsetPx = self.offsetPx\n        // newOffsetPx is the actual offset after the scroll is clamped\n        const newOffsetPx = self.scrollTo(self.offsetPx + distance)\n        return newOffsetPx - oldOffsetPx\n      },\n\n      /**\n       * #action\n       */\n      center() {\n        const centerBp = self.totalBp / 2\n        const centerPx = centerBp / self.bpPerPx\n        self.scrollTo(Math.round(centerPx - self.width / 2))\n      },\n\n      /**\n       * #action\n       */\n      showAllRegions() {\n        self.zoomTo(self.maxBpPerPx)\n        this.center()\n      },\n\n      /**\n       * #action\n       */\n      showAllRegionsInAssembly(assemblyName?: string) {\n        const session = getSession(self)\n        const { assemblyManager } = session\n        if (!assemblyName) {\n          const names = new Set(self.displayedRegions.map(r => r.assemblyName))\n          if (names.size > 1) {\n            session.notify(\n              `Can't perform operation with multiple assemblies currently`,\n            )\n            return\n          }\n          ;[assemblyName] = [...names]\n        }\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const { regions } = assembly\n          if (regions) {\n            this.setDisplayedRegions(regions)\n            self.zoomTo(self.maxBpPerPx)\n            this.center()\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setDraggingTrackId(idx?: string) {\n        self.draggingTrackId = idx\n      },\n\n      /**\n       * #action\n       */\n      setScaleFactor(factor: number) {\n        self.scaleFactor = factor\n      },\n\n      /**\n       * #action\n       * this \"clears the view\" and makes the view return to the import form\n       */\n      clearView() {\n        this.setDisplayedRegions([])\n        self.tracks.clear()\n        // it is necessary to run these after setting displayed regions empty\n        // or else model.offsetPx gets set to Infinity and breaks\n        // mobx-state-tree snapshot\n        self.scrollTo(0)\n        self.zoomTo(10)\n      },\n\n      /**\n       * #method\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import(\n          './svgcomponents/SVGLinearGenomeView'\n        )\n        const html = await renderToSvg(self as LinearGenomeViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      /**\n       * #action\n       * perform animated slide\n       */\n      function slide(viewWidths: number) {\n        const [animate, cancelAnimation] = springAnimate(\n          self.offsetPx,\n          self.offsetPx + self.width * viewWidths,\n          self.scrollTo,\n          undefined,\n          undefined,\n          200,\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { slide }\n    })\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      /**\n       * #action\n       * perform animated zoom\n       */\n      function zoom(targetBpPerPx: number) {\n        self.zoomTo(self.bpPerPx)\n        if (\n          // already zoomed all the way in\n          (targetBpPerPx < self.bpPerPx && self.bpPerPx === self.minBpPerPx) ||\n          // already zoomed all the way out\n          (targetBpPerPx > self.bpPerPx && self.bpPerPx === self.maxBpPerPx)\n        ) {\n          return\n        }\n        const factor = self.bpPerPx / targetBpPerPx\n        const [animate, cancelAnimation] = springAnimate(\n          1,\n          factor,\n          self.setScaleFactor,\n          () => {\n            self.zoomTo(targetBpPerPx)\n            self.setScaleFactor(1)\n          },\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { zoom }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get canShowCytobands() {\n        return self.displayedRegions.length === 1 && this.anyCytobandsExist\n      },\n      /**\n       * #getter\n       */\n      get showCytobands() {\n        return this.canShowCytobands && self.showCytobandsSetting\n      },\n      /**\n       * #getter\n       */\n      get anyCytobandsExist() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames.some(\n          a => assemblyManager.get(a)?.cytobands?.length,\n        )\n      },\n      /**\n       * #getter\n       * the cytoband is displayed to the right of the chromosome name, and\n       * that offset is calculated manually with this method\n       */\n      get cytobandOffset() {\n        return this.showCytobands\n          ? measureText(self.displayedRegions[0].refName, 12) + 15\n          : 0\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * return the view menu items\n       */\n      menuItems(): MenuItem[] {\n        const { canShowCytobands, showCytobands } = self\n        const session = getSession(self)\n        const menuItems: MenuItem[] = [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          ...(isSessionWithAddTracks(session)\n            ? [\n                {\n                  label: 'Sequence search',\n                  icon: SearchIcon,\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SequenceSearchDialog,\n                      { model: self, handleClose },\n                    ])\n                  },\n                },\n              ]\n            : []),\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                { model: self, handleClose },\n              ])\n            },\n          },\n          {\n            label: 'Open track selector',\n            onClick: self.activateTrackSelector,\n            icon: TrackSelectorIcon,\n          },\n          {\n            label: 'Horizontally flip',\n            icon: SyncAltIcon,\n            onClick: self.horizontallyFlip,\n          },\n          {\n            label: 'Color by CDS',\n            type: 'checkbox',\n            checked: self.colorByCDS,\n            icon: PaletteIcon,\n            onClick: () => self.setColorByCDS(!self.colorByCDS),\n          },\n          {\n            label: 'Show...',\n            icon: VisibilityIcon,\n            subMenu: [\n              {\n                label: 'Show all regions in assembly',\n                onClick: self.showAllRegionsInAssembly,\n              },\n              {\n                label: 'Show center line',\n                type: 'checkbox',\n                checked: self.showCenterLine,\n                onClick: () => self.setShowCenterLine(!self.showCenterLine),\n              },\n              {\n                label: 'Show header',\n                type: 'checkbox',\n                checked: !self.hideHeader,\n                onClick: () => self.setHideHeader(!self.hideHeader),\n              },\n\n              {\n                label: 'Show header overview',\n                type: 'checkbox',\n                checked: !self.hideHeaderOverview,\n                onClick: () =>\n                  self.setHideHeaderOverview(!self.hideHeaderOverview),\n                disabled: self.hideHeader,\n              },\n              {\n                label: 'Show no tracks active button',\n                type: 'checkbox',\n                checked: !self.hideNoTracksActive,\n                onClick: () =>\n                  self.setHideNoTracksActive(!self.hideNoTracksActive),\n              },\n              {\n                label: 'Show guidelines',\n                type: 'checkbox',\n                checked: self.showGridlines,\n                onClick: () => self.setShowGridlines(!self.showGridlines),\n              },\n              ...(canShowCytobands\n                ? [\n                    {\n                      label: 'Show ideogram',\n                      type: 'checkbox' as const,\n                      checked: self.showCytobands,\n                      onClick: () => self.setShowCytobands(!showCytobands),\n                    },\n                  ]\n                : []),\n            ],\n          },\n          {\n            label: 'Track labels',\n            icon: LabelIcon,\n            subMenu: [\n              {\n                label: 'Overlapping',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabelsSetting === 'overlapping',\n                onClick: () => self.setTrackLabels('overlapping'),\n              },\n              {\n                label: 'Offset',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabelsSetting === 'offset',\n                onClick: () => self.setTrackLabels('offset'),\n              },\n              {\n                label: 'Hidden',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabelsSetting === 'hidden',\n                onClick: () => self.setTrackLabels('hidden'),\n              },\n            ],\n          },\n        ]\n\n        // add track's view level menu options\n        for (const [key, value] of self.trackTypeActions.entries()) {\n          if (value.length) {\n            menuItems.push(\n              { type: 'divider' },\n              { type: 'subHeader', label: key },\n            )\n            value.forEach(action => menuItems.push(action))\n          }\n        }\n\n        return menuItems\n      },\n    }))\n    .views(self => {\n      let currentlyCalculatedStaticBlocks: BlockSet | undefined\n      let stringifiedCurrentlyCalculatedStaticBlocks = ''\n      return {\n        /**\n         * #getter\n         * static blocks are an important concept jbrowse uses to avoid\n         * re-rendering when you scroll to the side. when you horizontally\n         * scroll to the right, old blocks to the left may be removed, and new\n         * blocks may be instantiated on the right. tracks may use the static\n         * blocks to render their data for the region represented by the block\n         */\n        get staticBlocks() {\n          const ret = calculateStaticBlocks(self)\n          const sret = JSON.stringify(ret)\n          if (stringifiedCurrentlyCalculatedStaticBlocks !== sret) {\n            currentlyCalculatedStaticBlocks = ret\n            stringifiedCurrentlyCalculatedStaticBlocks = sret\n          }\n          return currentlyCalculatedStaticBlocks!\n        },\n        /**\n         * #getter\n         * dynamic blocks represent the exact coordinates of the currently\n         * visible genome regions on the screen. they are similar to static\n         * blocks, but static blocks can go offscreen while dynamic blocks\n         * represent exactly what is on screen\n         */\n        get dynamicBlocks() {\n          return calculateDynamicBlocks(self)\n        },\n        /**\n         * #getter\n         * rounded dynamic blocks are dynamic blocks without fractions of bp\n         */\n        get roundedDynamicBlocks() {\n          return this.dynamicBlocks.contentBlocks.map(\n            block =>\n              ({\n                ...block,\n                start: Math.floor(block.start),\n                end: Math.ceil(block.end),\n              }) as BaseBlock,\n          )\n        },\n\n        /**\n         * #getter\n         * a single \"combo-locstring\" representing all the regions visible on\n         * the screen\n         */\n        get visibleLocStrings() {\n          return calculateVisibleLocStrings(this.dynamicBlocks.contentBlocks)\n        },\n\n        /**\n         * #getter\n         * same as visibleLocStrings, but only updated every 300ms\n         */\n        get coarseVisibleLocStrings() {\n          return calculateVisibleLocStrings(self.coarseDynamicBlocks)\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCoarseDynamicBlocks(blocks: BlockSet) {\n        self.coarseDynamicBlocks = blocks.contentBlocks\n        self.coarseTotalBp = blocks.totalBp\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.initialized) {\n                this.setCoarseDynamicBlocks(self.dynamicBlocks)\n              }\n            },\n            { delay: 150 },\n          ),\n        )\n\n        addDisposer(\n          self,\n          autorun(() => {\n            const s = (s: unknown) => JSON.stringify(s)\n            const { showCytobandsSetting, showCenterLine, colorByCDS } = self\n            localStorageSetItem('lgv-showCytobands', s(showCytobandsSetting))\n            localStorageSetItem('lgv-showCenterLine', s(showCenterLine))\n            localStorageSetItem('lgv-colorByCDS', s(colorByCDS))\n          }),\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * offset is the base-pair-offset in the displayed region, index is the\n       * index of the displayed region in the linear genome view\n       *\n       * @param start - object as `{start, end, offset, index}`\n       * @param end - object as `{start, end, offset, index}`\n       */\n      moveTo(start?: BpOffset, end?: BpOffset) {\n        moveTo(self, start, end)\n      },\n\n      /**\n       * #action\n       * Navigate to the given locstring, will change displayed regions if\n       * needed, and wait for assemblies to be initialized\n       *\n       * @param input - e.g. \"chr1:1-100\", \"chr1:1-100 chr2:1-100\", \"chr 1 100\"\n       * @param optAssemblyName - (optional) the assembly name to use when\n       * navigating to the locstring\n       */\n      async navToLocString(input: string, optAssemblyName?: string) {\n        const { assemblyNames } = self\n        const { assemblyManager } = getSession(self)\n        const { isValidRefName } = assemblyManager\n        const assemblyName = optAssemblyName || assemblyNames[0]\n        if (assemblyName) {\n          // wait before isValidRefName can be called\n          await assemblyManager.waitForAssembly(assemblyName)\n        }\n\n        return this.navToLocations(\n          parseLocStrings(input, assemblyName, isValidRefName),\n          assemblyName,\n        )\n      },\n\n      /**\n       * #action\n       * Performs a text index search, and navigates to it immediately if a\n       * single result is returned. Will pop up a search dialog if multiple\n       * results are returned\n       */\n      async navToSearchString({\n        input,\n        assembly,\n      }: {\n        input: string\n        assembly: Assembly\n      }) {\n        await handleSelectedRegion({\n          input,\n          assembly,\n          model: self as LinearGenomeViewModel,\n        })\n      },\n\n      /**\n       * #action\n       * Similar to `navToLocString`, but accepts parsed location objects\n       * instead of strings. Will try to perform `setDisplayedRegions` if\n       * changing regions\n       */\n      async navToLocations(\n        parsedLocStrings: ParsedLocString[],\n        assemblyName?: string,\n      ) {\n        const { assemblyManager } = getSession(self)\n        await when(() => self.volatileWidth !== undefined)\n\n        const locations = await generateLocations(\n          parsedLocStrings,\n          assemblyManager,\n          assemblyName,\n        )\n\n        if (locations.length === 1) {\n          const loc = locations[0]\n          const { reversed, parentRegion, start, end } = loc\n          self.setDisplayedRegions([{ reversed, ...parentRegion }])\n\n          this.navTo({\n            ...loc,\n            start: clamp(start ?? 0, 0, parentRegion.end),\n            end: clamp(end ?? parentRegion.end, 0, parentRegion.end),\n          })\n        } else {\n          self.setDisplayedRegions(\n            // @ts-expect-error\n            locations.map(r => (r.start === undefined ? r.parentRegion : r)),\n          )\n          self.showAllRegions()\n        }\n      },\n\n      /**\n       * #action\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Will not try to change displayed regions, use\n       * `navToLocations` instead. Only navigates to a location if it is\n       * entirely within a displayedRegion. Navigates to the first matching\n       * location encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param query - a proposed location to navigate to\n       */\n      navTo(query: NavLocation) {\n        this.navToMultiple([query])\n      },\n\n      /**\n       * #action\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Will not try to change displayed regions, use\n       * navToLocations instead. Only navigates to a location if it is entirely\n       * within a displayedRegion. Navigates to the first matching location\n       * encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param locations - proposed location to navigate to\n       */\n      navToMultiple(locations: NavLocation[]) {\n        if (\n          locations.some(\n            l =>\n              l.start !== undefined && l.end !== undefined && l.start > l.end,\n          )\n        ) {\n          throw new Error('found start greater than end')\n        }\n        const f1 = locations.at(0)\n        const f2 = locations.at(-1)\n        if (!f1 || !f2) {\n          return\n        }\n        const a = self.assemblyNames[0]\n        const { assemblyManager } = getSession(self)\n        const assembly1 = assemblyManager.get(f1.assemblyName || a)\n        const assembly2 = assemblyManager.get(f2.assemblyName || a)\n        const ref1 = assembly1?.getCanonicalRefName(f1.refName) || f1.refName\n        const ref2 = assembly2?.getCanonicalRefName(f2.refName) || f2.refName\n        const r1 = self.displayedRegions.find(r => r.refName === ref1)\n        const r2 = findLast(self.displayedRegions, r => r.refName === ref2)\n        if (!r1) {\n          throw new Error(`could not find a region with refName \"${ref1}\"`)\n        }\n        if (!r2) {\n          throw new Error(`could not find a region with refName \"${ref2}\"`)\n        }\n\n        const s1 = f1.start === undefined ? r1.start : f1.start\n        const e1 = f1.end === undefined ? r1.end : f1.end\n        const s2 = f2.start === undefined ? r2.start : f2.start\n        const e2 = f2.end === undefined ? r2.end : f2.end\n\n        const index = self.displayedRegions.findIndex(\n          r =>\n            ref1 === r.refName &&\n            s1 >= r.start &&\n            s1 <= r.end &&\n            e1 <= r.end &&\n            e1 >= r.start,\n        )\n\n        const index2 = self.displayedRegions.findIndex(\n          r =>\n            ref2 === r.refName &&\n            s2 >= r.start &&\n            s2 <= r.end &&\n            e2 <= r.end &&\n            e2 >= r.start,\n        )\n\n        if (index === -1 || index2 === -1) {\n          throw new Error(\n            `could not find a region that contained \"${locations.map(l =>\n              assembleLocString(l),\n            )}\"`,\n          )\n        }\n\n        const sd = self.displayedRegions[index]\n        const ed = self.displayedRegions[index2]\n\n        this.moveTo(\n          {\n            index,\n            offset: sd.reversed ? sd.end - e1 : s1 - sd.start,\n          },\n          {\n            index: index2,\n            offset: ed.reversed ? ed.end - s2 : e2 - ed.start,\n          },\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      rubberBandMenuItems(): MenuItem[] {\n        return [\n          {\n            label: 'Zoom to region',\n            icon: ZoomInIcon,\n            onClick: () => self.moveTo(self.leftOffset, self.rightOffset),\n          },\n          {\n            label: 'Get sequence',\n            icon: MenuOpenIcon,\n            onClick: () =>\n              getSession(self).queueDialog(handleClose => [\n                GetSequenceDialog,\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                { model: self as any, handleClose },\n              ]),\n          },\n        ]\n      },\n\n      /**\n       * #method\n       */\n      bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      }: {\n        refName: string\n        coord: number\n        regionNumber?: number\n      }) {\n        return bpToPx({ refName, coord, regionNumber, self })\n      },\n\n      /**\n       * #method\n       * scrolls the view to center on the given bp. if that is not in any of\n       * the displayed regions, does nothing\n       *\n       * @param coord - basepair at which you want to center the view\n       * @param refName - refName of the displayedRegion you are centering at\n       * @param regionNumber - index of the displayedRegion\n       */\n      centerAt(coord: number, refName: string, regionNumber?: number) {\n        const centerPx = this.bpToPx({\n          refName,\n          coord,\n          regionNumber,\n        })\n        if (centerPx !== undefined) {\n          self.scrollTo(Math.round(centerPx.offsetPx - self.width / 2))\n        }\n      },\n\n      /**\n       * #method\n       */\n      pxToBp(px: number) {\n        return pxToBp(self, px)\n      },\n\n      /**\n       * #getter\n       */\n      get centerLineInfo() {\n        return self.displayedRegions.length > 0\n          ? this.pxToBp(self.width / 2)\n          : undefined\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        function handler(e: KeyboardEvent) {\n          const session = getSession(self)\n          if (session.focusedViewId === self.id && (e.ctrlKey || e.metaKey)) {\n            if (e.code === 'ArrowLeft') {\n              e.preventDefault()\n              self.slide(-0.9)\n            } else if (e.code === 'ArrowRight') {\n              e.preventDefault()\n              self.slide(0.9)\n            } else if (e.code === 'ArrowUp' && self.scaleFactor === 1) {\n              e.preventDefault()\n              self.zoom(self.bpPerPx / 2)\n            } else if (e.code === 'ArrowDown' && self.scaleFactor === 1) {\n              e.preventDefault()\n              self.zoom(self.bpPerPx * 2)\n            }\n          }\n        }\n        document.addEventListener('keydown', handler)\n        addDisposer(self, () => {\n          document.removeEventListener('keydown', handler)\n        })\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      if (!snap) {\n        return snap\n      }\n      const { highlight, ...rest } = snap\n      return {\n        highlight:\n          Array.isArray(highlight) || highlight === undefined\n            ? highlight\n            : [highlight],\n        ...rest,\n      }\n    })\n}\n\nexport type LinearGenomeViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearGenomeViewModel = Instance<LinearGenomeViewStateModel>\n\nexport {\n  default as ReactComponent,\n  default as LinearGenomeView,\n} from './components/LinearGenomeView'\n\nexport { default as RefNameAutocomplete } from './components/RefNameAutocomplete'\nexport { default as SearchBox } from './components/SearchBox'\nexport { default as ZoomControls } from './components/ZoomControls'\n\nexport { renderToSvg } from './svgcomponents/SVGLinearGenomeView'\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ViewType } from '@jbrowse/core/pluggableElementTypes'\nimport { stateModelFactory } from './model'\n\nexport default function LinearGenomeViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearGenomeView',\n      displayName: 'Linear genome view',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearGenomeView')),\n    })\n  })\n}\n\nexport * from './model'\n","import React from 'react'\nimport { useTheme } from '@mui/material'\nimport { stripAlpha } from '@jbrowse/core/util'\n\nexport default function SVGBackground({\n  width,\n  height,\n  shift,\n}: {\n  width: number\n  height: number\n  shift: number\n}) {\n  const theme = useTheme()\n  return (\n    <rect\n      width={width + shift * 2}\n      height={height}\n      fill={stripAlpha(theme.palette.background.default)}\n    />\n  )\n}\n","import React from 'react'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\n// SVG component, region separator\nexport default function SVGRegionSeparators({\n  model,\n  height,\n}: {\n  height: number\n  model: LGV\n}) {\n  const { dynamicBlocks, offsetPx, interRegionPaddingWidth } = model\n  return (\n    <>\n      {dynamicBlocks.contentBlocks.slice(1).map(block => (\n        <rect\n          key={block.key}\n          x={block.offsetPx - offsetPx - interRegionPaddingWidth}\n          width={interRegionPaddingWidth}\n          y={0}\n          height={height}\n          fill=\"grey\"\n        />\n      ))}\n    </>\n  )\n}\n","import React from 'react'\nimport { useTheme } from '@mui/material'\nimport { coarseStripHTML, stripAlpha } from '@jbrowse/core/util'\n\nexport default function SVGTrackLabel({\n  trackLabels,\n  trackName,\n  fontSize,\n  trackLabelOffset,\n  x,\n}: {\n  trackName: string\n  trackLabels: string\n  fontSize: number\n  trackLabelOffset: number\n  x: number\n}) {\n  const theme = useTheme()\n  const fill = stripAlpha(theme.palette.text.primary)\n  const xoff = trackLabels === 'overlay' ? 5 : 0\n  const yoff = trackLabels === 'offset' ? 5 : 0\n  const name = coarseStripHTML(trackName)\n  return trackLabels !== 'none' ? (\n    <g>\n      {trackLabels === 'left' ? (\n        <text\n          x={trackLabelOffset - 40}\n          y={20}\n          fill={fill}\n          fontSize={fontSize}\n          dominantBaseline=\"hanging\"\n          textAnchor=\"end\"\n        >\n          {name}\n        </text>\n      ) : (\n        <text\n          x={x + xoff}\n          y={yoff}\n          fill={fill}\n          fontSize={fontSize}\n          dominantBaseline=\"hanging\"\n        >\n          {name}\n        </text>\n      )}\n    </g>\n  ) : null\n}\n","import React from 'react'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { getSession } from '@jbrowse/core/util'\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport SVGRegionSeparators from './SVGRegionSeparators'\nimport SVGTrackLabel from './SVGTrackLabel'\n\ntype LGV = LinearGenomeViewModel\n\ninterface DisplayResult {\n  track: {\n    configuration: AnyConfigurationModel\n    displays: { height: number }[]\n  }\n  result: string\n}\n\n// SVG component, tracks\nexport default function SVGTracks({\n  displayResults,\n  model,\n  offset,\n  textHeight,\n  fontSize,\n  trackLabels = 'offset',\n  trackLabelOffset = 0,\n}: {\n  displayResults: DisplayResult[]\n  model: LGV\n  offset: number\n  textHeight: number\n  fontSize: number\n  trackLabels?: string\n  trackLabelOffset?: number\n}) {\n  const session = getSession(model)\n  const textOffset = trackLabels === 'offset' ? textHeight : 0\n  return (\n    <>\n      {displayResults.map(({ track, result }) => {\n        const current = offset\n        const conf = track.configuration\n        const trackName = getTrackName(conf, session)\n        const display = track.displays[0]\n        const x = Math.max(-model.offsetPx, 0)\n        offset += display.height + textOffset\n        return (\n          <g key={conf.trackId} transform={`translate(0 ${current})`}>\n            <g transform={`translate(${trackLabelOffset} ${textOffset})`}>\n              <SVGRegionSeparators model={model} height={display.height} />\n              {result}\n            </g>\n            <SVGTrackLabel\n              trackName={trackName}\n              fontSize={fontSize}\n              trackLabels={trackLabels}\n              trackLabelOffset={trackLabelOffset}\n              x={x}\n            />\n          </g>\n        )\n      })}\n    </>\n  )\n}\n","import React from 'react'\nimport { getTickDisplayStr, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\n// locals\nimport { makeTicks } from '../util'\n\nimport { LinearGenomeViewModel } from '..'\nimport SVGRegionSeparators from './SVGRegionSeparators'\n\ntype LGV = LinearGenomeViewModel\n\nfunction Ruler({\n  start,\n  end,\n  bpPerPx,\n  reversed = false,\n  major = true,\n  minor = true,\n  hideText = false,\n}: {\n  start: number\n  end: number\n  bpPerPx: number\n  reversed?: boolean\n  major?: boolean\n  minor?: boolean\n  hideText?: boolean\n}) {\n  const ticks = makeTicks(start, end, bpPerPx, major, minor)\n  const theme = useTheme()\n  const c = stripAlpha(theme.palette.text.secondary)\n  return (\n    <>\n      {ticks.map(tick => {\n        const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n        return (\n          <line\n            key={'tick-' + tick.base}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={tick.type === 'major' ? 6 : 4}\n            strokeWidth={1}\n            stroke={c}\n          />\n        )\n      })}\n      {!hideText\n        ? ticks\n            .filter(tick => tick.type === 'major')\n            .map(tick => {\n              const x =\n                (reversed ? end - tick.base : tick.base - start) / bpPerPx\n              return (\n                <text\n                  key={`label-${tick.base}`}\n                  x={x - 3}\n                  y={7 + 11}\n                  fontSize={11}\n                  fill={c}\n                >\n                  {getTickDisplayStr(tick.base + 1, bpPerPx)}\n                </text>\n              )\n            })\n        : null}\n    </>\n  )\n}\n\nexport default function SVGRuler({\n  model,\n  fontSize,\n}: {\n  model: LGV\n  fontSize: number\n}) {\n  const {\n    dynamicBlocks: { contentBlocks },\n    offsetPx: viewOffsetPx,\n    bpPerPx,\n  } = model\n  const renderRuler = contentBlocks.length < 5\n  const theme = useTheme()\n  const c = stripAlpha(theme.palette.text.primary)\n  return (\n    <>\n      <SVGRegionSeparators model={model} height={30} />\n      {contentBlocks.map(block => {\n        const { start, end, key, reversed, offsetPx, refName, widthPx } = block\n        const offset = offsetPx - viewOffsetPx\n        const clipid = `clip-${key}`\n        return (\n          <g key={key}>\n            <defs>\n              <clipPath id={clipid}>\n                <rect x={0} y={0} width={widthPx} height={100} />\n              </clipPath>\n            </defs>\n            <g transform={`translate(${offset} 0)`}>\n              <g clipPath={`url(#${clipid})`}>\n                <text x={4} y={fontSize} fontSize={fontSize} fill={c}>\n                  {refName}\n                </text>\n                <g transform=\"translate(0 20)\">\n                  <Ruler\n                    hideText={!renderRuler}\n                    start={start}\n                    end={end}\n                    bpPerPx={bpPerPx}\n                    reversed={reversed}\n                  />\n                </g>\n              </g>\n            </g>\n          </g>\n        )\n      })}\n    </>\n  )\n}\n","import React from 'react'\nimport { getBpDisplayStr, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nexport default function SVGScalebar({\n  model,\n  fontSize,\n}: {\n  model: LGV\n  fontSize: number\n}) {\n  const {\n    offsetPx,\n    dynamicBlocks: { totalWidthPxWithoutBorders: totalWidthPx, totalBp },\n  } = model\n  const theme = useTheme()\n  const displayBp = getBpDisplayStr(totalBp)\n  const x0 = Math.max(-offsetPx, 0)\n  const x1 = x0 + totalWidthPx\n  const c = stripAlpha(theme.palette.text.secondary)\n  const x = x0 + (x1 - x0) / 2\n  const y = fontSize\n  return (\n    <>\n      <line x1={x0} x2={x1} y1={10} y2={10} stroke={c} />\n      <line x1={x0} x2={x0} y1={5} y2={15} stroke={c} />\n      <line x1={x1} x2={x1} y1={5} y2={15} stroke={c} />\n      <text\n        x={x}\n        y={y}\n        textAnchor=\"middle\"\n        dominantBaseline=\"hanging\"\n        fontSize={fontSize}\n        fill={c}\n      >\n        {displayBp}\n      </text>\n    </>\n  )\n}\n","import React from 'react'\nimport { getSession, stripAlpha } from '@jbrowse/core/util'\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport { useTheme } from '@mui/material'\n\n// locals\nimport { LinearGenomeViewModel, HEADER_OVERVIEW_HEIGHT } from '..'\nimport Cytobands from '../components/Cytobands'\nimport SVGRuler from './SVGRuler'\nimport SVGScalebar from './SVGScalebar'\nimport OverviewScalebarPolygon from '../components/OverviewScalebarPolygon'\n\nexport default function SVGHeader({\n  model,\n  fontSize,\n  cytobandHeight,\n  rulerHeight,\n}: {\n  model: LinearGenomeViewModel\n  rulerHeight: number\n  fontSize: number\n  cytobandHeight: number\n}) {\n  const { width, assemblyNames, showCytobands, displayedRegions } = model\n  const { assemblyManager } = getSession(model)\n  const assemblyName = assemblyNames.length > 1 ? '' : assemblyNames[0]\n  const assembly = assemblyManager.get(assemblyName)\n  const theme = useTheme()\n  const c = stripAlpha(theme.palette.text.primary)\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n  const visibleRegions = model.dynamicBlocks.contentBlocks\n  if (!visibleRegions.length) {\n    return null\n  }\n\n  overview.setVolatileWidth(width)\n  overview.showAllRegions()\n  const block = overview.dynamicBlocks.contentBlocks[0]\n  const first = visibleRegions.at(0)!\n  const last = visibleRegions.at(-1)!\n  const firstOverviewPx =\n    overview.bpToPx({\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0\n\n  const lastOverviewPx =\n    overview.bpToPx({\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0\n  const y = +showCytobands * cytobandHeight\n  return (\n    <g id=\"header\">\n      <text x={0} y={0} dominantBaseline=\"hanging\" fontSize={fontSize} fill={c}>\n        {assemblyName}\n      </text>\n\n      {showCytobands ? (\n        <g transform={`translate(0 ${rulerHeight})`}>\n          <Cytobands overview={overview} assembly={assembly} block={block} />\n          <rect\n            stroke=\"red\"\n            fill=\"rgb(255,0,0)\"\n            fillOpacity={0.1}\n            width={Math.max(lastOverviewPx - firstOverviewPx, 0.5)}\n            height={HEADER_OVERVIEW_HEIGHT - 1}\n            x={firstOverviewPx}\n            y={0.5}\n          />\n          <g transform={`translate(0,${HEADER_OVERVIEW_HEIGHT})`}>\n            <OverviewScalebarPolygon\n              overview={overview}\n              model={model}\n              useOffset={false}\n            />\n          </g>\n        </g>\n      ) : null}\n\n      <g transform={`translate(0 ${fontSize + y})`}>\n        <SVGScalebar model={model} fontSize={fontSize} />\n      </g>\n      <g transform={`translate(0 ${rulerHeight + y})`}>\n        <SVGRuler model={model} fontSize={fontSize} />\n      </g>\n    </g>\n  )\n}\n","/* eslint-disable react-refresh/only-export-components */\nimport React from 'react'\nimport { when } from 'mobx'\nimport {\n  getSession,\n  max,\n  measureText,\n  renderToStaticMarkup,\n} from '@jbrowse/core/util'\nimport { ThemeProvider } from '@mui/material'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { getRoot } from 'mobx-state-tree'\n\n// locals\nimport { LinearGenomeViewModel, ExportSvgOptions } from '..'\nimport SVGBackground from './SVGBackground'\nimport SVGTracks from './SVGTracks'\nimport SVGHeader from './SVGHeader'\nimport { totalHeight } from './util'\n\ntype LGV = LinearGenomeViewModel\n\n// render LGV to SVG\nexport async function renderToSvg(model: LGV, opts: ExportSvgOptions) {\n  await when(() => model.initialized)\n  const {\n    textHeight = 18,\n    headerHeight = 40,\n    rulerHeight = 50,\n    fontSize = 13,\n    cytobandHeight = 100,\n    trackLabels = 'offset',\n    themeName = 'default',\n    Wrapper = ({ children }) => children,\n  } = opts\n  const session = getSession(model)\n  const { allThemes } = session\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const { createRootFn } = getRoot<any>(model)\n  const theme = allThemes?.()[themeName]\n  const { width, tracks, showCytobands } = model\n  const shift = 50\n  const c = +showCytobands * cytobandHeight\n  const offset = headerHeight + rulerHeight + c + 10\n  const height = totalHeight(tracks, textHeight, trackLabels) + offset + 100\n  const displayResults = await Promise.all(\n    tracks.map(async track => {\n      const display = track.displays[0]\n      await when(() => !display.renderProps().notReady)\n      return { track, result: await display.renderSvg({ ...opts, theme }) }\n    }),\n  )\n  const trackLabelMaxLen =\n    max(\n      tracks.map(t =>\n        measureText(getTrackName(t.configuration, session), fontSize),\n      ),\n      0,\n    ) + 40\n  const trackLabelOffset = trackLabels === 'left' ? trackLabelMaxLen : 0\n  const w = width + trackLabelOffset\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <ThemeProvider theme={createJBrowseTheme(theme)}>\n      <Wrapper>\n        <svg\n          width={w}\n          height={height}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n          viewBox={[0, 0, w + shift * 2, height].toString()}\n        >\n          <SVGBackground width={w} height={height} shift={shift} />\n          <g transform={`translate(${shift} 0)`}>\n            <g transform={`translate(${trackLabelOffset})`}>\n              <SVGHeader\n                model={model}\n                fontSize={fontSize}\n                rulerHeight={rulerHeight}\n                cytobandHeight={cytobandHeight}\n              />\n            </g>\n            <SVGTracks\n              textHeight={textHeight}\n              fontSize={fontSize}\n              model={model}\n              displayResults={displayResults}\n              offset={offset}\n              trackLabels={trackLabels}\n              trackLabelOffset={trackLabelOffset}\n            />\n          </g>\n        </svg>\n      </Wrapper>\n    </ThemeProvider>,\n    createRootFn,\n  )\n}\n\nexport { default as SVGRuler } from './SVGRuler'\nexport { default as SVGTracks } from './SVGTracks'\n","import { sum } from '@jbrowse/core/util'\n\ninterface Display {\n  height: number\n}\ninterface Track {\n  displays: Display[]\n}\n\nexport function totalHeight(\n  tracks: Track[],\n  textHeight: number,\n  trackLabels: string,\n) {\n  return sum(\n    tracks.map(\n      t =>\n        t.displays[0].height +\n        (['none', 'left'].includes(trackLabels) ? 0 : textHeight),\n    ),\n  )\n}\n","import {\n  AssemblyManager,\n  ParsedLocString,\n  parseLocString,\n} from '@jbrowse/core/util'\n\n/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = Number.parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  start: number,\n  end: number,\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n\n  let minBase = start\n  let maxBase = end\n  if (minBase === null || maxBase === null) {\n    return []\n  }\n\n  if (bpPerPx < 0) {\n    ;[minBase, maxBase] = [maxBase, minBase]\n  }\n\n  // add 20px additional on the right and left to allow us to draw the ends\n  // of labels that lie a little outside our region\n  minBase -= Math.abs(20 * bpPerPx) - 1\n  maxBase += Math.abs(20 * bpPerPx) + 1\n\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  let index = 0\n  const ticks = []\n  for (\n    let base = Math.floor(minBase / iterPitch) * iterPitch;\n    base < Math.ceil(maxBase / iterPitch) * iterPitch + 1;\n    base += iterPitch\n  ) {\n    if (emitMinor && base % (gridPitch.majorPitch * 2)) {\n      ticks.push({ type: 'minor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor && !(base % (gridPitch.majorPitch * 2))) {\n      ticks.push({ type: 'major', base: base - 1, index })\n      index += 1\n    }\n  }\n  return ticks\n}\n\n/**\n * Generate location objects for a set of parsed locstrings, which includes\n * translating the refNames to assembly-canonical refNames and adding the\n * 'parentRegion'\n *\n * Used by navToLocations and navToLocString\n */\nexport async function generateLocations(\n  regions: ParsedLocString[] = [],\n  assemblyManager: AssemblyManager,\n  assemblyName?: string,\n) {\n  return Promise.all(\n    regions.map(async region => {\n      const asmName = region.assemblyName || assemblyName\n      if (!asmName) {\n        throw new Error('no assembly provided')\n      }\n      const asm = await assemblyManager.waitForAssembly(asmName)\n      const { refName } = region\n      if (!asm) {\n        throw new Error(`assembly ${asmName} not found`)\n      }\n      const { regions } = asm\n      if (!regions) {\n        throw new Error(`regions not loaded yet for ${asmName}`)\n      }\n      const canonicalRefName = asm.getCanonicalRefName(region.refName)\n      if (!canonicalRefName) {\n        throw new Error(`Could not find refName ${refName} in ${asm.name}`)\n      }\n      const parentRegion = regions.find(r => r.refName === canonicalRefName)\n      if (!parentRegion) {\n        throw new Error(`Could not find refName ${refName} in ${asmName}`)\n      }\n\n      return {\n        ...(region as Omit<typeof region, symbol>),\n        assemblyName: asmName,\n        parentRegion,\n      }\n    }),\n  )\n}\n\n/**\n * Parses locString or space separated set of locStrings into location objects\n * Example inputs:\n * \"chr1\"\n * \"chr1:1-100\"\n * \"chr1:1..100\"\n * \"chr1 chr2\"\n * \"chr1:1-100 chr2:1-100\"\n * \"chr1 100 200\" equivalent to \"chr1:1-100\"\n *\n * Used by navToLocString\n */\nexport function parseLocStrings(\n  input: string,\n  assemblyName: string,\n  isValidRefName: (str: string, assemblyName: string) => boolean,\n) {\n  const inputs = input\n    .split(/(\\s+)/)\n    .map(f => f.trim())\n    .filter(f => !!f)\n  // first try interpreting as a whitespace-separated sequence of\n  // multiple locstrings\n  try {\n    return inputs.map(loc =>\n      parseLocString(loc, ref => isValidRefName(ref, assemblyName)),\n    )\n  } catch (e) {\n    // if this fails, try interpreting as a whitespace-separated refname,\n    // start, end if start and end are integer inputs\n    const [refName, start, end] = inputs\n    if (\n      `${e}`.match(/Unknown reference sequence/) &&\n      Number.isInteger(+start) &&\n      Number.isInteger(+end)\n    ) {\n      return [\n        parseLocString(refName + ':' + start + '..' + end, ref =>\n          isValidRefName(ref, assemblyName),\n        ),\n      ]\n    } else {\n      throw e\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BaseLinearDisplay\n * #category display\n *\n * `BaseLinearDisplay` is a \"base\" config that is extended by other configs including\n * - `LinearBasicDisplay` (used for feature tracks, etc)\n * - `LinearBareDisplay` (more stripped down than even the basic display, not\n *   commonly used)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst baseLinearDisplayConfigSchema = ConfigurationSchema(\n  'BaseLinearDisplay',\n  {\n    /**\n     * #slot\n     */\n    maxFeatureScreenDensity: {\n      type: 'number',\n      description:\n        'maximum features per pixel that is displayed in the view, used if byte size estimates not available',\n      defaultValue: 0.3,\n    },\n    /**\n     * #slot\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      defaultValue: 1_000_000,\n      description:\n        \"maximum data to attempt to download for a given track, used if adapter doesn't specify one\",\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      defaultValue: 100,\n      description: 'default height for the track',\n    },\n    /**\n     * #slot\n     */\n    mouseover: {\n      type: 'string',\n      description: 'text to display when the cursor hovers over a feature',\n      defaultValue: `jexl:get(feature,'name')`,\n\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     * config jexlFilters are deferred evaluated so they are prepended with\n     * jexl at runtime rather than being stored with jexl in the config\n     */\n    jexlFilters: {\n      type: 'stringArray',\n      description:\n        'default set of jexl filters to apply to a track. note: these do not use the jexl prefix because they have a deferred evaluation system',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'displayId',\n  },\n)\n\nexport default baseLinearDisplayConfigSchema\n","// takes an array or Map or Set (anything iterable with values()) of Maps\n// and lets you query them as one Map\nexport default class CompositeMap<T, U> {\n  constructor(private submaps: Map<T, U>[]) {}\n\n  has(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return true\n      }\n    }\n    return false\n  }\n\n  get(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return submap.get(id)\n      }\n    }\n    return undefined\n  }\n\n  *values() {\n    for (const key of this.keys()) {\n      yield this.get(key) as U\n    }\n  }\n\n  *keys() {\n    const keys = new Set<T>()\n    for (const submap of this.submaps.values()) {\n      for (const key of submap.keys()) {\n        keys.add(key)\n      }\n    }\n    for (const key of keys) {\n      yield key\n    }\n  }\n\n  find<V>(f: (arg0: U) => V) {\n    for (const submap of this.submaps.values()) {\n      for (const value of submap.values()) {\n        const found = f(value)\n        if (found) {\n          return value\n        }\n      }\n    }\n    return undefined\n  }\n\n  *[Symbol.iterator]() {\n    for (const key of this.keys()) {\n      yield [key, this.get(key)]\n    }\n  }\n\n  *entries() {\n    for (const k of this.keys()) {\n      yield [k, this.get(k)]\n    }\n  }\n}\n","import React from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from './Block'\nimport { LinearGenomeViewModel } from '../../LinearGenomeView'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  linearBlocks: {\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    position: 'absolute',\n    minHeight: '100%',\n    display: 'flex',\n  },\n  heightOverflowed: {\n    position: 'absolute',\n    color: 'rgb(77,77,77)',\n    borderBottom: '2px solid rgb(77,77,77)',\n    textShadow: 'white 0px 0px 1px',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    fontWeight: 'bold',\n    textAlign: 'center',\n    zIndex: 2000,\n    boxSizing: 'border-box',\n  },\n})\n\nconst RenderedBlocks = observer(function ({\n  model,\n}: {\n  model: BaseLinearDisplayModel\n}) {\n  const { classes } = useStyles()\n  const { blockDefinitions, blockState } = model\n  return (\n    <>\n      {blockDefinitions.map(block => {\n        const key = `${model.id}-${block.key}`\n        if (block.type === 'ContentBlock') {\n          const state = blockState.get(block.key)\n          return (\n            <ContentBlockComponent block={block} key={key}>\n              {state?.ReactComponent ? (\n                <state.ReactComponent model={state} />\n              ) : null}\n              {state?.maxHeightReached ? (\n                <div\n                  className={classes.heightOverflowed}\n                  style={{\n                    top: state.layout.getTotalHeight() - 16,\n                    pointerEvents: 'none',\n                    height: 16,\n                  }}\n                >\n                  Max height reached\n                </div>\n              ) : null}\n            </ContentBlockComponent>\n          )\n        } else if (block.type === 'ElidedBlock') {\n          return <ElidedBlockComponent key={key} width={block.widthPx} />\n        } else if (block.type === 'InterRegionPaddingBlock') {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={key}\n              width={block.widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        throw new Error(`invalid block type ${JSON.stringify(block)}`)\n      })}\n    </>\n  )\n})\n\nexport { RenderedBlocks }\n\nconst LinearBlocks = observer(function ({\n  model,\n}: {\n  model: BaseLinearDisplayModel\n}) {\n  const { classes } = useStyles()\n  const { blockDefinitions } = model\n  const viewModel = getContainingView(model) as LGV\n  return (\n    <div\n      className={classes.linearBlocks}\n      style={{\n        left: blockDefinitions.offsetPx - viewModel.offsetPx,\n      }}\n    >\n      <RenderedBlocks model={model} />\n    </div>\n  )\n})\n\nexport default LinearBlocks\n","import React from 'react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { SanitizedHTML } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport { Portal, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport {\n  useClientPoint,\n  useFloating,\n  useInteractions,\n} from '@floating-ui/react'\n\n// locals\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nfunction round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\nconst useStyles = makeStyles()(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n}))\n\ninterface Props {\n  message: React.ReactNode | string\n}\nconst TooltipContents = React.forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ message }, ref) {\n    return (\n      <div ref={ref}>\n        {React.isValidElement(message) ? (\n          message\n        ) : message ? (\n          <SanitizedHTML html={String(message)} />\n        ) : null}\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\nconst Tooltip = observer(function ({\n  model,\n  clientMouseCoord,\n}: {\n  model: BaseLinearDisplayModel\n  clientMouseCoord: Coord\n}) {\n  const { theme, classes } = useStyles()\n  const { featureUnderMouse } = model\n\n  const x = clientMouseCoord[0] + 15\n  const y = clientMouseCoord[1]\n\n  const { refs, floatingStyles, context } = useFloating({\n    placement: 'right',\n    strategy: 'fixed',\n  })\n\n  const clientPoint = useClientPoint(context, { x, y })\n  const { getFloatingProps } = useInteractions([clientPoint])\n\n  const contents = featureUnderMouse\n    ? getConf(model, 'mouseover', { feature: featureUnderMouse })\n    : undefined\n\n  const popperTheme = theme?.components?.MuiPopper\n  return featureUnderMouse && contents ? (\n    <Portal container={popperTheme?.defaultProps?.container}>\n      <div\n        className={classes.tooltip}\n        ref={refs.setFloating}\n        style={{\n          ...floatingStyles,\n          zIndex: 100000,\n          pointerEvents: 'none',\n        }}\n        {...getFloatingProps()}\n      >\n        <TooltipContents message={contents} />\n      </div>\n    </Portal>\n  ) : null\n})\n\nexport default Tooltip\n","import React, { useState, useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { useTheme } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\n\n// locals\n\nimport LinearBlocks from './LinearBlocks'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nconst useStyles = makeStyles()({\n  display: {\n    position: 'relative',\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    width: '100%',\n    minHeight: '100%',\n  },\n})\n\ntype Coord = [number, number]\nconst BaseLinearDisplay = observer(function (props: {\n  model: BaseLinearDisplayModel\n  children?: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const ref = useRef<HTMLDivElement>(null)\n  const [clientRect, setClientRect] = useState<DOMRect>()\n  const [offsetMouseCoord, setOffsetMouseCoord] = useState<Coord>([0, 0])\n  const [clientMouseCoord, setClientMouseCoord] = useState<Coord>([0, 0])\n  const [contextCoord, setContextCoord] = useState<Coord>()\n  const { model, children } = props\n  const {\n    TooltipComponent,\n    DisplayMessageComponent,\n    contextMenuItems,\n    height,\n    setContextMenuFeature,\n  } = model\n\n  return (\n    <div\n      ref={ref}\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      className={classes.display}\n      onContextMenu={event => {\n        event.preventDefault()\n        if (contextCoord) {\n          // There's already a context menu open, so close it\n          setContextCoord(undefined)\n        } else if (ref.current) {\n          setContextCoord([event.clientX, event.clientY])\n        }\n      }}\n      onMouseMove={event => {\n        if (!ref.current) {\n          return\n        }\n        const rect = ref.current.getBoundingClientRect()\n        const { left, top } = rect\n        setOffsetMouseCoord([event.clientX - left, event.clientY - top])\n        setClientMouseCoord([event.clientX, event.clientY])\n        setClientRect(rect)\n      }}\n    >\n      {DisplayMessageComponent ? (\n        <DisplayMessageComponent model={model} />\n      ) : (\n        <LinearBlocks {...props} />\n      )}\n      {children}\n\n      <TooltipComponent\n        model={model}\n        height={height}\n        offsetMouseCoord={offsetMouseCoord}\n        clientMouseCoord={clientMouseCoord}\n        clientRect={clientRect}\n        mouseCoord={offsetMouseCoord}\n      />\n\n      <Menu\n        open={Boolean(contextCoord) && Boolean(contextMenuItems().length)}\n        onMenuItemClick={(_, callback) => {\n          callback()\n          setContextCoord(undefined)\n        }}\n        onClose={() => {\n          setContextCoord(undefined)\n          setContextMenuFeature(undefined)\n        }}\n        TransitionProps={{\n          onExit: () => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          },\n        }}\n        anchorReference=\"anchorPosition\"\n        anchorPosition={\n          contextCoord\n            ? { top: contextCoord[1], left: contextCoord[0] }\n            : undefined\n        }\n        style={{ zIndex: theme.zIndex.tooltip }}\n        menuItems={contextMenuItems()}\n      />\n    </div>\n  )\n})\n\nexport default BaseLinearDisplay\n\nexport { default as Tooltip } from './Tooltip'\nexport { default as BlockMsg } from './BlockMsg'\n","import { getConf } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nconst minDisplayHeight = 20\n\n/**\n * #stateModel TrackHeightMixin\n * #category display\n */\nexport default function TrackHeightMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      heightPreConfig: types.maybe(\n        types.refinement(\n          'displayHeight',\n          types.number,\n          n => n >= minDisplayHeight,\n        ),\n      ),\n    })\n    .volatile(() => ({\n      /**\n       * #property\n       */\n      scrollTop: 0,\n    }))\n    .views(self => ({\n      get height() {\n        // @ts-expect-error\n        return self.heightPreConfig ?? (getConf(self, 'height') as number)\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n      /**\n       * #action\n       */\n      setHeight(displayHeight: number) {\n        self.heightPreConfig = Math.max(displayHeight, minDisplayHeight)\n        return self.height\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n}\n","import React from 'react'\nimport { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\n\n// locals\nimport BlockMsg from '../components/BlockMsg'\nimport { Button } from '@mui/material'\n\nfunction TooLargeMessage({\n  model,\n}: {\n  model: {\n    regionTooLargeReason: string\n    featureDensityStats?: FeatureDensityStats\n    setFeatureDensityStatsLimit: (s?: FeatureDensityStats) => void\n    reload: () => void\n  }\n}) {\n  const { regionTooLargeReason } = model\n  return (\n    <BlockMsg\n      severity=\"warning\"\n      action={\n        <Button\n          onClick={() => {\n            model.setFeatureDensityStatsLimit(model.featureDensityStats)\n            model.reload()\n          }}\n        >\n          Force load\n        </Button>\n      }\n      message={[\n        regionTooLargeReason,\n        'Zoom in to see features or force load (may be slow)',\n      ]\n        .filter(f => !!f)\n        .join('. ')}\n    />\n  )\n}\n\nexport default TooLargeMessage\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { FeatureDensityStats } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { autorun } from 'mobx'\nimport { addDisposer, isAlive, types } from 'mobx-state-tree'\n\n// locals\nimport { LinearGenomeViewModel } from '../../LinearGenomeView'\nimport TooLargeMessage from '../components/TooLargeMessage'\nimport { getDisplayStr, getFeatureDensityStatsPre } from './util'\nimport autorunFeatureDensityStats from './autorunFeatureDensityStats'\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel FeatureDensityMixin\n * #category display\n */\nexport default function FeatureDensityMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      userBpPerPxLimit: types.maybe(types.number),\n      /**\n       * #property\n       */\n\n      userByteSizeLimit: types.maybe(types.number),\n    })\n    .volatile(() => ({\n      featureDensityStatsP: undefined as\n        | undefined\n        | Promise<FeatureDensityStats>,\n      featureDensityStats: undefined as undefined | FeatureDensityStats,\n      currStatsBpPerPx: 0,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get currentBytesRequested() {\n        return self.featureDensityStats?.bytes || 0\n      },\n\n      /**\n       * #getter\n       */\n      get currentFeatureScreenDensity() {\n        const view = getContainingView(self) as LGV\n        return (self.featureDensityStats?.featureDensity || 0) * view.bpPerPx\n      },\n\n      /**\n       * #getter\n       */\n      get maxFeatureScreenDensity() {\n        // @ts-expect-error\n        return getConf(self, 'maxFeatureScreenDensity')\n      },\n      /**\n       * #getter\n       */\n      get featureDensityStatsReady() {\n        const view = getContainingView(self) as LGV\n        return (\n          self.currStatsBpPerPx === view.bpPerPx &&\n          (!!self.featureDensityStats || !!self.userBpPerPxLimit)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get maxAllowableBytes() {\n        return (\n          self.userByteSizeLimit ||\n          self.featureDensityStats?.fetchSizeLimit ||\n          // @ts-expect-error\n          (getConf(self, 'fetchSizeLimit') as number)\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => autorunFeatureDensityStats(self as any)),\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCurrStatsBpPerPx(n: number) {\n        self.currStatsBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      setFeatureDensityStatsLimit(stats?: FeatureDensityStats) {\n        const view = getContainingView(self) as LGV\n        if (stats?.bytes) {\n          self.userByteSizeLimit = stats.bytes\n        } else {\n          self.userBpPerPxLimit = view.bpPerPx\n        }\n      },\n      /**\n       * #action\n       */\n      async getFeatureDensityStats() {\n        if (!self.featureDensityStatsP) {\n          self.featureDensityStatsP = getFeatureDensityStatsPre(\n            self as any,\n          ).catch(e => {\n            if (isAlive(self)) {\n              this.setFeatureDensityStatsP(undefined)\n            }\n            throw e\n          })\n        }\n        return self.featureDensityStatsP\n      },\n\n      /**\n       * #action\n       */\n      setFeatureDensityStatsP(arg: any) {\n        self.featureDensityStatsP = arg\n      },\n\n      /**\n       * #action\n       */\n      setFeatureDensityStats(featureDensityStats?: FeatureDensityStats) {\n        self.featureDensityStats = featureDensityStats\n      },\n      /**\n       * #action\n       */\n      clearFeatureDensityStats() {\n        self.featureDensityStatsP = undefined\n        self.featureDensityStats = undefined\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * region is too large if:\n       * - stats are ready\n       * - region is greater than 20kb (don't warn when zoomed in less than that)\n       * - and bytes is greater than max allowed bytes or density greater than max\n       *   density\n       */\n      get regionTooLarge() {\n        const view = getContainingView(self) as LGV\n        if (\n          !self.featureDensityStatsReady ||\n          view.dynamicBlocks.totalBp < 20_000\n        ) {\n          return false\n        }\n        return (\n          self.currentBytesRequested > self.maxAllowableBytes ||\n          (self.userBpPerPxLimit\n            ? view.bpPerPx > self.userBpPerPxLimit\n            : self.currentFeatureScreenDensity > self.maxFeatureScreenDensity)\n        )\n      },\n\n      /**\n       * #getter\n       * only shows a message of bytes requested is defined, the feature density\n       * based stats don't produce any helpful message besides to zoom in\n       */\n      get regionTooLargeReason() {\n        const req = self.currentBytesRequested\n        const max = self.maxAllowableBytes\n\n        return req && req > max\n          ? `Requested too much data (${getDisplayStr(req)})`\n          : ''\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      regionCannotBeRenderedText(_region: Region) {\n        return self.regionTooLarge ? 'Force load to see features' : ''\n      },\n\n      /**\n       * #method\n       * @param region -\n       * @returns falsy if the region is fine to try rendering. Otherwise,\n       *  return a react node + string of text.\n       *  string of text describes why it cannot be rendered\n       *  react node allows user to force load at current setting\n       */\n      regionCannotBeRendered(_region: Region) {\n        return self.regionTooLarge ? (\n          <TooLargeMessage model={self as any} />\n        ) : null\n      },\n    }))\n}\n","import { getContainingView, isAbortException } from '@jbrowse/core/util'\nimport { LinearGenomeViewModel } from '../../LinearGenomeView'\nimport { isAlive } from 'mobx-state-tree'\nimport { BaseLinearDisplayModel } from './BaseLinearDisplayModel'\n\n// stats estimation autorun calls getFeatureDensityStats against the data\n// adapter which by default uses featureDensity, but can also respond with a\n// byte size estimate and fetch size limit (data adapter can define what is too\n// much data)\nexport default async function autorunFeatureDensityStats(\n  self: BaseLinearDisplayModel,\n) {\n  try {\n    const view = getContainingView(self) as LinearGenomeViewModel\n\n    // extra check for contentBlocks.length\n    // https://github.com/GMOD/jbrowse-components/issues/2694\n    if (\n      !view.initialized ||\n      !view.staticBlocks.contentBlocks.length ||\n      view.bpPerPx === self.currStatsBpPerPx ||\n      self.error\n    ) {\n      return\n    }\n\n    // don't re-estimate featureDensity even if zoom level changes,\n    // jbrowse1-style assume it's sort of representative\n    if (self.featureDensityStats?.featureDensity !== undefined) {\n      self.setCurrStatsBpPerPx(view.bpPerPx)\n      return\n    }\n\n    self.clearFeatureDensityStats()\n    self.setCurrStatsBpPerPx(view.bpPerPx)\n    const stats = await self.getFeatureDensityStats()\n    if (isAlive(self)) {\n      self.setFeatureDensityStats(stats)\n    }\n  } catch (e) {\n    if (!isAbortException(e) && isAlive(self)) {\n      console.error(e)\n      self.setError(e)\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { ThemeOptions } from '@mui/material'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  getContainingView,\n  getContainingTrack,\n  getSession,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n  isFeature,\n  Feature,\n} from '@jbrowse/core/util'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { autorun } from 'mobx'\nimport { addDisposer, isAlive, types, Instance } from 'mobx-state-tree'\n\n// icons\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\nimport CenterFocusStrongIcon from '@mui/icons-material/CenterFocusStrong'\n\n// locals\nimport { LinearGenomeViewModel, ExportSvgOptions } from '../../LinearGenomeView'\nimport { Tooltip } from '../components/BaseLinearDisplay'\nimport BlockState from './serverSideRenderedBlock'\nimport configSchema from './configSchema'\nimport TrackHeightMixin from './TrackHeightMixin'\nimport FeatureDensityMixin from './FeatureDensityMixin'\n\ntype LGV = LinearGenomeViewModel\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nexport interface ExportSvgDisplayOptions extends ExportSvgOptions {\n  overrideHeight: number\n  theme: ThemeOptions\n}\n\n/**\n * #stateModel BaseLinearDisplay\n * #category display\n *\n * BaseLinearDisplay is used as the basis for many linear genome view tracks.\n * It is block based, and can use 'static blocks' or 'dynamic blocks'\n *\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nfunction stateModelFactory() {\n  return types\n    .compose(\n      'BaseLinearDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         * updated via autorun\n         */\n        blockState: types.map(BlockState),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile(() => ({\n      featureIdUnderMouse: undefined as undefined | string,\n      contextMenuFeature: undefined as undefined | Feature,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get blockType(): 'staticBlocks' | 'dynamicBlocks' {\n        return 'staticBlocks'\n      },\n      /**\n       * #getter\n       */\n      get blockDefinitions() {\n        const view = getContainingView(self) as LGV\n        if (!view.initialized) {\n          throw new Error('view not initialized yet')\n        }\n        return view[this.blockType]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * how many milliseconds to wait for the display to\n       * \"settle\" before re-rendering a block\n       */\n      get renderDelay() {\n        return 50\n      },\n\n      /**\n       * #getter\n       */\n      get TooltipComponent(): React.FC<any> {\n        return Tooltip as unknown as React.FC\n      },\n\n      /**\n       * #getter\n       * returns a string feature ID if the globally-selected object\n       * is probably a feature\n       */\n      get selectedFeatureId() {\n        if (isAlive(self)) {\n          const { selection } = getSession(self)\n          // does it quack like a feature?\n          if (isFeature(selection)) {\n            return selection.id()\n          }\n        }\n        return undefined\n      },\n      /**\n       * #getter\n       * if a display-level message should be displayed instead of the blocks,\n       * make this return a react component\n       */\n      get DisplayMessageComponent() {\n        return undefined as undefined | React.FC<any>\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       */\n      get features() {\n        const featureMaps = []\n        for (const block of self.blockState.values()) {\n          if (block?.features) {\n            featureMaps.push(block.features)\n          }\n        }\n        return new CompositeMap(featureMaps)\n      },\n\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        const feat = self.featureIdUnderMouse\n        return feat ? this.features.get(feat) : undefined\n      },\n\n      /**\n       * #getter\n       */\n      getFeatureOverlapping(\n        blockKey: string,\n        x: number,\n        y: number,\n      ): string | undefined {\n        return self.blockState.get(blockKey)?.layout?.getByCoord(x, y)\n      },\n\n      /**\n       * #getter\n       */\n      getFeatureByID(blockKey: string, id: string): LayoutRecord | undefined {\n        return self.blockState.get(blockKey)?.layout?.getByID(id)\n      },\n\n      /**\n       * #getter\n       */\n      searchFeatureByID(id: string): LayoutRecord | undefined {\n        let ret\n        self.blockState.forEach(block => {\n          const val = block?.layout?.getByID(id)\n          if (val) {\n            ret = val\n          }\n        })\n        return ret\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addBlock(key: string, block: BaseBlock) {\n        self.blockState.set(\n          key,\n          BlockState.create({\n            key,\n            region: block.toRegion(),\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      deleteBlock(key: string) {\n        self.blockState.delete(key)\n      },\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'BaseFeatureWidget',\n            'baseFeature',\n            {\n              view: getContainingView(self),\n              track: getContainingTrack(self),\n              featureData: feature.toJSON(),\n            },\n          )\n\n          session.showWidget(featureWidget)\n        }\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n      /**\n       * #action\n       */\n      navToFeature(feature: Feature) {\n        const view = getContainingView(self) as LGV\n        view.navTo({\n          refName: feature.get('refName'),\n          start: feature.get('start'),\n          end: feature.get('end'),\n        })\n      },\n      /**\n       * #action\n       */\n      clearFeatureSelection() {\n        getSession(self).clearSelection()\n      },\n      /**\n       * #action\n       */\n      setFeatureIdUnderMouse(feature?: string) {\n        self.featureIdUnderMouse = feature\n      },\n\n      /**\n       * #action\n       */\n      setContextMenuFeature(feature?: Feature) {\n        self.contextMenuFeature = feature\n      },\n    }))\n\n    .actions(self => {\n      const { reload: superReload } = self\n\n      return {\n        /**\n         * #action\n         */\n        async reload() {\n          self.setError()\n          self.setCurrStatsBpPerPx(0)\n          self.clearFeatureDensityStats()\n          ;[...self.blockState.values()].map(val => val.doReload())\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      /**\n       * #method\n       */\n      trackMenuItems(): MenuItem[] {\n        return []\n      },\n\n      /**\n       * #method\n       */\n      contextMenuItems(): MenuItem[] {\n        return [\n          ...(self.contextMenuFeature\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    if (self.contextMenuFeature) {\n                      self.selectFeature(self.contextMenuFeature)\n                    }\n                  },\n                },\n                {\n                  label: 'Zoom to feature',\n                  icon: CenterFocusStrongIcon,\n                  onClick: () => {\n                    if (self.contextMenuFeature) {\n                      self.navToFeature(self.contextMenuFeature)\n                    }\n                  },\n                },\n              ]\n            : []),\n        ]\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          notReady: !self.featureDensityStatsReady,\n          rpcDriverName: self.rpcDriverName,\n\n          displayModel: self,\n          onFeatureClick(_: unknown, featureId?: string) {\n            const f = featureId || self.featureIdUnderMouse\n            if (!f) {\n              self.clearFeatureSelection()\n            } else {\n              const feature = self.features.get(f)\n              if (feature) {\n                self.selectFeature(feature)\n              }\n            }\n          },\n          onClick() {\n            self.clearFeatureSelection()\n          },\n          // similar to click but opens a menu with further options\n          onFeatureContextMenu(_: unknown, featureId?: string) {\n            const f = featureId || self.featureIdUnderMouse\n            if (!f) {\n              self.clearFeatureSelection()\n            } else {\n              // feature id under mouse passed to context menu\n              self.setContextMenuFeature(self.features.get(f))\n            }\n          },\n\n          onMouseMove(_: unknown, featureId?: string) {\n            self.setFeatureIdUnderMouse(featureId)\n          },\n\n          onMouseLeave(_: unknown) {\n            self.setFeatureIdUnderMouse(undefined)\n          },\n\n          onContextMenu() {\n            self.setContextMenuFeature(undefined)\n            self.clearFeatureSelection()\n          },\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #method\n       */\n      async renderSvg(opts: ExportSvgDisplayOptions) {\n        const { renderBaseLinearDisplaySvg } = await import('./renderSvg')\n        return renderBaseLinearDisplaySvg(self as BaseLinearDisplayModel, opts)\n      },\n      afterAttach() {\n        // watch the parent's blocks to update our block state when they change,\n        // then we recreate the blocks on our own model (creating and deleting to\n        // match the parent blocks)\n        addDisposer(\n          self,\n          autorun(() => {\n            const blocksPresent: Record<string, boolean> = {}\n            const view = getContainingView(self) as LGV\n            if (!view.initialized) {\n              return\n            }\n            self.blockDefinitions.contentBlocks.forEach(block => {\n              blocksPresent[block.key] = true\n              if (!self.blockState.has(block.key)) {\n                self.addBlock(block.key, block)\n              }\n            })\n            self.blockState.forEach((_, key) => {\n              if (!blocksPresent[key]) {\n                self.deleteBlock(key as string)\n              }\n            })\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      if (!snap) {\n        return snap\n      }\n      // rewrite \"height\" from older snapshots to \"heightPreConfig\", this allows\n      // us to maintain a height \"getter\" going forward\n      // @ts-expect-error\n      const { height, ...rest } = snap\n      return { heightPreConfig: height, ...rest }\n    })\n    .postProcessSnapshot(self => {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const r = self as Omit<typeof self, symbol>\n      const { blockState, ...rest } = r\n      return rest\n    })\n}\n\nexport const BaseLinearDisplay = stateModelFactory()\n\nexport type BaseLinearDisplayStateModel = typeof BaseLinearDisplay\nexport type BaseLinearDisplayModel = Instance<BaseLinearDisplayStateModel>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\n/**\n * #config LinearBareDisplay\n * #category display\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBareDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport { configSchemaFactory }\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\n/**\n * #stateModel LinearBareDisplay\n * #category display\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBareDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearBareDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            ...getParentRenderProps(self),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\n/**\n * #config LinearBasicDisplay\n * #category display\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBasicDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import { lazy } from 'react'\nimport {\n  getConf,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { types, getEnv, Instance, cast } from 'mobx-state-tree'\n\n// icons\nimport VisibilityIcon from '@mui/icons-material/Visibility'\n\n// locals\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\n\nconst SetMaxHeightDialog = lazy(() => import('./components/SetMaxHeightDialog'))\nconst AddFiltersDialog = lazy(() => import('./components/AddFiltersDialog'))\n\n/**\n * #stateModel LinearBasicDisplay\n * #category display\n * used by `FeatureTrack`, has simple settings like \"show/hide feature labels\",\n * etc.\n *\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBasicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearBasicDisplay'),\n        /**\n         * #property\n         */\n        trackShowLabels: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackShowDescriptions: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackDisplayMode: types.maybe(types.string),\n        /**\n         * #property\n         */\n        trackMaxHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        jexlFilters: types.maybe(types.array(types.string)),\n      }),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get activeFilters() {\n        // config jexlFilters are deferred evaluated so they are prepended with\n        // jexl at runtime rather than being stored with jexl in the config\n        return (\n          self.jexlFilters ??\n          getConf(self, 'jexlFilters').map((r: string) => `jexl:${r}`)\n        )\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n\n      /**\n       * #getter\n       */\n      get showLabels() {\n        return self.trackShowLabels ?? getConf(self, ['renderer', 'showLabels'])\n      },\n\n      /**\n       * #getter\n       */\n      get showDescriptions() {\n        return (\n          self.trackShowDescriptions ??\n          getConf(self, ['renderer', 'showDescriptions'])\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get maxHeight() {\n        return self.trackMaxHeight ?? getConf(self, ['renderer', 'maxHeight'])\n      },\n\n      /**\n       * #getter\n       */\n      get displayMode() {\n        return (\n          self.trackDisplayMode ?? getConf(self, ['renderer', 'displayMode'])\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n        const config = configBlob as Omit<typeof configBlob, symbol>\n\n        return self.rendererType.configSchema.create(\n          {\n            ...config,\n            showLabels: self.showLabels,\n            showDescriptions: self.showDescriptions,\n            displayMode: self.displayMode,\n            maxHeight: self.maxHeight,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setJexlFilters(f?: string[]) {\n        self.jexlFilters = cast(f)\n      },\n      /**\n       * #action\n       */\n      toggleShowLabels() {\n        self.trackShowLabels = !self.showLabels\n      },\n      /**\n       * #action\n       */\n      toggleShowDescriptions() {\n        self.trackShowDescriptions = !self.showDescriptions\n      },\n      /**\n       * #action\n       */\n      setDisplayMode(val: string) {\n        self.trackDisplayMode = val\n      },\n      /**\n       * #action\n       */\n      setMaxHeight(val?: number) {\n        self.trackMaxHeight = val\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const superProps = superRenderProps()\n          return {\n            ...(superProps as Omit<typeof superProps, symbol>),\n            config: self.rendererConfig,\n            filters: new SerializableFilterChain({\n              filters: self.activeFilters,\n            }),\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems(): MenuItem[] {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show labels',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showLabels,\n              onClick: () => self.toggleShowLabels(),\n            },\n            {\n              label: 'Show descriptions',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showDescriptions,\n              onClick: () => self.toggleShowDescriptions(),\n            },\n            {\n              label: 'Display mode',\n              icon: VisibilityIcon,\n              subMenu: [\n                'compact',\n                'reducedRepresentation',\n                'normal',\n                'collapse',\n              ].map(val => ({\n                label: val,\n                onClick: () => self.setDisplayMode(val),\n              })),\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetMaxHeightDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n            {\n              label: 'Edit filters',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  AddFiltersDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n}\n\nexport type FeatureTrackStateModel = ReturnType<typeof stateModelFactory>\nexport type FeatureTrackModel = Instance<FeatureTrackStateModel>\n\nexport default stateModelFactory\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n// icons\nimport LineStyleIcon from '@mui/icons-material/LineStyle'\n\n// locals\nimport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  baseLinearDisplayConfigSchema,\n} from './BaseLinearDisplay'\nimport LinearBareDisplayF from './LinearBareDisplay'\nimport LinearGenomeViewF, {\n  SearchBox,\n  ZoomControls,\n  LinearGenomeView,\n} from './LinearGenomeView'\n\nimport LinearBasicDisplayF from './LinearBasicDisplay'\nimport FeatureTrackF from './FeatureTrack'\nimport BasicTrackF from './BasicTrack'\nimport LaunchLinearGenomeViewF from './LaunchLinearGenomeView'\n\nexport default class LinearGenomeViewPlugin extends Plugin {\n  name = 'LinearGenomeViewPlugin'\n\n  exports = {\n    BaseLinearDisplayComponent,\n    BaseLinearDisplay,\n    baseLinearDisplayConfigSchema,\n    SearchBox,\n    ZoomControls,\n    LinearGenomeView,\n  }\n\n  /**\n   * #config LinearGenomeViewConfigSchema\n   */\n  configurationSchema = ConfigurationSchema('LinearGenomeViewConfigSchema', {\n    /**\n     * #slot configuration.LinearGenomeViewPlugin.trackLabels\n     */\n    trackLabels: {\n      type: 'string',\n      defaultValue: 'overlapping',\n      model: types.enumeration('trackLabelOptions', [\n        'offset',\n        'overlapping',\n        'hidden',\n      ]),\n    },\n  })\n\n  install(pluginManager: PluginManager) {\n    FeatureTrackF(pluginManager)\n    BasicTrackF(pluginManager)\n    LinearBasicDisplayF(pluginManager)\n    LinearGenomeViewF(pluginManager)\n    LinearBareDisplayF(pluginManager)\n    LaunchLinearGenomeViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear genome view',\n        icon: LineStyleIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearGenomeView', {})\n        },\n      })\n    }\n  }\n}\n\nexport type {\n  ExportSvgDisplayOptions,\n  BaseLinearDisplayModel,\n  BlockModel,\n} from './BaseLinearDisplay'\n\nexport { configSchemaFactory as linearBareDisplayConfigSchemaFactory } from './LinearBareDisplay'\nexport {\n  baseLinearDisplayConfigSchema,\n  BaseLinearDisplay,\n  BlockMsg,\n  BaseLinearDisplayComponent,\n  TrackHeightMixin,\n  FeatureDensityMixin,\n  TooLargeMessage,\n} from './BaseLinearDisplay'\nexport {\n  type LinearGenomeViewModel,\n  type LinearGenomeViewStateModel,\n  RefNameAutocomplete,\n  SearchBox,\n} from './LinearGenomeView'\nexport {\n  renderToSvg,\n  SVGTracks,\n  SVGRuler,\n} from './LinearGenomeView/svgcomponents/SVGLinearGenomeView'\nexport { totalHeight } from './LinearGenomeView/svgcomponents/util'\nexport {\n  configSchema as linearBasicDisplayConfigSchemaFactory,\n  modelFactory as linearBasicDisplayModelFactory,\n} from './LinearBasicDisplay'\n","import {\n  createBaseTrackModel,\n  TrackType,\n} from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default function FeatureTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'FeatureTrack',\n      displayName: 'Feature track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'FeatureTrack', configSchema),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config FeatureTrack\n * #category track\n * used for basic gene and feature tracks, generally used with LinearBasicDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'FeatureTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'trackId',\n    },\n  )\n\nexport default configSchema\n","import {\n  createBaseTrackModel,\n  TrackType,\n} from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default function BasicTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n\n    return new TrackType({\n      name: 'BasicTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'BasicTrack', configSchema),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config BasicTrack\n * #category track\n * synonym for FeatureTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'BasicTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n      explicitIdentifier: 'trackId',\n    },\n  )\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { BaseLinearDisplayComponent } from '../BaseLinearDisplay'\n\n// locals\nimport configSchema from './configSchema'\nimport modelFactory from './model'\n\nexport default function LinearBasicDisplay(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const config = configSchema(pluginManager)\n    return new DisplayType({\n      name: 'LinearBasicDisplay',\n      displayName: 'Basic feature display',\n      configSchema: config,\n      stateModel: modelFactory(config),\n      trackType: 'FeatureTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n\nexport { default as modelFactory } from './model'\nexport { default as configSchema } from './configSchema'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { DisplayType } from '@jbrowse/core/pluggableElementTypes'\n\n// locals\nimport { configSchemaFactory } from './configSchema'\nimport { stateModelFactory } from './model'\nimport { BaseLinearDisplayComponent } from '../BaseLinearDisplay/'\n\nexport default function LinearBareDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearBareDisplay',\n      configSchema,\n      displayName: 'Bare feature display',\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'BasicTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n\nexport { configSchemaFactory } from './configSchema'\nexport { stateModelFactory } from './model'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  when,\n  parseLocString,\n  ParsedLocString,\n} from '@jbrowse/core/util'\n// locals\nimport { LinearGenomeViewModel } from '../LinearGenomeView'\nimport { handleSelectedRegion } from '../searchUtils'\n\ntype LGV = LinearGenomeViewModel\n\nexport default function LaunchLinearGenomeViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-LinearGenomeView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      loc,\n      tracks = [],\n      tracklist,\n      nav,\n      highlight,\n    }: {\n      session: AbstractSessionModel\n      assembly?: string\n      loc: string\n      tracks?: string[]\n      tracklist?: boolean\n      nav?: boolean\n      highlight?: string[]\n    }) => {\n      try {\n        const { assemblyManager } = session\n\n        const { isValidRefName } = assemblyManager\n\n        const view = session.addView('LinearGenomeView', {}) as LGV\n\n        await when(() => !!view.volatileWidth)\n\n        if (!assembly) {\n          throw new Error(\n            'No assembly provided when launching linear genome view',\n          )\n        }\n\n        const asm = await assemblyManager.waitForAssembly(assembly)\n        if (!asm) {\n          throw new Error(\n            `Assembly \"${assembly}\" not found when launching linear genome view`,\n          )\n        }\n\n        if (tracklist) {\n          view.activateTrackSelector()\n        }\n        if (nav !== undefined) {\n          view.setHideHeader(!nav)\n        }\n        if (highlight !== undefined) {\n          highlight.forEach(async h => {\n            if (h) {\n              const parsedLocString = parseLocString(h, refName =>\n                isValidRefName(refName, assembly),\n              ) as Required<ParsedLocString>\n\n              const location = {\n                ...parsedLocString,\n                assemblyName: assembly,\n              }\n\n              if (\n                location?.start !== undefined &&\n                location?.end !== undefined\n              ) {\n                view.addToHighlights(location)\n              }\n            }\n          })\n        }\n\n        await handleSelectedRegion({ input: loc, model: view, assembly: asm })\n\n        const idsNotFound = [] as string[]\n        tracks.forEach(track => tryTrack(view, track, idsNotFound))\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notifyError(`${e}`, e)\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: {\n    showTrack: (arg: string) => void\n  },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (`${e}`.match('Could not resolve identifier')) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import { getSession } from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport { SearchType } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { SearchScope } from '@jbrowse/core/TextSearch/TextSearchManager'\nimport { dedupe, TextSearchManager } from '@jbrowse/core/util'\n\n// locals\nimport { LinearGenomeViewModel } from './LinearGenomeView'\n\nexport async function navToOption({\n  option,\n  model,\n  assemblyName,\n}: {\n  model: LinearGenomeViewModel\n  option: BaseResult\n  assemblyName: string\n}) {\n  const location = option.getLocation()\n  const trackId = option.getTrackId()\n  if (location) {\n    await model.navToLocString(location, assemblyName)\n    if (trackId) {\n      model.showTrack(trackId)\n    }\n  }\n}\n\n// gets a string as input, or use stored option results from previous query,\n// then re-query and\n// 1) if it has multiple results: pop a dialog\n// 2) if it's a single result navigate to it\n// 3) else assume it's a locstring and navigate to it\nexport async function handleSelectedRegion({\n  input,\n  model,\n  assembly,\n}: {\n  input: string\n  model: LinearGenomeViewModel\n  assembly: Assembly\n}) {\n  const allRefs = assembly?.allRefNamesWithLowerCase || []\n  const assemblyName = assembly.name\n  if (input.split(' ').every(entry => checkRef(entry, allRefs))) {\n    await model.navToLocString(input, assembly.name)\n  } else {\n    const searchScope = model.searchScope(assemblyName)\n    const { textSearchManager } = getSession(model)\n    const results = await fetchResults({\n      queryString: input,\n      searchType: 'exact',\n      searchScope,\n      rankSearchResults: model.rankSearchResults,\n      textSearchManager,\n      assembly,\n    })\n\n    if (results.length > 1) {\n      model.setSearchResults(results, input.toLowerCase(), assemblyName)\n    } else if (results.length === 1) {\n      await navToOption({\n        option: results[0],\n        model,\n        assemblyName,\n      })\n    } else {\n      await model.navToLocString(input, assemblyName)\n    }\n  }\n}\n\nexport function checkRef(str: string, allRefs: string[]) {\n  const [ref, rest] = splitLast(str, ':')\n  return (\n    allRefs.includes(str) ||\n    (allRefs.includes(ref) && !Number.isNaN(Number.parseInt(rest, 10)))\n  )\n}\n\nexport async function fetchResults({\n  queryString,\n  searchType,\n  searchScope,\n  rankSearchResults,\n  textSearchManager,\n  assembly,\n}: {\n  queryString: string\n  searchScope: SearchScope\n  rankSearchResults: (results: BaseResult[]) => BaseResult[]\n  searchType?: SearchType\n  textSearchManager?: TextSearchManager\n  assembly?: Assembly\n}) {\n  if (!textSearchManager) {\n    console.warn('No text search manager')\n  }\n\n  const textSearchResults = await textSearchManager?.search(\n    {\n      queryString,\n      searchType,\n    },\n    searchScope,\n    rankSearchResults,\n  )\n\n  const refNameResults = assembly?.allRefNames\n    ?.filter(ref => ref.toLowerCase().startsWith(queryString.toLowerCase()))\n    .slice(0, 10)\n    .map(r => new BaseResult({ label: r }))\n\n  return dedupe(\n    [...(refNameResults || []), ...(textSearchResults || [])],\n    elt => elt.getId(),\n  )\n}\n\n// splits on the last instance of a character\nexport function splitLast(str: string, split: string): [string, string] {\n  const lastIndex = str.lastIndexOf(split)\n  if (lastIndex === -1) {\n    return [str, '']\n  } else {\n    const before = str.slice(0, lastIndex)\n    const after = str.slice(lastIndex + 1)\n    return [before, after]\n  }\n}\n","import VCF, { parseBreakend } from '@gmod/vcf'\n\nconst altTypeToSO: Record<string, string | undefined> = {\n  DEL: 'deletion',\n  INS: 'insertion',\n  DUP: 'duplication',\n  INV: 'inversion',\n  INVDUP: 'inverted duplication',\n  CNV: 'copy_number_variation',\n  TRA: 'translocation',\n  'DUP:TANDEM': 'tandem_duplication',\n  NON_REF: 'sequence_variant',\n  '*': 'sequence_variant',\n}\n\n/**\n * Get a sequence ontology (SO) term that describes the variant type\n */\nexport function getSOTermAndDescription(\n  ref: string,\n  alt: string[],\n  parser: VCF,\n): string[] {\n  // it's just a remark if there are no alternate alleles\n  if (!alt || alt.length === 0) {\n    return ['remark', 'no alternative alleles']\n  }\n\n  const soTerms = new Set<string>()\n  let descriptions = new Set<string>()\n  alt.forEach(a => {\n    let [soTerm, description] = getSOAndDescFromAltDefs(a, parser)\n    if (!soTerm) {\n      ;[soTerm, description] = getSOAndDescByExamination(ref, a)\n    }\n    if (soTerm && description) {\n      soTerms.add(soTerm)\n      descriptions.add(description)\n    }\n  })\n\n  // Combine descriptions like [\"SNV G -> A\", \"SNV G -> T\"] to [\"SNV G -> A,T\"]\n  if (descriptions.size > 1) {\n    const descs = [...descriptions]\n    const prefixes = new Set(\n      descs.map(desc => {\n        const prefix = desc.split('->')\n        return prefix[1] ? prefix[0] : desc\n      }),\n    )\n\n    descriptions = new Set(\n      [...prefixes]\n        .map(r => r.trim())\n        .map(prefix => {\n          const suffixes = descs\n            .map(desc => desc.split('->').map(r => r.trim()))\n            .map(pref => (pref[1] && pref[0] === prefix ? pref[1] : ''))\n            .filter(f => !!f)\n\n          return suffixes.length ? `${prefix} -> ${suffixes.join(',')}` : prefix\n        }),\n    )\n  }\n  if (soTerms.size) {\n    return [[...soTerms].join(','), [...descriptions].join(',')]\n  }\n  return []\n}\n\nexport function getSOAndDescFromAltDefs(alt: string, parser: VCF): string[] {\n  if (typeof alt === 'string' && !alt.startsWith('<')) {\n    return []\n  }\n\n  // look for a definition with an SO type for this\n  let soTerm = altTypeToSO[alt]\n  // if no SO term but ALT is in metadata, assume sequence_variant\n  if (!soTerm && parser.getMetadata('ALT', alt)) {\n    soTerm = 'sequence_variant'\n  }\n  if (soTerm) {\n    return [soTerm, alt]\n  }\n\n  // try to look for a definition for a parent term if we can\n  const modAlt = alt.split(':')\n  if (modAlt.length > 1) {\n    return getSOAndDescFromAltDefs(`<${modAlt.slice(0, -1).join(':')}>`, parser)\n  }\n\n  // no parent\n  return []\n}\n\n// note: term SNV is used instead of SNP because SO definition of SNP says\n// abundance must be at least 1% in population, and can't be sure we meet\n// that\nexport function getSOAndDescByExamination(ref: string, alt: string) {\n  const bnd = parseBreakend(alt)\n  if (bnd) {\n    return ['breakend', alt]\n  } else if (ref.length === 1 && alt.length === 1) {\n    return ['SNV', makeDescriptionString('SNV', ref, alt)]\n  } else if (alt === '<INS>') {\n    return ['insertion', alt]\n  } else if (alt === '<DEL>') {\n    return ['deletion', alt]\n  } else if (alt === '<INV>') {\n    return ['inversion', alt]\n  } else if (alt === '<TRA>') {\n    return ['translocation', alt]\n  } else if (alt.includes('<')) {\n    return ['sv', alt]\n  } else if (ref.length === alt.length) {\n    return ref.split('').reverse().join('') === alt\n      ? ['inversion', makeDescriptionString('inversion', ref, alt)]\n      : ['substitution', makeDescriptionString('substitution', ref, alt)]\n  } else if (ref.length <= alt.length) {\n    const len = alt.length - ref.length\n    const lena = len.toLocaleString('en-US')\n    return [\n      'insertion',\n      len > 5 ? lena + 'bp INS' : makeDescriptionString('insertion', ref, alt),\n    ]\n  } else if (ref.length > alt.length) {\n    const len = ref.length - alt.length\n    const lena = len.toLocaleString('en-US')\n    return [\n      'deletion',\n      len > 5 ? lena + 'bp DEL' : makeDescriptionString('deletion', ref, alt),\n    ]\n  }\n\n  return ['indel', makeDescriptionString('indel', ref, alt)]\n}\n\nfunction makeDescriptionString(soTerm: string, ref: string, alt: string) {\n  return `${soTerm} ${ref} -> ${alt}`\n}\n","import { Feature } from '@jbrowse/core/util'\nimport VCF from '@gmod/vcf'\n\n// locals\nimport { getSOTermAndDescription } from './util'\n\n/* eslint-disable no-underscore-dangle */\n\ntype Samples = Record<\n  string,\n  Record<string, { values: string[] | number[] | null }>\n>\n\ninterface FeatureData {\n  [key: string]: unknown\n  refName: string\n  start: number\n  end: number\n  description?: string\n  type?: string\n  name?: string\n  aliases?: string[]\n  samples?: Samples\n}\n\nexport default class VCFFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private variant: any\n\n  private parser: VCF\n\n  private data: FeatureData\n\n  private _id: string\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(args: { variant: any; parser: VCF; id: string }) {\n    this.variant = args.variant\n    this.parser = args.parser\n    this.data = this.dataFromVariant(this.variant)\n    this._id = args.id\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    return field === 'samples'\n      ? this.variant.SAMPLES\n      : this.data[field] ?? this.variant[field]\n  }\n\n  set() {}\n\n  parent() {\n    return undefined\n  }\n\n  children() {\n    return undefined\n  }\n\n  tags() {\n    return [...Object.keys(this.data), ...Object.keys(this.variant), 'samples']\n  }\n\n  id() {\n    return this._id\n  }\n\n  dataFromVariant(variant: {\n    REF: string\n    POS: number\n    ALT: string[]\n    CHROM: string\n    INFO: any // eslint-disable-line @typescript-eslint/no-explicit-any\n    ID: string[]\n  }): FeatureData {\n    const { REF, ALT, POS, CHROM, INFO, ID } = variant\n    const start = POS - 1\n    const [type, description] = getSOTermAndDescription(REF, ALT, this.parser)\n    const isTRA = ALT?.some(f => f === '<TRA>')\n    const isSymbolic = ALT?.some(f => f.includes('<'))\n\n    return {\n      refName: CHROM,\n      start,\n      end: isSymbolic && INFO.END && !isTRA ? +INFO.END[0] : start + REF.length,\n      description,\n      type,\n      name: ID?.join(','),\n      aliases: ID && ID.length > 1 ? variant.ID.slice(1) : undefined,\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  toJSON(): any {\n    return {\n      uniqueId: this._id,\n      ...this.variant,\n      ...this.data,\n      samples: this.variant.SAMPLES,\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config VcfAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst VcfAdapter = ConfigurationSchema(\n  'VcfAdapter',\n  {\n    /**\n     * #slot\n     */\n    vcfLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default VcfAdapter\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config VcfTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst VcfTabixAdapter = ConfigurationSchema(\n  'VcfTabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    vcfGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf.gz', locationType: 'UriLocation' },\n    },\n    index: ConfigurationSchema('VcfIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.vcf.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n  },\n  { explicitlyTyped: true },\n)\n\nexport default VcfTabixAdapter\n","import { getConf, ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  getContainingTrack,\n  getSession,\n  getContainingView,\n  isSessionModelWithWidgets,\n  Feature,\n} from '@jbrowse/core/util'\n\nimport { linearBasicDisplayModelFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { Instance, types } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearVariantDisplay\n * similar to basic display, but provides custom widget on feature click\n * extends\n *\n * - [LinearBasicDisplay](../linearbasicdisplay)\n */\nexport default function stateModelFactory(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearVariantDisplay',\n      linearBasicDisplayModelFactory(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearVariantDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      async selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const { rpcManager } = session\n          const sessionId = getRpcSessionId(self)\n          const track = getContainingTrack(self)\n          const view = getContainingView(self)\n          const adapterConfig = getConf(track, 'adapter')\n          const descriptions = await rpcManager.call(\n            sessionId,\n            'CoreGetMetadata',\n            {\n              adapterConfig,\n            },\n          )\n          session.showWidget(\n            session.addWidget('VariantFeatureWidget', 'variantFeature', {\n              featureData: feature.toJSON(),\n              view,\n              track,\n              descriptions,\n            }),\n          )\n        }\n\n        session.setSelection(feature)\n      },\n    }))\n}\n\nexport type LinearVariantDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearVariantDisplayModel = Instance<LinearVariantDisplayStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config StructuralVariantChordRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'StructuralVariantChordRenderer',\n  {\n    /**\n     * #slot\n     */\n    strokeColor: {\n      type: 'color',\n      description: 'the line color of each arc',\n      defaultValue: 'rgba(255,133,0,0.32)',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    strokeColorSelected: {\n      type: 'color',\n      description: 'the line color of an arc that has been selected',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    strokeColorHover: {\n      type: 'color',\n      description:\n        'the line color of an arc that is being hovered over with the mouse',\n      defaultValue: '#555',\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { polarToCartesian, Feature, getStrokeProps } from '@jbrowse/core/util'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { parseBreakend } from '@gmod/vcf'\n\nexport interface Region {\n  end: number\n  start: number\n  refName: string\n  elided?: false\n}\n\nexport interface ElidedRegion {\n  elided: true\n  regions: Region[]\n}\n\nexport type AnyRegion = Region | ElidedRegion\n\nexport interface Block {\n  flipped: boolean\n  bpPerRadian: number\n  startRadians: number\n  region: AnyRegion\n}\n\nfunction bpToRadians(block: Block, pos: number) {\n  const blockStart = block.region.elided ? 0 : block.region.start\n  const blockEnd = block.region.elided ? 0 : block.region.end\n  const bpOffset = block.flipped ? blockEnd - pos : pos - blockStart\n  return bpOffset / block.bpPerRadian + block.startRadians\n}\n\nconst Chord = observer(function Chord({\n  feature,\n  blocksForRefs,\n  radius,\n  config,\n  bezierRadius,\n  selected,\n  onClick,\n}: {\n  feature: Feature\n  blocksForRefs: Record<string, Block>\n  radius: number\n  config: AnyConfigurationModel\n  bezierRadius: number\n  selected: boolean\n  onClick: (feat: Feature, reg: AnyRegion, end: AnyRegion, evt: unknown) => void\n}) {\n  const [hovered, setHovered] = useState(false)\n  // find the blocks that our start and end points belong to\n  const startBlock = blocksForRefs[feature.get('refName')]\n  if (!startBlock) {\n    return null\n  }\n  let svType\n  if (feature.get('INFO')) {\n    ;[svType] = feature.get('INFO').SVTYPE || []\n  } else if (feature.get('mate')) {\n    svType = 'mate'\n  }\n  let endPosition\n  let endBlock: Block | undefined\n  const alt = feature.get('ALT')?.[0]\n  const bnd = alt && parseBreakend(alt)\n  if (bnd) {\n    // VCF BND\n    const matePosition = bnd.MatePosition.split(':')\n    endPosition = +matePosition[1]\n    endBlock = blocksForRefs[matePosition[0]]\n  } else if (alt === '<TRA>') {\n    // VCF TRA\n    const chr2 = feature.get('INFO')?.CHR2?.[0]\n    const end = feature.get('INFO')?.END?.[0]\n    endPosition = parseInt(end, 10)\n    endBlock = blocksForRefs[chr2]\n  } else if (svType === 'mate') {\n    // generic simplefeatures arcs\n    const mate = feature.get('mate')\n    const chr2 = mate.refName\n    endPosition = mate.start\n    endBlock = blocksForRefs[chr2]\n  }\n\n  if (endBlock) {\n    const startPos = feature.get('start')\n    const startRadians = bpToRadians(startBlock, startPos)\n    const endRadians = bpToRadians(endBlock, endPosition)\n    const startXY = polarToCartesian(radius, startRadians)\n    const endXY = polarToCartesian(radius, endRadians)\n    const controlXY = polarToCartesian(\n      bezierRadius,\n      (endRadians + startRadians) / 2,\n    )\n\n    const strokeColor = selected\n      ? readConfObject(config, 'strokeColorSelected', { feature })\n      : readConfObject(config, 'strokeColor', { feature })\n\n    const hoverStrokeColor = readConfObject(config, 'strokeColorHover', {\n      feature,\n    })\n    return (\n      <path\n        data-testid={`chord-${feature.id()}`}\n        cursor=\"crosshair\"\n        fill=\"none\"\n        d={['M', ...startXY, 'Q', ...controlXY, ...endXY].join(' ')}\n        {...getStrokeProps(hovered ? hoverStrokeColor : strokeColor)}\n        strokeWidth={hovered ? 3 : 1}\n        onClick={evt => {\n          if (endBlock && startBlock) {\n            onClick(feature, startBlock.region, endBlock.region, evt)\n          }\n        }}\n        onMouseOver={() => {\n          if (!selected) {\n            setHovered(true)\n          }\n        }}\n        onMouseOut={() => {\n          if (!selected) {\n            setHovered(false)\n          }\n        }}\n      />\n    )\n  }\n\n  return null\n})\n\nexport default Chord\n","import React, { useMemo } from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\n// locals\nimport Chord, { Block, AnyRegion } from './Chord'\n\nconst StructuralVariantChordsReactComponent = observer(function ({\n  features,\n  config,\n  displayModel,\n  blockDefinitions,\n  radius,\n  bezierRadius,\n  displayModel: { selectedFeatureId },\n  onChordClick,\n}: {\n  features: Map<string, Feature>\n  radius: number\n  config: AnyConfigurationModel\n  displayModel: { id: string; selectedFeatureId: string }\n  blockDefinitions: Block[]\n  bezierRadius: number\n  onChordClick: (\n    feature: Feature,\n    reg: AnyRegion,\n    endBlock: AnyRegion,\n    evt: unknown,\n  ) => void\n}) {\n  // make a map of refName -> blockDefinition\n  const blocksForRefsMemo = useMemo(() => {\n    const blocksForRefs = {} as Record<string, Block>\n    for (const block of blockDefinitions) {\n      const regions = block.region.elided\n        ? block.region.regions\n        : [block.region]\n      for (const region of regions) {\n        blocksForRefs[region.refName] = block\n      }\n    }\n    return blocksForRefs\n  }, [blockDefinitions])\n\n  return (\n    <g\n      id={`chords-${typeof jest !== 'undefined' ? 'test' : displayModel.id}`}\n      data-testid=\"structuralVariantChordRenderer\"\n    >\n      {[...features.values()].map(feature => {\n        const id = feature.id()\n        const selected = String(selectedFeatureId) === String(id)\n\n        return (\n          <Chord\n            key={id}\n            feature={feature}\n            config={config}\n            radius={radius}\n            bezierRadius={bezierRadius}\n            blocksForRefs={blocksForRefsMemo}\n            selected={selected}\n            onClick={onChordClick}\n          />\n        )\n      })}\n    </g>\n  )\n})\n\nexport default StructuralVariantChordsReactComponent\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { Instance, types } from 'mobx-state-tree'\nimport { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const baseModel = baseModelFactory(pluginManager)\n  return types.compose(\n    baseModel,\n    types.model('VariantFeatureWidget', {\n      type: types.literal('VariantFeatureWidget'),\n      descriptions: types.frozen(),\n    }),\n  )\n}\n\nexport type VariantFeatureWidgetStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type VariantFeatureWidgetModel = Instance<VariantFeatureWidgetStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const configSchema = ConfigurationSchema('VariantFeatureWidget', {})\n","import VcfAdapterF from './VcfAdapter'\nimport VcfTabixAdapterF from './VcfTabixAdapter'\nimport ExtensionPointsF from './extensionPoints'\nimport VariantTrackF from './VariantTrack'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ChordVariantDisplayF from './ChordVariantDisplay'\nimport LinearVariantDisplayF from './LinearVariantDisplay'\nimport StructuralVariantChordRendererF from './StructuralVariantChordRenderer'\nimport VariantFeatureWidgetF from './VariantFeatureWidget'\n\nexport default class VariantsPlugin extends Plugin {\n  name = 'VariantsPlugin'\n\n  install(pluginManager: PluginManager) {\n    VcfAdapterF(pluginManager)\n    VcfTabixAdapterF(pluginManager)\n    VariantFeatureWidgetF(pluginManager)\n    VariantTrackF(pluginManager)\n    ExtensionPointsF(pluginManager)\n    LinearVariantDisplayF(pluginManager)\n    StructuralVariantChordRendererF(pluginManager)\n    ChordVariantDisplayF(pluginManager)\n  }\n}\n\nexport { default as VcfFeature } from './VcfFeature'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport configSchemaF from './configSchema'\n\nexport default function VariantTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'VariantTrack',\n      displayName: 'Variant track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'VariantTrack', configSchema),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function VcfAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'VcfAdapter',\n        displayName: 'VCF adapter',\n        configSchema,\n        getAdapterClass: () => import('./VcfAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport { default as configSchema } from './configSchema'\n\nexport default function VcfTabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'VcfTabixAdapter',\n        displayName: 'VCF tabix adapter',\n        configSchema,\n        getAdapterClass: () => import('./VcfTabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { stateModelFactory } from './stateModelFactory'\nimport { configSchema } from './configSchema'\n\nexport default function VariantFeatureWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'VariantFeatureWidget',\n        heading: 'Feature details',\n        configSchema: configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(() => import('./VariantFeatureWidget')),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config VariantTrack\n * Mostly similar to feature track, but has `ChordDisplayType` registered to it,\n * and custom feature details in `LinearVariantDisplay`\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'VariantTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  makeIndexType,\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default function ExtensionPointsF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.vcf\\.b?gz$/i\n        const adapterName = 'VcfTabixAdapter'\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n        const obj = {\n          type: adapterName,\n          vcfGzLocation: file,\n          index: {\n            location: index || makeIndex(file, '.tbi'),\n            indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n          },\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'VcfTabixAdapter' || adapterName === 'VcfAdapter') {\n          return 'VariantTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.vcf$/i\n        const adapterName = 'VcfAdapter'\n        const fileName = getFileName(file)\n        if (regexGuess.test(fileName) || adapterHint === adapterName) {\n          return {\n            type: adapterName,\n            vcfLocation: file,\n          }\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport stateModelFactory from './model'\nimport configSchemaF from './configSchema'\n\nexport default function LinearVariantDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearVariantDisplay',\n      displayName: 'Variant display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'VariantTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #config LinearVariantDisplay\n * mostly empty, this display type is very much\n * like a `FeatureTrack` with a `LinearBasicDisplay` except it has a custom\n * feature details widget\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearVariantDisplay',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type LinearVariantDisplayConfigModel = ReturnType<typeof configSchemaF>\nexport type LinearVariantDisplayConfig =\n  Instance<LinearVariantDisplayConfigModel>\n","import ChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport ReactComponent from './ReactComponent'\n\nexport default function StructuralVariantChordRendererF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addRendererType(\n    () =>\n      new ChordRendererType({\n        name: 'StructuralVariantChordRenderer',\n        displayName: 'SV chord renderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseChordDisplayComponent } from '@jbrowse/plugin-circular-view'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\n// locals\nimport configSchemaF from './models/configSchema'\nimport stateModelF from './models/stateModelFactory'\n\nexport default function ChordVariantDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    const stateModel = stateModelF(configSchema)\n    return new DisplayType({\n      name: 'ChordVariantDisplay',\n      displayName: 'Chord variant display',\n      configSchema,\n      stateModel,\n      trackType: 'VariantTrack',\n      viewType: 'CircularView',\n      ReactComponent: BaseChordDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseChordDisplayConfig } from '@jbrowse/plugin-circular-view'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config ChordVariantDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction stateModelFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ChordVariantDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'StructuralVariantChordRenderer' },\n      ),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseChordDisplayConfig,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default stateModelFactory\n","import {\n  BaseChordDisplayModel,\n  CircularViewModel,\n} from '@jbrowse/plugin-circular-view'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport { Feature, getContainingView } from '@jbrowse/core/util'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\n\n/**\n * #stateModel ChordVariantDisplay\n * extends\n * - [BaseChordDisplay](../basechorddisplay)\n */\nconst stateModelFactory = (configSchema: AnyConfigurationSchemaType) => {\n  return types\n    .compose(\n      'ChordVariantDisplay',\n      BaseChordDisplayModel,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('ChordVariantDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n\n      /**\n       * #method\n       */\n      renderProps(): Record<string, unknown> {\n        const view = getContainingView(self) as CircularViewModel\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n          radius: view.radiusPx,\n          blockDefinitions: self.blockDefinitions,\n          config: self.configuration.renderer,\n          onChordClick: (arg: Feature) => self.onChordClick(arg),\n        }\n      },\n    }))\n}\n\n// http://localhost:3000/test_data/hs37d5.HG002-SequelII-CCS.sv.vcf.gz.tbi\n\n// render request is for 1.5x the current viewing window\n\n// tracks all have a height\n//\nexport default stateModelFactory\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  measureText,\n  getContainingView,\n  getContainingTrack,\n} from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport {\n  BaseLinearDisplayComponent,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// locals\nimport { WiggleDisplayModel } from '../models/model'\nimport YScaleBar from '../../shared/YScaleBar'\n\ntype LGV = LinearGenomeViewModel\n\nconst LinearWiggleDisplay = observer((props: { model: WiggleDisplayModel }) => {\n  const { model } = props\n  const { stats, height, needsScalebar } = model\n\n  const { trackLabels } = getContainingView(model) as LGV\n  const track = getContainingTrack(model)\n  const left =\n    trackLabels === 'overlapping'\n      ? measureText(getConf(track, 'name'), 12.8) + 100\n      : 50\n  return (\n    <div>\n      <BaseLinearDisplayComponent {...props} />\n      {stats && needsScalebar ? (\n        <svg\n          style={{\n            position: 'absolute',\n            top: 0,\n            left,\n            pointerEvents: 'none',\n            height,\n            width: 50,\n          }}\n        >\n          <YScaleBar model={model} />\n        </svg>\n      ) : null}\n    </div>\n  )\n})\n\nexport default LinearWiggleDisplay\n","import FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport { renderToAbstractCanvas, Feature } from '@jbrowse/core/util'\nimport { ThemeOptions } from '@mui/material'\n\n// locals\nimport { ScaleOpts, Source } from './util'\n\nexport interface RenderArgs extends FeatureRenderArgs {\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n  displayCrossHatches: boolean\n  ticks: { values: number[] }\n  themeOptions: ThemeOptions\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n}\n\nexport interface MultiRenderArgsDeserialized\n  extends RenderArgsDeserializedWithFeatures {\n  sources: Source[]\n}\n\nexport default abstract class WiggleBaseRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const { height, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // @ts-expect-error\n    const { reducedFeatures, ...rest } = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      ctx =>\n        this.draw(ctx, {\n          ...renderProps,\n          features,\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...rest,\n      features,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...rest,\n      features: reducedFeatures\n        ? new Map<string, Feature>(\n            reducedFeatures.map((r: Feature) => [r.id(), r]),\n          )\n        : results.features,\n      height,\n      width,\n      containsNoTransferables: true,\n    }\n  }\n\n  /**\n   * draw features to context given props, to be used by derived renderer\n   * classes\n   */\n  abstract draw<T extends RenderArgsDeserializedWithFeatures>(\n    ctx: CanvasRenderingContext2D,\n    props: T,\n  ): Promise<Record<string, unknown> | void>\n}\n\nexport {\n  type RenderArgsSerialized,\n  type RenderResults,\n  type ResultsDeserialized,\n  type ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BigWigAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BigWigAdapter = ConfigurationSchema(\n  'BigWigAdapter',\n  {\n    /**\n     * #slot\n     */\n    bigWigLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bw',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    source: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Used for multiwiggle',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default BigWigAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config QuantitativeTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'QuantitativeTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MultiWiggleAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MultiWiggleAdapter = ConfigurationSchema(\n  'MultiWiggleAdapter',\n  {\n    /**\n     * #slot\n     */\n    subadapters: {\n      type: 'frozen',\n      defaultValue: [],\n      description: 'array of subadapter JSON objects',\n    },\n    /**\n     * #slot\n     */\n    bigWigs: {\n      type: 'frozen',\n      description:\n        'array of bigwig filenames, alternative to the subadapters slot',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default MultiWiggleAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config WiggleRenderer\n * this is the \"base wiggle renderer config schema\"\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst WiggleRenderer = ConfigurationSchema(\n  'WiggleRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of track, overrides posColor and negColor',\n      defaultValue: '#f0f',\n    },\n    /**\n     * #slot\n     */\n    posColor: {\n      type: 'color',\n      description: 'the color to use when the score is positive',\n      defaultValue: 'blue',\n    },\n    /**\n     * #slot\n     */\n    negColor: {\n      type: 'color',\n      description: 'the color to use when the score is negative',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    bicolorPivot: {\n      type: 'stringEnum',\n      model: types.enumeration('Scale type', [\n        'numeric',\n        'mean',\n        'z_score',\n        'none',\n      ]),\n      description: 'type of bicolor pivot',\n      defaultValue: 'numeric',\n    },\n    /**\n     * #slot\n     */\n    bicolorPivotValue: {\n      type: 'number',\n      defaultValue: 0,\n      description: 'value to use for bicolor pivot',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default WiggleRenderer\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config DensityRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'DensityRenderer',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { featureSpanPx, Feature, Region } from '@jbrowse/core/util'\n\n// locals\nimport { fillRectCtx, getScale, ScaleOpts } from './util'\n\nconst fudgeFactor = 0.3\nconst clipHeight = 2\n\nexport function drawDensity(\n  ctx: CanvasRenderingContext2D,\n  props: {\n    features: Map<string, Feature> | Feature[]\n    regions: Region[]\n    bpPerPx: number\n    scaleOpts: ScaleOpts\n    height: number\n    ticks: { values: number[] }\n    displayCrossHatches: boolean\n    config: AnyConfigurationModel\n  },\n) {\n  const { features, regions, bpPerPx, scaleOpts, height, config } = props\n  const [region] = regions\n  const pivot = readConfObject(config, 'bicolorPivot')\n  const pivotValue = readConfObject(config, 'bicolorPivotValue')\n  const negColor = readConfObject(config, 'negColor')\n  const posColor = readConfObject(config, 'posColor')\n  const color = readConfObject(config, 'color')\n  const clipColor = readConfObject(config, 'clipColor')\n  const crossing = pivot !== 'none' && scaleOpts.scaleType !== 'log'\n  const scale = getScale({\n    ...scaleOpts,\n    pivotValue: crossing ? pivotValue : undefined,\n    range: crossing ? [negColor, 'white', posColor] : ['white', posColor],\n  })\n\n  const scale2 = getScale({ ...scaleOpts, range: [0, height] })\n  const cb =\n    color === '#f0f'\n      ? (_: Feature, score: number) => scale(score)\n      : (feature: Feature, score: number) =>\n          readConfObject(config, 'color', { feature, score })\n  const [niceMin, niceMax] = scale2.domain()\n\n  let prevLeftPx = -Infinity\n  let hasClipping = false\n  const reducedFeatures = []\n  for (const feature of features.values()) {\n    const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n    // create reduced features, avoiding multiple features per px\n    if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n      reducedFeatures.push(feature)\n      prevLeftPx = leftPx\n    }\n    const score = feature.get('score')\n    hasClipping = hasClipping || score > niceMax || score < niceMin\n    const w = rightPx - leftPx + fudgeFactor\n    ctx.fillStyle = cb(feature, score)\n    ctx.fillRect(leftPx, 0, w, height)\n  }\n\n  // second pass: draw clipping\n  // avoid persisting the red fillstyle with save/restore\n  ctx.save()\n  if (hasClipping) {\n    ctx.fillStyle = clipColor\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + fudgeFactor\n      const score = feature.get('score')\n      if (score > niceMax) {\n        fillRectCtx(leftPx, 0, w, clipHeight, ctx)\n      } else if (score < niceMin && scaleOpts.scaleType !== 'log') {\n        fillRectCtx(leftPx, 0, w, clipHeight, ctx)\n      }\n    }\n  }\n  ctx.restore()\n\n  return { reducedFeatures }\n}\n","import { drawDensity } from '../drawDensity'\n\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\n\nexport default class DensityRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    return drawDensity(ctx, props)\n  }\n}\n","import { observer } from 'mobx-react'\nimport React, { useRef } from 'react'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\n\nconst WiggleRendering = observer(function (props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  onMouseLeave: Function\n  onMouseMove: Function\n  onFeatureClick: Function\n  blockKey: string\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n    onFeatureClick = () => {},\n  } = props\n  const [region] = regions\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number) {\n    // calculates feature under mouse\n    let offset = 0\n    if (ref.current) {\n      offset = ref.current.getBoundingClientRect().left\n    }\n    const offsetX = eventClientX - offset\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n    let featureUnderMouse\n    for (const feature of features.values()) {\n      // bpPerPx added to the end to accommodate \"reduced features\" (one feature per px)\n      if (\n        clientBp <= feature.get('end') + bpPerPx &&\n        clientBp >= feature.get('start')\n      ) {\n        featureUnderMouse = feature\n        break\n      }\n    }\n    return featureUnderMouse\n  }\n  return (\n    <div\n      ref={ref}\n      data-testid=\"wiggle-rendering-test\"\n      onMouseMove={event =>\n        onMouseMove(event, getFeatureUnderMouse(event.clientX)?.id())\n      }\n      onClick={event =>\n        onFeatureClick(event, getFeatureUnderMouse(event.clientX)?.id())\n      }\n      onMouseLeave={event => onMouseLeave(event)}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n})\n\nexport default WiggleRendering\n","import {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { colord, Colord } from '@jbrowse/core/util/colord'\n// required to import this for typescript purposes\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport mix from 'colord/plugins/mix'\n\nimport { clamp, featureSpanPx, Feature, Region } from '@jbrowse/core/util'\n\n// locals\nimport { fillRectCtx, getOrigin, getScale, ScaleOpts } from './util'\n\nfunction lighten(color: Colord, amount: number) {\n  const hslColor = color.toHsl()\n  const l = hslColor.l * (1 + amount)\n  return colord({ ...hslColor, l: clamp(l, 0, 100) })\n}\n\nfunction darken(color: Colord, amount: number) {\n  const hslColor = color.toHsl()\n  const l = hslColor.l * (1 - amount)\n  return colord({ ...hslColor, l: clamp(l, 0, 100) })\n}\n\nconst fudgeFactor = 0.3\nconst clipHeight = 2\n\nexport function drawXY(\n  ctx: CanvasRenderingContext2D,\n  props: {\n    features: Map<string, Feature> | Feature[]\n    bpPerPx: number\n    regions: Region[]\n    scaleOpts: ScaleOpts\n    height: number\n    ticks: { values: number[] }\n    config: AnyConfigurationModel\n    displayCrossHatches: boolean\n    offset?: number\n    colorCallback: (f: Feature, score: number) => string\n  },\n) {\n  const {\n    features,\n    bpPerPx,\n    regions,\n    scaleOpts,\n    height: unadjustedHeight,\n    config,\n    ticks,\n    displayCrossHatches,\n    offset = 0,\n    colorCallback,\n  } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n\n  // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n  // wiggle display, and makes the height of the actual drawn area add\n  // \"padding\" to the top and bottom of the display\n  const height = unadjustedHeight - offset * 2\n\n  const filled = readConfObject(config, 'filled')\n  const clipColor = readConfObject(config, 'clipColor')\n  const summaryScoreMode = readConfObject(config, 'summaryScoreMode')\n  const pivotValue = readConfObject(config, 'bicolorPivotValue')\n  const minSize = readConfObject(config, 'minSize')\n\n  const scale = getScale({ ...scaleOpts, range: [0, height] })\n  const originY = getOrigin(scaleOpts.scaleType)\n  const [niceMin, niceMax] = scale.domain()\n\n  const toY = (n: number) => clamp(height - (scale(n) || 0), 0, height) + offset\n  const toOrigin = (n: number) => toY(originY) - toY(n)\n  const getHeight = (n: number) => (filled ? toOrigin(n) : Math.max(minSize, 1))\n  let hasClipping = false\n\n  let prevLeftPx = -Infinity\n  const reducedFeatures = []\n  const crossingOrigin = niceMin < pivotValue && niceMax > pivotValue\n\n  // we handle whiskers separately to render max row, min row, and avg in three\n  // passes. this reduces subpixel rendering issues. note: for stylistic\n  // reasons, clipping indicator is only drawn for score, not min/max score\n  if (summaryScoreMode === 'whiskers') {\n    let lastCol\n    let lastMix\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      if (feature.get('summary')) {\n        const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n        const max = feature.get('maxScore')\n        const c = colorCallback(feature, max)\n        const effectiveC = crossingOrigin\n          ? c\n          : c === lastCol\n            ? lastMix\n            : (lastMix = lighten(colord(c), 0.4).toHex())\n        fillRectCtx(leftPx, toY(max), w, getHeight(max), ctx, effectiveC)\n        lastCol = c\n      }\n    }\n    lastMix = undefined\n    lastCol = undefined\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const score = feature.get('score')\n      const max = feature.get('maxScore')\n      const min = feature.get('minScore')\n      const summary = feature.get('summary')\n      const c = colorCallback(feature, score)\n      const effectiveC =\n        crossingOrigin && summary\n          ? c === lastCol\n            ? lastMix\n            : (lastMix = colord(colorCallback(feature, max))\n                .mix(colord(colorCallback(feature, min)))\n                .toString())\n          : c\n      const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n      // create reduced features, avoiding multiple features per px\n      if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n        reducedFeatures.push(feature)\n        prevLeftPx = leftPx\n      }\n      hasClipping = hasClipping || score < niceMin || score > niceMax\n      fillRectCtx(leftPx, toY(score), w, getHeight(score), ctx, effectiveC)\n      lastCol = c\n    }\n    lastMix = undefined\n    lastCol = undefined\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n      if (feature.get('summary')) {\n        const min = feature.get('minScore')\n        const c = colorCallback(feature, min)\n        const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n        const effectiveC = crossingOrigin\n          ? c\n          : c === lastCol\n            ? lastMix\n            : (lastMix = darken(colord(c), 0.4).toHex())\n\n        fillRectCtx(leftPx, toY(min), w, getHeight(min), ctx, effectiveC)\n        lastCol = c\n      }\n    }\n  } else {\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n      // create reduced features, avoiding multiple features per px\n      if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n        reducedFeatures.push(feature)\n        prevLeftPx = leftPx\n      }\n\n      const score = feature.get('score')\n      const c = colorCallback(feature, score)\n\n      hasClipping = hasClipping || score < niceMin || score > niceMax\n      const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n\n      if (summaryScoreMode === 'max') {\n        const s = feature.get('summary') ? feature.get('maxScore') : score\n        fillRectCtx(leftPx, toY(s), w, getHeight(s), ctx, c)\n      } else if (summaryScoreMode === 'min') {\n        const s = feature.get('summary') ? feature.get('minScore') : score\n        fillRectCtx(leftPx, toY(s), w, getHeight(s), ctx, c)\n      } else {\n        fillRectCtx(leftPx, toY(score), w, getHeight(score), ctx, c)\n      }\n    }\n  }\n\n  // second pass: draw clipping\n  // avoid persisting the red fillstyle with save/restore\n  ctx.save()\n  if (hasClipping) {\n    ctx.fillStyle = clipColor\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + fudgeFactor\n      const score = feature.get('score')\n      if (score > niceMax) {\n        fillRectCtx(leftPx, offset, w, clipHeight, ctx)\n      } else if (score < niceMin && scaleOpts.scaleType !== 'log') {\n        fillRectCtx(leftPx, unadjustedHeight, w, clipHeight, ctx)\n      }\n    }\n  }\n  ctx.restore()\n\n  if (displayCrossHatches) {\n    ctx.lineWidth = 1\n    ctx.strokeStyle = 'rgba(200,200,200,0.5)'\n    ticks.values.forEach(tick => {\n      ctx.beginPath()\n      ctx.moveTo(0, Math.round(toY(tick)))\n      ctx.lineTo(width, Math.round(toY(tick)))\n      ctx.stroke()\n    })\n  }\n\n  return { reducedFeatures }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util'\nimport { drawXY } from '../drawXY'\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\n\nexport default class XYPlotRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { features, config } = props\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n\n    return drawXY(ctx, {\n      ...props,\n      colorCallback:\n        readConfObject(config, 'color') === '#f0f'\n          ? (_: Feature, score: number) =>\n              score < pivotValue ? negColor : posColor\n          : (feature: Feature, _score: number) =>\n              readConfObject(config, 'color', { feature }),\n      offset: YSCALEBAR_LABEL_OFFSET,\n      features: [...features.values()],\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config XYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'XYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config LinePlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'LinePlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { clamp, featureSpanPx, Feature, Region } from '@jbrowse/core/util'\n\n// locals\nimport { getScale, ScaleOpts } from './util'\n\nconst fudgeFactor = 0.3\nconst clipHeight = 2\n\nexport function drawLine(\n  ctx: CanvasRenderingContext2D,\n  props: {\n    features: Map<string, Feature> | Feature[]\n    regions: Region[]\n    bpPerPx: number\n    scaleOpts: ScaleOpts\n    height: number\n    ticks: { values: number[] }\n    displayCrossHatches: boolean\n    colorCallback: (f: Feature, score: number) => string\n    config: AnyConfigurationModel\n    offset?: number\n  },\n) {\n  const {\n    features,\n    regions,\n    bpPerPx,\n    scaleOpts,\n    height: unadjustedHeight,\n    ticks: { values },\n    displayCrossHatches,\n    colorCallback,\n    config,\n    offset = 0,\n  } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n\n  // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n  // wiggle display, and makes the height of the actual drawn area add\n  // \"padding\" to the top and bottom of the display\n  const height = unadjustedHeight - offset * 2\n  const clipColor = readConfObject(config, 'clipColor')\n  const scale = getScale({ ...scaleOpts, range: [0, height] })\n  const [niceMin, niceMax] = scale.domain()\n  const toY = (n: number) => clamp(height - (scale(n) || 0), 0, height) + offset\n\n  let lastVal: number | undefined\n  let prevLeftPx = -Infinity\n  const reducedFeatures = []\n  for (const feature of features.values()) {\n    const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n    // create reduced features, avoiding multiple features per px\n    if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n      reducedFeatures.push(feature)\n      prevLeftPx = leftPx\n    }\n    const score = feature.get('score')\n    const lowClipping = score < niceMin\n    const highClipping = score > niceMax\n    const w = rightPx - leftPx + fudgeFactor\n\n    const c = colorCallback(feature, score)\n\n    ctx.beginPath()\n    ctx.strokeStyle = c\n    const startPos = lastVal !== undefined ? lastVal : score\n    if (!region.reversed) {\n      ctx.moveTo(leftPx, toY(startPos))\n      ctx.lineTo(leftPx, toY(score))\n      ctx.lineTo(rightPx, toY(score))\n    } else {\n      ctx.moveTo(rightPx, toY(startPos))\n      ctx.lineTo(rightPx, toY(score))\n      ctx.lineTo(leftPx, toY(score))\n    }\n    ctx.stroke()\n    lastVal = score\n\n    if (highClipping) {\n      ctx.fillStyle = clipColor\n      ctx.fillRect(leftPx, offset, w, clipHeight)\n    } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n      ctx.fillStyle = clipColor\n      ctx.fillRect(leftPx, height - clipHeight, w, height)\n    }\n  }\n\n  if (displayCrossHatches) {\n    ctx.lineWidth = 1\n    ctx.strokeStyle = 'rgba(200,200,200,0.5)'\n    values.forEach(tick => {\n      ctx.beginPath()\n      ctx.moveTo(0, Math.round(toY(tick)))\n      ctx.lineTo(width, Math.round(toY(tick)))\n      ctx.stroke()\n    })\n  }\n  return { reducedFeatures }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util'\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\n\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\nimport { drawLine } from '../drawLine'\n\nexport default class LinePlotRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { config } = props\n    const c = readConfObject(config, 'color')\n    return drawLine(ctx, {\n      ...props,\n      offset: YSCALEBAR_LABEL_OFFSET,\n      colorCallback:\n        c === '#f0f'\n          ? () => 'grey'\n          : (feature: Feature) => readConfObject(config, 'color', { feature }),\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config SharedWiggleDisplay\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport default function sharedWiggleConfigFactory() {\n  return ConfigurationSchema(\n    'SharedWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n\n      /**\n       * #slot\n       */\n      minimalTicks: {\n        type: 'boolean',\n        defaultValue: false,\n        description: 'use the minimal amount of ticks',\n      },\n\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n\n      /**\n       * #slot\n       */\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { alpha, Portal, useTheme } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { Feature } from '@jbrowse/core/util'\nimport {\n  useClientPoint,\n  useFloating,\n  useInteractions,\n} from '@floating-ui/react'\n// locals\nimport { YSCALEBAR_LABEL_OFFSET, round } from './util'\n\nconst useStyles = makeStyles()(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: YSCALEBAR_LABEL_OFFSET,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\ntype Coord = [number, number]\n\n// React.forwardRef component for the tooltip, the ref is used for measuring\n// the size of the tooltip\nexport type TooltipContentsComponent = React.ForwardRefExoticComponent<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  { feature: Feature; model: any } & React.RefAttributes<HTMLDivElement>\n>\n\nconst Tooltip = observer(function Tooltip({\n  model,\n  height,\n  clientMouseCoord,\n  offsetMouseCoord,\n  clientRect,\n  TooltipContents,\n  useClientY,\n}: {\n  model: { featureUnderMouse: Feature }\n  useClientY?: boolean\n  height: number\n  clientMouseCoord: Coord\n  offsetMouseCoord: Coord\n  clientRect?: DOMRect\n  TooltipContents: TooltipContentsComponent\n}) {\n  const theme = useTheme()\n  const { featureUnderMouse } = model\n  const { classes } = useStyles()\n  const { refs, floatingStyles, context } = useFloating({\n    placement: 'right',\n    strategy: 'fixed',\n  })\n\n  const x = clientMouseCoord[0] + 5\n  const y = useClientY ? clientMouseCoord[1] : clientRect?.top || 0\n  const clientPoint = useClientPoint(context, { x, y })\n  const { getFloatingProps } = useInteractions([clientPoint])\n\n  const popperTheme = theme?.components?.MuiPopper\n\n  return featureUnderMouse ? (\n    <>\n      <Portal container={popperTheme?.defaultProps?.container}>\n        <div\n          className={classes.tooltip}\n          ref={refs.setFloating}\n          style={{\n            ...floatingStyles,\n            zIndex: 100000,\n            pointerEvents: 'none',\n          }}\n          {...getFloatingProps()}\n        >\n          <TooltipContents model={model} feature={featureUnderMouse} />\n        </div>\n      </Portal>\n\n      <div\n        className={classes.hoverVertical}\n        style={{\n          left: offsetMouseCoord[0],\n          height: height - YSCALEBAR_LABEL_OFFSET * 2,\n        }}\n      />\n    </>\n  ) : null\n})\n\nexport default Tooltip\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util'\n\n// locals\nimport Tooltip, { TooltipContentsComponent } from '../../Tooltip'\nimport { toP } from '../../util'\n\nconst en = (n: number) => n.toLocaleString('en-US')\n\ninterface Props {\n  feature: Feature\n}\n\nconst TooltipContents = React.forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ feature }, ref) {\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const name = feature.get('refName')\n    const loc = [name, start === end ? en(start) : `${en(start)}..${en(end)}`]\n      .filter(f => !!f)\n      .join(':')\n\n    return feature.get('summary') !== undefined ? (\n      <div ref={ref}>\n        {loc}\n        <br />\n        Max: {toP(feature.get('maxScore'))}\n        <br />\n        Avg: {toP(feature.get('score'))}\n        <br />\n        Min: {toP(feature.get('minScore'))}\n      </div>\n    ) : (\n      <div ref={ref}>\n        {loc}\n        <br />\n        {`${toP(feature.get('score'))}`}\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst WiggleTooltip = observer(function (props: {\n  model: { featureUnderMouse: Feature }\n  height: number\n  offsetMouseCoord: Coord\n  clientMouseCoord: Coord\n  clientRect?: DOMRect\n  TooltipContents?: TooltipContentsComponent\n}) {\n  return <Tooltip TooltipContents={TooltipContents} {...props} />\n})\nexport default WiggleTooltip\n\nexport { default as Tooltip } from '../../Tooltip'\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport {\n  Feature,\n  getEnv,\n  getSession,\n  isSelectionContainer,\n} from '@jbrowse/core/util'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\n\n// locals\nimport { getNiceDomain } from '../util'\nimport { lazy } from 'react'\n\n// lazies\nconst SetMinMaxDialog = lazy(() => import('./SetMinMaxDialog'))\n\n/**\n * #stateModel SharedWiggleMixin\n */\nexport default function SharedWiggleMixin(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        selectedRendering: types.optional(types.string, ''),\n        /**\n         * #property\n         */\n        resolution: types.optional(types.number, 1),\n        /**\n         * #property\n         */\n        fill: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        minSize: types.maybe(types.number),\n        /**\n         * #property\n         */\n        color: types.maybe(types.string),\n        /**\n         * #property\n         */\n        posColor: types.maybe(types.string),\n        /**\n         * #property\n         */\n        negColor: types.maybe(types.string),\n        /**\n         * #property\n         */\n        summaryScoreMode: types.maybe(types.string),\n        /**\n         * #property\n         */\n        rendererTypeNameState: types.maybe(types.string),\n        /**\n         * #property\n         */\n        scale: types.maybe(types.string),\n        /**\n         * #property\n         */\n        autoscale: types.maybe(types.string),\n        /**\n         * #property\n         */\n        displayCrossHatches: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        constraints: types.optional(\n          types.model({\n            max: types.maybe(types.number),\n            min: types.maybe(types.number),\n          }),\n          {},\n        ),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile(() => ({\n      message: undefined as undefined | string,\n      stats: undefined as { scoreMin: number; scoreMax: number } | undefined,\n      statsFetchInProgress: undefined as undefined | AbortController,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      updateQuantitativeStats(stats: { scoreMin: number; scoreMax: number }) {\n        const { scoreMin, scoreMax } = stats\n        const EPSILON = 0.000001\n        if (!self.stats) {\n          self.stats = { scoreMin, scoreMax }\n        } else if (\n          Math.abs(self.stats.scoreMax - scoreMax) > EPSILON ||\n          Math.abs(self.stats.scoreMin - scoreMin) > EPSILON\n        ) {\n          self.stats = { scoreMin, scoreMax }\n        }\n      },\n      /**\n       * #action\n       */\n      setColor(color?: string) {\n        self.color = color\n      },\n      /**\n       * #action\n       */\n      setPosColor(color?: string) {\n        self.posColor = color\n      },\n      /**\n       * #action\n       */\n      setNegColor(color?: string) {\n        self.negColor = color\n      },\n\n      /**\n       * #action\n       */\n      setLoading(aborter: AbortController) {\n        const { statsFetchInProgress: statsFetch } = self\n        if (statsFetch !== undefined && !statsFetch.signal.aborted) {\n          statsFetch.abort()\n        }\n        self.statsFetchInProgress = aborter\n      },\n\n      /**\n       * #action\n       * this overrides the BaseLinearDisplayModel to avoid popping up a\n       * feature detail display, but still sets the feature selection on the\n       * model so listeners can detect a click\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n\n      /**\n       * #action\n       */\n      setResolution(res: number) {\n        self.resolution = res\n      },\n\n      /**\n       * #action\n       */\n      setFill(fill: number) {\n        if (fill === 0) {\n          self.fill = true\n          self.minSize = 0\n        } else if (fill === 1) {\n          self.fill = false\n          self.minSize = 1\n        } else if (fill === 2) {\n          self.fill = false\n          self.minSize = 2\n        }\n      },\n\n      /**\n       * #action\n       */\n      toggleLogScale() {\n        self.scale = self.scale === 'log' ? 'linear' : 'log'\n      },\n\n      /**\n       * #action\n       */\n      setScaleType(scale?: string) {\n        self.scale = scale\n      },\n\n      /**\n       * #action\n       */\n      setSummaryScoreMode(val: string) {\n        self.summaryScoreMode = val\n      },\n\n      /**\n       * #action\n       */\n      setAutoscale(val: string) {\n        self.autoscale = val\n      },\n\n      /**\n       * #action\n       */\n      setMaxScore(val?: number) {\n        self.constraints.max = val\n      },\n\n      /**\n       * #action\n       */\n      setRendererType(val: string) {\n        self.rendererTypeNameState = val\n      },\n\n      /**\n       * #action\n       */\n      setMinScore(val?: number) {\n        self.constraints.min = val\n      },\n\n      /**\n       * #action\n       */\n      toggleCrossHatches() {\n        self.displayCrossHatches = !self.displayCrossHatches\n      },\n\n      /**\n       * #action\n       */\n      setCrossHatches(cross: boolean) {\n        self.displayCrossHatches = cross\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get adapterTypeName() {\n        return self.adapterConfig.type\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeNameSimple() {\n        return self.rendererTypeNameState ?? getConf(self, 'defaultRendering')\n      },\n\n      /**\n       * #getter\n       * subclasses can define these, as snpcoverage track does\n       */\n      get filters() {\n        return undefined\n      },\n\n      /**\n       * #getter\n       */\n      get scaleType() {\n        return self.scale ?? getConf(self, 'scaleType')\n      },\n\n      /**\n       * #getter\n       */\n      get maxScore() {\n        return self.constraints.max ?? getConf(self, 'maxScore')\n      },\n\n      /**\n       * #getter\n       */\n      get minScore() {\n        return self.constraints.min ?? getConf(self, 'minScore')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get adapterCapabilities() {\n        const type = self.adapterTypeName\n        const { pluginManager } = getEnv(self)\n        return pluginManager.getAdapterType(type).adapterCapabilities\n      },\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const {\n          color,\n          displayCrossHatches,\n          fill,\n          minSize,\n          negColor,\n          posColor,\n          summaryScoreMode,\n          scaleType,\n          rendererTypeName,\n        } = self\n        const configBlob = getConf(self, ['renderers', rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(scaleType ? { scaleType } : {}),\n            ...(fill !== undefined ? { filled: fill } : {}),\n            ...(displayCrossHatches !== undefined\n              ? { displayCrossHatches }\n              : {}),\n            ...(summaryScoreMode !== undefined ? { summaryScoreMode } : {}),\n            ...(color !== undefined ? { color } : {}),\n            ...(negColor !== undefined ? { negColor } : {}),\n            ...(posColor !== undefined ? { posColor } : {}),\n            ...(minSize !== undefined ? { minSize } : {}),\n          },\n          getEnv(self),\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get autoscaleType() {\n        return self.autoscale ?? getConf(self, 'autoscale')\n      },\n    }))\n    .views(self => {\n      let oldDomain: [number, number] = [0, 0]\n      return {\n        /**\n         * #getter\n         */\n        get domain() {\n          const { stats, scaleType, minScore, maxScore } = self\n          if (!stats) {\n            return undefined\n          }\n\n          const ret = getNiceDomain({\n            domain: [stats.scoreMin, stats.scoreMax],\n            bounds: [minScore, maxScore],\n            scaleType,\n          })\n\n          // avoid weird scalebar if log value and empty region displayed\n          if (scaleType === 'log' && ret[1] === Number.MIN_VALUE) {\n            return [0, Number.MIN_VALUE]\n          }\n\n          // avoid returning a new object if it matches the old value\n          if (JSON.stringify(oldDomain) !== JSON.stringify(ret)) {\n            oldDomain = ret\n          }\n\n          return oldDomain\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get filled(): boolean {\n        const { fill, rendererConfig } = self\n        return fill ?? readConfObject(rendererConfig, 'filled')\n      },\n      /**\n       * #getter\n       */\n      get summaryScoreModeSetting(): string {\n        const { summaryScoreMode: mode, rendererConfig } = self\n        return mode ?? readConfObject(rendererConfig, 'summaryScoreMode')\n      },\n\n      /**\n       * #getter\n       */\n      get scaleOpts() {\n        return {\n          domain: self.domain,\n          stats: self.stats,\n          autoscaleType: self.autoscaleType,\n          scaleType: self.scaleType,\n          inverted: getConf(self, 'inverted'),\n        }\n      },\n\n      /**\n       * #getter\n       */\n      get canHaveFill() {\n        return self.rendererTypeName === 'XYPlotRenderer'\n      },\n\n      /**\n       * #getter\n       */\n      get displayCrossHatchesSetting(): boolean {\n        const { displayCrossHatches: hatches, rendererConfig } = self\n        return hatches ?? readConfObject(rendererConfig, 'displayCrossHatches')\n      },\n      /**\n       * #getter\n       */\n      get hasResolution() {\n        return self.adapterCapabilities.includes('hasResolution')\n      },\n\n      /**\n       * #getter\n       */\n      get hasGlobalStats() {\n        return self.adapterCapabilities.includes('hasGlobalStats')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      scoreTrackMenuItems() {\n        return [\n          ...(self.hasResolution\n            ? [\n                {\n                  label: 'Resolution',\n                  subMenu: [\n                    {\n                      label: 'Finer resolution',\n                      onClick: () => self.setResolution(self.resolution * 5),\n                    },\n                    {\n                      label: 'Coarser resolution',\n                      onClick: () => self.setResolution(self.resolution / 5),\n                    },\n                  ],\n                },\n                {\n                  label: 'Summary score mode',\n                  subMenu: ['min', 'max', 'avg', 'whiskers'].map(elt => ({\n                    label: elt,\n                    type: 'radio',\n                    checked: self.summaryScoreModeSetting === elt,\n                    onClick: () => self.setSummaryScoreMode(elt),\n                  })),\n                },\n              ]\n            : []),\n          {\n            label:\n              self.scaleType === 'log' ? 'Set linear scale' : 'Set log scale',\n            onClick: () => self.toggleLogScale(),\n          },\n          {\n            label: 'Autoscale type',\n            subMenu: [\n              ['local', 'Local'],\n              ...(self.hasGlobalStats\n                ? [\n                    ['global', 'Global'],\n                    ['globalsd', 'Global ± 3σ'],\n                  ]\n                : []),\n              ['localsd', 'Local ± 3σ'],\n            ].map(([val, label]) => ({\n              label,\n              type: 'radio',\n              checked: self.autoscaleType === val,\n              onClick: () => self.setAutoscale(val),\n            })),\n          },\n          {\n            label: 'Set min/max score',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                SetMinMaxDialog,\n                { model: self, handleClose },\n              ])\n            },\n          },\n        ]\n      },\n    }))\n    .actions(self => {\n      const { reload: superReload } = self\n      return {\n        /**\n         * #action\n         */\n        async reload() {\n          self.setError()\n          superReload()\n        },\n      }\n    })\n}\n","import React, { lazy } from 'react'\nimport {\n  AnyConfigurationSchemaType,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { axisPropsFromTickScale } from 'react-d3-axis-mod'\nimport { ExportSvgDisplayOptions } from '@jbrowse/plugin-linear-genome-view'\n\n// locals\nimport { getScale, YSCALEBAR_LABEL_OFFSET } from '../../util'\n\nimport Tooltip from '../components/Tooltip'\nimport SharedWiggleMixin from '../../shared/modelShared'\n\n// lazies\nconst SetColorDialog = lazy(() => import('../components/SetColorDialog'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'XYPlotRenderer'],\n  ['density', 'DensityRenderer'],\n  ['line', 'LinePlotRenderer'],\n])\n\n/**\n * #stateModel LinearWiggleDisplay\n * extends\n * - [SharedWiggleMixin](../sharedwigglemixin)\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearWiggleDisplay',\n      SharedWiggleMixin(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearWiggleDisplay'),\n      }),\n    )\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get TooltipComponent() {\n        return Tooltip as React.FC\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        const name = self.rendererTypeNameSimple\n        const rendererType = rendererTypes.get(name)\n        if (!rendererType) {\n          throw new Error(`unknown renderer ${name}`)\n        }\n        return rendererType\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get ticks() {\n        const { scaleType, domain, height } = self\n        const minimalTicks = getConf(self, 'minimalTicks')\n        const inverted = getConf(self, 'inverted')\n        const range = [height - YSCALEBAR_LABEL_OFFSET, YSCALEBAR_LABEL_OFFSET]\n        if (!domain) {\n          return undefined\n        }\n        const scale = getScale({\n          scaleType,\n          domain,\n          range,\n          inverted,\n        })\n        const ticks = axisPropsFromTickScale(scale, 4)\n        return height < 100 || minimalTicks\n          ? { ...ticks, values: domain }\n          : ticks\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const superProps = superRenderProps()\n          const { filters, ticks, height, resolution, scaleOpts } = self\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !self.stats,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            config: self.rendererConfig,\n            displayCrossHatches: self.displayCrossHatchesSetting,\n            scaleOpts,\n            resolution,\n            height,\n            ticks,\n            filters,\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get needsScalebar() {\n          const { rendererTypeName: type } = self\n          return type === 'XYPlotRenderer' || type === 'LinePlotRenderer'\n        },\n        /**\n         * #getter\n         */\n        get fillSetting() {\n          if (self.filled) {\n            return 0\n          } else if (!self.filled && self.minSize === 1) {\n            return 1\n          } else {\n            return 2\n          }\n        },\n      }\n    })\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      const hasRenderings = getConf(self, 'defaultRendering')\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Score',\n              subMenu: self.scoreTrackMenuItems(),\n            },\n\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: 'Fill mode',\n                    subMenu: ['filled', 'no fill', 'no fill w/ emphasis'].map(\n                      (elt, idx) => ({\n                        label: elt,\n                        type: 'radio',\n                        checked: self.fillSetting === idx,\n                        onClick: () => self.setFill(idx),\n                      }),\n                    ),\n                  },\n                ]\n              : []),\n\n            ...(self.needsScalebar\n              ? [\n                  {\n                    type: 'checkbox',\n                    label: 'Draw cross hatches',\n                    checked: self.displayCrossHatchesSetting,\n                    onClick: () => self.toggleCrossHatches(),\n                  },\n                ]\n              : []),\n\n            ...(hasRenderings\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: ['xyplot', 'density', 'line'].map(key => ({\n                      label: key,\n                      type: 'radio',\n                      checked: self.rendererTypeNameSimple === key,\n                      onClick: () => self.setRendererType(key),\n                    })),\n                  },\n                ]\n              : []),\n\n            {\n              label: 'Set color',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetColorDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => {\n      const { renderSvg: superRenderSvg } = self\n\n      return {\n        afterAttach() {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          ;(async () => {\n            const { quantitativeStatsAutorun } = await import('../../util')\n            quantitativeStatsAutorun(self)\n          })()\n        },\n        /**\n         * #action\n         */\n        async renderSvg(opts: ExportSvgDisplayOptions) {\n          const { renderSvg } = await import('./renderSvg')\n          return renderSvg(self, opts, superRenderSvg)\n        },\n      }\n    })\n}\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util'\n\n// locals\nimport { Source, toP } from '../../util'\nimport Tooltip, { TooltipContentsComponent } from '../../Tooltip'\n\nconst en = (n: number) => n.toLocaleString('en-US')\n\ninterface Props {\n  model: { sources: Source[] }\n  feature: Feature\n}\nconst TooltipContents = React.forwardRef<HTMLDivElement, Props>(\n  function TooltipContents2({ model, feature }, ref) {\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const refName = feature.get('refName')\n    const coord = start === end ? en(start) : `${en(start)}..${en(end)}`\n    const sources = feature.get('sources') as Record<string, { score: number }>\n    const source = feature.get('source')\n    const summary = feature.get('summary')\n    const obj = Object.fromEntries(model.sources.map(ent => [ent.name, ent]))\n\n    return (\n      <div ref={ref}>\n        {[refName, coord].filter(f => !!f).join(':')}\n        <br />\n        {sources ? (\n          <table>\n            <thead>\n              <tr>\n                <th>color</th>\n                <th>source</th>\n                <th>score</th>\n              </tr>\n            </thead>\n            <tbody>\n              {Object.entries(sources).map(([source, data]) => (\n                <tr key={source}>\n                  <td style={{ background: obj[source]?.color }}> </td>\n                  <td>{source}</td>\n                  <td>{toP(data.score)}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        ) : (\n          <span>\n            {source}{' '}\n            {summary\n              ? `min:${toP(feature.get('minScore'))} avg:${toP(\n                  feature.get('score'),\n                )} max:${toP(feature.get('maxScore'))}`\n              : toP(feature.get('score'))}\n          </span>\n        )}\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst WiggleTooltip = observer(\n  (props: {\n    model: { featureUnderMouse: Feature; sources: Source[]; rowHeight: number }\n    height: number\n    offsetMouseCoord: Coord\n    clientMouseCoord: Coord\n    clientRect?: DOMRect\n    TooltipContents?: TooltipContentsComponent\n  }) => {\n    return <Tooltip useClientY TooltipContents={TooltipContents} {...props} />\n  },\n)\nexport default WiggleTooltip\n\nexport { default as Tooltip } from '../../Tooltip'\n","import React, { lazy } from 'react'\nimport { addDisposer, isAlive, types, Instance } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport { axisPropsFromTickScale } from 'react-d3-axis-mod'\nimport deepEqual from 'fast-deep-equal'\n\n// jbrowse imports\nimport {\n  AnyConfigurationSchemaType,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { set1 as colors } from '@jbrowse/core/ui/colors'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ExportSvgDisplayOptions } from '@jbrowse/plugin-linear-genome-view'\n\n// locals\nimport { getScale, YSCALEBAR_LABEL_OFFSET } from '../../util'\n\nimport Tooltip from '../components/Tooltip'\nimport SharedWiggleMixin from '../../shared/modelShared'\n\nconst randomColor = () =>\n  '#000000'.replaceAll('0', () => (~~(Math.random() * 16)).toString(16))\n\n// lazies\nconst SetColorDialog = lazy(() => import('../components/SetColorDialog'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'MultiXYPlotRenderer'],\n  ['multirowxy', 'MultiRowXYPlotRenderer'],\n  ['multirowdensity', 'MultiDensityRenderer'],\n  ['multiline', 'MultiLineRenderer'],\n  ['multirowline', 'MultiRowLineRenderer'],\n])\n\ninterface Source {\n  name: string\n  color?: string\n  group?: string\n}\n\n/**\n * #stateModel MultiLinearWiggleDisplay\n * extends\n * - [SharedWiggleMixin](../sharedwigglemixin)\n */\nexport function stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'MultiLinearWiggleDisplay',\n      SharedWiggleMixin(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('MultiLinearWiggleDisplay'),\n\n        /**\n         * #property\n         */\n        layout: types.optional(types.frozen<Source[]>(), []),\n      }),\n    )\n    .volatile(() => ({\n      featureUnderMouseVolatile: undefined as Feature | undefined,\n      sourcesVolatile: undefined as Source[] | undefined,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setLayout(layout: Source[]) {\n        self.layout = layout\n      },\n      /**\n       * #action\n       */\n      clearLayout() {\n        self.layout = []\n      },\n\n      /**\n       * #action\n       */\n      setSources(sources: Source[]) {\n        if (!deepEqual(sources, self.sourcesVolatile)) {\n          self.sourcesVolatile = sources\n        }\n      },\n\n      /**\n       * #action\n       */\n      setFeatureUnderMouse(f?: Feature) {\n        self.featureUnderMouseVolatile = f\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        return self.featureUnderMouseVolatile\n      },\n      /**\n       * #getter\n       */\n      get TooltipComponent() {\n        return Tooltip as unknown as React.FC\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        const name = self.rendererTypeNameSimple\n        const rendererType = rendererTypes.get(name)\n        if (!rendererType) {\n          throw new Error(`unknown renderer ${name}`)\n        }\n        return rendererType\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get needsScalebar() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiLineRenderer' ||\n          self.rendererTypeName === 'MultiRowLineRenderer'\n        )\n      },\n      /**\n       * #getter\n       */\n      get needsFullHeightScalebar() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiLineRenderer'\n        )\n      },\n      /**\n       * #getter\n       */\n      get isMultiRow() {\n        return (\n          self.rendererTypeName === 'MultiRowXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowLineRenderer' ||\n          self.rendererTypeName === 'MultiDensityRenderer'\n        )\n      },\n      /**\n       * #getter\n       * can be used to give it a \"color scale\" like a R heatmap, not\n       * implemented like this yet but flag can be used for this\n       */\n      get needsCustomLegend() {\n        return self.rendererTypeName === 'MultiDensityRenderer'\n      },\n\n      get canHaveFill() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer'\n        )\n      },\n      /**\n       * #getter\n       * the multirowxy and multiline don't need to use colors on the legend\n       * boxes since their track is drawn with the color. sort of a stylistic\n       * choice\n       */\n      get renderColorBoxes() {\n        return !(\n          self.rendererTypeName === 'MultiRowLineRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer'\n        )\n      },\n      /**\n       * #getter\n       * positions multi-row below the tracklabel even if using overlap\n       * tracklabels for everything else\n       */\n      get prefersOffset() {\n        return this.isMultiRow\n      },\n      /**\n       * #getter\n       */\n      get sources() {\n        const sources = Object.fromEntries(\n          self.sourcesVolatile?.map(s => [s.name, s]) || [],\n        )\n        const iter = self.layout.length ? self.layout : self.sourcesVolatile\n        return iter\n          ?.map(s => ({\n            ...sources[s.name],\n            ...s,\n          }))\n          .map((s, i) => ({\n            ...s,\n            color:\n              s.color ||\n              (!this.isMultiRow ? colors[i] || randomColor() : 'blue'),\n          }))\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rowHeight() {\n        const { sources, height, isMultiRow } = self\n        return isMultiRow ? height / (sources?.length || 1) : height\n      },\n      /**\n       * #getter\n       */\n      get rowHeightTooSmallForScalebar() {\n        return this.rowHeight < 70\n      },\n\n      /**\n       * #getter\n       */\n      get useMinimalTicks() {\n        return (\n          getConf(self, 'minimalTicks') || this.rowHeightTooSmallForScalebar\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get ticks() {\n        const { scaleType, domain, isMultiRow, rowHeight, useMinimalTicks } =\n          self\n\n        if (!domain) {\n          return undefined\n        }\n\n        const offset = isMultiRow ? 0 : YSCALEBAR_LABEL_OFFSET\n        const ticks = axisPropsFromTickScale(\n          getScale({\n            scaleType,\n            domain,\n            range: [rowHeight - offset, offset],\n            inverted: getConf(self, 'inverted') as boolean,\n          }),\n          4,\n        )\n        return useMinimalTicks ? { ...ticks, values: domain } : ticks\n      },\n\n      /**\n       * #getter\n       */\n      get colors() {\n        return [\n          'red',\n          'blue',\n          'green',\n          'orange',\n          'purple',\n          'cyan',\n          'pink',\n          'darkblue',\n          'darkred',\n          'pink',\n        ]\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const superProps = superRenderProps()\n          const {\n            displayCrossHatches,\n            filters,\n            height,\n            resolution,\n            rpcDriverName,\n            scaleOpts,\n            stats,\n            sources,\n            ticks,\n            rendererConfig: config,\n          } = self\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !sources || !stats,\n            displayModel: self,\n            config,\n            displayCrossHatches,\n            filters,\n            height,\n            resolution,\n            rpcDriverName,\n            scaleOpts,\n            sources,\n            ticks,\n            onMouseMove: (_: unknown, f: Feature) =>\n              self.setFeatureUnderMouse(f),\n            onMouseLeave: () => self.setFeatureUnderMouse(undefined),\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get hasResolution() {\n          return self.adapterCapabilities.includes('hasResolution')\n        },\n\n        /**\n         * #getter\n         */\n        get hasGlobalStats() {\n          return self.adapterCapabilities.includes('hasGlobalStats')\n        },\n\n        /**\n         * #getter\n         */\n        get fillSetting() {\n          if (self.filled) {\n            return 0\n          } else if (!self.filled && self.minSize === 1) {\n            return 1\n          } else {\n            return 2\n          }\n        },\n      }\n    })\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      const hasRenderings = getConf(self, 'defaultRendering')\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Score',\n              subMenu: self.scoreTrackMenuItems(),\n            },\n\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: 'Fill mode',\n                    subMenu: ['filled', 'no fill', 'no fill w/ emphasis'].map(\n                      (elt, idx) => ({\n                        label: elt,\n                        type: 'radio',\n                        checked: self.fillSetting === idx,\n                        onClick: () => self.setFill(idx),\n                      }),\n                    ),\n                  },\n                ]\n              : []),\n\n            ...(self.needsScalebar\n              ? [\n                  {\n                    type: 'checkbox',\n                    label: 'Draw cross hatches',\n                    checked: self.displayCrossHatchesSetting,\n                    onClick: () => self.toggleCrossHatches(),\n                  },\n                ]\n              : []),\n            ...(hasRenderings\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: [\n                      'xyplot',\n                      'multirowxy',\n                      'multirowdensity',\n                      'multiline',\n                      'multirowline',\n                    ].map(key => ({\n                      label: key,\n                      type: 'radio',\n                      checked: self.rendererTypeNameSimple === key,\n                      onClick: () => self.setRendererType(key),\n                    })),\n                  },\n                ]\n              : []),\n\n            {\n              label: 'Edit colors/arrangement...',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetColorDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => {\n      const { renderSvg: superRenderSvg } = self\n      return {\n        afterAttach() {\n          // eslint-disable-next-line @typescript-eslint/no-floating-promises\n          ;(async () => {\n            const { quantitativeStatsAutorun } = await import('../../util')\n            quantitativeStatsAutorun(self)\n            addDisposer(\n              self,\n              autorun(async () => {\n                const { rpcManager } = getSession(self)\n                const { adapterConfig } = self\n                const sessionId = getRpcSessionId(self)\n                const sources = (await rpcManager.call(\n                  sessionId,\n                  'MultiWiggleGetSources',\n                  {\n                    sessionId,\n                    adapterConfig,\n                  },\n                )) as Source[]\n                if (isAlive(self)) {\n                  self.setSources(sources)\n                }\n              }),\n            )\n          })()\n        },\n\n        /**\n         * #action\n         */\n        async renderSvg(opts: ExportSvgDisplayOptions) {\n          const { renderSvg } = await import('./renderSvg')\n          return renderSvg(self, opts, superRenderSvg)\n        },\n      }\n    })\n}\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import { observer } from 'mobx-react'\nimport React, { useRef } from 'react'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport { SimpleFeature, Feature } from '@jbrowse/core/util'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { Source } from './util'\n\nconst MultiWiggleRendering = observer(function (props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  onMouseLeave: Function\n  onMouseMove: Function\n  onFeatureClick: Function\n  blockKey: string\n  sources: Source[]\n  displayModel: { isMultiRow: boolean }\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    sources,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n    onFeatureClick = () => {},\n    displayModel,\n  } = props\n  const [region] = regions\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number, eventClientY: number) {\n    if (!ref.current) {\n      return\n    }\n    const rect = ref.current.getBoundingClientRect()\n    const offsetX = eventClientX - rect.left\n    const offsetY = eventClientY - rect.top\n    const source = sources[Math.floor((offsetY / height) * sources.length)]\n    if (!source) {\n      return\n    }\n    const px = region.reversed ? width - offsetX : offsetX\n    const mouseoverBp = region.start + bpPerPx * px\n    let featureUnderMouse\n    if (displayModel.isMultiRow) {\n      for (const feature of features.values()) {\n        if (feature.get('source') !== source.name) {\n          continue\n        }\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featureUnderMouse = feature\n          break\n        }\n      }\n    } else {\n      const featuresUnderMouse = []\n      for (const feature of features.values()) {\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featuresUnderMouse.push(feature)\n        }\n      }\n\n      if (featuresUnderMouse.length) {\n        const pos = Math.floor(mouseoverBp)\n        featureUnderMouse = new SimpleFeature({\n          uniqueId: 'mouseoverfeat',\n          sources: Object.fromEntries(\n            featuresUnderMouse\n              .map(f => f.toJSON())\n              .map(f => {\n                const { refName, start, end, source, ...rest } = f\n                return [source, rest]\n              }),\n          ),\n          ...region,\n          start: pos,\n          end: pos + 1,\n        })\n      }\n    }\n    return featureUnderMouse\n  }\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={event => {\n        const { clientX, clientY } = event\n        const featureUnderMouse = getFeatureUnderMouse(clientX, clientY)\n        onMouseMove(event, featureUnderMouse)\n      }}\n      onClick={event => {\n        const { clientX, clientY } = event\n        const featureUnderMouse = getFeatureUnderMouse(clientX, clientY)\n        onFeatureClick(event, featureUnderMouse)\n      }}\n      onMouseLeave={event => onMouseLeave(event)}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n})\n\nexport default MultiWiggleRendering\n","import { groupBy, Feature } from '@jbrowse/core/util'\nimport { drawXY } from '../drawXY'\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\n\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { sources, features } = props\n    const groups = groupBy(features.values(), f => f.get('source'))\n    let feats = [] as Feature[]\n    for (const source of sources) {\n      const features = groups[source.name] || []\n      const { reducedFeatures } = drawXY(ctx, {\n        ...props,\n        features,\n        offset: YSCALEBAR_LABEL_OFFSET,\n        colorCallback: () => source.color || 'blue',\n      })\n      feats = feats.concat(reducedFeatures)\n    }\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiXYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiXYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default configSchema\n","import { groupBy, Feature } from '@jbrowse/core/util'\nimport { drawXY } from '../drawXY'\n\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { bpPerPx, sources, regions, features } = props\n    const [region] = regions\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const height = props.height / sources.length\n    const width = (region.end - region.start) / bpPerPx\n    let feats = [] as Feature[]\n    ctx.save()\n    sources.forEach(source => {\n      const { reducedFeatures } = drawXY(ctx, {\n        ...props,\n        features: groups[source.name] || [],\n        height,\n        colorCallback: () => source.color || 'blue',\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { types } from 'mobx-state-tree'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiRowXYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiRowXYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiDensityRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiDensityRenderer',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { groupBy, Feature } from '@jbrowse/core/util'\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\nimport { drawDensity } from '../drawDensity'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { bpPerPx, sources, regions, features } = props\n    const [region] = regions\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const height = props.height / sources.length\n    const width = (region.end - region.start) / bpPerPx\n    let feats = [] as Feature[]\n    ctx.save()\n    sources.forEach(source => {\n      const features = groups[source.name] || []\n      const { reducedFeatures } = drawDensity(ctx, {\n        ...props,\n        features,\n        height,\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { groupBy, Feature } from '@jbrowse/core/util'\nimport { drawLine } from '../drawLine'\n\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiLineRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { sources, features } = props\n    const groups = groupBy(features.values(), f => f.get('source'))\n    let feats = [] as Feature[]\n    sources.forEach(source => {\n      const { reducedFeatures } = drawLine(ctx, {\n        ...props,\n        features: groups[source.name] || [],\n        colorCallback: () => source.color || 'blue',\n      })\n      feats = feats.concat(reducedFeatures)\n    })\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n/**\n * #config MultiLineRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiLineRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default configSchema\n","import { groupBy, Feature } from '@jbrowse/core/util'\nimport { drawLine } from '../drawLine'\n\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiRowLineRenderer extends WiggleBaseRenderer {\n  // @ts-expect-error\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { bpPerPx, sources, regions, features } = props\n    const [region] = regions\n    const groups = groupBy(features.values(), f => f.get('source'))\n    const height = props.height / sources.length\n    const width = (region.end - region.start) / bpPerPx\n    let feats = [] as Feature[]\n    ctx.save()\n    sources.forEach(source => {\n      const { reducedFeatures } = drawLine(ctx, {\n        ...props,\n        features: groups[source.name] || [],\n        height,\n        colorCallback: () => source.color || 'blue',\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { types } from 'mobx-state-tree'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiRowLineRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiRowLineRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession, isSessionWithAddTracks } from '@jbrowse/core/util'\nimport { HierarchicalTrackSelectorModel } from '@jbrowse/plugin-data-management'\n\nconst ConfirmDialog = lazy(() => import('./ConfirmDialog'))\n\nexport default function CreateMultiWiggleExtensionF(pm: PluginManager) {\n  pm.addToExtensionPoint(\n    'TrackSelector-multiTrackMenuItems',\n    (items: unknown[], props: Record<string, unknown>) => {\n      const { session } = props\n      return [\n        ...items,\n        ...(isSessionWithAddTracks(session)\n          ? [\n              {\n                label: 'Create multi-wiggle track',\n                onClick: (model: HierarchicalTrackSelectorModel) => {\n                  const tracks = model.selection\n                  const trackIds = tracks.map(c => readConfObject(c, 'name'))\n                  function makeTrack(arg: { name: string }) {\n                    const subadapters = tracks\n                      .map(c => readConfObject(c, 'adapter'))\n                      .map((c, idx) => ({ ...c, source: trackIds[idx] }))\n                    const assemblyNames = [\n                      ...new Set(\n                        tracks.flatMap(c => readConfObject(c, 'assemblyNames')),\n                      ),\n                    ]\n                    const now = +Date.now()\n                    const trackId = `multitrack-${now}-sessionTrack`\n\n                    const session = getSession(model)\n                    if (isSessionWithAddTracks(session)) {\n                      session.addTrackConf({\n                        type: 'MultiQuantitativeTrack',\n                        trackId,\n                        name: arg.name,\n                        assemblyNames,\n                        adapter: {\n                          type: 'MultiWiggleAdapter',\n                          subadapters,\n                        },\n                      })\n                      model.view.showTrack(trackId)\n                    }\n                  }\n                  getSession(model).queueDialog(handleClose => [\n                    ConfirmDialog,\n                    {\n                      tracks,\n                      onClose: (arg: boolean, arg1?: { name: string }) => {\n                        if (arg && arg1) {\n                          makeTrack(arg1)\n                        }\n                        handleClose()\n                      },\n                    },\n                  ])\n                },\n              },\n            ]\n          : []),\n      ]\n    },\n  )\n}\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded, Region } from '@jbrowse/core/util'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\nexport class MultiWiggleGetSources extends RpcMethodType {\n  name = 'MultiWiggleGetSources'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: AnyConfigurationModel\n      signal?: RemoteAbortSignal\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-expect-error\n    return dataAdapter.getSources(regions, deserializedArgs)\n  }\n}\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { Region, renameRegionsIfNeeded } from '@jbrowse/core/util'\n\nexport class WiggleGetMultiRegionQuantitativeStats extends RpcMethodType {\n  name = 'WiggleGetMultiRegionQuantitativeStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-expect-error\n    return dataAdapter.getMultiRegionQuantitativeStats(\n      regions,\n      deserializedArgs,\n    )\n  }\n}\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { QuantitativeStats } from '@jbrowse/core/util/stats'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\nexport class WiggleGetGlobalQuantitativeStats extends RpcMethodType {\n  name = 'WiggleGetGlobalQuantitativeStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async execute(\n    args: {\n      adapterConfig: AnyConfigurationModel\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriverClassName: string,\n  ): Promise<QuantitativeStats> {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-expect-error\n    return dataAdapter.getGlobalStats(deserializedArgs)\n  }\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  AdapterGuesser,\n  TrackTypeGuesser,\n  getFileName,\n} from '@jbrowse/core/util/tracks'\n\n// locals\nimport WiggleBaseRenderer from './WiggleBaseRenderer'\n\nimport BigWigAdapterF from './BigWigAdapter'\nimport QuantitativeTrackF from './QuantitativeTrack'\nimport MultiQuantitativeTrackF from './MultiQuantitativeTrack'\nimport MultiWiggleAdapterF from './MultiWiggleAdapter'\nimport DensityRendererF from './DensityRenderer'\nimport XYPlotRendererF from './XYPlotRenderer'\nimport LinePlotRendererF from './LinePlotRenderer'\nimport LinearWiggleDisplayF from './LinearWiggleDisplay'\nimport MultiLinearWiggleDisplayF from './MultiLinearWiggleDisplay'\nimport MultiXYPlotRendererF from './MultiXYPlotRenderer'\nimport MultiRowXYPlotRendererF from './MultiRowXYPlotRenderer'\nimport MultiDensityRendererF from './MultiDensityRenderer'\nimport MultiLineRendererF from './MultiLineRenderer'\nimport MultiRowLineRendererF from './MultiRowLineRenderer'\nimport CreateMultiWiggleExtensionF from './CreateMultiWiggleExtension'\nimport MultiWiggleAddTrackWorkflowF from './MultiWiggleAddTrackWorkflow'\n\nimport * as utils from './util'\n\nimport {\n  WiggleGetGlobalQuantitativeStats,\n  WiggleGetMultiRegionQuantitativeStats,\n  MultiWiggleGetSources,\n} from './WiggleRPC/rpcMethods'\n\nimport {\n  ReactComponent as LinearWiggleDisplayReactComponent,\n  modelFactory as linearWiggleDisplayModelFactory,\n} from './LinearWiggleDisplay'\n\nimport {\n  ReactComponent as XYPlotRendererReactComponent,\n  configSchema as xyPlotRendererConfigSchema,\n  XYPlotRenderer,\n} from './XYPlotRenderer'\n\nexport default class WigglePlugin extends Plugin {\n  name = 'WigglePlugin'\n\n  install(pm: PluginManager) {\n    MultiWiggleAdapterF(pm)\n    BigWigAdapterF(pm)\n    QuantitativeTrackF(pm)\n    MultiQuantitativeTrackF(pm)\n    LinearWiggleDisplayF(pm)\n    MultiLinearWiggleDisplayF(pm)\n    LinePlotRendererF(pm)\n    XYPlotRendererF(pm)\n    DensityRendererF(pm)\n    MultiXYPlotRendererF(pm)\n    MultiRowXYPlotRendererF(pm)\n    MultiDensityRendererF(pm)\n    MultiLineRendererF(pm)\n    MultiRowLineRendererF(pm)\n    MultiWiggleAddTrackWorkflowF(pm)\n    CreateMultiWiggleExtensionF(pm)\n\n    pm.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (cb: AdapterGuesser) => {\n        return (file: FileLocation, index?: FileLocation, hint?: string) => {\n          const regexGuess = /\\.(bw|bigwig)$/i\n          const adapterName = 'BigWigAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            bigWigLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !hint) {\n            return obj\n          } else if (hint === adapterName) {\n            return obj\n          }\n\n          return cb(file, index, hint)\n        }\n      },\n    )\n    pm.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'BigWigAdapter') {\n            return 'QuantitativeTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pm.addRpcMethod(() => new WiggleGetGlobalQuantitativeStats(pm))\n    pm.addRpcMethod(() => new WiggleGetMultiRegionQuantitativeStats(pm))\n    pm.addRpcMethod(() => new MultiWiggleGetSources(pm))\n  }\n\n  exports = {\n    LinearWiggleDisplayReactComponent,\n    XYPlotRendererReactComponent,\n    XYPlotRenderer,\n    WiggleBaseRenderer,\n    linearWiggleDisplayModelFactory,\n    xyPlotRendererConfigSchema,\n    utils,\n  }\n}\n\nexport * from './util'\n\nexport { default as WiggleRendering } from './WiggleRendering'\nexport {\n  Tooltip,\n  ReactComponent as LinearWiggleDisplayReactComponent,\n  modelFactory as linearWiggleDisplayModelFactory,\n} from './LinearWiggleDisplay'\nexport { type TooltipContentsComponent } from './Tooltip'\n\nexport { default as WiggleBaseRenderer } from './WiggleBaseRenderer'\n","import configSchema from './configSchema'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function MultiWiggleAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MultiWiggleAdapter',\n        displayName: 'Multi-wiggle adapter',\n        configSchema,\n        adapterCapabilities: [\n          'hasResolution',\n          'hasLocalStats',\n          'hasGlobalStats',\n        ],\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./MultiWiggleAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function BigWigAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BigWigAdapter',\n        displayName: 'BigWig adapter',\n        configSchema,\n        adapterCapabilities: [\n          'hasResolution',\n          'hasLocalStats',\n          'hasGlobalStats',\n        ],\n        getAdapterClass: () => import('./BigWigAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default function QuantitativeTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'QuantitativeTrack',\n      displayName: 'Quantitative track',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'QuantitativeTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default function MultiQuantitativeTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'MultiQuantitativeTrack',\n      displayName: 'Multi-quantitative track',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'MultiQuantitativeTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config MultiQuantitativeTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'MultiQuantitativeTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport { lazy } from 'react'\n\nexport default function LinearWiggleDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    const stateModel = modelFactory(pluginManager, configSchema)\n    return new DisplayType({\n      name: 'LinearWiggleDisplay',\n      displayName: 'Wiggle display',\n      configSchema,\n      stateModel,\n      trackType: 'QuantitativeTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: lazy(() => import('./components/WiggleDisplayComponent')),\n    })\n  })\n}\n\nexport { default as Tooltip } from './components/Tooltip'\nexport { default as ReactComponent } from './components/WiggleDisplayComponent'\nexport { default as modelFactory } from './models/model'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport sharedWiggleConfigFactory from '../../shared/configShared'\n\n/**\n * #config LinearWiggleDisplay\n * extends\n * - [SharedWiggleDisplay](../sharedwiggledisplay)\n */\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const XYPlotRendererConfigSchema =\n    pluginManager.getRendererType('XYPlotRenderer').configSchema\n  const DensityRendererConfigSchema =\n    pluginManager.getRendererType('DensityRenderer').configSchema\n  const LinePlotRendererConfigSchema =\n    pluginManager.getRendererType('LinePlotRenderer').configSchema\n\n  return ConfigurationSchema(\n    'LinearWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['density', 'xyplot', 'line']),\n        defaultValue: 'xyplot',\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        DensityRenderer: DensityRendererConfigSchema,\n        XYPlotRenderer: XYPlotRendererConfigSchema,\n        LinePlotRenderer: LinePlotRendererConfigSchema,\n      }),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: sharedWiggleConfigFactory(),\n      explicitlyTyped: true,\n    },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport { lazy } from 'react'\n\nexport default function MultiLinearWiggleDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'MultiLinearWiggleDisplay',\n      displayName: 'Multi-wiggle display',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'MultiQuantitativeTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: lazy(() => import('./components/WiggleDisplayComponent')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport sharedWiggleConfigFactory from '../../shared/configShared'\n\n/**\n * #config MultiLinearWiggleDisplay\n * extends\n * - [SharedWiggleDisplay](../sharedwiggledisplay)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const MultiXYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'MultiXYPlotRenderer',\n  ).configSchema\n  const MultiDensityRendererConfigSchema = pluginManager.getRendererType(\n    'MultiDensityRenderer',\n  ).configSchema\n  const MultiRowXYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'MultiRowXYPlotRenderer',\n  ).configSchema\n  const MultiLineRendererConfigSchema =\n    pluginManager.getRendererType('MultiLineRenderer').configSchema\n  const MultiRowLineRendererConfigSchema = pluginManager.getRendererType(\n    'MultiRowLineRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'MultiLinearWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', [\n          'multirowxy',\n          'xyplot',\n          'multirowdensity',\n          'multiline',\n          'multirowline',\n        ]),\n        defaultValue: 'multirowxy',\n      },\n\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        MultiXYPlotRenderer: MultiXYPlotRendererConfigSchema,\n        MultiDensityRenderer: MultiDensityRendererConfigSchema,\n        MultiRowXYPlotRenderer: MultiRowXYPlotRendererConfigSchema,\n        MultiLineRenderer: MultiLineRendererConfigSchema,\n        MultiRowLineRenderer: MultiRowLineRendererConfigSchema,\n      }),\n\n      /**\n       * #slot\n       */\n      height: {\n        type: 'number',\n        defaultValue: 200,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: sharedWiggleConfigFactory(),\n      explicitlyTyped: true,\n    },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport ReactComponent from '../WiggleRendering'\nimport LinePlotRenderer from './LinePlotRenderer'\n\nexport default function LinePlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new LinePlotRenderer({\n        name: 'LinePlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import ReactComponent from '../WiggleRendering'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport XYPlotRenderer from './XYPlotRenderer'\nimport configSchema from './configSchema'\n\nexport default function XYPlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new XYPlotRenderer({\n        name: 'XYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n\nexport { default as XYPlotRenderer } from './XYPlotRenderer'\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default as configSchema } from './configSchema'\n","import configSchema from './configSchema'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport DensityRenderer from './DensityRenderer'\nimport ReactComponent from '../WiggleRendering'\n\nexport default function DensityRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new DensityRenderer({\n        name: 'DensityRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiXYPlotRenderer from './MultiXYPlotRenderer'\nimport configSchema from './configSchema'\n\nexport default function MultiXYPlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiXYPlotRenderer({\n        name: 'MultiXYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiRowXYPlotRenderer from './MultiRowXYPlotRenderer'\nimport configSchema from './configSchema'\n\nexport default function MultiRowXYPlotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiRowXYPlotRenderer({\n        name: 'MultiRowXYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiDensityRenderer from './MultiDensityRenderer'\n\nexport default function MultiDensityRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiDensityRenderer({\n        name: 'MultiDensityRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiLineRenderer from './MultiLineRenderer'\nimport configSchema from './configSchema'\n\nexport default function MultiLineRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiLineRenderer({\n        name: 'MultiLineRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiRowLineRenderer from './MultiRowLineRenderer'\nimport configSchema from './configSchema'\n\nexport default function MultiRowLineRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new MultiRowLineRenderer({\n        name: 'MultiRowLineRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AddTrackWorkflowType } from '@jbrowse/core/pluggableElementTypes'\nimport { types } from 'mobx-state-tree'\n\n// locals\nimport { lazy } from 'react'\n\nexport default function MultiWiggleAddTrackWorkflowF(pm: PluginManager) {\n  pm.addAddTrackWorkflowType(\n    () =>\n      new AddTrackWorkflowType({\n        name: 'Multi-wiggle track',\n        ReactComponent: lazy(() => import('./AddTrackWorkflow')),\n        stateModel: types.model({}),\n      }),\n  )\n}\n","import React from 'react'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { axisPropsFromTickScale, Axis, LEFT, RIGHT } from 'react-d3-axis-mod'\n\ntype Ticks = ReturnType<typeof axisPropsFromTickScale>\n\nconst YScaleBar = observer(function ({\n  model,\n  orientation,\n}: {\n  model: { ticks?: Ticks }\n  orientation?: string\n}) {\n  const { ticks } = model\n  const theme = useTheme()\n  return ticks ? (\n    <Axis\n      {...ticks}\n      shadow={2}\n      format={(n: number) => n}\n      style={{ orient: orientation === 'left' ? LEFT : RIGHT }}\n      bg={theme.palette.background.default}\n      fg={theme.palette.text.primary}\n    />\n  ) : null\n})\n\nexport default YScaleBar\n","import { scaleLinear, scaleLog, scaleQuantize } from 'd3-scale'\nimport { autorun } from 'mobx'\nimport {\n  isAbortException,\n  getSession,\n  getContainingView,\n} from '@jbrowse/core/util'\nimport { QuantitativeStats } from '@jbrowse/core/util/stats'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { addDisposer, isAlive } from 'mobx-state-tree'\n\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { AnyConfigurationModel, getConf } from '@jbrowse/core/configuration'\n\ntype LGV = LinearGenomeViewModel\n\nexport const YSCALEBAR_LABEL_OFFSET = 5\n\nexport interface ScaleOpts {\n  domain: number[]\n  range: number[]\n  scaleType: string\n  pivotValue?: number\n  inverted?: boolean\n}\n\nexport interface Source {\n  name: string\n  color?: string\n  group?: string\n}\n\n/**\n * produces a d3-scale from arguments. applies a \"nice domain\" adjustment\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - range [min,max]\n *   - bounds [min,max]\n *   - scaleType (linear or log)\n *   - pivotValue (number)\n *   - inverted (boolean)\n */\nexport function getScale({\n  domain = [],\n  range = [],\n  scaleType,\n  pivotValue,\n  inverted,\n}: ScaleOpts) {\n  let scale\n  const [min, max] = domain\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain')\n  }\n  if (scaleType === 'linear') {\n    scale = scaleLinear()\n  } else if (scaleType === 'log') {\n    scale = scaleLog()\n    scale.base(2)\n  } else if (scaleType === 'quantize') {\n    scale = scaleQuantize()\n  } else {\n    throw new Error('undefined scaleType')\n  }\n  scale.domain(pivotValue !== undefined ? [min, pivotValue, max] : [min, max])\n  scale.nice()\n\n  const [rangeMin, rangeMax] = range\n  if (rangeMin === undefined || rangeMax === undefined) {\n    throw new Error('invalid range')\n  }\n  scale.range(inverted ? range.slice().reverse() : range)\n  return scale\n}\n/**\n * gets the origin for drawing the graph. for linear this is 0, for log this is arbitrarily set to log(1)==0\n *\n * @param scaleType -\n */\nexport function getOrigin(scaleType: string /* , pivot, stats */) {\n  // if (pivot) {\n  //   if (pivot === 'mean') {\n  //     return stats.scoreMean || 0\n  //   }\n  //   if (pivot === 'zero') {\n  //     return 0\n  //   }\n  //   return parseFloat()\n  // }\n  // if (scaleType === 'z_score') {\n  //   return stats.scoreMean || 0\n  // }\n  if (scaleType === 'log') {\n    return 1\n  }\n  return 0\n}\n\n/**\n * produces a \"nice\" domain that actually rounds down to 0 for the min\n * or 0 to the max depending on if all values are positive or negative\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - bounds [min,max]\n *   - mean\n *   - stddev\n *   - scaleType (linear or log)\n */\nexport function getNiceDomain({\n  scaleType,\n  domain,\n  bounds,\n}: {\n  scaleType: string\n  domain: readonly [number, number]\n  bounds: readonly [number | undefined, number | undefined]\n}) {\n  const [minScore, maxScore] = bounds\n  let [min, max] = domain\n\n  if (scaleType === 'linear') {\n    if (max < 0) {\n      max = 0\n    }\n    if (min > 0) {\n      min = 0\n    }\n  }\n  if (scaleType === 'log') {\n    // if the min is 0, assume that it's just something\n    // with no read coverage and that we should ignore it in calculations\n    // if it's greater than 1 pin to 1 for the full range also\n    // otherwise, we may see bigwigs with fractional values\n    if (min === 0 || min > 1) {\n      min = 1\n    }\n  }\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain supplied to stats function')\n  }\n  if (minScore !== undefined && minScore !== Number.MIN_VALUE) {\n    min = minScore\n  }\n  if (maxScore !== undefined && maxScore !== Number.MAX_VALUE) {\n    max = maxScore\n  }\n  const getScaleType = (type: string) => {\n    if (type === 'linear') {\n      return scaleLinear()\n    }\n    if (type === 'log') {\n      const scale = scaleLog()\n      scale.base(2)\n      return scale\n    }\n    if (type === 'quantize') {\n      return scaleQuantize()\n    }\n    throw new Error(`undefined scaleType ${type}`)\n  }\n  const scale = getScaleType(scaleType)\n\n  scale.domain([min, max])\n  scale.nice()\n  return scale.domain() as [number, number]\n}\n\nexport async function getQuantitativeStats(\n  self: {\n    adapterConfig: AnyConfigurationModel\n    configuration: AnyConfigurationModel\n    autoscaleType: string\n    setMessage: (str: string) => void\n  },\n  opts: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n): Promise<QuantitativeStats> {\n  const { rpcManager } = getSession(self)\n  const nd = getConf(self, 'numStdDev') || 3\n  const { adapterConfig, autoscaleType } = self\n  const sessionId = getRpcSessionId(self)\n  const params = {\n    sessionId,\n    adapterConfig,\n    statusCallback: (message: string) => {\n      if (isAlive(self)) {\n        self.setMessage(message)\n      }\n    },\n    ...opts,\n  }\n\n  if (autoscaleType === 'global' || autoscaleType === 'globalsd') {\n    const results = (await rpcManager.call(\n      sessionId,\n      'WiggleGetGlobalQuantitativeStats',\n      params,\n    )) as QuantitativeStats\n    const { scoreMin, scoreMean, scoreStdDev } = results\n    // globalsd uses heuristic to avoid unnecessary scoreMin<0\n    // if the scoreMin is never less than 0\n    // helps with most coverage bigwigs just being >0\n    return autoscaleType === 'globalsd'\n      ? {\n          ...results,\n          scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n          scoreMax: scoreMean + nd * scoreStdDev,\n        }\n      : results\n  }\n  if (autoscaleType === 'local' || autoscaleType === 'localsd') {\n    const { dynamicBlocks, bpPerPx } = getContainingView(self) as LGV\n    const results = (await rpcManager.call(\n      sessionId,\n      'WiggleGetMultiRegionQuantitativeStats',\n      {\n        ...params,\n        regions: dynamicBlocks.contentBlocks.map(region => {\n          const { start, end } = region\n          return {\n            ...JSON.parse(JSON.stringify(region)),\n            start: Math.floor(start),\n            end: Math.ceil(end),\n          }\n        }),\n        bpPerPx,\n      },\n    )) as QuantitativeStats\n    const { scoreMin, scoreMean, scoreStdDev } = results\n\n    // localsd uses heuristic to avoid unnecessary scoreMin<0 if the\n    // scoreMin is never less than 0 helps with most coverage bigwigs\n    // just being >0\n    return autoscaleType === 'localsd'\n      ? {\n          ...results,\n          scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n          scoreMax: scoreMean + nd * scoreStdDev,\n        }\n      : results\n  }\n  if (autoscaleType === 'zscale') {\n    return rpcManager.call(\n      sessionId,\n      'WiggleGetGlobalQuantitativeStats',\n      params,\n    ) as Promise<QuantitativeStats>\n  }\n  throw new Error(`invalid autoscaleType '${autoscaleType}'`)\n}\n\nexport function quantitativeStatsAutorun(self: {\n  featureDensityStatsReady: boolean\n  regionTooLarge: boolean\n  error: unknown\n  setLoading: (aborter: AbortController) => void\n  setError: (error: unknown) => void\n  updateQuantitativeStats: (\n    stats: QuantitativeStats,\n    statsRegion: string,\n  ) => void\n  renderProps: () => Record<string, unknown>\n  configuration: AnyConfigurationModel\n  adapterConfig: AnyConfigurationModel\n  autoscaleType: string\n  setMessage: (str: string) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      async () => {\n        try {\n          const aborter = new AbortController()\n          const view = getContainingView(self) as LGV\n          self.setLoading(aborter)\n\n          if (\n            !view.initialized ||\n            !self.featureDensityStatsReady ||\n            self.regionTooLarge ||\n            self.error\n          ) {\n            return\n          }\n          const statsRegion = JSON.stringify(view.dynamicBlocks)\n\n          const wiggleStats = await getQuantitativeStats(self, {\n            signal: aborter.signal,\n            ...self.renderProps(),\n          })\n\n          if (isAlive(self)) {\n            self.updateQuantitativeStats(wiggleStats, statsRegion)\n          }\n        } catch (e) {\n          if (!isAbortException(e) && isAlive(self)) {\n            console.error(e)\n            self.setError(e)\n          }\n        }\n      },\n      { delay: 1000 },\n    ),\n  )\n}\n\nexport function toP(s = 0) {\n  return +(+s).toPrecision(6)\n}\n\nexport function round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\n\n// avoid drawing negative width features for SVG exports\nexport function fillRectCtx(\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  ctx: CanvasRenderingContext2D,\n  color?: string,\n) {\n  if (width < 0) {\n    x += width\n    width = -width\n  }\n  if (height < 0) {\n    y += height\n    height = -height\n  }\n\n  if (color) {\n    ctx.fillStyle = color\n  }\n  ctx.fillRect(x, y, width, height)\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config OAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst OAuthConfigSchema = ConfigurationSchema(\n  'OAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Bearer',\n    },\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    clientId: {\n      description: 'id for the OAuth application',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    state: {\n      description: 'optional state for the authorization call',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    responseType: {\n      description:\n        \"the type of response from the authorization endpoint. can be 'token' or 'code'\",\n      type: 'string',\n      defaultValue: 'code',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type OAuthInternetAccountConfigModel = typeof OAuthConfigSchema\nexport type OAuthInternetAccountConfig =\n  Instance<OAuthInternetAccountConfigModel>\nexport default OAuthConfigSchema\n","export function fixup(buf: string) {\n  return buf.replaceAll('+', '-').replaceAll('/', '_').replaceAll('=', '')\n}\n\nexport async function generateChallenge(val: string) {\n  const sha256 = await import('crypto-js/sha256').then(f => f.default)\n  const Base64 = await import('crypto-js/enc-base64')\n  return fixup(Base64.stringify(sha256(val)))\n}\n\n// if response is JSON, checks if it needs to remove tokens in error, or just plain throw\nexport function processError(text: string, invalidErrorCb: () => void) {\n  try {\n    const obj = JSON.parse(text)\n    if (obj.error === 'invalid_grant') {\n      invalidErrorCb()\n    }\n    return obj?.error_description ?? text\n  } catch (e) {\n    /* response text is not json, just use original text as error */\n  }\n  return text\n}\n\nexport function processTokenResponse(\n  data: { refresh_token?: string; access_token: string },\n  storeRefreshTokenCb: (str: string) => void,\n) {\n  if (data.refresh_token) {\n    storeRefreshTokenCb(data.refresh_token)\n  }\n  return data.access_token\n}\n","export async function getResponseError({\n  response,\n  reason,\n  statusText,\n}: {\n  response: Response\n  reason?: string\n  statusText?: string\n}) {\n  return [\n    `HTTP ${response.status}`,\n    reason,\n    statusText ?? (await getError(response)),\n  ]\n    .filter(f => !!f)\n    .join(' - ')\n}\n\nexport async function getError(response: Response) {\n  try {\n    return response.text()\n  } catch (e) {\n    return response.statusText\n  }\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { isElectron, UriLocation } from '@jbrowse/core/util'\nimport { Instance, types } from 'mobx-state-tree'\n\n// locals\nimport { OAuthInternetAccountConfigModel } from './configSchema'\nimport {\n  fixup,\n  generateChallenge,\n  processError,\n  processTokenResponse,\n} from './util'\nimport { getResponseError } from '../util'\n\ninterface OAuthData {\n  client_id: string\n  redirect_uri: string\n  response_type: 'token' | 'code'\n  scope?: string\n  code_challenge?: string\n  code_challenge_method?: string\n  token_access_type?: string\n  state?: string\n}\n\n/**\n * #stateModel OAuthInternetAccount\n */\nconst stateModelFactory = (configSchema: OAuthInternetAccountConfigModel) => {\n  return InternetAccount.named('OAuthInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('OAuthInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => {\n      let codeVerifier: string | undefined = undefined\n      return {\n        /**\n         * #getter\n         */\n        get codeVerifierPKCE() {\n          if (codeVerifier) {\n            return codeVerifier\n          }\n          const array = new Uint8Array(32)\n          globalThis.crypto.getRandomValues(array)\n          codeVerifier = fixup(Buffer.from(array).toString('base64'))\n          return codeVerifier\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get authEndpoint(): string {\n        return getConf(self, 'authEndpoint')\n      },\n      /**\n       * #getter\n       */\n      get tokenEndpoint(): string {\n        return getConf(self, 'tokenEndpoint')\n      },\n      /**\n       * #getter\n       */\n      get needsPKCE(): boolean {\n        return getConf(self, 'needsPKCE')\n      },\n      /**\n       * #getter\n       */\n      get clientId(): string {\n        return getConf(self, 'clientId')\n      },\n      /**\n       * #getter\n       */\n      get scopes(): string {\n        return getConf(self, 'scopes')\n      },\n      /**\n       * #method\n       * OAuth state parameter:\n       * https://www.rfc-editor.org/rfc/rfc6749#section-4.1.1\n       *\n       * Can override or extend if dynamic state is needed.\n       */\n      state(): string | undefined {\n        return getConf(self, 'state')\n      },\n      /**\n       * #getter\n       */\n      get responseType(): 'token' | 'code' {\n        return getConf(self, 'responseType')\n      },\n      /**\n       * #getter\n       */\n      get refreshTokenKey() {\n        return `${self.internetAccountId}-refreshToken`\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      storeRefreshToken(refreshToken: string) {\n        localStorage.setItem(self.refreshTokenKey, refreshToken)\n      },\n      /**\n       * #action\n       */\n      removeRefreshToken() {\n        localStorage.removeItem(self.refreshTokenKey)\n      },\n      /**\n       * #method\n       */\n      retrieveRefreshToken() {\n        return localStorage.getItem(self.refreshTokenKey)\n      },\n      /**\n       * #action\n       */\n      async exchangeAuthorizationForAccessToken(\n        token: string,\n        redirectUri: string,\n      ): Promise<string> {\n        const params = new URLSearchParams(\n          Object.entries({\n            code: token,\n            grant_type: 'authorization_code',\n            client_id: self.clientId,\n            redirect_uri: redirectUri,\n            ...(self.needsPKCE ? { code_verifier: self.codeVerifierPKCE } : {}),\n          }),\n        )\n\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: params.toString(),\n        })\n\n        if (!response.ok) {\n          throw new Error(\n            await getResponseError({\n              response,\n              reason: 'Failed to obtain token',\n            }),\n          )\n        }\n\n        const data = await response.json()\n        return processTokenResponse(data, token =>\n          this.storeRefreshToken(token),\n        )\n      },\n      /**\n       * #action\n       */\n      async exchangeRefreshForAccessToken(\n        refreshToken: string,\n      ): Promise<string> {\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: new URLSearchParams(\n            Object.entries({\n              grant_type: 'refresh_token',\n              refresh_token: refreshToken,\n              client_id: self.clientId,\n            }),\n          ).toString(),\n        })\n\n        if (!response.ok) {\n          self.removeToken()\n          const text = await response.text()\n          throw new Error(\n            await getResponseError({\n              response,\n              statusText: processError(text, () => this.removeRefreshToken()),\n            }),\n          )\n        }\n        const data = await response.json()\n        return processTokenResponse(data, token =>\n          this.storeRefreshToken(token),\n        )\n      },\n    }))\n    .actions(self => {\n      let listener: (event: MessageEvent) => void | undefined\n      let exchangedTokenPromise: Promise<string> | undefined = undefined\n      return {\n        /**\n         * #action\n         * used to listen to child window for auth code/token\n         */\n        addMessageChannel(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          listener = event => {\n            // this should probably get better handling, but ignored for now\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.finishOAuthWindow(event, resolve, reject)\n          }\n          window.addEventListener('message', listener)\n        },\n        /**\n         * #action\n         */\n        deleteMessageChannel() {\n          window.removeEventListener('message', listener)\n        },\n        /**\n         * #action\n         */\n        async finishOAuthWindow(\n          event: MessageEvent,\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          if (\n            event.data.name !== `JBrowseAuthWindow-${self.internetAccountId}`\n          ) {\n            return this.deleteMessageChannel()\n          }\n          const redirectUriWithInfo = event.data.redirectUri\n          const fixedQueryString = redirectUriWithInfo.replace('#', '?')\n          const redirectUrl = new URL(fixedQueryString)\n          const queryStringSearch = redirectUrl.search\n          const urlParams = new URLSearchParams(queryStringSearch)\n          if (urlParams.has('access_token')) {\n            const token = urlParams.get('access_token')\n            if (!token) {\n              return reject(new Error('Error with token endpoint'))\n            }\n            self.storeToken(token)\n            return resolve(token)\n          }\n          if (urlParams.has('code')) {\n            const code = urlParams.get('code')\n            if (!code) {\n              return reject(new Error('Error with authorization endpoint'))\n            }\n            try {\n              const token = await self.exchangeAuthorizationForAccessToken(\n                code,\n                redirectUrl.origin + redirectUrl.pathname,\n              )\n              self.storeToken(token)\n              return resolve(token)\n            } catch (e) {\n              return e instanceof Error\n                ? reject(e)\n                : reject(new Error(String(e)))\n            }\n          }\n          if (redirectUriWithInfo.includes('access_denied')) {\n            return reject(new Error('OAuth flow was cancelled'))\n          }\n          if (redirectUriWithInfo.includes('error')) {\n            return reject(new Error('OAuth flow error: ' + queryStringSearch))\n          }\n          this.deleteMessageChannel()\n        },\n        /**\n         * #action\n         * opens external OAuth flow, popup for web and new browser window for\n         * desktop\n         */\n        async useEndpointForAuthorization(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          const redirectUri = isElectron\n            ? 'http://localhost/auth'\n            : window.location.origin + window.location.pathname\n          const data: OAuthData = {\n            client_id: self.clientId,\n            redirect_uri: redirectUri,\n            response_type: self.responseType || 'code',\n            token_access_type: 'offline',\n          }\n\n          if (self.state()) {\n            data.state = self.state()\n          }\n\n          if (self.scopes) {\n            data.scope = self.scopes\n          }\n\n          if (self.needsPKCE) {\n            data.code_challenge = await generateChallenge(self.codeVerifierPKCE)\n            data.code_challenge_method = 'S256'\n          }\n\n          const params = new URLSearchParams(Object.entries(data))\n\n          const url = new URL(self.authEndpoint)\n          url.search = params.toString()\n\n          const eventName = `JBrowseAuthWindow-${self.internetAccountId}`\n          if (isElectron) {\n            const { ipcRenderer } = window.require('electron')\n            const redirectUri = await ipcRenderer.invoke('openAuthWindow', {\n              internetAccountId: self.internetAccountId,\n              data,\n              url: url.toString(),\n            })\n\n            const eventFromDesktop = new MessageEvent('message', {\n              data: { name: eventName, redirectUri: redirectUri },\n            })\n            // may want to improve handling\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.finishOAuthWindow(eventFromDesktop, resolve, reject)\n          } else {\n            window.open(url, eventName, `width=500,height=600,left=0,top=0`)\n          }\n        },\n        /**\n         * #action\n         */\n        async getTokenFromUser(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          const refreshToken = self.retrieveRefreshToken()\n          let doUserFlow = true\n\n          // if there is a refresh token, then try it out, and only if that\n          // refresh token succeeds, set doUserFlow to false\n          if (refreshToken) {\n            try {\n              const token =\n                await self.exchangeRefreshForAccessToken(refreshToken)\n              resolve(token)\n              doUserFlow = false\n            } catch (e) {\n              console.error(e)\n              self.removeRefreshToken()\n            }\n          }\n          if (doUserFlow) {\n            this.addMessageChannel(resolve, reject)\n            // may want to improve handling\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.useEndpointForAuthorization(resolve, reject)\n          }\n        },\n        /**\n         * #action\n         */\n        async validateToken(token: string, location: UriLocation) {\n          const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n          const response = await fetch(location.uri, newInit)\n          if (!response.ok) {\n            self.removeToken()\n            const refreshToken = self.retrieveRefreshToken()\n            if (refreshToken) {\n              try {\n                if (!exchangedTokenPromise) {\n                  exchangedTokenPromise =\n                    self.exchangeRefreshForAccessToken(refreshToken)\n                }\n                const newToken = await exchangedTokenPromise\n                exchangedTokenPromise = undefined\n                return newToken\n              } catch (err) {\n                console.error('Token could not be refreshed', err)\n                // let original error be thrown\n              }\n            }\n\n            throw new Error(\n              await getResponseError({\n                response,\n                reason: 'Error validating token',\n              }),\n            )\n          }\n          return token\n        },\n      }\n    })\n    .actions(self => {\n      const superGetFetcher = self.getFetcher\n      return {\n        /**\n         * #action\n         * Get a fetch method that will add any needed authentication headers\n         * to the request before sending it. If location is provided, it will\n         * be checked to see if it includes a token in it's pre-auth\n         * information.\n         *\n         * @param loc - UriLocation of the resource\n         * @returns A function that can be used to fetch\n         */\n        getFetcher(loc?: UriLocation) {\n          const fetcher = superGetFetcher(loc)\n          return async (input: RequestInfo, init?: RequestInit) => {\n            if (loc) {\n              await self.validateToken(await self.getToken(loc), loc)\n            }\n            return fetcher(input, init)\n          }\n        },\n      }\n    })\n}\n\nexport default stateModelFactory\nexport type OAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type OAuthModel = Instance<OAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config ExternalTokenInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ExternalTokenConfigSchema = ConfigurationSchema(\n  'ExternalTokenInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type ExternalTokenInternetAccountConfigModel =\n  typeof ExternalTokenConfigSchema\n\nexport type ExternalTokenInternetAccountConfig =\n  Instance<ExternalTokenInternetAccountConfigModel>\nexport default ExternalTokenConfigSchema\n","import React, { useState } from 'react'\nimport { Button, DialogContent, DialogActions, TextField } from '@mui/material'\nimport { Dialog } from '@jbrowse/core/ui'\n\nexport const ExternalTokenEntryForm = ({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (token?: string) => void\n}) => {\n  const [token, setToken] = useState('')\n\n  return (\n    <Dialog\n      open\n      maxWidth=\"xl\"\n      data-testid=\"externalToken-form\"\n      title={`Enter token for ${internetAccountId}`}\n    >\n      <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n        <TextField\n          required\n          label=\"Enter Token\"\n          variant=\"outlined\"\n          inputProps={{ 'data-testid': 'entry-externalToken' }}\n          onChange={event => setToken(event.target.value)}\n          margin=\"dense\"\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          disabled={!token}\n          onClick={() => {\n            if (token) {\n              handleClose(token)\n            }\n          }}\n        >\n          Add\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={() => handleClose()}\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { ExternalTokenInternetAccountConfigModel } from './configSchema'\nimport { Instance, types, getRoot } from 'mobx-state-tree'\n\nimport { ExternalTokenEntryForm } from './ExternalTokenEntryForm'\n\nconst stateModelFactory = (\n  configSchema: ExternalTokenInternetAccountConfigModel,\n) => {\n  return InternetAccount.named('ExternalTokenInternetAccount')\n    .props({\n      type: types.literal('ExternalTokenInternetAccount'),\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(self => ({\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const { session } = getRoot<any>(self)\n        session.queueDialog((doneCallback: () => void) => [\n          ExternalTokenEntryForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('user cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Token could not be validated — ${response.status} (${\n              response.statusText\n            })${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type ExternalTokenStateModel = ReturnType<typeof stateModelFactory>\nexport type ExternalTokenModel = Instance<ExternalTokenStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config HTTPBasicInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HTTPBasicConfigSchema = ConfigurationSchema(\n  'HTTPBasicInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Basic',\n    },\n    /**\n     * #slot\n     */\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type HTTPBasicInternetAccountConfigModel = typeof HTTPBasicConfigSchema\n\nexport type HTTPBasicInternetAccountConfig =\n  Instance<HTTPBasicInternetAccountConfigModel>\nexport default HTTPBasicConfigSchema\n","import React, { useState } from 'react'\nimport { Button, DialogContent, DialogActions, TextField } from '@mui/material'\nimport { Dialog } from '@jbrowse/core/ui'\n\nexport function HTTPBasicLoginForm({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (arg?: string) => void\n}) {\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n\n  return (\n    <Dialog\n      open\n      maxWidth=\"xl\"\n      data-testid=\"login-httpbasic\"\n      title={`Log in for ${internetAccountId}`}\n    >\n      <form\n        onSubmit={event => {\n          if (username && password) {\n            handleClose(btoa(`${username}:${password}`))\n          } else {\n            handleClose()\n          }\n          event.preventDefault()\n        }}\n      >\n        <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n          <TextField\n            required\n            label=\"Username\"\n            variant=\"outlined\"\n            inputProps={{ 'data-testid': 'login-httpbasic-username' }}\n            onChange={event => setUsername(event.target.value)}\n            margin=\"dense\"\n          />\n          <TextField\n            required\n            label=\"Password\"\n            type=\"password\"\n            autoComplete=\"current-password\"\n            variant=\"outlined\"\n            inputProps={{ 'data-testid': 'login-httpbasic-password' }}\n            onChange={event => setPassword(event.target.value)}\n            margin=\"dense\"\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button variant=\"contained\" color=\"primary\" type=\"submit\">\n            Submit\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            type=\"submit\"\n            onClick={() => handleClose()}\n          >\n            Cancel\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { Instance, types, getRoot } from 'mobx-state-tree'\n\n// locals\nimport { HTTPBasicInternetAccountConfigModel } from './configSchema'\nimport { HTTPBasicLoginForm } from './HTTPBasicLoginForm'\nimport { getResponseError } from '../util'\n\n/**\n * #stateModel HTTPBasicInternetAccount\n */\nconst stateModelFactory = (\n  configSchema: HTTPBasicInternetAccountConfigModel,\n) => {\n  return InternetAccount.named('HTTPBasicInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('HTTPBasicInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const { session } = getRoot<any>(self)\n        session.queueDialog((doneCallback: () => void) => [\n          HTTPBasicLoginForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('User cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      /**\n       * #action\n       */\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          throw new Error(\n            await getResponseError({\n              response,\n              reason: 'Error validating token',\n            }),\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type HTTPBasicStateModel = ReturnType<typeof stateModelFactory>\nexport type HTTPBasicModel = Instance<HTTPBasicStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\n/**\n * #config DropboxOAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DropboxOAuthConfigSchema = ConfigurationSchema(\n  'DropboxOAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://www.dropbox.com/oauth2/authorize',\n    },\n    /**\n     * #slot\n     */\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://api.dropbox.com/oauth2/token',\n    },\n    /**\n     * #slot\n     */\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [\n        'addtodropbox.com',\n        'db.tt',\n        'dropbox.com',\n        'dropboxapi.com',\n        'dropboxbusiness.com',\n        'dropbox.tech',\n        'getdropbox.com',\n      ],\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: OAuthConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport type DropboxOAuthInternetAccountConfigModel =\n  typeof DropboxOAuthConfigSchema\n\nexport type DropboxOAuthInternetAccountConfig =\n  Instance<DropboxOAuthInternetAccountConfigModel>\nexport default DropboxOAuthConfigSchema\n","import { getResponseError } from '../util'\n\ninterface DropboxError {\n  error_summary: string\n  error: {\n    '.tag': string\n  }\n}\n\n/**\n * Error messages from\n * https://www.dropbox.com/developers/documentation/http/documentation#sharing-get_shared_link_file\n * */\nconst dropboxErrorMessages: Record<string, string | undefined> = {\n  shared_link_not_found: \"The shared link wasn't found.\",\n  shared_link_access_denied:\n    'The caller is not allowed to access this shared link.',\n  unsupported_link_type:\n    'This type of link is not supported; use files/export instead.',\n  shared_link_is_directory: 'Directories cannot be retrieved by this endpoint.',\n}\n\nexport async function getDescriptiveErrorMessage(\n  response: Response,\n  reason?: string,\n) {\n  let errorMessage = ''\n  try {\n    const err = JSON.parse(await response.text()) as DropboxError\n    const tag = err.error['.tag']\n    errorMessage = dropboxErrorMessages[tag] || tag\n  } catch (error) {\n    /* do nothing */\n  }\n  return getResponseError({ response, reason, statusText: errorMessage })\n}\n","import React from 'react'\nimport { SvgIcon, SvgIconProps } from '@mui/material'\n\nexport default function DropboxIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z\" />\n    </SvgIcon>\n  )\n}\n","import React from 'react'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { Instance, types } from 'mobx-state-tree'\n\n// locals\nimport { DropboxOAuthInternetAccountConfigModel } from './configSchema'\nimport baseModel from '../OAuthModel/model'\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\nimport { getDescriptiveErrorMessage } from './util'\nimport DropboxIcon from './DropboxIcon'\n\n/**\n * #stateModel DropboxOAuthInternetAccount\n */\nconst stateModelFactory = (\n  configSchema: DropboxOAuthInternetAccountConfigModel,\n) => {\n  return baseModel(OAuthConfigSchema)\n    .named('DropboxOAuthInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('DropboxOAuthInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => ({\n      /**\n       * #getter\n       * The FileSelector icon for Dropbox\n       */\n      get toggleContents() {\n        return <DropboxIcon />\n      },\n      /**\n       * #getter\n       */\n      get selectorLabel() {\n        return 'Enter Dropbox share link'\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #method\n       */\n      getFetcher(location?: UriLocation) {\n        return async (input: RequestInfo, init?: RequestInit) => {\n          const authToken = await self.getToken(location)\n          const newInit = self.addAuthHeaderToInit(\n            { ...init, method: 'POST' },\n            authToken,\n          )\n          newInit.headers.append(\n            'Dropbox-API-Arg',\n            JSON.stringify({ url: input }),\n          )\n          const response = await fetch(\n            'https://content.dropboxapi.com/2/sharing/get_shared_link_file',\n            newInit,\n          )\n          if (!response.ok) {\n            throw new Error(await getDescriptiveErrorMessage(response))\n          }\n          return response\n        }\n      },\n      /**\n       * #action\n       */\n      async validateToken(\n        token: string,\n        location: UriLocation,\n      ): Promise<string> {\n        const response = await fetch(\n          'https://api.dropboxapi.com/2/sharing/get_shared_link_metadata',\n          {\n            method: 'POST',\n            headers: {\n              Authorization: `Bearer ${token}`,\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              url: location.uri,\n            }),\n          },\n        )\n        if (!response.ok) {\n          const refreshToken = self.retrieveRefreshToken()\n          if (refreshToken) {\n            self.removeRefreshToken()\n            const newToken =\n              await self.exchangeRefreshForAccessToken(refreshToken)\n            return this.validateToken(newToken, location)\n          }\n          throw new Error(\n            await getDescriptiveErrorMessage(\n              response,\n              'Token could not be validated',\n            ),\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type DropboxOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type DropboxOAuthModel = Instance<DropboxOAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\n/**\n * #config GoogleDriveOAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GoogleDriveOAuthConfigSchema = ConfigurationSchema(\n  'GoogleDriveOAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://accounts.google.com/o/oauth2/v2/auth',\n    },\n    /**\n     * #slot\n     */\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: 'https://www.googleapis.com/auth/drive.readonly',\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: ['drive.google.com\"'],\n    },\n    /**\n     * #slot\n     */\n    responseType: {\n      description: 'the type of response from the authorization endpoint',\n      type: 'string',\n      defaultValue: 'token',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: OAuthConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport type GoogleDriveOAuthInternetAccountConfigModel =\n  typeof GoogleDriveOAuthConfigSchema\n\nexport type GoogleDriveOAuthInternetAccountConfig =\n  Instance<GoogleDriveOAuthInternetAccountConfigModel>\nexport default GoogleDriveOAuthConfigSchema\n","import { getResponseError } from '../util'\n\ninterface GoogleDriveError {\n  error: {\n    errors: {\n      domain: string\n      reason: string\n      message: string\n      locationType?: string\n      location?: string\n    }[]\n    code: number\n    message: string\n  }\n}\n\nexport async function getDescriptiveErrorMessage(\n  response: Response,\n  reason?: string,\n) {\n  let errorMessage = ''\n  try {\n    const err = JSON.parse(await response.text()) as GoogleDriveError\n    errorMessage = err.error.message\n  } catch (error) {\n    /* do nothing */\n  }\n  return getResponseError({ response, reason, statusText: errorMessage })\n}\n","import { RemoteFileWithRangeCache } from '@jbrowse/core/util/io'\nimport {\n  FilehandleOptions,\n  Stats,\n  PolyfilledResponse,\n} from 'generic-filehandle'\n\nexport interface RequestInitWithMetadata extends RequestInit {\n  metadataOnly?: boolean\n}\n\ninterface GoogleDriveFilehandleOptions extends FilehandleOptions {\n  fetch(\n    input: RequestInfo,\n    opts?: RequestInitWithMetadata,\n  ): Promise<PolyfilledResponse>\n}\n\nexport class GoogleDriveFile extends RemoteFileWithRangeCache {\n  private statsPromise: Promise<{ size: number }>\n  constructor(source: string, opts: GoogleDriveFilehandleOptions) {\n    super(source, opts)\n    this.statsPromise = this.fetch(source, {\n      metadataOnly: true,\n    }).then((response: Response) => response.json())\n  }\n\n  async fetch(\n    input: RequestInfo,\n    opts?: RequestInitWithMetadata,\n  ): Promise<PolyfilledResponse> {\n    return super.fetch(input, opts)\n  }\n\n  async stat(): Promise<Stats> {\n    return this.statsPromise\n  }\n}\n","import React from 'react'\nimport { SvgIconProps, SvgIcon } from '@mui/material'\n\nexport default function GoogleDriveIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z\" />\n    </SvgIcon>\n  )\n}\n","import React from 'react'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { Instance, types } from 'mobx-state-tree'\nimport { UriLocation } from '@jbrowse/core/util/types'\n\n// locals\nimport { GoogleDriveOAuthInternetAccountConfigModel } from './configSchema'\nimport baseModel from '../OAuthModel/model'\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\nimport { getDescriptiveErrorMessage } from './util'\nimport { GoogleDriveFile } from './GoogleDriveFilehandle'\nimport GoogleDriveIcon from './GoogleDriveIcon'\n\nexport interface RequestInitWithMetadata extends RequestInit {\n  metadataOnly?: boolean\n}\n\nfunction getUri(str: string) {\n  const urlId = str.match(/[-\\w]{25,}/)\n  return `https://www.googleapis.com/drive/v3/files/${urlId}`\n}\n\n/**\n * #stateModel GoogleDriveOAuthInternetAccount\n */\nexport default function stateModelFactory(\n  configSchema: GoogleDriveOAuthInternetAccountConfigModel,\n) {\n  return baseModel(OAuthConfigSchema)\n    .named('GoogleDriveOAuthInternetAccount')\n    .props({\n      /**\n       * #property\n       */\n      type: types.literal('GoogleDriveOAuthInternetAccount'),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => ({\n      /**\n       * #getter\n       * The FileSelector icon for Google drive\n       */\n      get toggleContents() {\n        return <GoogleDriveIcon />\n      },\n      /**\n       * #getter\n       */\n      get selectorLabel() {\n        return 'Enter Google Drive share link'\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #method\n       */\n      getFetcher(location?: UriLocation) {\n        return async (input: RequestInfo, init?: RequestInitWithMetadata) => {\n          const driveUrl = new URL(getUri(String(input)))\n          const searchParams = new URLSearchParams()\n          if (init?.metadataOnly) {\n            searchParams.append('fields', 'size')\n          } else {\n            searchParams.append('alt', 'media')\n          }\n          driveUrl.search = searchParams.toString()\n          const authToken = await self.getToken(location)\n          const response = await fetch(\n            driveUrl,\n            self.addAuthHeaderToInit(\n              { ...init, method: 'GET', credentials: 'same-origin' },\n              authToken,\n            ),\n          )\n          if (!response.ok) {\n            throw new Error(await getDescriptiveErrorMessage(response))\n          }\n          return response\n        }\n      },\n      /**\n       * #method\n       */\n      openLocation(location: UriLocation) {\n        return new GoogleDriveFile(location.uri, {\n          fetch: this.getFetcher(location),\n        })\n      },\n      /**\n       * #action\n       */\n      async validateToken(token: string, location: UriLocation) {\n        const response = await fetch(getUri(location.uri), {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n        })\n        if (!response.ok) {\n          throw new Error(\n            await getDescriptiveErrorMessage(\n              response,\n              'Token could not be validated',\n            ),\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport type GoogleDriveOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type GoogleDriveOAuthModel = Instance<GoogleDriveOAuthStateModel>\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport InternetAccountType from '@jbrowse/core/pluggableElementTypes/InternetAccountType'\nimport {\n  configSchema as OAuthConfigSchema,\n  modelFactory as OAuthInternetAccountModelFactory,\n} from './OAuthModel'\nimport {\n  configSchema as ExternalTokenConfigSchema,\n  modelFactory as ExternalTokenInternetAccountModelFactory,\n} from './ExternalTokenModel'\nimport {\n  configSchema as HTTPBasicConfigSchema,\n  modelFactory as HTTPBasicInternetAccountModelFactory,\n} from './HTTPBasicModel'\nimport {\n  configSchema as DropboxOAuthConfigSchema,\n  modelFactory as DropboxOAuthInternetAccountModelFactory,\n} from './DropboxOAuthModel'\nimport {\n  configSchema as GoogleDriveOAuthConfigSchema,\n  modelFactory as GoogleDriveOAuthInternetAccountModelFactory,\n} from './GoogleDriveOAuthModel'\n\nexport default class AuthenticationPlugin extends Plugin {\n  name = 'AuthenticationPlugin'\n\n  exports = {\n    OAuthConfigSchema,\n    OAuthInternetAccountModelFactory,\n    ExternalTokenConfigSchema,\n    ExternalTokenInternetAccountModelFactory,\n    HTTPBasicConfigSchema,\n    HTTPBasicInternetAccountModelFactory,\n    DropboxOAuthConfigSchema,\n    DropboxOAuthInternetAccountModelFactory,\n    GoogleDriveOAuthConfigSchema,\n    GoogleDriveOAuthInternetAccountModelFactory,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'OAuthInternetAccount',\n        configSchema: OAuthConfigSchema,\n        stateModel: OAuthInternetAccountModelFactory(OAuthConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'ExternalTokenInternetAccount',\n        configSchema: ExternalTokenConfigSchema,\n        stateModel: ExternalTokenInternetAccountModelFactory(\n          ExternalTokenConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'HTTPBasicInternetAccount',\n        configSchema: HTTPBasicConfigSchema,\n        stateModel: HTTPBasicInternetAccountModelFactory(HTTPBasicConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'DropboxOAuthInternetAccount',\n        configSchema: DropboxOAuthConfigSchema,\n        stateModel: DropboxOAuthInternetAccountModelFactory(\n          DropboxOAuthConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'GoogleDriveOAuthInternetAccount',\n        configSchema: GoogleDriveOAuthConfigSchema,\n        stateModel: GoogleDriveOAuthInternetAccountModelFactory(\n          GoogleDriveOAuthConfigSchema,\n        ),\n      })\n    })\n  }\n}\n\nexport {\n  configSchema as OAuthConfigSchema,\n  modelFactory as OAuthInternetAccountModelFactory,\n} from './OAuthModel'\nexport {\n  configSchema as ExternalTokenConfigSchema,\n  modelFactory as ExternalTokenInternetAccountModelFactory,\n} from './ExternalTokenModel'\n\nexport {\n  configSchema as HTTPBasicConfigSchema,\n  modelFactory as HTTPBasicInternetAccountModelFactory,\n} from './HTTPBasicModel'\n\nexport {\n  configSchema as DropboxOAuthConfigSchema,\n  modelFactory as DropboxOAuthInternetAccountModelFactory,\n} from './DropboxOAuthModel'\n\nexport {\n  configSchema as GoogleDriveOAuthConfigSchema,\n  modelFactory as GoogleDriveOAuthInternetAccountModelFactory,\n} from './GoogleDriveOAuthModel'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BigBedAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BigBedAdapter = ConfigurationSchema(\n  'BigBedAdapter',\n  {\n    /**\n     * #slot\n     */\n    bigBedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bb', locationType: 'UriLocation' },\n    },\n\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default BigBedAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BedpeAdapter\n * intended for SVs in a single assembly\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedpeAdapter = ConfigurationSchema(\n  'BedpeAdapter',\n  {\n    /**\n     * #slot\n     * can be plaintext or gzipped, not indexed so loaded into memory on startup\n     */\n    bedpeLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bedpe.gz',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BedpeAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config BedTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedTabixAdapter = ConfigurationSchema(\n  'BedTabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz', locationType: 'UriLocation' },\n    },\n\n    index: ConfigurationSchema('TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.bed.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n\n    /**\n     * #slot\n     */\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default BedTabixAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BedAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedAdapter = ConfigurationSchema(\n  'BedAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    colRef: {\n      type: 'number',\n      description: 'The column to use as a \"refName\" attribute',\n      defaultValue: 0,\n    },\n    /**\n     * #slot\n     */\n    colStart: {\n      type: 'number',\n      description: 'The column to use as a \"start\" attribute',\n      defaultValue: 1,\n    },\n    /**\n     * #slot\n     */\n    colEnd: {\n      type: 'number',\n      description: 'The column to use as a \"end\" attribute',\n      defaultValue: 2,\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BedAdapter\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport BigBedAdapterF from './BigBedAdapter'\nimport BedpeAdapterF from './BedpeAdapter'\nimport BedTabixAdapterF from './BedTabixAdapter'\nimport BedAdapterF from './BedAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class BedPlugin extends Plugin {\n  name = 'BedPlugin'\n\n  install(pluginManager: PluginManager) {\n    BigBedAdapterF(pluginManager)\n    BedAdapterF(pluginManager)\n    BedpeAdapterF(pluginManager)\n    BedTabixAdapterF(pluginManager)\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.(bb|bigbed)$/i\n          const adapterName = 'BigBedAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            bigBedLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bedpe(\\.gz)?$/i\n          const adapterName = 'BedpeAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bedpeLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bed\\.b?gz$/i\n          const adapterName = 'BedTabixAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bedGzLocation: file,\n              index: {\n                location: index || makeIndex(file, '.tbi'),\n                indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n              },\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bed$/i\n          const adapterName = 'BedAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bedLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => (adapterName: string) =>\n        adapterName === 'BedpeAdapter'\n          ? 'VariantTrack'\n          : trackTypeGuesser(adapterName),\n    )\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function BigBedAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BigBedAdapter',\n        displayName: 'BigBed adapter',\n        configSchema,\n        getAdapterClass: () => import('./BigBedAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function BedAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedAdapter',\n        displayName: 'BED adapter',\n        configSchema,\n        getAdapterClass: () => import('./BedAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function BedpeAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedpeAdapter',\n        displayName: 'BEDPE adapter',\n        configSchema,\n        getAdapterClass: () => import('./BedpeAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function BedTabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BedTabixAdapter',\n        displayName: 'BED tabix adapter',\n        configSchema,\n        getAdapterClass: () => import('./BedTabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\n\nconst configSchema = ConfigurationSchema('BreakpointAlignmentsWidget', {})\n\nconst stateModel = types\n  .model('BreakpointAlignmentsWidget', {\n    id: ElementId,\n    type: types.literal('BreakpointAlignmentsWidget'),\n    featureData: types.frozen(),\n  })\n  .actions(self => ({\n    setFeatureData(data: unknown) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = undefined\n    },\n  }))\n\nexport default function BreakpointAlignmentsFeatureDetailF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'BreakpointAlignmentsWidget',\n      heading: 'Breakpoint feature details',\n      configSchema,\n      stateModel,\n      ReactComponent: lazy(() => import('./BreakpointAlignmentsFeatureDetail')),\n    })\n  })\n}\n","import { getSession, Feature, Region } from '@jbrowse/core/util'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport { parseBreakend } from '@gmod/vcf'\nimport { IStateTreeNode } from 'mobx-state-tree'\n\nexport default class BreakpointSplitViewType extends ViewType {\n  snapshotFromBreakendFeature(\n    feature: Feature,\n    view: { displayedRegions: Region[] } & IStateTreeNode,\n  ) {\n    const alt = feature.get('ALT')?.[0]\n    const bnd = alt ? parseBreakend(alt) : undefined\n    const startPos = feature.get('start')\n    let endPos\n    const bpPerPx = 10\n\n    // TODO: Figure this out for multiple assembly names\n    const { assemblyName } = view.displayedRegions[0]\n    const { assemblyManager } = getSession(view)\n    const assembly = assemblyManager.get(assemblyName)\n\n    if (!assembly) {\n      throw new Error(`assembly ${assemblyName} not found`)\n    }\n    if (!assembly.regions) {\n      throw new Error(`assembly ${assemblyName} regions not loaded`)\n    }\n    const featureRefName = assembly.getCanonicalRefName(feature.get('refName'))\n    const topRegion = assembly.regions.find(f => f.refName === featureRefName)\n\n    let mateRefName: string | undefined\n    let startMod = 0\n    let endMod = 0\n\n    // a VCF breakend feature\n    if (alt === '<TRA>') {\n      const INFO = feature.get('INFO')\n      endPos = INFO.END[0] - 1\n      mateRefName = assembly.getCanonicalRefName(INFO.CHR2[0])\n    } else if (bnd?.MatePosition) {\n      const matePosition = bnd.MatePosition.split(':')\n      endPos = +matePosition[1] - 1\n      mateRefName = assembly.getCanonicalRefName(matePosition[0])\n      if (bnd.Join === 'left') {\n        startMod = -1\n      }\n      if (bnd.MateDirection === 'left') {\n        endMod = -1\n      }\n    } else if (feature.get('mate')) {\n      // a generic 'mate' feature\n      const mate = feature.get('mate')\n      mateRefName = assembly.getCanonicalRefName(mate.refName)\n      endPos = mate.start\n    }\n\n    if (!mateRefName) {\n      throw new Error(\n        `unable to resolve mate refName ${mateRefName} in reference genome`,\n      )\n    }\n\n    const bottomRegion = assembly.regions.find(f => f.refName === mateRefName)\n\n    if (!topRegion || !bottomRegion) {\n      throw new Error(\n        `unable to find the refName for the top or bottom of the breakpoint view`,\n      )\n    }\n\n    const topMarkedRegion = [{ ...topRegion }, { ...topRegion }]\n    const bottomMarkedRegion = [{ ...bottomRegion }, { ...bottomRegion }]\n    topMarkedRegion[0].end = startPos + startMod\n    topMarkedRegion[1].start = startPos + startMod\n    bottomMarkedRegion[0].end = endPos + endMod\n    bottomMarkedRegion[1].start = endPos + endMod\n    return {\n      type: 'BreakpointSplitView',\n      views: [\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: topMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (topRegion.start + feature.get('start')) / bpPerPx,\n        },\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: bottomMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (bottomRegion.start + endPos) / bpPerPx,\n        },\n      ],\n      displayName: `${\n        feature.get('name') || feature.get('id') || 'breakend'\n      } split detail`,\n      featureData: undefined as unknown,\n    }\n  }\n}\n","import React, { lazy } from 'react'\nimport {\n  types,\n  getParent,\n  onAction,\n  addDisposer,\n  getPath,\n  Instance,\n} from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport { saveAs } from 'file-saver'\n\n// jbrowse\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession, Feature, notEmpty } from '@jbrowse/core/util'\nimport { AnyConfigurationModel, getConf } from '@jbrowse/core/configuration'\n\n// icons\nimport PhotoCamera from '@mui/icons-material/PhotoCamera'\nimport LinkIcon from '@mui/icons-material/Link'\n\n// locals\nimport { intersect } from './util'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\n\ninterface Display {\n  searchFeatureByID?: (str: string) => LayoutRecord\n}\n\ninterface Track {\n  displays: Display[]\n}\n\nfunction calc(track: Track, f: Feature) {\n  return track.displays[0].searchFeatureByID?.(f.id())\n}\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n  Wrapper?: React.FC<{ children: React.ReactNode }>\n  fontSize?: number\n  rulerHeight?: number\n  textHeight?: number\n  paddingHeight?: number\n  headerHeight?: number\n  cytobandHeight?: number\n  trackLabels?: string\n  themeName?: string\n}\n\ntype LGV = LinearGenomeViewModel\n\nexport interface Breakend {\n  MateDirection: string\n  Join: string\n  Replacement: string\n  MatePosition: string\n}\n\nexport type LayoutRecord = [number, number, number, number]\n\nasync function getBlockFeatures(\n  model: BreakpointViewModel,\n  track: { configuration: AnyConfigurationModel },\n) {\n  const { views } = model\n  const { rpcManager, assemblyManager } = getSession(model)\n  const assemblyName = model.views[0].assemblyNames[0]\n  const assembly = await assemblyManager.waitForAssembly(assemblyName)\n  if (!assembly) {\n    return undefined // throw new Error(`assembly not found: \"${assemblyName}\"`)\n  }\n  const sessionId = track.configuration.trackId\n  return Promise.all(\n    views.map(async view =>\n      (\n        (await rpcManager.call(sessionId, 'CoreGetFeatures', {\n          adapterConfig: getConf(track, ['adapter']),\n          sessionId,\n          regions: view.staticBlocks.contentBlocks,\n        })) as Feature[][]\n      ).flat(),\n    ),\n  )\n}\n\n/**\n * #stateModel BreakpointSplitView\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  const minHeight = 40\n  const defaultHeight = 400\n  return types\n    .compose(\n      'BreakpointSplitView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('BreakpointSplitView'),\n        /**\n         * #property\n         */\n        height: types.optional(\n          types.refinement(\n            'viewHeight',\n            types.number,\n            (n: number) => n >= minHeight,\n          ),\n          defaultHeight,\n        ),\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        showIntraviewLinks: true,\n        /**\n         * #property\n         */\n        linkViews: false,\n        /**\n         * #property\n         */\n        interactToggled: false,\n        /**\n         * #property\n         */\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n      }),\n    )\n    .volatile(() => ({\n      width: 800,\n      matchedTrackFeatures: {} as Record<string, Feature[][]>,\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import(\n          './svgcomponents/SVGBreakpointSplitView'\n        )\n        const html = await renderToSvg(self as BreakpointViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * Find all track ids that match across multiple views\n       */\n      get matchedTracks() {\n        return intersect(\n          elt => elt.configuration.trackId as string,\n          ...self.views.map(view => view.tracks),\n        )\n      },\n\n      /**\n       * #method\n       * Get tracks with a given trackId across multiple views\n       */\n      getMatchedTracks(trackConfigId: string) {\n        return self.views\n          .map(view => view.getTrack(trackConfigId))\n          .filter(f => !!f)\n      },\n\n      /**\n       * #method\n       *\n       * Translocation features are handled differently\n       * since they do not have a mate e.g. they are one sided\n       */\n      hasTranslocations(trackConfigId: string) {\n        return [...this.getTrackFeatures(trackConfigId).values()].find(\n          f => f.get('type') === 'translocation',\n        )\n      },\n\n      /**\n       * #method\n       * Get a composite map of featureId-\\>feature map for a track across\n       * multiple views\n       */\n      getTrackFeatures(trackConfigId: string) {\n        return new Map(\n          self.matchedTrackFeatures[trackConfigId]\n            ?.flat()\n            .map(f => [f.id(), f]),\n        )\n      },\n\n      /**\n       * #method\n       */\n      getMatchedFeaturesInLayout(trackConfigId: string, features: Feature[][]) {\n        // use reverse to search the second track first\n        const tracks = this.getMatchedTracks(trackConfigId)\n\n        return features.map(c =>\n          c\n            .map(feature => {\n              const level = tracks.findIndex(track => calc(track, feature))\n              return level !== -1\n                ? {\n                    feature,\n                    layout: calc(tracks[level], feature),\n                    level,\n                  }\n                : undefined\n            })\n            .filter(notEmpty),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(\n            self,\n            ({\n              name,\n              path,\n              args,\n            }: {\n              name: string\n              path?: string\n              args?: unknown[]\n            }) => {\n              if (self.linkViews) {\n                const actions = [\n                  'horizontalScroll',\n                  'zoomTo',\n                  'setScaleFactor',\n                  'showTrack',\n                  'toggleTrack',\n                  'hideTrack',\n                  'setTrackLabels',\n                  'toggleCenterLine',\n                ]\n                if (actions.includes(name) && path) {\n                  this.onSubviewAction(name, path, args)\n                }\n              }\n            },\n          ),\n        )\n      },\n\n      onSubviewAction(actionName: string, path: string, args?: unknown[]) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (!ret.endsWith(path)) {\n            // @ts-ignore\n            view[actionName](args?.[0])\n          }\n        })\n      },\n\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        self.views.forEach(v => v.setWidth(newWidth))\n      },\n\n      /**\n       * #action\n       */\n      removeView(view: LGV) {\n        self.views.remove(view)\n      },\n\n      /**\n       * #action\n       */\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      /**\n       * #action\n       */\n      toggleInteract() {\n        self.interactToggled = !self.interactToggled\n      },\n\n      /**\n       * #action\n       */\n      toggleIntraviewLinks() {\n        self.showIntraviewLinks = !self.showIntraviewLinks\n      },\n\n      /**\n       * #action\n       */\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n\n      /**\n       * #action\n       */\n      setMatchedTrackFeatures(obj: Record<string, Feature[][]>) {\n        self.matchedTrackFeatures = obj\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(async () => {\n            try {\n              if (!self.views.every(view => view.initialized)) {\n                return\n              }\n              self.setMatchedTrackFeatures(\n                Object.fromEntries(\n                  await Promise.all(\n                    self.matchedTracks.map(async track => [\n                      track.configuration.trackId,\n                      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                      await getBlockFeatures(self as any, track),\n                    ]),\n                  ),\n                ),\n              )\n            } catch (e) {\n              console.error(e)\n              getSession(self).notifyError(`${e}`, e)\n            }\n          }),\n        )\n      },\n\n      /**\n       * #method\n       */\n      menuItems() {\n        return [\n          ...self.views\n            .map((view, idx) => [idx, view.menuItems?.()] as const)\n            .filter(f => !!f[1])\n            .map(f => ({ label: `View ${f[0] + 1} Menu`, subMenu: f[1] })),\n\n          {\n            label: 'Show intra-view links',\n            type: 'checkbox',\n            checked: self.showIntraviewLinks,\n            onClick: () => self.toggleIntraviewLinks(),\n          },\n          {\n            label: 'Allow clicking alignment squiggles?',\n            type: 'checkbox',\n            checked: self.interactToggled,\n            onClick: () => self.toggleInteract(),\n          },\n\n          {\n            label: 'Link views',\n            type: 'checkbox',\n            icon: LinkIcon,\n            checked: self.linkViews,\n            onClick: () => {\n              self.toggleLinkViews()\n            },\n          },\n          {\n            label: 'Export SVG',\n            icon: PhotoCamera,\n            onClick: (): void => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                { model: self, handleClose },\n              ])\n            },\n          },\n        ]\n      },\n    }))\n}\n\nexport type BreakpointViewStateModel = ReturnType<typeof stateModelFactory>\nexport type BreakpointViewModel = Instance<BreakpointViewStateModel>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport BreakpointAlignmentsWidgetF from './BreakpointAlignmentsFeatureDetail'\nimport BreakpointSplitViewF from './BreakpointSplitView'\n\nexport default class BreakpointSplitViewPlugin extends Plugin {\n  name = 'BreakpointSplitViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    BreakpointSplitViewF(pluginManager)\n    BreakpointAlignmentsWidgetF(pluginManager)\n  }\n\n  configure() {}\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport BreakpointSplitView from './BreakpointSplitView'\nimport stateModelFactory from './model'\n\nexport default function BreakpointSplitViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new BreakpointSplitView({\n      name: 'BreakpointSplitView',\n      displayName: 'Breakpoint split view',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/BreakpointSplitView')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config PAFAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PAFAdapter = ConfigurationSchema(\n  'PAFAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second',\n    },\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    pafLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.paf',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default PAFAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config PairwiseIndexedPAFAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PairwiseIndexedPAFAdapter = ConfigurationSchema(\n  'PairwiseIndexedPAFAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second',\n    },\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    pifGzLocation: {\n      type: 'fileLocation',\n      description: 'location of pairwise tabix indexed PAF (pif)',\n      defaultValue: {\n        uri: '/path/to/data/file.pif.gz',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    index: ConfigurationSchema('TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.paf.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n  },\n  { explicitlyTyped: true },\n)\n\nexport default PairwiseIndexedPAFAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MCScanAnchorsAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MCScanAnchorsAdapter = ConfigurationSchema(\n  'MCScanAnchorsAdapter',\n  {\n    /**\n     * #slot\n     */\n    mcscanAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default MCScanAnchorsAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MCScanSimpleAnchorsAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MCScanSimpleAnchorsAdapter = ConfigurationSchema(\n  'MCScanSimpleAnchorsAdapter',\n  {\n    /**\n     * #slot\n     */\n    mcscanSimpleAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors.simple',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default MCScanSimpleAnchorsAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MashMapAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MashMapAdapter = ConfigurationSchema(\n  'MashMapAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Target is the first value in the array, query is the second',\n    },\n\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    /**\n     * #slot\n     */\n    outLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mashmap.out',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default MashMapAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config DeltaAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DeltaAdapter = ConfigurationSchema(\n  'DeltaAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second',\n    },\n    /**\n     * #slot\n     * alternative to assembly names\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     * alternative to assembly names\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    deltaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.delta', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default DeltaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config ChainAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ChainAdapter = ConfigurationSchema(\n  'ChainAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Target is the first value in the array, query is the second',\n    },\n    /**\n     * #slot\n     * can be specified as alternative to assemblyNames\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    /**\n     * #slot\n     * can be specified as alternative to assemblyNames\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    /**\n     * #slot\n     */\n    chainLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.chain', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default ChainAdapter\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\n\nimport PAFAdapterF from './PAFAdapter'\nimport PairwiseIndexedPAFAdapterF from './PairwiseIndexedPAFAdapter'\nimport MCScanAnchorsAdapterF from './MCScanAnchorsAdapter'\nimport MCScanSimpleAnchorsAdapterF from './MCScanSimpleAnchorsAdapter'\nimport MashMapAdapterF from './MashMapAdapter'\nimport DeltaAdapterF from './DeltaAdapter'\nimport ChainAdapterF from './ChainAdapter'\n\nimport {\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class ComparativeAdaptersPlugin extends Plugin {\n  name = 'ComparativeAdaptersPlugin'\n\n  install(pluginManager: PluginManager) {\n    PAFAdapterF(pluginManager)\n    PairwiseIndexedPAFAdapterF(pluginManager)\n    DeltaAdapterF(pluginManager)\n    ChainAdapterF(pluginManager)\n    MCScanAnchorsAdapterF(pluginManager)\n    MCScanSimpleAnchorsAdapterF(pluginManager)\n    MashMapAdapterF(pluginManager)\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.paf/i\n          const adapterName = 'PAFAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              pafLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) =>\n          adapterName === 'PAFAdapter'\n            ? 'SyntenyTrack'\n            : trackTypeGuesser(adapterName)\n      },\n    )\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function PAFAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'PAFAdapter',\n        displayName: 'PAF adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () => import('./PAFAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function PairwiseIndexedPAFAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'PairwiseIndexedPAFAdapter',\n        displayName: 'Pairwise indexed PAF adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./PairwiseIndexedPAFAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function DeltaAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'DeltaAdapter',\n        displayName: 'MUMmer delta adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () => import('./DeltaAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function ChainAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'ChainAdapter',\n        displayName: 'Liftover chain adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () => import('./ChainAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function MCScanAnchorsAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanAnchorsAdapter',\n        displayName: 'MCScan anchors adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n\n        getAdapterClass: () =>\n          import('./MCScanAnchorsAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function MCScanSimpleAnchorsAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanSimpleAnchorsAdapter',\n        displayName: 'MCScan anchors.simple adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./MCScanSimpleAnchorsAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default function MashMapAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MashMapAdapter',\n        displayName: 'MashMap adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () => import('./MashMapAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { getParent, Instance } from 'mobx-state-tree'\nimport { observable } from 'mobx'\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\n\n/**\n * #stateModel Dotplot1DView\n * ref https://mobx-state-tree.js.org/concepts/volatiles on volatile state used here\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Dotplot1DView = Base1DView.extend(self => {\n  const scaleFactor = observable.box(1)\n  return {\n    views: {\n      /**\n       * #getter\n       * this uses padding=false and elision=false\n       */\n      get dynamicBlocks() {\n        return calculateDynamicBlocks(self, false, false)\n      },\n      /**\n       * #getter\n       */\n\n      get scaleFactor() {\n        return scaleFactor.get()\n      },\n\n      /**\n       * #getter\n       */\n      get maxBpPerPx() {\n        return self.totalBp / (self.width - 50)\n      },\n\n      /**\n       * #getter\n       */\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      /**\n       * #getter\n       */\n      get maxOffset() {\n        return self.displayedRegionsTotalPx - self.width * 0.2\n      },\n\n      /**\n       * #getter\n       */\n      get minOffset() {\n        return -self.width * 0.8\n      },\n    },\n    actions: {\n      /**\n       * #action\n       */\n      setScaleFactor(n: number) {\n        scaleFactor.set(n)\n      },\n\n      /**\n       * #action\n       */\n      center() {\n        const centerBp = self.totalBp / 2\n        const centerPx = centerBp / self.bpPerPx\n        self.scrollTo(centerPx - self.width / 2)\n      },\n    },\n  }\n})\n\nconst DotplotHView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).viewWidth\n    },\n  },\n}))\n\nconst DotplotVView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).viewHeight\n    },\n  },\n}))\n\nexport { DotplotVView, DotplotHView, Dotplot1DView }\nexport type Dotplot1DViewModel = Instance<typeof Dotplot1DView>\n","import React, { lazy } from 'react'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  getRoot,\n  getSnapshot,\n  resolveIdentifier,\n  types,\n  Instance,\n  SnapshotIn,\n} from 'mobx-state-tree'\nimport { saveAs } from 'file-saver'\nimport { autorun, transaction } from 'mobx'\n\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { BaseTrackStateModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport {\n  getSession,\n  isSessionModelWithWidgets,\n  minmax,\n  measureText,\n  max,\n  localStorageGetItem,\n  getTickDisplayStr,\n} from '@jbrowse/core/util'\nimport { getConf, AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\n\n// locals\nimport { Dotplot1DView, DotplotHView, DotplotVView } from './1dview'\nimport { getBlockLabelKeysToHide, makeTicks } from './components/util'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\nconst ReturnToImportFormDialog = lazy(\n  () => import('@jbrowse/core/ui/ReturnToImportFormDialog'),\n)\ntype Coord = [number, number]\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n  Wrapper?: React.FC<{ children: React.ReactNode }>\n  themeName?: string\n}\n\nfunction stringLenPx(a: string) {\n  return measureText(a.slice(0, 30))\n}\n\nfunction pxWidthForBlocks(\n  blocks: BaseBlock[],\n  bpPerPx: number,\n  hide: Set<string>,\n) {\n  return max([\n    ...blocks.filter(b => !hide.has(b.key)).map(b => stringLenPx(b.refName)),\n    ...blocks\n      .filter(b => !hide.has(b.key))\n      .map(b => stringLenPx(getTickDisplayStr(b.end, bpPerPx))),\n  ])\n}\n\n/**\n * #stateModel DotplotView\n * #category view\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nexport default function stateModelFactory(pm: PluginManager) {\n  return types\n    .compose(\n      'DotplotView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('DotplotView'),\n        /**\n         * #property\n         */\n        height: 600,\n        /**\n         * #property\n         */\n        borderSize: 20,\n        /**\n         * #property\n         */\n        tickSize: 5,\n        /**\n         * #property\n         */\n        vtextRotation: 0,\n        /**\n         * #property\n         */\n        htextRotation: -90,\n        /**\n         * #property\n         */\n        fontSize: 15,\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        assemblyNames: types.array(types.string),\n        /**\n         * #property\n         */\n        drawCigar: true,\n        /**\n         * #property\n         */\n        hview: types.optional(DotplotHView, {}),\n        /**\n         * #property\n         */\n        vview: types.optional(DotplotVView, {}),\n\n        /**\n         * #property\n         */\n        tracks: types.array(\n          pm.pluggableMstType('track', 'stateModel') as BaseTrackStateModel,\n        ),\n\n        /**\n         * #property\n         * this represents tracks specific to this view specifically used\n         * for read vs ref dotplots where this track would not really apply\n         * elsewhere\n         */\n        viewTrackConfigs: types.array(pm.pluggableConfigSchemaType('track')),\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      volatileError: undefined as unknown,\n\n      // these are 'personal preferences', stored in volatile and\n      // loaded/written to localStorage\n      cursorMode: localStorageGetItem('dotplot-cursorMode') || 'crosshair',\n      showPanButtons: Boolean(\n        JSON.parse(localStorageGetItem('dotplot-showPanbuttons') || 'true'),\n      ),\n      wheelMode: localStorageGetItem('dotplot-wheelMode') || 'zoom',\n      borderX: 100,\n      borderY: 100,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get width(): number {\n        if (!self.volatileWidth) {\n          throw new Error('width not initialized')\n        }\n        return self.volatileWidth\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n      /**\n       * #getter\n       */\n      get assembliesInitialized() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames.every(\n          n => assemblyManager.get(n)?.initialized ?? true,\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get initialized() {\n        return (\n          self.volatileWidth !== undefined &&\n          self.hview.displayedRegions.length > 0 &&\n          self.vview.displayedRegions.length > 0 &&\n          self.assembliesInitialized\n        )\n      },\n      /**\n       * #getter\n       */\n      get hticks() {\n        const { hview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = hview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n      /**\n       * #getter\n       */\n      get vticks() {\n        const { vview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = vview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n      /**\n       * #getter\n       */\n      get loading() {\n        return self.assemblyNames.length > 0 && !this.initialized\n      },\n      /**\n       * #getter\n       */\n      get viewWidth() {\n        return self.width - self.borderX\n      },\n      /**\n       * #getter\n       */\n      get viewHeight() {\n        return self.height - self.borderY\n      },\n      /**\n       * #getter\n       */\n      get views() {\n        return [self.hview, self.vview]\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        const session = getSession(self)\n        return {\n          ...getParentRenderProps(self),\n          drawCigar: self.drawCigar,\n          highResolutionScaling: getConf(session, 'highResolutionScaling'),\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setShowPanButtons(flag: boolean) {\n        self.showPanButtons = flag\n      },\n      /**\n       * #action\n       */\n      setWheelMode(str: string) {\n        self.wheelMode = str\n      },\n      /**\n       * #action\n       */\n      setCursorMode(str: string) {\n        self.cursorMode = str\n      },\n      /**\n       * #action\n       */\n      setDrawCigar(flag: boolean) {\n        self.drawCigar = flag\n      },\n      /**\n       * #action\n       * returns to the import form\n       */\n      clearView() {\n        self.hview.setDisplayedRegions([])\n        self.vview.setDisplayedRegions([])\n        self.assemblyNames = cast([])\n        self.tracks.clear()\n      },\n      /**\n       * #action\n       */\n      setBorderX(n: number) {\n        self.borderX = n\n      },\n      /**\n       * #action\n       */\n      setBorderY(n: number) {\n        self.borderY = n\n      },\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n        return self.volatileWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = newHeight\n        return self.height\n      },\n\n      /**\n       * #action\n       */\n      setError(e: unknown) {\n        self.volatileError = e\n      },\n\n      /**\n       * #action\n       * removes the view itself from the state tree entirely by calling the\n       * parent removeView\n       */\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      /**\n       * #action\n       */\n      zoomOutButton() {\n        self.hview.zoomOut()\n        self.vview.zoomOut()\n      },\n      /**\n       * #action\n       */\n      zoomInButton() {\n        self.hview.zoomIn()\n        self.vview.zoomIn()\n      },\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pm.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const trackType = pm.getTrackType(conf.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${conf.type}`)\n        }\n        const viewType = pm.getViewType(self.type)\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          viewType.displayTypes.find(type => type.name === d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pm.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const t = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => t.forEach(t => self.tracks.remove(t)))\n        return t.length\n      },\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        const hiddenCount = this.hideTrack(trackId)\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n          return true\n        }\n        return false\n      },\n      /**\n       * #action\n       */\n      setAssemblyNames(target: string, query: string) {\n        self.assemblyNames = cast([target, query])\n      },\n      /**\n       * #action\n       */\n      setViews(arr: SnapshotIn<Base1DViewModel>[]) {\n        self.hview = cast(arr[0])\n        self.vview = cast(arr[1])\n      },\n\n      /**\n       * #action\n       */\n      getCoords(mousedown: Coord, mouseup: Coord) {\n        const [xmin, xmax] = minmax(mouseup[0], mousedown[0])\n        const [ymin, ymax] = minmax(mouseup[1], mousedown[1])\n        return Math.abs(xmax - xmin) > 3 && Math.abs(ymax - ymin) > 3\n          ? [\n              self.hview.pxToBp(xmin),\n              self.hview.pxToBp(xmax),\n              self.vview.pxToBp(self.viewHeight - ymin),\n              self.vview.pxToBp(self.viewHeight - ymax),\n            ]\n          : undefined\n      },\n\n      /**\n       * #action\n       * zooms into clicked and dragged region\n       */\n      zoomIn(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          self.hview.moveTo(x1, x2)\n          self.vview.moveTo(y2, y1)\n        }\n      },\n      /**\n       * #action\n       */\n      showAllRegions() {\n        self.hview.zoomTo(self.hview.maxBpPerPx)\n        self.vview.zoomTo(self.vview.maxBpPerPx)\n        self.vview.center()\n        self.hview.center()\n      },\n      /**\n       * #action\n       * creates a linear synteny view from the clicked and dragged region\n       */\n      onDotplotView(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          const session = getSession(self)\n\n          const d1 = Dotplot1DView.create({\n            ...getSnapshot(self.hview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          const d2 = Dotplot1DView.create({\n            ...getSnapshot(self.vview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          d1.setVolatileWidth(self.hview.width)\n          d2.setVolatileWidth(self.vview.width)\n          d1.moveTo(x1, x2)\n          d2.moveTo(y2, y1)\n          d1.zoomTo(d1.bpPerPx / (self.width / self.hview.width), 0)\n          d2.zoomTo(d2.bpPerPx / (self.width / self.vview.width), 0)\n\n          // add the specific evidence tracks to the LGVs in the split view\n          // note: scales the bpPerPx by scaling proportional of the dotplot\n          // width to the eventual lgv width\n          const tracks = self.tracks\n            .map(track =>\n              track.configuration.displays.find(\n                (display: { type: string }) =>\n                  display.type === 'LinearSyntenyDisplay',\n              ),\n            )\n            .filter(f => !!f)\n            .map(displayConf => {\n              const trackConf = getParent<AnyConfigurationModel>(displayConf, 2)\n              return {\n                type: trackConf.type,\n                configuration: trackConf,\n                displays: [\n                  { type: displayConf.type, configuration: displayConf },\n                ],\n              }\n            })\n\n          const { id: _unused1, ...rest1 } = getSnapshot(d1)\n          const { id: _unused2, ...rest2 } = getSnapshot(d2)\n          const viewSnapshot = {\n            type: 'LinearSyntenyView',\n            views: [\n              {\n                type: 'LinearGenomeView',\n                tracks: [],\n                hideHeader: true,\n                ...rest1,\n              },\n              {\n                type: 'LinearGenomeView',\n                tracks: [],\n                hideHeader: true,\n                ...rest2,\n              },\n            ],\n            tracks,\n          }\n\n          session.addView('LinearSyntenyView', viewSnapshot)\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        const { renderToSvg } = await import('./svgcomponents/SVGDotplotView')\n        const html = await renderToSvg(self as DotplotViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n      // if any of our assemblies are temporary assemblies\n      beforeDestroy() {\n        const session = getSession(self)\n        for (const name in self.assemblyNames) {\n          session.removeTemporaryAssembly?.(name)\n        }\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const s = (s: unknown) => JSON.stringify(s)\n            const { showPanButtons, wheelMode, cursorMode } = self\n            if (typeof localStorage !== 'undefined') {\n              localStorage.setItem('dotplot-showPanbuttons', s(showPanButtons))\n              localStorage.setItem('dotplot-cursorMode', cursorMode)\n              localStorage.setItem('dotplot-wheelMode', wheelMode)\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const session = getSession(self)\n\n              // don't operate if width not set yet\n              if (\n                self.volatileWidth === undefined ||\n                !self.assembliesInitialized\n              ) {\n                return\n              }\n\n              // also don't operate if displayedRegions already set, this is a\n              // helper autorun to load regions from assembly\n              if (\n                self.hview.displayedRegions.length > 0 &&\n                self.vview.displayedRegions.length > 0\n              ) {\n                return\n              }\n\n              const views = [self.hview, self.vview]\n              transaction(() => {\n                self.assemblyNames.forEach((name, index) => {\n                  const assembly = session.assemblyManager.get(name)\n                  const view = views[index]\n                  view.setDisplayedRegions(assembly?.regions || [])\n                })\n                self.showAllRegions()\n              })\n            },\n            { delay: 1000 },\n          ),\n        )\n        addDisposer(\n          self,\n          autorun(function borderSetter() {\n            // make sure we have a width on the view before trying to load\n            if (self.volatileWidth === undefined) {\n              return\n            }\n            const { vview, hview, viewHeight, viewWidth } = self\n            const padding = 40\n            const vblocks = vview.dynamicBlocks.contentBlocks\n            const hblocks = hview.dynamicBlocks.contentBlocks\n            const hoffset = hview.offsetPx\n            const voffset = vview.offsetPx\n\n            const vhide = getBlockLabelKeysToHide(vblocks, viewHeight, voffset)\n            const hhide = getBlockLabelKeysToHide(hblocks, viewWidth, hoffset)\n            const by = pxWidthForBlocks(hblocks, vview.bpPerPx, hhide)\n            const bx = pxWidthForBlocks(vblocks, hview.bpPerPx, vhide)\n\n            // these are set via autorun to avoid dependency cycle\n            self.setBorderY(Math.max(by + padding, 50))\n            self.setBorderX(Math.max(bx + padding, 50))\n          }),\n        )\n      },\n      /**\n       * #action\n       */\n      squareView() {\n        const { hview, vview } = self\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n      /**\n       * #action\n       */\n      squareViewProportional() {\n        const { hview, vview } = self\n        const ratio = hview.width / vview.width\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg / ratio)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems() {\n        const session = getSession(self)\n        return [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          {\n            label: 'Square view - same bp per pixel',\n            onClick: () => self.squareView(),\n          },\n          {\n            label: 'Rectangular view - same total bp',\n            onClick: () => self.squareView(),\n          },\n          {\n            label: 'Show all regions',\n            onClick: () => self.showAllRegions(),\n          },\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDialog,\n                { model: self, handleClose },\n              ])\n            },\n          },\n          ...(isSessionModelWithWidgets(session)\n            ? [\n                {\n                  label: 'Open track selector',\n                  onClick: self.activateTrackSelector,\n                  icon: TrackSelectorIcon,\n                },\n              ]\n            : []),\n        ]\n      },\n      /**\n       * #getter\n       */\n      get error() {\n        return self.volatileError || self.assemblyErrors\n      },\n    }))\n}\n\nexport type DotplotViewStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotViewModel = Instance<DotplotViewStateModel>\n\nexport { type Dotplot1DViewModel, Dotplot1DView } from './1dview'\n","import React, { useEffect, useState, CSSProperties } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { Typography } from '@mui/material'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles()(theme => {\n  const bg = theme.palette.action.disabledBackground\n  return {\n    loading: {\n      paddingLeft: '0.6em',\n      backgroundColor: theme.palette.background.default,\n      backgroundImage: `repeating-linear-gradient(45deg, transparent, transparent 5px, ${bg} 5px, ${bg} 10px)`,\n      textAlign: 'center',\n    },\n\n    blockMessage: {\n      backgroundColor: bg,\n      padding: '10px',\n    },\n    blockError: {\n      backgroundColor: bg,\n      padding: '10px',\n      color: 'red',\n    },\n  }\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const { classes } = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  }, [])\n\n  return shown ? (\n    <div className={classes.loading}>\n      <LoadingEllipses />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.blockMessage}>\n      <Typography>{`${messageText}`}</Typography>\n    </div>\n  )\n}\n\nfunction BlockError({ error }: { error: unknown }) {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.blockError}>\n      <Typography>{`${error}`}</Typography>\n    </div>\n  )\n}\n\nconst ServerSideRenderedDotplotContent = observer(function ({\n  model,\n  style,\n}: {\n  model: {\n    error?: unknown\n    message?: string\n    filled?: boolean\n    shouldDisplay?: boolean\n    reactElement?: React.ReactElement\n  }\n  style: CSSProperties\n}) {\n  if (model.error) {\n    return <BlockError error={model.error} data-testid=\"reload_button\" />\n  } else if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  } else if (!model.filled) {\n    return <LoadingMessage />\n  } else if (model.shouldDisplay) {\n    return <div style={style}>{model.reactElement}</div>\n  }\n  return null\n})\n\nexport default ServerSideRenderedDotplotContent\n","import clone from 'clone'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getSnapshot, IAnyStateTreeNode } from 'mobx-state-tree'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\n\nimport { DotplotViewModel } from '../DotplotView/model'\n\nexport function renderBlockData(self: IAnyStateTreeNode) {\n  const { rpcManager } = getSession(self)\n  const { rendererType } = self\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as DotplotViewModel\n\n  // Alternative to readConfObject(config) is below used because renderProps is\n  // something under our control.  Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n  getSnapshot(parent)\n\n  if (parent.initialized) {\n    const { viewWidth, viewHeight, borderSize, borderX, borderY } = parent\n    return {\n      rendererType,\n      rpcManager,\n      renderProps: {\n        ...self.renderProps(),\n        view: clone(getSnapshot(parent)),\n        width: viewWidth,\n        height: viewHeight,\n        borderSize,\n        borderX,\n        borderY,\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId: getRpcSessionId(self),\n        timeout: 1000000, // 10000,\n      },\n    }\n  }\n  return undefined\n}\n\nexport async function renderBlockEffect(\n  props?: ReturnType<typeof renderBlockData>,\n) {\n  if (!props) {\n    return\n  }\n\n  const { rendererType, rpcManager, renderProps } = props\n  const { reactElement, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderProps,\n  )\n  return {\n    reactElement,\n    data,\n    renderingComponent: rendererType.ReactComponent,\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { ThemeOptions } from '@mui/material'\nimport { types, Instance } from 'mobx-state-tree'\nimport {\n  getConf,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport {\n  getContainingView,\n  makeAbortableReaction,\n  ReactRendering,\n} from '@jbrowse/core/util'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\n\n// locals\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\nimport { renderBlockData, renderBlockEffect } from './renderDotplotBlock'\nimport { DotplotViewModel, ExportSvgOptions } from '../DotplotView/model'\n\n/**\n * #stateModel DotplotDisplay\n * #category display\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'DotplotDisplay',\n      BaseDisplay,\n      types\n        .model({\n          /**\n           * #property\n           */\n          type: types.literal('DotplotDisplay'),\n          /**\n           * #property\n           */\n          configuration: ConfigurationReference(configSchema),\n        })\n        .volatile(() => ({\n          warnings: [] as { message: string; effect: string }[],\n          renderInProgress: undefined as AbortController | undefined,\n          filled: false,\n          data: undefined as any,\n          reactElement: undefined as React.ReactElement | undefined,\n          message: undefined as string | undefined,\n          renderingComponent: undefined as any,\n          ReactComponent2:\n            ServerSideRenderedBlockContent as unknown as React.FC<any>,\n        })),\n    )\n    .views(self => ({\n      get shouldDisplay() {\n        const { vview, hview } = getContainingView(self) as DotplotViewModel\n        return (\n          vview.bpPerPx === self.data.bpPerPxY &&\n          hview.bpPerPx === self.data.bpPerPxX\n        )\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: self.configuration.renderer,\n        }\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      async renderSvg(opts: ExportSvgOptions & { theme: ThemeOptions }) {\n        const props = renderBlockData(self)\n        if (!props) {\n          return null\n        }\n\n        const { rendererType, rpcManager, renderProps } = props\n        const rendering = await rendererType.renderInClient(rpcManager, {\n          ...renderProps,\n          exportSVG: opts,\n          theme: opts.theme || renderProps.theme,\n        })\n        const { hview, vview } = getContainingView(self) as DotplotViewModel\n        const offX = -hview.offsetPx + rendering.offsetX\n        const offY = -vview.offsetPx + rendering.offsetY\n        return (\n          <g transform={`translate(${offX} ${-offY})`}>\n            <ReactRendering rendering={rendering} />\n          </g>\n        )\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self,\n            () => renderBlockData(self),\n            blockData => renderBlockEffect(blockData),\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 500,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n        /**\n         * #action\n         */\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        /**\n         * #action\n         */\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        /**\n         * #action\n         */\n        setRendered(args?: {\n          data: any\n          reactElement: React.ReactElement\n          renderingComponent: React.Component\n        }) {\n          if (args === undefined) {\n            return\n          }\n          const { data, reactElement, renderingComponent } = args\n          self.warnings = data.warnings\n          self.filled = true\n          self.message = undefined\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        /**\n         * #action\n         */\n        setError(error: unknown) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\n\nexport type DotplotDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotDisplayModel = Instance<DotplotDisplayStateModel>\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { getContainingView } from '@jbrowse/core/util'\n\n// locals\nimport { DotplotDisplayModel } from '../stateModelFactory'\nimport { DotplotViewModel } from '../../DotplotView/model'\n\nconst DotplotDisplay = observer(function DotplotDisplay(props: {\n  model: DotplotDisplayModel\n  children?: React.ReactNode\n}) {\n  const { model, children } = props\n  const { offsetX = 0, offsetY = 0 } = model.data || {}\n  const view = getContainingView(model) as DotplotViewModel\n\n  const top = view.vview.offsetPx - offsetY\n  const left = -(view.hview.offsetPx - offsetX)\n  return (\n    <div style={{ position: 'relative' }}>\n      <model.ReactComponent2\n        {...props}\n        style={{\n          position: 'absolute',\n          top,\n          left,\n        }}\n      />\n      {children}\n    </div>\n  )\n})\n\nexport default DotplotDisplay\n","import React from 'react'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { DotplotRenderArgsDeserialized } from '../DotplotRenderer'\n\nconst DotplotRendering = observer(function (\n  props: DotplotRenderArgsDeserialized,\n) {\n  return <PrerenderedCanvas {...props} />\n})\n\nexport default DotplotRendering\n","import {\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport {\n  renameRegionsIfNeeded,\n  renderToAbstractCanvas,\n  Region,\n  Feature,\n} from '@jbrowse/core/util'\nimport { bpToPx } from '@jbrowse/core/util/Base1DUtils'\nimport { getSnapshot } from 'mobx-state-tree'\nimport ComparativeRenderer, {\n  RenderArgsDeserialized,\n  RenderArgs,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\n\n// locals\nimport { Dotplot1DView, Dotplot1DViewModel } from '../DotplotView/model'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\n\nconst { parseCigar } = MismatchParser\n\nexport interface DotplotRenderArgsDeserialized extends RenderArgsDeserialized {\n  height: number\n  width: number\n  highResolutionScaling: number\n  view: {\n    hview: Dotplot1DViewModel\n    vview: Dotplot1DViewModel\n  }\n}\n\ninterface DotplotRenderArgs extends RenderArgs {\n  adapterConfig: AnyConfigurationModel\n  sessionId: string\n  view: {\n    hview: { displayedRegions: Region[] }\n    vview: { displayedRegions: Region[] }\n  }\n}\n\nconst r = 'fell outside of range due to CIGAR string'\nconst lt = '(less than min coordinate of feature)'\nconst gt = '(greater than max coordinate of feature)'\nconst fudgeFactor = 1 // allow 1px fuzzyness before warn\n\nfunction drawCir(ctx: CanvasRenderingContext2D, x: number, y: number, r = 1) {\n  ctx.beginPath()\n  ctx.arc(x, y, r / 2, 0, 2 * Math.PI)\n  ctx.fill()\n}\n\nexport default class DotplotRenderer extends ComparativeRenderer {\n  supportsSVG = true\n\n  async renameRegionsIfNeeded(args: DotplotRenderArgs) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n\n    const { view, sessionId, adapterConfig } = args\n\n    async function process(regions?: Region[]) {\n      if (!assemblyManager) {\n        throw new Error('No assembly manager provided')\n      }\n      const result = await renameRegionsIfNeeded(assemblyManager, {\n        sessionId,\n        adapterConfig,\n        regions,\n      })\n      return result.regions\n    }\n\n    view.hview.displayedRegions = await process(view.hview.displayedRegions)\n    view.vview.displayedRegions = await process(view.vview.displayedRegions)\n\n    return args\n  }\n\n  async drawDotplot(\n    ctx: CanvasRenderingContext2D,\n    props: DotplotRenderArgsDeserialized & { views: Dotplot1DViewModel[] },\n  ) {\n    const { config, views, height, drawCigar, theme } = props\n    const color = readConfObject(config, 'color')\n    const posColor = readConfObject(config, 'posColor')\n    const negColor = readConfObject(config, 'negColor')\n    const colorBy = readConfObject(config, 'colorBy')\n    const lineWidth = readConfObject(config, 'lineWidth')\n    const thresholds = readConfObject(config, 'thresholds')\n    const palette = readConfObject(config, 'thresholdsPalette')\n    const isCallback = config.color.isCallback\n    const [hview, vview] = views\n    const db1 = hview.dynamicBlocks.contentBlocks[0]?.offsetPx\n    const db2 = vview.dynamicBlocks.contentBlocks[0]?.offsetPx\n    const warnings = [] as { message: string; effect: string }[]\n    ctx.lineWidth = lineWidth\n\n    // we operate on snapshots of these attributes of the hview/vview because\n    // it is significantly faster than accessing the mobx objects\n    const { bpPerPx: hBpPerPx } = hview\n    const { bpPerPx: vBpPerPx } = vview\n\n    function clampWithWarnX(\n      num: number,\n      min: number,\n      max: number,\n      feature: Feature,\n    ) {\n      const strand = feature.get('strand') || 1\n      if (strand === -1) {\n        ;[max, min] = [min, max]\n      }\n      if (num < min - fudgeFactor) {\n        let start = feature.get('start')\n        let end = feature.get('end')\n        const refName = feature.get('refName')\n        if (strand === -1) {\n          ;[end, start] = [start, end]\n        }\n\n        warnings.push({\n          message: `feature at (X ${refName}:${start}-${end}) ${r} ${lt}`,\n          effect: 'clipped the feature',\n        })\n        return min\n      }\n      if (num > max + fudgeFactor) {\n        const strand = feature.get('strand') || 1\n        const start = strand === 1 ? feature.get('start') : feature.get('end')\n        const end = strand === 1 ? feature.get('end') : feature.get('start')\n        const refName = feature.get('refName')\n\n        warnings.push({\n          message: `feature at (X ${refName}:${start}-${end}) ${r} ${gt}`,\n          effect: 'clipped the feature',\n        })\n        return max\n      }\n      return num\n    }\n\n    function clampWithWarnY(\n      num: number,\n      min: number,\n      max: number,\n      feature: Feature,\n    ) {\n      if (num < min - fudgeFactor) {\n        const mate = feature.get('mate')\n        const { refName, start, end } = mate\n        warnings.push({\n          message: `feature at (Y ${refName}:${start}-${end}) ${r} ${lt}`,\n          effect: 'clipped the feature',\n        })\n        return min\n      }\n      if (num > max + fudgeFactor) {\n        const mate = feature.get('mate')\n        const { refName, start, end } = mate\n\n        warnings.push({\n          message: `feature at (Y ${refName}:${start}-${end}) ${r} ${gt}`,\n          effect: 'clipped the feature',\n        })\n        return max\n      }\n      return num\n    }\n\n    const hsnap = {\n      ...getSnapshot(hview),\n      staticBlocks: hview.staticBlocks,\n      width: hview.width,\n    }\n    const vsnap = {\n      ...getSnapshot(vview),\n      staticBlocks: vview.staticBlocks,\n      width: vview.width,\n    }\n    const t = createJBrowseTheme(theme)\n    for (const feature of hview.features || []) {\n      const strand = feature.get('strand') || 1\n      const start = strand === 1 ? feature.get('start') : feature.get('end')\n      const end = strand === 1 ? feature.get('end') : feature.get('start')\n      const refName = feature.get('refName')\n      const mate = feature.get('mate')\n      const mateRef = mate.refName\n\n      let r\n      if (colorBy === 'identity') {\n        const identity = feature.get('identity')\n        for (let i = 0; i < thresholds.length; i++) {\n          if (identity > +thresholds[i]) {\n            r = palette[i]\n            break\n          }\n        }\n      } else if (colorBy === 'meanQueryIdentity') {\n        r = `hsl(${feature.get('meanScore') * 200},100%,40%)`\n      } else if (colorBy === 'mappingQuality') {\n        r = `hsl(${feature.get('mappingQual')},100%,40%)`\n      } else if (colorBy === 'strand') {\n        r = strand === -1 ? negColor : posColor\n      } else if (colorBy === 'default') {\n        r = isCallback\n          ? readConfObject(config, 'color', { feature })\n          : color === '#f0f'\n            ? t.palette.text.primary\n            : color\n      }\n      ctx.fillStyle = r\n      ctx.strokeStyle = r\n\n      const b10 = bpToPx({ self: hsnap, refName, coord: start })\n      const b20 = bpToPx({ self: hsnap, refName, coord: end })\n      const e10 = bpToPx({ self: vsnap, refName: mateRef, coord: mate.start })\n      const e20 = bpToPx({ self: vsnap, refName: mateRef, coord: mate.end })\n      if (\n        b10 !== undefined &&\n        b20 !== undefined &&\n        e10 !== undefined &&\n        e20 !== undefined\n      ) {\n        const b1 = b10.offsetPx - db1\n        const b2 = b20.offsetPx - db1\n        const e1 = e10.offsetPx - db2\n        const e2 = e20.offsetPx - db2\n        if (Math.abs(b1 - b2) <= 4 && Math.abs(e1 - e2) <= 4) {\n          drawCir(ctx, b1, height - e1, lineWidth)\n        } else {\n          let currX = b1\n          let currY = e1\n          const cigar = feature.get('CIGAR')\n          if (drawCigar && cigar) {\n            const cigarOps = parseCigar(cigar)\n\n            ctx.beginPath()\n            ctx.moveTo(currX, height - currY)\n\n            let lastDrawnX = currX\n            let lastDrawnY = currX\n            for (let i = 0; i < cigarOps.length; i += 2) {\n              const val = +cigarOps[i]\n              const op = cigarOps[i + 1]\n              if (op === 'M' || op === '=' || op === 'X') {\n                currX += (val / hBpPerPx) * strand\n                currY += val / vBpPerPx\n              } else if (op === 'D' || op === 'N') {\n                currX += (val / hBpPerPx) * strand\n              } else if (op === 'I') {\n                currY += val / vBpPerPx\n              }\n              currX = clampWithWarnX(currX, b1, b2, feature)\n              currY = clampWithWarnY(currY, e1, e2, feature)\n\n              // only draw a line segment if it is bigger than 0.5px\n              if (\n                Math.abs(currX - lastDrawnX) > 0.5 ||\n                Math.abs(currY - lastDrawnY) > 0.5\n              ) {\n                ctx.lineTo(currX, height - currY)\n                lastDrawnX = currX\n                lastDrawnY = currY\n              }\n            }\n\n            ctx.stroke()\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(b1, height - e1)\n            ctx.lineTo(b2, height - e2)\n            ctx.stroke()\n          }\n        }\n      } else {\n        if (warnings.length <= 5) {\n          if (b10 === undefined || b20 === undefined) {\n            warnings.push({\n              message: `feature at (X ${refName}:${start}-${end}) not plotted, fell outside of range`,\n              effect: 'feature not rendered',\n            })\n          } else {\n            warnings.push({\n              message: `feature at (Y ${mateRef}:${mate.start}-${mate.end}) not plotted, fell outside of range`,\n              effect: 'feature not rendered',\n            })\n          }\n        }\n      }\n    }\n\n    return { warnings }\n  }\n\n  async render(renderProps: DotplotRenderArgsDeserialized) {\n    const {\n      width,\n      height,\n      view: { hview, vview },\n    } = renderProps\n    const dimensions = [width, height]\n    const views = [hview, vview].map((snap, idx) => {\n      const view = Dotplot1DView.create(snap)\n      view.setVolatileWidth(dimensions[idx])\n      return view\n    })\n    const target = views[0]\n    const feats = await this.getFeatures({\n      ...renderProps,\n      regions: target.dynamicBlocks.contentBlocks,\n    })\n    target.setFeatures(feats)\n\n    const ret = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      this.drawDotplot(ctx, { ...renderProps, views }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...ret,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...ret,\n      height,\n      width,\n      offsetX: views[0].dynamicBlocks.blocks[0]?.offsetPx || 0,\n      offsetY: views[1].dynamicBlocks.blocks[0]?.offsetPx || 0,\n      bpPerPxX: views[0].bpPerPx,\n      bpPerPxY: views[1].bpPerPx,\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config DotplotRenderer\n * #category renderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'DotplotRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description:\n        'the color of each feature in a synteny, used with colorBy:default',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    posColor: {\n      type: 'color',\n      description: 'the color for forward alignments, used with colorBy:strand',\n      defaultValue: 'blue',\n    },\n    /**\n     * #slot\n     */\n    negColor: {\n      type: 'color',\n      description: 'the color for reverse alignments, used with colorBy:strand',\n      defaultValue: 'red',\n    },\n\n    /**\n     * #slot\n     */\n    lineWidth: {\n      type: 'number',\n      description: 'width of the lines to be drawn',\n      defaultValue: 2.5, // 2.5 is similar to D-GENIES\n    },\n\n    /**\n     * #slot\n     */\n    colorBy: {\n      type: 'stringEnum',\n      model: types.enumeration('colorBy', [\n        'identity',\n        'meanQueryIdentity',\n        'mappingQuality',\n        'strand',\n        'default',\n      ]),\n      description: `Color by options:<br/>\n<ul>\n  <li>\"identity\" - the identity of the particular hit, similar to D-GENIES, use the other config slots 'thresholds' and 'thresholdsPalette' to define colors for this setting</li>\n  <li>\"meanQueryIdentity\" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>\"mappingQuality\" - uses mapping quality from PAF, some adapters don't have this setting</li>\n  <li>\"strand\" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>\"default\" - uses the 'color' config slot</li>\n</ul>`,\n      defaultValue: 'default',\n    },\n\n    /**\n     * #slot\n     */\n    thresholdsPalette: {\n      type: 'stringArray',\n      defaultValue: ['#094b09', '#2ebd40', '#d5670b', '#ffd84b'],\n      description: 'threshold colors, used with colorBy:identity',\n    },\n\n    /**\n     * #slot\n     */\n    thresholds: {\n      type: 'stringArray',\n      defaultValue: ['0.75', '0.5', '0.25', '0'],\n      description: 'threshold breakpoints, used with colorBy:identity',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { checkAbortSignal } from '@jbrowse/core/util'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport ComparativeRenderer, {\n  RenderArgs as ComparativeRenderArgs,\n  RenderArgsSerialized as ComparativeRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\n\ninterface RenderArgs extends ComparativeRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\ninterface RenderArgsSerialized extends ComparativeRenderArgsSerialized {\n  adapterConfig: {}\n  rendererType: string\n}\n\n/**\n * call a synteny renderer with the given args\n * param views: a set of views that each contain a set of regions\n * used instead of passing regions directly as in render()\n */\nexport default class ComparativeRender extends RpcMethodType {\n  name = 'ComparativeRender'\n\n  async renameRegionsIfNeeded(args: RenderArgs, rend: ComparativeRenderer) {\n    return rend.renameRegionsIfNeeded(args)\n  }\n\n  getRenderer(rendererType: string) {\n    const pm = this.pluginManager\n    return pm.getRendererType(rendererType) as ComparativeRenderer\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rendererType } = args\n    const renderer = this.getRenderer(rendererType)\n    const n = (await super.serializeArguments(args, rpcDriver)) as RenderArgs\n    const result = await this.renameRegionsIfNeeded(n, renderer)\n\n    return rpcDriver === 'MainThreadRpcDriver'\n      ? result\n      : renderer.serializeArgsInClient(result)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { sessionId, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const renderer = this.getRenderer(rendererType)\n    return rpcDriver === 'MainThreadRpcDriver'\n      ? renderer.render(deserializedArgs)\n      : renderer.renderInWorker(deserializedArgs)\n  }\n\n  async deserializeReturn(\n    val: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriver: string,\n  ): Promise<unknown> {\n    const ret = (await super.deserializeReturn(\n      val,\n      args,\n      rpcDriver,\n    )) as ResultsSerialized\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return ret\n    }\n\n    const renderer = this.getRenderer(args.rendererType)\n    return renderer.deserializeResultsInClient(ret, args)\n  }\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { getSession, Feature, gatherOverlaps } from '@jbrowse/core/util'\nimport {\n  LinearPileupDisplayModel,\n  MismatchParser,\n} from '@jbrowse/plugin-alignments'\n\n// locals\nimport { ReducedFeature } from '../util'\n\nconst { featurizeSA, getClip, getTag, getLength, getLengthSansClipping } =\n  MismatchParser\n\nexport function onClick(feature: Feature, self: LinearPileupDisplayModel) {\n  const session = getSession(self)\n  try {\n    const cigar = feature.get('CIGAR')\n    const clipPos = getClip(cigar, 1)\n    const flags = feature.get('flags')\n    const strand = feature.get('strand')\n    const readName = feature.get('name')\n    const readAssembly = `${readName}_assembly_${Date.now()}`\n    const { parentTrack } = self\n    const [trackAssembly] = getConf(parentTrack, 'assemblyNames')\n    const assemblyNames = [trackAssembly, readAssembly]\n    const trackId = `track-${Date.now()}`\n    const trackName = `${readName}_vs_${trackAssembly}`\n    const SA = (getTag(feature, 'SA') as string) || ''\n    const SA2 = featurizeSA(SA, feature.id(), strand, readName, true)\n\n    const feat = feature.toJSON()\n    feat.strand = 1\n    feat.mate = {\n      refName: readName,\n      start: clipPos,\n      end: clipPos + getLengthSansClipping(cigar),\n    }\n\n    // if secondary alignment or supplementary, calculate length from SA[0]'s\n    // CIGAR which is the primary alignments. otherwise it is the primary\n    // alignment just use seq.length if primary alignment\n    const totalLength = getLength(flags & 2048 ? SA2[0].CIGAR : cigar)\n\n    const features = [feat, ...SA2] as ReducedFeature[]\n\n    features.sort((a, b) => a.clipPos - b.clipPos)\n\n    const refLength = features.reduce((a, f) => a + f.end - f.start, 0)\n\n    session.addView('DotplotView', {\n      type: 'DotplotView',\n      hview: {\n        offsetPx: 0,\n        bpPerPx: refLength / 800,\n        displayedRegions: gatherOverlaps(\n          features.map((f, index) => {\n            const { start, end, refName } = f\n            return {\n              start,\n              end,\n              refName,\n              index,\n              assemblyName: trackAssembly,\n            }\n          }),\n        ),\n      },\n      vview: {\n        offsetPx: 0,\n        bpPerPx: totalLength / 400,\n        minimumBlockWidth: 0,\n        interRegionPaddingWidth: 0,\n        displayedRegions: [\n          {\n            assemblyName: readAssembly,\n            start: 0,\n            end: totalLength,\n            refName: readName,\n          },\n        ],\n      },\n\n      viewTrackConfigs: [\n        {\n          type: 'SyntenyTrack',\n          assemblyNames,\n          adapter: {\n            type: 'FromConfigAdapter',\n            features,\n          },\n          trackId,\n          name: trackName,\n        },\n      ],\n      assemblyNames,\n      tracks: [\n        {\n          configuration: trackId,\n          type: 'SyntenyTrack',\n          displays: [\n            {\n              type: 'DotplotDisplay',\n              configuration: `${trackId}-DotplotDisplay`,\n            },\n          ],\n        },\n      ],\n\n      displayName: `${readName} vs ${trackAssembly}`,\n    })\n  } catch (e) {\n    console.error(e)\n    session.notifyError(`${e}`, e)\n  }\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\n\n// icons\nimport TimelineIcon from '@mui/icons-material/Timeline'\n\n// locals\nimport DotplotViewF from './DotplotView'\nimport DotplotDisplayF from './DotplotDisplay'\nimport DotplotRendererF from './DotplotRenderer'\nimport LaunchDotplotViewF from './LaunchDotplotView'\nimport ComparativeRenderer from './ComparativeRenderer'\nimport DotplotReadVsRefMenuItem from './DotplotReadVsRef'\n\nexport default class DotplotPlugin extends Plugin {\n  name = 'DotplotPlugin'\n\n  install(pluginManager: PluginManager) {\n    DotplotViewF(pluginManager)\n    DotplotDisplayF(pluginManager)\n    DotplotRendererF(pluginManager)\n    LaunchDotplotViewF(pluginManager)\n    DotplotReadVsRefMenuItem(pluginManager)\n\n    // install our comparative rendering rpc callback\n    pluginManager.addRpcMethod(() => new ComparativeRenderer(pluginManager))\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Dotplot view',\n        icon: TimelineIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('DotplotView', {})\n        },\n      })\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport { stateModelFactory } from './stateModelFactory'\nimport ReactComponent from './components/DotplotDisplay'\n\nexport default function DotplotDisplayF(pm: PluginManager) {\n  pm.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pm)\n    return new DisplayType({\n      name: 'DotplotDisplay',\n      displayName: 'Dotplot display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'DotplotView',\n      ReactComponent,\n    })\n  })\n}\n\n/**\n * #config DotplotDisplay\n */\nexport function configSchemaFactory(pm: any) {\n  return ConfigurationSchema(\n    'DotplotDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(pm.pluggableConfigSchemaType('renderer'), {\n        type: 'DotplotRenderer',\n      }),\n    },\n    {\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'displayId',\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { lazy } from 'react'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n// locals\nimport stateModelFactory from './model'\n\nexport default function DotplotViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'DotplotView',\n      displayName: 'Dotplot view',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/DotplotView')),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from './components/DotplotRendering'\nimport DotplotRenderer from './DotplotRenderer'\nimport configSchema from './configSchema'\n\nexport default function DotplotRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new DotplotRenderer({\n        name: 'DotplotRenderer',\n        configSchema: configSchema,\n        ReactComponent,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { DotplotViewModel } from './DotplotView/model'\nimport { transaction } from 'mobx'\n\nexport default function LaunchDotplotView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-DotplotView',\n    // @ts-expect-error\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: { loc: string; assembly: string; tracks?: string[] }[]\n      tracks?: string[]\n    }) => {\n      try {\n        const model = session.addView('DotplotView', {}) as DotplotViewModel\n        const assemblyNames = views.map(view => view.assembly)\n\n        transaction(() => {\n          model.setViews([\n            { bpPerPx: 0.1, offsetPx: 0 },\n            { bpPerPx: 0.1, offsetPx: 0 },\n          ])\n          model.setAssemblyNames(assemblyNames[0], assemblyNames[1])\n        })\n\n        // http://localhost:3000/?config=test_data%2Fvolvox%2Fconfig.json&session=spec-{\"views\":[{\"type\":\"DotplotView\",\"views\":[{\"assembly\":\"volvox\"},{\"assembly\":\"volvox\"}],\"tracks\":[\"volvox_fake_synteny\"]}]}\n\n        const idsNotFound = [] as string[]\n        tracks.forEach(track => tryTrack(model, track, idsNotFound))\n\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notifyError(`${e}`, e)\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: { showTrack: (arg: string) => void },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (`${e}`.match('Could not resolve identifier')) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  DisplayType,\n  PluggableElementType,\n} from '@jbrowse/core/pluggableElementTypes'\nimport { LinearPileupDisplayModel } from '@jbrowse/plugin-alignments'\n\n// icons\nimport AddIcon from '@mui/icons-material/Add'\n\n// local\nimport { onClick } from './DotplotReadVsRef'\n\nexport default function DotplotReadVsRefMenuItem(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-extendPluggableElement',\n    (pluggableElement: PluggableElementType) => {\n      if (pluggableElement.name === 'LinearPileupDisplay') {\n        const { stateModel } = pluggableElement as DisplayType\n        const newStateModel = stateModel.extend(\n          (self: LinearPileupDisplayModel) => {\n            const superContextMenuItems = self.contextMenuItems\n            return {\n              views: {\n                contextMenuItems() {\n                  const feature = self.contextMenuFeature\n                  return [\n                    ...superContextMenuItems(),\n                    ...(feature\n                      ? [\n                          {\n                            label: 'Dotplot of read vs ref',\n                            icon: AddIcon,\n                            onClick: () => onClick(feature, self),\n                          },\n                        ]\n                      : []),\n                  ]\n                },\n              },\n            }\n          },\n        )\n\n        ;(pluggableElement as DisplayType).stateModel = newStateModel\n      }\n      return pluggableElement\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config GtfAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GtfAdapter = ConfigurationSchema(\n  'GtfAdapter',\n  {\n    /**\n     * #slot\n     */\n    gtfLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gtf', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default GtfAdapter\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport { configSchema as gtfAdapterConfigSchema } from './GtfAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nexport default class GtfPlugin extends Plugin {\n  name = 'GTFPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'GtfAdapter',\n          displayName: 'GTF adapter',\n          configSchema: gtfAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./GtfAdapter/GtfAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.gtf(\\.gz)?$/i\n          const adapterName = 'GtfAdapter'\n          const fileName = getFileName(file)\n\n          const obj = {\n            type: adapterName,\n            gtfLocation: file,\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config Gff3TabixAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Gff3TabixAdapter = ConfigurationSchema(\n  'Gff3TabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    gffGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff.gz', locationType: 'UriLocation' },\n    },\n\n    index: ConfigurationSchema('Gff3TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.indexType\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.gff.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     * the Gff3TabixAdapter has to \"redispatch\" if it fetches a region and\n     * features it finds inside that region extend outside the region we requested.\n     * you can disable this for certain feature types to avoid fetching e.g. the\n     * entire chromosome\n     */\n    dontRedispatch: {\n      type: 'stringArray',\n      defaultValue: ['chromosome', 'region'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default Gff3TabixAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config Gff3Adapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Gff3Adapter = ConfigurationSchema(\n  'Gff3Adapter',\n  {\n    /**\n     * #slot\n     */\n    gffLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default Gff3Adapter\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\n\nimport Gff3TabixAdapterF from './Gff3TabixAdapter'\nimport Gff3AdapterF from './Gff3Adapter'\nimport GuessGff3F from './GuessGff3'\n\nexport default class GFF3Plugin extends Plugin {\n  name = 'GFF3Plugin'\n\n  install(pluginManager: PluginManager) {\n    Gff3TabixAdapterF(pluginManager)\n    Gff3AdapterF(pluginManager)\n    GuessGff3F(pluginManager)\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\n\nexport default function Gff3TabixAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'Gff3TabixAdapter',\n        displayName: 'GFF3 tabix adapter',\n        configSchema,\n        getAdapterClass: () =>\n          import('./Gff3TabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\n\nexport default function Gff3AdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'Gff3Adapter',\n        displayName: 'GFF3 adapter',\n        configSchema,\n        getAdapterClass: () => import('./Gff3Adapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  makeIndexType,\n  getFileName,\n  AdapterGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default function GuessGff3F(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.gff3?\\.b?gz$/i\n        const adapterName = 'Gff3TabixAdapter'\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n        if (regexGuess.test(fileName) || adapterHint === adapterName) {\n          return {\n            type: adapterName,\n            bamLocation: file,\n            gffGzLocation: file,\n            index: {\n              location: index || makeIndex(file, '.tbi'),\n              indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n            },\n          }\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.gff3?$/i\n        const adapterName = 'Gff3Adapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          gffLocation: file,\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\n\n/**\n * #stateModel\n */\nexport const Job = types\n  .model('Job', {\n    /**\n     * #property\n     */\n    name: types.string,\n    /**\n     * #property\n     */\n    statusMessage: types.maybe(types.string),\n    /**\n     * #property\n     */\n    progressPct: types.number,\n  })\n  .volatile(() => ({\n    cancelCallback() {},\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setCancelCallback(cancelCallback: () => void) {\n      self.cancelCallback = cancelCallback\n    },\n\n    /**\n     * #action\n     */\n    setStatusMessage(message?: string) {\n      self.statusMessage = message\n    },\n\n    /**\n     * #action\n     */\n    setProgressPct(pct: number) {\n      self.progressPct = pct\n    },\n  }))\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport { lazy } from 'react'\n\nimport { stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('JobsListWidget', {})\n\nexport default function JobsListWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'JobsListWidget',\n      heading: 'Jobs list',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/JobsListWidget')),\n    })\n  })\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SessionWithWidgets, isAbstractMenuManager } from '@jbrowse/core/util'\nimport { Indexing } from '@jbrowse/core/ui/Icons'\nimport { isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport JobsListWidgetF from './JobsListWidget'\n\nexport default class JobsManagementPlugin extends Plugin {\n  name = 'JobsManagementPlugin'\n\n  install(pluginManager: PluginManager) {\n    JobsListWidgetF(pluginManager)\n  }\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Tools', {\n        label: 'Jobs list',\n        icon: Indexing, // TODO: pick a better icon\n        onClick: (session: SessionWithWidgets) => {\n          if (isSessionModelWithWidgets(session)) {\n            const { widgets } = session\n            let jobStatusWidget = widgets.get('JobsList')\n            if (!jobStatusWidget) {\n              jobStatusWidget = session.addWidget('JobsListWidget', 'JobsList')\n              session.showWidget(jobStatusWidget)\n            } else {\n              session.showWidget(jobStatusWidget)\n            }\n          }\n        },\n      })\n    }\n  }\n}\n","import { types, Instance, SnapshotIn } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { Job } from './jobModel'\n\nexport interface NewJob extends SnapshotIn<typeof Job> {\n  cancelCallback(): void\n  setStatusMessage(msg?: string): void\n}\n\n/**\n * #stateModel JobsListModel\n */\nexport function stateModelFactory(_pluginManager: PluginManager) {\n  return types\n    .model('JobsListModel', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('JobsListWidget'),\n      /**\n       * #property\n       */\n      jobs: types.array(Job),\n      /**\n       * #property\n       */\n      finished: types.array(Job),\n      /**\n       * #property\n       */\n      queued: types.array(Job),\n      /**\n       * #property\n       */\n      aborted: types.array(Job),\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addJob(job: NewJob) {\n        const { cancelCallback } = job\n        const length = self.jobs.push(job)\n        const addedJob = self.jobs[length - 1]\n        addedJob.setCancelCallback(cancelCallback)\n        return addedJob\n      },\n      /**\n       * #action\n       */\n      removeJob(jobName: string) {\n        const indx = self.jobs.findIndex(job => job.name === jobName)\n        const removed = self.jobs[indx]\n        self.jobs.splice(indx, 1)\n        return removed\n      },\n      /**\n       * #action\n       */\n      addFinishedJob(job: NewJob) {\n        self.finished.push(job)\n        return self.finished\n      },\n      /**\n       * #action\n       */\n      addQueuedJob(job: NewJob) {\n        self.queued.push(job)\n        return self.finished\n      },\n      /**\n       * #action\n       */\n      addAbortedJob(job: NewJob) {\n        self.aborted.push(job)\n        return self.aborted\n      },\n      /**\n       * #action\n       */\n      removeQueuedJob(jobName: string) {\n        const indx = self.queued.findIndex(job => job.name === jobName)\n        const removed = self.queued[indx]\n        self.queued.splice(indx, 1)\n        return removed\n      },\n      /**\n       * #action\n       */\n      updateJobStatusMessage(jobName: string, message?: string) {\n        const job = self.jobs.find(job => job.name === jobName)\n        if (!job) {\n          throw new Error(`No job found with name ${jobName}`)\n        }\n        job.setStatusMessage(message)\n      },\n      /**\n       * #action\n       */\n      updateJobProgressPct(jobName: string, pct: number) {\n        const job = self.jobs.find(job => job.name === jobName)\n        if (!job) {\n          throw new Error(`No job found with name ${jobName}`)\n        }\n        job.setProgressPct(pct)\n      },\n    }))\n}\n\nexport type JobsListStateModel = ReturnType<typeof stateModelFactory>\nexport type JobsListModel = Instance<JobsListStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config NCListAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst NCListAdapter = ConfigurationSchema(\n  'NCListAdapter',\n  {\n    /**\n     * #slot\n     */\n    rootUrlTemplate: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/{refseq}/trackData.json',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of refNames used by the NCList used for aliasing',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default NCListAdapter\n","/**\n * Helper class allows reading names index generated in JBrowse1\n * Adapted from https://github.com/GMOD/jbrowse/blob/master/src/JBrowse/Store/Hash.js\n */\nimport crc32 from 'buffer-crc32'\n\nexport default class HttpMap {\n  url: string\n\n  constructor(args: { url: string }) {\n    // make sure url has a trailing slash\n    this.url = args.url.endsWith('/') ? args.url : `${args.url}/`\n  }\n\n  /**\n   * loads meta.json file from names directory and reads number of hash_bits used\n   */\n  async readMeta() {\n    const meta = await this.loadFile('meta.json')\n    const { compress, track_names: tracks } = meta\n    const hashHexCharacters = Math.ceil(meta.hash_bits / 4)\n    return { hashHexCharacters, compress, tracks }\n  }\n\n  async getHashHexCharacters() {\n    const meta = await this.readMeta()\n    return meta.hashHexCharacters\n  }\n\n  async getCompress() {\n    const meta = await this.readMeta()\n    return meta.compress\n  }\n\n  async getTrackNames() {\n    const meta = await this.readMeta()\n    return meta.tracks\n  }\n\n  /**\n   * Returns contents of a bucket given a key\n   * @param key - string\n   */\n  async get(key: string) {\n    const bucket = await this.getBucket(key)\n    return bucket[key]\n  }\n\n  /**\n   * Returns a bucket given a key\n   * @param key - string\n   */\n  async getBucket(key: string) {\n    const bucketIdent = this.hash(key)\n    const hexToDirPath = await this.hexToDirPath(bucketIdent)\n    return this.loadFile(hexToDirPath)\n  }\n\n  /**\n   * Loads a file using the url and provided id.\n   * Returns response object with contents of the file\n   * @param id - string\n   */\n  async loadFile(id: string) {\n    const response = await fetch(`${this.url}${id}`)\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status} ${response.statusText}`)\n    }\n    return response.json()\n  }\n\n  /**\n   * Returns the corresponding path of the file given a hex string\n   * @param hex - hex string\n   */\n  async hexToDirPath(hex: string) {\n    // zero-pad the hex string to be 8 chars if necessary\n    const hashHexCharacters = await this.getHashHexCharacters()\n    if (hashHexCharacters) {\n      const compress = await this.getCompress()\n      while (hex.length < 8) {\n        hex = `0${hex}`\n      }\n      hex = hex.slice(8 - hashHexCharacters)\n      const dirpath = []\n      for (let i = 0; i < hex.length; i += 3) {\n        dirpath.push(hex.slice(i, i + 3))\n      }\n      return `${dirpath.join('/')}.json${compress ? 'z' : ''}`\n    }\n    return ''\n  }\n\n  hash(data: string) {\n    return crc32(Buffer.from(data))\n      .toString('hex')\n      .toLowerCase()\n      .replace('-', 'n')\n  }\n}\n","import {\n  BaseTextSearchAdapter,\n  BaseTextSearchArgs,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport HttpMap from './HttpMap'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nexport interface TooManyHits {\n  name: string\n  hitLimit: number\n}\n\ninterface SearchResults {\n  prefix: ({ name: string } | string)[]\n  exact: [string, number, string, string, number, number][]\n}\n\nexport type NamesIndexRecord = string | (string | number)[]\n\ntype IndexFile = Record<string, SearchResults>\n\n// Uses index built by generate-names.pl\nexport default class JBrowse1TextSearchAdapter\n  extends BaseAdapter\n  implements BaseTextSearchAdapter\n{\n  httpMap: HttpMap\n\n  tracksNames?: string[]\n\n  constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const namesIndex = readConfObject(config, 'namesIndexLocation')\n    const { baseUri, uri } = namesIndex\n    this.httpMap = new HttpMap({\n      url: baseUri ? new URL(uri, baseUri).href : uri,\n    })\n  }\n\n  /**\n   * Returns the contents of the file containing the query if it exists\n   * else it returns empty\n   * @param query - string query\n   */\n  async loadIndexFile(query: string): Promise<IndexFile> {\n    return this.httpMap.getBucket(query)\n  }\n\n  async searchIndex(args: BaseTextSearchArgs) {\n    const { searchType, queryString } = args\n    const tracks = this.tracksNames || (await this.httpMap.getTrackNames())\n    const str = queryString.toLowerCase()\n    const entries = await this.loadIndexFile(str)\n    return entries[str]\n      ? this.formatResults(entries[str], tracks, searchType)\n      : []\n  }\n  formatResults(results: SearchResults, tracks: string[], searchType?: string) {\n    return [\n      ...(searchType === 'exact'\n        ? []\n        : results.prefix.map(\n            result =>\n              new BaseResult({\n                label: typeof result === 'object' ? result.name : result,\n                matchedAttribute: 'name',\n                matchedObject: { result: result },\n              }),\n          )),\n      ...results.exact.map(result => {\n        const name = result[0]\n        const trackIndex = result[1]\n        const refName = result[3]\n        const start = result[4]\n        const end = result[5]\n        const locstring = `${refName || name}:${start}-${end}`\n        return new BaseResult({\n          locString: locstring,\n          label: name,\n          matchedAttribute: 'name',\n          matchedObject: result,\n          trackId: tracks[trackIndex],\n        })\n      }),\n    ].filter(result => result.getLabel() !== 'too many matches')\n  }\n\n  freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config JBrowse1TextSearchAdapter\n * note: metadata about tracks and assemblies covered by text search adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'JBrowse1TextSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    namesIndexLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/volvox/names', locationType: 'UriLocation' },\n      description: 'the location of the JBrowse1 names index data directory',\n    },\n    /**\n     * #slot\n     */\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'textSearchAdapterId',\n  },\n)\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config JBrowse1Connection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst JBrowse1Connection = ConfigurationSchema(\n  'JBrowse1Connection',\n  {\n    /**\n     * #slot\n     */\n    dataDirLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/jbrowse/data/',\n        locationType: 'UriLocation',\n      },\n      description:\n        'the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      description:\n        'name of the assembly the connection belongs to, should be a single entry',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseConnectionConfig,\n  },\n)\n\nexport default JBrowse1Connection\n","import {\n  ConfigurationReference,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types } from 'mobx-state-tree'\n\n// locals\nimport configSchema from './configSchema'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'JBrowse1Connection',\n      BaseConnectionModelFactory(pluginManager),\n      types.model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('JBrowse1Connection'),\n      }),\n    )\n\n    .actions(self => ({\n      async connect() {\n        const session = getSession(self)\n        try {\n          const dataDirLocation = getConf(self, 'dataDirLocation')\n          const { fetchJb1 } = await import('./jb1ConfigLoad')\n          const { convertTrackConfig } = await import('./jb1ToJb2')\n          const config = await fetchJb1(dataDirLocation)\n          const assemblyName = getConf(self, 'assemblyNames')[0]\n          if (!assemblyName) {\n            throw new Error('assembly name required for JBrowse 1 connection')\n          }\n          const conf = session.assemblies.find(\n            a => readConfObject(a, 'name') === assemblyName,\n          )\n          if (!conf) {\n            throw new Error(`Assembly \"${assemblyName}\" not found`)\n          }\n          const sequenceAdapter = readConfObject(conf, ['sequence', 'adapter'])\n\n          // @ts-expect-error\n          const jb2Tracks = config.tracks?.map(jb1Track => ({\n            ...convertTrackConfig(\n              jb1Track,\n              config.dataRoot || '',\n              sequenceAdapter,\n            ),\n            assemblyNames: [assemblyName],\n          }))\n\n          self.setTrackConfs(jb2Tracks)\n        } catch (error) {\n          console.error(error)\n          session.notifyError(\n            `There was a problem connecting to the JBrowse 1 data directory \"${self.name}\". Please make sure you have entered a valid location. The error that was thrown is: \"${error}\"`,\n            error,\n          )\n          session.breakConnection?.(self.configuration)\n        }\n      },\n    }))\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport NCListAdapterF from './NCListAdapter'\nimport JBrowse1TextSearchAdapterF from './JBrowse1TextSearchAdapter'\nimport JBrowse1ConnectionF from './JBrowse1Connection'\nimport GuessNCListF from './GuessNCList'\n\nexport default class LegacyJBrowsePlugin extends Plugin {\n  name = 'LegacyJBrowsePlugin'\n\n  install(pluginManager: PluginManager) {\n    NCListAdapterF(pluginManager)\n    GuessNCListF(pluginManager)\n    JBrowse1TextSearchAdapterF(pluginManager)\n    JBrowse1ConnectionF(pluginManager)\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport configSchema from './configSchema'\n\nexport default function NCListAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'NCListAdapter',\n        displayName: 'NCList adapter',\n        configSchema,\n        getAdapterClass: () => import('./NCListAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\nimport { FileLocation } from '@jbrowse/core/util/types'\n\nexport default function GuessNCListF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /trackData.jsonz?$/i\n        const adapterName = 'NCListAdapter'\n        const fileName = getFileName(file)\n        if (regexGuess.test(fileName) || adapterHint === adapterName) {\n          return {\n            type: adapterName,\n            rootUrlTemplate: file,\n          }\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\n\n// locals\nimport AdapterClass from './JBrowse1TextSearchAdapter'\nimport configSchema from './configSchema'\n\nexport default function JBrowse1TextSearchAdapterF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addTextSearchAdapterType(\n    () =>\n      new TextSearchAdapterType({\n        name: 'JBrowse1TextSearchAdapter',\n        configSchema,\n        AdapterClass,\n        description: 'A JBrowse 1 text search adapter',\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\n\n// locals\nimport modelFactory from './model'\nimport configSchema from './configSchema'\n\nexport default function JBrowse1ConnectionF(pluginManager: PluginManager) {\n  pluginManager.addConnectionType(\n    () =>\n      new ConnectionType({\n        name: 'JBrowse1Connection',\n        configSchema,\n        stateModel: modelFactory(pluginManager),\n        displayName: 'JBrowse 1 Data',\n        description: 'A JBrowse 1 data directory',\n        url: '//jbrowse.org/',\n      }),\n  )\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config LinearComparativeDisplay\n */\nfunction configSchemaFactory(_pluginManager: any) {\n  return ConfigurationSchema(\n    'LinearComparativeDisplay',\n    {},\n    {\n      explicitlyTyped: true,\n\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'displayId',\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import {\n  readConfObject,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { types, getSnapshot, Instance, getParent } from 'mobx-state-tree'\nimport {\n  dedupe,\n  Feature,\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { LinearComparativeViewModel } from '../LinearComparativeView/model'\n\n/**\n * #stateModel LinearComparativeDisplay\n * extends\n * - [BaseDisplay](../basedisplay)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearComparativeDisplay',\n      BaseDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearComparativeDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile((/* self */) => ({\n      renderInProgress: undefined as AbortController | undefined,\n      features: undefined as Feature[] | undefined,\n      message: undefined as string | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      renderProps() {\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          highResolutionScaling: 2,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setLoading(abortController: AbortController) {\n          self.message = undefined\n          self.error = undefined\n          renderInProgress = abortController\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.message = messageText\n          self.error = undefined\n          renderInProgress = undefined\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setRendered(args?: { features: Feature[] }) {\n          if (!args) {\n            return\n          }\n          const { features } = args\n          const existingFeatures = self.features || []\n\n          const featIds = new Set(existingFeatures.map(f => f.id()) || [])\n          const newFeatIds = new Set(features?.map(f => f.id()) || [])\n\n          let foundNewFeatureNotInExistingMap = false\n          let foundExistingFeatureNotInNewMap = false\n          for (const feat of features) {\n            if (!featIds.has(feat.id())) {\n              foundNewFeatureNotInExistingMap = true\n              break\n            }\n          }\n          for (const existingFeat of existingFeatures) {\n            if (!newFeatIds.has(existingFeat.id())) {\n              foundExistingFeatureNotInNewMap = true\n              break\n            }\n          }\n\n          self.message = undefined\n          self.error = undefined\n          renderInProgress = undefined\n\n          if (\n            foundNewFeatureNotInExistingMap ||\n            foundExistingFeatureNotInNewMap ||\n            !self.features\n          ) {\n            self.features = features\n          }\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setError(error: unknown) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.message = undefined\n          self.error = error\n          renderInProgress = undefined\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        makeAbortableReaction(\n          // @ts-expect-error\n          self,\n          renderBlockData,\n          renderBlockEffect,\n          {\n            name: `${self.type} ${self.id} rendering`,\n            delay: 1000,\n            fireImmediately: true,\n          },\n          self.setLoading,\n          self.setRendered,\n          self.setError,\n        )\n      },\n    }))\n}\nfunction renderBlockData(self: LinearComparativeDisplay) {\n  const { rpcManager } = getSession(self)\n  const display = self\n\n  // Alternative to readConfObject(config) is below used because\n  // renderProps is something under our control.  Compare to\n  // serverSideRenderedBlock\n  readConfObject(self.configuration)\n\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as LinearComparativeViewModel\n  const sessionId = getRpcSessionId(self)\n  getSnapshot(parent)\n  return parent.initialized\n    ? {\n        rpcManager,\n        renderProps: {\n          ...display.renderProps(),\n          // @ts-expect-error\n          level: getParent(self, 4).level as number,\n          view: parent,\n          adapterConfig,\n          sessionId,\n          timeout: 1000000,\n          self,\n        },\n      }\n    : undefined\n}\n\nasync function renderBlockEffect(props: ReturnType<typeof renderBlockData>) {\n  if (!props) {\n    return\n  }\n\n  const { rpcManager, renderProps } = props\n  const { adapterConfig, level } = renderProps\n  const view = renderProps.view.views[level]\n  const features = (await rpcManager.call('getFeats', 'CoreGetFeatures', {\n    regions: view.staticBlocks.contentBlocks,\n    sessionId: 'getFeats',\n    adapterConfig,\n  })) as Feature[]\n\n  return {\n    features: dedupe(features, f => f.id()),\n  }\n}\n\nexport default stateModelFactory\nexport type LinearComparativeDisplayModel = ReturnType<typeof stateModelFactory>\nexport type LinearComparativeDisplay = Instance<LinearComparativeDisplayModel>\n","import { lazy } from 'react'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  getPath,\n  getRoot,\n  onAction,\n  resolveIdentifier,\n  types,\n  Instance,\n  SnapshotIn,\n} from 'mobx-state-tree'\nimport { autorun, transaction } from 'mobx'\n\n// jbrowse\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { getSession, isSessionModelWithWidgets, avg } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\n\n// lazies\nconst ReturnToImportFormDialog = lazy(\n  () => import('@jbrowse/core/ui/ReturnToImportFormDialog'),\n)\n\n/**\n * #stateModel LinearComparativeView\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'LinearComparativeView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('LinearComparativeView'),\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        showIntraviewLinks: true,\n        /**\n         * #property\n         */\n        linkViews: false,\n        /**\n         * #property\n         */\n        interactToggled: false,\n\n        /**\n         * #property\n         */\n        levels: types.array(\n          types\n            .model({\n              tracks: types.array(\n                pluginManager.pluggableMstType('track', 'stateModel'),\n              ),\n              height: 100,\n              level: types.number,\n            })\n            .actions(self => ({\n              setHeight(n: number) {\n                self.height = n\n              },\n            })),\n        ),\n        /**\n         * #property\n         * currently this is limited to an array of two\n         */\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n\n        /**\n         * #property\n         * this represents tracks specific to this view specifically used\n         * for read vs ref dotplots where this track would not really apply\n         * elsewhere\n         */\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      width: undefined as number | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get initialized() {\n        return (\n          self.width !== undefined &&\n          self.views.length > 0 &&\n          self.views.every(view => view.initialized)\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get refNames() {\n        return self.views.map(v => [\n          ...new Set(v.staticBlocks.map(m => m.refName)),\n        ])\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        return [...new Set(self.views.flatMap(v => v.assemblyNames))]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(self, param => {\n            if (self.linkViews) {\n              const { name, path, args } = param\n\n              // doesn't link showTrack/hideTrack, doesn't make sense in\n              // synteny views most time\n              const actions = ['horizontalScroll', 'zoomTo', 'setScaleFactor']\n              if (actions.includes(name) && path) {\n                this.onSubviewAction(name, path, args)\n              }\n            }\n          }),\n        )\n      },\n\n      // automatically removes session assemblies associated with this view\n      // e.g. read vs ref\n      beforeDestroy() {\n        const session = getSession(self)\n        for (const name of self.assemblyNames) {\n          session.removeTemporaryAssembly?.(name)\n        }\n      },\n\n      onSubviewAction(actionName: string, path: string, args?: unknown[]) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (!ret.endsWith(path)) {\n            // @ts-expect-error\n            view[actionName](args?.[0])\n          }\n        })\n      },\n\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.width = newWidth\n      },\n\n      /**\n       * #action\n       */\n      setViews(views: SnapshotIn<LinearGenomeViewModel>[]) {\n        self.views = cast(views)\n      },\n\n      /**\n       * #action\n       */\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      /**\n       * #action\n       * removes the view itself from the state tree entirely by calling the\n       * parent removeView\n       */\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      /**\n       * #action\n       */\n      setLevelHeight(n: number, level = 0) {\n        self.levels[level].setHeight(n)\n        return self.levels[level].height\n      },\n\n      /**\n       * #action\n       */\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n          return undefined\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string, level = 0) {\n        const hiddenCount = this.hideTrack(trackId, level)\n        if (!hiddenCount) {\n          this.showTrack(trackId, level)\n          return true\n        }\n        return false\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, level = 0, initialSnapshot = {}) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(schema, getRoot(self), trackId)\n        if (!configuration) {\n          throw new Error(`track not found ${trackId}`)\n        }\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = new Set(\n          viewType.displayTypes.map(d => d.name),\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.has(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        if (!self.levels[level]) {\n          self.levels[level] = cast({ level })\n        }\n        self.levels[level].tracks.push(\n          trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [\n              {\n                type: displayConf.type,\n                configuration: displayConf,\n              },\n            ],\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string, level = 0) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const config = resolveIdentifier(schema, getRoot(self), trackId)\n        const shownTracks = self.levels[level].tracks.filter(\n          t => t.configuration === config,\n        )\n        transaction(() =>\n          shownTracks.forEach(t => self.levels[level].tracks.remove(t)),\n        )\n        return shownTracks.length\n      },\n      /**\n       * #action\n       */\n      squareView() {\n        const average = avg(self.views.map(v => v.bpPerPx))\n        self.views.forEach(view => {\n          const center = view.pxToBp(view.width / 2)\n          view.setNewView(average, view.offsetPx)\n          if (!center.refName) {\n            return\n          }\n          view.centerAt(center.coord, center.refName, center.index)\n        })\n      },\n      /**\n       * #action\n       */\n      clearView() {\n        self.views = cast([])\n        self.levels = cast([])\n      },\n    }))\n    .views(() => ({\n      /**\n       * #method\n       * includes a subset of view menu options because the full list is a\n       * little overwhelming. overridden by subclasses\n       */\n      headerMenuItems(): MenuItem[] {\n        return []\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems(): MenuItem[] {\n        return [\n          ...self.views\n            .map((view, idx) => [idx, view.menuItems?.()] as const)\n            .filter(f => !!f[1])\n            .map(f => ({ label: `View ${f[0] + 1} Menu`, subMenu: f[1] })),\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          {\n            label: 'Open track selector',\n            onClick: self.activateTrackSelector,\n            icon: TrackSelectorIcon,\n          },\n        ]\n      },\n      /**\n       * #method\n       */\n      rubberBandMenuItems() {\n        return [\n          {\n            label: 'Zoom to region(s)',\n            onClick: () => {\n              self.views.forEach(view => {\n                const { leftOffset, rightOffset } = view\n                if (leftOffset && rightOffset) {\n                  view.moveTo(leftOffset, rightOffset)\n                }\n              })\n            },\n          },\n        ]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (self.width) {\n              self.views.forEach(v => v.setWidth(self.width))\n            }\n          }),\n        )\n      },\n    }))\n}\n\nexport type LinearComparativeViewStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearComparativeViewModel =\n  Instance<LinearComparativeViewStateModel>\n\nexport default stateModelFactory\n","import { types, Instance, getParent } from 'mobx-state-tree'\nimport {\n  getConf,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util'\n\n// locals\nimport baseModelFactory from '../LinearComparativeDisplay/stateModelFactory'\n\ninterface Pos {\n  offsetPx: number\n}\n\nexport interface FeatPos {\n  p11: Pos\n  p12: Pos\n  p21: Pos\n  p22: Pos\n  f: Feature\n  cigar: string[]\n}\n\n/**\n * #stateModel LinearSyntenyDisplay\n * extends\n * - [LinearComparativeDisplay](../linearcomparativedisplay)\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearSyntenyDisplay',\n      baseModelFactory(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSyntenyDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile(() => ({\n      // canvas used for drawing visible screen\n      mainCanvas: null as HTMLCanvasElement | null,\n\n      // canvas used for drawing click map with feature ids\n      // this renders a unique color per alignment, so that it can be re-traced\n      // after a feature click with getImageData at that pixel\n      clickMapCanvas: null as HTMLCanvasElement | null,\n\n      // canvas used for drawing click map with cigar data\n      // this can show if you are mousing over a insertion/deletion. it is similar\n      // in purpose to the clickMapRef but was not feasible to pack this into the\n      // clickMapRef\n      cigarClickMapCanvas: null as HTMLCanvasElement | null,\n\n      // canvas for drawing mouseover shading\n      // this is separate from the other code for speed: don't have to redraw\n      // entire canvas to do a feature's mouseover shading\n      mouseoverCanvas: null as HTMLCanvasElement | null,\n\n      // assigned by reaction\n      featPositions: [] as FeatPos[],\n\n      // currently mouse'd over feature\n      mouseoverId: undefined as string | undefined,\n\n      // currently click'd over feature\n      clickId: undefined as string | undefined,\n\n      // currently mouseover'd CIGAR subfeature\n      cigarMouseoverId: -1,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setFeatPositions(arg: FeatPos[]) {\n        self.featPositions = arg\n      },\n      /**\n       * #action\n       */\n      setMainCanvasRef(ref: HTMLCanvasElement | null) {\n        self.mainCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setClickMapCanvasRef(ref: HTMLCanvasElement | null) {\n        self.clickMapCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setCigarClickMapCanvasRef(ref: HTMLCanvasElement | null) {\n        self.cigarClickMapCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setMouseoverCanvasRef(ref: HTMLCanvasElement | null) {\n        self.mouseoverCanvas = ref\n      },\n      /**\n       * #action\n       */\n      setMouseoverId(arg?: string) {\n        self.mouseoverId = arg\n      },\n      /**\n       * #action\n       */\n      setCigarMouseoverId(arg: number) {\n        self.cigarMouseoverId = arg\n      },\n      /**\n       * #action\n       */\n      setClickId(arg?: string) {\n        self.clickId = arg\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get adapterConfig() {\n        return {\n          name: self.parentTrack.configuration.adapter.type,\n          assemblyNames: getConf(self, 'assemblyNames'),\n          ...getConf(self.parentTrack, 'adapter'),\n        }\n      },\n      /**\n       * #getter\n       */\n      get trackIds() {\n        return getConf(self, 'trackIds') as string[]\n      },\n      /**\n       * #getter\n       */\n      get height() {\n        // @ts-expect-error\n        return getParent(self, 4).height as number\n      },\n      /**\n       * #getter\n       */\n      get numFeats() {\n        return self.featPositions.length\n      },\n      /**\n       * #getter\n       * used for synteny svg rendering\n       */\n      get ready() {\n        return this.numFeats > 0\n      },\n\n      /**\n       * #getter\n       */\n      get featMap() {\n        return Object.fromEntries(self.featPositions.map(f => [f.f.id(), f]))\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('./afterAttach')\n            doAfterAttach(self)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n    }))\n}\n\nexport type LinearSyntenyDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearSyntenyDisplayModel = Instance<LinearSyntenyDisplayStateModel>\n\nexport default stateModelFactory\n","import { lazy } from 'react'\nimport {\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { SharedLinearPileupDisplayMixin } from '@jbrowse/plugin-alignments'\nimport { types } from 'mobx-state-tree'\n\nconst LaunchSyntenyViewDialog = lazy(\n  () => import('./components/LaunchSyntenyViewDialog'),\n)\n\n/**\n * #stateModel LGVSyntenyDisplay\n * displays location of \"synteny\" feature in a plain LGV, allowing linking out\n * to external synteny views\n *\n * extends\n * - [SharedLinearPileupDisplayMixin](../sharedlinearpileupdisplaymixin)\n */\nfunction stateModelFactory(schema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LGVSyntenyDisplay',\n      SharedLinearPileupDisplayMixin(schema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LGVSyntenyDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(schema),\n      }),\n    )\n    .views(self => {\n      const superContextMenuItems = self.contextMenuItems\n      return {\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          const feature = self.contextMenuFeature\n          return [\n            ...superContextMenuItems(),\n            ...(feature\n              ? [\n                  {\n                    label: 'Open synteny view for this position',\n                    onClick: () => {\n                      getSession(self).queueDialog(handleClose => [\n                        LaunchSyntenyViewDialog,\n                        {\n                          model: self,\n                          handleClose,\n                          feature,\n                        },\n                      ])\n                    },\n                  },\n                ]\n              : []),\n          ]\n        },\n      }\n    })\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        colorSchemeSubMenuItems: superColorSchemeSubMenuItems,\n      } = self\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Color scheme',\n              subMenu: [...superColorSchemeSubMenuItems()],\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      afterCreate() {\n        // use color by stand to help indicate inversions better on first load,\n        // otherwise use selected orientation\n        if (self.colorBy) {\n          self.setColorScheme({ ...self.colorBy })\n        } else {\n          self.setColorScheme({ type: 'strand' })\n        }\n      },\n    }))\n}\n\nexport default stateModelFactory\n","import React from 'react'\nimport { SvgIcon, SvgIconProps } from '@mui/material'\n\nexport function Curves(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function StraightLines(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M22 12L17 22L7.1 6.04L4.24 12H2L7 2L16.9 17.96L19.76 12H22Z\"\n      />\n    </SvgIcon>\n  )\n}\n","import React, { lazy } from 'react'\nimport { types, Instance } from 'mobx-state-tree'\nimport { transaction } from 'mobx'\nimport { getSession } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { saveAs } from 'file-saver'\n\n// icons\nimport CropFreeIcon from '@mui/icons-material/CropFree'\nimport LinkIcon from '@mui/icons-material/Link'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\nimport { Curves } from './components/Icons'\n\n// locals\nimport baseModel from '../LinearComparativeView/model'\n\n// lazies\nconst ExportSvgDialog = lazy(() => import('./components/ExportSvgDialog'))\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  scale?: number\n  filename?: string\n  Wrapper?: React.FC<{ children: React.ReactNode }>\n  fontSize?: number\n  rulerHeight?: number\n  textHeight?: number\n  paddingHeight?: number\n  headerHeight?: number\n  cytobandHeight?: number\n  themeName?: string\n  trackLabels?: string\n}\n\n/**\n * #stateModel LinearSyntenyView\n * extends\n * - [LinearComparativeView](../linearcomparativeview)\n */\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'LinearSyntenyView',\n      baseModel(pluginManager),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSyntenyView'),\n        /**\n         * #property/\n         */\n        drawCIGAR: true,\n        /**\n         * #property\n         */\n        drawCurves: false,\n      }),\n    )\n    .actions(self => ({\n      /**\n       * #action\n       */\n      toggleCurves() {\n        self.drawCurves = !self.drawCurves\n      },\n      /**\n       * #action\n       */\n      toggleCIGAR() {\n        self.drawCIGAR = !self.drawCIGAR\n      },\n      /**\n       * #action\n       */\n      showAllRegions() {\n        transaction(() => {\n          self.views.forEach(view => view.showAllRegionsInAssembly())\n        })\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      async exportSvg(opts: ExportSvgOptions) {\n        const { renderToSvg } = await import(\n          './svgcomponents/SVGLinearSyntenyView'\n        )\n        const html = await renderToSvg(self as LinearSyntenyViewModel, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .views(self => {\n      const superHeaderMenuItems = self.headerMenuItems\n      const superMenuItems = self.menuItems\n      return {\n        /**\n         * #method\n         * includes a subset of view menu options because the full list is a\n         * little overwhelming\n         */\n        headerMenuItems() {\n          return [\n            ...superHeaderMenuItems(),\n            {\n              label: 'Square view',\n              onClick: self.squareView,\n              description:\n                'Makes both views use the same zoom level, adjusting to the average of each',\n              icon: CropFreeIcon,\n            },\n            {\n              label: 'Show all regions',\n              onClick: self.showAllRegions,\n              description: 'Show entire genome assemblies',\n              icon: VisibilityIcon,\n            },\n            {\n              label: 'Draw CIGAR',\n              onClick: self.toggleCIGAR,\n              checked: self.drawCIGAR,\n              type: 'checkbox',\n              description: 'Draws per-base CIGAR level alignments',\n            },\n            {\n              label: 'Link views',\n              type: 'checkbox',\n              checked: self.linkViews,\n              onClick: self.toggleLinkViews,\n              icon: LinkIcon,\n            },\n            {\n              label: 'Use curved lines',\n              type: 'checkbox',\n              checked: self.drawCurves,\n              onClick: self.toggleCurves,\n              icon: Curves,\n            },\n            {\n              label: 'Export SVG',\n              icon: PhotoCameraIcon,\n              onClick: (): void => {\n                getSession(self).queueDialog(handleClose => [\n                  ExportSvgDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n        /**\n         * #method\n         */\n        menuItems() {\n          return [\n            ...superMenuItems(),\n            {\n              label: 'Export SVG',\n              icon: PhotoCameraIcon,\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  ExportSvgDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n}\nexport type LinearSyntenyViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearSyntenyViewModel = Instance<LinearSyntenyViewStateModel>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { when } from 'mobx'\n\n// locals\nimport { LinearSyntenyViewModel } from './LinearSyntenyView/model'\ntype LSV = LinearSyntenyViewModel\n\nexport default function LaunchLinearSyntenyView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-LinearSyntenyView',\n    // @ts-expect-error\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: { loc: string; assembly: string; tracks?: string[] }[]\n      tracks?: string[]\n    }) => {\n      try {\n        const { assemblyManager } = session\n        const model = session.addView('LinearSyntenyView', {}) as LSV\n\n        await when(() => !!model.width)\n\n        model.setViews(\n          await Promise.all(\n            views.map(async view => {\n              const asm = await assemblyManager.waitForAssembly(view.assembly)\n              if (!asm) {\n                throw new Error(`Assembly ${view.assembly} failed to load`)\n              }\n              return {\n                type: 'LinearGenomeView' as const,\n                bpPerPx: 1,\n                offsetPx: 0,\n                hideHeader: true,\n                displayedRegions: asm.regions,\n              }\n            }),\n          ),\n        )\n\n        await Promise.all(model.views.map(view => when(() => view.initialized)))\n\n        const idsNotFound = [] as string[]\n        await Promise.all(\n          views.map(async (data, idx) => {\n            const view = model.views[idx]\n            const { assembly, loc, tracks = [] } = data\n            const asm = await assemblyManager.waitForAssembly(assembly)\n            if (!asm) {\n              throw new Error(`Assembly ${data.assembly} failed to load`)\n            }\n            await view.navToSearchString({ input: loc, assembly: asm })\n            tracks.forEach(track => tryTrack(view, track, idsNotFound))\n          }),\n        )\n\n        tracks.forEach(track => tryTrack(model, track, idsNotFound))\n\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notifyError(`${e}`, e)\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: { showTrack: (arg: string) => void },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (`${e}`.match('Could not resolve identifier')) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('SyntenyFeatureWidget', {})\n\nconst stateModel = types\n  .model('SyntenyFeatureWidget', {\n    id: ElementId,\n    type: types.literal('SyntenyFeatureWidget'),\n    featureData: types.frozen(),\n  })\n  .actions(self => ({\n    setFeatureData(data: unknown) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = undefined\n    },\n  }))\n\nexport default function SyntenyFeatureWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'SyntenyFeatureWidget',\n        heading: 'Synteny feature details',\n        configSchema,\n        stateModel,\n        ReactComponent: lazy(() => import('./SyntenyFeatureDetail')),\n      }),\n  )\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\nimport { getSession, getContainingTrack } from '@jbrowse/core/util'\n\n// icons\nimport AddIcon from '@mui/icons-material/Add'\n\n// locals\nconst ReadVsRefDialog = lazy(() => import('./LinearReadVsRef'))\n\nfunction isDisplay(elt: { name: string }): elt is DisplayType {\n  return elt.name === 'LinearPileupDisplay'\n}\n\nexport default function LinearReadVsRefMenuItemF(pm: PluginManager) {\n  pm.addToExtensionPoint(\n    'Core-extendPluggableElement',\n    (pluggableElement: PluggableElementType) => {\n      if (!isDisplay(pluggableElement)) {\n        return pluggableElement\n      }\n      pluggableElement.stateModel = pluggableElement.stateModel.extend(self => {\n        const superContextMenuItems = self.contextMenuItems\n        return {\n          views: {\n            contextMenuItems() {\n              const feature = self.contextMenuFeature\n              const track = getContainingTrack(self)\n              return [\n                ...superContextMenuItems(),\n                ...(feature\n                  ? [\n                      {\n                        label: 'Linear read vs ref',\n                        icon: AddIcon,\n                        onClick: () => {\n                          getSession(self).queueDialog(handleClose => [\n                            ReadVsRefDialog,\n                            {\n                              track,\n                              feature,\n                              handleClose,\n                            },\n                          ])\n                        },\n                      },\n                    ]\n                  : []),\n              ]\n            },\n          },\n        }\n      })\n      return pluggableElement\n    },\n  )\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\n\nimport CalendarIcon from '@mui/icons-material/CalendarViewDay'\nimport LinearComparativeDisplayF from './LinearComparativeDisplay'\nimport LinearComparativeViewF from './LinearComparativeView'\nimport LinearSyntenyDisplayF from './LinearSyntenyDisplay'\nimport LGVSyntenyDisplayF from './LGVSyntenyDisplay'\nimport LinearSyntenyViewF from './LinearSyntenyView'\nimport LaunchLinearSyntenyViewF from './LaunchLinearSyntenyView'\nimport SyntenyTrackF from './SyntenyTrack'\nimport SyntenyFeatureWidgetF from './SyntenyFeatureDetail'\nimport LinearReadVsRefMenuItemF from './LinearReadVsRef'\n\nexport default class LinearComparativeViewPlugin extends Plugin {\n  name = 'LinearComparativeViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    LinearComparativeViewF(pluginManager)\n    LinearSyntenyViewF(pluginManager)\n    LinearComparativeDisplayF(pluginManager)\n    LinearSyntenyDisplayF(pluginManager)\n    LGVSyntenyDisplayF(pluginManager)\n    LaunchLinearSyntenyViewF(pluginManager)\n    SyntenyTrackF(pluginManager)\n    SyntenyFeatureWidgetF(pluginManager)\n    LinearReadVsRefMenuItemF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear synteny view',\n        icon: CalendarIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearSyntenyView', {})\n        },\n      })\n    }\n  }\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport modelFactory from './model'\n\nexport default function LinearComparativeViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearComparativeView',\n      displayName: 'Linear comparative view',\n      stateModel: modelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearComparativeView')),\n    })\n  })\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport modelFactory from './model'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nexport default function LinearSyntenyViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearSyntenyView',\n      displayName: 'Linear synteny view',\n      stateModel: modelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearSyntenyView')),\n    })\n  })\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport configSchemaFactory from './configSchemaF'\nimport stateModelFactory from './stateModelFactory'\n\nexport default function LinearComparativeDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearComparativeDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearComparativeView',\n      ReactComponent: () => {\n        return null\n      },\n    })\n  })\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport configSchemaF from './configSchemaF'\nimport stateModelFactory from './model'\nimport { lazy } from 'react'\n\nexport default function LinearSyntenyDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearSyntenyDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearSyntenyView',\n      ReactComponent: lazy(() => import('./components/Component')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport baseConfigFactory from '../LinearComparativeDisplay/configSchemaF'\n\n/**\n * #config LinearSyntenyDisplay\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSyntenyDisplay',\n    {\n      /**\n       * #slot\n       * currently unused\n       */\n      trackIds: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n\n      /**\n       * #slot\n       * currently unused\n       */\n      middle: { type: 'boolean', defaultValue: true },\n    },\n    {\n      /**\n       * #baseConfiguration\n       * this refers to the LinearComparativeDisplay\n       */\n      baseConfiguration: baseConfigFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport configSchemaF from './configSchemaF'\nimport stateModelF from './model'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nexport default function LGVSyntenyDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    const stateModel = stateModelF(configSchema)\n    return new DisplayType({\n      name: 'LGVSyntenyDisplay',\n      configSchema,\n      stateModel,\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { linearPileupDisplayConfigSchemaFactory } from '@jbrowse/plugin-alignments'\n\n/**\n * #config LGVSyntenyDisplay\n * extends config\n * - [LinearPileupDisplay](../linearpileupdisplay)\n */\nfunction configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LGVSyntenyDisplay',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearPileupDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default function registerSyntenyTrack(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'SyntenyTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'SyntenyTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config SyntenyTrack\n * extends\n * - [BaseTrack](../basetrack)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'SyntenyTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #stateModel LinearLollipopDisplay\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearLollipopDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearLollipopDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #getter\n         */\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        /**\n         * #getter\n         */\n        get renderDelay() {\n          return 500\n        },\n        /**\n         * #method\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\ninterface LayoutItem {\n  uniqueId: string\n  anchorLocation: number\n  width: number\n  height: number\n  data: { score: number }\n}\n\ntype LayoutEntry = LayoutItem & { x: number; y: number }\n\ntype LayoutMap = Map<string, LayoutEntry>\n\nexport class FloatingLayout {\n  width: number\n\n  totalHeight = 0\n\n  constructor({ width }: { width: number }) {\n    if (!width) {\n      throw new Error('width required to make a new FloatingLayout')\n    }\n    this.width = width\n  }\n\n  items: LayoutItem[] = []\n\n  layout: LayoutMap = new Map()\n\n  layoutDirty = false\n\n  add(\n    uniqueId: string,\n    anchorLocation: number,\n    width: number,\n    height: number,\n    data: { score: number },\n  ) {\n    this.items.push({ uniqueId, anchorLocation, width, height, data })\n    this.layoutDirty = true\n  }\n\n  /**\n   * @returns Map of `uniqueId => {x,y,anchorLocation,width,height,data}`\n   */\n  getLayout(configuration?: AnyConfigurationModel) {\n    if (!this.layoutDirty) {\n      return this.layout\n    }\n    if (!configuration) {\n      throw new Error('configuration object required')\n    }\n\n    const minY = readConfObject(configuration, 'minStickLength')\n\n    // sort them by score ascending, so higher scores will always end up\n    // stacked last (toward the bottom)\n    const sorted = this.items.sort((a, b) => a.data.score - b.data.score)\n\n    // bump them\n    let maxBottom = 0\n    const layoutEntries: [string, LayoutEntry][] = new Array(sorted.length)\n    for (let i = 0; i < sorted.length; i += 1) {\n      const currentItem = sorted[i]\n      const { anchorLocation, width, height } = currentItem\n      const start = anchorLocation - width / 2\n      const end = start + width\n      let top = minY\n      let bottom = top + height\n\n      // figure out how far down to put it\n      for (let j = 0; j < i; j += 1) {\n        const [, previouslyLaidOutItem] = layoutEntries[j]\n        const {\n          x: prevStart,\n          y: prevTop,\n          width: prevWidth,\n          height: prevHeight,\n        } = previouslyLaidOutItem\n        const prevEnd = prevStart + prevWidth\n        const prevBottom = prevTop + prevHeight\n        if (\n          doesIntersect2(prevStart, prevEnd, start, end) &&\n          doesIntersect2(prevTop, prevBottom, top, bottom)\n        ) {\n          // bump this one to the bottom of the previous one\n          top = prevBottom\n          bottom = top + height\n          j = -1 // we need to check all of them again after bumping\n        }\n      }\n\n      // record the entry and update the maxBottom\n      layoutEntries[i] = [\n        currentItem.uniqueId,\n        { ...currentItem, x: start, y: top },\n      ]\n      if (bottom > maxBottom) {\n        maxBottom = bottom\n      }\n    }\n\n    // try to tile them left to right all at the same level\n    // if they don't fit, try to alternate them on 2 levels, then 3\n    this.totalHeight = maxBottom\n    this.layout = new Map(layoutEntries)\n    this.layoutDirty = false\n    return this.layout\n  }\n\n  getTotalHeight() {\n    if (this.layoutDirty) {\n      throw new Error('getTotalHeight does not work when the layout is dirty.')\n    }\n    return this.totalHeight\n  }\n\n  serializeRegion() {\n    return this.toJSON()\n  }\n\n  toJSON() {\n    if (this.layoutDirty) {\n      throw new Error('toJSON does not work when the layout is dirty.')\n    }\n    return { pairs: [...this.getLayout()], totalHeight: this.getTotalHeight() }\n  }\n\n  static fromJSON() {\n    throw new Error('not supported')\n  }\n}\n\nexport class PrecomputedFloatingLayout {\n  layout: LayoutMap\n\n  totalHeight: number\n\n  constructor({\n    pairs,\n    totalHeight,\n  }: {\n    pairs: [string, LayoutEntry][]\n    totalHeight: number\n  }) {\n    this.layout = new Map(pairs)\n    this.totalHeight = totalHeight\n  }\n\n  add(uniqueId: string) {\n    if (!this.layout.has(uniqueId)) {\n      throw new Error(`layout error, precomputed layout is missing ${uniqueId}`)\n    }\n  }\n\n  getLayout() {\n    return this.layout\n  }\n\n  getTotalHeight() {\n    return this.totalHeight\n  }\n\n  static fromJSON(\n    json: ConstructorParameters<typeof PrecomputedFloatingLayout>[0],\n  ) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import BoxRendererType, {\n  LayoutSession,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { FloatingLayout, PrecomputedFloatingLayout } from './Layout'\n\nclass FloatingLayoutSession extends LayoutSession {\n  makeLayout() {\n    'sequenceAdapter'\n\n    const { end, start } = this.regions[0]\n    const widthPx = (end - start) / this.bpPerPx\n    return new MultiLayout(FloatingLayout, { width: widthPx })\n  }\n\n  layoutIsValid(/* layout */) {\n    return false // layout.left layout.width === this.width\n  }\n}\n\nexport default class LollipopRenderer extends BoxRendererType {\n  createSession(args) {\n    return new FloatingLayoutSession(args)\n  }\n\n  deserializeLayoutInClient(json) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LollipopRenderer',\n  {\n    strokeColor: {\n      type: 'color',\n      description: 'the outer color of each lollipop',\n      defaultValue: 'green',\n      contextVariable: ['feature'],\n    },\n    innerColor: {\n      type: 'color',\n      description: 'the inner color of each lollipop',\n      defaultValue: '#7fc75f',\n      contextVariable: ['feature'],\n    },\n    strokeWidth: {\n      type: 'number',\n      description: 'width of the stroked border',\n      defaultValue: 4,\n      contextVariable: ['feature'],\n    },\n    radius: {\n      type: 'number',\n      description: 'radius in pixels of each lollipop body',\n      defaultValue: `jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))`,\n      contextVariable: ['feature'],\n    },\n    caption: {\n      type: 'string',\n      description:\n        'the tooltip caption displayed when the mouse hovers over a lollipop',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n    minStickLength: {\n      type: 'number',\n      description: 'minimum lollipop \"stick\" length, in pixels',\n      defaultValue: 5,\n    },\n    stickColor: {\n      type: 'color',\n      description: 'color of the lollipop stick',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    stickWidth: {\n      type: 'number',\n      description: 'width in pixels of the lollipop stick',\n      defaultValue: 2,\n      contextVariable: ['feature'],\n    },\n    score: {\n      type: 'number',\n      description:\n        'the \"score\" of each lollipop, displayed as a number in the center of the circle',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport LinearLollipopDisplayF from './LinearLollipopDisplay'\nimport LollipopRendererF from './LollipopRenderer'\n\nexport default class LollipopPlugin extends Plugin {\n  name = 'LollipopPlugin'\n\n  install(pluginManager: PluginManager) {\n    LollipopRendererF(pluginManager)\n    LinearLollipopDisplayF(pluginManager)\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { lazy } from 'react'\nimport LollipopRenderer from './LollipopRenderer'\nimport configSchema from './configSchema'\n\nexport default function LollipopRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new LollipopRenderer({\n        name: 'LollipopRenderer',\n        ReactComponent: lazy(() => import('./components/LollipopRendering')),\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport { stateModelFactory } from './model'\nimport { configSchemaFactory } from './configSchema'\n\nexport default function LinearLollipopDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearLollipopDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'LollipopTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #config LinearLollipopDisplay\n */\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearLollipopDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { getEnv } from '@jbrowse/core/util'\n\n/**\n * #stateModel LinearArcDisplay\n * extends\n * - [BaseLinearDisplay](../baselineardisplay)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearArcDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearArcDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        displayMode: types.maybe(types.string),\n      }),\n    )\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get blockType() {\n        return 'staticBlocks'\n      },\n      /**\n       * #getter\n       */\n      get renderDelay() {\n        return 500\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get displayModeSetting() {\n        return self.displayMode ?? getConf(self, ['renderer', 'displayMode'])\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n        const config = configBlob as Omit<typeof configBlob, symbol>\n        return self.rendererType.configSchema.create(\n          {\n            ...config,\n            displayMode: self.displayModeSetting,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.rendererConfig,\n            height: self.height,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setDisplayMode(flag: string) {\n        self.displayMode = flag\n      },\n    }))\n    .views(self => {\n      const superMenuItems = self.trackMenuItems\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superMenuItems(),\n            {\n              label: 'Display mode',\n              subMenu: [\n                {\n                  type: 'radio',\n                  label: 'Arcs',\n                  onClick: () => self.setDisplayMode('arcs'),\n                  checked: self.displayMode === 'arcs',\n                },\n                {\n                  type: 'radio',\n                  label: 'Semi-circles',\n                  onClick: () => self.setDisplayMode('semicircles'),\n                  checked: self.displayMode === 'semicircles',\n                },\n              ],\n            },\n          ]\n        },\n      }\n    })\n}\n","import React from 'react'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { Instance, types } from 'mobx-state-tree'\nimport {\n  Feature,\n  getSession,\n  isSessionModelWithWidgets,\n  getContainingView,\n  getContainingTrack,\n  isSelectionContainer,\n} from '@jbrowse/core/util'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes'\nimport {\n  FeatureDensityMixin,\n  TrackHeightMixin,\n} from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #stateModel LinearPairedArcDisplay\n * this is a non-block-based track type, and can connect arcs across multiple\n * displayedRegions\n *\n * extends\n * - [BaseDisplay](../basedisplay)\n * - [TrackHeightMixin](../trackheightmixin)\n * - [FeatureDensityMixin](../featuredensitymixin)\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearPairedArcDisplay',\n      BaseDisplay,\n      TrackHeightMixin(),\n      FeatureDensityMixin(),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearPairedArcDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        displayMode: types.maybe(types.string),\n      }),\n    )\n    .volatile(() => ({\n      lastDrawnOffsetPx: 0,\n      features: undefined as Feature[] | undefined,\n      loading: false,\n      drawn: true,\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get displayModeSetting() {\n        return self.displayMode ?? getConf(self, ['renderer', 'displayMode'])\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'VariantFeatureWidget',\n            'variantFeature',\n            {\n              view: getContainingView(self),\n              track: getContainingTrack(self),\n              featureData: feature.toJSON(),\n            },\n          )\n\n          session.showWidget(featureWidget)\n        }\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n      /**\n       * #action\n       */\n      setLoading(flag: boolean) {\n        self.loading = flag\n      },\n      /**\n       * #action\n       */\n      setFeatures(f: Feature[]) {\n        self.features = f\n      },\n      /**\n       * #action\n       */\n      setDisplayMode(flag: string) {\n        self.displayMode = flag\n      },\n    }))\n\n    .actions(self => ({\n      afterAttach() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        ;(async () => {\n          try {\n            const { doAfterAttach } = await import('./afterAttach')\n            doAfterAttach(self)\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        })()\n      },\n      /**\n       * #action\n       */\n      async renderSvg(opts: {\n        rasterizeLayers?: boolean\n      }): Promise<React.ReactNode> {\n        const { renderArcSvg } = await import('./renderSvg')\n        // @ts-expect-error\n        return renderArcSvg(self, opts)\n      },\n    }))\n}\n\nexport type LinearArcDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearArcDisplayModel = Instance<LinearArcDisplayStateModel>\n","import React, { useState } from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { Feature, Region, bpSpanPx, getStrokeProps } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\n// locals\nimport ArcTooltip from '../ArcTooltip'\n\nfunction Arc({\n  selectedFeatureId,\n  region,\n  bpPerPx,\n  config,\n  onFeatureClick,\n  feature,\n}: {\n  selectedFeatureId: string\n  region: Region\n  config: AnyConfigurationModel\n  onFeatureClick: (event: React.MouseEvent, featureId: string) => void\n  bpPerPx: number\n  feature: Feature\n}) {\n  const [isMouseOvered, setIsMouseOvered] = useState(false)\n  const [left, right] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n  const featureId = feature.id()\n  let stroke = readConfObject(config, 'color', { feature })\n  let textStroke = 'black'\n  if (selectedFeatureId && String(selectedFeatureId) === String(feature.id())) {\n    stroke = textStroke = 'red'\n  }\n  const label = readConfObject(config, 'label', { feature })\n  const caption = readConfObject(config, 'caption', { feature })\n  const strokeWidth = readConfObject(config, 'thickness', { feature }) || 1\n  const height = readConfObject(config, 'height', { feature }) || 100\n  const ref = React.createRef<SVGPathElement>()\n\n  // formula: https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B%C3%A9zier_curves\n  const t = 0.5\n  const t1 = 1 - t\n  const textYCoord = 3 * (t1 * t1) * (t * height) + 3 * t1 * (t * t) * height\n\n  return (\n    <g>\n      <path\n        ref={ref}\n        {...getStrokeProps(stroke)}\n        d={`M ${left} 0 C ${left} ${height}, ${right} ${height}, ${right} 0`}\n        strokeWidth={strokeWidth}\n        fill=\"transparent\"\n        onClick={e => onFeatureClick?.(e, featureId)}\n        onMouseOver={() => setIsMouseOvered(true)}\n        onMouseLeave={() => setIsMouseOvered(false)}\n        pointerEvents=\"stroke\"\n      />\n      {isMouseOvered ? <ArcTooltip contents={caption} /> : null}\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke=\"white\"\n        strokeWidth=\"0.6em\"\n      >\n        {label}\n      </text>\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke={textStroke}\n      >\n        {label}\n      </text>\n    </g>\n  )\n}\n\nfunction polarToCartesian(\n  centerX: number,\n  centerY: number,\n  radius: number,\n  angleInDegrees: number,\n) {\n  const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180\n\n  return {\n    x: centerX + radius * Math.cos(angleInRadians),\n    y: centerY + radius * Math.sin(angleInRadians),\n  }\n}\n\nfunction describeArc(\n  x: number,\n  y: number,\n  radius: number,\n  startAngle: number,\n  endAngle: number,\n) {\n  const start = polarToCartesian(x, y, radius, endAngle)\n  const end = polarToCartesian(x, y, radius, startAngle)\n\n  const largeArcFlag = endAngle - startAngle <= 180 ? '0' : '1'\n\n  return [\n    'M',\n    start.x,\n    start.y,\n    'A',\n    radius,\n    radius,\n    0,\n    largeArcFlag,\n    0,\n    end.x,\n    end.y,\n  ].join(' ')\n}\n\nfunction SemiCircles({\n  selectedFeatureId,\n  region,\n  bpPerPx,\n  config,\n  onFeatureClick,\n  feature,\n}: {\n  selectedFeatureId: string\n  region: Region\n  config: AnyConfigurationModel\n  onFeatureClick: (event: React.MouseEvent, featureId: string) => void\n  bpPerPx: number\n  feature: Feature\n}) {\n  const [isMouseOvered, setIsMouseOvered] = useState(false)\n  const [left, right] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n\n  const featureId = feature.id()\n  let stroke = readConfObject(config, 'color', { feature })\n  let textStroke = 'black'\n  if (selectedFeatureId && String(selectedFeatureId) === String(feature.id())) {\n    stroke = textStroke = 'red'\n  }\n  const label = readConfObject(config, 'label', { feature })\n  const caption = readConfObject(config, 'caption', { feature })\n  const strokeWidth = readConfObject(config, 'thickness', { feature }) || 1\n  const ref = React.createRef<SVGPathElement>()\n  const textYCoord = (right - left) / 2\n\n  return (\n    <g>\n      <path\n        d={describeArc(\n          left + (right - left) / 2,\n          0,\n          (right - left) / 2,\n          90,\n          270,\n        )}\n        {...getStrokeProps(stroke)}\n        strokeWidth={strokeWidth}\n        fill=\"transparent\"\n        onClick={e => onFeatureClick?.(e, featureId)}\n        onMouseOver={() => setIsMouseOvered(true)}\n        onMouseLeave={() => setIsMouseOvered(false)}\n        ref={ref}\n        pointerEvents=\"stroke\"\n      />\n      {isMouseOvered ? <ArcTooltip contents={caption} /> : null}\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke=\"white\"\n        strokeWidth=\"0.6em\"\n      >\n        {label}\n      </text>\n      <text\n        x={left + (right - left) / 2}\n        y={textYCoord + 3}\n        stroke={textStroke}\n      >\n        {label}\n      </text>\n    </g>\n  )\n}\nconst ArcRendering = observer(function ({\n  features,\n  config,\n  regions,\n  bpPerPx,\n  height,\n  exportSVG,\n  onFeatureClick,\n  displayModel: { selectedFeatureId },\n}: {\n  features: Map<string, Feature>\n  config: AnyConfigurationModel\n  regions: Region[]\n  bpPerPx: number\n  height: number\n  displayModel: { selectedFeatureId: string }\n  onFeatureClick: (event: React.MouseEvent, featureId: string) => void\n  exportSVG: boolean\n}) {\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n  const semicircles = readConfObject(config, 'displayMode') === 'semicircles'\n\n  return (\n    <Wrapper exportSVG={exportSVG} width={width} height={height}>\n      {[...features.values()].map(f =>\n        semicircles ? (\n          <SemiCircles\n            key={f.id()}\n            config={config}\n            region={region}\n            bpPerPx={bpPerPx}\n            selectedFeatureId={selectedFeatureId}\n            onFeatureClick={onFeatureClick}\n            feature={f}\n          />\n        ) : (\n          <Arc\n            key={f.id()}\n            config={config}\n            region={region}\n            bpPerPx={bpPerPx}\n            selectedFeatureId={selectedFeatureId}\n            onFeatureClick={onFeatureClick}\n            feature={f}\n          />\n        ),\n      )}\n    </Wrapper>\n  )\n})\n\nfunction Wrapper({\n  exportSVG,\n  width,\n  height,\n  children,\n}: {\n  exportSVG: boolean\n  width: number\n  height: number\n  children: React.ReactNode\n}) {\n  return exportSVG ? (\n    children\n  ) : (\n    <svg width={width} height={height}>\n      {children}\n    </svg>\n  )\n}\n\nexport default ArcRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config ArcRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ArcRenderer = ConfigurationSchema(\n  'ArcRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of the arcs',\n      defaultValue: 'darkblue',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    thickness: {\n      type: 'number',\n      description: 'the thickness of the arcs',\n      defaultValue: `jexl:logThickness(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    label: {\n      type: 'string',\n      description: 'the label to appear at the apex of the arcs',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'the height of the arcs',\n      defaultValue: `jexl:log10(get(feature,'end')-get(feature,'start'))*50`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    caption: {\n      type: 'string',\n      description:\n        'the caption to appear when hovering over any point on the arcs',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'enum',\n      defaultValue: 'arcs',\n      model: types.enumeration('DisplayMode', ['arcs', 'semicircles']),\n      description: 'render semi-circles instead of arcs',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default ArcRenderer\n","import FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\n\nexport default class ArcRenderer extends FeatureRendererType {}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport LinearArcDisplayF from './LinearArcDisplay'\nimport LinearPairedArcDisplayF from './LinearPairedArcDisplay'\nimport ArcRendererF from './ArcRenderer'\nimport { Feature } from '@jbrowse/core/util'\nimport { set1 } from '@jbrowse/core/ui/colors'\n\nexport default class ArcPlugin extends Plugin {\n  name = 'ArcRenderer'\n  install(pluginManager: PluginManager) {\n    ArcRendererF(pluginManager)\n    LinearArcDisplayF(pluginManager)\n    LinearPairedArcDisplayF(pluginManager)\n\n    pluginManager.jexl.addFunction(\n      'logThickness',\n      (feature: Feature, attributeName: string) =>\n        Math.log(feature.get(attributeName) + 1),\n    )\n    pluginManager.jexl.addFunction(\n      'defaultPairedArcColor',\n      (_feature: Feature, alt: string) => {\n        if (alt?.startsWith('<DEL')) {\n          return set1[0]\n        } else if (alt?.startsWith('<DUP')) {\n          return set1[1]\n        } else if (alt?.startsWith('<INV')) {\n          return set1[2]\n        } else if (alt?.startsWith('<TRA')) {\n          return set1[3]\n        } else if (alt?.startsWith('<CNV')) {\n          return set1[4]\n        } else {\n          return set1[6] // skip 5, yellow\n        }\n      },\n    )\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from './ArcRendering'\nimport configSchema from './configSchema'\nimport ArcRenderer from './ArcRenderer'\n\nexport default function ArcRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new ArcRenderer({\n        name: 'ArcRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport { configSchemaFactory } from './configSchema'\nimport { stateModelFactory } from './model'\n\nexport default function LinearArcDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearArcDisplay',\n      displayName: 'Arc display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'FeatureTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #config LinearArcDisplay\n */\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearArcDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'ArcRenderer' },\n      ),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { DisplayType } from '@jbrowse/core/pluggableElementTypes'\n\nimport { configSchemaFactory } from './configSchema'\nimport { stateModelFactory } from './model'\nimport { lazy } from 'react'\n\nexport default function LinearPairedArcDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory()\n    return new DisplayType({\n      name: 'LinearPairedArcDisplay',\n      displayName: 'Arc display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'VariantTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: lazy(() => import('./components/ReactComponent')),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #config LinearPairedArcDisplay\n */\nexport function configSchemaFactory() {\n  return ConfigurationSchema(\n    'LinearPairedArcDisplay',\n    {\n      /**\n       * #slot\n       */\n      color: {\n        type: 'color',\n        description: 'the color of the arcs',\n        defaultValue: 'jexl:defaultPairedArcColor(feature,alt)',\n        contextVariable: ['feature', 'alt'],\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('AboutWidget', {})\n\nexport const stateModel = types.model('AboutWidget', {\n  id: ElementId,\n  type: types.literal('AboutWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('HelpWidget', {})\n\nexport const stateModel = types.model('HelpWidget', {\n  id: ElementId,\n  type: types.literal('HelpWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('ImportSessionWidget', {})\n\nexport const stateModel = types.model('ImportSessionWidget', {\n  id: ElementId,\n  type: types.literal('ImportSessionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('SessionManager', {})\n\nexport const stateModel = types.model('SessionManager', {\n  id: ElementId,\n  type: types.literal('SessionManager'),\n})\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SessionWithWidgets, isAbstractMenuManager } from '@jbrowse/core/util'\n\nimport HelpIcon from '@mui/icons-material/Help'\nimport InfoIcon from '@mui/icons-material/Info'\n\nimport {\n  configSchema as aboutConfigSchema,\n  stateModel as aboutStateModel,\n} from './AboutWidget'\nimport {\n  configSchema as helpConfigSchema,\n  stateModel as helpStateModel,\n} from './HelpWidget'\nimport {\n  configSchema as importSessionConfigSchema,\n  stateModel as importSessionStateModel,\n} from './ImportSessionWidget'\nimport {\n  configSchema as sessionManagerConfigSchema,\n  stateModel as sessionManagerStateModel,\n} from './SessionManager'\n\nexport default class MenusPlugin extends Plugin {\n  name = 'MenusPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AboutWidget',\n        heading: 'About',\n        configSchema: aboutConfigSchema,\n        stateModel: aboutStateModel,\n        ReactComponent: lazy(\n          () => import('./AboutWidget/components/AboutWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HelpWidget',\n        heading: 'Help',\n        configSchema: helpConfigSchema,\n        stateModel: helpStateModel,\n        ReactComponent: lazy(\n          () => import('./HelpWidget/components/HelpWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ImportSessionWidget',\n        heading: 'Import session',\n        configSchema: importSessionConfigSchema,\n        stateModel: importSessionStateModel,\n        ReactComponent: lazy(\n          () => import('./ImportSessionWidget/components/ImportSessionWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'SessionManager',\n        heading: 'Sessions',\n        configSchema: sessionManagerConfigSchema,\n        stateModel: sessionManagerStateModel,\n        ReactComponent: lazy(\n          () => import('./SessionManager/components/SessionManager'),\n        ),\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'About',\n        icon: InfoIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('AboutWidget', 'aboutWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'Help',\n        icon: HelpIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('HelpWidget', 'helpWidget')\n          session.showWidget(widget)\n        },\n      })\n    }\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport format from 'string-template'\n\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\ninterface SPARQLEntry {\n  type: string\n  value: string\n  dataTypes?: string\n}\n\ntype SPARQLBinding = Record<string, SPARQLEntry>\n\ninterface SPARQLResponseHead {\n  vars: string[]\n}\n\ninterface SPARQLResponseResults {\n  bindings: SPARQLBinding[]\n}\n\ninterface SPARQLResponse {\n  head: SPARQLResponseHead\n  results: SPARQLResponseResults\n}\n\ninterface SPARQLFeatureData {\n  start: number\n  end: number\n  strand: number\n  refName: string\n  subfeatures?: SPARQLFeatureData[]\n  uniqueId: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [propName: string]: any\n}\n\ninterface SPARQLFeature {\n  data: SPARQLFeatureData\n}\n\nexport default class SPARQLAdapter extends BaseFeatureDataAdapter {\n  private endpoint: string\n\n  private queryTemplate: string\n\n  private refNamesQueryTemplate: string\n\n  private additionalQueryParams: string[]\n\n  private configRefNames: string[]\n\n  private refNames: string[] | undefined\n\n  public constructor(\n    config: Instance<typeof MyConfigSchema>,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    this.endpoint = readConfObject(config, 'endpoint').uri\n    this.queryTemplate = readConfObject(config, 'queryTemplate')\n    this.additionalQueryParams = readConfObject(config, 'additionalQueryParams')\n    this.refNamesQueryTemplate = readConfObject(config, 'refNamesQueryTemplate')\n    this.configRefNames = readConfObject(config, 'refNames')\n  }\n\n  public async getRefNames(opts: BaseOptions = {}): Promise<string[]> {\n    if (this.refNames) {\n      return this.refNames\n    }\n    let refNames = [] as string[]\n    if (this.refNamesQueryTemplate) {\n      const queryTemplate = encodeURIComponent(this.refNamesQueryTemplate)\n      const results = await this.querySparql(queryTemplate, opts)\n      refNames = this.resultsToRefNames(results)\n    } else if (this.configRefNames) {\n      refNames = this.configRefNames\n    }\n    this.refNames = refNames\n    return refNames\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const filledTemplate = encodeURIComponent(\n        format(this.queryTemplate, query),\n      )\n      const { refName } = query\n      const results = await this.querySparql(filledTemplate, opts)\n      this.resultsToFeatures(results, refName).forEach(feature => {\n        observer.next(feature)\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async querySparql(query: string, opts?: BaseOptions): Promise<any> {\n    let additionalQueryParams = ''\n    if (this.additionalQueryParams.length) {\n      additionalQueryParams = `&${this.additionalQueryParams.join('&')}`\n    }\n    const signal = opts?.signal\n    const response = await fetch(\n      `${this.endpoint}?query=${query}${additionalQueryParams}`,\n      {\n        headers: { accept: 'application/json,application/sparql-results+json' },\n        signal,\n      },\n    )\n    return response.json()\n  }\n\n  private resultsToRefNames(response: SPARQLResponse): string[] {\n    const rows = response?.results?.bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = response.head.vars\n    if (!fields.includes('refName')) {\n      throw new Error('\"refName\" not found in refNamesQueryTemplate response')\n    }\n    return rows.map(row => row.refName.value)\n  }\n\n  private resultsToFeatures(\n    results: SPARQLResponse,\n    refName: string,\n  ): SimpleFeature[] {\n    const rows = results?.results?.bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = results.head.vars\n    const requiredFields = ['start', 'end', 'uniqueId']\n    requiredFields.forEach(requiredField => {\n      if (!fields.includes(requiredField)) {\n        console.error(\n          `Required field ${requiredField} missing from feature data`,\n        )\n      }\n    })\n    const seenFeatures: Record<string, SPARQLFeature> = {}\n    rows.forEach(row => {\n      const rawData: Record<string, string>[] = [{}]\n      fields.forEach(field => {\n        if (field in row) {\n          const { value } = row[field]\n          let idx = 0\n          while (field.startsWith('sub_')) {\n            field = field.slice(4)\n            idx += 1\n          }\n          while (idx > rawData.length - 1) {\n            rawData.push({})\n          }\n          rawData[idx][field] = value\n        }\n      })\n\n      rawData.forEach((rd, idx) => {\n        const { uniqueId } = rd\n        if (idx < rawData.length - 1) {\n          rawData[idx + 1].parentUniqueId = uniqueId\n        }\n        seenFeatures[uniqueId] = {\n          data: {\n            ...rd,\n            uniqueId,\n            refName,\n            start: parseInt(rd.start, 10),\n            end: parseInt(rd.end, 10),\n            strand: parseInt(rd.strand, 10) || 0,\n          },\n        }\n      })\n    })\n\n    // resolve subfeatures, keeping only top-level features in seenFeatures\n    for (const [uniqueId, f] of Object.entries(seenFeatures)) {\n      const pid = f.data.parentUniqueId\n      delete f.data.parentUniqueId\n      if (pid) {\n        const p = seenFeatures[pid]\n        if (p) {\n          if (!p.data.subfeatures) {\n            p.data.subfeatures = []\n          }\n          p.data.subfeatures.push({\n            ...f.data,\n            uniqueId,\n          })\n          delete seenFeatures[uniqueId]\n        } else {\n          const subfeatures = Object.values(seenFeatures)\n            .map(sf => sf.data.subfeatures)\n            .filter(sf => !!sf)\n            .flat()\n          let found = false\n          for (const subfeature of subfeatures) {\n            if (subfeature && subfeature.uniqueId === pid) {\n              if (!subfeature.subfeatures) {\n                subfeature.subfeatures = []\n              }\n              subfeature.subfeatures.push({\n                ...f.data,\n                uniqueId,\n              })\n              delete seenFeatures[uniqueId]\n              found = true\n              break\n            } else if (subfeature?.subfeatures) {\n              subfeatures.push(...subfeature.subfeatures)\n            }\n          }\n          if (!found) {\n            console.error(`Could not find parentID ${pid}`)\n          }\n        }\n      }\n    }\n\n    return Object.keys(seenFeatures).map(\n      seenFeature =>\n        new SimpleFeature({\n          ...seenFeatures[seenFeature].data,\n          uniqueId: seenFeature,\n          subfeatures: seenFeatures[seenFeature].data.subfeatures,\n        }),\n    )\n  }\n\n  public async hasDataForRefName(\n    refName: string,\n    opts: BaseOptions = {},\n  ): Promise<boolean> {\n    const refNames = await this.getRefNames(opts)\n    if (refNames.length && !refNames.includes(refName)) {\n      return false\n    }\n    return true\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SPARQLAdapter',\n  {\n    endpoint: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'https://somesite.com/sparql',\n        locationType: 'UriLocation',\n      },\n      description: 'URL of the SPARQL endpoint',\n    },\n    queryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query where {start} {end} and {refName} will get replaced for each call',\n    },\n    refNamesQueryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query that returns the possible refNames in a ?refName column',\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Possible refNames used by the SPARQL endpoint (ignored if \"refNamesQueryTemplate\" is provided)',\n    },\n    additionalQueryParams: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Additional parameters to add to the query, e.g. \"format=JSON\"',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  AdapterClass as SPARQLAdapterClass,\n  configSchema as sparqlAdapterConfigSchema,\n} from './SPARQLAdapter'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nexport default class RdfPlugin extends Plugin {\n  name = 'RdfPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SPARQLAdapter',\n          displayName: 'SPARQL adapter',\n          configSchema: sparqlAdapterConfigSchema,\n          AdapterClass: SPARQLAdapterClass,\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\/sparql$/i\n          const adapterName = 'SPARQLAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              endpoint: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config TwoBitAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst TwoBitAdapter = ConfigurationSchema(\n  'TwoBitAdapter',\n  {\n    /**\n     * #slot\n     */\n    twoBitLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.2bit', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/default.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n      description:\n        'An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default TwoBitAdapter\n","import React from 'react'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport {\n  Feature,\n  Region,\n  bpSpanPx,\n  revcom,\n  complement,\n  defaultStarts,\n  defaultStops,\n  defaultCodonTable,\n  generateCodonTable,\n  Frame,\n} from '@jbrowse/core/util'\nimport { Theme } from '@mui/material'\n\nfunction Translation({\n  codonTable,\n  seq,\n  frame,\n  bpPerPx,\n  colorByCDS,\n  region,\n  seqStart,\n  height,\n  y,\n  reverse = false,\n  theme,\n}: {\n  codonTable: Record<string, string>\n  seq: string\n  frame: Frame\n  colorByCDS: boolean\n  bpPerPx: number\n  region: Region\n  seqStart: number\n  reverse?: boolean\n  height: number\n  y: number\n  theme?: Theme\n}) {\n  const normalizedFrame = Math.abs(frame) - 1\n  const seqFrame = seqStart % 3\n  const frameShift = (normalizedFrame - seqFrame + 3) % 3\n\n  const frameShiftAdjustedSeqLength = seq.length - frameShift\n  const multipleOfThreeLength =\n    frameShiftAdjustedSeqLength - (frameShiftAdjustedSeqLength % 3)\n  const seqSliced = seq.slice(frameShift, frameShift + multipleOfThreeLength)\n\n  const translated: { letter: string; codon: string }[] = []\n  for (let i = 0; i < seqSliced.length; i += 3) {\n    const codon = seqSliced.slice(i, i + 3)\n    const normalizedCodon = reverse ? revcom(codon) : codon\n    const aminoAcid = codonTable[normalizedCodon] || ''\n    translated.push({\n      letter: aminoAcid,\n      codon: normalizedCodon.toUpperCase(),\n    })\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const codonWidth = (1 / bpPerPx) * 3\n  const renderLetter = 1 / bpPerPx >= 12\n  const frameOffset = frameShift / bpPerPx\n  const startOffset = (region.start - seqStart) / bpPerPx\n  const offset = frameOffset - startOffset\n  const defaultFill = colorByCDS\n    ? theme?.palette.framesCDS.at(frame)?.main\n    : theme?.palette.frames.at(frame)?.main\n  return (\n    <>\n      <rect x={0} y={y} width={width} height={height} fill={defaultFill} />\n      {translated.map((element, index) => {\n        const x = region.reversed\n          ? width - (index + 1) * codonWidth - offset\n          : codonWidth * index + offset\n        const { letter, codon } = element\n        const codonFill = defaultStarts.includes(codon)\n          ? theme?.palette.startCodon\n          : defaultStops.includes(codon)\n            ? theme?.palette.stopCodon\n            : undefined\n        if (!(renderLetter || codonFill)) {\n          return null\n        }\n        return (\n          <React.Fragment key={`${index}-${letter}`}>\n            <rect\n              x={x}\n              y={y}\n              width={\n                renderLetter\n                  ? codonWidth\n                  : codonWidth + 0.7 /* small fudge factor when zoomed out*/\n              }\n              height={height}\n              stroke={renderLetter ? '#555' : 'none'}\n              fill={codonFill || 'none'}\n            />\n            {renderLetter ? (\n              <text\n                x={x + codonWidth / 2}\n                fontSize={height - 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction DNA(props: {\n  seq: string\n  theme: Theme\n  bpPerPx: number\n  height: number\n  region: Region\n  feature: Feature\n  y: number\n}) {\n  const { bpPerPx, region, feature, theme, height, seq, y } = props\n  const render = 1 / bpPerPx >= 12\n\n  const [leftPx, rightPx] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n  const reverse = region.reversed\n  const len = feature.get('end') - feature.get('start')\n  const w = Math.max((rightPx - leftPx) / len, 0.8)\n\n  return (\n    <>\n      {seq.split('').map((letter, index) => {\n        // @ts-expect-error\n        const color = theme.palette.bases[letter.toUpperCase()]\n        const x = reverse ? rightPx - (index + 1) * w : leftPx + index * w\n        return (\n          <React.Fragment key={index}>\n            <rect\n              x={x}\n              y={y}\n              width={w}\n              height={height}\n              fill={color ? color.main : '#aaa'}\n              stroke={render ? '#555' : 'none'}\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n                fontSize={height - 2}\n                fill={\n                  color ? theme.palette.getContrastText(color.main) : 'black'\n                }\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction SequenceSVG({\n  regions,\n  theme: configTheme,\n  colorByCDS,\n  features = new Map(),\n  showReverse = true,\n  showForward = true,\n  showTranslation = true,\n  bpPerPx,\n  rowHeight,\n}: {\n  regions: Region[]\n  theme?: Theme\n  features: Map<string, Feature>\n  colorByCDS: boolean\n  showReverse?: boolean\n  showForward?: boolean\n  showTranslation?: boolean\n  bpPerPx: number\n  rowHeight: number\n}) {\n  const [region] = regions\n  const theme = createJBrowseTheme(configTheme)\n  const codonTable = generateCodonTable(defaultCodonTable)\n  const [feature] = [...features.values()]\n  if (!feature) {\n    return null\n  }\n  const seq: string = feature.get('seq')\n  if (!seq) {\n    return null\n  }\n\n  // incrementer for the y-position of the current sequence being rendered\n  // (applies to both translation rows and dna rows)\n  let currY = -rowHeight\n\n  const showDNA = bpPerPx <= 1\n\n  const forwardFrames: Frame[] = showTranslation && showForward ? [3, 2, 1] : []\n  const reverseFrames: Frame[] =\n    showTranslation && showReverse ? [-1, -2, -3] : []\n\n  // if region.reversed, the forward translation is on bottom, reverse on top\n  const [topFrames, bottomFrames] = region.reversed\n    ? [reverseFrames.toReversed(), forwardFrames.toReversed()]\n    : [forwardFrames, reverseFrames]\n  return (\n    <>\n      {topFrames.map(index => (\n        <Translation\n          key={`translation-${index}`}\n          colorByCDS={colorByCDS}\n          seq={seq}\n          y={(currY += rowHeight)}\n          codonTable={codonTable}\n          frame={index}\n          bpPerPx={bpPerPx}\n          region={region}\n          seqStart={feature.get('start')}\n          theme={theme}\n          height={rowHeight}\n          reverse={region.reversed}\n        />\n      ))}\n\n      {showForward && showDNA ? (\n        <DNA\n          height={rowHeight}\n          y={(currY += rowHeight)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? complement(seq) : seq}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {showReverse && showDNA ? (\n        <DNA\n          height={rowHeight}\n          y={(currY += rowHeight)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? seq : complement(seq)}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {bottomFrames.map(index => (\n        <Translation\n          key={`rev-translation-${index}`}\n          colorByCDS={colorByCDS}\n          seq={seq}\n          y={(currY += rowHeight)}\n          codonTable={codonTable}\n          frame={index}\n          bpPerPx={bpPerPx}\n          region={region}\n          seqStart={feature.get('start')}\n          theme={theme}\n          height={rowHeight}\n          reverse={!region.reversed}\n        />\n      ))}\n    </>\n  )\n}\n\nfunction Wrapper({\n  exportSVG,\n  width,\n  totalHeight,\n  children,\n}: {\n  exportSVG?: { rasterizeLayers: boolean }\n  width: number\n  totalHeight: number\n  children: React.ReactNode\n}) {\n  return exportSVG ? (\n    children\n  ) : (\n    <svg\n      data-testid=\"sequence_track\"\n      width={width}\n      height={totalHeight}\n      style={{\n        // use block because svg by default is inline, which adds a margin\n        display: 'block',\n        width,\n        height: totalHeight,\n        userSelect: 'none',\n      }}\n    >\n      {children}\n    </svg>\n  )\n}\n\nconst DivSequenceRendering = observer(function (props: {\n  exportSVG?: { rasterizeLayers: boolean }\n  features: Map<string, Feature>\n  regions: Region[]\n  colorByCDS: boolean\n  bpPerPx: number\n  rowHeight: number\n  sequenceHeight: number\n  config: AnyConfigurationModel\n  theme?: Theme\n  showForward?: boolean\n  showReverse?: boolean\n  showTranslation?: boolean\n}) {\n  const { regions, bpPerPx, sequenceHeight } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n\n  return (\n    <Wrapper {...props} totalHeight={sequenceHeight} width={width}>\n      <SequenceSVG {...props} />\n    </Wrapper>\n  )\n})\n\nexport default DivSequenceRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config DivSequenceRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DivSequenceRenderer = ConfigurationSchema(\n  'DivSequenceRenderer',\n  {\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'height in pixels of each line of sequence',\n      defaultValue: 16,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default DivSequenceRenderer\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport ReactComponent from './components/DivSequenceRendering'\nimport configSchema from './configSchema'\n\n/* adjust in both directions */\nclass DivSequenceRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  getExpandedRegion(region: Region) {\n    return {\n      ...region,\n      start: Math.max(region.start - 3, 0),\n      end: region.end + 3,\n    }\n  }\n}\n\nexport default function DivSequenceRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new DivSequenceRenderer({\n        name: 'DivSequenceRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config BgzipFastaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BgzipFastaAdapter = ConfigurationSchema(\n  'BgzipFastaAdapter',\n  {\n    /**\n     * #slot\n     */\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.fai',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    gziLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.gzi',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BgzipFastaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config ChromSizesAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ChromSizesAdapter = ConfigurationSchema(\n  'ChromSizesAdapter',\n  {\n    /**\n     * #slot\n     */\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/species.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default ChromSizesAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config IndexedFastaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst IndexedFastaAdapter = ConfigurationSchema(\n  'IndexedFastaAdapter',\n  {\n    /**\n     * #slot\n     */\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.fai', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default IndexedFastaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SequenceSearchAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'SequenceSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    search: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Search string or regex to search for',\n    },\n    /**\n     * #slot\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      defaultValue: null,\n    },\n    /**\n     * #slot\n     */\n    searchForward: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    searchReverse: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    caseInsensitive: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { default as divSequenceRendererConfigSchema } from '../DivSequenceRenderer/configSchema'\n\n/**\n * #config LinearReferenceSequenceDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const configSchema = ConfigurationSchema(\n  'LinearReferenceSequenceDisplay',\n  {\n    /**\n     * #slot\n     */\n    renderer: divSequenceRendererConfigSchema,\n  },\n  { explicitIdentifier: 'displayId', explicitlyTyped: true },\n)\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport TwoBitAdapterF from './TwoBitAdapter'\nimport DivSequenceRendererF from './DivSequenceRenderer'\nimport BgzipFastaAdapterF from './BgzipFastaAdapter'\nimport ChromSizesAdapterF from './ChromSizesAdapter'\nimport IndexedFastaAdapterF from './IndexedFastaAdapter'\nimport SequenceSearchAdapterF from './SequenceSearchAdapter'\nimport ReferenceSequenceTrackF from './ReferenceSequenceTrack'\nimport LinearReferenceSequenceDisplayF from './LinearReferenceSequenceDisplay'\nimport createExtensionPoints from './createExtensionPoints'\n\nexport default class SequencePlugin extends Plugin {\n  name = 'SequencePlugin'\n\n  install(pluginManager: PluginManager) {\n    DivSequenceRendererF(pluginManager)\n    TwoBitAdapterF(pluginManager)\n    BgzipFastaAdapterF(pluginManager)\n    ChromSizesAdapterF(pluginManager)\n    IndexedFastaAdapterF(pluginManager)\n    SequenceSearchAdapterF(pluginManager)\n    ReferenceSequenceTrackF(pluginManager)\n    LinearReferenceSequenceDisplayF(pluginManager)\n    createExtensionPoints(pluginManager)\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function TwoBitAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'TwoBitAdapter',\n        displayName: 'TwoBit adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () => import('./TwoBitAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function BgzipFastaAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BgzipFastaAdapter',\n        displayName: 'Bgzip-indexed FASTA adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./BgzipFastaAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function ChromSizesAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'ChromSizesAdapter',\n        displayName: 'Chrom sizes adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./ChromSizesAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function IndexedFastaAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'IndexedFastaAdapter',\n        displayName: 'Indexed FASTA adapter',\n        configSchema,\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        getAdapterClass: () =>\n          import('./IndexedFastaAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default function SequenceSearchAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'SequenceSearchAdapter',\n        displayName: 'Sequence search adapter',\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        configSchema,\n        getAdapterClass: () =>\n          import('./SequenceSearchAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { createReferenceSeqTrackConfig } from './configSchema'\n\nexport default function ReferenceSequenceTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = createReferenceSeqTrackConfig(pluginManager)\n\n    return new TrackType({\n      name: 'ReferenceSequenceTrack',\n      displayName: 'Reference sequence track',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'ReferenceSequenceTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// Note: this is primarily a copy of createBaseTrackConfig, except with a\n// subset of the config slots, to avoid including fields that don't make sense\n// for the ReferenceSequenceTrack\n\n/**\n * #config ReferenceSequenceTrack\n * used to display base level DNA sequence tracks\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport function createReferenceSeqTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ReferenceSequenceTrack',\n    {\n      /**\n       * #slot\n       * configuration for track adapter\n       */\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n\n      /**\n       * #slot\n       * configuration for the displays e.g. LinearReferenceSequenceDisplay\n       */\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n\n      /**\n       * #slot\n       */\n      name: {\n        type: 'string',\n        description:\n          'optional track name, otherwise uses the \"Reference sequence (assemblyName)\"',\n        defaultValue: '',\n      },\n\n      /**\n       * #slot\n       */\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n\n      formatAbout: ConfigurationSchema('FormatAbout', {\n        /**\n         * #slot formatAbout.config\n         */\n        config: {\n          type: 'frozen',\n          description: 'formats configuration in about dialog',\n          defaultValue: {},\n          contextVariable: ['config'],\n        },\n\n        /**\n         * #slot formatAbout.hideUris\n         */\n        hideUris: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n      }),\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      /**\n       * #identifier\n       * all tracks have a globally unique 'trackId'\n       */\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport { configSchema } from './configSchema'\nimport { modelFactory } from './model'\n\nexport default function LinearReferenceSequenceDisplayF(\n  pluginManager: PluginManager,\n) {\n  pluginManager.addDisplayType(() => {\n    const stateModel = modelFactory(configSchema)\n    return new DisplayType({\n      name: 'LinearReferenceSequenceDisplay',\n      configSchema,\n      stateModel,\n      displayName: 'Reference sequence display',\n      trackType: 'ReferenceSequenceTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { addDisposer, types } from 'mobx-state-tree'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearReferenceSequenceDisplay\n * base model `BaseLinearDisplay`\n */\nexport function modelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReferenceSequenceDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearReferenceSequenceDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        showForward: true,\n        /**\n         * #property\n         */\n        showReverse: true,\n        /**\n         * #property\n         */\n        showTranslation: true,\n      }),\n    )\n    .volatile(() => ({\n      /**\n       * #property\n       */\n      rowHeight: 15,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get sequenceHeight() {\n        const { showTranslation, showReverse, showForward } = self\n        const r1 = showReverse && showTranslation ? self.rowHeight * 3 : 0\n        const r2 = showForward && showTranslation ? self.rowHeight * 3 : 0\n        const t = r1 + r2\n        const r = showReverse ? self.rowHeight : 0\n        const s = showForward ? self.rowHeight : 0\n        return t + r + s\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const {\n            showForward,\n            rpcDriverName,\n            showReverse,\n            showTranslation,\n            rowHeight,\n            sequenceHeight,\n          } = self\n          return {\n            ...superRenderProps(),\n            ...getParentRenderProps(self),\n            config: self.configuration.renderer,\n            rpcDriverName,\n            showForward,\n            showReverse,\n            showTranslation,\n            rowHeight,\n            sequenceHeight,\n          }\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #method\n       */\n      regionCannotBeRendered(/* region */) {\n        const view = getContainingView(self) as LGV\n        return view?.bpPerPx > 3 ? 'Zoom in to see sequence' : undefined\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      toggleShowForward() {\n        self.showForward = !self.showForward\n      },\n      /**\n       * #action\n       */\n      toggleShowReverse() {\n        self.showReverse = !self.showReverse\n      },\n      /**\n       * #action\n       */\n      toggleShowTranslation() {\n        self.showTranslation = !self.showTranslation\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const view = getContainingView(self) as LGV\n            if (view?.bpPerPx > 3) {\n              self.setHeight(50)\n            } else {\n              self.setHeight(self.sequenceHeight)\n            }\n          }),\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      trackMenuItems() {\n        return [\n          {\n            label: 'Show forward',\n            type: 'checkbox',\n            checked: self.showForward,\n            onClick: () => self.toggleShowForward(),\n          },\n          {\n            label: 'Show reverse',\n            type: 'checkbox',\n            checked: self.showReverse,\n            onClick: () => self.toggleShowReverse(),\n          },\n          {\n            label: 'Show translation',\n            type: 'checkbox',\n            checked: self.showTranslation,\n            onClick: () => self.toggleShowTranslation(),\n          },\n        ]\n      },\n    }))\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default function ExtensionPointsF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.2bit$/i\n        const adapterName = 'TwoBitAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          twoBitLocation: file,\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'TwoBitAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.(fa|fasta|fas|fna|mfa)$/i\n        const adapterName = 'IndexedFastaAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          fastaLocation: file,\n          faiLocation: index || makeIndex(file, '.fai'),\n        }\n\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'IndexedFastaAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.(fa|fasta|fas|fna|mfa)\\.b?gz$/i\n        const adapterName = 'BgzipFastaAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          faiLocation: makeIndex(file, '.fai'),\n          gziLocation: makeIndex(file, '.gzi'),\n        }\n\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'BgzipFastaAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n}\n","import React, { useEffect, useState } from 'react'\nimport { useTheme } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport {\n  measureText,\n  getViewParams,\n  Feature,\n  Region,\n  stripAlpha,\n} from '@jbrowse/core/util'\nimport { DisplayModel } from './util'\n\ninterface ViewParams {\n  start: number\n  end: number\n  offsetPx: number\n  offsetPx1: number\n}\n\nconst FeatureLabel = observer(function ({\n  text,\n  x,\n  y,\n  region,\n  reversed,\n  bpPerPx,\n  exportSVG,\n  feature,\n  viewParams,\n  color = 'black',\n  fontHeight = 11,\n  featureWidth = 0,\n  allowedWidthExpansion = 0,\n  displayModel = {},\n}: {\n  text: string\n  x: number\n  y: number\n  color?: string\n  fontHeight?: number\n  featureWidth?: number\n  bpPerPx: number\n  allowedWidthExpansion?: number\n  feature: Feature\n  reversed?: boolean\n  displayModel?: DisplayModel\n  exportSVG?: unknown\n  region: Region\n  viewParams: ViewParams\n}) {\n  const totalWidth = featureWidth + allowedWidthExpansion\n  const measuredTextWidth = measureText(text, fontHeight)\n  const params =\n    isStateTreeNode(displayModel) && isAlive(displayModel) && !exportSVG\n      ? getViewParams(displayModel)\n      : viewParams\n\n  const viewLeft = reversed ? params.end : params.start\n\n  const [labelVisible, setLabelVisible] = useState(exportSVG)\n  const theme = useTheme()\n\n  // we use an effect to set the label visible because there can be a\n  // mismatch between the server and the client after hydration due to the\n  // floating labels. if we are exporting an SVG we allow it as is though and\n  // do not use the effect\n  useEffect(() => {\n    setLabelVisible(true)\n  }, [])\n\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return null\n  }\n\n  const rstart = region.start\n  const rend = region.end\n  const fstart = feature.get('start')\n  const fend = feature.get('end')\n\n  const featureWidthBp = measuredTextWidth * bpPerPx\n\n  // this tricky bit of code helps smooth over block boundaries\n  // not supported for reverse mode currently\n  // reason: reverse mode allocates space for the label in the \"normal\n  // forward orientation\" making it hard to slide. The reverse mode should\n  // allocate the label space in the reverse orientation to slide it\n  if (\n    viewLeft < rend &&\n    viewLeft > rstart &&\n    fstart < viewLeft &&\n    viewLeft + featureWidthBp < fend\n  ) {\n    x = params.offsetPx\n  } else if (\n    fstart < viewLeft &&\n    viewLeft + featureWidthBp < fend &&\n    viewLeft + featureWidthBp > rstart &&\n    viewLeft + featureWidthBp < rend\n  ) {\n    x = params.offsetPx1\n  }\n\n  return labelVisible ? (\n    <text\n      x={x}\n      y={y + fontHeight}\n      fill={color === '#f0f' ? stripAlpha(theme.palette.text.primary) : color}\n      fontSize={fontHeight}\n    >\n      {measuredTextWidth > totalWidth\n        ? `${text.slice(0, totalWidth / (fontHeight * 0.6))}...`\n        : text}\n    </text>\n  ) : null\n})\n\nexport default FeatureLabel\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { Feature, Region } from '@jbrowse/core/util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { observer } from 'mobx-react'\n\n// locals\nimport type { DisplayModel } from './util'\nimport FeatureLabel from './FeatureLabel'\n\nconst FeatureGlyph = observer(function (props: {\n  feature: Feature\n  rootLayout: SceneGraph\n  config: AnyConfigurationModel\n  name: string\n  description: string\n  shouldShowName: boolean\n  shouldShowDescription: boolean\n  colorByCDS: boolean\n  fontHeight: number\n  allowedWidthExpansion: number\n  exportSVG?: unknown\n  displayModel?: DisplayModel\n  selected?: boolean\n  reversed?: boolean\n  topLevel?: boolean\n  region: Region\n  viewParams: {\n    end: number\n    start: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  bpPerPx: number\n}) {\n  const {\n    feature,\n    rootLayout,\n    config,\n    name,\n    description,\n    shouldShowName,\n    shouldShowDescription,\n  } = props\n\n  const featureLayout = rootLayout.getSubRecord(String(feature.id()))\n  if (!featureLayout) {\n    return null\n  }\n  const { GlyphComponent } = featureLayout.data || {}\n\n  return (\n    <g>\n      <GlyphComponent featureLayout={featureLayout} {...props} />\n      {shouldShowName ? (\n        <FeatureLabel\n          text={name}\n          x={rootLayout.getSubRecord('nameLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('nameLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'nameColor'], { feature })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n      {shouldShowDescription ? (\n        <FeatureLabel\n          text={description}\n          x={rootLayout.getSubRecord('descriptionLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('descriptionLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'descriptionColor'], {\n            feature,\n          })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n    </g>\n  )\n})\n\nexport default FeatureGlyph\n","import React, { useEffect, useState } from 'react'\nimport { bpSpanPx, Feature, Region } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\n\ntype LayoutRecord = [number, number, number, number]\n\ninterface OverlayRectProps extends React.SVGProps<SVGRectElement> {\n  rect?: LayoutRecord\n  region: Region\n  bpPerPx: number\n}\n\nfunction OverlayRect({\n  rect,\n  region,\n  bpPerPx,\n  ...rectProps\n}: OverlayRectProps) {\n  if (!rect) {\n    return null\n  }\n  const [leftBp, topPx, rightBp, bottomPx] = rect\n  const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n  const rectTop = Math.round(topPx)\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const rectHeight = Math.round(bottomPx - topPx)\n  const width = rightPx - leftPx\n\n  if (leftPx + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(leftPx, 0)\n  const diff = leftWithinBlock - leftPx\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      x={leftWithinBlock - 2}\n      y={rectTop - 2}\n      width={widthWithinBlock + 4}\n      height={rectHeight + 4}\n      {...rectProps}\n    />\n  )\n}\n\nconst SvgOverlay = observer(function ({\n  displayModel = {},\n  blockKey,\n  region,\n  bpPerPx,\n  movedDuringLastMouseDown,\n  ...handlers\n}: {\n  region: Region\n  displayModel?: {\n    getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n    selectedFeatureId?: string\n    featureIdUnderMouse?: string\n    contextMenuFeature?: Feature\n  }\n  bpPerPx: number\n  blockKey: string\n  movedDuringLastMouseDown?: boolean\n  onFeatureMouseDown?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseEnter?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOut?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOver?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseUp?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseLeave?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseMove?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  // synthesized from mouseup and mousedown\n  onFeatureClick?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureContextMenu?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n}) {\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const mouseoverFeatureId = featureIdUnderMouse || contextMenuFeature?.id()\n  const [renderOverlay, setRenderOverlay] = useState(false)\n  useEffect(() => {\n    setRenderOverlay(true)\n  }, [])\n\n  function onFeatureMouseDown(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseDown: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseEnter(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseEnter: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOut(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOut: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOver(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOver: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseUp(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseUp: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseLeave(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseLeave: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseMove(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseMove: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureClick(event: React.MouseEvent<SVGRectElement, MouseEvent>) {\n    if (movedDuringLastMouseDown) {\n      return undefined\n    }\n    const { onFeatureClick: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureContextMenu(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureContextMenu: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  return renderOverlay ? (\n    <>\n      {mouseoverFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, mouseoverFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          fill=\"#000\"\n          fillOpacity=\"0.2\"\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onContextMenu={onFeatureContextMenu}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n          data-testid={mouseoverFeatureId}\n        />\n      ) : null}\n      {selectedFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, selectedFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          stroke=\"#00b8ff\"\n          fill=\"none\"\n        />\n      ) : null}\n    </>\n  ) : null\n})\n\nexport default SvgOverlay\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\nconst Arrow = observer(function ({\n  feature,\n  featureLayout,\n  config,\n  region,\n}: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n}) {\n  const strand = feature.get('strand')\n  const size = 5\n  const reverseFlip = region.reversed ? -1 : 1\n  const offset = 7 * strand * reverseFlip\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n\n  const c = readConfObject(config, 'color2', { feature })\n  const theme = useTheme()\n  const color2 = c === '#f0f' ? stripAlpha(theme.palette.text.secondary) : c\n  const p =\n    strand * reverseFlip === -1\n      ? left\n      : strand * reverseFlip === 1\n        ? left + width\n        : null\n  const y = top + height / 2\n\n  return p ? (\n    <>\n      <line x1={p} x2={p + offset} y1={y} y2={y} stroke={color2} />\n      <polygon\n        points={[\n          [p + offset / 2, y - size / 2],\n          [p + offset / 2, y + size / 2],\n          [p + offset, y],\n        ].toString()}\n        stroke={color2}\n        fill={color2}\n      />\n    </>\n  ) : null\n})\n\nexport default Arrow\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { Region, Feature, getFrame } from '@jbrowse/core/util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { useTheme } from '@mui/material'\n\n// locals\nimport { isUTR } from './util'\nimport Arrow from './Arrow'\n\nconst utrHeightFraction = 0.65\n\nconst Box = observer(function Box(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  bpPerPx: number\n  selected?: boolean\n  topLevel?: boolean\n  colorByCDS: boolean\n}) {\n  const theme = useTheme()\n  const {\n    colorByCDS,\n    feature,\n    region,\n    config,\n    featureLayout,\n    bpPerPx,\n    topLevel,\n  } = props\n  const { start, end } = region\n  const screenWidth = (end - start) / bpPerPx\n  const featureStart = feature.get('start')\n  const featureEnd = feature.get('end')\n  const featureType: string | undefined = feature.get('type')\n  const featureStrand: -1 | 1 | undefined = feature.get('strand')\n  const featurePhase: 0 | 1 | 2 | undefined = feature.get('phase')\n  const width = (featureEnd - featureStart) / bpPerPx\n  const { left = 0 } = featureLayout.absolute\n  let { top = 0, height = 0 } = featureLayout.absolute\n\n  if (left + width < 0) {\n    return null\n  }\n\n  if (isUTR(feature)) {\n    top += ((1 - utrHeightFraction) / 2) * height\n    height *= utrHeightFraction\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(2, Math.min(width - diff, screenWidth))\n\n  let fill: string = isUTR(feature)\n    ? readConfObject(config, 'color3', { feature })\n    : readConfObject(config, 'color1', { feature })\n  if (\n    colorByCDS &&\n    featureType === 'CDS' &&\n    featureStrand !== undefined &&\n    featurePhase !== undefined\n  ) {\n    const frame = getFrame(\n      featureStart,\n      featureEnd,\n      featureStrand,\n      featurePhase,\n    )\n    const frameColor = theme.palette.framesCDS.at(frame)?.main\n    if (frameColor) {\n      fill = frameColor\n    }\n  }\n\n  // if feature has parent and type is intron, then don't render the intron\n  // subfeature (if it doesn't have a parent, then maybe the introns are\n  // separately displayed features that should be displayed)\n  return feature.parent() && featureType === 'intron' ? null : (\n    <>\n      {topLevel ? <Arrow {...props} /> : null}\n      <rect\n        data-testid={`box-${feature.id()}`}\n        x={leftWithinBlock}\n        y={top}\n        width={widthWithinBlock}\n        height={height}\n        fill={fill}\n        stroke={readConfObject(config, 'outline', { feature }) as string}\n      />\n    </>\n  )\n})\n\nexport default Box\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature, stripAlpha } from '@jbrowse/core/util'\nimport { useTheme } from '@mui/material'\n\n// locals\nimport Arrow from './Arrow'\n\nconst Segments = observer(function (props: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n  selected?: boolean\n  reversed?: boolean\n  subfeatures?: Feature[]\n  children?: React.ReactNode\n}) {\n  const {\n    feature,\n    featureLayout,\n    selected,\n    config,\n    // some subfeatures may be computed e.g. makeUTRs,\n    // so these are passed as a prop, or feature.get('subfeatures') by default\n    subfeatures = feature.get('subfeatures'),\n  } = props\n\n  const theme = useTheme()\n  const c = readConfObject(config, 'color2', { feature })\n  const color2 = c === '#f0f' ? stripAlpha(theme.palette.text.secondary) : c\n\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n\n  const y = top + height / 2\n  return (\n    <>\n      <line\n        data-testid={feature.id()}\n        x1={left}\n        y1={y}\n        y2={y}\n        x2={left + width}\n        stroke={color2}\n      />\n      {subfeatures?.map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        // This subfeature got filtered out\n        if (!subfeatureLayout) {\n          return null\n        }\n        const { GlyphComponent } = subfeatureLayout.data || {}\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            topLevel={false}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n      <Arrow {...props} />\n    </>\n  )\n})\n\nexport default Segments\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\n\nimport Segments from './Segments'\nimport { ExtraGlyphValidator, layOutFeature, layOutSubfeatures } from './util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature, SimpleFeature } from '@jbrowse/core/util'\n\n// returns a callback that will filter features features according to the\n// subParts conf var\nfunction makeSubpartsFilter(\n  confKey = 'subParts',\n  config: AnyConfigurationModel,\n) {\n  const filter = readConfObject(config, confKey) as string[] | string\n  const ret = typeof filter == 'string' ? filter.split(/\\s*,\\s*/) : filter\n\n  return (feature: Feature) =>\n    ret\n      .map(typeName => typeName.toLowerCase())\n      .includes(feature.get('type').toLowerCase())\n}\n\nfunction filterSubpart(feature: Feature, config: AnyConfigurationModel) {\n  return makeSubpartsFilter('subParts', config)(feature)\n}\n\nfunction isUTR(feature: Feature) {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n\nfunction makeUTRs(parent: Feature, subs: Feature[]) {\n  // based on Lincoln's UTR-making code in Bio::Graphics::Glyph::processed_transcript\n  const subparts = [...subs]\n\n  let codeStart = Infinity\n  let codeEnd = -Infinity\n\n  let haveLeftUTR\n  let haveRightUTR\n\n  // gather exons, find coding start and end, and look for UTRs\n  const exons = []\n  for (const subpart of subparts) {\n    const type = subpart.get('type')\n    if (/^cds/i.test(type)) {\n      if (codeStart > subpart.get('start')) {\n        codeStart = subpart.get('start')\n      }\n      if (codeEnd < subpart.get('end')) {\n        codeEnd = subpart.get('end')\n      }\n    } else if (/exon/i.test(type)) {\n      exons.push(subpart)\n    } else if (isUTR(subpart)) {\n      haveLeftUTR = subpart.get('start') === parent.get('start')\n      haveRightUTR = subpart.get('end') === parent.get('end')\n    }\n  }\n\n  // bail if we don't have exons and CDS\n  if (!(exons.length && codeStart < Infinity && codeEnd > -Infinity)) {\n    return subparts\n  }\n\n  // make sure the exons are sorted by coord\n  exons.sort((a, b) => a.get('start') - b.get('start'))\n\n  const strand = parent.get('strand')\n\n  // make the left-hand UTRs\n  let start\n  let end\n  if (!haveLeftUTR) {\n    for (let i = 0; i < exons.length; i++) {\n      start = exons[i].get('start')\n      if (start >= codeStart) {\n        break\n      }\n      end = codeStart > exons[i].get('end') ? exons[i].get('end') : codeStart\n      const type = strand >= 0 ? 'five_prime_UTR' : 'three_prime_UTR'\n      subparts.unshift(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  // make the right-hand UTRs\n  if (!haveRightUTR) {\n    for (let i = exons.length - 1; i >= 0; i--) {\n      end = exons[i].get('end')\n      if (end <= codeEnd) {\n        break\n      }\n\n      start = codeEnd < exons[i].get('start') ? exons[i].get('start') : codeEnd\n      const type = strand >= 0 ? 'three_prime_UTR' : 'five_prime_UTR'\n      subparts.push(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  return subparts\n}\n\nfunction getSubparts(f: Feature, config: AnyConfigurationModel) {\n  let c = f.get('subfeatures')\n  if (!c || c.length === 0) {\n    return []\n  }\n  const hasUTRs = c.some(child => isUTR(child))\n  const isTranscript = ['mRNA', 'transcript'].includes(f.get('type'))\n  const impliedUTRs = !hasUTRs && isTranscript\n\n  // if we think we should use impliedUTRs, or it is specifically in the\n  // config, then makeUTRs\n  if (impliedUTRs || readConfObject(config, 'impliedUTRs')) {\n    c = makeUTRs(f, c)\n  }\n\n  return c.filter(element => filterSubpart(element, config))\n}\n\nconst ProcessedTranscript = observer(function ProcessedTranscript(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  selected?: boolean\n  reversed?: boolean\n  [key: string]: unknown\n}) {\n  const { feature, config } = props\n  const subfeatures = getSubparts(feature, config)\n\n  // we manually compute some subfeatures, so pass these separately\n  return <Segments {...props} subfeatures={subfeatures} />\n})\n\n// @ts-expect-error\nProcessedTranscript.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const subfeatures = getSubparts(feature, config)\n  layOutSubfeatures({\n    layout: subLayout,\n    subfeatures,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  return subLayout\n}\n\nexport default ProcessedTranscript\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport {\n  chooseGlyphComponent,\n  ExtraGlyphValidator,\n  layOut,\n  layOutFeature,\n} from './util'\n\nconst Subfeatures = observer(function (props: {\n  feature: Feature\n  featureLayout: SceneGraph\n  selected?: boolean\n}) {\n  const { feature, featureLayout, selected } = props\n\n  return feature.get('subfeatures')?.map(subfeature => {\n    const subfeatureId = String(subfeature.id())\n    const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n    if (!subfeatureLayout) {\n      return null\n    }\n    const { GlyphComponent } = subfeatureLayout.data || {}\n    return (\n      <GlyphComponent\n        key={`glyph-${subfeatureId}`}\n        {...props}\n        feature={subfeature}\n        featureLayout={subfeatureLayout}\n        selected={selected}\n      />\n    )\n  })\n})\n\n// @ts-expect-error\nSubfeatures.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const displayMode = readConfObject(config, 'displayMode')\n  if (displayMode !== 'reducedRepresentation') {\n    let topOffset = 0\n    feature.get('subfeatures')?.forEach(subfeature => {\n      const SubfeatureGlyphComponent = chooseGlyphComponent(\n        subfeature,\n        extraGlyphs,\n      )\n      const subfeatureHeight = readConfObject(config, 'height', {\n        feature: subfeature,\n      }) as number\n\n      const subSubLayout = (SubfeatureGlyphComponent.layOut || layOut)({\n        layout: subLayout,\n        feature: subfeature,\n        bpPerPx,\n        reversed,\n        config,\n        extraGlyphs,\n      })\n      subSubLayout.move(0, topOffset)\n      topOffset +=\n        displayMode === 'collapse'\n          ? 0\n          : (displayMode === 'compact'\n              ? subfeatureHeight / 3\n              : subfeatureHeight) + 2\n    })\n  }\n  return subLayout\n}\n\nexport default Subfeatures\n","import React from 'react'\nimport {\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\nimport { Feature, Region } from '@jbrowse/core/util'\n\n// locals\nimport Box from './Box'\nimport ProcessedTranscript from './ProcessedTranscript'\nimport Segments from './Segments'\nimport Subfeatures from './Subfeatures'\n\nexport interface Glyph\n  extends React.FC<{\n    colorByCDS: boolean\n    feature: Feature\n    featureLayout: SceneGraph\n    selected?: boolean\n    config: AnyConfigurationModel\n    region: Region\n    bpPerPx: number\n    topLevel?: boolean\n    [key: string]: unknown\n  }> {\n  layOut?: Function\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nexport interface DisplayModel {\n  getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n  getFeatureOverlapping?: (\n    blockKey: string,\n    bp: number,\n    y: number,\n  ) => string | undefined\n  selectedFeatureId?: string\n  featureIdUnderMouse?: string\n  contextMenuFeature?: Feature\n}\n\nexport interface ExtraGlyphValidator {\n  glyph: Glyph\n  validator: (feature: Feature) => boolean\n}\n\nexport function chooseGlyphComponent(\n  feature: Feature,\n  extraGlyphs?: ExtraGlyphValidator[],\n): Glyph {\n  const type = feature.get('type')\n  const subfeatures = feature.get('subfeatures')\n\n  if (subfeatures?.length && type !== 'CDS') {\n    const hasSubSub = subfeatures.find(sub => !!sub.get('subfeatures'))\n    if (\n      ['mRNA', 'transcript', 'primary_transcript'].includes(type) &&\n      subfeatures.some(f => f.get('type') === 'CDS')\n    ) {\n      return ProcessedTranscript\n    } else if (!feature.parent() && hasSubSub) {\n      // only do sub-sub on parent level features like gene\n      return Subfeatures\n    } else {\n      return Segments\n    }\n  }\n\n  return extraGlyphs?.find(f => f.validator(feature))?.glyph || Box\n}\n\ninterface BaseLayOutArgs {\n  layout: SceneGraph\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n}\n\ninterface FeatureLayOutArgs extends BaseLayOutArgs {\n  feature: Feature\n  extraGlyphs: ExtraGlyphValidator[]\n}\n\ninterface SubfeatureLayOutArgs extends BaseLayOutArgs {\n  subfeatures: Feature[]\n  extraGlyphs: ExtraGlyphValidator[]\n}\n\nexport function layOut({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: FeatureLayOutArgs): SceneGraph {\n  const displayMode = readConfObject(config, 'displayMode')\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  if (displayMode !== 'reducedRepresentation') {\n    layOutSubfeatures({\n      layout: subLayout,\n      subfeatures: feature.get('subfeatures') || [],\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  }\n  return subLayout\n}\n\nexport function layOutFeature(args: FeatureLayOutArgs) {\n  const { layout, feature, bpPerPx, reversed, config, extraGlyphs } = args\n  const displayMode = readConfObject(config, 'displayMode') as string\n  const GlyphComponent =\n    displayMode === 'reducedRepresentation'\n      ? Box\n      : chooseGlyphComponent(feature, extraGlyphs)\n  const parentFeature = feature.parent()\n  let x = 0\n  if (parentFeature) {\n    x =\n      (reversed\n        ? parentFeature.get('end') - feature.get('end')\n        : feature.get('start') - parentFeature.get('start')) / bpPerPx\n  }\n  const height = readConfObject(config, 'height', { feature }) as number\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const layoutParent = layout.parent\n  const top = layoutParent ? layoutParent.top : 0\n  return layout.addChild(\n    String(feature.id()),\n    x,\n    displayMode === 'collapse' ? 0 : top,\n    Math.max(width, 1), // has to be at least one to register in the layout\n    displayMode === 'compact' ? height / 2 : height,\n    { GlyphComponent },\n  )\n}\n\nexport function layOutSubfeatures(args: SubfeatureLayOutArgs) {\n  const { layout, subfeatures, bpPerPx, reversed, config, extraGlyphs } = args\n  subfeatures.forEach(feature => {\n    ;(chooseGlyphComponent(feature, extraGlyphs).layOut || layOut)({\n      layout,\n      feature,\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  })\n}\n\nexport function isUTR(feature: Feature) {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n","import React, { useEffect, useRef, useState, useCallback } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { bpToPx, measureText, Region, Feature } from '@jbrowse/core/util'\nimport { BaseLayout, SceneGraph } from '@jbrowse/core/util/layouts'\n\n// locals\nimport FeatureGlyph from './FeatureGlyph'\nimport SvgOverlay from './SvgOverlay'\nimport {\n  chooseGlyphComponent,\n  layOut,\n  ExtraGlyphValidator,\n  DisplayModel,\n} from './util'\n\n// used to make features have a little padding for their labels\nconst xPadding = 3\nconst yPadding = 5\n\n// used so that user can click-away-from-feature below the laid out features\n// (issue #1248)\nconst svgHeightPadding = 100\n\nfunction RenderedFeatureGlyph(props: {\n  feature: Feature\n  bpPerPx: number\n  region: Region\n  config: AnyConfigurationModel\n  colorByCDS: boolean\n  layout: BaseLayout<unknown>\n  extraGlyphs?: ExtraGlyphValidator[]\n  displayMode: string\n  exportSVG?: unknown\n  displayModel?: DisplayModel\n  detectRerender?: () => void\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  [key: string]: unknown\n}) {\n  const {\n    feature,\n    detectRerender,\n    bpPerPx,\n    region,\n    config,\n    displayMode,\n    layout,\n    extraGlyphs,\n  } = props\n\n  // used for unit testing, difficult to mock out so it is in actual source code\n  detectRerender?.()\n\n  const { reversed } = region\n  const start = feature.get(reversed ? 'end' : 'start')\n  const startPx = bpToPx(start, region, bpPerPx)\n  const labelAllowed = displayMode !== 'collapsed'\n\n  const rootLayout = new SceneGraph('root', 0, 0, 0, 0)\n  const GlyphComponent = chooseGlyphComponent(feature, extraGlyphs)\n  const featureLayout = (GlyphComponent.layOut || layOut)({\n    layout: rootLayout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  let shouldShowName = false\n  let shouldShowDescription = false\n  let name = ''\n  let description = ''\n  let fontHeight = 0\n  let expansion = 0\n  if (labelAllowed) {\n    const showLabels = readConfObject(config, 'showLabels')\n    const showDescriptions = readConfObject(config, 'showDescriptions')\n    fontHeight = readConfObject(config, ['labels', 'fontSize'], { feature })\n    expansion = readConfObject(config, 'maxFeatureGlyphExpansion') || 0\n    name = String(readConfObject(config, ['labels', 'name'], { feature }) || '')\n    shouldShowName = /\\S/.test(name) && showLabels\n\n    const getWidth = (text: string) => {\n      const glyphWidth = rootLayout.width + expansion\n      const textWidth = measureText(text, fontHeight)\n      return Math.round(Math.min(textWidth, glyphWidth))\n    }\n\n    description = String(\n      readConfObject(config, ['labels', 'description'], { feature }) || '',\n    )\n    shouldShowDescription = /\\S/.test(description) && showDescriptions\n\n    if (shouldShowName) {\n      rootLayout.addChild(\n        'nameLabel',\n        0,\n        featureLayout.bottom,\n        getWidth(name),\n        fontHeight,\n      )\n    }\n\n    if (shouldShowDescription) {\n      const aboveLayout = shouldShowName\n        ? rootLayout.getSubRecord('nameLabel')\n        : featureLayout\n\n      rootLayout.addChild(\n        'descriptionLabel',\n        0,\n        aboveLayout.bottom,\n        getWidth(description),\n        fontHeight,\n      )\n    }\n  }\n\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start'),\n    feature.get('start') + rootLayout.width * bpPerPx + xPadding * bpPerPx,\n    rootLayout.height + yPadding,\n  )\n  if (topPx === null) {\n    return null\n  }\n  rootLayout.move(startPx, topPx)\n\n  return (\n    <FeatureGlyph\n      rootLayout={rootLayout}\n      name={name}\n      shouldShowName={shouldShowName}\n      description={description}\n      shouldShowDescription={shouldShowDescription}\n      fontHeight={fontHeight}\n      allowedWidthExpansion={expansion}\n      reversed={region.reversed}\n      topLevel={true}\n      {...props}\n    />\n  )\n}\n\nconst RenderedFeatures = observer(\n  (props: {\n    features?: Map<string, Feature>\n    isFeatureDisplayed?: (f: Feature) => boolean\n    bpPerPx: number\n    config: AnyConfigurationModel\n    displayMode: string\n    colorByCDS: boolean\n    displayModel?: DisplayModel\n    region: Region\n    exportSVG?: unknown\n    extraGlyphs?: ExtraGlyphValidator[]\n    layout: BaseLayout<unknown>\n    viewParams: {\n      start: number\n      end: number\n      offsetPx: number\n      offsetPx1: number\n    }\n    [key: string]: unknown\n  }) => {\n    const { features = new Map(), isFeatureDisplayed } = props\n    return (\n      <>\n        {[...features.values()]\n          .filter(feature =>\n            isFeatureDisplayed ? isFeatureDisplayed(feature) : true,\n          )\n          .map(feature => (\n            <RenderedFeatureGlyph\n              key={feature.id()}\n              feature={feature}\n              {...props}\n            />\n          ))}\n      </>\n    )\n  },\n)\n\nconst SvgFeatureRendering = observer(function SvgFeatureRendering(props: {\n  layout: BaseLayout<unknown>\n  blockKey: string\n  regions: Region[]\n  bpPerPx: number\n  detectRerender?: () => void\n  config: AnyConfigurationModel\n  colorByCDS: boolean\n  features: Map<string, Feature>\n  displayModel?: DisplayModel\n  exportSVG?: boolean\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  featureDisplayHandler?: (f: Feature) => boolean\n  extraGlyphs?: ExtraGlyphValidator[]\n  onMouseOut?: React.MouseEventHandler\n  onMouseDown?: React.MouseEventHandler\n  onMouseLeave?: React.MouseEventHandler\n  onMouseEnter?: React.MouseEventHandler\n  onMouseOver?: React.MouseEventHandler\n  onMouseMove?: (event: React.MouseEvent, featureId?: string) => void\n  onMouseUp?: React.MouseEventHandler\n  onClick?: React.MouseEventHandler\n}) {\n  const {\n    layout,\n    blockKey,\n    regions = [],\n    bpPerPx,\n    config,\n    displayModel = {},\n    exportSVG,\n    featureDisplayHandler,\n    onMouseOut,\n    onMouseDown,\n    onMouseLeave,\n    onMouseEnter,\n    onMouseOver,\n    onMouseMove,\n    onMouseUp,\n    onClick,\n  } = props\n\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n  const displayMode = readConfObject(config, 'displayMode') as string\n\n  const ref = useRef<SVGSVGElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [height, setHeight] = useState(0)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n\n  const mouseDown = useCallback(\n    (event: React.MouseEvent) => {\n      setMouseIsDown(true)\n      setMovedDuringLastMouseDown(false)\n      return onMouseDown?.(event)\n    },\n    [onMouseDown],\n  )\n\n  const mouseUp = useCallback(\n    (event: React.MouseEvent) => {\n      setMouseIsDown(false)\n      return onMouseUp?.(event)\n    },\n    [onMouseUp],\n  )\n\n  const mouseMove = useCallback(\n    (event: React.MouseEvent) => {\n      if (!ref.current) {\n        return\n      }\n      if (mouseIsDown) {\n        setMovedDuringLastMouseDown(true)\n      }\n      const { left, top } = ref.current.getBoundingClientRect()\n      const offsetX = event.clientX - left\n      const offsetY = event.clientY - top\n      const px = region.reversed ? width - offsetX : offsetX\n      const clientBp = region.start + bpPerPx * px\n\n      const featureIdCurrentlyUnderMouse = displayModel.getFeatureOverlapping?.(\n        blockKey,\n        clientBp,\n        offsetY,\n      )\n\n      if (onMouseMove) {\n        onMouseMove(event, featureIdCurrentlyUnderMouse)\n      }\n    },\n    [\n      blockKey,\n      bpPerPx,\n      mouseIsDown,\n      onMouseMove,\n      region.reversed,\n      region.start,\n      displayModel,\n      width,\n    ],\n  )\n\n  const click = useCallback(\n    (event: React.MouseEvent) => {\n      // don't select a feature if we are clicking and dragging\n      if (movedDuringLastMouseDown) {\n        return\n      }\n      onClick?.(event)\n    },\n    [movedDuringLastMouseDown, onClick],\n  )\n\n  useEffect(() => {\n    setHeight(layout.getTotalHeight())\n  }, [layout])\n\n  return exportSVG ? (\n    <RenderedFeatures\n      displayMode={displayMode}\n      isFeatureDisplayed={featureDisplayHandler}\n      region={region}\n      {...props}\n    />\n  ) : (\n    <svg\n      ref={ref}\n      data-testid=\"svgfeatures\"\n      width={width}\n      height={height + svgHeightPadding}\n      style={{\n        // use block because svg by default is inline, which adds a margin\n        display: 'block',\n      }}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onMouseMove={mouseMove}\n      onClick={click}\n    >\n      <RenderedFeatures\n        displayMode={displayMode}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n        isFeatureDisplayed={featureDisplayHandler}\n        {...props}\n      />\n\n      <SvgOverlay\n        {...props}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n      />\n    </svg>\n  )\n})\n\nexport default SvgFeatureRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config SvgFeatureRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst SvgFeatureRenderer = ConfigurationSchema(\n  'SvgFeatureRenderer',\n  {\n    /**\n     * #slot\n     */\n    color1: {\n      type: 'color',\n      description: 'the main color of each feature',\n      defaultValue: 'goldenrod',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    color2: {\n      type: 'color',\n      description:\n        'the secondary color of each feature, used for connecting lines, etc',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    color3: {\n      type: 'color',\n      description:\n        'the tertiary color of each feature, often used for contrasting fills, like on UTRs',\n      defaultValue: '#357089',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    outline: {\n      type: 'color',\n      description: 'the outline for features',\n      defaultValue: '',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'height in pixels of the main body of each feature',\n      defaultValue: 10,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    showLabels: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n\n    /**\n     * #slot\n     */\n    showDescriptions: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n\n    labels: ConfigurationSchema('SvgFeatureLabels', {\n      /**\n       * #slot labels.name\n       */\n      name: {\n        type: 'string',\n        description:\n          'the primary name of the feature to show, if space is available',\n        defaultValue: `jexl:get(feature,'name') || get(feature,'id')`,\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.nameColor\n       */\n      nameColor: {\n        type: 'color',\n        description: 'the color of the name label, if shown',\n        defaultValue: '#f0f',\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.description\n       */\n      description: {\n        type: 'string',\n        description: 'the text description to show, if space is available',\n        defaultValue: `jexl:get(feature,'note') || get(feature,'description')`,\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.descriptionColor\n       */\n      descriptionColor: {\n        type: 'color',\n        description: 'the color of the description, if shown',\n        defaultValue: 'blue',\n        contextVariable: ['feature'],\n      },\n\n      /**\n       * #slot labels.fontSize\n       */\n      fontSize: {\n        type: 'number',\n        description:\n          'height in pixels of the text to use for names and descriptions',\n        defaultValue: 12,\n        contextVariable: ['feature'],\n      },\n    }),\n\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'reducedRepresentation',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n\n    /**\n     * #slot\n     */\n    maxFeatureGlyphExpansion: {\n      type: 'number',\n      description:\n        \"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use\",\n      defaultValue: 500,\n    },\n\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a svg rendering',\n      defaultValue: 1200,\n    },\n\n    /**\n     * #slot\n     */\n    subParts: {\n      type: 'string',\n      description: 'subparts for a glyph',\n      defaultValue: 'CDS,UTR,five_prime_UTR,three_prime_UTR',\n    },\n\n    /**\n     * #slot\n     */\n    impliedUTRs: {\n      type: 'boolean',\n      description: 'imply UTR from the exon and CDS differences',\n      defaultValue: false,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default SvgFeatureRenderer\n","import BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as svgFeatureRendererConfigSchema,\n  ReactComponent as SvgFeatureRendererReactComponent,\n} from './SvgFeatureRenderer'\n\nclass SvgFeatureRenderer extends BoxRendererType {\n  supportsSVG = true\n}\n\nexport default class SVGPlugin extends Plugin {\n  name = 'SVGPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new SvgFeatureRenderer({\n          name: 'SvgFeatureRenderer',\n          ReactComponent: SvgFeatureRendererReactComponent,\n          configSchema: svgFeatureRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n  }\n}\n\nexport {\n  configSchema as svgFeatureRendererConfigSchema,\n  ReactComponent as SvgFeatureRendererReactComponent,\n} from './SvgFeatureRenderer'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config GCContentAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GCContentAdapterF = (_pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'GCContentAdapter',\n    {\n      /**\n       * #slot\n       */\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n      /**\n       * #slot\n       */\n      windowSize: {\n        type: 'number',\n        defaultValue: 100,\n      },\n      /**\n       * #slot\n       */\n      windowDelta: {\n        type: 'number',\n        defaultValue: 100,\n      },\n    },\n    { explicitlyTyped: true },\n  )\n}\n\nexport default GCContentAdapterF\n","import {\n  getConf,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSession } from '@jbrowse/core/util'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport { types } from 'mobx-state-tree'\nimport { lazy } from 'react'\n\nconst EditGCContentParamsDialog = lazy(\n  () => import('./components/EditGCContentParams'),\n)\n\n/**\n * #stateModel SharedGCContentModel\n * #category display\n * extends\n * - [LinearWiggleDisplay](../linearwiggledisplay)\n */\nexport default function SharedModelF(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'SharedGCContentModel',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        windowSize: types.maybe(types.number),\n        /**\n         * #property\n         */\n        windowDelta: types.maybe(types.number),\n      }),\n    )\n    .actions(self => ({\n      setGCContentParams({\n        windowSize,\n        windowDelta,\n      }: {\n        windowSize: number\n        windowDelta: number\n      }) {\n        self.windowSize = windowSize\n        self.windowDelta = windowDelta\n      },\n    }))\n    .views(self => ({\n      get windowSizeSetting() {\n        return self.windowSize ?? getConf(self, 'windowSize')\n      },\n      get windowDeltaSetting() {\n        return self.windowDelta ?? getConf(self, 'windowDelta')\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n      return {\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Change GC parameters',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  EditGCContentParamsDialog,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n        /**\n         * #method\n         * retrieves the sequence adapter from parent track, and puts it as a\n         * subadapter on a GCContentAdapter\n         */\n        renderProps() {\n          const sequenceAdapter = getConf(self.parentTrack, 'adapter')\n          return {\n            ...superRenderProps(),\n            adapterConfig: {\n              type: 'GCContentAdapter',\n              sequenceAdapter,\n              windowSize: self.windowSizeSetting,\n              windowDelta: self.windowDeltaSetting,\n            },\n          }\n        },\n      }\n    })\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport GCContentAdapterF from './GCContentAdapter'\nimport GCContentTrackF from './GCContentTrack'\nimport LinearGCContentDisplayF from './LinearGCContentDisplay'\n\nexport default class GCContentPlugin extends Plugin {\n  name = 'GCContentPlugin'\n\n  install(pluginManager: PluginManager) {\n    GCContentAdapterF(pluginManager)\n    GCContentTrackF(pluginManager)\n    LinearGCContentDisplayF(pluginManager)\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport configSchemaF from './configSchema'\n\nexport default function GCContentTrackF(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'GCContentTrack',\n      displayName: 'GCContent track',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'GCContentTrack', configSchema),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchemaF from './configSchema'\n\nexport default function GCContentAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'GCContentAdapter',\n        displayName: 'GC content adapter',\n        adapterMetadata: {\n          hiddenFromGUI: true,\n        },\n        configSchema: configSchemaF(pluginManager),\n        getAdapterClass: () =>\n          import('./GCContentAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config GCContentTrack\n * used for having a gc content track outside of the \"reference sequence display\"\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'GCContentTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\n\nimport configSchemaFactory1 from './config1'\nimport configSchemaFactory2 from './config2'\nimport stateModelF1 from './stateModel1'\nimport stateModelF2 from './stateModel2'\n\nexport default function LinearGCContentDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory1(pluginManager)\n    const stateModel = stateModelF1(pluginManager, configSchema)\n    return new DisplayType({\n      name: 'LinearGCContentDisplay',\n      configSchema,\n      stateModel,\n      displayName: 'GC content display',\n      trackType: 'ReferenceSequenceTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory2(pluginManager)\n    const stateModel = stateModelF2(pluginManager, configSchema)\n    return new DisplayType({\n      name: 'LinearGCContentTrackDisplay',\n      configSchema,\n      stateModel,\n      displayName: 'GC content display',\n      trackType: 'GCContentTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearGCContentDisplay\n * #category display\n * extends LinearWiggleDisplay\n */\nexport default function LinearGCContentDisplay(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearGCContentDisplay',\n    {\n      windowSize: {\n        type: 'number',\n        defaultValue: 100,\n      },\n      windowDelta: {\n        type: 'number',\n        defaultValue: 100,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: pluginManager.getDisplayType('LinearWiggleDisplay')\n        .configSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n// locals\nimport SharedModelF from './shared'\n\n/**\n * #stateModel LinearGCContentDisplay\n * #category display\n * base model `SharedGCContentModel`\n */\nexport default function stateModelF(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types.compose(\n    'LinearGCContentDisplay',\n    SharedModelF(pluginManager, configSchema),\n    types.model({\n      type: types.literal('LinearGCContentDisplay'),\n    }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearGCContentTrackDisplay\n * #category display\n * extends LinearWiggleDisplay, used specifically for GCContentTrack\n */\nexport default function LinearGCContentTrackDisplayF(\n  pluginManager: PluginManager,\n) {\n  return ConfigurationSchema(\n    'LinearGCContentTrackDisplay',\n    {\n      windowSize: {\n        type: 'number',\n        defaultValue: 100,\n      },\n      windowDelta: {\n        type: 'number',\n        defaultValue: 100,\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: pluginManager.getDisplayType('LinearWiggleDisplay')\n        .configSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n// locals\nimport SharedModelF from './shared'\n\n/**\n * #stateModel LinearGCContentTrackDisplay\n * #category display\n *\n * used on GCContentTrack, separately from the display type on the\n * ReferenceSequenceTrack\n *\n * extends\n * - [SharedGCContentModel](../sharedgccontentmodel)\n */\nexport default function stateModelF(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types.compose(\n    'LinearGCContentTrackDisplay',\n    SharedModelF(pluginManager, configSchema),\n    types.model({\n      type: types.literal('LinearGCContentTrackDisplay'),\n    }),\n  )\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { types } from 'mobx-state-tree'\n\n/** utility function for assembling the MST model of a column data type */\nexport default function MakeSpreadsheetColumnType(\n  name: string,\n  {\n    DataCellReactComponent = null,\n    FilterModelType = null,\n    compare,\n    displayName = undefined,\n    categoryName = undefined,\n  }: {\n    compare?: any\n    DataCellReactComponent?: React.FC<any> | null\n    FilterModelType?: any\n    displayName?: string\n    categoryName?: string\n  },\n) {\n  return types\n    .model(`ColumnDataType${name}`, {\n      type: types.literal(name),\n    })\n    .volatile(() => ({\n      DataCellReactComponent,\n      FilterModelType: FilterModelType,\n      displayName: displayName || name,\n      categoryName,\n    }))\n    .views(() => ({\n      compare,\n      get hasFilter() {\n        return !!FilterModelType\n      },\n    }))\n}\n","import React from 'react'\nimport {\n  IconButton,\n  TextField,\n  MenuItem,\n  InputAdornment,\n  Select,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { types, getParent, getPropertyMembers } from 'mobx-state-tree'\n\n// jbrowse imports\nimport {\n  getPropertyType,\n  getEnumerationValues,\n  getSubType,\n} from '@jbrowse/core/util/mst-reflection'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  doesIntersect2,\n  isContainedWithin,\n  compareLocs,\n  getSession,\n  parseLocString,\n} from '@jbrowse/core/util'\n\n// icons\nimport ClearIcon from '@mui/icons-material/Clear'\n\n// locals\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  textFilterControlAdornment: { marginRight: '-18px' },\n  textFilterControl: {\n    '& .MuiInput-formControl': {\n      marginTop: 8,\n    },\n    '& .MuiInputLabel-formControl': {\n      top: '-7px',\n      '&.MuiInputLabel-shrink': {\n        top: '-3px',\n      },\n    },\n  },\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(function ({\n  filterModel,\n}: {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  filterModel: any\n}) {\n  const { classes } = useStyles()\n  const operationChoices = getEnumerationValues(\n    getSubType(getPropertyType(getPropertyMembers(filterModel), 'operation')),\n  )\n  return (\n    <>\n      <Select\n        value={filterModel.operation}\n        onChange={event => filterModel.setOperation(String(event.target.value))}\n      >\n        {operationChoices.map(name => (\n          <MenuItem key={name} value={name}>\n            {name}\n          </MenuItem>\n        ))}\n      </Select>{' '}\n      <TextField\n        label=\"range\"\n        placeholder=\"chr1:100-200\"\n        error={filterModel.locStringIsInvalid}\n        value={filterModel.locString}\n        onChange={evt => filterModel.setLocString(evt.target.value)}\n        className={classes.textFilterControl}\n        InputProps={{\n          endAdornment: (\n            <InputAdornment\n              className={classes.textFilterControlAdornment}\n              position=\"end\"\n            >\n              <IconButton\n                aria-label=\"clear filter\"\n                onClick={() => filterModel.setLocString('')}\n              >\n                <ClearIcon />\n              </IconButton>\n            </InputAdornment>\n          ),\n        }}\n      />\n    </>\n  )\n})\n\nconst OPERATIONS = [\n  'overlaps with',\n  'contained within',\n  'fully contains',\n  'does not overlap',\n  'not contained within',\n  'does not contain',\n]\n\ninterface Loc {\n  start: number\n  end: number\n  refName: string\n}\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  'overlaps with': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      doesIntersect2(\n        cellLocation.start,\n        cellLocation.end,\n        specifiedLocation.start,\n        specifiedLocation.end,\n      )\n    )\n  },\n  'contained within': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      isContainedWithin(\n        cellLocation.start,\n        cellLocation.end,\n        specifiedLocation.start,\n        specifiedLocation.end,\n      )\n    )\n  },\n  'fully contains': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      isContainedWithin(\n        specifiedLocation.start,\n        specifiedLocation.end,\n        cellLocation.start,\n        cellLocation.end,\n      )\n    )\n  },\n} as Record<string, (a: Loc, b: Loc) => boolean>\n\nOPERATION_PREDICATES['does not overlap'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['overlaps with'](cellLocation, specifiedLocation)\n}\nOPERATION_PREDICATES['not contained within'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['contained within'](\n    cellLocation,\n    specifiedLocation,\n  )\n}\nOPERATION_PREDICATES['does not contain'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['fully contains'](\n    cellLocation,\n    specifiedLocation,\n  )\n}\n\n// MST model for the column filter control\nconst FilterModelType = types\n  .model('ColumnLocStringFilter', {\n    type: types.literal('LocString'),\n    columnNumber: types.integer,\n    locString: '',\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    get locStringIsInvalid() {\n      if (self.locString) {\n        const parsed = this.parsedLocString\n        return (\n          !parsed ||\n          parsed.refName === '' ||\n          typeof parsed.start !== 'number' ||\n          typeof parsed.end !== 'number' ||\n          parsed.start > parsed.end\n        )\n      }\n      return false\n    },\n    get parsedLocString() {\n      const session = getSession(self)\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const model = getParent<any>(self, 3).spreadsheet\n      const { assemblyName } = model\n      try {\n        return parseLocString(self.locString, refName =>\n          session.assemblyManager.isValidRefName(refName, assemblyName),\n        )\n      } catch (e) {\n        return undefined\n      }\n    },\n  }))\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      const {\n        locString,\n        locStringIsInvalid,\n        parsedLocString,\n        operation,\n        columnNumber,\n      } = self // avoid closing over self\n      if (!locString || locStringIsInvalid || !parsedLocString) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return function stringPredicate(_sheet: any, row: any) {\n        const { cellsWithDerived: cells } = row\n        const cell = cells[columnNumber]\n\n        if (!cell?.text || !cell.extendedData) {\n          return false\n        }\n        const parsedCellText = cell.extendedData\n        if (!parsedCellText.refName) {\n          return false\n        }\n\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n\n        return predicate(parsedCellText, parsedLocString as Loc)\n      }\n    },\n  }))\n  .actions(self => ({\n    setLocString(s: string) {\n      self.locString = s\n    },\n    setOperation(op: string) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n// opens a new LGV at the location described in the locString in the cell text\n\nasync function locationLinkClick(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  spreadsheet: any,\n  _columnNumber: number,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  cell: any,\n) {\n  const session = getSession(spreadsheet)\n  const { assemblyName } = spreadsheet\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const { id } = getParent<any>(spreadsheet)\n\n  const newViewId = `${id}_${assemblyName}`\n  let view = session.views.find(v => v.id === newViewId) as LGV\n  if (!view) {\n    view = session.addView('LinearGenomeView', {\n      id: newViewId,\n    }) as LGV\n  }\n  await view.navToLocString(cell.text, assemblyName)\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype DataCell = any\n\nconst DataCellReactComponent = observer(function ({\n  cell,\n  columnNumber,\n  spreadsheet,\n}: DataCell) {\n  return (\n    <a\n      onClick={async evt => {\n        evt.preventDefault()\n        const session = getSession(spreadsheet)\n        try {\n          await locationLinkClick(spreadsheet, columnNumber, cell)\n        } catch (e) {\n          console.error(e)\n          session.notifyError(`${e}`, e)\n        }\n      }}\n      title=\"open a new linear genome view here\"\n      href=\"#link\"\n    >\n      {cell.text}\n    </a>\n  )\n})\n\nconst LocStringColumnType = MakeSpreadsheetColumnType('LocString', {\n  categoryName: 'Location',\n  displayName: 'Full location',\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  compare(cellA: { extendedData: any }, cellB: { extendedData: any }) {\n    return compareLocs(cellA.extendedData, cellB.extendedData)\n  },\n  FilterModelType,\n  DataCellReactComponent,\n})\n\nexport default LocStringColumnType\n","import React from 'react'\nimport {\n  IconButton,\n  TextField,\n  MenuItem,\n  InputAdornment,\n  Select,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { types, getPropertyMembers } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport {\n  getPropertyType,\n  getEnumerationValues,\n  getSubType,\n} from '@jbrowse/core/util/mst-reflection'\n\n// icons\nimport ClearIcon from '@mui/icons-material/Clear'\n\nconst OPERATIONS = [\n  'equals',\n  'contains',\n  'does not contain',\n  'does not equal',\n  'starts with',\n  'ends with',\n]\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  contains: (textInCell, stringToFind) => {\n    return textInCell.toLowerCase().includes(stringToFind)\n  },\n  equals: (textInCell, stringToFind) => {\n    return textInCell.toLowerCase() === stringToFind\n  },\n  'starts with': (textInCell, stringToFind) => {\n    return textInCell.toLowerCase().startsWith(stringToFind)\n  },\n  'ends with': (textInCell, stringToFind) => {\n    const index = textInCell.toLowerCase().indexOf(stringToFind)\n    if (index === -1) {\n      return false\n    }\n    return index === textInCell.length - stringToFind.length\n  },\n} as Record<string, (a: string, b: string) => boolean>\n\nOPERATION_PREDICATES['does not contain'] = (textInCell, stringToFind) => {\n  return !OPERATION_PREDICATES.contains(textInCell, stringToFind)\n}\nOPERATION_PREDICATES['does not equal'] = (textInCell, stringToFind) => {\n  return !OPERATION_PREDICATES.equals(textInCell, stringToFind)\n}\n\nconst useStyles = makeStyles()({\n  textFilterControlAdornment: { marginRight: '-18px' },\n  textFilterControl: {\n    margin: 0,\n    '& .MuiInput-formControl': {\n      marginTop: 8,\n    },\n    '& .MuiInputLabel-formControl': {\n      top: '-7px',\n      '&.MuiInputLabel-shrink': {\n        top: '-3px',\n      },\n    },\n  },\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ filterModel }: { filterModel: any }) => {\n    const { classes } = useStyles()\n    const operationChoices = getEnumerationValues(\n      getSubType(getPropertyType(getPropertyMembers(filterModel), 'operation')),\n    )\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"text\"\n          value={filterModel.stringToFind}\n          onChange={evt => filterModel.setString(evt.target.value)}\n          className={classes.textFilterControl}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => filterModel.setString('')}\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </>\n    )\n  },\n)\n\n// MST model for the column filter control\nconst ColumnTextFilter = types\n  .model('ColumnTextFilter', {\n    type: types.literal('Text'),\n    columnNumber: types.integer,\n    stringToFind: '',\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      const { stringToFind, columnNumber, operation } = self // avoid closing over self\n      if (!stringToFind) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n      const s = stringToFind.toLowerCase() // case insensitive match\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return function stringPredicate(_sheet: any, row: any) {\n        const { cellsWithDerived } = row\n        const cell = cellsWithDerived[columnNumber]\n        if (!cell?.text) {\n          return false\n        }\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n        return predicate(cell.text, s)\n      }\n    },\n  }))\n  .actions(self => ({\n    setString(s: string) {\n      self.stringToFind = s\n    },\n    setOperation(op: string) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\nconst TextColumnType = MakeSpreadsheetColumnType('Text', {\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return cellA.text.localeCompare(cellB.text)\n  },\n  FilterModelType: ColumnTextFilter,\n})\n\nexport { TextColumnType as TextColumn, ColumnTextFilter as FilterModelType }\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { FilterModelType as NumberFilterModel } from './Text'\nimport { types } from 'mobx-state-tree'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocRef'),\n  }),\n)\n\nconst LocRef = MakeSpreadsheetColumnType('LocRef', {\n  categoryName: 'Location',\n  displayName: 'Reference seq',\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return cellA.text.localeCompare(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocRef\n","import React from 'react'\nimport { types } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport { MenuItem, Select, TextField } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\n\nconst OPERATIONS = [\n  'equals',\n  'greater than',\n  'less than',\n  'between',\n  'not between',\n]\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  equals: (numberInCell, firstNumber) => {\n    return numberInCell === firstNumber\n  },\n  'greater than': (numberInCell, firstNumber) => {\n    return numberInCell > firstNumber\n  },\n  'less than': (numberInCell, firstNumber) => {\n    return numberInCell < firstNumber\n  },\n  between: (numberInCell, firstNumber, secondNumber) => {\n    return (\n      numberInCell > firstNumber &&\n      secondNumber !== undefined &&\n      numberInCell < secondNumber\n    )\n  },\n} as Record<string, (arg0: number, a: number, b?: number) => boolean>\n\nOPERATION_PREDICATES['not between'] = (\n  numberInCell,\n  firstNumber,\n  secondNumber,\n) => {\n  return !OPERATION_PREDICATES.between(numberInCell, firstNumber, secondNumber)\n}\n\nconst useStyles = makeStyles()({\n  textFilterControlAdornment: { marginRight: '-18px' },\n  textFilterControl: {\n    '& .MuiInput-formControl': {\n      marginTop: 8,\n    },\n    '& .MuiInputLabel-formControl': {\n      top: '-7px',\n      '&.MuiInputLabel-shrink': {\n        top: '-3px',\n      },\n    },\n  },\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ filterModel }: { filterModel: any }) => {\n    const { classes } = useStyles()\n\n    const operationChoices = OPERATIONS\n\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={e => filterModel.setOperation(String(e.target.value))}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"number\"\n          placeholder=\"123\"\n          type=\"number\"\n          error={filterModel.firstNumberIsInvalid}\n          defaultValue={filterModel.firstNumber}\n          onChange={evt => {\n            filterModel.setFirstNumber(parseFloat(evt.target.value))\n          }}\n          className={classes.textFilterControl}\n        />\n        {filterModel.operation !== 'between' &&\n        filterModel.operation !== 'not between' ? null : (\n          <>\n            {' and '}\n            <TextField\n              label=\"number\"\n              placeholder=\"456\"\n              type=\"number\"\n              error={filterModel.secondNumberIsInvalid}\n              defaultValue={filterModel.secondNumber}\n              onChange={evt =>\n                filterModel.setSecondNumber(parseFloat(evt.target.value))\n              }\n              className={classes.textFilterControl}\n            />\n          </>\n        )}\n      </>\n    )\n  },\n)\n\n// MST model for the column filter control\nconst FilterModelType = types\n  .model('ColumnNumberFilter', {\n    type: types.literal('Number'),\n    columnNumber: types.integer,\n    firstNumber: types.maybe(types.number),\n    secondNumber: types.maybe(types.number),\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      if (typeof self.firstNumber !== 'number') {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n\n      const { firstNumber, secondNumber, operation, columnNumber } = self // avoid closing over self\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return function stringPredicate(_sheet: any, row: any) {\n        const { cellsWithDerived } = row\n        const cell = cellsWithDerived[columnNumber]\n\n        if (!cell?.text) {\n          return false\n        }\n\n        const parsedCellText = parseFloat(cell.text)\n        if (typeof parsedCellText !== 'number') {\n          return false\n        }\n\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n\n        return predicate(parsedCellText, firstNumber, secondNumber)\n      }\n    },\n  }))\n  .actions(self => ({\n    setFirstNumber(n: number) {\n      self.firstNumber =\n        Number.isNaN(n) || typeof n !== 'number' ? undefined : n\n    },\n    setSecondNumber(n: number) {\n      self.secondNumber =\n        Number.isNaN(n) || typeof n !== 'number' ? undefined : n\n    },\n    setOperation(op: string) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\nconst NumberColumn = MakeSpreadsheetColumnType('Number', {\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport { NumberColumn, FilterModelType }\n","import LocString from './LocString'\nimport LocRef from './LocRef'\nimport LocStart from './LocStart'\nimport LocEnd from './LocEnd'\nimport { NumberColumn as Number } from './Number'\nimport { TextColumn as Text } from './Text'\nimport { types, IAnyModelType } from 'mobx-state-tree'\n\nconst ColumnTypes = {\n  Number,\n  Text,\n  LocString,\n  LocRef,\n  LocStart,\n  LocEnd,\n}\n\nconst allColumnTypes = Object.values(ColumnTypes)\nconst AnyColumnType = types.union(...allColumnTypes)\nconst AnyFilterModelType = types.union(\n  ...allColumnTypes\n    .map(columnType => {\n      // just instantiate the blank types to get their filter model types\n      const { FilterModelType } = columnType.create({\n        // @ts-expect-error\n        type: columnType.properties.type.value,\n      })\n      return FilterModelType as unknown as IAnyModelType\n    })\n    // some column types might not have filter machinery, filter those out\n    .filter(t => !!t),\n)\n\nexport { ColumnTypes, AnyColumnType, AnyFilterModelType }\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { types } from 'mobx-state-tree'\nimport { FilterModelType as NumberFilterModel } from './Number'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocStart'),\n  }),\n)\n\nconst LocStart = MakeSpreadsheetColumnType('LocStart', {\n  categoryName: 'Location',\n  displayName: 'Start',\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocStart\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { FilterModelType as NumberFilterModel } from './Number'\nimport { types } from 'mobx-state-tree'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocEnd'),\n  }),\n)\n\nconst LocEnd = MakeSpreadsheetColumnType('LocEnd', {\n  categoryName: 'Location',\n  displayName: 'End',\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocEnd\n","import { types, getParent } from 'mobx-state-tree'\n\nconst CellModel = types.model('SpreadsheetCell', {\n  text: types.string,\n  extendedData: types.maybe(types.frozen()),\n})\n\nconst RowModel = types\n  .model('SpreadsheetRow', {\n    id: types.identifier,\n    cells: types.array(CellModel),\n    extendedData: types.maybe(types.frozen()),\n    isSelected: false,\n  })\n  .actions(self => ({\n    toggleSelect() {\n      self.isSelected = !self.isSelected\n    },\n    unSelect() {\n      self.isSelected = false\n    },\n    select() {\n      self.isSelected = true\n    },\n    setExtendedData(data: unknown) {\n      self.extendedData = data\n    },\n  }))\n  .views(self => ({\n    get cellsWithDerived() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { columns } = getParent<any>(self, 3)\n      let i = 0\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return columns.map((column: { isDerived: boolean; expr: any }) => {\n        if (column.isDerived) {\n          return column.expr.evalSync({\n            row: self,\n          })\n        }\n        return self.cells[i++]\n      })\n    },\n  }))\n\nexport default RowModel\n","import RowModel from './Row'\nimport { types, getParent } from 'mobx-state-tree'\n\nconst StaticRowModel = types\n  .model('StaticRowSet', {\n    isLoaded: types.literal(true),\n    rows: types.array(RowModel),\n  })\n  .views(self => ({\n    get count() {\n      return self.rows.length\n    },\n\n    get passingFiltersCount() {\n      return this.sortedFilteredRows.length\n    },\n\n    get selectedCount() {\n      return this.selectedRows.length\n    },\n\n    get selectedAndPassingFiltersCount() {\n      return this.selectedFilteredRows.length\n    },\n\n    get sortedRows() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const parent = getParent<any>(self)\n      return [...self.rows].sort(parent.rowSortingComparisonFunction)\n    },\n\n    get selectedRows() {\n      return self.rows.filter(r => r.isSelected)\n    },\n\n    get selectedFilteredRows() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const sheet = getParent<any>(self)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const view = getParent<any>(sheet)\n      const { filterControls } = view\n      return this.selectedRows.filter(row =>\n        filterControls.rowPassesFilters(sheet, row),\n      )\n    },\n\n    // the set of all rows that pass the filters, sorted\n    get sortedFilteredRows() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const sheet = getParent<any>(self)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const view = getParent<any>(sheet)\n      const { filterControls } = view\n      return self.rows\n        .filter(row => filterControls.rowPassesFilters(sheet, row))\n        .sort(sheet.rowSortingComparisonFunction)\n    },\n  }))\n  .actions(self => ({\n    unselectAll() {\n      self.rows.forEach(row => row.unSelect())\n    },\n  }))\n\nexport default StaticRowModel\n","import { stringToJexlExpression } from '@jbrowse/core/util/jexlStrings'\nimport { getSession, getEnv } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\nimport {\n  addDisposer,\n  types,\n  getParent,\n  SnapshotIn,\n  Instance,\n} from 'mobx-state-tree'\n\n// locals\nimport { ColumnTypes, AnyColumnType } from './ColumnDataTypes'\nimport StaticRowSetModel from './StaticRowSet'\nimport RowModel from './Row'\n\ntype Row = Instance<typeof RowModel>\n\nconst ColumnDefinition = types\n  .model('ColumnDefinition', {\n    name: types.maybe(types.string),\n    dataType: types.optional(AnyColumnType, () => ({\n      type: 'Text',\n    })),\n    // set to true if column is derived from other columns\n    // if the column is derived, each cell will have a\n    // `derivationFunction` that is called to get its value\n    isDerived: false,\n    // if this cell is derived from other cells, execute this function to get\n    // the value\n    derivationFunctionText: types.maybe(types.string),\n  })\n  .views(self => ({\n    get expr() {\n      if (self.isDerived) {\n        // compile this as a jexl expression\n        return stringToJexlExpression(\n          String(self.derivationFunctionText),\n          getEnv(self).pluginManager.jexl,\n        )\n      }\n      return undefined\n    },\n  }))\n\ntype RowMenuPosition = { anchorEl: Element; rowNumber: string } | null\n\n/**\n * #stateModel SpreadsheetViewSpreadsheet\n * #category view\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Spreadsheet = types\n  .model('Spreadsheet', {\n    /**\n     * #property\n     */\n    rowSet: types.optional(StaticRowSetModel, () => StaticRowSetModel.create()),\n    /**\n     * #property\n     */\n    columns: types.array(ColumnDefinition),\n    /**\n     * #property\n     */\n    columnDisplayOrder: types.array(types.number),\n    /**\n     * #property\n     */\n    hasColumnNames: false,\n    /**\n     * #property\n     */\n    sortColumns: types.array(\n      types\n        .model('SortColumns', {\n          columnNumber: types.number,\n          descending: false,\n        })\n        .actions(self => ({\n          switchDirection() {\n            self.descending = !self.descending\n          },\n        })),\n    ),\n\n    assemblyName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    defaultDataType: ColumnTypes.Text,\n    rowMenuPosition: null as RowMenuPosition,\n    isLoaded: false,\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get initialized() {\n      const session = getSession(self)\n      const name = self.assemblyName\n      return name ? session.assemblyManager.get(name)?.initialized : false\n    },\n    /**\n     * #getter\n     */\n    get hideRowSelection() {\n      // just delegates to parent\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).hideRowSelection\n    },\n\n    /**\n     * #getter\n     * list of data type names to be made available in the column\n     * dropdown menu\n     */\n    get dataTypeChoices() {\n      const typeNames = Object.keys(ColumnTypes) as (keyof typeof ColumnTypes)[]\n      return typeNames.map(typeName => {\n        const dataType = ColumnTypes[typeName].create({ type: typeName })\n        const { displayName, categoryName } = dataType\n        return { typeName, displayName, categoryName }\n      })\n    },\n\n    /**\n     * #method\n     */\n    rowSortingComparisonFunction(rowA: Row, rowB: Row) {\n      for (const { columnNumber, descending } of self.sortColumns) {\n        const { dataType } = self.columns[columnNumber]\n        const result = dataType.compare(\n          rowA.cellsWithDerived[columnNumber],\n          rowB.cellsWithDerived[columnNumber],\n        )\n        if (result) {\n          return descending ? -result : result\n        }\n      }\n      return 0\n    },\n  }))\n  .actions(self => ({\n    afterAttach() {\n      addDisposer(\n        self,\n        autorun(async () => {\n          const session = getSession(self)\n          const { assemblyManager } = session\n          try {\n            if (self.assemblyName) {\n              await assemblyManager.waitForAssembly(self.assemblyName)\n              this.setLoaded(true)\n            }\n          } catch (error) {\n            session.notify(\n              `failed to load assembly ${self.assemblyName} ${error}`,\n              'error',\n            )\n          }\n        }),\n      )\n    },\n\n    /**\n     * #action\n     */\n    setLoaded(flag: boolean) {\n      self.isLoaded = flag\n    },\n\n    /**\n     * #action\n     */\n    setRowMenuPosition(newPosition: RowMenuPosition) {\n      self.rowMenuPosition = newPosition\n    },\n\n    /**\n     * #action\n     */\n    setSortColumns(newSort: NonNullable<SnapshotIn<typeof self.sortColumns>>) {\n      if (newSort) {\n        // @ts-expect-error\n        self.sortColumns = newSort\n      }\n    },\n\n    /**\n     * #action\n     */\n    setColumnType(columnNumber: number, newTypeName: string) {\n      self.columns[columnNumber].dataType = { type: newTypeName }\n    },\n\n    /**\n     * #action\n     */\n    unselectAll() {\n      return self.rowSet.unselectAll()\n    },\n  }))\n\nexport type SpreadsheetStateModel = typeof Spreadsheet\nexport type SpreadsheetModel = Instance<SpreadsheetStateModel>\n\nexport default Spreadsheet\n","import { types, getParent, Instance } from 'mobx-state-tree'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { getSession, getEnv } from '@jbrowse/core/util'\n\n// 30MB\nconst IMPORT_SIZE_LIMIT = 30_000_000\n\nconst fileTypes = ['CSV', 'TSV', 'VCF', 'BED', 'BEDPE', 'STAR-Fusion']\nconst fileTypeParsers = {\n  CSV: () =>\n    import('../importAdapters/ImportUtils').then(r => r.parseCsvBuffer),\n  TSV: () =>\n    import('../importAdapters/ImportUtils').then(r => r.parseTsvBuffer),\n  VCF: () => import('../importAdapters/VcfImport').then(r => r.parseVcfBuffer),\n  BED: () => import('../importAdapters/BedImport').then(r => r.parseBedBuffer),\n  BEDPE: () =>\n    import('../importAdapters/BedImport').then(r => r.parseBedPEBuffer),\n  'STAR-Fusion': () =>\n    import('../importAdapters/STARFusionImport').then(\n      r => r.parseSTARFusionBuffer,\n    ),\n}\n// regexp used to guess the type of a file or URL from its file extension\nconst fileTypesRegexp = new RegExp(`\\\\.(${fileTypes.join('|')})(\\\\.gz)?$`, 'i')\n\n/**\n * #stateModel SpreadsheetImportWizard\n * #category view\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ImportWizard = types\n  .model('SpreadsheetImportWizard', {\n    /**\n     * #property\n     */\n    fileType: types.optional(types.enumeration(fileTypes), 'CSV'),\n    /**\n     * #property\n     */\n    hasColumnNameLine: true,\n    /**\n     * #property\n     */\n    columnNameLineNumber: 1,\n    /**\n     * #property\n     */\n    selectedAssemblyName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    fileTypes,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    fileSource: undefined as any,\n    error: undefined as unknown,\n    loading: false,\n  }))\n  .views(self => ({\n    get isReadyToOpen() {\n      return (\n        !self.error &&\n        self.fileSource &&\n        (self.fileSource.blobId ||\n          self.fileSource.localPath ||\n          self.fileSource.uri)\n      )\n    },\n    get canCancel() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).readyToDisplay\n    },\n\n    get fileName() {\n      return (\n        self.fileSource.uri ||\n        self.fileSource.localPath ||\n        (self.fileSource.blobId && self.fileSource.name)\n      )\n    },\n\n    get requiresUnzip() {\n      return this.fileName.endsWith('gz')\n    },\n\n    isValidRefName(refName: string, assemblyName?: string) {\n      const { assemblyManager } = getSession(self)\n      if (!assemblyName) {\n        return false\n      }\n      return assemblyManager.isValidRefName(refName, assemblyName)\n    },\n  }))\n  .actions(self => ({\n    setSelectedAssemblyName(s: string) {\n      self.selectedAssemblyName = s\n    },\n    setFileSource(newSource: unknown) {\n      self.fileSource = newSource\n      self.error = undefined\n\n      if (self.fileSource) {\n        // try to autodetect the file type, ignore errors\n        const name = self.fileName\n\n        if (name) {\n          const firstMatch = fileTypesRegexp.exec(name)?.[1]\n          if (firstMatch) {\n            self.fileType =\n              firstMatch === 'tsv' && name.includes('star-fusion')\n                ? 'STAR-Fusion'\n                : firstMatch.toUpperCase()\n          }\n        }\n      }\n    },\n\n    toggleHasColumnNameLine() {\n      self.hasColumnNameLine = !self.hasColumnNameLine\n    },\n\n    setColumnNameLineNumber(newnumber: number) {\n      if (newnumber > 0) {\n        self.columnNameLineNumber = newnumber\n      }\n    },\n\n    setFileType(typeName: string) {\n      self.fileType = typeName\n    },\n\n    setError(error: unknown) {\n      console.error(error)\n      self.loading = false\n      self.error = error\n    },\n\n    setLoaded() {\n      self.loading = false\n      self.error = undefined\n    },\n\n    cancelButton() {\n      self.error = undefined\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      getParent<any>(self).setDisplayMode()\n    },\n\n    // fetch and parse the file, make a new Spreadsheet model for it,\n    // then set the parent to display it\n    async import(assemblyName: string) {\n      if (!self.fileSource) {\n        return\n      }\n\n      if (self.loading) {\n        throw new Error('Cannot import, load already in progress')\n      }\n\n      self.selectedAssemblyName = assemblyName\n      self.loading = true\n      const type = self.fileType as keyof typeof fileTypeParsers\n      const typeParser = await fileTypeParsers[type]()\n      if (!typeParser) {\n        throw new Error(`cannot open files of type '${self.fileType}'`)\n      }\n\n      const { unzip } = await import('@gmod/bgzf-filehandle')\n      const { pluginManager } = getEnv(self)\n      const filehandle = openLocation(self.fileSource, pluginManager)\n      try {\n        const stat = await filehandle.stat()\n        if (stat.size > IMPORT_SIZE_LIMIT) {\n          throw new Error(\n            `File is too big. Tabular files are limited to at most ${(\n              IMPORT_SIZE_LIMIT / 1000\n            ).toLocaleString()}kb.`,\n          )\n        }\n      } catch (e) {\n        // not required for stat to succeed to proceed, but it is helpful\n        console.warn(e)\n      }\n\n      try {\n        await filehandle\n          .readFile()\n          .then(buffer => (self.requiresUnzip ? unzip(buffer) : buffer))\n          .then(buffer => typeParser(buffer, self))\n          .then(spreadsheet => {\n            this.setLoaded()\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            getParent<any>(self).displaySpreadsheet(spreadsheet)\n          })\n      } catch (e) {\n        this.setError(e)\n      }\n    },\n  }))\n\nexport type ImportWizardStateModel = typeof ImportWizard\nexport type ImportWizardModel = Instance<ImportWizardStateModel>\n\nexport default ImportWizard\n","import { types, getParent, SnapshotIn } from 'mobx-state-tree'\nimport { AnyFilterModelType as AnyColumnFilter } from './ColumnDataTypes'\n\n// filter that finds a simple string in any of the cells of a row\nconst RowFullTextFilter = types\n  .model('RowFullTextFilter', {\n    type: types.literal('RowFullText'),\n    stringToFind: '',\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      let s = self.stringToFind // avoid closing over self\n      if (!s) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n      s = s.toLowerCase()\n      return function stringPredicate(\n        _sheet: unknown,\n        row: { cellsWithDerived: { text: string }[] },\n      ) {\n        const { cellsWithDerived } = row\n        for (const cell of cellsWithDerived) {\n          // note: case insensitive\n          if (cell.text?.toLowerCase().includes(s)) {\n            return true\n          }\n        }\n        return false\n      }\n    },\n  }))\n  .actions(self => ({\n    setString(s: string) {\n      self.stringToFind = s\n    },\n    clear() {\n      self.stringToFind = ''\n    },\n  }))\n\nconst model = types\n  .model('SpreadsheetFilterControls', {\n    rowFullText: types.optional(\n      RowFullTextFilter,\n      () =>\n        ({\n          type: 'RowFullText',\n          stringToFind: '',\n        }) as SnapshotIn<typeof RowFullTextFilter>,\n    ),\n    columnFilters: types.array(AnyColumnFilter),\n  })\n  .views(self => ({\n    get filters() {\n      return [self.rowFullText, ...self.columnFilters].filter(f => !!f)\n    },\n    setRowFullTextFilter(stringToFind: string) {\n      // @ts-expect-error\n      self.rowFullText = {\n        type: 'RowFullText',\n        stringToFind,\n      }\n    },\n    rowPassesFilters(sheet: unknown, row: unknown) {\n      for (const filter of this.filters) {\n        if (!filter.predicate(sheet, row)) {\n          return false\n        }\n      }\n      return true\n    },\n  }))\n  .actions(self => ({\n    addBlankColumnFilter(columnNumber: number) {\n      const { dataType } =\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self).spreadsheet.columns[columnNumber]\n      self.columnFilters.push({\n        type: dataType.type,\n        columnNumber,\n      })\n    },\n    removeColumnFilter(filter: typeof AnyColumnFilter) {\n      return self.columnFilters.remove(filter)\n    },\n    clearAllFilters() {\n      self.columnFilters.clear()\n      self.rowFullText.clear()\n    },\n  }))\n\nexport default model\n","import {\n  types,\n  getParent,\n  getEnv,\n  cast,\n  SnapshotIn,\n  Instance,\n} from 'mobx-state-tree'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\n\n// icons\nimport DoneIcon from '@mui/icons-material/Done'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\n\nimport SpreadsheetModel from './Spreadsheet'\nimport ImportWizardModel from './ImportWizard'\nimport FilterControlsModel from './FilterControls'\n\ntype Spreadsheet = Instance<typeof SpreadsheetModel>\n\nexport type MenuItemWithDisabledCallback = MenuItem & {\n  disabled?:\n    | boolean\n    | ((\n        viewModel: unknown,\n        spreadsheetModel: Spreadsheet,\n        rowNumber: number,\n        row: Spreadsheet['rowSet']['rows'][0],\n      ) => boolean)\n}\n\nconst defaultRowMenuItems: MenuItemWithDisabledCallback[] = [\n  {\n    label: 'Toggle select',\n    icon: DoneIcon,\n    onClick(_view: unknown, spreadsheet: Spreadsheet) {\n      const rowNumber = spreadsheet.rowMenuPosition?.rowNumber\n      if (rowNumber !== undefined) {\n        spreadsheet.rowSet.rows[+rowNumber - 1].toggleSelect()\n      }\n    },\n  },\n]\n\nconst minHeight = 40\nconst defaultHeight = 440\n\n/**\n * #stateModel SpreadsheetView\n * #category view\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst model = types\n  .model('SpreadsheetView', {\n    /**\n     * #property\n     */\n    type: types.literal('SpreadsheetView'),\n    /**\n     * #property\n     */\n    offsetPx: 0,\n    /**\n     * #property\n     */\n    height: types.optional(\n      types.refinement(\n        'SpreadsheetViewHeight',\n        types.number,\n        n => n >= minHeight,\n      ),\n      defaultHeight,\n    ),\n    /**\n     * #property\n     */\n    hideVerticalResizeHandle: false,\n    /**\n     * #property\n     */\n    hideFilterControls: false,\n    /**\n     * #property\n     */\n    filterControls: types.optional(FilterControlsModel, () =>\n      FilterControlsModel.create({}),\n    ),\n    /**\n     * #property\n     * switch specifying whether we are showing the import wizard or the\n     * spreadsheet in our viewing area\n     */\n    mode: types.optional(\n      types.enumeration('SpreadsheetViewMode', ['import', 'display']),\n      'import',\n    ),\n    /**\n     * #property\n     */\n    importWizard: types.optional(ImportWizardModel, () =>\n      ImportWizardModel.create(),\n    ),\n    /**\n     * #property\n     */\n    spreadsheet: types.maybe(SpreadsheetModel),\n  })\n  .volatile(() => ({\n    width: 400,\n    rowMenuItems: defaultRowMenuItems,\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get readyToDisplay() {\n      return !!self.spreadsheet && self.spreadsheet.isLoaded\n    },\n    /**\n     * #getter\n     */\n    get hideRowSelection() {\n      return !!getEnv(self).hideRowSelection\n    },\n    /**\n     * #getter\n     */\n    get outputRows() {\n      if (self.spreadsheet && self.spreadsheet.rowSet.isLoaded) {\n        const selected = self.spreadsheet.rowSet.selectedFilteredRows\n        if (selected.length) {\n          return selected\n        }\n        return self.spreadsheet.rowSet.sortedFilteredRows\n      }\n      return undefined\n    },\n    /**\n     * #getter\n     */\n    get assembly() {\n      const name = self.spreadsheet?.assemblyName\n      if (name) {\n        const assemblies = getSession(self).assemblies\n        return assemblies?.find(asm => readConfObject(asm, 'name') === name)\n      }\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setRowMenuItems(newItems: MenuItem[]) {\n      self.rowMenuItems = newItems\n    },\n    /**\n     * #action\n     */\n    setWidth(newWidth: number) {\n      self.width = newWidth\n      return self.width\n    },\n    /**\n     * #action\n     */\n    setHeight(newHeight: number) {\n      self.height = newHeight > minHeight ? newHeight : minHeight\n      return self.height\n    },\n    /**\n     * #action\n     */\n    resizeHeight(distance: number) {\n      const oldHeight = self.height\n      const newHeight = this.setHeight(self.height + distance)\n      return newHeight - oldHeight\n    },\n    /**\n     * #action\n     */\n    resizeWidth(distance: number) {\n      const oldWidth = self.width\n      const newWidth = this.setWidth(self.width + distance)\n      return newWidth - oldWidth\n    },\n\n    /**\n     * #action\n     * load a new spreadsheet and set our mode to display it\n     */\n    displaySpreadsheet(spreadsheet: SnapshotIn<typeof SpreadsheetModel>) {\n      self.filterControls.clearAllFilters()\n      self.spreadsheet = cast(spreadsheet)\n      self.mode = 'display'\n    },\n    /**\n     * #action\n     */\n    setImportMode() {\n      self.mode = 'import'\n    },\n    /**\n     * #action\n     */\n    setDisplayMode() {\n      if (self.readyToDisplay) {\n        self.mode = 'display'\n      }\n    },\n    /**\n     * #action\n     */\n    closeView() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      getParent<any>(self, 2).removeView(self)\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     */\n    menuItems() {\n      return [\n        {\n          label: 'Return to import form',\n          onClick: () => self.setImportMode(),\n          icon: FolderOpenIcon,\n        },\n      ]\n    },\n  }))\n\nconst SpreadsheetView = types.compose(BaseViewModel, model)\n\nexport type SpreadsheetViewStateModel = typeof SpreadsheetView\nexport type SpreadsheetViewModel = Instance<SpreadsheetViewStateModel>\n\nexport default SpreadsheetView\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\n\n// icons\nimport ViewComfyIcon from '@mui/icons-material/ViewComfy'\n\n// locals\nimport SpreadsheetViewF from './SpreadsheetView'\n\nimport LaunchSpreadsheetViewF from './LaunchSpreadsheetView'\n\nexport default class SpreadsheetViewPlugin extends Plugin {\n  name = 'SpreadsheetViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    SpreadsheetViewF(pluginManager)\n    LaunchSpreadsheetViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    const { rootModel } = pluginManager\n    if (isAbstractMenuManager(rootModel)) {\n      rootModel.appendToSubMenu(['Add'], {\n        label: 'Spreadsheet view',\n        icon: ViewComfyIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SpreadsheetView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  type SpreadsheetViewModel,\n  type SpreadsheetViewStateModel,\n} from './SpreadsheetView'\n","import { lazy } from 'react'\nimport { ViewType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport stateModel from './models/SpreadsheetView'\n\nexport default function SpreadsheetViewF(pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'SpreadsheetView',\n      displayName: 'Spreadsheet view',\n      stateModel,\n      ReactComponent: lazy(() => import('./components/SpreadsheetView')),\n    })\n  })\n}\n\nexport {\n  type SpreadsheetViewModel,\n  type SpreadsheetViewStateModel,\n} from './models/SpreadsheetView'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { SpreadsheetViewModel } from '../SpreadsheetView'\n\nexport default function LaunchSpreadsheetViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-SpreadsheetView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      uri,\n      fileType,\n    }: {\n      session: AbstractSessionModel\n      assembly: string\n      uri: string\n      fileType?: string\n    }) => {\n      const view = session.addView('SpreadsheetView') as SpreadsheetViewModel\n\n      if (!view) {\n        throw new Error('Failed to initialize view')\n      }\n      const exts = uri.split('.')\n      let ext = exts?.pop()?.toUpperCase()\n      if (ext === 'GZ') {\n        ext = exts?.pop()?.toUpperCase()\n      }\n\n      view.importWizard.setFileType(fileType || ext || '')\n      view.importWizard.setSelectedAssemblyName(assembly)\n      view.importWizard.setFileSource({\n        uri,\n        locationType: 'UriLocation',\n      })\n      await view.importWizard.import(assembly)\n    },\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Grid, FormControlLabel, Checkbox } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\n// locals\nimport { SvInspectorViewModel } from '../models/SvInspectorView'\n\nconst useStyles = makeStyles()(theme => ({\n  circularViewOptions: {\n    padding: theme.spacing(1),\n  },\n}))\n\nconst CircularViewOptions = observer(function ({\n  svInspector,\n}: {\n  svInspector: SvInspectorViewModel\n}) {\n  const { classes } = useStyles()\n\n  return (\n    <Grid\n      container\n      className={classes.circularViewOptions}\n      style={{ height: svInspector.circularViewOptionsBarHeight }}\n    >\n      <Grid item>\n        <FormControlLabel\n          control={\n            <Checkbox\n              checked={svInspector.onlyDisplayRelevantRegionsInCircularView}\n              onChange={e =>\n                svInspector.setOnlyDisplayRelevantRegionsInCircularView(\n                  e.target.checked,\n                )\n              }\n            />\n          }\n          label=\"show only regions with data\"\n        />\n      </Grid>\n    </Grid>\n  )\n})\n\nexport default CircularViewOptions\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { ResizeHandle } from '@jbrowse/core/ui'\n\n// locals\nimport { SvInspectorViewModel } from '../models/SvInspectorView'\nimport CircularViewOptions from './CircularViewOptions'\n\nconst useStyles = makeStyles()(theme => ({\n  resizeHandleVert: {\n    background: theme.palette.action.selected,\n    width: 4,\n    boxSizing: 'border-box',\n    borderTop: '1px solid #fafafa',\n  },\n  resizeHandleHoriz: {\n    background: theme.palette.action.selected,\n    height: 4,\n    boxSizing: 'border-box',\n    borderTop: '1px solid #fafafa',\n  },\n  viewControls: {\n    margin: 0,\n  },\n  viewsContainer: {\n    display: 'flex',\n  },\n  container: {\n    overflow: 'hidden',\n  },\n}))\n\nconst SvInspectorView = observer(function ({\n  model,\n}: {\n  model: SvInspectorViewModel\n}) {\n  const { classes } = useStyles()\n\n  const {\n    SpreadsheetViewReactComponent,\n    CircularViewReactComponent,\n    showCircularView,\n  } = model\n\n  return (\n    <div className={classes.container}>\n      <div className={classes.viewsContainer}>\n        <div\n          style={{ width: model.spreadsheetView.width }}\n          className={classes.container}\n        >\n          <SpreadsheetViewReactComponent model={model.spreadsheetView} />\n        </div>\n\n        {showCircularView ? (\n          <>\n            <ResizeHandle\n              onDrag={distance => {\n                const ret1 = model.circularView.resizeWidth(-distance)\n                return model.spreadsheetView.resizeWidth(-ret1)\n              }}\n              vertical\n              flexbox\n              className={classes.resizeHandleVert}\n            />\n            <div style={{ width: model.circularView.width }}>\n              <CircularViewOptions svInspector={model} />\n              <CircularViewReactComponent model={model.circularView} />\n            </div>\n          </>\n        ) : null}\n      </div>\n      <ResizeHandle\n        onDrag={model.resizeHeight}\n        className={classes.resizeHandleHoriz}\n      />\n    </div>\n  )\n})\n\nexport default SvInspectorView\n","// this file contains the rather verbose functions for\n// creating features from CSV/TSV lines\nimport { parseLocString } from '@jbrowse/core/util'\n\nexport function makeAdHocFeature(\n  columns,\n  columnsAlreadyUsedInLocations,\n  row,\n  loc1,\n  loc2,\n  rowNumber,\n) {\n  // load all the other data in the row into an `otherData` object\n  const otherData = {}\n  columns.forEach((column, columnNumber) => {\n    if (columnsAlreadyUsedInLocations.includes(columnNumber)) {\n      return\n    }\n    let { text } = row.cells[columnNumber]\n    if (column.dataType.type === 'Number') {\n      text = parseFloat(text)\n    }\n    otherData[column.name] = text\n  })\n\n  // make the final feature data out of otherData + the parsed locations\n  return {\n    ...otherData,\n    uniqueId: `sv-inspector-adhoc-${rowNumber}`,\n    refName: loc1.refName,\n    start: loc1.start,\n    end: loc1.end,\n    mate: {\n      refName: loc2.refName,\n      start: loc2.start,\n      end: loc2.end,\n    },\n  }\n}\n\nexport function makeAdHocSvFeatureFromTwoLocations(\n  columns,\n  locationColumnNumbers,\n  row,\n  rowNumber,\n  isValidRefName,\n) {\n  // use the first two locations we found (first according to *displayed* order)\n  const loc1 = parseLocString(\n    row.cells[locationColumnNumbers[0]].text,\n    isValidRefName,\n  )\n  const loc2 = parseLocString(\n    row.cells[locationColumnNumbers[1]].text,\n    isValidRefName,\n  )\n\n  const columnsAlreadyUsedInLocations = [\n    locationColumnNumbers[0],\n    locationColumnNumbers[1],\n  ]\n\n  return makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  )\n}\n\nexport function makeAdHocSvFeatureFromTwoRefStartEndSets(\n  columns,\n  locRefColumnNumbers,\n  locStartColumnNumbers,\n  locEndColumnNumbers,\n  row,\n  rowNumber,\n) {\n  const textOf = colno => row.cells[colno].text\n  const loc1 = {\n    refName: textOf(locRefColumnNumbers[0]),\n    start: parseInt(textOf(locStartColumnNumbers[0]), 10) - 1,\n    end: parseInt(textOf(locEndColumnNumbers[0]), 10),\n  }\n  const loc2 = {\n    refName: textOf(locRefColumnNumbers[1]),\n    start: parseInt(textOf(locStartColumnNumbers[1]), 10) - 1,\n    end: parseInt(textOf(locEndColumnNumbers[1]), 10),\n  }\n  const columnsAlreadyUsedInLocations = [\n    locRefColumnNumbers[0],\n    locStartColumnNumbers[0],\n    locEndColumnNumbers[0],\n    locRefColumnNumbers[1],\n    locStartColumnNumbers[1],\n    locEndColumnNumbers[1],\n  ]\n  return makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  )\n}\n\n// makes a feature data object (passed as `data` to a SimpleFeature constructor)\n// out of table row if the row has 2 location columns. undefined if not\nexport function makeAdHocSvFeature(sheet, rowNumber, row, isValidRefName) {\n  const { columns, columnDisplayOrder } = sheet\n  const columnTypes = {}\n  columnDisplayOrder.forEach(columnNumber => {\n    const columnDefinition = columns[columnNumber]\n    if (!columnTypes[columnDefinition.dataType.type]) {\n      columnTypes[columnDefinition.dataType.type] = []\n    }\n    columnTypes[columnDefinition.dataType.type].push(columnNumber)\n  })\n  const locationColumnNumbers = columnTypes.LocString || []\n  const locStartColumnNumbers = columnTypes.LocStart || []\n  const locEndColumnNumbers = columnTypes.LocEnd || []\n  const locRefColumnNumbers = columnTypes.LocRef || []\n\n  // if we have 2 or more columns of type location, make a feature from them\n  if (locationColumnNumbers.length >= 2) {\n    return makeAdHocSvFeatureFromTwoLocations(\n      columns,\n      locationColumnNumbers,\n      row,\n      rowNumber,\n      isValidRefName,\n    )\n  }\n  if (\n    locRefColumnNumbers.length >= 2 &&\n    locStartColumnNumbers.length >= 2 &&\n    locEndColumnNumbers.length >= 2\n  ) {\n    return makeAdHocSvFeatureFromTwoRefStartEndSets(\n      columns,\n      locRefColumnNumbers,\n      locStartColumnNumbers,\n      locEndColumnNumbers,\n      row,\n      rowNumber,\n    )\n  }\n  return undefined\n}\n","import { SimpleFeature, getEnv, getSession } from '@jbrowse/core/util'\nimport { makeAdHocSvFeature } from './adhocFeatureUtils'\n\nexport function getFeatureForRow(session, spreadsheetView, row, rowNumber) {\n  return (\n    row.extendedData?.vcfFeature ||\n    row.extendedData?.feature ||\n    makeAdHocSvFeature(\n      spreadsheetView.spreadsheet,\n      rowNumber,\n      row,\n      session.assemblyManager.isValidRefName,\n    )\n  )\n}\n\nexport function breakpointSplitViewSnapshotFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  const { pluginManager } = getEnv(svInspectorView)\n  const session = getSession(spreadsheetView)\n  const featureData = getFeatureForRow(session, spreadsheet, row, rowNumber)\n\n  if (featureData) {\n    const feature = new SimpleFeature(featureData)\n    session.setSelection(feature)\n    return pluginManager\n      .getViewType('BreakpointSplitView')\n      .snapshotFromBreakendFeature(feature, svInspectorView.circularView)\n  }\n  return undefined\n}\n\nexport function openBreakpointSplitViewFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  )\n  if (viewSnapshot) {\n    // try to center the offsetPx\n    const { circularView } = svInspectorView\n    viewSnapshot.views[0].offsetPx -= circularView.width / 2 + 100\n    viewSnapshot.views[1].offsetPx -= circularView.width / 2 + 100\n\n    const session = getSession(spreadsheetView)\n    session.addView('BreakpointSplitView', viewSnapshot)\n  }\n}\n\nexport function canOpenBreakpointSplitViewFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  try {\n    return Boolean(\n      breakpointSplitViewSnapshotFromTableRow(\n        svInspectorView,\n        spreadsheetView,\n        spreadsheet,\n        row,\n        rowNumber,\n      ),\n    )\n  } catch (e) {\n    console.error('Unable to open breakpoint split view from table row', e)\n    return false\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport ReactComponent from './components/SvInspectorView'\nimport stateModelFactory from './models/SvInspectorView'\nimport { Feature, getContainingView, getSession } from '@jbrowse/core/util'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport BreakpointSplitViewType from '@jbrowse/plugin-breakpoint-split-view/src/BreakpointSplitView/BreakpointSplitView'\nimport { CircularViewModel } from '@jbrowse/plugin-circular-view'\n\nfunction defaultOnChordClick(\n  feature: Feature,\n  chordTrack: IAnyStateTreeNode,\n  pluginManager: PluginManager,\n) {\n  const session = getSession(chordTrack)\n  session.setSelection(feature)\n  const view = getContainingView(chordTrack) as CircularViewModel\n  const viewType = pluginManager.getViewType(\n    'BreakpointSplitView',\n  ) as BreakpointSplitViewType\n  const viewSnapshot = viewType.snapshotFromBreakendFeature(feature, view)\n\n  // try to center the offsetPx\n  viewSnapshot.views[0].offsetPx -= view.width / 2 + 100\n  viewSnapshot.views[1].offsetPx -= view.width / 2 + 100\n  viewSnapshot.featureData = feature.toJSON()\n\n  session.addView('BreakpointSplitView', viewSnapshot)\n}\n\nexport default function SvInspectorViewF(pluginManager: PluginManager) {\n  pluginManager.jexl.addFunction('defaultOnChordClick', defaultOnChordClick)\n\n  pluginManager.addViewType(() => {\n    const stateModel = stateModelFactory(pluginManager)\n    return new ViewType({\n      name: 'SvInspectorView',\n      displayName: 'SV inspector',\n      stateModel,\n      ReactComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  AbstractSessionModel,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util/types'\n\n// icons\nimport TableChartIcon from '@mui/icons-material/TableChart'\n\n// locals\nimport SvInspectorViewF from './SvInspectorView'\nimport LaunchSvInspectorViewF from './LaunchSvInspectorView'\n\nexport default class SvInspectorViewPlugin extends Plugin {\n  name = 'SvInspectorViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    SvInspectorViewF(pluginManager)\n    LaunchSvInspectorViewF(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'SV inspector',\n        icon: TableChartIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SvInspectorView', {})\n        },\n      })\n    }\n  }\n}\n","import clone from 'clone'\nimport { autorun, reaction } from 'mobx'\nimport { types, getParent, addDisposer, Instance } from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSession, Region } from '@jbrowse/core/util'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { SpreadsheetViewStateModel } from '@jbrowse/plugin-spreadsheet-view'\nimport { CircularViewStateModel } from '@jbrowse/plugin-circular-view'\n\n// icons\nimport OpenInNewIcon from '@mui/icons-material/OpenInNew'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\n\n// locals\nimport {\n  canOpenBreakpointSplitViewFromTableRow,\n  openBreakpointSplitViewFromTableRow,\n  getFeatureForRow,\n} from './breakpointSplitViewFromTableRow'\n\n/**\n * #stateModel SvInspectorView\n * #category view\n * does not extend, but is a combination of a\n * - [SpreadsheetView](../spreadsheetview)\n * - [CircularView](../circularview)\n *\n * extends\n * - [BaseViewModel](../baseviewmodel)\n */\nfunction SvInspectorViewF(pluginManager: PluginManager) {\n  const SpreadsheetViewType = pluginManager.getViewType('SpreadsheetView')\n  const CircularViewType = pluginManager.getViewType('CircularView')\n\n  const SpreadsheetModel =\n    SpreadsheetViewType.stateModel as SpreadsheetViewStateModel\n  const CircularModel = CircularViewType.stateModel as CircularViewStateModel\n\n  const minHeight = 400\n  const defaultHeight = 550\n  const headerHeight = 52\n  const circularViewOptionsBarHeight = 52\n  return types\n    .compose(\n      'SvInspectorView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('SvInspectorView'),\n\n        /**\n         * #property\n         */\n        height: types.optional(\n          types.refinement(\n            'SvInspectorViewHeight',\n            types.number,\n            n => n >= minHeight,\n          ),\n          defaultHeight,\n        ),\n        /**\n         * #property\n         */\n        onlyDisplayRelevantRegionsInCircularView: false,\n        /**\n         * #property\n         * switch specifying whether we are showing the import wizard or the\n         * spreadsheet in our viewing area\n         */\n        mode: types.optional(\n          types.enumeration('SvInspectorViewMode', ['import', 'display']),\n          'import',\n        ),\n        /**\n         * #property\n         */\n        spreadsheetView: types.optional(SpreadsheetModel, () =>\n          SpreadsheetModel.create({\n            type: 'SpreadsheetView',\n            hideVerticalResizeHandle: true,\n          }),\n        ),\n        /**\n         * #property\n         */\n        circularView: types.optional(CircularModel, () =>\n          CircularModel.create({\n            type: 'CircularView',\n            hideVerticalResizeHandle: true,\n            hideTrackSelectorButton: true,\n            disableImportForm: true,\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get selectedRows() {\n        // @ts-expect-error\n        return self.spreadsheetView.rowSet.selectedRows\n      },\n      /**\n       * #getter\n       */\n      get assemblyName() {\n        const { assembly } = self.spreadsheetView\n        return assembly ? readConfObject(assembly, 'name') : undefined\n      },\n      /**\n       * #getter\n       */\n      get showCircularView() {\n        return self.spreadsheetView.mode === 'display'\n      },\n\n      /**\n       * #getter\n       */\n      get features() {\n        const session = getSession(self)\n        const { spreadsheetView } = self\n        const { outputRows = [] } = spreadsheetView\n        return outputRows\n          .map((r, i) => getFeatureForRow(session, spreadsheetView, r, i))\n          .filter(f => !!f)\n      },\n      /**\n       * #getter\n       */\n      get featuresAdapterConfigSnapshot() {\n        return {\n          type: 'FromConfigAdapter',\n          features: this.features,\n        }\n      },\n      /**\n       * #getter\n       */\n      get featureRefNames() {\n        const refs = this.features.map(r => r.refName)\n        const CHR2 = this.features.flatMap(r => r.INFO?.CHR2).filter(f => !!f)\n        return [...refs, ...CHR2]\n      },\n      /**\n       * #getter\n       */\n      get featuresCircularTrackConfiguration() {\n        return {\n          type: 'VariantTrack',\n          trackId: `sv-inspector-variant-track-${self.id}`,\n          name: 'features from tabular data',\n          adapter: this.featuresAdapterConfigSnapshot,\n          assemblyNames: [this.assemblyName],\n          displays: [\n            {\n              type: 'ChordVariantDisplay',\n              displayId: `sv-inspector-variant-track-chord-display-${self.id}`,\n              onChordClick: `jexl:defaultOnChordClick(feature, track, pluginManager)`,\n              renderer: { type: 'StructuralVariantChordRenderer' },\n            },\n          ],\n        }\n      },\n    }))\n    .volatile(() => ({\n      SpreadsheetViewReactComponent: SpreadsheetViewType.ReactComponent,\n      CircularViewReactComponent: CircularViewType.ReactComponent,\n      circularViewOptionsBarHeight,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.width = newWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = newHeight > minHeight ? newHeight : minHeight\n        return self.height\n      },\n      /**\n       * #action\n       */\n      setImportMode() {\n        self.spreadsheetView.setImportMode()\n      },\n      /**\n       * #action\n       */\n      setDisplayMode() {\n        self.spreadsheetView.setDisplayMode()\n      },\n      /**\n       * #action\n       */\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n      /**\n       * #action\n       */\n      setDisplayedRegions(regions: Region[]) {\n        self.circularView.setDisplayedRegions(regions)\n      },\n      /**\n       * #action\n       */\n      setOnlyDisplayRelevantRegionsInCircularView(val: boolean) {\n        self.onlyDisplayRelevantRegionsInCircularView = Boolean(val)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems() {\n        return [\n          {\n            label: 'Return to import form',\n            onClick: () => self.setImportMode(),\n            icon: FolderOpenIcon,\n          },\n        ]\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = self.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n      afterAttach() {\n        // synchronize subview widths\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const borderWidth = 1\n              if (self.showCircularView) {\n                const spreadsheetWidth = Math.round(self.width * 0.66)\n                const circularViewWidth = self.width - spreadsheetWidth\n                self.spreadsheetView.setWidth(spreadsheetWidth - borderWidth)\n                self.circularView.setWidth(circularViewWidth)\n              } else {\n                self.spreadsheetView.setWidth(self.width)\n              }\n            },\n            { name: 'SvInspectorView width binding' },\n          ),\n        )\n        // synchronize subview heights\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              self.spreadsheetView.setHeight(self.height - headerHeight)\n              self.circularView.setHeight(\n                self.height - headerHeight - circularViewOptionsBarHeight,\n              )\n            },\n            { name: 'SvInspectorView height binding' },\n          ),\n        )\n\n        // bind circularview displayedRegions to spreadsheet assembly, mediated\n        // by the onlyRelevantRegions toggle\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              const {\n                assemblyName,\n                onlyDisplayRelevantRegionsInCircularView,\n                circularView,\n                featureRefNames,\n              } = self\n              const { tracks } = circularView\n              const { assemblyManager } = getSession(self)\n              if (!assemblyName) {\n                return\n              }\n              const asm = await assemblyManager.waitForAssembly(assemblyName)\n              if (!asm) {\n                return\n              }\n\n              const { getCanonicalRefName, regions = [] } = asm\n              if (onlyDisplayRelevantRegionsInCircularView) {\n                if (tracks.length === 1) {\n                  try {\n                    // canonicalize the store's ref names if necessary\n                    const refSet = new Set(\n                      featureRefNames.map(r => getCanonicalRefName(r) || r),\n                    )\n\n                    circularView.setDisplayedRegions(\n                      clone(regions.filter(r => refSet.has(r.refName))),\n                    )\n                  } catch (e) {\n                    circularView.setError(e)\n                  }\n                }\n              } else {\n                circularView.setDisplayedRegions(regions)\n              }\n            },\n            { name: 'SvInspectorView displayed regions bind' },\n          ),\n        )\n\n        // bind circularview tracks to our track snapshot view\n        addDisposer(\n          self,\n          reaction(\n            () => ({\n              generatedTrackConf: self?.featuresCircularTrackConfiguration,\n              assemblyName: self?.assemblyName,\n            }),\n            data => {\n              if (!data) {\n                return\n              }\n              const { assemblyName, generatedTrackConf } = data\n              const { circularView } = self\n              // hide any visible tracks\n              circularView.tracks.forEach(t =>\n                circularView.hideTrack(t.configuration.trackId),\n              )\n\n              // put our track in as the only track\n              if (assemblyName && generatedTrackConf) {\n                // @ts-expect-error\n                circularView.addTrackConf(generatedTrackConf, {\n                  assemblyName,\n                })\n              }\n            },\n            {\n              name: 'SvInspectorView track configuration binding',\n              fireImmediately: true,\n            },\n          ),\n        )\n\n        // bind spreadsheetView row menu actions to us\n        addDisposer(\n          self,\n          autorun(() => {\n            self.spreadsheetView.setRowMenuItems(\n              // these are the MenuItem entries for the row menu actions in the\n              // spreadsheet view.  these are installed into the child\n              // SpreadsheetView using an autorun below\n              [\n                {\n                  label: 'Open split detail view',\n                  icon: OpenInNewIcon,\n                  // @ts-expect-error\n                  disabled(spreadsheetView, spreadsheet, rowNumber, row) {\n                    return !canOpenBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n\n                  // @ts-expect-error\n                  onClick(spreadsheetView, spreadsheet, rowNumber, row) {\n                    openBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                },\n              ],\n            )\n          }),\n        )\n      },\n    }))\n}\n\nexport type SvInspectorViewStateModel = ReturnType<typeof SvInspectorViewF>\nexport type SvInspectorViewModel = Instance<SvInspectorViewStateModel>\n\nexport default SvInspectorViewF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { SvInspectorViewModel } from '../SvInspectorView/models/SvInspectorView'\n\nexport default function LaunchSvInspectorViewF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-SvInspectorView',\n    // @ts-expect-error\n    async ({\n      session,\n      assembly,\n      uri,\n      fileType,\n    }: {\n      session: AbstractSessionModel\n      assembly: string\n      uri: string\n      fileType?: string\n    }) => {\n      // add view, make typescript happy with return type\n      const view = session.addView('SvInspectorView') as SvInspectorViewModel\n\n      if (!view) {\n        throw new Error('Failed to initialize view')\n      }\n      const exts = uri.split('.')\n      let ext = exts?.pop()?.toUpperCase()\n      if (ext === 'GZ') {\n        ext = exts?.pop()?.toUpperCase()\n      }\n\n      view.spreadsheetView.importWizard.setFileType(fileType || ext || '')\n      view.spreadsheetView.importWizard.setSelectedAssemblyName(assembly)\n      view.spreadsheetView.importWizard.setFileSource({\n        uri,\n        locationType: 'UriLocation',\n      })\n      await view.spreadsheetView.importWizard.import(assembly)\n    },\n  )\n}\n","import React from 'react'\nimport { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nconst HicRendering = observer(function HicRendering(props: {\n  blockKey: string\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n}) {\n  const { width, height } = props\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div style={{ position: 'relative', width: canvasWidth, height }}>\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n    </div>\n  )\n})\n\nexport default HicRendering\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HicRenderer\n * #category renderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicRenderer = ConfigurationSchema(\n  'HicRenderer',\n  {\n    /**\n     * #slot\n     */\n    baseColor: {\n      type: 'color',\n      description: 'base color to be used in the hic alignment',\n      defaultValue: '#f00',\n    },\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a hic alignment',\n      defaultValue: `jexl:interpolate(count,scale)`,\n      contextVariable: ['count', 'maxScore', 'baseColor', 'scale'],\n    },\n\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a hic rendering',\n      defaultValue: 600,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HicRenderer\n","import ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport { Region } from '@jbrowse/core/util/types'\nimport { abortBreakPoint } from '@jbrowse/core/util'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { toArray } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { colord } from '@jbrowse/core/util/colord'\nimport { firstValueFrom } from 'rxjs'\nimport { scaleSequential, scaleSequentialLog } from 'd3-scale'\nimport { interpolateViridis } from 'd3-scale-chromatic'\nimport { interpolateRgbBasis } from 'd3-interpolate'\n\ninterface HicFeature {\n  bin1: number\n  bin2: number\n  counts: number\n}\n\ninterface HicDataAdapter extends BaseFeatureDataAdapter {\n  getResolution: (bp: number) => Promise<number>\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  regions: Region[]\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  regions: Region[]\n  dataAdapter: HicDataAdapter\n  bpPerPx: number\n  highResolutionScaling: number\n  resolution: number\n  adapterConfig: AnyConfigurationModel\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: HicFeature[]\n}\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport type ResultsDeserialized = ServerSideResultsDeserialized\n\nexport default class HicRenderer extends ServerSideRendererType {\n  supportsSVG = true\n\n  async makeImageData(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      config,\n      bpPerPx,\n      signal,\n      resolution,\n      sessionId,\n      adapterConfig,\n      useLogScale,\n      colorScheme,\n      regions,\n    } = props\n    const [region] = regions\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const res = await (dataAdapter as HicDataAdapter).getResolution(\n      bpPerPx / resolution,\n    )\n\n    const width = (region.end - region.start) / bpPerPx\n    const w = res / (bpPerPx * Math.sqrt(2))\n    const baseColor = colord(readConfObject(config, 'baseColor'))\n    const offset = Math.floor(region.start / res)\n    if (features.length) {\n      let maxScore = 0\n      let minBin = 0\n      let maxBin = 0\n      await abortBreakPoint(signal)\n      for (const { bin1, bin2, counts } of features) {\n        maxScore = Math.max(counts, maxScore)\n        minBin = Math.min(Math.min(bin1, bin2), minBin)\n        maxBin = Math.max(Math.max(bin1, bin2), maxBin)\n      }\n      await abortBreakPoint(signal)\n      const colorSchemes = {\n        juicebox: ['rgba(0,0,0,0)', 'red'],\n        fall: interpolateRgbBasis([\n          'rgb(255, 255, 255)',\n          'rgb(255, 255, 204)',\n          'rgb(255, 237, 160)',\n          'rgb(254, 217, 118)',\n          'rgb(254, 178, 76)',\n          'rgb(253, 141, 60)',\n          'rgb(252, 78, 42)',\n          'rgb(227, 26, 28)',\n          'rgb(189, 0, 38)',\n          'rgb(128, 0, 38)',\n          'rgb(0, 0, 0)',\n        ]),\n        viridis: interpolateViridis,\n      }\n      const m = useLogScale ? maxScore : maxScore / 20\n\n      // @ts-expect-error\n      const x1 = colorSchemes[colorScheme] || colorSchemes.juicebox\n      const scale = useLogScale\n        ? scaleSequentialLog(x1).domain([1, m])\n        : scaleSequential(x1).domain([0, m])\n      ctx.save()\n\n      if (region.reversed === true) {\n        ctx.scale(-1, 1)\n        ctx.translate(-width, 0)\n      }\n      ctx.rotate(-Math.PI / 4)\n      let start = Date.now()\n      for (const { bin1, bin2, counts } of features) {\n        ctx.fillStyle = readConfObject(config, 'color', {\n          count: counts,\n          maxScore,\n          baseColor,\n          scale,\n          useLogScale,\n        })\n        ctx.fillRect((bin1 - offset) * w, (bin2 - offset) * w, w, w)\n        if (+Date.now() - start > 400) {\n          await abortBreakPoint(signal)\n          start = +Date.now()\n        }\n      }\n      ctx.restore()\n    }\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const { config, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    const height = readConfObject(config, 'maxHeight')\n    const features = await this.getFeatures(renderProps)\n\n    const res = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      this.makeImageData(ctx, {\n        ...renderProps,\n        features,\n      }),\n    )\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      region: renderProps.regions[0],\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      height,\n      width,\n    }\n  }\n\n  async getFeatures(args: RenderArgsDeserialized) {\n    const { regions, sessionId, adapterConfig } = args\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const features = await firstValueFrom(\n      (dataAdapter as BaseFeatureDataAdapter)\n        .getFeatures(regions[0], args)\n        .pipe(toArray()),\n    )\n    // cast to any to avoid return-type conflict, because the\n    // types of features returned by our getFeatures are quite\n    // different from the base interface\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return features as any\n  }\n}\n\nexport {\n  type RenderArgsSerialized,\n  type RenderResults,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types, getEnv } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\n\n/**\n * #stateModel LinearHicDisplay\n * #category display\n * extends `BaseLinearDisplay`\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function stateModelFactory(\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearHicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearHicDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        resolution: types.optional(types.number, 1),\n        /**\n         * #property\n         */\n        useLogScale: false,\n        /**\n         * #property\n         */\n        colorScheme: types.maybe(types.string),\n      }),\n    )\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #getter\n         */\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return 'HicRenderer'\n        },\n        /**\n         * #method\n         */\n        renderProps() {\n          const config = self.rendererType.configSchema.create(\n            {\n              ...getConf(self, 'renderer'),\n\n              // add specific jexl color callback when using pre-defined color schemes\n              ...(self.colorScheme\n                ? { color: 'jexl:interpolate(count,scale)' }\n                : {}),\n            },\n            getEnv(self),\n          )\n\n          return {\n            ...superRenderProps(),\n            config,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            resolution: self.resolution,\n            useLogScale: self.useLogScale,\n            colorScheme: self.colorScheme,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setResolution(n: number) {\n        self.resolution = n\n      },\n      /**\n       * #action\n       */\n      setUseLogScale(f: boolean) {\n        self.useLogScale = f\n      },\n      /**\n       * #action\n       */\n      setColorScheme(f?: string) {\n        self.colorScheme = f\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        /**\n         * #getter\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Use log scale',\n              type: 'checkbox',\n              checked: self.useLogScale,\n              onClick: () => self.setUseLogScale(!self.useLogScale),\n            },\n            {\n              label: 'Color scheme',\n              type: 'subMenu',\n              subMenu: [\n                {\n                  label: 'Fall',\n                  onClick: () => self.setColorScheme('fall'),\n                },\n                {\n                  label: 'Viridis',\n                  onClick: () => self.setColorScheme('viridis'),\n                },\n                {\n                  label: 'Juicebox',\n                  onClick: () => self.setColorScheme('juicebox'),\n                },\n                {\n                  label: 'Clear',\n                  onClick: () => self.setColorScheme(undefined),\n                },\n              ],\n            },\n            {\n              label: 'Resolution',\n              subMenu: [\n                {\n                  label: 'Finer resolution',\n                  onClick: () => self.setResolution(self.resolution * 2),\n                },\n                {\n                  label: 'Coarser resolution',\n                  onClick: () => self.setResolution(self.resolution / 2),\n                },\n              ],\n            },\n          ]\n        },\n      }\n    })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HicAdapter\n * #category adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicAdapter = ConfigurationSchema(\n  'HicAdapter',\n  {\n    /**\n     * #slot\n     */\n    hicLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.hic',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HicAdapter\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { colord, Colord } from '@jbrowse/core/util/colord'\nimport {\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\n// locals\nimport HicRendererF from './HicRenderer'\nimport HicTrackF from './HicTrack'\nimport LinearHicDisplayF from './LinearHicDisplay'\nimport HicAdapterF from './HicAdapter'\n\nexport default class HicPlugin extends Plugin {\n  name = 'HicPlugin'\n\n  install(pluginManager: PluginManager) {\n    HicAdapterF(pluginManager)\n    HicRendererF(pluginManager)\n    HicTrackF(pluginManager)\n    LinearHicDisplayF(pluginManager)\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.hic/i\n          const adapterName = 'HicAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            hicLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          } else {\n            return adapterGuesser(file, index, adapterHint)\n          }\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) =>\n          adapterName === 'HicAdapter'\n            ? 'HicTrack'\n            : trackTypeGuesser(adapterName)\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    const { jexl } = pluginManager\n    jexl.addFunction('alpha', (color: Colord, n: number) => color.alpha(n))\n    jexl.addFunction('hsl', (color: Colord) => colord(color.toHsl()))\n    jexl.addFunction('colorString', (color: Colord) => color.toHex())\n    jexl.addFunction(\n      'interpolate',\n      (count: number, scale: (n: number) => string) => scale(count),\n    )\n  }\n}\n","import { AdapterType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\n\nexport default function HicAdapterF(pluginManager: PluginManager) {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'HicAdapter',\n        displayName: 'Hi-C adapter',\n        configSchema,\n        getAdapterClass: () => import('./HicAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from './components/HicRendering'\nimport configSchema from './configSchema'\nimport HicRenderer from './HicRenderer'\n\nexport default function HicRendererF(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new HicRenderer({\n        name: 'HicRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport configSchemaF from './configSchema'\n\nexport default function HicTrackF(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'HicTrack',\n      displayName: 'Hi-C track',\n      configSchema,\n      stateModel: createBaseTrackModel(pluginManager, 'HicTrack', configSchema),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config HicTrack\n * #category track\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'HicTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { DisplayType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport configSchemaFactory from './configSchema'\nimport stateModelFactory from './model'\n\nexport default function LinearHicDisplayF(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearHicDisplay',\n      displayName: 'Hi-C contact matrix display',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'HicTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearHicDisplay\n * #category display\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicTrackConfigFactory = (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'LinearHicDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.getRendererType('HicRenderer').configSchema,\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type HicTrackConfigModel = ReturnType<typeof HicTrackConfigFactory>\nexport type HicTrackConfig = Instance<HicTrackConfigModel>\nexport default HicTrackConfigFactory\n","import Trix from '@gmod/trix'\nimport {\n  BaseTextSearchAdapter,\n  BaseAdapter,\n  BaseTextSearchArgs,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nfunction decodeURIComponentNoThrow(uri: string) {\n  try {\n    return decodeURIComponent(uri)\n  } catch (e) {\n    // avoid throwing exception on a failure to decode URI component\n    return uri\n  }\n}\n\nfunction shorten(str: string, term: string, w = 15) {\n  const tidx = str.toLowerCase().indexOf(term)\n\n  return str.length < 40\n    ? str\n    : (Math.max(0, tidx - w) > 0 ? '...' : '') +\n        str.slice(Math.max(0, tidx - w), tidx + term.length + w).trim() +\n        (tidx + term.length < str.length ? '...' : '')\n}\n\nexport default class TrixTextSearchAdapter\n  extends BaseAdapter\n  implements BaseTextSearchAdapter\n{\n  indexingAttributes?: string[]\n  trixJs: Trix\n  tracksNames?: string[]\n\n  constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const ixFilePath = readConfObject(config, 'ixFilePath')\n    const ixxFilePath = readConfObject(config, 'ixxFilePath')\n\n    if (!ixFilePath) {\n      throw new Error('must provide out.ix')\n    }\n    if (!ixxFilePath) {\n      throw new Error('must provide out.ixx')\n    }\n    this.trixJs = new Trix(\n      openLocation(ixxFilePath, pluginManager),\n      openLocation(ixFilePath, pluginManager),\n      1500,\n    )\n  }\n\n  /**\n   * Returns list of results\n   * @param args - search options/arguments include: search query\n   * limit of results to return, searchType...prefix | full | exact\", etc.\n   */\n  async searchIndex(args: BaseTextSearchArgs) {\n    const query = args.queryString.toLowerCase()\n    const strs = query.split(' ')\n    const results = await this.trixJs.search(query)\n    const formatted = results\n      // if multi-word search try to filter out relevant items\n      .filter(([, data]) =>\n        strs.every(r =>\n          decodeURIComponentNoThrow(data).toLowerCase().includes(r),\n        ),\n      )\n      .map(([term, data]) => {\n        const result = JSON.parse(data.replaceAll('|', ',')) as string[]\n        const [loc, trackId, ...rest] = result.map(record =>\n          decodeURIComponentNoThrow(record),\n        )\n\n        const labelFieldIdx = rest.findIndex(elt => !!elt)\n        const contextIdx = rest\n          .map(elt => elt.toLowerCase())\n          .findIndex(f => f.includes(term.toLowerCase()))\n\n        const labelField = rest[labelFieldIdx]\n        const contextField = rest[contextIdx]\n        const context =\n          contextIdx !== -1 ? shorten(contextField, term) : undefined\n        const label = shorten(labelField, term)\n\n        const displayString =\n          !context || label.toLowerCase() === context.toLowerCase()\n            ? label\n            : `${label} (${context})`\n\n        return new BaseResult({\n          locString: loc,\n          label: labelField,\n          displayString,\n          matchedObject: result.map(record => decodeURIComponent(record)),\n          trackId,\n        })\n      })\n\n    return args.searchType === 'exact'\n      ? formatted.filter(\n          r => r.getLabel().toLowerCase() === args.queryString.toLowerCase(),\n        )\n      : formatted\n  }\n\n  freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config TrixTextSearchAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst TrixTextSearchAdapter = ConfigurationSchema(\n  'TrixTextSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    ixFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'out.ix', locationType: 'UriLocation' },\n      description: 'the location of the trix ix file',\n    },\n    /**\n     * #slot\n     */\n    ixxFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'out.ixx', locationType: 'UriLocation' },\n      description: 'the location of the trix ixx file',\n    },\n    /**\n     * #slot\n     */\n    metaFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'meta.json', locationType: 'UriLocation' },\n      description: 'the location of the metadata json file for the trix index',\n    },\n    /**\n     * #slot\n     */\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'textSearchAdapterId',\n  },\n)\n\nexport default TrixTextSearchAdapter\n","import TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AdapterClass as TrixTextSearchAdapterClass,\n  configSchema as trixAdapterConfigSchema,\n} from './TrixTextSearchAdapter'\n\nexport default class TrixPlugin extends Plugin {\n  name = 'TrixPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTextSearchAdapterType(\n      () =>\n        new TextSearchAdapterType({\n          name: 'TrixTextSearchAdapter',\n          displayName: 'Trix text search adapter',\n          configSchema: trixAdapterConfigSchema,\n          AdapterClass: TrixTextSearchAdapterClass,\n          description: 'Trix adapter',\n        }),\n    )\n  }\n}\n","import {\n  types,\n  cast,\n  Instance,\n  SnapshotIn,\n  IMSTArray,\n  addDisposer,\n} from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Region } from '@jbrowse/core/util/types'\nimport { Region as RegionModel, ElementId } from '@jbrowse/core/util/types/mst'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\nimport {\n  getSession,\n  localStorageGetItem,\n  localStorageSetItem,\n} from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\n\nconst LabeledRegionModel = types\n  .compose(\n    RegionModel,\n    types.model('Label', {\n      label: types.optional(types.string, ''),\n      highlight: types.optional(types.string, 'rgba(247, 129, 192, 0.35)'),\n    }),\n  )\n  .actions(self => ({\n    setLabel(label: string) {\n      self.label = label\n    },\n    setHighlight(color: string) {\n      self.highlight = color\n    },\n  }))\n\nconst SharedBookmarksModel = types.model('SharedBookmarksModel', {\n  sharedBookmarks: types.maybe(types.array(LabeledRegionModel)),\n})\n\nexport interface IExtendedLGV extends LinearGenomeViewModel {\n  showBookmarkHighlights: boolean\n  showBookmarkLabels: boolean\n  toggleShowBookmarkHighlights: (arg: boolean) => {}\n  toggleShowBookmarkLabels: (arg: boolean) => {}\n}\n\nexport interface ILabeledRegionModel\n  extends SnapshotIn<typeof LabeledRegionModel> {\n  refName: string\n  start: number\n  end: number\n  reversed: boolean\n  highlight: string\n  assemblyName: string\n  label: string\n  setRefName: (newRefName: string) => void\n  setLabel: (label: string) => void\n  setHighlight: (color: string) => void\n}\n\nexport interface IExtendedLabeledRegionModel extends ILabeledRegionModel {\n  id: number\n  correspondingObj: ILabeledRegionModel\n}\n\nconst localStorageKeyF = () =>\n  typeof window !== 'undefined'\n    ? `bookmarks-${[window.location.host + window.location.pathname].join('-')}`\n    : 'empty'\n\n/**\n * #stateModel GridBookmarkWidgetModel\n */\nexport default function f(_pluginManager: PluginManager) {\n  return types\n    .model('GridBookmarkModel', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal('GridBookmarkWidget'),\n      /**\n       * #property\n       * removed by postProcessSnapshot, only loaded from localStorage\n       */\n      bookmarks: types.optional(types.array(LabeledRegionModel), () =>\n        JSON.parse(localStorageGetItem(localStorageKeyF()) || '[]'),\n      ),\n    })\n    .volatile(() => ({\n      selectedBookmarks: [] as IExtendedLabeledRegionModel[],\n      selectedAssembliesPre: undefined as string[] | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get bookmarkAssemblies() {\n        return [...new Set(self.bookmarks.map(r => r.assemblyName))]\n      },\n      /**\n       * #getter\n       */\n      get validAssemblies() {\n        const { assemblyManager } = getSession(self)\n        return new Set(\n          this.bookmarkAssemblies.filter(a => assemblyManager.get(a)),\n        )\n      },\n      /**\n       * #getter\n       */\n      get areBookmarksHighlightedOnAllOpenViews() {\n        const { views } = getSession(self)\n        return views.every(v =>\n          'showBookmarkHighlights' in v ? v.showBookmarkHighlights : true,\n        )\n      },\n      /**\n       * #getter\n       */\n      get areBookmarksHighlightLabelsOnAllOpenViews() {\n        const { views } = getSession(self)\n        return views.every(v =>\n          'showBookmarkLabels' in v ? v.showBookmarkLabels : true,\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get bookmarksWithValidAssemblies() {\n        return self.bookmarks.filter(e =>\n          self.validAssemblies.has(e.assemblyName),\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get sharedBookmarksModel() {\n        // requires cloning bookmarks with JSON.stringify/parse to avoid duplicate\n        // reference to same object in the same state tree, will otherwise error\n        // when performing share\n        return SharedBookmarksModel.create({\n          sharedBookmarks: JSON.parse(JSON.stringify(self.selectedBookmarks)),\n        })\n      },\n      /**\n       * #getter\n       */\n      get allBookmarksModel() {\n        // requires cloning bookmarks with JSON.stringify/parse to avoid duplicate\n        // reference to same object in the same state tree, will otherwise error\n        // when performing share\n        return SharedBookmarksModel.create({\n          sharedBookmarks: JSON.parse(\n            JSON.stringify(self.bookmarksWithValidAssemblies),\n          ),\n        })\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSelectedAssemblies(assemblies?: string[]) {\n        self.selectedAssembliesPre = assemblies\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get selectedAssemblies() {\n        return (\n          self.selectedAssembliesPre?.filter(f =>\n            self.validAssemblies.has(f),\n          ) ?? [...self.validAssemblies]\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      importBookmarks(regions: Region[]) {\n        self.bookmarks = cast([...self.bookmarks, ...regions])\n      },\n      /**\n       * #action\n       */\n      addBookmark(region: Region) {\n        self.bookmarks.push(region)\n      },\n      /**\n       * #action\n       */\n      removeBookmark(index: number) {\n        self.bookmarks.splice(index, 1)\n      },\n      /**\n       * #action\n       */\n      updateBookmarkLabel(\n        bookmark: IExtendedLabeledRegionModel,\n        label: string,\n      ) {\n        bookmark.correspondingObj.setLabel(label)\n      },\n      /**\n       * #action\n       */\n      updateBookmarkHighlight(\n        bookmark: IExtendedLabeledRegionModel,\n        color: string,\n      ) {\n        bookmark.correspondingObj.setHighlight(color)\n      },\n      /**\n       * #action\n       */\n      updateBulkBookmarkHighlights(color: string) {\n        self.selectedBookmarks.forEach(bookmark =>\n          this.updateBookmarkHighlight(bookmark, color),\n        )\n      },\n      /**\n       * #action\n       */\n      setSelectedBookmarks(bookmarks: IExtendedLabeledRegionModel[]) {\n        self.selectedBookmarks = bookmarks\n      },\n      /**\n       * #action\n       */\n      setBookmarkedRegions(regions: IMSTArray<typeof LabeledRegionModel>) {\n        self.bookmarks = cast(regions)\n      },\n      /**\n       * #action\n       */\n      setHighlightToggle(toggle: boolean) {\n        const { views } = getSession(self)\n        ;(views as IExtendedLGV[]).forEach(view => {\n          view.toggleShowBookmarkHighlights?.(toggle)\n        })\n      },\n      /**\n       * #action\n       */\n      setLabelToggle(toggle: boolean) {\n        const { views } = getSession(self)\n        ;(views as IExtendedLGV[]).forEach(view => {\n          view.toggleShowBookmarkLabels?.(toggle)\n        })\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      clearAllBookmarks() {\n        self.setBookmarkedRegions(\n          self.bookmarks.filter(\n            bookmark => !self.validAssemblies.has(bookmark.assemblyName),\n          ) as IMSTArray<typeof LabeledRegionModel>,\n        )\n      },\n      /**\n       * #action\n       */\n      clearSelectedBookmarks() {\n        for (const bookmark of self.selectedBookmarks) {\n          self.bookmarks.remove(bookmark.correspondingObj)\n        }\n        self.selectedBookmarks = []\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        const key = localStorageKeyF()\n        function handler(e: StorageEvent) {\n          if (e.key === key) {\n            const localStorage = JSON.parse(localStorageGetItem(key) || '[]')\n            self.setBookmarkedRegions(localStorage)\n          }\n        }\n        window.addEventListener('storage', handler)\n        addDisposer(self, () => {\n          window.removeEventListener('storage', handler)\n        })\n        addDisposer(\n          self,\n          autorun(() => {\n            localStorageSetItem(key, JSON.stringify(self.bookmarks))\n          }),\n        )\n      },\n    }))\n    .postProcessSnapshot(snap => {\n      const { bookmarks: _, ...rest } = snap as Omit<typeof snap, symbol>\n      return rest\n    })\n}\n\nexport type GridBookmarkStateModel = ReturnType<typeof f>\nexport type GridBookmarkModel = Instance<GridBookmarkStateModel>\n","import React, { useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { SessionWithWidgets, getSession, notEmpty } from '@jbrowse/core/util'\nimport { colord } from '@jbrowse/core/util/colord'\nimport { Tooltip } from '@mui/material'\n\n// icons\nimport BookmarkIcon from '@mui/icons-material/Bookmark'\n\n// locals\nimport { GridBookmarkModel } from '../../model'\nimport { IExtendedLGV } from '../../model'\n\ntype LGV = IExtendedLGV\n\nconst useStyles = makeStyles()({\n  highlight: {\n    height: '100%',\n    position: 'absolute',\n    overflow: 'hidden',\n  },\n})\n\nconst Highlight = observer(function Highlight({ model }: { model: LGV }) {\n  const { classes } = useStyles()\n  const session = getSession(model) as SessionWithWidgets\n  const { assemblyManager } = session\n  const { showBookmarkHighlights, showBookmarkLabels } = model\n\n  const bookmarkWidget = session.widgets.get(\n    'GridBookmark',\n  ) as GridBookmarkModel\n\n  useEffect(() => {\n    if (!bookmarkWidget) {\n      session.addWidget(\n        'GridBookmarkWidget',\n        'GridBookmark',\n      ) as GridBookmarkModel\n    }\n  }, [session, bookmarkWidget])\n\n  const set = new Set(model.assemblyNames)\n\n  return showBookmarkHighlights && bookmarkWidget?.bookmarks\n    ? bookmarkWidget.bookmarks\n        .filter(value => set.has(value.assemblyName))\n        .map(r => {\n          const asm = assemblyManager.get(r.assemblyName)\n          const refName = asm?.getCanonicalRefName(r.refName) ?? r.refName\n          const s = model.bpToPx({ refName, coord: r.start })\n          const e = model.bpToPx({ refName, coord: r.end })\n          return s && e\n            ? {\n                width: Math.max(Math.abs(e.offsetPx - s.offsetPx), 3),\n                left: Math.min(s.offsetPx, e.offsetPx) - model.offsetPx,\n                highlight: r.highlight,\n                label: r.label,\n              }\n            : undefined\n        })\n        .filter(notEmpty)\n        .map(({ left, width, highlight, label }, idx) => (\n          <div\n            key={`${left}_${width}_${idx}`}\n            className={classes.highlight}\n            style={{\n              left,\n              width,\n              background: highlight,\n            }}\n          >\n            {showBookmarkLabels ? (\n              <Tooltip title={label} arrow>\n                <BookmarkIcon\n                  fontSize=\"small\"\n                  sx={{\n                    color: `${\n                      colord(highlight).alpha() !== 0\n                        ? colord(highlight).alpha(0.8).toRgbString()\n                        : colord(highlight).alpha(0).toRgbString()\n                    }`,\n                  }}\n                />\n              </Tooltip>\n            ) : null}\n          </div>\n        ))\n    : null\n})\n\nexport default Highlight\n","import React, { useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { SessionWithWidgets, getSession, notEmpty } from '@jbrowse/core/util'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { Tooltip } from '@mui/material'\n\n// locals\nimport { GridBookmarkModel } from '../../model'\nimport { IExtendedLGV } from '../../model'\n\ntype LGV = IExtendedLGV\n\nconst useStyles = makeStyles()({\n  highlight: {\n    height: '100%',\n    position: 'absolute',\n  },\n})\n\nconst OverviewHighlight = observer(function OverviewHighlight({\n  model,\n  overview,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n}) {\n  const { cytobandOffset } = model\n  const session = getSession(model) as SessionWithWidgets\n  const { classes } = useStyles()\n  const { assemblyManager } = session\n  const { showBookmarkHighlights, showBookmarkLabels } = model\n  const bookmarkWidget = session.widgets.get(\n    'GridBookmark',\n  ) as GridBookmarkModel\n\n  useEffect(() => {\n    if (!bookmarkWidget) {\n      session.addWidget(\n        'GridBookmarkWidget',\n        'GridBookmark',\n      ) as GridBookmarkModel\n    }\n  }, [session, bookmarkWidget])\n\n  const assemblyNames = new Set(model.assemblyNames)\n  return showBookmarkHighlights && bookmarkWidget?.bookmarks\n    ? bookmarkWidget.bookmarks\n        .filter(r => assemblyNames.has(r.assemblyName))\n        .map(r => {\n          const asm = assemblyManager.get(r.assemblyName)\n          const refName = asm?.getCanonicalRefName(r.refName) ?? r.refName\n          const rev = r.reversed\n          const s = overview.bpToPx({ refName, coord: rev ? r.end : r.start })\n          const e = overview.bpToPx({ refName, coord: rev ? r.start : r.end })\n          return s !== undefined && e !== undefined\n            ? {\n                width: Math.abs(e - s),\n                left: s + cytobandOffset,\n                highlight: r.highlight,\n                label: r.label,\n              }\n            : undefined\n        })\n        .filter(notEmpty)\n        .map((obj, idx) => {\n          const { left, width, highlight, label } = obj\n          return (\n            <Tooltip\n              key={JSON.stringify(obj) + '-' + idx}\n              title={showBookmarkLabels ? label : ''}\n              arrow\n            >\n              <div\n                className={classes.highlight}\n                style={{\n                  left,\n                  width,\n                  background: highlight,\n                  borderLeft: `1px solid ${highlight}`,\n                  borderRight: `1px solid ${highlight}`,\n                }}\n              />\n            </Tooltip>\n          )\n        })\n    : null\n})\n\nexport default OverviewHighlight\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { WidgetType } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport stateModelFactory from './model'\nimport AddHighlightModelF from './components/Highlight'\n\nconst configSchema = ConfigurationSchema('GridBookmarkWidget', {})\n\nexport default function GridBookmarkWidgetF(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(() => {\n    return new WidgetType({\n      name: 'GridBookmarkWidget',\n      heading: 'Bookmarked regions',\n      configSchema,\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/GridBookmarkWidget')),\n    })\n  })\n  AddHighlightModelF(pluginManager)\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  SessionWithWidgets,\n  getSession,\n  isAbstractMenuManager,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport {\n  PluggableElementType,\n  ViewType,\n} from '@jbrowse/core/pluggableElementTypes'\n\n// icons\nimport BookmarkIcon from '@mui/icons-material/Bookmark'\nimport BookmarksIcon from '@mui/icons-material/Bookmarks'\nimport HighlightIcon from '@mui/icons-material/Highlight'\nimport LabelIcon from '@mui/icons-material/Label'\n\nimport GridBookmarkWidgetF from './GridBookmarkWidget'\nimport { GridBookmarkModel } from './GridBookmarkWidget/model'\n\nexport default class GridBookmarkPlugin extends Plugin {\n  name = 'GridBookmarkPlugin'\n\n  install(pluginManager: PluginManager) {\n    GridBookmarkWidgetF(pluginManager)\n\n    pluginManager.addToExtensionPoint(\n      'Core-extendPluggableElement',\n      (pluggableElement: PluggableElementType) => {\n        if (pluggableElement.name === 'LinearGenomeView') {\n          const { stateModel } = pluggableElement as ViewType\n          const lgv = stateModel as LinearGenomeViewStateModel\n          const newStateModel = lgv\n            .props({\n              /**\n               * #property\n               * show the bookmark highlights on this track\n               */\n              showBookmarkHighlights: true,\n              /**\n               * #property\n               * show the bookmark labels on this track\n               */\n              showBookmarkLabels: true,\n            })\n            .actions(self => ({\n              /**\n               * #action\n               */\n              toggleShowBookmarkHighlights(toggle?: boolean) {\n                self.showBookmarkHighlights =\n                  toggle !== undefined ? toggle : !self.showBookmarkHighlights\n              },\n              /**\n               * #action\n               */\n              toggleShowBookmarkLabels(toggle?: boolean) {\n                self.showBookmarkLabels =\n                  toggle !== undefined ? toggle : !self.showBookmarkLabels\n              },\n              activateBookmarkWidget() {\n                const session = getSession(self)\n                if (isSessionModelWithWidgets(session)) {\n                  let bookmarkWidget = session.widgets.get('GridBookmark')\n                  if (!bookmarkWidget) {\n                    bookmarkWidget = session.addWidget(\n                      'GridBookmarkWidget',\n                      'GridBookmark',\n                    )\n                  }\n\n                  session.showWidget(bookmarkWidget)\n                  return session.widgets.get(\n                    'GridBookmark',\n                  ) as GridBookmarkModel\n                }\n\n                throw new Error('Could not open bookmark widget')\n              },\n            }))\n            .actions(self => ({\n              navigateNewestBookmark() {\n                const session = getSession(self)\n                const bookmarkWidget = self.activateBookmarkWidget()\n                const regions = bookmarkWidget.bookmarks\n                if (regions?.length) {\n                  self.navTo(regions.at(-1)!)\n                } else {\n                  session.notify(\n                    'There are no recent bookmarks to navigate to.',\n                    'info',\n                  )\n                }\n              },\n\n              bookmarkCurrentRegion() {\n                if (self.id === getSession(self).focusedViewId) {\n                  const selectedRegions = self.getSelectedRegions(\n                    undefined,\n                    undefined,\n                  )\n                  const bookmarkWidget = self.activateBookmarkWidget()\n                  bookmarkWidget.addBookmark(selectedRegions[0])\n                }\n              },\n            }))\n            .views(self => {\n              const superMenuItems = self.menuItems\n              const superRubberBandMenuItems = self.rubberBandMenuItems\n              return {\n                menuItems() {\n                  return [\n                    ...superMenuItems(),\n                    { type: 'divider' },\n                    {\n                      label: 'Bookmarks',\n                      icon: BookmarksIcon,\n                      subMenu: [\n                        {\n                          label: 'Open bookmark widget',\n                          icon: BookmarksIcon,\n                          onClick: () => self.activateBookmarkWidget(),\n                        },\n                        {\n                          label: 'Bookmark current region',\n                          icon: BookmarkIcon,\n                          onClick: () => self.bookmarkCurrentRegion(),\n                        },\n                        {\n                          label: 'Toggle bookmark highlights',\n                          icon: HighlightIcon,\n                          type: 'checkbox',\n                          checked: self.showBookmarkHighlights,\n                          onClick: () => self.toggleShowBookmarkHighlights(),\n                        },\n                        {\n                          label: 'Toggle bookmark labels',\n                          icon: LabelIcon,\n                          type: 'checkbox',\n                          checked: self.showBookmarkLabels,\n                          onClick: () => self.toggleShowBookmarkLabels(),\n                        },\n                      ],\n                    },\n                  ]\n                },\n\n                rubberBandMenuItems() {\n                  return [\n                    ...superRubberBandMenuItems(),\n                    {\n                      label: 'Bookmark region',\n                      icon: BookmarkIcon,\n                      onClick: () => {\n                        const { leftOffset, rightOffset } = self\n                        const selectedRegions = self.getSelectedRegions(\n                          leftOffset,\n                          rightOffset,\n                        )\n                        const bookmarkWidget = self.activateBookmarkWidget()\n                        bookmarkWidget.addBookmark(selectedRegions[0])\n                      },\n                    },\n                  ]\n                },\n              }\n            })\n            .actions(self => ({\n              afterCreate() {\n                document.addEventListener('keydown', e => {\n                  const activationSequence =\n                    (e.ctrlKey || e.metaKey) && e.shiftKey\n                  // ctrl+shift+d or cmd+shift+d\n                  if (activationSequence && e.code === 'KeyD') {\n                    e.preventDefault()\n                    self.activateBookmarkWidget()\n                    self.bookmarkCurrentRegion()\n                    getSession(self).notify('Bookmark created.', 'success')\n                  }\n                  // ctrl+shift+m or cmd+shift+m\n                  if (activationSequence && e.code === 'KeyM') {\n                    e.preventDefault()\n                    self.navigateNewestBookmark()\n                  }\n                })\n              },\n            }))\n\n          ;(pluggableElement as ViewType).stateModel = newStateModel\n        }\n        return pluggableElement\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Tools', {\n        label: 'Bookmarks',\n        icon: BookmarksIcon,\n        onClick: (session: SessionWithWidgets) => {\n          let bookmarkWidget = session.widgets.get('GridBookmark')\n          if (!bookmarkWidget) {\n            bookmarkWidget = session.addWidget(\n              'GridBookmarkWidget',\n              'GridBookmark',\n            )\n          }\n          session.showWidget(bookmarkWidget)\n        },\n      })\n    }\n  }\n}\n","import React from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\n\n// locals\nimport Highlight from './Highlight'\nimport OverviewHighlight from './OverviewHighlight'\nimport { IExtendedLGV } from '../../model'\n\nexport default function AddHighlightModelF(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LinearGenomeView-TracksContainerComponent',\n    // @ts-expect-error\n    (rest: React.ReactNode[] = [], { model }: { model: IExtendedLGV }) => {\n      return [\n        ...rest,\n        <Highlight key={`highlight_grid_bookmark`} model={model} />,\n      ]\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'LinearGenomeView-OverviewScalebarComponent',\n    // @ts-expect-error\n    (\n      rest: React.ReactNode[] = [],\n      { model, overview }: { model: IExtendedLGV; overview: Base1DViewModel },\n    ) => {\n      return [\n        ...rest,\n        <OverviewHighlight\n          key={`overview_highlight_grid_bookmark`}\n          model={model}\n          overview={overview}\n        />,\n      ]\n    },\n  )\n}\n","import Alignments from '@jbrowse/plugin-alignments'\nimport Authentication from '@jbrowse/plugin-authentication'\nimport Bed from '@jbrowse/plugin-bed'\nimport BreakpointSplitView from '@jbrowse/plugin-breakpoint-split-view'\nimport CircularView from '@jbrowse/plugin-circular-view'\nimport Config from '@jbrowse/plugin-config'\nimport ComparativeAdapters from '@jbrowse/plugin-comparative-adapters'\nimport DataManagement from '@jbrowse/plugin-data-management'\nimport DotplotView from '@jbrowse/plugin-dotplot-view'\nimport GtfPlugin from '@jbrowse/plugin-gtf'\nimport Gff3 from '@jbrowse/plugin-gff3'\nimport JobsManagementPlugin from '@jbrowse/plugin-jobs-management'\nimport LegacyJBrowse from '@jbrowse/plugin-legacy-jbrowse'\nimport LinearGenomeView from '@jbrowse/plugin-linear-genome-view'\nimport LinearComparativeView from '@jbrowse/plugin-linear-comparative-view'\nimport Lollipop from '@jbrowse/plugin-lollipop'\nimport Arc from '@jbrowse/plugin-arc'\nimport Menus from '@jbrowse/plugin-menus'\nimport RDF from '@jbrowse/plugin-rdf'\nimport Sequence from '@jbrowse/plugin-sequence'\nimport SVG from '@jbrowse/plugin-svg'\nimport Variants from '@jbrowse/plugin-variants'\nimport Wiggle from '@jbrowse/plugin-wiggle'\nimport GCContent from '@jbrowse/plugin-gccontent'\nimport SpreadsheetViewPlugin from '@jbrowse/plugin-spreadsheet-view'\nimport SvInspectorPlugin from '@jbrowse/plugin-sv-inspector'\nimport HicPlugin from '@jbrowse/plugin-hic'\nimport TrixPlugin from '@jbrowse/plugin-trix'\nimport GridBookmarkPlugin from '@jbrowse/plugin-grid-bookmark'\n\nconst corePlugins = [\n  SVG,\n  LinearGenomeView,\n  Alignments,\n  Authentication,\n  Bed,\n  CircularView,\n  Config,\n  DataManagement,\n  DotplotView,\n  GtfPlugin,\n  Gff3,\n  JobsManagementPlugin,\n  LegacyJBrowse,\n  LinearComparativeView,\n  Lollipop,\n  Menus,\n  RDF,\n  Sequence,\n  Variants,\n  Wiggle,\n  GCContent,\n  SpreadsheetViewPlugin,\n  SvInspectorPlugin,\n  BreakpointSplitView,\n  HicPlugin,\n  TrixPlugin,\n  GridBookmarkPlugin,\n  ComparativeAdapters,\n  Arc,\n]\n\nexport default corePlugins\n"],"names":["configSchema","ConfigurationSchema","localStorageGetNumber","key","defaultVal","localStorageGetItem","formatSubfeatures","obj","depth","parse","currentDepth","returnObj","subfeatures","map","sub","stateModelFactory","pluginManager","types","model","id","ElementId","type","literal","featureData","frozen","formattedFields","unformattedFeatureData","view","safeReference","pluggableMstType","track","trackId","maybe","string","trackType","maxDepth","number","sequenceFeatureDetails","optional","volatile","showCoordinates2","intronBp","upDownBp","upperCaseCDS","Boolean","JSON","width","views","self","showCoordinates","actions","setUpDownBp","f","setIntronBp","setUpperCaseCDS","setShowCoordinates","afterAttach","addDisposer","autorun","localStorageSetItem","stringify","error","undefined","setFeatureData","clearFeatureData","setFormattedData","feat","setExtra","setError","e","afterCreate","session","getSession","configuration","getConf","feature","clone","combine","arg2","__jbrowsefmt","console","preProcessSnapshot","snap","finalizedFeatureData","rest","postProcessSnapshot","_","v","Plugin","install","_pluginManager","configure","CoreGetRefNames","RpcMethodType","name","execute","args","rpcDriver","pm","this","deserializedArgs","deserializeArguments","sessionId","adapterConfig","dataAdapter","getAdapter","isFeatureAdapter","getRefNames","validateRendererType","rendererType","RendererType","Error","ReactComponent","CoreGetFeatureDetails","serializeArguments","rootModel","assemblyManager","renamedArgs","renameRegionsIfNeeded","superArgs","super","getRendererType","serializeArgsInClient","featureId","sessions","getLayoutId","cachedLayout","layout","getDataByID","toJSON","CoreGetMetadata","getMetadata","CoreGetFileInfo","getHeader","CoreGetFeatures","deserializeReturn","feats","SimpleFeature","signal","regions","opts","ret","getFeaturesInMultipleRegions","firstValueFrom","pipe","toArray","CoreRender","checkAbortSignal","result","render","renderInWorker","serializedReturn","des","deserializeResultsInClient","CoreFreeResources","specification","deleteCount","freeAdapterResources","getRendererTypes","forEach","renderer","count","freeResources","_rpcDriver","CoreGetFeatureDensityStats","filters","getMultiRegionFeatureDensityStats","cytobandLocation","defaultValue","uri","explicitlyTyped","CorePlugin","Object","values","coreRpcMethods","RpcMethod","addRpcMethod","addAdapterType","AdapterType","getAdapterClass","then","default","CytobandAdapterF","addWidgetType","WidgetType","heading","stateModel","lazy","PhasedScheduler","phaseCallbacks","Map","phaseOrder","constructor","add","phase","callback","includes","get","set","push","run","phaseName","TypeRecord","registeredTypes","typeName","baseClass","t","has","all","PluginManager","plugins","jexl","createJexlInstance","pluginMetadata","runtimePluginDefinitions","elementCreationSchedule","rendererTypes","adapterTypes","textSearchAdapterTypes","TextSearchAdapterType","trackTypes","TrackType","displayTypes","DisplayType","connectionTypes","ConnectionType","viewTypes","ViewType","widgetTypes","rpcMethods","addTrackWidgets","AddTrackWorkflowType","internetAccountTypes","InternetAccountType","configured","extensionPoints","initialPlugins","addPlugin","plugin","metadata","isCore","pluginConfigurationSchemas","configurationSchemas","configurationSchema","load","definition","getPlugin","find","p","hasPlugin","createPluggableElements","setRootModel","getElementTypeRecord","groupName","addElementType","creationCallback","typeRecord","newElement","evaluateExtensionPoint","getElementType","getElementTypesInGroup","getTrackElements","getConnectionElements","getAddTrackWorkflowElements","getRpcElements","getDisplayElements","getAdapterElements","fieldName","fallback","null","pluggableTypes","filter","isType","isModelType","length","jest","warn","union","pluggableConfigSchemaType","typeGroup","isBareConfigurationSchemaType","jbrequireCache","lib","ReExports","jbrequire","pack","TypeError","getAdapterType","getTextSearchAdapterType","getTrackType","getDisplayType","getViewType","getAddTrackWorkflow","getWidgetType","getConnectionType","getRpcMethodType","methodName","getInternetAccountType","addRendererType","cb","addTextSearchAdapterType","addTrackType","display","addDisplayType","addViewType","newView","viewType","extendedName","addConnectionType","addInternetAccountType","addAddTrackWorkflowType","addToExtensionPoint","extensionPointName","callbacks","extendee","props","accumulator","evaluateAsyncExtensionPoint","Entries","Accordion","AccordionActions","AccordionDetails","Alert","AlertTitle","Autocomplete","Avatar","AvatarGroup","Backdrop","Badge","Box","Breadcrumbs","Button","ButtonGroup","Card","CardActions","CardActionArea","CardContent","CardHeader","CardMedia","CircularProgress","Collapse","ClickAwayListener","Chip","Checkbox","Container","Dialog","DialogActions","DialogTitle","DialogContent","DialogContentText","Divider","Drawer","Fab","Fade","FilledInput","FormLabel","FormControl","FormControlLabel","FormHelperText","FormGroup","Grid","Grow","Icon","IconButton","Input","InputBase","InputLabel","InputAdornment","Link","LinearProgress","List","ListItem","ListItemAvatar","ListItemSecondaryAction","ListItemIcon","ListSubheader","ListItemText","Menu","MenuItem","MenuList","Modal","NativeSelect","OutlinedInput","Pagination","PaginationItem","Paper","Popover","Popper","Portal","Radio","RadioGroup","Rating","ScopedCssBaseline","Select","Skeleton","Slider","Snackbar","SnackbarContent","SpeedDial","SpeedDialAction","SpeedDialIcon","Stack","Step","StepButton","StepConnector","StepLabel","StepIcon","Stepper","SvgIcon","Switch","Tab","Table","TableBody","TableCell","TableContainer","TableFooter","TableHead","TablePagination","TableRow","TableSortLabel","Tabs","TextField","TextareaAutosize","ToggleButton","ToggleButtonGroup","Toolbar","Tooltip","Typography","LazyMUICore","fromEntries","entries","Component","React","ref","Suspense","_extends","displayName","MaterialPrefixMUI","value","MuiPrefixMUI","Attributes","FeatureDetails","BaseCard","DataGridEntries","DataGrid","module","GridActionsCellItem","GridAddIcon","GridArrowDownwardIcon","GridArrowUpwardIcon","GridCellCheckboxForwardRef","GridCellCheckboxRenderer","GridCheckCircleIcon","GridCheckIcon","GridCloseIcon","GridColumnHeaderSeparator","GridColumnHeaderSortIcon","GridColumnIcon","GridColumnMenu","GridColumnMenuContainer","GridDragIcon","GridExpandMoreIcon","GridFilterAltIcon","GridFilterForm","GridFilterListIcon","GridFilterPanel","GridFooter","GridFooterContainer","GridHeader","GridHeaderCheckbox","GridKeyboardArrowRight","GridLoadIcon","GridLoadingOverlay","GridMenuIcon","GridMoreVertIcon","GridNoRowsOverlay","GridOverlay","GridPagination","GridPanel","GridPanelWrapper","GridRemoveIcon","GridRoot","GridRowCount","GridSaveAltIcon","GridSearchIcon","GridSelectedRowCount","GridSeparatorIcon","GridTableRowsIcon","GridToolbar","GridToolbarColumnsButton","GridToolbarContainer","GridToolbarDensitySelector","GridToolbarExport","GridToolbarExportContainer","GridToolbarFilterButton","GridTripleDotsVerticalIcon","GridViewHeadlineIcon","GridViewStreamIcon","LazyDataGridComponents","LazyAttributes","LazyFeatureDetails","LazyBaseCard","libs","mobx","mst","react","ReactJSXRuntime","ReactDom","mxreact","useGridApiContext","useGridApiRef","useGridRootProps","MUIUtils","makeStyles","useTheme","alpha","MUIStyles","useStyles","classes","PropTypes","pluggableElementTypes","pluggableElementTypeModels","ServerSideRendererType","CircularChordRendererType","BoxRendererType","FeatureRendererType","Configuration","mstTypes","coreUi","coreUtil","coreColor","coreLayouts","trackUtils","Base1DView","coreIo","coreMstReflection","rxjs","BaseAdapterExports","libsList","keys","inLibsOnly","mod","reExportsList","join","inReExportsOnly","BaseResult","label","locString","renderingComponent","displayString","matchedAttribute","matchedObject","textSearchAdapter","relevance","score","results","getLabel","getDisplayString","getRenderingComponent","getTrackId","getScore","updateScore","newScore","getId","getLocation","hasLocation","getComboResults","RefSequenceResult","refName","typeModels","stringArray","array","stringArrayMap","numberMap","boolean","color","refinement","integer","text","fileLocation","FileLocation","fallbackDefaults","locationType","literalJSON","valueJSON","objectJSON","typeModelExtensions","val","removeAtIndex","idx","splice","setAtIndex","remove","delete","addToKey","ar","removeAtKeyIndex","setAtKeyIndex","JexlStringType","str","startsWith","isEmptyArray","thing","Array","isArray","modelName","inputSchemaDefinition","inputOptions","schemaDefinition","options","baseConfiguration","jbrowseSchemaDefinition","jbrowseSchemaOptions","preprocessConfigurationSchemaArguments","schemaType","modelDefinition","identifier","explicitIdentifier","implicitIdentifier","volatileConstants","isJBrowseConfigurationSchema","jbrowseSchema","slotName","slotDefinition","isLateType","isConfigurationSchemaType","description","contextVariable","configSlotModelName","charAt","toUpperCase","slice","slot","isCallback","String","expr","getEnv","stringToJexlExpression","evalSync","newVal","reset","convertToCallback","convertToValue","funcResult","extend","m","defineProperty","ConfigSlot","completeModel","setSubschema","data","newSchema","isStateTreeNode","create","identifierDefault","modelDefault","defaultSnap","getSnapshot","newSnap","matchesDefault","makeConfigurationSchemaModel","ConfigurationReference","reference","readConfObject","confObject","slotPath","isMapType","getType","newPath","subConf","isConfigurationModel","getTypeNamesFromExplicitlyTypedUnion","maybeUnionType","resolveLateType","isUnionType","typeNames","getUnionSubTypes","getDefaultValue","every","isOptionalType","getSubType","isArrayType","isConfigurationSlotType","isSequenceAdapter","isRegionsAdapter","isRefNameAliasAdapter","isTextSearchAdapter","EmptyConfig","BaseAdapter","static","config","getSubAdapter","idMaker","arg","BaseFeatureDataAdapter","_opts","getFeaturesInRegion","region","ObservableCreate","async","hasData","hasDataForRefName","getFeatures","subscribe","observer","complete","merge","getRegionQuantitativeStats","scoresToStats","getMultiRegionQuantitativeStats","blankStats","Promise","scoreMax","max","a","scoreMin","min","scoreSum","sum","scoreSumSquares","featureCount","basesCovered","rectifyStats","getRegionFeatureDensityStats","lastTime","Date","now","statsFromInterval","expansionTime","start","end","sampleCenter","features","Math","round","maybeRecordStats","featureDensity","interval","stats","statsSampleFeatures","refLen","currTime","Number","POSITIVE_INFINITY","BaseSequenceAdapter","PluggableElementBase","stuff","AdapterClass","adapterCapabilities","adapterMetadata","AddTrackWorkflow","url","configEditorComponent","subDisplay","maybeDisplayName","isObject","isObjectCustom","RegExp","globalThis","Blob","object","mapper","isSeen","WeakSet","mapArray","element","rpcDriverClassName","blobMap","getBlobMap","augmentLocationObjects","serializeNewAuthArguments","loc","isAppRootModel","internetAccountPreAuthorization","account","findAppropriateInternetAccount","getPreAuthorizationInformation","serializedArgs","_rpcDriverClassName","setBlobMap","isRemoteAbortSignal","deserializeAbortSignal","serializeReturn","originalReturn","_args","r","isAuthNeededException","retryAccount","createEphemeralInternetAccount","URL","origin","RetryError","internetAccountId","uris","mapObject","isUriLocation","HeadingComponent","BaseViewModel","minimized","menuItems","setDisplayName","setWidth","newWidth","setMinimized","flag","displayedRegions","Region","assemblyNames","tracks","connect","_arg","addTrackConf","trackConf","addTrackConfs","trackConfs","setTrackConfs","cast","clear","BaseDisplay","rpcDriverName","rendererTypeName","message","RenderingComponent","DisplayBlurb","parentTrack","getParent","isRoot","renderProps","getParentRenderProps","notReady","getContainingView","displayModel","DisplayMessageComponent","trackMenuItems","viewMenuActions","regionCannotBeRendered","setMessage","setRpcDriverName","reload","BaseInternetAccountConfig","authHeader","tokenType","domains","inWebWorker","sessionStorage","InternetAccount","toggleContents","SelectorComponent","selectorLabel","handlesLocation","location","some","domain","tokenKey","getTokenFromUser","_resolve","_reject","storeToken","token","setItem","removeToken","removeItem","retrieveToken","getItem","validateToken","_loc","tokenPromise","getToken","authInfo","resolve","reject","addAuthHeaderToInit","init","headers","Headers","authToken","validatedToken","internetAccountType","getFetcher","input","newInit","fetch","openLocation","RemoteFileWithRangeCache","createBaseTrackModel","baseTrackConfig","displays","rpcSessionId","adapterType","flatMap","d","canConfigure","sessionTracks","adminMode","isSessionModelWithConfigEditing","showDisplay","displayId","initialSnapshot","schema","conf","resolveIdentifier","getRoot","displayType","hideDisplay","transaction","replaceDisplay","oldId","newId","findIndex","shownId","compatDisp","compatTypes","Set","getCompatibleDisplays","subMenu","checked","onClick","createBaseTrackConfig","category","adapter","textSearching","indexingAttributes","indexingFeatureTypesToExclude","formatDetails","formatAbout","hideUris","s2","configDisplayTypes","addDisplayConf","LayoutSession","bpPerPx","update","assign","makeLayout","MultiLayout","GranularRectLayout","maxHeight","displayMode","pitchX","pitchY","cachedLayoutIsValid","subLayoutConstructorArgs","deepEqual","getWorkerSession","createSession","getExpandedRegion","renderArgs","maxFeatureGlyphExpansion","bpExpansion","floor","ceil","freeResourcesInClient","rpcManager","freed","discardRange","deserializeLayoutInClient","json","PrecomputedLayout","createLayoutInWorker","getSublayout","serializeResultsInWorker","serialized","serializeRegion","rectangles","uniqueId","maxHeightReached","NewHydrate","html","theme","useRef","rootRef","hydrateRoot","hydrateFn","useEffect","renderTimeout","rIC","current","jbrowseTheme","createJBrowseTheme","ThemeProvider","clearTimeout","root","setTimeout","unmount","dangerouslySetInnerHTML","__html","OldHydrate","domNode","innerHTML","unmountComponentAtNode","style","outline","hydrate","FeatureRenderer","supportsSVG","res","deserializedFeatures","fromJSON","exportSVG","blockKey","reactElement","RpcRenderedSvgGroup","ComparativeServerSideRenderer","ServerSideRenderer","renderInClient","call","getSerializedSvg","featurePassesFilters","passes","requestRegions","requestRegion","dedupe","selectedFeatureId","iterMap","size","_renderArgs","featureObservable","ServerSideRenderedContent","deserializeArgsInWorker","deserialized","SerializableFilterChain","renderToString","statusCallback","updateStatus","filterChain","trim","inputFilter","entry","children","closeAfterItemClick","stopPropagation","setOpen","onClickExtra","popupState","usePopupState","popupId","variant","onTouchStart","rest2","bindTrigger","isOpen","event","disabled","CascadingMenu","bindPopover","onMenuItemClick","ResetComponent","onFactoryReset","resetButtonText","dialogOpen","setDialogOpen","useState","FactoryResetDialog","onClose","open","FatalErrorDialog","componentStack","maxWidth","ErrorMessage","window","isBlobLocation","filename","marginLeft","spacing","setLocation","isLocalPathLocation","localPath","needToReload","getBlob","blobId","flexDirection","alignItems","fullWidth","component","hidden","onChange","target","file","files","isElectron","path","storeBlobLocation","blob","className","inputProps","dots","content","textAlign","animation","keyframes","LoadingEllipses","RedErrorMessageBox","padding","margin","overflow","background","border","category10","dark2","set1","set2","tableau10","ggplot2Colors6","ggplot2Colors5","ggplot2Colors4","ggplot2Colors3","moveTo","interRegionPaddingWidth","minimumBlockWidth","len","bpSoFar","index","offset","s","i","lengthBetween","numBlocksWideEnough","targetBpPerPx","newBpPerPx","zoomTo","extraBp","bpToStart","scrollTo","coord","bp","reversed","pxToBp","px","offsetPx","staticBlocks","blocks","contentBlocks","oob","interRegionPaddingBp","currBlock","regionNumber","at","assemblyName","bpToPx","volatileWidth","setDisplayedRegions","setBpPerPx","setVolatileWidth","displayedRegionsTotalPx","totalBp","maxOffset","minOffset","reduce","b","dynamicBlocks","calculateDynamicBlocks","calculateStaticBlocks","currBp","setFeatures","showAllRegions","zoomOut","zoomIn","clamp","minBpPerPx","maxBpPerPx","Infinity","oldBpPerPx","abs","newOffsetPx","centerAt","centerPx","scroll","distance","oldOffsetPx","AbortError","AbortSignal","aborted","makeAbortError","abortBreakPoint","DOMException","code","observeAbortSignal","fromEvent","Observable","isAbortException","exception","test","blobToDataURL","FileReader","onload","readAsDataURL","BlockSet","block","lastBlock","getBlocks","getRegions","toRegion","func","thisarg","totalWidthPx","widthPx","totalWidthPxWithoutBorders","BaseBlock","ContentBlock","ElidedBlock","elidedBlockCount","otherBlock","InterRegionPaddingBlock","elision","displayedRegionLeftPx","windowLeftPx","windowRightPx","regionStart","regionEnd","displayedRegionRightPx","regionWidthPx","parentRegion","leftPx","rightPx","intersection2","isLeftEndOfDisplayedRegion","isRightEndOfDisplayedRegion","blockOffsetPx","blockData","assembleLocStringFast","extra","modelWidth","windowLeftBp","windowRightBp","blockSizePx","blockSizeBp","regionBpOffset","regionBlockCount","windowRightBlockNum","windowLeftBlockNum","blockNum","colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","namedColorToHex","isNamedColor","contrastingTextColor","getLuminance","convertedColor","muiGetLuminance","emphasize","coefficient","muiEmphasize","makeContrasting","foreground","minContrastRatio","convertedForeground","convertedBackground","backgroundLuminance","contrastRatio","getContrastRatio","originalColor","darken","lighten","mix","names","list","hasher","lookup","hashed","hashCode","fetchers","globalRangeCache","HttpRangeFetcher","fetcher","chunkSize","maxFetchSize","minimumTTL","RemoteFile","fetchBinaryRange","bind","range","rangeParse","exec","parseInt","buffer","getRange","Response","status","requestDate","responseDate","ok","errorMessage","hint","k","arrayBuffer","Buffer","from","resolveUriLocation","baseUri","href","isNode","LocalFile","BlobFile","absoluteLocation","internetAccount","getInternetAccount","checkAuthNeededFetch","isRootModelWithInternetAccounts","response","AuthNeededError","toString","JexlF","j","addFunction","parent","log","sqrt","log10","parseFloat","char","split","charCodeAt","pos","codePointAt","search","endsWith","pad","padEnd","fill","padStart","repeat","match","replace","replaceAll","substring","toLowerCase","trimEnd","trimStart","tags","addBinaryOp","compilationCache","cacheKey","compiled","compile","minSizeToBotherWith","segmentsIntersect","x1","x2","y1","y2","LayoutRow","widthLimit","setAllFilled","allFilled","getItemAt","x","rowState","bits","isRangeClear","left","right","maxX","initialize","rectWidth","addRect","rect","l","oLeft","oRight","currLength","additionalLength","w","leftTrimAmount","rightTrimAmount","trimAmount","desiredLength","hardRowLimit","bitmap","pTotalHeight","height","storedRec","top","addRectToBitmap","pLeft","pRight","pHeight","rectangle","h","originalHeight","maxTop","collides","maxY","y","row","autovivifyRow","yEnd","hasSeen","getByCoord","pY","pX","getByID","cleanup","getTotalHeight","totalHeight","getRectangles","regionRectangles","containsNoTransferables","subLayouts","SubLayoutClass","layoutName","subLayout","sublayout","rbush","RBush","insert","minX","minY","_rect","_top","_data","_left","_right","_region","ThrowingLayout","PrecomputedMultiLayout","sublayoutJson","SceneGraph","absoluteCache","dirty","addChild","nameOrSceneGraph","child","childLeft","childRight","childTop","bottom","childBottom","absolute","expand","getSubRecord","newLeft","newRight","newTop","newBottom","diff","walkParents","walkChildren","xOffset","yOffset","node","move","c","_subtype","_subType","subType","unionType","_types","getPropertyType","propertyName","properties","_defaultValue","getEnumerationValues","maybeLate","nanoid","crypto","getRandomValues","Uint8Array","byte","createCanvas","createImageBitmap","ImageBitmapType","drawImageOntoCanvasContext","imageData","context","serializedCommands","CanvasSequence","drawImage","weHave","OffscreenCanvas","ImageBitmap","nodeCreateCanvas","canvas","otherargs","dataUri","toDataURL","img","nodeImage","onerror","src","getContext","ctx","renderToAbstractCanvas","highResolutionScaling","rasterizeLayers","scale","xlinkHref","convertToBlob","fakeCtx","canvasRecordedData","getSvg","ReactRendering","rendering","left1","right1","left2","right2","doesIntersect2","isContainedWithin","catch","takeUntil","isFeature","isSimpleFeatureSerialized","parentHandle","aliases","strand","parentId","calcStdFromSums","sumSquares","n","population","variance","scoreMean","scoreStdDev","seed","MAX_VALUE","MIN_VALUE","found","acc","summary","isViewContainer","isSessionModel","isSessionWithAddTracks","disableAddTracks","isSessionWithShareURL","shareURL","isSessionModelWithWidgets","isSessionModelWithConnections","isSessionModelWithConnectionEditing","isSessionWithSessionPlugins","isSelectionContainer","isViewModel","isTrackModel","isDisplayModel","isTrackViewModel","isAbstractMenuManager","setPrototypeOf","prototype","isRetryException","useMeasure","dims","setDims","RS","ResizeObserver","contentRect","observe","disconnect","when","getter","timeout","finished","whenPromise","mobxWhen","timeoutId","finishTimeout","cancel","addEventListener","err","whenPresent","mdRegex","modificationRegex","cigarRegex","startClip","endClip","parseCigar","cigar","cigarToMismatches","ops","seq","qual","roffset","soffset","mismatches","hasRefAndSeq","op","base","altbase","q","cliplen","mdToMismatches","mdstring","cigarMismatches","curr","lastCigar","lastTemplateOffset","lastRefOffset","lastSkipPos","mismatchRecords","skips","getTemplateCoordLocal","refCoord","templateOffset","refOffset","md","num","isNaN","mismatch","getMismatches","concat","getNextRefPos","cigarOps","positions","readPos","refPos","currPos","getModificationProbabilities","getTagAlt","elt","getMethBins","fstart","fend","fstrand","flen","mm","methBins","methProbs","probabilities","modifications","getModificationPositions","probIndex","prob","fseq","revcom","mods","basemod","matches","typestr","delta","temp","sort","getModificationTypes","getOrientedCigar","flip","getOrientedMismatches","getLengthOnRef","lengthOnRef","getLength","getLengthSansClipping","getClip","getTag","tag","featurizeSA","SA","readName","normalize","aln","saRef","saStart","saStrand","saCigar","saLengthOnRef","saLength","saLengthSansClipping","saStrandNormalized","saClipPos","saRealStart","seqLength","clipPos","CIGAR","mate","fetchSizeLimit","cramLocation","craiLocation","sequenceAdapter","CramAdapterF","bamLocation","indexType","enumeration","BamAdapterF","htsgetBase","htsgetTrackId","HtsgetBamAdapterF","hiddenFromGUI","subadapter","SNPCoverageAdapterF","clipColor","indicatorThreshold","drawArcs","drawInterbaseCounts","drawIndicators","SNPCoverageRenderer","WiggleBaseRenderer","draw","displayCrossHatches","modificationTagMap","scaleOpts","unadjustedHeight","configTheme","cfg","ticks","YSCALEBAR_LABEL_OFFSET","viewScale","getScale","indicatorViewScale","scaleType","originY","getOrigin","originLinear","toY","toHeight","toY2","toHeight2","bases","palette","colorForBase","A","main","C","G","T","insertion","softclip","hardclip","total","meth","unmeth","coverage","fillStyle","featureSpanPx","fillRect","prevTotal","extraHorizontallyFlippedOffset","snpinfo","totalScore","cov","interbaseEvents","noncov","indicatorHeight","accum","maxBase","indicatorComparatorScore","beginPath","lineTo","bpSpanPx","xs","neg","neutral","strokeStyle","lineWidth","bezierCurveTo","stroke","tick","register","WiggleRendering","PileupLayoutSession","showSoftClip","sortedBy","filterBy","PileupRenderer","fetchSequence","maxClippingSize","layoutRecords","featureMap","sortFeature","featureArray","featuresInCenterLine","featuresOutsideCenter","innerArray","isCram","localeCompare","baseSortArray","baseMap","aMismatch","bMismatch","acode","bcode","heightPx","expansionBefore","expansionAfter","topPx","layoutFeature","layoutFeats","regionSequence","shouldFetchReferenceSequence","colorBy","makeImageData","notEmpty","canvasWidth","orientationType","minSubfeatureWidth","noSpacing","largeInsertionIndicatorScale","mismatchAlpha","onMouseMove","featureIdUnderMouse","contextMenuFeature","highlightOverlayCanvas","mouseIsDown","setMouseIsDown","movedDuringLastMouseDown","setMovedDuringLastMouseDown","callMouseHandler","handlerName","featureHandler","canvasHandler","clearRect","selectedRect","getFeatureByID","leftBp","rightBp","bottomPx","rectTop","rectHeight","shadowColor","shadowBlur","lineJoin","strokeRect","highlightedFeature","highlightedRect","tagFilter","position","PrerenderedCanvas","onMouseDown","onMouseEnter","onMouseOut","onMouseOver","onMouseUp","onMouseLeave","getBoundingClientRect","offsetX","clientX","offsetY","clientY","clientBp","getFeatureOverlapping","mouseMove","onContextMenu","onFocus","onBlur","getLowerPanelDisplays","lowerPanel","deepSnap","preCheck","PileupDisplay","SNPCoverageDisplay","isAlive","compose","lowerPanelDisplays","snpCovHeight","heightPreConfig","userFeatureScreenDensity","lowerPanelType","LinearAlignmentsDisplayMixin","scrollTop","setScrollTop","setSNPCoverageHeight","pileupConf","searchFeatureByID","coverageConf","setSNPCoverageDisplay","setFeatureDensityStatsLimit","setPileupDisplay","setHeight","setLowerPanelType","resizeHeight","oldHeight","setConfig","setColorBy","propagateColorBy","setFilterBy","propagateFilterBy","renderSvg","pileupHeight","transform","overrideHeight","superTrackMenuItems","resizeHandle","zIndex","AlignmentsDisplay","ResizeHandle","onDrag","LinearAlignmentsDisplayF","pileupDisplay","snpCoverageDisplay","baseLinearDisplayConfigSchema","modelFactory","pct","toP","toFixed","TooltipContents","reactRef","refbase","rn1","r1","r0","info","toLocale","SNPCoverageTooltip","featureUnderMouse","getUniqueModificationValues","colorScheme","getRpcSessionId","FilterModel","flagInclude","flagExclude","linearWiggleDisplayModelFactory","jexlFilters","observable","modificationsReady","setJexlFilters","updateModificationColorMap","uniqueModifications","modificationColors","randomColor","superRenderProps","rendererConfig","configBlob","drawArcsSetting","drawInterbaseCountsSetting","drawIndicatorsSetting","autorunReady","initialized","featureDensityStatsReady","regionTooLarge","renderReady","ready","superProps","setModificationsReady","toggleDrawIndicators","toggleDrawInterbaseCounts","toggleDrawArcs","createAutorun","vals","delay","TooltipComponent","needsScalebar","contextMenuItems","autoscale","minScore","maxScore","inverted","multiTicks","renderers","configSchemaFactory","LinearWiggleDisplayReactComponent","loading","backgroundColor","backgroundImage","action","disabledBackground","pointerEvents","BaseDisplayComponent","BlockMsg","severity","title","DataDisplay","drawn","lastDrawnOffsetPx","LoadingBar","Arcs","useCallback","setRef","LinearReadArcsReactComponent","FilterByTagDialog","TrackHeightMixin","FeatureDensityMixin","jitter","drawInter","drawLongRange","chainData","lastDrawnBpPerPx","setLastDrawnOffsetPx","setLastDrawnBpPerPx","setLoading","setColorScheme","setChainData","setDrawInter","setDrawLongRange","setLineWidth","setJitter","lineWidthSetting","jitterVal","icon","FilterListIcon","queueDialog","handleClose","PaletteIcon","drawFeats","doAfterAttach","maxFeatureScreenDensity","linearBasicDisplayConfigSchemaFactory","configSchemaF","stateModelF","Cloud","LinearReadCloudReactComponent","drawSingletons","setDrawSingletons","featureHeight","linearAlignmentsDisplay","baseModel","baseModelFactory","AlignmentFeatureDetailsF","PileupBaseRPC","PileupGetReducedFeatures","featuresArray","reduced","flags","tlen","pair_orientation","next_ref","next_pos","filtered","sum2","avg","sd","upper","lower","getInsertSizeStats","chains","groupBy","hasPaired","PileupGetVisibleModifications","uniqueValues","PileupGetGlobalValueForTag","PileupRPCMethodsF","GuessAlignmentsTypesF","adapterGuesser","adapterHint","adapterName","fileName","getFileName","makeIndex","indexName","makeIndexType","trackTypeGuesser","defaultRendering","LinearPileupDisplayBlurb","ColorByTagDialog","SetFeatureHeightDialog","SetMaxHeightDialog","SharedLinearPileupDisplayMixin","BaseLinearDisplay","fadeLikelihood","trackMaxHeight","ColorByModel","colorTagMap","featureUnderMouseVolatile","tagsReady","setTagsReady","setMaxHeight","setFeatureHeight","setNoSpacing","updateColorTagMap","uniqueTag","colorPalette","totalKeys","setFeatureUnderMouse","selectFeature","featureWidget","addWidget","showWidget","setSelection","copyFeatureToClipboard","copy","notify","featureHeightSetting","viewName","MenuOpenIcon","clearFeatureSelection","ContentCopyIcon","renderPropsPre","onFeatureClick","layoutId","onFeatureContextMenu","setContextMenuFeature","colorSchemeSubMenuItems","doneCallback","getUniqueTagValues","notifyError","SortByTagDialog","ModificationsDialog","showSoftClipping","sortReady","currSortBpPerPx","setCurrSortBpPerPx","setSortReady","clearSelected","toggleSoftClipping","toggleMismatchAlpha","setSortedBy","centerLineInfo","centerBp","superReload","superRenderReady","mismatchAlphaSetting","superRenderPropsPre","superColorSchemeSubMenuItems","VisibilityIcon","SortIcon","option","BaseLinearDisplayComponent","AlignmentsPlugin","LinearPileupDisplayF","LinearSNPCoverageDisplayF","AlignmentsTrackF","PileupRendererF","SNPCoverageRendererF","LinearReadArcsDisplayF","LinearReadCloudDisplayF","AlignmentsFeatureWidgetF","fillColor","color_fwd_strand_not_proper","color_rev_strand_not_proper","color_fwd_strand","color_rev_strand","color_fwd_missing_mate","color_rev_missing_mate","color_fwd_diff_chr","color_rev_diff_chr","color_pair_lr","color_pair_rr","color_pair_rl","color_pair_ll","color_nostrand","color_interchrom","color_longinsert","color_shortinsert","color_unknown","strokeColor","getPairedInsertSizeColor","f1","f2","sameRef","getPairedInsertSizeAndOrientationColor","getPairedOrientationColor","orientationTypes","fr","type2","pairMap","alt","F1R2","F2R1","F1F2","F2F1","R1R2","R2R1","R1F2","R2F1","rf","ff","LR","LL","RR","RL","originalRefName","o","g","random","tooltip","borderRadius","shape","common","fontFamily","typography","fontSize","pxToRem","lineHeight","wordWrap","SanitizedHTML","contents","refs","floatingStyles","useFloating","placement","strategy","clientPoint","useClientPoint","getFloatingProps","useInteractions","popperTheme","components","MuiPopper","container","defaultProps","setFloating","TOP","BOTTOM","getPxFromCoordinate","yPos","level","getYPosOverride","chunk","trackRefs","heightFromSpecificLevel","useNextFrame","variable","setNextFrameState","intersect","a1","a2","ids","a12","findCircleIntersectionX","cx","cy","resultArray","solution","findCircleIntersectionY","cartesianToPolar","rho","theta","atan","PI","cartesianToTheta","twoPi","Slice","offsetRadians","radianWidth","bpPerRadian","assembleLocString","flipped","startRadians","endRadians","widthBp","freeze","bpToXY","radiusPx","offsetBp","elided","totalRadians","polarToCartesian","ExportSvgDialog","hideVerticalResizeHandle","hideTrackSelectorButton","lockedFitToWindow","disableImportForm","scrollX","scrollY","minimumRadiusPx","spacingPx","paddingPx","lockedPaddingPx","minVisibleWidth","trackSelectorType","visibleSection","viewSides","circleCenter","circleRadius","viewL","viewR","viewT","viewB","vertices","maxRho","reflect","rhoMin","rhoMax","thetaMin","thetaMax","vx","vy","viewportVisibleSection","centerXY","circumferencePx","elidedBp","elidedRegions","pxPerRadian","maximumRadiusPx","minCircumferencePx","maxCircumferencePx","atMaxBpPerPx","atMinBpPerPx","tooSmallToLock","figureDimensions","figureWidth","figureHeight","visible","lastVisible","displayedRegion","staticSlices","slices","currentRadianOffset","calculateStaticSlices","visibleStaticSlices","visibleThetaMin","visibleThetaMax","r1start","r2start","r2length","r1length","sliceIsVisible","newHeight","setModelViewWhenAdjust","resizeWidth","oldWidth","rotateClockwiseButton","rotateClockwise","rotateCounterClockwiseButton","rotateCounterClockwise","zoomInButton","zoomOutButton","secondCondition","closeView","removeView","previouslyEmpty","activateTrackSelector","selector","toggleTrack","hideTrack","showTrack","supportedDisplays","displayConf","toggleFitToWindowLock","exportSvg","renderToSvg","saveAs","FolderOpenIcon","PhotoCameraIcon","TrackSelectorIcon","primary","secondary","tertiary","quaternary","strokeDasharray","strokeDashoffset","light","radius","shown","setShown","patternTransform","patternUnits","strokeWidth","dominantBaseline","textAnchor","strokeLinecap","DisplayError","filled","Loading","renderReactionData","blockDefinitions","renderReactionEffect","cannotBeRenderedReason","isCompatibleWithRenderer","baseChordDisplayConfig","onChordClick","BaseChordDisplayModel","bezierRadiusRatio","refNameMap","origSlices","renamed","bezierRadius","ThisRendererType","selection","renderStarted","renderSuccess","renderError","setRefNameMap","makeAbortableReaction","fireImmediately","getTrackAssemblyNames","getRefNameMapForAdapter","CircularViewPlugin","CircularViewF","assembly","addView","asm","waitForAssembly","LaunchCircularViewF","appendToSubMenu","DataUsageIcon","callbackEditor","marginTop","callbackContainer","overflowX","textAreaFont","setContents","shrink","htmlFor","helperText","multiline","InputProps","refNameColumn","setTarget","newTarget","LazyConfigurationEditorComponent","ConfigurationPlugin","FromConfigAdapterF","FromConfigRegionsAdapterF","FromConfigSequenceAdapterF","RefNameAliasAdapterF","ConfigurationEditorWidgetF","AddConnectionWidgetF","isAbsoluteUrl","trackSource","trackData","indexTrackData","altAssemblyName","altTrackName","altTrackType","textIndexTrack","textIndexingConf","setAdapterHint","setTrackSource","setTextIndexingConf","setTextIndexTrack","setTrackData","setIndexTrackData","setAssembly","setTrackName","setTrackType","clearData","trackAdapter","guessAdapter","trackName","isFtp","isRelativeTrackUrl","isRelativeIndexUrl","isRelativeUrl","trackHttp","indexHttp","wrongProtocol","protocol","unsupported","UNSUPPORTED","guessTrackType","warningMessage","AddTrackWidgetF","getRowStr","facet","hasAnyOverlap","s1","query","categories","queryLower","getTrackName","findSubCategories","paths","hasSubs","findTopLevelCategories","filterTracks","trackListAssemblies","trackAssemblyNames","trackAssemblies","trackSelectorAnyOverlap","hasAllOverlap","generateHierarchy","noCategories","hierarchy","collapsed","filterText","activeSortTrackNames","activeSortCategories","viewTracks","confs","sortNames","sortCategories","sortConfs","unshift","currLevel","isOpenByDefault","findNonSparseKeys","rows","nonMetadataKeys","keyConfigPostFix","host","pathname","URLSearchParams","recentlyUsedK","favoritesK","collapsedK","localStorageGetJSON","localStorageSetJSON","MAX_RECENTLY_USED","stateTreeFactory","faceted","showSparse","showFilters","showOptions","panelWidth","useShoppingCart","setFilter","setPanelWidth","setUseShoppingCart","setFilterText","setShowSparse","setShowOptions","setShowFilters","allTrackConfigurations","filteredNonMetadataKeys","metadataKeys","getRootKeys","filteredMetadataKeys","fields","filteredRows","arrFilters","setVisible","favorites","recentlyUsed","sortTrackNames","recentlyUsedCounter","favoritesCounter","shownTrackIds","selectionSet","favoritesSet","recentlyUsedSet","setSortTrackNames","setSortCategories","addToSelection","removeFromSelection","clearSelection","addToFavorites","removeFromFavorites","clearFavorites","setRecentlyUsedCounter","setRecentlyUsed","setFavorites","setFavoritesCounter","addToRecentlyUsed","clearRecentlyUsed","setView","toggleCategory","pathName","setCategoryCollapsed","expandAllCategories","setCollapsedCategories","clearFilterText","newText","isSelected","isFavorite","isRecentlyUsed","getRefSeqTrackConf","sequence","configAndSessionTrackConfigurations","connectionInstances","allTrackConfigurationTrackIdSet","favoriteTracks","recentlyUsedTracks","allTracks","group","collapseSubCategories","collapseTopLevelCategories","trackGroups","hasAnySubcategories","HierarchicalTrackSelectorWidgetF","PluginStoreWidgetF","hubTxtLocation","baseConnectionConfig","UCSCTrackHubConnection","BaseConnectionModelFactory","doConnect","UCSCTrackHubConnectionF","locstr","includeAsm","toLocaleString","getBlockLabelKeysToHide","viewOffsetPx","blockLabelKeysToHide","sortedBlocks","alen","labelBounds","makeTicks","emitMajor","emitMinor","gridPitch","minMajorPitchPx","minMinorPitchPx","minMajorPitchBp","majorPitch","toExponential","majorPitchPx","minorPitch","chooseGridPitch","iterPitch","minBase","contentBlock","minHeight","boxSizing","whiteSpace","elidedBlock","interRegionPaddingBlock","boundaryPaddingBlock","boundary","ellipses","textOverflow","ErrorMessageStackTraceDialog","bg","paddingLeft","LoadingMessage","blockStatus","displayStatus","RefreshIcon","ReportIcon","reloadFlag","renderInProgress","ServerSideRenderedBlockContent","doReload","getContainingDisplay","renderBlockData","renderBlockEffect","renderDelay","setRendered","setStatus","abortController","abort","messageText","beforeDestroy","optDisplay","regionAsm","hasName","displayError","viewParams","getViewParams","getDisplayStr","totalBytes","displayBp","toPrecision","notJest","getFeatureDensityStatsPre","rightRoundedRect","leftTriangle","rightTriangle","colorMap","gneg","gpos25","gpos50","gpos100","gpos75","gvar","stalk","acen","overview","cytobands","getCytobands","lcap","rcap","HEADER_OVERVIEW_HEIGHT","centromereSeen","points","getFillProps","dragHandle","cursor","dragHandleIcon","verticalAlign","draggable","onDragStart","currentTarget","parentNode","dataTransfer","setDragImage","setDraggingTrackId","onDragEnd","DragIcon","paper","iconButton","items","AddIcon","MinimizeIcon","KeyboardDoubleArrowUpIcon","moveTrackToTop","KeyboardArrowUpIcon","moveTrackUp","KeyboardArrowDownIcon","moveTrackDown","KeyboardDoubleArrowDownIcon","moveTrackToBottom","getTrackActionMenuItems","priority","TrackLabelDragHandle","CloseIcon","CascadingMenuButton","MoreVertIcon","trackLabel","trackLabelOffset","trackLabelOverlap","labelStyle","trackLabelsSetting","prefersOffset","TrackLabel","renderingComponentContainer","trackRenderingContainer","overflowY","onDragEnter","onScroll","evt","scaleFactor","onHorizontalScroll","horizontalScroll","draggingTrackId","detail","TrackLabelContainer","ErrorBoundary","FallbackComponent","TrackRenderingContainer","moveTrack","useRangeSelect","shiftOnly","startX","setStartX","currentX","setCurrentX","anchorPosition","setAnchorPosition","guideX","setGuideX","mouseDragging","mouseDown","shiftKey","preventDefault","relativeX","getRelativeX","mouseOut","setOffsets","handleMenuItemClick","globalMouseMove","globalMouseUp","leftOffset","rightOffset","computeOffsets","removeEventListener","rubberbandOn","leftBpOffset","rightBpOffset","numOfBpSelected","guide","coordX","arrow","rubberbandControl","ControlComponent","VerticalGuide","RubberbandSpan","anchorReference","rubberBandMenuItems","scalebarContainer","scalebarZoomContainer","scalebar","majorTickLabel","justifyContent","refLabel","fontWeight","RenderedRefNameLabels","lastLeftBlock","RenderedBlockTicks","ContentBlockComponent","baseNumber","getTickDisplayStr","RenderedScalebarLabels","ElidedBlockComponent","InterRegionPaddingBlockComponent","other","offsetLeft","verticalGuidesZoomContainer","verticalGuidesContainer","majorTick","minorTick","divider","RenderedBlockLines","RenderedVerticalGuides","centerLineContainer","active","borderTop","borderBottom","centerLineText","CenterLine","trackHeights","startingPosition","role","highlight","colord","toRgbString","Highlight","anchorEl","dismissHighlight","removeHighlight","mapCoords","getCanonicalRefName","LinkIcon","sx","_event","BookmarkIcon","bookmarkWidget","widgets","addBookmark","tracksContainer","mouseDown1","mouseUp","setMouseDragging","scheduled","prevX","requestAnimationFrame","dataset","resizer","button","useSideScroll","mouseDown2","onWheel","ctrlKey","deltaY","setScaleFactor","deltaX","useWheelScroll","additional","showGridlines","Gridlines","showCenterLine","Rubberband","Scalebar","SCALE_BAR_HEIGHT","HighlightGroup","ImportForm","note","paddingTop","paddingBottom","rel","NoTracksActive","hideNoTracksActive","startIcon","LinearGenomeView","hasDisplayedRegions","handleSelectView","Element","contains","setFocusedViewId","document","MiniControlsComponent","HeaderComponent","setHovered","hoverPosition","hoverFeature","TracksContainer","TrackContainer","useOffset","multiplier","cytobandOffset","polygonColor","first","last","topLeft","topRight","startPx","endPx","HEADER_BAR_HEIGHT","getStrokeProps","HelpDialog","HelpAdornment","isHelpDialogDisplayed","setHelpDialogDisplayed","HelpIcon","EndAdornment","showHelp","endAdornment","marginRight","SearchIcon","AutocompleteTextField","TextFieldProps","inputBoxVal","params","setInputValue","setCurrentSearch","placeholder","onSelect","fetchResults","minWidth","loaded","setLoaded","currentSearch","inputValue","searchOptions","setSearchOptions","debouncedSearch","useDebounce","coarseVisibleLocStrings","aggregateResults","getDeduplicatedResult","measureText","regionOptions","useMemo","disableListWrap","disableClearable","freeSolo","includeInputInList","selectOnFocus","onInputChange","newInputValue","loadingText","onOpen","selectedOption","getOptionDisabled","filterOptions","searchQuery","toLocaleLowerCase","getFiltered","renderInput","getOptionLabel","opt","rubberband","rubberbandText","contrastText","popover","mouseEvents","paddingRight","anchorOrigin","vertical","horizontal","transformOrigin","keepMounted","disableRestoreFocus","queryString","searchType","searchScope","rankSearchResults","textSearchManager","textSearchResults","refNameResults","allRefNames","focusedBackground","hideHeader","focusedViewId","ArrowDown","zoom","ZoomOut","ZoomIn","HoverTooltip","cytoband","controlsRef","click","globalKeyDown","borderLeft","borderRight","scalebarBorder","scalebarContig","scalebarContigForward","backgroundRepeat","scalebarContigReverse","scalebarRefName","scalebarLabel","scalebarVisibleRegion","overviewSvg","OverviewBox","showCytobands","refNameColor","getRefNameColor","canDisplayCytobands","borderColor","TickLabels","Cytobands","tickLabels","offsetLabel","tickLabel","labelIdx","visibleRegions","overviewVisibleRegions","scalebarColor","firstOverviewPx","lastOverviewPx","transparency","OverviewHighlight","modWidth","OverviewRubberband","OverviewScalebarPolygon","slider","setValue","log2","onChangeCommitted","headerRefName","RefNameAutocomplete","navToOption","setSearchResults","handleSelectedRegion","SPACING","WIDGET_HEIGHT","headerBar","headerForm","flexWrap","spacer","flexGrow","panButton","toggleButton","buttonSpacer","HeaderButtons","PanControls","slide","ArrowBackIcon","ArrowForwardIcon","RegionWidth","coarseTotalBp","getBpDisplayStr","Controls","SearchBox","ZoomControls","hideHeaderOverview","OverviewScalebar","ReturnToImportFormDialog","SequenceSearchDialog","GetSequenceDialog","SearchResultsDialog","calculateVisibleLocStrings","isSingleAssemblyName","RESIZE_HANDLE_HEIGHT","INTER_REGION_PADDING_WIDTH","MUIRegion","showCytobandsSetting","trackLabels","colorByCDS","volatileError","afterDisplayedRegionsSetCallbacks","coarseDynamicBlocks","sessionSetting","MiniControls","Header","assemblyErrors","assembliesInitialized","scaleBarHeight","headerHeight","trackHeightsWithResizeHandles","includeAggregateIndexes","getTrack","openTrackIds","rewriteOnClicks","holdOnClick","apply","trackTypeActions","allActions","setColorByCDS","setShowCytobands","setHideHeader","setHideHeaderOverview","setHideNoTracksActive","setShowGridlines","addToHighlights","setHighlight","centerAtOffset","searchResults","setNewView","horizontallyFlip","reverse","displayInitialSnapshot","movingId","targetId","oldIndex","newIndex","setTrackLabels","setting","localStorage","setShowCenterLine","getSelectedRegions","simView","afterDisplayedRegionsSet","center","showAllRegionsInAssembly","factor","clearView","cancelLastAnimation","viewWidths","animate","cancelAnimation","springAnimate","canShowCytobands","anyCytobandsExist","SyncAltIcon","LabelIcon","currentlyCalculatedStaticBlocks","stringifiedCurrentlyCalculatedStaticBlocks","sret","roundedDynamicBlocks","visibleLocStrings","setCoarseDynamicBlocks","navToLocString","optAssemblyName","isValidRefName","navToLocations","parseLocStrings","navToSearchString","parsedLocStrings","locations","generateLocations","navTo","navToMultiple","assembly1","assembly2","ref1","ref2","r2","findLast","e1","e2","index2","ed","ZoomInIcon","handler","metaKey","LinearGenomeViewF","SVGBackground","shift","stripAlpha","SVGRegionSeparators","SVGTrackLabel","xoff","yoff","coarseStripHTML","SVGTracks","displayResults","textHeight","textOffset","Ruler","major","minor","hideText","SVGRuler","renderRuler","clipid","clipPath","SVGScalebar","x0","SVGHeader","cytobandHeight","rulerHeight","fillOpacity","themeName","Wrapper","allThemes","createRootFn","trackLabelMaxLen","renderToStaticMarkup","xmlns","xmlnsXlink","viewBox","asmName","canonicalRefName","inputs","parseLocString","isInteger","mouseover","CompositeMap","submaps","submap","Symbol","iterator","linearBlocks","heightOverflowed","textShadow","RenderedBlocks","blockState","state","LinearBlocks","viewModel","clientMouseCoord","clientRect","setClientRect","offsetMouseCoord","setOffsetMouseCoord","setClientMouseCoord","contextCoord","setContextCoord","mouseCoord","TransitionProps","onExit","minDisplayHeight","displayHeight","regionTooLargeReason","featureDensityStats","userBpPerPxLimit","userByteSizeLimit","featureDensityStatsP","currStatsBpPerPx","currentBytesRequested","bytes","currentFeatureScreenDensity","maxAllowableBytes","setCurrStatsBpPerPx","clearFeatureDensityStats","getFeatureDensityStats","setFeatureDensityStats","autorunFeatureDensityStats","setFeatureDensityStatsP","req","regionCannotBeRenderedText","TooLargeMessage","BlockState","blockType","featureMaps","addBlock","deleteBlock","getContainingTrack","navToFeature","setFeatureIdUnderMouse","CenterFocusStrongIcon","renderBaseLinearDisplaySvg","blocksPresent","AddFiltersDialog","trackShowLabels","trackShowDescriptions","trackDisplayMode","activeFilters","showLabels","showDescriptions","toggleShowLabels","toggleShowDescriptions","setDisplayMode","LinearGenomeViewPlugin","exports","BasicTrackF","LinearBasicDisplayF","LinearBareDisplayF","tracklist","nav","idsNotFound","tryTrack","LaunchLinearGenomeViewF","LineStyleIcon","allRefs","allRefNamesWithLowerCase","lastIndex","lastIndexOf","splitLast","checkRef","altTypeToSO","DEL","INS","DUP","INV","INVDUP","CNV","TRA","NON_REF","getSOTermAndDescription","parser","soTerms","descriptions","soTerm","getSOAndDescFromAltDefs","parseBreakend","makeDescriptionString","lena","getSOAndDescByExamination","descs","prefixes","desc","prefix","suffixes","pref","modAlt","VCFFeature","dataFromVariant","_id","field","SAMPLES","REF","ALT","POS","CHROM","INFO","ID","isTRA","isSymbolic","END","samples","vcfLocation","vcfGzLocation","linearBasicDisplayModelFactory","strokeColorSelected","strokeColorHover","bpToRadians","blockStart","blockEnd","blocksForRefs","selected","hovered","startBlock","svType","endPosition","endBlock","SVTYPE","bnd","matePosition","MatePosition","chr2","CHR2","startPos","startXY","endXY","controlXY","hoverStrokeColor","blocksForRefsMemo","Chord","VariantsPlugin","VcfAdapterF","VcfTabixAdapterF","VariantFeatureWidgetF","ExtensionPointsF","LinearVariantDisplayF","ChordRendererType","StructuralVariantChordRendererF","BaseChordDisplayComponent","ChordVariantDisplayF","YScaleBar","reducedFeatures","bigWigLocation","source","subadapters","bigWigs","posColor","negColor","bicolorPivot","bicolorPivotValue","baseWiggleRendererConfigSchema","drawDensity","pivot","pivotValue","crossing","scale2","niceMin","niceMax","prevLeftPx","hasClipping","save","fillRectCtx","restore","DensityRenderer","getFeatureUnderMouse","eventClientX","amount","hslColor","toHsl","fudgeFactor","drawXY","colorCallback","summaryScoreMode","minSize","getHeight","toOrigin","crossingOrigin","lastCol","lastMix","effectiveC","toHex","XYPlotRenderer","_score","drawLine","lastVal","lowClipping","highClipping","LinePlotRenderer","sharedWiggleConfigFactory","minimalTicks","numStdDev","hoverVertical","useClientY","en","SetMinMaxDialog","SharedWiggleMixin","selectedRendering","resolution","rendererTypeNameState","constraints","statsFetchInProgress","updateQuantitativeStats","EPSILON","setColor","setPosColor","setNegColor","aborter","statsFetch","setResolution","setFill","toggleLogScale","setScaleType","setSummaryScoreMode","setAutoscale","setMaxScore","setRendererType","setMinScore","toggleCrossHatches","setCrossHatches","cross","adapterTypeName","rendererTypeNameSimple","autoscaleType","oldDomain","getNiceDomain","bounds","summaryScoreModeSetting","mode","canHaveFill","displayCrossHatchesSetting","hatches","hasResolution","hasGlobalStats","scoreTrackMenuItems","SetColorDialog","axisPropsFromTickScale","fillSetting","hasRenderings","superRenderSvg","quantitativeStatsAutorun","sources","ent","sourcesVolatile","setLayout","clearLayout","setSources","needsFullHeightScalebar","isMultiRow","needsCustomLegend","renderColorBoxes","iter","rowHeight","rowHeightTooSmallForScalebar","useMinimalTicks","eventClientY","mouseoverBp","featuresUnderMouse","MultiXYPlotRenderer","groups","translate","MultiLineRenderer","MultiRowLineRenderer","ConfirmDialog","MultiWiggleGetSources","getSources","WiggleGetMultiRegionQuantitativeStats","WiggleGetGlobalQuantitativeStats","getGlobalStats","WigglePlugin","QuantitativeTrackF","MultiQuantitativeTrackF","XYPlotRendererConfigSchema","DensityRendererConfigSchema","LinePlotRendererConfigSchema","LinearWiggleDisplayF","MultiXYPlotRendererConfigSchema","MultiDensityRendererConfigSchema","MultiRowXYPlotRendererConfigSchema","MultiLineRendererConfigSchema","MultiRowLineRendererConfigSchema","MultiDensityRenderer","MultiRowXYPlotRenderer","MultiLinearWiggleDisplayF","LinePlotRendererF","XYPlotRendererF","DensityRendererF","MultiXYPlotRendererF","MultiRowXYPlotRendererF","MultiDensityRendererF","MultiLineRendererF","MultiRowLineRendererF","MultiWiggleAddTrackWorkflowF","trackIds","arg1","makeTrack","CreateMultiWiggleExtensionF","XYPlotRendererReactComponent","xyPlotRendererConfigSchema","utils","orientation","Axis","shadow","format","orient","LEFT","RIGHT","fg","scaleLinear","scaleLog","scaleQuantize","nice","rangeMin","rangeMax","getScaleType","getQuantitativeStats","nd","AbortController","statsRegion","wiggleStats","authEndpoint","tokenEndpoint","needsPKCE","clientId","scopes","responseType","fixup","buf","processError","invalidErrorCb","error_description","processTokenResponse","storeRefreshTokenCb","refresh_token","access_token","getResponseError","reason","statusText","getError","named","codeVerifier","codeVerifierPKCE","refreshTokenKey","storeRefreshToken","refreshToken","removeRefreshToken","retrieveRefreshToken","exchangeAuthorizationForAccessToken","redirectUri","grant_type","client_id","redirect_uri","code_verifier","method","body","exchangeRefreshForAccessToken","listener","exchangedTokenPromise","addMessageChannel","finishOAuthWindow","deleteMessageChannel","redirectUriWithInfo","fixedQueryString","redirectUrl","queryStringSearch","urlParams","useEndpointForAuthorization","response_type","token_access_type","scope","code_challenge","sha256","generateChallenge","code_challenge_method","eventName","ipcRenderer","require","invoke","eventFromDesktop","MessageEvent","doUserFlow","newToken","superGetFetcher","validateWithHEAD","ExternalTokenEntryForm","setToken","required","HTTPBasicLoginForm","username","setUsername","password","setPassword","onSubmit","btoa","autoComplete","OAuthConfigSchema","dropboxErrorMessages","shared_link_not_found","shared_link_access_denied","unsupported_link_type","shared_link_is_directory","getDescriptiveErrorMessage","DropboxIcon","append","Authorization","GoogleDriveFile","statsPromise","metadataOnly","stat","GoogleDriveIcon","getUri","driveUrl","searchParams","credentials","AuthenticationPlugin","OAuthInternetAccountModelFactory","ExternalTokenConfigSchema","ExternalTokenInternetAccountModelFactory","HTTPBasicConfigSchema","HTTPBasicInternetAccountModelFactory","DropboxOAuthConfigSchema","DropboxOAuthInternetAccountModelFactory","GoogleDriveOAuthConfigSchema","GoogleDriveOAuthInternetAccountModelFactory","bigBedLocation","scoreColumn","bedpeLocation","columnNames","bedGzLocation","autoSql","bedLocation","colRef","colStart","colEnd","BedPlugin","BigBedAdapterF","BedAdapterF","BedpeAdapterF","BedTabixAdapterF","BreakpointSplitViewType","snapshotFromBreakendFeature","endPos","featureRefName","topRegion","mateRefName","startMod","endMod","Join","MateDirection","bottomRegion","topMarkedRegion","bottomMarkedRegion","calc","getBlockFeatures","flat","showIntraviewLinks","linkViews","interactToggled","matchedTrackFeatures","matchedTracks","getMatchedTracks","trackConfigId","hasTranslocations","getTrackFeatures","getMatchedFeaturesInLayout","onAction","onSubviewAction","actionName","getPath","toggleInteract","toggleIntraviewLinks","toggleLinkViews","setMatchedTrackFeatures","PhotoCamera","BreakpointSplitViewPlugin","BreakpointSplitView","BreakpointSplitViewF","BreakpointAlignmentsWidgetF","targetAssembly","queryAssembly","pafLocation","pifGzLocation","mcscanAnchorsLocation","bed1Location","bed2Location","mcscanSimpleAnchorsLocation","outLocation","deltaLocation","chainLocation","ComparativeAdaptersPlugin","PAFAdapterF","PairwiseIndexedPAFAdapterF","DeltaAdapterF","ChainAdapterF","MCScanAnchorsAdapterF","MCScanSimpleAnchorsAdapterF","MashMapAdapterF","Dotplot1DView","box","DotplotHView","viewWidth","DotplotVView","viewHeight","stringLenPx","pxWidthForBlocks","hide","blockMessage","blockError","BlockMessage","BlockError","ServerSideRenderedDotplotContent","shouldDisplay","borderSize","borderX","borderY","warnings","ReactComponent2","vview","hview","bpPerPxY","bpPerPxX","offX","offY","DotplotDisplay","MismatchParser","lt","gt","drawCir","arc","DotplotRenderer","ComparativeRenderer","process","drawDotplot","drawCigar","thresholds","db1","db2","hBpPerPx","vBpPerPx","clampWithWarnX","effect","clampWithWarnY","hsnap","vsnap","mateRef","identity","b10","b20","e10","e20","b1","b2","currX","currY","lastDrawnX","lastDrawnY","dimensions","thresholdsPalette","ComparativeRender","rend","getRenderer","DotplotPlugin","tickSize","vtextRotation","htextRotation","viewTrackConfigs","cursorMode","showPanButtons","wheelMode","hticks","vticks","setShowPanButtons","setWheelMode","setCursorMode","setDrawCigar","setBorderX","setBorderY","setAssemblyNames","setViews","arr","getCoords","mousedown","mouseup","xmin","xmax","minmax","ymin","ymax","onDotplotView","d1","d2","_unused1","rest1","_unused2","viewSnapshot","removeTemporaryAssembly","vblocks","hblocks","hoffset","voffset","vhide","hhide","by","bx","squareView","hpx","vpx","squareViewProportional","ratio","DotplotViewF","DotplotRendererF","LaunchDotplotViewF","pluggableElement","newStateModel","superContextMenuItems","readAssembly","trackAssembly","SA2","totalLength","refLength","gatherOverlaps","DotplotReadVsRefMenuItem","TimelineIcon","gtfLocation","GtfPlugin","gtfAdapterConfigSchema","gffGzLocation","dontRedispatch","gffLocation","GFF3Plugin","Gff3TabixAdapterF","Gff3AdapterF","GuessGff3F","Job","statusMessage","progressPct","cancelCallback","setCancelCallback","setStatusMessage","setProgressPct","JobsManagementPlugin","jobs","queued","addJob","job","addedJob","removeJob","jobName","indx","removed","addFinishedJob","addQueuedJob","addAbortedJob","removeQueuedJob","updateJobStatusMessage","updateJobProgressPct","JobsListWidgetF","appendToMenu","Indexing","jobStatusWidget","rootUrlTemplate","refNames","HttpMap","readMeta","meta","loadFile","compress","track_names","hashHexCharacters","hash_bits","getHashHexCharacters","getCompress","getTrackNames","getBucket","bucketIdent","hash","hexToDirPath","hex","dirpath","crc32","JBrowse1TextSearchAdapter","namesIndex","httpMap","loadIndexFile","searchIndex","tracksNames","formatResults","exact","trackIndex","locstring","namesIndexLocation","dataDirLocation","fetchJb1","convertTrackConfig","assemblies","jb2Tracks","jb1Track","dataRoot","breakConnection","LegacyJBrowsePlugin","NCListAdapterF","GuessNCListF","JBrowse1TextSearchAdapterF","JBrowse1ConnectionF","existingFeatures","featIds","newFeatIds","foundNewFeatureNotInExistingMap","foundExistingFeatureNotInNewMap","existingFeat","levels","param","setLevelHeight","shownTracks","average","headerMenuItems","mainCanvas","clickMapCanvas","cigarClickMapCanvas","mouseoverCanvas","featPositions","mouseoverId","clickId","cigarMouseoverId","setFeatPositions","setMainCanvasRef","setClickMapCanvasRef","setCigarClickMapCanvasRef","setMouseoverCanvasRef","setMouseoverId","setCigarMouseoverId","setClickId","numFeats","featMap","LaunchSyntenyViewDialog","Curves","drawCIGAR","drawCurves","toggleCurves","toggleCIGAR","superHeaderMenuItems","superMenuItems","CropFreeIcon","ReadVsRefDialog","LinearComparativeViewPlugin","LinearComparativeViewF","LinearSyntenyViewF","LinearComparativeDisplayF","middle","baseConfigFactory","LinearSyntenyDisplayF","linearPileupDisplayConfigSchemaFactory","LGVSyntenyDisplayF","LaunchLinearSyntenyViewF","SyntenyTrackF","SyntenyFeatureWidgetF","CalendarIcon","FloatingLayout","layoutDirty","anchorLocation","getLayout","sorted","maxBottom","layoutEntries","currentItem","previouslyLaidOutItem","prevStart","prevTop","prevWidth","prevHeight","prevEnd","prevBottom","pairs","PrecomputedFloatingLayout","FloatingLayoutSession","layoutIsValid","LollipopRenderer","innerColor","caption","minStickLength","stickColor","stickWidth","LollipopPlugin","LollipopRendererF","LinearLollipopDisplayF","displayModeSetting","renderArcSvg","Arc","isMouseOvered","setIsMouseOvered","textStroke","textYCoord","ArcTooltip","centerX","centerY","angleInDegrees","angleInRadians","cos","sin","describeArc","startAngle","endAngle","largeArcFlag","SemiCircles","semicircles","thickness","ArcRenderer","ArcPlugin","ArcRendererF","LinearArcDisplayF","LinearPairedArcDisplayF","attributeName","_feature","MenusPlugin","aboutConfigSchema","aboutStateModel","helpConfigSchema","helpStateModel","importSessionConfigSchema","importSessionStateModel","sessionManagerConfigSchema","sessionManagerStateModel","InfoIcon","widget","SPARQLAdapter","endpoint","queryTemplate","additionalQueryParams","refNamesQueryTemplate","configRefNames","encodeURIComponent","querySparql","resultsToRefNames","filledTemplate","resultsToFeatures","next","accept","bindings","head","vars","requiredField","seenFeatures","rawData","rd","parentUniqueId","pid","sf","subfeature","seenFeature","RdfPlugin","sparqlAdapterConfigSchema","SPARQLAdapterClass","twoBitLocation","chromSizesLocation","Translation","codonTable","frame","seqStart","frameShift","frameShiftAdjustedSeqLength","multipleOfThreeLength","seqSliced","translated","codon","normalizedCodon","aminoAcid","letter","codonWidth","renderLetter","defaultFill","framesCDS","frames","codonFill","defaultStarts","startCodon","defaultStops","stopCodon","DNA","getContrastText","SequenceSVG","showReverse","showForward","showTranslation","generateCodonTable","defaultCodonTable","showDNA","forwardFrames","reverseFrames","topFrames","bottomFrames","toReversed","complement","userSelect","sequenceHeight","DivSequenceRenderer","fastaLocation","faiLocation","metadataLocation","gziLocation","searchForward","searchReverse","caseInsensitive","divSequenceRendererConfigSchema","SequencePlugin","DivSequenceRendererF","TwoBitAdapterF","BgzipFastaAdapterF","ChromSizesAdapterF","IndexedFastaAdapterF","SequenceSearchAdapterF","createReferenceSeqTrackConfig","ReferenceSequenceTrackF","toggleShowForward","toggleShowReverse","toggleShowTranslation","LinearReferenceSequenceDisplayF","createExtensionPoints","fontHeight","featureWidth","allowedWidthExpansion","totalWidth","measuredTextWidth","viewLeft","labelVisible","setLabelVisible","rstart","featureWidthBp","offsetPx1","rootLayout","shouldShowName","shouldShowDescription","featureLayout","GlyphComponent","FeatureLabel","OverlayRect","rectProps","screenWidth","leftWithinBlock","widthWithinBlock","handlers","mouseoverFeatureId","renderOverlay","setRenderOverlay","onFeatureMouseOut","onFeatureMouseOver","onFeatureMouseDown","onFeatureMouseEnter","onFeatureMouseUp","onFeatureMouseLeave","onFeatureMouseMove","reverseFlip","color2","topLevel","featureStart","featureEnd","featureType","featureStrand","featurePhase","isUTR","getFrame","frameColor","Arrow","subfeatureId","subfeatureLayout","getSubparts","hasUTRs","isTranscript","subs","subparts","haveLeftUTR","haveRightUTR","codeStart","codeEnd","exons","subpart","makeUTRs","confKey","makeSubpartsFilter","filterSubpart","ProcessedTranscript","Segments","layOut","extraGlyphs","layOutFeature","layOutSubfeatures","Subfeatures","topOffset","SubfeatureGlyphComponent","chooseGlyphComponent","subfeatureHeight","hasSubSub","validator","glyph","parentFeature","layoutParent","RenderedFeatureGlyph","detectRerender","labelAllowed","expansion","getWidth","glyphWidth","textWidth","aboveLayout","FeatureGlyph","RenderedFeatures","isFeatureDisplayed","featureDisplayHandler","featureIdCurrentlyUnderMouse","SvgOverlay","color1","color3","labels","nameColor","descriptionColor","subParts","impliedUTRs","SvgFeatureRenderer","SVGPlugin","SvgFeatureRendererReactComponent","svgFeatureRendererConfigSchema","EditGCContentParamsDialog","SharedModelF","windowSize","windowDelta","setGCContentParams","windowSizeSetting","windowDeltaSetting","GCContentPlugin","GCContentAdapterF","configSchemaFactory1","stateModelF1","configSchemaFactory2","stateModelF2","LinearGCContentDisplayF","MakeSpreadsheetColumnType","DataCellReactComponent","FilterModelType","compare","categoryName","hasFilter","textFilterControlAdornment","textFilterControl","FilterReactComponent","filterModel","operationChoices","getPropertyMembers","operation","setOperation","locStringIsInvalid","setLocString","ClearIcon","OPERATIONS","OPERATION_PREDICATES","overlaps with","cellLocation","specifiedLocation","contained within","fully contains","columnNumber","parsed","parsedLocString","spreadsheet","predicate","_sheet","cellsWithDerived","cells","cell","extendedData","parsedCellText","cellA","cellB","compareLocs","_columnNumber","newViewId","locationLinkClick","textInCell","stringToFind","equals","starts with","ends with","indexOf","setString","ColumnTextFilter","TextColumnType","NumberFilterModel","numberInCell","firstNumber","greater than","less than","between","secondNumber","firstNumberIsInvalid","setFirstNumber","secondNumberIsInvalid","setSecondNumber","ColumnTypes","Text","LocString","LocRef","LocStart","LocEnd","allColumnTypes","AnyColumnType","AnyFilterModelType","columnType","CellModel","toggleSelect","unSelect","select","setExtendedData","columns","column","isDerived","StaticRowModel","isLoaded","RowModel","passingFiltersCount","sortedFilteredRows","selectedCount","selectedRows","selectedAndPassingFiltersCount","selectedFilteredRows","sortedRows","rowSortingComparisonFunction","sheet","filterControls","rowPassesFilters","unselectAll","ColumnDefinition","dataType","derivationFunctionText","rowSet","StaticRowSetModel","columnDisplayOrder","hasColumnNames","sortColumns","descending","switchDirection","defaultDataType","rowMenuPosition","hideRowSelection","dataTypeChoices","rowA","rowB","setRowMenuPosition","newPosition","setSortColumns","newSort","setColumnType","newTypeName","fileTypes","fileTypeParsers","CSV","parseCsvBuffer","TSV","parseTsvBuffer","VCF","parseVcfBuffer","BED","parseBedBuffer","BEDPE","parseBedPEBuffer","STAR-Fusion","parseSTARFusionBuffer","fileTypesRegexp","fileType","hasColumnNameLine","columnNameLineNumber","selectedAssemblyName","fileSource","isReadyToOpen","canCancel","readyToDisplay","requiresUnzip","setSelectedAssemblyName","setFileSource","newSource","firstMatch","toggleHasColumnNameLine","setColumnNameLineNumber","newnumber","setFileType","cancelButton","import","typeParser","unzip","filehandle","readFile","displaySpreadsheet","RowFullTextFilter","rowFullText","columnFilters","AnyColumnFilter","setRowFullTextFilter","addBlankColumnFilter","removeColumnFilter","clearAllFilters","defaultRowMenuItems","DoneIcon","_view","rowNumber","hideFilterControls","FilterControlsModel","importWizard","ImportWizardModel","SpreadsheetModel","rowMenuItems","outputRows","setRowMenuItems","newItems","setImportMode","SpreadsheetViewPlugin","SpreadsheetViewF","exts","ext","pop","LaunchSpreadsheetViewF","ViewComfyIcon","circularViewOptions","svInspector","circularViewOptionsBarHeight","item","control","onlyDisplayRelevantRegionsInCircularView","setOnlyDisplayRelevantRegionsInCircularView","resizeHandleVert","resizeHandleHoriz","viewControls","viewsContainer","SvInspectorView","SpreadsheetViewReactComponent","CircularViewReactComponent","showCircularView","spreadsheetView","ret1","circularView","flexbox","CircularViewOptions","makeAdHocFeature","columnsAlreadyUsedInLocations","loc1","loc2","otherData","getFeatureForRow","vcfFeature","columnTypes","columnDefinition","locationColumnNumbers","locStartColumnNumbers","locEndColumnNumbers","locRefColumnNumbers","makeAdHocSvFeatureFromTwoLocations","textOf","colno","makeAdHocSvFeatureFromTwoRefStartEndSets","makeAdHocSvFeature","breakpointSplitViewSnapshotFromTableRow","svInspectorView","defaultOnChordClick","chordTrack","SvInspectorViewPlugin","SpreadsheetViewType","CircularViewType","CircularModel","featuresAdapterConfigSnapshot","featureRefNames","featuresCircularTrackConfiguration","spreadsheetWidth","circularViewWidth","refSet","reaction","generatedTrackConf","OpenInNewIcon","canOpenBreakpointSplitViewFromTableRow","openBreakpointSplitViewFromTableRow","SvInspectorViewF","LaunchSvInspectorViewF","TableChartIcon","baseColor","HicRenderer","useLogScale","getResolution","minBin","maxBin","bin1","bin2","counts","colorSchemes","juicebox","fall","interpolateRgbBasis","viridis","interpolateViridis","scaleSequentialLog","scaleSequential","rotate","setUseLogScale","hicLocation","HicPlugin","HicAdapterF","HicRendererF","HicTrackF","LinearHicDisplayF","decodeURIComponentNoThrow","decodeURIComponent","shorten","term","tidx","TrixTextSearchAdapter","ixFilePath","ixxFilePath","trixJs","Trix","strs","formatted","record","labelFieldIdx","contextIdx","labelField","contextField","metaFilePath","TrixPlugin","trixAdapterConfigSchema","TrixTextSearchAdapterClass","LabeledRegionModel","RegionModel","setLabel","SharedBookmarksModel","sharedBookmarks","localStorageKeyF","showBookmarkHighlights","showBookmarkLabels","bookmarks","rev","GridBookmarkPlugin","selectedBookmarks","selectedAssembliesPre","bookmarkAssemblies","validAssemblies","areBookmarksHighlightedOnAllOpenViews","areBookmarksHighlightLabelsOnAllOpenViews","bookmarksWithValidAssemblies","sharedBookmarksModel","allBookmarksModel","setSelectedAssemblies","selectedAssemblies","importBookmarks","removeBookmark","updateBookmarkLabel","bookmark","correspondingObj","updateBookmarkHighlight","updateBulkBookmarkHighlights","setSelectedBookmarks","setBookmarkedRegions","setHighlightToggle","toggle","toggleShowBookmarkHighlights","setLabelToggle","toggleShowBookmarkLabels","clearAllBookmarks","clearSelectedBookmarks","AddHighlightModelF","GridBookmarkWidgetF","activateBookmarkWidget","navigateNewestBookmark","bookmarkCurrentRegion","selectedRegions","superRubberBandMenuItems","BookmarksIcon","HighlightIcon","activationSequence","SVG","Alignments","Authentication","Bed","CircularView","Config","DataManagement","DotplotView","Gff3","LegacyJBrowse","LinearComparativeView","Lollipop","Menus","RDF","Sequence","Variants","Wiggle","GCContent","SvInspectorPlugin","ComparativeAdapters"],"sourceRoot":""}