"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6194],{25866:(e,t,n)=>{n.d(t,{Z:()=>x});var a=n(41867),r=n(3762),o=n(31625),s=n(17280),i=n(90872),l=n(98303);function c(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function d(e,t){const n=e.get("ALT");if(n)return new Map(null===n||void 0===n?void 0:n.map((e=>(0,l.I)(e))).filter(i.notEmpty).map((e=>[e.MatePosition,e]))).get("".concat(t.get("refName"),":").concat(t.get("start")+1))}var u=n(71416),f=n(80838);const[g,,h]=[0,1,2,3],v=(0,r.observer)((function(e){let{model:t,trackId:n,parentRef:r,getTrackYPosOverride:l}=e;const{views:d,showIntraviewLinks:v}=t,m=(0,s.Z)(),p=(0,i.getSession)(t),w=(0,o.getSnapshot)(t),{assemblyManager:k}=p,x=k.get(d[0].assemblyNames[0]);(0,u.Go)(w);const j=t.getTrackFeatures(n),S=(0,a.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(j)),[j]),y=(0,a.useMemo)((()=>{const e=t.getMatchedFeaturesInLayout(n,S?function(e){const t=new Map,n=new Set;for(const a of e.values()){const e=a.get("flags"),r=a.id(),o=4&e,s=2&e;if(!n.has(r)&&!s&&!o){const e=a.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(a)}n.add(a.id())}return[...t.values()].filter((e=>e.length>1))}(j):function(e){const t=new Map,n=new Set;for(const a of e.values()){const e=a.id(),r=4&a.get("flags"),o=!!c(a,"SA");if(!n.has(e)&&!r&&o){const e=a.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(a)}n.add(a.id())}return[...t.values()].filter((e=>e.length>1))}(j));return S||e.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),e}),[j,n,S,t]),[T,b]=(0,a.useState)();let N=0;if(r.current){const e=r.current.getBoundingClientRect();N=e.top}return x?(0,f.jsx)("g",{stroke:m.palette.text.disabled,fill:"none","data-testid":y.length?"".concat(n,"-loaded"):n,children:y.map((e=>{const t=[];for(let a=0;a<e.length-1;a++){const{layout:r,feature:o,level:s}=e[a],{layout:i,feature:c,level:m}=e[a+1];if(!r||!i)return console.warn("received null layout for a overlay feature"),null;if(!v&&s===m)return null;const w=x.getCanonicalRefName(o.get("refName")),k=x.getCanonicalRefName(c.get("refName"));if(!w||!k)throw new Error("unable to find ref for ".concat(w||k));const y=o.get("strand"),M=c.get("strand"),O=r[-1===y?g:h],L=-1===M,R=S?i[L?g:h]:i[L?h:g],I=(0,u.mu)(d[s],w,O),W=(0,u.mu)(d[m],k,R),C=d[s].pxToBp(I).reversed,B=d[m].pxToBp(W).reversed,F=d.map((e=>e.getTrack(n))),P=(0,u.cO)(n,s,d,F,r,l)-N,A=(0,u.cO)(n,m,d,F,i,l)-N,J=["M",I,P,"C",I+200*o.get("strand")*(C?-1:1),P,W-200*c.get("strand")*(B?-1:1)*(S?-1:1),A,W,A].join(" "),z="".concat(o.id(),"-").concat(c.id());t.push((0,f.jsx)("path",{d:J,"data-testid":"r1",strokeWidth:T===z?5:1,onClick:()=>{var e,t;const n=null===(e=p.addWidget)||void 0===e?void 0:e.call(p,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(j.get(o.id())||{toJSON:()=>{}}).toJSON(),feature2:(j.get(c.id())||{toJSON:()=>{}}).toJSON()}});null===(t=p.showWidget)||void 0===t||t.call(p,n)},onMouseOver:()=>b(z),onMouseOut:()=>b(void 0)},z))}return t}))}):null})),[m]=[0,1,2,3],p=(0,r.observer)((function(e){let{model:t,trackId:n,parentRef:r,getTrackYPosOverride:s}=e;const{views:c}=t,g=(0,i.getSession)(t),{assemblyManager:h}=g,v=t.getTrackFeatures(n),p=(0,a.useMemo)((()=>t.getMatchedFeaturesInLayout(n,function(e){const t=new Map,n=new Set;for(const a of e.values()){if(!n.has(a.id())&&"breakend"===a.get("type")){const e=a.get("ALT");null===e||void 0===e||e.forEach((e=>{const n="".concat(a.get("refName"),":").concat(a.get("start")+1),r=(0,l.I)(e);if(r){const e=t.get(n);e?e.push(a):t.set(r.MatePosition||"none",[a])}}))}n.add(a.id())}return[...t.values()].filter((e=>e.length>1))}(v))),[v,n,t]),[w,k]=(0,a.useState)(),x=(0,o.getSnapshot)(t);(0,u.Go)(x);const j=h.get(c[0].assemblyNames[0]);if(!j)return null;let S=0;if(r.current){const e=r.current.getBoundingClientRect();S=e.top}return(0,f.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":p.length?"".concat(n,"-loaded"):n,children:p.map((e=>{const t=[];for(let a=0;a<e.length-1;a+=1){const{layout:r,feature:o,level:i}=e[a],{layout:l,feature:h,level:p}=e[a+1],x=o.id(),y=d(o,h);if(!r||!l)return null;const T=o.get("refName"),b=h.get("refName"),N=j.getCanonicalRefName(T),M=j.getCanonicalRefName(b);if(!N||!M)throw new Error("unable to find ref for ".concat(N||M));const O=(0,u.mu)(c[i],N,r[m]),L=(0,u.mu)(c[p],M,l[m]),R=c[i].pxToBp(O).reversed,I=c[p].pxToBp(L).reversed,W=c.map((e=>e.getTrack(n))),C=(0,u.cO)(n,i,c,W,r,s)-S,B=(0,u.cO)(n,p,c,W,l,s)-S;if(y){const e=["M",O-20*("left"===y.Join?-1:1)*(R?-1:1),C,"L",O,C,"L",L,B,"L",L-20*("left"===y.MateDirection?1:-1)*(I?-1:1),B].join(" ");t.push((0,f.jsx)("path",{d:e,strokeWidth:x===w?10:5,onClick:()=>{var e,t,n;const a=null===(e=g.addWidget)||void 0===e?void 0:e.call(g,"VariantFeatureWidget","variantFeature",{featureData:null===(t=v.get(x))||void 0===t?void 0:t.toJSON()});null===(n=g.showWidget)||void 0===n||n.call(g,a)},onMouseOver:()=>k(x),onMouseOut:()=>k(void 0)},JSON.stringify(e)))}else console.warn("the relevant ALT allele was not found, cannot render")}return t}))})})),[w]=[0,1,2,3],k=(0,r.observer)((function(e){let{model:t,trackId:n,parentRef:r,getTrackYPosOverride:s}=e;const{views:l}=t,c=(0,i.getSession)(t),{assemblyManager:d}=c,g=t.getTrackFeatures(n),h=(0,a.useMemo)((()=>t.getMatchedFeaturesInLayout(n,function(e){const t=[],n=new Set;for(const a of e.values())n.has(a.id())||"<TRA>"!==a.get("ALT")[0]||t.push([a]),n.add(a.id());return t}(g))),[g,n,t]),[v,m]=(0,a.useState)(),p=(0,o.getSnapshot)(t);(0,u.Go)(p);if(!d.get(l[0].assemblyNames[0]))return null;let k=0;if(r.current){const e=r.current.getBoundingClientRect();k=e.top}return l.length<2?null:(0,f.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":h.length?"".concat(n,"-loaded"):n,children:h.map((e=>{const t=[];for(const{layout:a,feature:r,level:o}of e){const e=0===o?1:0,i=r.id();if(!a)return null;const d=r.get("INFO"),h=d.CHR2[0],p=d.END[0],[x,j]=d.STRANDS[0].split(""),S=(0,u.mu)(l[e],h,p);if(S){const d=[S,0,S+1,0],h=(0,u.mu)(l[o],r.get("refName"),a[w]),p=S,y=l[o].pxToBp(h).reversed,T=l[e].pxToBp(p).reversed,b=l.map((e=>e.getTrack(n))),N=(0,u.cO)(n,o,l,b,a,s)-k,M=(0,u.cO)(n,e,l,b,d,s)-k,O=["M",h-20*("+"===x?1:-1)*(y?-1:1),N,"L",h,N,"L",p,M,"L",p-20*("+"===j?1:-1)*(T?-1:1),M].join(" ");t.push((0,f.jsx)("path",{d:O,strokeWidth:i===v?10:5,onClick:()=>{var e,t;const n=null===(e=c.addWidget)||void 0===e?void 0:e.call(c,"VariantFeatureWidget","variantFeature",{featureData:(g.get(i)||{toJSON:()=>{}}).toJSON()});null===(t=c.showWidget)||void 0===t||t.call(c,n)},onMouseOver:()=>m(i),onMouseOut:()=>m(void 0)},JSON.stringify(O)))}}return t}))})})),x=(0,r.observer)((function(e){var t,n;const{model:a,trackId:r}=e,o=a.getMatchedTracks(r);return"AlignmentsTrack"===(null===(t=o[0])||void 0===t?void 0:t.type)?(0,f.jsx)(v,{...e}):"VariantTrack"===(null===(n=o[0])||void 0===n?void 0:n.type)?a.hasTranslocations(r)?(0,f.jsx)(k,{...e}):(0,f.jsx)(p,{...e}):null}))},76194:(e,t,n)=>{n.d(t,{renderToSvg:()=>v});n(41867);var a=n(49665),r=n(85815),o=n(90872),s=n(81096),i=n(35421),l=n(4592),c=n(17280),d=n(80838);function u(e){let{width:t,height:n,shift:a}=e;const r=(0,c.Z)();return(0,d.jsx)("rect",{width:t+2*a,height:n,fill:(0,o.stripAlpha)(r.palette.background.default)})}var f=n(99512),g=n(25866);function h(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a={};let r=t;for(const o of e.tracks)a[o.configuration.trackId]=r+n,r+=o.displays[0].height+t;return a}async function v(e,t){var n;const{textHeight:c=18,headerHeight:v=30,rulerHeight:m=30,fontSize:p=13,trackLabels:w="offset",Wrapper:k=(e=>{let{children:t}=e;return(0,d.jsx)(d.Fragment,{children:t})}),themeName:x="default"}=t,j=(0,o.getSession)(e),S=null===(n=j.allThemes)||void 0===n?void 0:n.call(j)[x],{width:y,views:T}=e,b=v+m,N=T.map((e=>(0,l.hY)(e.tracks,c,w)+b)),M=(0,o.sum)(N)+100,O=await Promise.all(T.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const n=e.displays[0];return await(0,r.when)((()=>void 0===n.ready||n.ready)),{track:e,result:await n.renderSvg({...t,theme:S})}})))})))),L=function(e,t,n){return(0,o.max)(e.flatMap((e=>e.tracks.map((e=>(0,o.measureText)((0,f.getTrackName)(e.configuration,n),t))))),0)}(T,p,j)+40,R="left"===w?L:0,I="offset"===w?c:0,W=[h(T[0],I,p+b),h(T[1],I,p+N[0]+b)],C=y+R,B=(0,i.createJBrowseTheme)(S);return(0,a.uS)((0,d.jsx)(s.Z,{theme:B,children:(0,d.jsx)(k,{children:(0,d.jsxs)("svg",{width:y,height:M,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,C+100,M].toString(),children:[(0,d.jsx)(u,{width:C,height:M,shift:50}),(0,d.jsxs)("g",{transform:"translate(".concat(50," ").concat(p,")"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(R,")"),children:[(0,d.jsx)("text",{x:0,fontSize:p,fill:B.palette.text.primary,children:T[0].assemblyNames.join(", ")}),(0,d.jsx)(l.Uc,{model:O[0].view,fontSize:p})]}),(0,d.jsx)(l.Ge,{textHeight:c,trackLabels:w,fontSize:p,model:O[0].view,displayResults:O[0].data,offset:b,trackLabelOffset:R})]}),(0,d.jsxs)("g",{transform:"translate(".concat(50," ").concat(p+N[0],")"),children:[(0,d.jsxs)("g",{transform:"translate(".concat(R,")"),children:[(0,d.jsx)("text",{x:0,fontSize:p,fill:B.palette.text.primary,children:T[1].assemblyNames.join(", ")}),(0,d.jsx)(l.Uc,{model:O[1].view,fontSize:p})]}),(0,d.jsx)(l.Ge,{textHeight:c,trackLabels:w,fontSize:p,model:O[1].view,displayResults:O[1].data,offset:b,trackLabelOffset:R})]}),(0,d.jsx)("defs",{children:(0,d.jsx)("clipPath",{id:"clip-bsv",children:(0,d.jsx)("rect",{x:0,y:0,width:y,height:M})})}),(0,d.jsx)("g",{transform:"translate(".concat(R+50,")"),clipPath:"url(#clip-bsv)",children:e.matchedTracks.map((t=>(0,d.jsx)(g.Z,{parentRef:{current:null},model:e,trackId:t.configuration.trackId,getTrackYPosOverride:(e,t)=>W[t][e]},t.configuration.trackId)))})]})})}))}}}]);
//# sourceMappingURL=6194.e0dde349.chunk.js.map